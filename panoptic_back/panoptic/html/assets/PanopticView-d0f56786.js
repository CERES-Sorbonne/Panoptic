import{d as O,Q as Re,u as re,S as ie,z as K,r as M,c as G,V as q,o as t,a as l,b as e,F as T,q as y,W as ce,t as x,h as g,k as C,w as ue,v as fe,e as p,X as Ie,M as te,l as h,Y as z,Z as he,$ as ve,n as H,O as W,a0 as $e,i as X,s as B,D as J,a1 as Ae,_ as U,a2 as Ue,a3 as we,a4 as Me,f as Q,a5 as _e,a6 as Se,m as Z,G as je,a7 as de,a8 as ze,j as Y,g as ke,a9 as Be,aa as Ne,ab as Ce,ac as He,ad as We,J as qe,ae as Ke,af as Qe,K as Ye,R as Xe,L as Ze,ag as Je,ah as et,ai as Fe,aj as Ge,ak as tt,al as ae,am as ee,an as st,ao as ot,ap as at,aq as lt,ar as nt,as as it,at as me,au as rt,av as ut,aw as dt,ax as pt,ay as Te,az as ct,aA as mt,aB as vt,x as gt,p as Ve,A as j}from"./index-292a537c.js";import{_ as ft}from"./Tutorial-66ead5c5.js";const ge={},_t={class:"d-flex flex-row"},yt={key:2,class:"d-flex",style:{width:"150px"}},bt={class:"flex-grow-1"},ht={key:1,style:{"padding-top":"1px"}},kt={style:{width:"20px","margin-top":"2px"},class:"text-center"},xt={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},$t={key:0},wt={key:0,class:"ms-3 pt-1"},St={class:"options hover-light"},Ct={class:"p-1",style:{"min-width":"100px"}},Vt={key:1,class:"custom-hr mt-1 mb-1"},It=["onClick"],Mt={key:1},zt=O({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(k){const{t:c}=Re({useScope:"global"}),s=re();ie();const a=K(),o=k,d=M(!1),u=M(!1),b=M(""),v=M(!1),i=G(()=>o.tab.state.visibleProperties[o.property.id]==!0),n=G(()=>o.tab.collection.filterManager.state.filter.filters.some(E=>!E.isGroup&&E.propertyId==o.property.id)),r=G(()=>o.tab.collection.groupManager.state.groupBy.includes(o.property.id)),m=G(()=>o.tab.collection.sortManager.state.sortBy.includes(o.property.id)),_=G(()=>{if(n.value)return o.tab.collection.filterManager.state.filter.filters.find(E=>!E.isGroup&&E.propertyId==o.property.id).id}),S=()=>o.tab.collection.filterManager,R=G(()=>o.tab.getSha1Mode());function A(){i.value?o.tab.setVisibleProperty(o.property.id,!1):o.tab.setVisibleProperty(o.property.id,!0)}function V(){o.open&&(d.value?d.value=!1:(d.value=!0,b.value=o.property.name),u.value=!1)}function $(){o.property.type!=W.tag&&o.property.type!=W.multi_tags||(u.value?u.value=!1:u.value=!0,d.value=!1)}function F(){m.value?o.tab.collection.sortManager.delSort(o.property.id):o.tab.collection.sortManager.setSort(o.property.id),o.tab.collection.sortManager.update(!0)}function w(){r.value?o.tab.collection.groupManager.delGroupOption(o.property.id):o.tab.collection.groupManager.setGroupOption(o.property.id),o.tab.collection.groupManager.update(!0)}function f(){confirm(c("common.properties.delete")+": "+o.property.name+" ?   "+o.property.id)&&a.deleteProperty(o.property.id)}async function P(){b.value!=""&&(await a.updateProperty(o.property.id,b.value),V())}function N(){const E=S();n.value?(E.deleteFilter(_.value),ge.filter.hide()):(E.addNewFilter(o.property.id),ge.filter.show())}function D(E){a.updateProperty(o.property.id,o.property.name,E)}return q(()=>o.property,()=>{d.value=!1}),(E,I)=>(t(),l("div",{class:H(v.value?"hover-light":"")},[e("div",_t,[o.open?(t(),l(T,{key:0},[d.value?g("",!0):(t(),l("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:V},[y(ce,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:I[0]||(I[0]=L=>v.value=!0),onMouseleave:I[1]||(I[1]=L=>v.value=!1)},null,8,["type"]),e("span",null,x(o.property.name),1)]))],64)):(t(),C(ce,{key:1,type:o.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),d.value&&o.open?(t(),l("div",yt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:V,onMouseenter:I[2]||(I[2]=L=>v.value=!0),onMouseleave:I[3]||(I[3]=L=>v.value=!1)},null,32)]),e("div",bt,[o.property.id>=0?ue((t(),l("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":I[4]||(I[4]=L=>b.value=L),onChange:P},null,544)),[[fe,b.value]]):(t(),l("span",ht,[y(ce,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(o.property.name),1)]))])])):g("",!0),o.open?(t(),l(T,{key:3},[p(Ie)(o.property.type)?(t(),l("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:I[5]||(I[5]=L=>p(s).showModal(p(te).TAG,{propId:o.property.id}))},[y(z,{click:!1,message:"main.nav.properties.open_tags"},{default:h(()=>I[8]||(I[8]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):g("",!0),e("div",kt,[o.property.mode==p(he).id?(t(),C(z,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:h(()=>I[9]||(I[9]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):g("",!0)])],64)):g("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:A,class:"btn-icon text-center"},[R.value&&o.property.mode==p(he).id?(t(),C(z,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:h(()=>[e("span",{class:"bi bi-eye-slash",onClick:I[6]||(I[6]=ve(()=>{},["stop"]))})]),_:1})):(t(),C(z,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:h(()=>[e("span",{class:H("bi bi-eye text-"+(i.value?"primary":"secondary"))},null,2)]),_:1}))]),o.open?(t(),l("div",xt,[o.property.type==p(W).tag||o.property.type==p(W).multi_tags?(t(),l("div",{key:0,onClick:$,style:{cursor:"pointer"}},[u.value?(t(),C(z,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:h(()=>I[10]||(I[10]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(t(),C(z,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:h(()=>I[11]||(I[11]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):g("",!0)])):g("",!0)]),o.open?(t(),l("div",$t,[d.value?(t(),l("div",wt,[E.property.id!=p($e).folders?(t(),l("div",{key:0,class:H(["options hover-light",n.value?" text-primary":""]),onClick:N},[e("div",null,[I[12]||(I[12]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),X(x(E.$t("main.menu.filters")),1)])],2)):g("",!0),e("div",{class:H(["options hover-light",m.value?" text-primary":""]),onClick:F},[I[13]||(I[13]=e("i",{class:"bi bi-filter me-2"},null,-1)),X(x(E.$t("main.menu.sort.title")),1)],2),e("div",{class:H(["options hover-light",r.value?" text-primary":""]),onClick:w},[I[14]||(I[14]=e("i",{class:"bi bi-collection me-2"},null,-1)),X(x(E.$t("main.menu.groupby")),1)],2),o.property.id>=0?(t(),l("div",{key:1,class:"options hover-light",onClick:f},[I[15]||(I[15]=e("i",{class:"bi bi-trash me-2"},null,-1)),X(x(E.$t("main.nav.properties.delete_property")),1)])):g("",!0),o.property.id>=0&&p(a).propertyGroupsList.length?(t(),C(J,{key:2,teleport:!0},{button:h(()=>[e("div",St,[I[16]||(I[16]=e("i",{class:"bi bi-folder me-1"},null,-1)),X(" "+x(E.$t("main.nav.properties.set_group")),1)])]),popup:h(()=>[e("div",Ct,[o.property.propertyGroupId&&p(a).propertyGroups[o.property.propertyGroupId]?(t(),l("div",{key:0,class:"bb",onClick:I[7]||(I[7]=L=>D(null))},"None")):g("",!0),o.property.propertyGroupId&&p(a).propertyGroups[o.property.propertyGroupId]?(t(),l("div",Vt)):g("",!0),(t(!0),l(T,null,B(p(a).propertyGroupsList,L=>(t(),l("div",{class:"bb",onClick:oe=>D(L.id)},x(L.name),9,It))),256))])]),_:1})):g("",!0)])):u.value?(t(),l("div",Mt,[y(Ae,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):g("",!0)])):g("",!0)],2))}});const xe=U(zt,[["__scopeId","data-v-ac2bed1d"]]),Ft={class:"text-nowrap"},Gt=["onClick"],Tt=["onClick"],Pt=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(k){const c=K(),s=k;function a(){c.reImportFolder(s.folder.id)}function o(){confirm(Ue.global.t("main.nav.folders.del_alert"))&&c.deleteFolder(s.folder.id)}return(d,u)=>(t(),C(J,{teleport:!0},{button:h(()=>u[0]||(u[0]=[e("i",{class:"bi bi-three-dots base-hover"},null,-1)])),popup:h(({hide:b})=>[e("div",Ft,[e("div",{class:"p-2 bb",onClick:v=>{a(),b()}},u[1]||(u[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),X("Re import")]),8,Gt),u[3]||(u[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:v=>{o(),b()}},[u[2]||(u[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),X(x(d.$t("main.nav.folders.del")),1)],8,Tt)])]),_:1}))}}),Et=["onMouseenter"],Ot={style:{display:"inline"}},Lt=["onClick"],Dt={class:"text-secondary"},Rt=["onClick"],At=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:we,root:{type:Boolean,default:!0}},setup(k){const c=K(),s=k,a=M(null),o=G(()=>{let n={};const r=new Set(s.filterManager.state.folders);return s.folders.map(m=>m.id).forEach(m=>{r.has(m)&&(n[m]=!0)}),n}),d=G(()=>{let n={};return s.folders.map(r=>r.id).forEach(r=>{s.visibleFolders[r]&&(n[r]=!0)}),n}),u=G(()=>{let n={};return s.folders.forEach(r=>{let m=[];o.value[r.id]&&m.push("selected"),n[r.id]=m.join(" ")}),n});function b(n){let r=s.visibleFolders;r[n]?delete r[n]:r[n]=!0}function v(n){let r=new Set(s.filterManager.state.folders);const m=r.has(n),_=c.folders[n].parent!=null&&r.has(c.folders[n].parent);m&&!_?(r.delete(n),_e(n).forEach(S=>r.delete(S.id))):(i(n,r),r.add(n),_e(n).forEach(S=>r.add(S.id)),Se(c.folders[n]).forEach(S=>r.delete(S.id))),s.filterManager.setFolders(Array.from(r)),s.filterManager.update(!0)}function i(n,r){const m=Se(c.folders[n]);let _;for(let S of m)if(r.has(S.id))_=S;else break;_!=null&&_e(_.id).forEach(S=>r.delete(S.id))}return(n,r)=>{const m=Me("FolderList2",!0);return t(),l("ul",{class:H(s.root?"tree":""),style:Q(s.root?"padding-left:0px;":"")},[(t(!0),l(T,null,B(k.folders,_=>(t(),l("li",{style:Q(s.root?"padding-left:0px;":""),class:"no-break",onMouseenter:S=>a.value=_.id,onMouseleave:r[0]||(r[0]=S=>a.value=null)},[e("div",Ot,[e("summary",{class:H(u.value[_.id]),onClick:S=>v(_.id)},[X(x(_.name)+" ",1),e("span",Dt,x(p(c).folders[_.id].count),1)],10,Lt)]),_.children&&_.children.length>0?(t(),l("i",{key:0,onClick:S=>b(_.id),class:H("bi bi-chevron-"+(d.value[_.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Rt)):g("",!0),e("span",{class:H(a.value===_.id?"visible-option":"invisible-option")},[y(Pt,{folder:_,style:{display:"inline-block"}},null,8,["folder"])],2),_.children&&_.children.length>0&&d.value[_.id]?(t(),C(m,{key:1,folders:_.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager},null,8,["folders","visible-folders","filter-manager"])):g("",!0)],44,Et))),256))],6)}}});const Ut=U(At,[["__scopeId","data-v-d31236ea"]]),jt={class:"text-center"},Bt={class:"w-100 text-center",style:{"font-size":"10px"}},Nt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ht=O({__name:"TaskStatus",props:{task:{}},setup(k){const c=k,s=G(()=>c.task.total-c.task.remain-c.task.computing),a=G(()=>c.task.total);return(o,d)=>(t(),l("div",jt,[X(x(c.task.name)+" ",1),e("div",Bt,x(s.value)+" / "+x(a.value)+" "+x(o.$t("main.nav.tasks.done")),1),a.value>0?(t(),l("div",Nt,[e("div",{class:"progress-bar",style:Q(`width: ${s.value/a.value*100}%`)},null,4)])):g("",!0)]))}}),Wt={class:"prop-container"},qt={key:0},Kt={key:1},Qt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Yt={key:1,class:"ms-2"},Xt={key:0,class:"ps-1 pe-1 pt-1"},Zt={class:"property-item"},Jt=O({__name:"PropertyGroup",props:{tab:{},group:{},menuOpen:{type:Boolean}},setup(k){const c=K(),s=k,a=M(!0),o=M(!1),d=M(""),u=G(()=>c.propertyList.filter(r=>r.propertyGroupId==s.group.id));function b(){a.value=!a.value}function v(r){c.updatePropertyGroup(s.group.id,d.value)}function i(){d.value=s.group.name}function n(){c.deletePropertyGroup(s.group.id)}return Z(i),q(s,i),(r,m)=>(t(),l("div",Wt,[e("div",{class:"d-flex group-container",onClick:b},[a.value?(t(),l("div",qt,m[3]||(m[3]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):g("",!0),a.value?g("",!0):(t(),l("div",Kt,m[4]||(m[4]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),s.menuOpen?(t(),l(T,{key:2},[o.value?g("",!0):(t(),l("div",Qt,x(s.group.name),1)),o.value?(t(),l("div",Yt,[y(je,{"auto-focus":!0,modelValue:d.value,"onUpdate:modelValue":m[0]||(m[0]=_=>d.value=_),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:v,onCancel:i,onBlur:m[1]||(m[1]=_=>o.value=!1)},null,8,["modelValue"])])):g("",!0),m[7]||(m[7]=e("div",{class:"flex-grow-1"},null,-1)),o.value?g("",!0):(t(),l("div",{key:2,class:"bb me-1",onClick:m[2]||(m[2]=ve(_=>o.value=!0,["stop"]))},m[5]||(m[5]=[e("i",{class:"bi bi-pencil"},null,-1)]))),e("div",{class:"bb me-1",onClick:ve(n,["stop"])},m[6]||(m[6]=[e("i",{class:"bi bi-x"},null,-1)]))],64)):g("",!0)]),a.value&&u.value.length?(t(),l("div",Xt,[(t(!0),l(T,null,B(u.value,_=>(t(),l("div",Zt,[y(xe,{tab:s.tab,property:_,open:s.menuOpen},null,8,["tab","property","open"])]))),256))])):g("",!0)]))}});const es=U(Jt,[["__scopeId","data-v-8dd4d762"]]),Pe=O({__name:"TabContainer",props:{id:{}},setup(k){const c=de(),s=k;let a;const o=M(!1);function d(){a=c.getTab(s.id),o.value=!0}return Z(d),q(()=>s.id,async()=>{o.value=!1,await Y(),d()}),(u,b)=>o.value&&p(c).loaded?ze(u.$slots,"default",{key:0,tab:p(a)}):g("",!0)}}),ts={class:""},ss={class:"m-0",style:{padding:"4px 0px 4px 8px"}},os={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},as={key:0,class:"bi bi-chevron-left"},ls={key:1,class:"bi bi-chevron-right"},ns={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},is={class:"d-flex align-items-center"},rs={style:{"max-height":"300px",overflow:"auto"}},us={key:0,id:"import"},ds={class:"pt-1 pb-2"},ps={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},cs={key:0,class:"ps-2 pe-2"},ms={class:"p-1"},vs={key:0,class:"custom-hr"},gs={class:"p-1 mt-0"},fs={key:0,class:"d-flex p-1"},_s={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},ys={key:1,class:"bb me-1"},bs={class:"bb me-2"},hs={key:1,class:"mt-2"},ks={style:{"padding-left":"0px"}},xs={class:"ps-1 pe-1"},$s={key:0,class:"property-item"},ws={class:"p-2 mt-0"},Ss={key:1,class:"mt-2"},Cs={key:0,class:"property-item"},Vs=200,Is=55,Ms=O({__name:"Menu",emits:["export","toggle"],setup(k,{emit:c}){const s=ie(),a=K(),o=re(),d=de(),u=c,b=M(!1),v=M(!1),i=M(!0),n=G(()=>i.value?Vs:Is),r=G(()=>a.propertyList.filter(V=>V.id>=0&&(V.propertyGroupId===void 0||!a.propertyGroups[V.propertyGroupId]))),m=async V=>{o.showModal(te.IMPORT)},_=G(()=>s.backendStatus.tasks.filter(V=>!V.done));function S(){o.showModal(te.FOLDERSELECTION,{callback:R,mode:"images"})}function R(V){V&&a.addFolder(V)}function A(){i.value=!i.value,u("toggle")}return q(()=>s.status.import.to_import,()=>b.value=!0),(V,$)=>(t(),C(Pe,{id:p(d).mainTab},{default:h(({tab:F})=>{var w;return[e("div",{class:"menu overflow-scroll",style:Q({width:n.value+"px"})},[e("div",ts,[e("div",null,[e("div",ss,[e("div",os,[i.value?(t(),l(T,{key:0},[e("div",{class:"flex-grow-1 text-capitalize overflow-hidden",onClick:$[0]||($[0]=()=>{})},x((w=p(o).data.status.selectedProject)==null?void 0:w.name),1),y(z,{message:"main.menu.close_project"},{default:h(()=>[e("div",{class:"base-hover p-1",onClick:$[1]||($[1]=f=>p(o).closeProject())},$[7]||($[7]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:$[2]||($[2]=f=>p(o).showModal(p(te).SETTINGS))},$[8]||($[8]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):g("",!0),e("div",{class:H(["base-hover p-1",i.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:A},[i.value?(t(),l("i",as)):(t(),l("i",ls))],2)])]),i.value?(t(),l(T,{key:0},[$[10]||($[10]=e("div",{class:"custom-hr"},null,-1)),e("div",ns,[e("div",is,[e("div",null,[e("b",null,x(V.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:$[3]||($[3]=f=>{S(),p(ke)()})},[y(z,{message:"main.nav.folders.add"},{default:h(()=>$[9]||($[9]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",rs,[y(Ut,{folders:p(a).folderRoots,"filter-manager":F.collection.filterManager,"visible-folders":F.state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])])])],64)):g("",!0),i.value?(t(),l(T,{key:1},[_.value&&_.value.length?(t(),l("div",us,[$[12]||($[12]=e("div",{class:"custom-hr"},null,-1)),e("div",ds,[e("div",ps,[e("div",null,[e("b",null,x(V.$t("main.nav.tasks.title")),1)])]),$[11]||($[11]=e("div",{class:"custom-hr"},null,-1)),p(s).backendStatus?(t(),l("div",cs,[(t(!0),l(T,null,B(_.value,(f,P)=>(t(),l("div",ms,[P?(t(),l("div",vs)):g("",!0),y(Ht,{task:f},null,8,["task"])]))),256))])):g("",!0)])])):g("",!0)],64)):g("",!0),$[19]||($[19]=e("div",{class:"custom-hr"},null,-1)),e("div",gs,[i.value?(t(),l("div",fs,[y(z,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:h(()=>[e("b",null,x(V.$t("main.nav.properties.title")),1)]),_:1}),$[14]||($[14]=e("span",{class:"flex-grow-1"},null,-1)),v.value?(t(),l("span",_s,$[13]||($[13]=[e("span",{class:"sr-only"},null,-1)]))):(t(),l("span",ys,[y(z,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:h(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:m})]),_:1})])),e("span",bs,[y(z,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:h(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:$[4]||($[4]=f=>p(o).showModal(p(te).EXPORT,void 0))})]),_:1})])])):g("",!0),p(s).status.loaded?(t(),l("div",hs,[(t(!0),l(T,null,B(p(Be)(p(a).propertyGroups),f=>(t(),l("div",ks,[y(es,{tab:F,group:f,class:"mb-1","menu-open":i.value},null,8,["tab","group","menu-open"])]))),256)),(t(!0),l(T,null,B(r.value,f=>(t(),l("div",xs,[f.id>=0?(t(),l("div",$s,[y(xe,{tab:F,property:f,open:i.value},null,8,["tab","property","open"])])):g("",!0)]))),256)),i.value?(t(),l(T,{key:0},[$[17]||($[17]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:$[5]||($[5]=f=>{p(o).showModal(p(te).PROPERTY,void 0),p(ke)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[$[15]||($[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(V.$t("main.nav.properties.add_property")),1)]),$[18]||($[18]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:$[6]||($[6]=f=>p(a).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[$[16]||($[16]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(V.$t("main.nav.properties.add_property_group")),1)])],64)):g("",!0)])):g("",!0)]),$[20]||($[20]=e("div",{class:"custom-hr"},null,-1)),e("div",ws,[i.value?(t(),C(z,{key:0,message:"main.nav.computed.computed_tooltip",icon:!0},{default:h(()=>[e("b",null,x(V.$t("main.nav.computed.title")),1)]),_:1})):g("",!0),p(s).status.loaded?(t(),l("div",Ss,[(t(!0),l(T,null,B(p(a).properties,f=>(t(),l(T,null,[f.id<0&&f.id!=p(Ne)?(t(),l("div",Cs,[y(z,{pos:"bottom",message:"main.nav.computed."+Math.abs(f.id).toString()+"_tooltip"},{default:h(()=>[y(xe,{tab:F,property:f,open:i.value},null,8,["tab","property","open"])]),_:2},1032,["message"])])):g("",!0)],64))),256))])):g("",!0)])])])],4)]}),_:1},8,["id"]))}});const zs=U(Ms,[["__scopeId","data-v-baf60a72"]]),Fs={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Gs={class:""},Ts=["onClick"],Ps=O({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:c}){const s=k,a=c;function o(d){a("update:modelValue",d)}return(d,u)=>(t(),C(J,null,{button:h(()=>[e("div",Fs,[e("span",Gs,x(d.$t("modals.filters."+s.modelValue)),1)])]),popup:h(({hide:b})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:b},[e("div",{class:"base-btn",onClick:u[0]||(u[0]=v=>o(p(Ce).and))},x(d.$t("modals.filters.and")),1),u[2]||(u[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:u[1]||(u[1]=v=>o(p(Ce).or))},x(d.$t("modals.filters.or")),1)],8,Ts)]),_:1}))}}),Es=["disabled"],Os={class:"m-0 p-1"},Ls=["onClick"],Ds=O({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(k,{emit:c}){const s=K(),a=k,o=c,d=G(()=>s.properties[a.propertyId]),u=G(()=>He(d.value.type));async function b(v){o("update:modelValue",v)}return(v,i)=>(t(),C(J,{onHide:i[0]||(i[0]=n=>o("hide")),placement:"bottom"},{button:h(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:a.disabled},[e("span",null,x(v.$t("modals.filters.operators."+a.modelValue)),1)],8,Es)]),popup:h(({hide:n})=>[e("div",Os,[(t(!0),l(T,null,B(u.value,r=>(t(),l("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:m=>{b(r),n()}},[e("a",null,x(v.$t("modals.filters.operators."+r)),1)],8,Ls))),256))])]),_:1}))}});const Rs=U(Ds,[["__scopeId","data-v-0b3d97be"]]),As={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},Us=O({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(k,{emit:c}){const s=k,a=c;function o(d){a("update:modelValue",d)}return(d,u)=>(t(),l("div",As,[p(Ie)(d.property.type)?(t(),C(We,{key:0,"model-value":s.modelValue,"onUpdate:modelValue":o,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:s.property,teleport:!1,width:s.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):s.property.type==p(W).color?(t(),C(qe,{key:1,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):s.property.type==p(W).number?(t(),C(Ke,{key:2,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):s.property.type==p(W).url?(t(),C(Qe,{key:3,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"])):s.property.type==p(W).checkbox?(t(),C(Ye,{key:4,"model-value":s.modelValue,"onUpdate:modelValue":o,label:s.property.name,width:s.width,class:"sb"},null,8,["model-value","label","width"])):s.property.type==p(W).date?(t(),C(Xe,{key:5,"model-value":s.modelValue,teleport:!1,"onUpdate:modelValue":o,width:s.width,class:"sb"},null,8,["model-value","width"])):(t(),C(Ze,{key:6,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),js={class:"p-0 m-0 ps-2"},Bs=O({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(k,{emit:c}){const s=K(),a=k,o=G(()=>s.properties[a.filter.propertyId]),d=G(()=>et(a.filter.operator));function u(i){a.manager.updateFilter(a.filter.id,{operator:i})}function b(i){a.manager.updateFilter(a.filter.id,{value:i})}function v(i){a.manager.updateFilter(a.filter.id,{propertyId:i.id})}return(i,n)=>(t(),l(T,null,[e("td",js,[y(Je,{"model-value":o.value,"onUpdate:modelValue":v},null,8,["model-value"])]),e("td",null,[y(Rs,{"property-id":o.value.id,"model-value":a.filter.operator,"onUpdate:modelValue":u},null,8,["property-id","model-value"])]),e("td",null,[d.value?(t(),C(Us,{key:0,"model-value":a.filter.value,"onUpdate:modelValue":b,property:o.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):g("",!0)])],64))}}),Ns={style:{"max-height":"500px",overflow:"auto"}},Ee=O({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(k,{emit:c}){const s=k;function a(o){s.manager.addNewFilter(o,s.group.id),ge.filter.show()}return(o,d)=>(t(),C(J,{placement:"auto"},{button:h(()=>[ze(o.$slots,"default")]),popup:h(({hide:u})=>[e("div",Ns,[y(Fe,{onSelect:b=>{a(b),u()},"ignore-ids":[p($e).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Hs={class:"filter-group"},Ws={class:"table table-sm"},qs={style:{height:"33px"}},Ks={class:""},Qs={key:0,class:"m-0 p-0"},Ys={key:2,class:"text-secondary"},Xs={class:"border rounded"},Zs={class:""},Js=["onClick"],eo={class:"d-flex text-secondary ms-2"},to={class:"add-options hover-light"},so=O({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(k,{emit:c}){K();const s=k,a=G(()=>s.filter),o=G(()=>a.value.filters),d=G(()=>{let i=255-(a.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function u(i){s.manager.deleteFilter(i.id)}function b(i){s.manager.addNewFilterGroup(i)}function v(i,n){s.manager.updateFilterGroup(i,n)}return(i,n)=>(t(),l("div",Hs,[e("table",Ws,[(t(!0),l(T,null,B(o.value,(r,m)=>(t(),l("tr",qs,[e("td",Ks,[m==0?(t(),l("div",Qs,x(i.$t("modals.filters.where")),1)):m==1?(t(),C(Ps,{key:1,"model-value":a.value.groupOperator,"onUpdate:modelValue":n[0]||(n[0]=_=>v(a.value.id,_))},null,8,["model-value"])):(t(),l("span",Ys,x(i.$t("modals.filters."+a.value.groupOperator)),1))]),r.propertyId!==void 0?(t(),C(Bs,{key:0,filter:r,manager:s.manager},null,8,["filter","manager"])):(t(),l("td",{key:1,colspan:"3",style:Q(d.value)},[e("div",Xs,[y(Oe,{filter:r,manager:s.manager},null,8,["filter","manager"])])],4)),e("td",Zs,[e("span",{class:"base-btn",onClick:_=>u(r)},n[2]||(n[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Js)])]))),256))]),e("div",eo,[y(Ee,{group:s.filter,manager:s.manager},{default:h(()=>[e("div",to,[n[3]||(n[3]=e("i",{class:"bi bi-plus"},null,-1)),X(x(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:n[1]||(n[1]=r=>b(a.value.id))},[n[4]||(n[4]=e("i",{class:"bi bi-plus"},null,-1)),X(x(i.$t("modals.filters.new_group")),1)])])]))}});const Oe=U(so,[["__scopeId","data-v-cbadcac5"]]),oo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},ao={key:0},lo={key:0,class:"or-separator"},no={key:0,class:"or-separator"},io={key:0,class:"m-1 p-1"},ro=O({__name:"MainFilterDropdown",props:{manager:we},emits:["update:modelValue"],setup(k,{emit:c}){const s=K(),a=k,o=M(null),d=M(null),u=G(()=>{let v=b(a.manager.state.filter),i={};return v.forEach(n=>i[n.propertyId]=n),Object.values(i)});function b(v){let i=[];for(let n of v.filters)n.isGroup?i.push(...b(n)):i.push(n);return i}return q(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&d.value.hide()}),Z(async()=>{await Y(),ge.filter=d.value}),(v,i)=>(t(),C(J,{ref_key:"dropdownElem",ref:d,placement:"top-start"},{button:h(()=>[e("div",null,[u.value.length||a.manager.state.query?(t(),l("div",oo,[a.manager.state.query?(t(),l("div",ao,[i[0]||(i[0]=e("span",{class:"text-primary"},"Text Query",-1)),u.value.length?(t(),l("span",lo,"|")):g("",!0)])):g("",!0),(t(!0),l(T,null,B(u.value,(n,r)=>(t(),l("div",null,[r>0?(t(),l("span",no,"|")):g("",!0),n.propertyId==p($e).id?(t(),C(ce,{key:1,type:p(s).properties[n.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):g("",!0),e("span",null,x(p(s).properties[n.propertyId].name),1)]))),256))])):g("",!0)])]),popup:h(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:o},[Object.keys(p(s).properties).length>0?(t(),l("div",io,[y(Oe,{filter:a.manager.state.filter,manager:a.manager,parent:o.value},null,8,["filter","manager","parent"])])):g("",!0)],512)]),_:1},512))}});const uo=U(ro,[["__scopeId","data-v-7dbca090"]]),po={class:"d-flex flex-row filter-form"},co={class:"pt-1 pb-1"},mo=O({__name:"FilterForm",props:{manager:we},setup(k){const c=k;return(s,a)=>(t(),l("div",po,[e("div",co,x(s.$t("main.menu.filters"))+": ",1),y(uo,{manager:c.manager},null,8,["manager"]),y(Ee,{manager:c.manager,group:c.manager.state.filter,class:"p-1"},{default:h(()=>a[0]||(a[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}});const vo=U(mo,[["__scopeId","data-v-aad7b24a"]]),go={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},fo=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(k,{emit:c}){const s=k,a=c,o=M(null);return(d,u)=>(t(),C(J,{ref_key:"dropdownElem",ref:o,"auto-focus":!1},{button:h(()=>u[2]||(u[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:h(()=>[e("div",go,[y(Fe,{onClick:u[0]||(u[0]=b=>p(ke)()),onSelect:u[1]||(u[1]=b=>{a("select",b),o.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Le=U(fo,[["__scopeId","data-v-2f10e29f"]]),_o={class:"base-hover ps-1 pe-1"},yo={class:"main"},bo=["onClick"],ho=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:c}){const s=k,a=c,o=Object.values(Ge);function d(u){a("update:modelValue",u)}return(u,b)=>(t(),C(J,null,{button:h(()=>[e("div",_o,x(s.modelValue),1)]),popup:h(({hide:v})=>[e("div",yo,[(t(!0),l(T,null,B(p(o),i=>(t(),l("div",{class:"base-hover option",onClick:n=>{d(i),v()}},x(i),9,bo))),256))])]),_:1}))}});const ko=U(ho,[["__scopeId","data-v-cc9d0d61"]]),xo={class:""},$o={class:"d-flex ipt"},wo={class:"ms-2",min:"1"},So=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(k,{emit:c}){const s=k,a=c,o=M(1),d=M(Ge.Year);function u(){s.option.stepSize==o.value&&s.option.stepUnit==d.value||a("change",{stepSize:o.value,stepUnit:d.value})}function b(){o.value=s.option.stepSize??1,d.value=s.option.stepUnit}return q(()=>s.option,b),Z(b),q(o,()=>{(o.value<1||o.value==null||isNaN(o.value))&&(o.value=1)}),(v,i)=>(t(),C(J,{onHide:u},{button:h(()=>i[2]||(i[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:h(({hide:n,focus:r})=>[e("div",xo,[e("div",$o,[e("div",null,[ue(e("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=m=>o.value=m)},null,512),[[fe,o.value]])]),e("div",wo,[y(ko,{modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=m=>d.value=m),onHide:r},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Co=U(So,[["__scopeId","data-v-a27bea28"]]),Vo={class:"d-flex flex-row group-form"},Io={class:"pt-1 pb-1"},Mo={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},zo={key:0,class:"bi bi-chevron-right smaller"},Fo=["onClick"],Go=["onClick"],To=["onClick"],Po=["onClick"],Eo=["onClick"],Oo=["onClick"],Lo=["onClick"],Do=["onClick"],Ro=["onClick"],Ao={key:5,class:"sm-btn"},Uo={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},jo=O({__name:"GroupForm",props:{isLoading:Boolean,manager:tt},setup(k){const c=K(),s=k;function a(n){s.manager.setGroupOption(n),s.manager.update(!0)}function o(n){s.manager.delGroupOption(n),s.manager.update(!0)}function d(n,r){s.manager.setGroupOption(n,{direction:r}),s.manager.sortGroups(!0)}function u(n,r){s.manager.setGroupOption(n,{type:r}),s.manager.sortGroups(!0)}function b(n,r){s.manager.setGroupOption(n,r),s.manager.update(!0)}const v=G(()=>s.manager.state.groupBy.map(n=>c.properties[n])),i=G(()=>{const n=[];return s.manager.state.groupBy.forEach(r=>{n.push({option:s.manager.state.options[r],property:c.properties[r]})}),n});return(n,r)=>(t(),l("div",Vo,[e("div",Io,x(n.$t("main.menu.groupby"))+": ",1),v.value.length?(t(),l("div",Mo,[(t(!0),l(T,null,B(i.value,(m,_)=>(t(),l(T,null,[_>0?(t(),l("i",zo)):g("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:S=>o(m.property.id),id:"remove-group-button"},x(m.property.name),9,Fo),m.option.type==p(ae).Size?(t(),C(z,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:h(()=>[m.option.direction==p(ee).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:S=>u(m.property.id,p(ae).Property)},null,8,Go)):(t(),l("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:S=>u(m.property.id,p(ae).Property)},null,8,To))]),_:2},1024)):(t(),C(z,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:h(()=>[m.property.type==p(W).number?(t(),l(T,{key:0},[m.option.direction==p(ee).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:S=>u(m.property.id,p(ae).Size)},null,8,Po)):(t(),l("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:S=>u(m.property.id,p(ae).Size)},null,8,Eo))],64)):(t(),l(T,{key:1},[m.option.direction==p(ee).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:S=>u(m.property.id,p(ae).Size)},null,8,Oo)):(t(),l("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:S=>u(m.property.id,p(ae).Size)},null,8,Lo))],64))]),_:2},1024)),m.option.direction==p(ee).Ascending?(t(),C(z,{key:3,message:"main.menu.sort.order_asc"},{default:h(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:S=>d(m.property.id,p(ee).Descending)},null,8,Do)]),_:2},1024)):(t(),C(z,{key:4,message:"main.menu.sort.order_desc"},{default:h(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:S=>d(m.property.id,p(ee).Ascending)},null,8,Ro)]),_:2},1024)),m.property.type==p(W).date?(t(),l("div",Ao,[y(Co,{option:m.option,onChange:S=>b(m.property.id,S)},null,8,["option","onChange"])])):g("",!0)],64))),256)),s.isLoading?(t(),l("i",Uo)):g("",!0)])):g("",!0),y(Le,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:r[0]||(r[0]=m=>a(m))},null,8,["group-ids"])]))}});const Bo=U(jo,[["__scopeId","data-v-388718c9"]]),No={class:"d-flex flex-row sort-form"},Ho={class:"pt-1 pb-1"},Wo={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},qo={key:0,class:"bi bi-chevron-right smaller"},Ko=["onClick"],Qo=["onClick"],Yo=["onClick"],Xo=O({__name:"SortForm",props:{manager:st},setup(k){const c=K(),s=k,a=G(()=>s.manager.state.sortBy.map(v=>({propertyId:v,direction:s.manager.state.options[v].direction}))),o=G(()=>a.value.map(v=>v.propertyId));function d(v){s.manager.setSort(v),s.manager.update(!0)}function u(v){s.manager.delSort(v),s.manager.update(!0)}function b(v,i){s.manager.setSort(v,{direction:i}),s.manager.update(!0)}return(v,i)=>(t(),l("div",No,[e("div",Ho,x(v.$t("main.menu.sort.title"))+": ",1),a.value.length?(t(),l("div",Wo,[(t(!0),l(T,null,B(a.value,(n,r)=>(t(),l(T,null,[r>0?(t(),l("i",qo)):g("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:m=>u(n.propertyId)},x(p(c).properties[n.propertyId].name),9,Ko),n.direction==p(ee).Ascending?(t(),C(z,{key:1,message:"main.menu.sort.order_asc"},{default:h(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:m=>b(n.propertyId,p(ee).Descending)},null,8,Qo)]),_:2},1024)):(t(),C(z,{key:2,message:"main.menu.sort.order_desc"},{default:h(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:m=>b(n.propertyId,p(ee).Ascending)},null,8,Yo)]),_:2},1024))],64))),256))])):g("",!0),y(Le,{"group-ids":o.value,onSelect:i[0]||(i[0]=n=>d(n))},null,8,["group-ids"])]))}});const Zo=U(Xo,[["__scopeId","data-v-80dc564a"]]),Jo={class:"custom-slider"},ea=["value","min","max","step"],ta=O({__name:"RangeInput",props:{min:{default:0},max:{default:1},step:{default:.1},modelValue:{}},emits:["update:modelValue"],setup(k,{emit:c}){const s=k,a=c,o=M(s.modelValue),d=M(null),u=(n,r,m)=>(n-r)/(m-r),b=n=>{d.value.style.setProperty("--ProgressPercent",`${n}%`)};ot(()=>{if(d.value){const n=u(o.value,d.value.min,d.value.max);b(n+0)}});function v(){a("update:modelValue",o.value)}let i=!1;return navigator.userAgent.indexOf("AppleWebKit")!=-1&&(i=!0),q(()=>s.modelValue,()=>o.value=s.modelValue),(n,r)=>(t(),l("div",Jo,[e("input",{ref_key:"slider",ref:d,value:o.value,onInput:r[0]||(r[0]=({target:m})=>o.value=parseFloat(m.value)),type:"range",min:n.min,max:n.max,step:n.step,class:"slider",style:Q(p(i)?"top:-5px":""),onChange:v},null,44,ea)]))}});const sa=U(ta,[["__scopeId","data-v-43f680ec"]]),oa={class:"p-2"},aa={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},la={class:"border mb-1 p-1"},na={class:"me"},ia={key:0},ra={key:1},ua={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},da={class:"d-flex center justify-content-center"},pa={key:1,class:"bi bi-arrow-down text-secondary"},ca={key:3,class:"bi bi-arrow-up text-secondary"},ma={class:"border mb-1 p-1"},va={class:"me"},ga={key:0},fa={key:1},_a={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},le=5,ya=O({__name:"HistoryDropdown",emits:[],setup(k,{emit:c}){const s=K(),a=M(!1),o=G(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),d=G(()=>[...s.history.undo].reverse().slice(0,le)),u=G(()=>s.history.redo.slice(Math.max(s.history.redo.length-le,0)));return q(()=>s.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(b,v)=>d.value.length||u.value.length?(t(),C(J,{key:0},{button:h(()=>[y(z,{message:"dropdown.history.info"},{default:h(()=>[e("div",{class:"d-flex sb flash",style:Q([{"font-size":"14px"},o.value])},[v[2]||(v[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(b.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:h(()=>[e("div",oa,[p(s).history.redo.length>le?(t(),l("div",aa," + "+x(p(s).history.redo.length-le),1)):g("",!0),(t(!0),l(T,null,B(u.value,i=>(t(),l("div",la,[e("span",na,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[3]||(v[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),l("span",ia,x(i.tags)+" "+x(b.$t("dropdown.history.tags")),1)):g("",!0),i.values?(t(),l("span",ra,x(i.values)+" "+x(b.$t("dropdown.history.values")),1)):g("",!0)]))),256)),e("div",ua,[e("div",da,[d.value.length?(t(),C(z,{key:0,message:"dropdown.history.undo"},{default:h(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:v[0]||(v[0]=(...i)=>p(s).undo&&p(s).undo(...i))})]),_:1})):(t(),l("div",pa)),v[4]||(v[4]=e("div",{style:{width:"30px"}},null,-1)),u.value.length?(t(),C(z,{key:2,message:"dropdown.history.redo"},{default:h(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:v[1]||(v[1]=(...i)=>p(s).redo&&p(s).redo(...i))})]),_:1})):(t(),l("div",ca))])]),(t(!0),l(T,null,B(d.value,i=>(t(),l("div",ma,[e("span",va,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[5]||(v[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),l("span",ga,x(i.tags)+" "+x(b.$t("dropdown.history.tags")),1)):g("",!0),i.values?(t(),l("span",fa,x(i.values)+" "+x(b.$t("dropdown.history.values")),1)):g("",!0)]))),256)),p(s).history.undo.length>le?(t(),l("div",_a," + "+x(p(s).history.undo.length-le),1)):g("",!0)])]),_:1})):g("",!0)}});const ba=U(ya,[["__scopeId","data-v-b5086318"]]),ha=O({__name:"ToggleReload",props:{tab:{}},emits:[],setup(k,{emit:c}){ie();const s=k,a=G(()=>s.tab.collection.state.autoReload?2:s.tab.collection.isDirty?0:1);function o(){a.value==0?s.tab.collection.update():a.value==1?s.tab.collection.setAutoReload(!0):s.tab.collection.setAutoReload(!1)}return(d,u)=>(t(),l("div",{class:"bb font",onClick:o,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(t(),C(z,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:h(()=>u[0]||(u[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):g("",!0),a.value==1?(t(),C(z,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:h(()=>u[1]||(u[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):g("",!0),a.value==2?(t(),C(z,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:h(()=>u[2]||(u[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):g("",!0)]))}});const ka=U(ha,[["__scopeId","data-v-088d77b5"]]),xa={class:"d-flex flex-row p-2"},$a=["placeholder"],wa={class:"me-5 d-flex"},Sa={class:"ms-5",style:{"font-size":"13px"}},Ca=["checked"],Va={class:"ms-1"},Ia={class:"ms-4"},Ma={class:"d-flex flex-wrap content-container ps-2"},za=O({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(k,{emit:c}){const s=k,a=M(""),o=G(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),d=G(()=>o.value.length);function u(n){const r=n.target.checked;s.tab.collection.groupManager.setSha1Mode(r,!0)}function b(){a.value=s.tab.state.filterState.query}function v(){s.tab.collection.filterManager.setQuery(a.value),s.tab.collection.filterManager.update(!0)}function i(){s.tab.collection.filterManager.setQuery(""),s.tab.collection.filterManager.update(!0)}return Z(b),q(()=>s.tab.collection.filterManager.state.query,b),(n,r)=>(t(),l(T,null,[e("div",xa,[y(z,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:h(()=>[e("div",{class:H(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[r[6]||(r[6]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ue(e("input",{type:"text",class:"input-hidden",placeholder:n.$t("main.menu.search"),"onUpdate:modelValue":r[0]||(r[0]=m=>a.value=m),onChange:v},null,40,$a),[[fe,a.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:i},"x")],2)]),_:1}),e("div",wa,[y(z,{message:"main.menu.grid_tooltip"},{default:h(()=>[e("i",{class:H("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:r[1]||(r[1]=m=>s.tab.setViewMode("tree"))},null,2)]),_:1}),y(z,{message:"main.menu.table_tooltip"},{default:h(()=>[e("i",{id:"toot",class:H("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:r[2]||(r[2]=m=>s.tab.setViewMode("grid"))},null,2)]),_:1}),y(z,{message:"main.menu.graph_tooltip"},{default:h(()=>[e("i",{id:"toot",class:H("bi bi-bar-chart btn-icon"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:r[3]||(r[3]=m=>s.tab.setViewMode("graph"))},null,2)]),_:1})]),y(z,{message:"main.menu.image_size_tooltip",click:!1},{default:h(()=>r[7]||(r[7]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[y(sa,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":r[4]||(r[4]=m=>s.tab.state.imageSize=m)},null,8,["modelValue"])]),e("div",Sa,[y(z,{message:"main.menu.image_mode_tooltip"},{default:h(()=>[e("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:u},null,40,Ca),e("span",Va,x(n.$t("main.menu.image_mode")),1)]),_:1})]),e("div",Ia,[y(ba)]),d.value?(t(),C(at,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":o.value,"onRemove:selected":r[5]||(r[5]=m=>s.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):g("",!0),r[9]||(r[9]=e("div",{class:"flex-grow-1"},null,-1)),y(z,{message:"main.menu.issue",class:"bb"},{default:h(()=>r[8]||(r[8]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",Ma,[y(ka,{tab:s.tab,class:"me-1"},null,8,["tab"]),y(vo,{manager:s.tab.collection.filterManager},null,8,["manager"]),y(Bo,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),y(Zo,{manager:s.tab.collection.sortManager},null,8,["manager"])])],64))}});const Fa=U(za,[["__scopeId","data-v-74a54709"]]),Ga={class:""},Ta={class:"d-flex flex-row"},Pa=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(k,{emit:c}){const s=re(),a=k,o=c,d=G(()=>`width: ${a.size}px; height: ${a.size}px;`);G(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`);const u=G(()=>a.pile.images[0]);return(b,v)=>(t(),l("div",Ga,[y(nt,{image:u.value},{default:h(()=>[e("div",{style:Q(d.value),class:"img-container",onClick:v[0]||(v[0]=i=>p(s).showModal(p(te).IMAGE,{image:u.value}))},[y(lt,{image:u.value,width:a.size-2,height:a.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Ta,[y(z,{message:"main.recommand.accept"},{default:h(()=>[e("div",{style:Q(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:v[1]||(v[1]=i=>o("accept",u.value))}," ✓ ",4)]),_:1}),y(z,{message:"main.recommand.refuse"},{default:h(()=>[e("div",{style:Q(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:v[2]||(v[2]=i=>o("refuse",u.value))}," ✕ ",4)]),_:1})])]))}});const Ea=U(Pa,[["__scopeId","data-v-809d667b"]]),Oa={class:"reco-container"},La={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Da={key:0,class:"bi bi-funnel-fill bb text-primary"},Ra={key:1,class:"bi bi-funnel bb"},Aa={class:"text-secondary me-2"},Ua={style:{"padding-top":"2px"},class:"me-1"},ja={class:"flex-grow-1"},Ba={class:"d-flex flex-row"},Na={key:0,class:"separator"},Ha={class:"d-flex flex-row"},ye=10,Wa=O({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(k,{emit:c}){const s=ie(),a=K(),o=it(),d=k,u=c,b=M(1),v=me([]),i=M(null),n=me([]),r=me(new Set),m=M(!0);function _(w){const f=i.value;f.isSha1Group?f.images=f.images.filter(P=>P.sha1!=w.sha1):f.images=f.images.filter(P=>P.id!=w.id),i.value=f,A()}async function S(w){const f=[],P=[];n.forEach(N=>{if(N.value!=null){const D=a.properties[N.propertyId];let E=N.value;D.type==W.multi_tags?(E=w.properties[N.propertyId]??[],E=[...E,N.value]):D.type==W.tag&&(E=[E]),D.mode==he.id?P.push({instanceId:w.id,propertyId:D.id,value:E}):f.push({propertyId:D.id,sha1:w.sha1,value:E})}}),await a.setPropertyValues(P,f),_(w)}function R(w){i.value.isSha1Group?i.value.images.filter(f=>f.sha1==w.sha1).forEach(f=>r.add(f.id)):r.add(w.id),_(w)}function A(){v.length=0;let w=[];const f=i.value.images;if(i.value.isSha1Group){const P={},N=Array.from(new Set(f.map(D=>D.sha1)));N.forEach(D=>P[D]=[]),f.forEach(D=>P[D.sha1].push(D)),N.forEach(D=>w.push({sha1:D,images:a.sha1Index[D]}))}else f.forEach(P=>w.push({sha1:P.sha1,images:[P]}));V(w,v,b.value,d.imageSize,d.width)}function V(w,f,P,N,D){let E=D,I=[],L=0;for(let oe=0;oe<w.length&&!(f.length>=P);oe++){let se=w[oe];if(se.images=se.images.filter(De=>!r.has(De.id)),se.images.length==0)continue;let pe=N+ye;if(L+pe<E){I.push(se),L+=pe;continue}if(I.length==0)throw new Error("Images seems to be to big for the line");f.push(I),f.length<P&&(I=[se],L=pe)}I.length>0&&f.length<P&&f.push(I)}async function $(){if(!d.group||!o.hasSimilaryFunction)return;const w=o.defaultActions.similar,f=o.getContext(w);f.instanceIds=d.group.images.map(I=>I.id);const P=await o.getSimilarImages(f);if(!P)return;if(!P.groups)throw new Error("No instances in ActionResult");let D=dt(P.groups)[0];if(m.value){const I=new Set(s.getTabManager().collection.filterManager.result.images.map(L=>L.id));D.images=D.images.filter(L=>I.has(L.id))}D.scores&&pt(D),i.value=D,n.length=0;let E=d.group;for(;E;)n.push(...E.meta.propertyValues),E=E.parent;r.clear(),A(),u("update")}function F(){m.value=!m.value}return Z($),q(()=>d.group,()=>{$(),r.clear()}),q(()=>d.imageSize,A),q(()=>d.width,A),q(m,$),(w,f)=>(t(),l("div",Oa,[e("div",La,[y(z,{message:"main.recommand.close"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:f[0]||(f[0]=P=>u("close"))},f[2]||(f[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),f[4]||(f[4]=e("div",{class:"b-left pe-1"},null,-1)),y(z,{message:"main.recommand.scroll"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:f[1]||(f[1]=P=>u("scroll",d.group.id))},f[3]||(f[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),f[5]||(f[5]=e("div",{class:"b-left pe-1"},null,-1)),y(z,{message:"main.recommand.filter"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:F},[m.value?(t(),l("span",Da)):(t(),l("span",Ra))])]),_:1}),f[6]||(f[6]=e("div",{class:"b-left pe-1"},null,-1)),y(z,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:h(()=>[e("span",Aa,x(w.$t("main.recommand.title")),1)]),_:1}),e("div",Ua,[y(rt,{action:"similar",onChanged:$})]),e("div",ja,[e("div",Ba,[(t(!0),l(T,null,B(n,(P,N)=>(t(),l(T,null,[y(ut,{class:"",value:P},null,8,["value"]),N<n.length-1?(t(),l("div",Na)):g("",!0)],64))),256))])])]),e("div",{style:Q("margin-left:"+ye+"px;")},[(t(!0),l(T,null,B(v,P=>(t(),l("div",null,[e("div",Ha,[(t(!0),l(T,null,B(P,N=>(t(),C(Ea,{pile:N,size:d.imageSize,onAccept:S,onRefuse:R,style:Q("margin-right:"+ye+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const qa=U(Wa,[["__scopeId","data-v-8ee891c6"]]);const Ka={style:{display:"flex"}},Qa={class:"info"},Ya={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:W},height:String},setup(k){const c=k,s=M(0),a=M(!1),o={};Object.keys(c.chartData.series).forEach(r=>{o[r]=!1});const d=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:c.chartData.dataType===W.date?"datetime":"numeric",categories:c.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:r,seriesIndex:m,dataPointIndex:_,w:S}){const R=c.chartData.series[m].data[_];let A='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';R.images.forEach(($,F)=>{F<10&&(A+=`<div style="width: 75px; height: 75px;"><img src="${$}" style="width: 100%; height: 100%;" /></div>`)}),A+="</div>";let V=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${c.chartData.series[m].name} — </b> ${R.y} Images</span>`;return V+=`<div>${A}</div>`,V}}}),u=()=>{d.value.chart.stacked=!d.value.chart.stacked,a.value=!a.value,s.value+=1},b=()=>{let r;d.value.chart.type==="area"?r={chart:{...d.value.chart,type:"bar"}}:r={chart:{...d.value.chart,type:"area"}},d.value={...d.value,...r},s.value+=1},v=(r,m,_)=>{const R=c.chartData.series[m];let A=Math.max(...R.data.map(V=>V.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(V=>V.remove()),o[m]){o[m]=!1;return}R.data.forEach((V,$)=>{const w=Math.floor(V.y/A*17),f=V.images.slice(0,w),P=`circle[index="${m}"][j="${$}"]`,N=document.querySelector(P),D=parseFloat(N.getAttribute("cx"));f.forEach((E,I)=>{const L=document.createElement("img");L.src=E,L.width=40,L.height=40,L.style.position="absolute";let oe=D+40/1.5,se=65+I*40;L.style.left=`${oe}px`,L.style.bottom=`${se}px`,L.classList.add("apexcharts-custom-image"),L.addEventListener("mouseover",pe=>i(oe,se,E)),L.addEventListener("mouseout",n),r.el.appendChild(L)})}),Object.keys(o).forEach(V=>o[V]=!1),o[m]=!0};function i(r,m,_){const S=document.getElementById("zoomed-image");S.style.left=`${r+120*1.5}px`,S.src=_,S.style.bottom=`${m}px`,S.style.display="block"}function n(){const r=document.getElementById("zoomed-image");r.style.display="none"}return(r,m)=>{const _=Me("apexchart");return t(),l(T,null,[e("div",Ka,[e("button",{class:"mt-2",onClick:b},x(d.value.chart.type==="area"?r.$t("main.graph-view.histo"):r.$t("main.graph-view.curve")),1),c.chartData.series.length>1?(t(),l("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:u},x(a.value?r.$t("main.graph-view.over"):r.$t("main.graph-view.stack")),1)):g("",!0)]),(t(),C(_,{style:{position:"relative"},key:s.value,height:c.height,type:d.value.chart.type,options:d.value,series:c.chartData.series,onLegendClick:v},null,8,["height","type","options","series"])),e("i",Qa,x(r.$t("main.graph-view.info")),1),m[0]||(m[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Xa={key:1},Za=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(k,{emit:c}){const s=K(),a=k,o=M(""),d=M(b());function u(){const v=new Set;let i=a.collection.groupManager.getGroupIterator();for(;i;){const n=i.group;if(n.id===0||n.meta.propertyValues&&n.meta.propertyValues[0].value==null){i=i.nextGroup();continue}for(let r of n.children)v.add(r.meta.propertyValues[0].value);n.children.forEach(()=>i=i.nextGroup()),i=i.nextGroup()}return v}function b(){const v={};let i,n=a.collection.groupManager.state.groupBy;if(n.length===0){o.value="Choose at least one date or numeric value to group the images by";return}const r=s.properties[n[0]],m=r.type;if(n.length>2){o.value="Only max two levels of grouping are supported";return}else if(n.length===1)v[r.name]={name:r.name,data:[]};else if(i=Array.from(u()),i.length>20){o.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(m!==W.number&&m!==W.date){o.value="First level of grouping needs to be a date or a numeric property";return}let _=a.collection.groupManager.getGroupIterator();const S=[];for(;_;){const R=_.group;if(R.id===0||R.meta.propertyValues&&R.meta.propertyValues[0].value==null){_=_.nextGroup();continue}let A=R.meta.propertyValues[0];const V=m===W.date?new Date(A.value).getTime():A.value;if(S.push(V),r.name in v)v[r.name].data.push({x:V,y:R.images.length,images:R.images.slice(0,20).map($=>$.urlSmall)});else{const $=R.children.map(w=>w.meta.propertyValues[0].value),F=i.filter(w=>!$.includes(w));for(let w of R.children){const f=w.meta.propertyValues[0].value;if(v[f]===void 0){let P=f;f in s.tags&&(P=s.tags[f].value),v[f]={data:[],name:P}}v[w.meta.propertyValues[0].value].data.push({x:V,y:w.images.length,images:w.images.slice(0,20).map(P=>P.urlSmall)})}for(let w of F){if(v[w]===void 0){let f=w;w in s.tags&&(f=s.tags[w].value),v[w]={data:[],name:f}}v[w].data.push({x:V,y:0,images:[]})}R.children.forEach(()=>_=_.nextGroup())}_=_.nextGroup()}return o.value="",{series:Object.values(v),xValues:S,dataType:m}}return a.collection.groupManager.onResultChange.addListener(()=>d.value=b()),(v,i)=>(t(),l("div",{class:"",style:Q({height:a.height+"px"})},[o.value===""?(t(),C(Ya,{key:0,chartData:d.value,height:a.height-50+"px"},null,8,["chartData","height"])):(t(),l("span",Xa,x(o.value),1))],4))}}),Ja={key:0,class:"m-0 p-0"},el={key:0,style:{"margin-left":"10px"}},tl=O({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(k,{expose:c}){ie();const s=K(),a=k;c({updateScrollerWidth:A});const o=M({}),d=M(!0),u=M(null),b=M(null),v=M(null),i=M(0),n=M(0),r=me({groups:!1}),m=G(()=>a.tab.getVisibleProperties());function _(){u.value&&b.value?i.value=a.height-u.value.clientHeight-b.value.clientHeight-5:u.value?i.value=a.height-u.value.clientHeight-5:i.value=0}a.tab.collection.groupManager.onResultChange.addListener(()=>{v.value&&a.tab.state.display=="tree"&&v.value.computeLines()});function S(V){o.value=a.tab.collection.groupManager.result.index[V],Y(()=>_())}function R(){o.value={},Y(()=>_())}async function A(){var V;await Y(),n.value=((V=u.value)==null?void 0:V.clientWidth)??n.value}return Z(()=>{n.value=u.value.clientWidth,window.addEventListener("resize",A)}),Te(()=>{window.removeEventListener("resize",A)}),q(()=>a.tab.state.imageSize,()=>Y(_)),q(()=>a.filterOpen,()=>Y(_)),q(()=>a.height,async()=>{await Y(_)}),Z(_),Z(()=>a.tab.update()),(V,$)=>(t(),l(T,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:u},[a.filterOpen?(t(),C(Fa,{key:0,tab:a.tab,"compute-status":r},null,8,["tab","compute-status"])):g("",!0)],512),e("div",{ref_key:"boxElem",ref:b,class:"m-0 p-0"},[o.value.id?(t(),l("div",Ja,[y(qa,{group:o.value,"image-size":a.tab.state.imageSize,width:n.value,height:50,onClose:R,onScroll:v.value.scrollTo,onUpdate:$[0]||($[0]=F=>Y(()=>_()))},null,8,["group","image-size","width","onScroll"])])):g("",!0)],512),p(s).isLoaded&&n.value>0&&i.value>0&&d.value?(t(),l("div",el,[a.tab.state.display=="tree"?(t(),C(ct,{key:0,"group-manager":a.tab.collection.groupManager,"image-size":a.tab.state.imageSize,height:i.value-0,properties:m.value,"hide-if-modal":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,width:n.value-25,onRecommend:S},null,8,["group-manager","image-size","height","properties","selected-images","width"])):g("",!0),a.tab.state.display=="grid"?(t(),l("div",{key:1,style:Q({width:n.value-12+"px"}),class:"p-0 m-0 grid-container"},[y(mt,{tab:V.tab,manager:a.tab.collection.groupManager,height:i.value-15,width:n.value-40,"selected-properties":m.value,class:"p-0 m-0","show-images":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):g("",!0),a.tab.state.display=="graph"?(t(),C(Za,{key:2,collection:a.tab.collection,height:i.value-15},null,8,["collection","height"])):g("",!0)])):g("",!0)],64))}});const sl=U(tl,[["__scopeId","data-v-b43d153b"]]),ol=O({__name:"TabButton",props:{tab:{}},setup(k){const c=de(),s=M(""),a=M(null),o=M(!1),d=M(!1),u=k,b=G(()=>u.tab.state.id);function v(){c.selectMainTab(u.tab.state.id)}function i(){d.value=!0,s.value=u.tab.state.name,Y(()=>a.value.focus())}function n(){u.tab.renameTab(s.value),d.value=!1}async function r(){confirm("Are you sure to delete Tab: "+u.tab.state.name)&&c.deleteTab(u.tab.state.id)}return Z(()=>{u.tab.isNew&&i()}),(m,_)=>(t(),l("div",{class:"d-flex d-row me-2",onMouseenter:_[1]||(_[1]=S=>o.value=!0),onMouseleave:_[2]||(_[2]=S=>o.value=!1)},[d.value?(t(),l("div",{key:1,class:H(["tab-button",b.value==p(c).mainTab?" active":""])},[e("form",{onSubmit:ve(n,["stop","prevent"])},[ue(e("input",{onFocusout:n,onKeydown:vt(n,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":_[0]||(_[0]=S=>s.value=S),ref_key:"inputElem",ref:a},null,544),[[fe,s.value]])],32)],2)):(t(),l(T,{key:0},[y(z,{message:"main.menu.rename_tab_tooltip"},{default:h(()=>[e("i",{onClick:i,class:H(["bi bi-pencil me-1 tab-icon hover-light",o.value&&p(c).mainTab==b.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:H(["tab-button",b.value==p(c).mainTab?" active":""]),onClick:v},[e("span",null,x(u.tab.state.name),1)],2),y(z,{message:"main.menu.delete_tab_tooltip"},{default:h(()=>[e("i",{onClick:r,class:H(["btn-icon bi bi-x tab-icon hover-light",o.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}});const al={class:"d-flex d-row",style:{cursor:"pointer"}},ll={class:"pt-1"},nl={key:0,class:"bb bi bi-chevron-down"},il={key:1,class:"bb bi bi-chevron-right"},rl={style:{"padding-top":"2px","margin-right":"2px"}},ul={class:"lang"},dl=["value"],pl=O({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(k,{emit:c}){const s=re(),a=de(),o=k,d=c;async function u(i){await a.addTab("New Tab")}const b=["fr","en"];function v(){d("update:filterOpen",!o.filterOpen)}return(i,n)=>(t(),l("nav",null,[e("div",al,[e("div",ll,[e("span",{onClick:v},[o.filterOpen?(t(),l("i",nl)):(t(),l("i",il))])]),(t(!0),l(T,null,B(p(a).loadedTabs,r=>(t(),l("div",null,[y(ol,{tab:p(a).getTab(r)},null,8,["tab"])]))),256)),y(z,{message:"main.menu.add_tab_tooltip"},{default:h(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:u,id:"add-tab-button"},n[3]||(n[3]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),n[6]||(n[6]=e("div",{class:"flex-grow-1"},null,-1)),e("div",rl,[y(z,{message:"modals.notif.icon"},{default:h(()=>[e("span",{class:"bb",onClick:n[0]||(n[0]=r=>p(s).showModal(p(te).NOTIF))},n[4]||(n[4]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",ul,[n[5]||(n[5]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),ue(e("select",{"onUpdate:modelValue":n[1]||(n[1]=r=>i.$i18n.locale=r),onChange:n[2]||(n[2]=r=>o.reRender())},[(t(),l(T,null,B(b,(r,m)=>e("option",{key:`Lang${m}`,value:r},x(r.toUpperCase()),9,dl)),64))],544),[[gt,i.$i18n.locale]])])])]))}});const cl={key:0},ml={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},ne=O({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(k){const c=k;return(s,a)=>c.loading?(t(),l("div",cl,[s.loading?(t(),l("div",ml,a[0]||(a[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):g("",!0)])):g("",!0)}}),be=O({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(k){const c=k,s=G(()=>c.force?"100%":c.max==0?"0%":c.current>=c.max?"100%":Math.floor(c.current/c.max*100)+"%");return(a,o)=>(t(),l("span",null,x(s.value),1))}}),vl={key:0,class:"center"},gl={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},fl={class:"d-flex text-secondary"},_l={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},yl={class:"d-flex text-secondary",style:{"font-size":"14px"}},bl={key:0,class:"bi bi-check text-success"},hl={class:"d-flex text-secondary",style:{"font-size":"14px"}},kl={key:0,class:"bi bi-check text-success"},xl={class:"d-flex text-secondary",style:{"font-size":"14px"}},$l={key:0,class:"bi bi-check text-success"},wl={class:"d-flex text-secondary",style:{"font-size":"14px"}},Sl={key:0,class:"bi bi-check text-success"},Cl={class:"d-flex text-secondary",style:{"font-size":"14px"}},Vl={key:0,class:"bi bi-check text-success"},Il=O({__name:"DataLoad",setup(k){const c=K();return(s,a)=>p(c).loadState?(t(),l("div",vl,[e("div",gl,[e("div",null,[e("div",fl,[a[0]||(a[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedProperty},null,8,["loading"]),p(c).loadState.finishedProperty?(t(),l("i",_l)):g("",!0)]),e("div",yl,[a[1]||(a[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedPropertyGroups},null,8,["loading"]),p(c).loadState.finishedPropertyGroups?(t(),l("i",bl)):g("",!0)]),e("div",hl,[a[2]||(a[2]=e("div",{class:"me-1"},"Tags",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedTags},null,8,["loading"]),p(c).loadState.finishedTags?(t(),l("i",kl)):g("",!0)]),e("div",xl,[a[3]||(a[3]=e("div",{class:"me-1"},"Instances",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedInstance},null,8,["loading"]),p(c).loadState.finishedInstance?(t(),l("i",$l)):g("",!0),y(be,{current:p(c).loadState.counterInstance,max:p(c).loadState.maxInstance,force:p(c).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",wl,[a[4]||(a[4]=e("div",{class:"me-1"},"InstanceValues",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedInstanceValues},null,8,["loading"]),p(c).loadState.finishedInstanceValues?(t(),l("i",Sl)):g("",!0),y(be,{current:p(c).loadState.counterInstanceValue,max:p(c).loadState.maxInstanceValue,force:p(c).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",Cl,[a[5]||(a[5]=e("div",{class:"me-1"},"ImageValues",-1)),y(ne,{class:"me-2",loading:!p(c).loadState.finishedImageValues},null,8,["loading"]),p(c).loadState.finishedImageValues?(t(),l("i",Vl)):g("",!0),y(be,{current:p(c).loadState.counterImageValue,max:p(c).loadState.maxImageValue,force:p(c).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):g("",!0)}});const Ml=U(Il,[["__scopeId","data-v-8b416e86"]]),zl={key:0},Fl={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Gl={class:"w-100"},Tl={key:0,class:"custom-hr"},Pl={key:2,class:"loading"},El={class:"text-center"},Ol={key:3,class:"loading"},Ll=O({__name:"PanopticView",setup(k){const c=ie(),s=K(),a=re(),o=de(),d=M(null),u=M(null),b=M(window.innerHeight),v=M(!1),i=M(!0),n=M(!0),r=G(()=>{var F;return b.value-(((F=u.value)==null?void 0:F.clientHeight)??0)}),m=G(()=>{var F;return(F=d.value)==null?void 0:F.filteredImages.map(w=>w.id)});let _=navigator.userAgent.indexOf("Mac OS X")!==-1;async function S(){i.value=!1,await Y(),i.value=!0}Z(async()=>{a.isProjectLoaded||Ve.push("/"),Y(()=>{window.addEventListener("resize",R),R()}),window.addEventListener("keydown",F=>{F.key=="Control"&&(j.ctrl=!0),F.key=="Alt"&&(_&&(j.ctrl=!0),j.alt=!0),F.key=="Shift"&&(j.shift=!0),F.key=="ArrowLeft"&&(j.left=!0),F.key=="ArrowRight"&&(j.right=!0,console.log("keeeyy")),F.key=="Z"&&j.ctrl&&s.redo(),F.key=="z"&&j.ctrl&&s.undo()}),window.addEventListener("keyup",F=>{F.key=="Control"&&(j.ctrl=!1),F.key=="Alt"&&(_&&(j.ctrl=!1),j.alt=!1),F.key=="Shift"&&(j.shift=!1),F.key=="ArrowLeft"&&(j.left=!1),F.key=="ArrowRight"&&(j.right=!1)}),window.addEventListener("mousemove",F=>{j.ctrl=F.ctrlKey,j.alt=F.altKey,j.shift=F.shiftKey,_&&(j.ctrl=j.ctrl||j.alt)})}),Te(()=>{window.removeEventListener("resize",R)});function R(){b.value=window.innerHeight,v.value=!0}function A(){a.showModal(te.EXPORT,m)}function V(){Ve.push("/")}function $(){d.value&&d.value.updateScrollerWidth()}return(F,w)=>i.value?(t(),l("div",zl,[d.value&&!d.value.imageList?(t(),C(ft,{key:0,tutorial:"project"})):g("",!0),(t(),l("div",{id:"panoptic",key:p(c).status.renderNb},[e("div",Fl,[p(s).isLoaded?p(s).isLoaded?(t(),l(T,{key:1},[e("div",null,[y(zs,{onExport:w[0]||(w[0]=f=>A()),onToggle:$})]),e("div",Gl,[e("div",{class:"ms-1",ref_key:"navElem",ref:u},[y(pl,{"re-render":S,filterOpen:n.value,"onUpdate:filterOpen":w[1]||(w[1]=f=>n.value=f)},null,8,["filterOpen"])],512),v.value?(t(),l("div",Tl)):g("",!0),y(Pe,{id:p(o).mainTab},{default:h(({tab:f})=>[y(sl,{tab:f,height:r.value,ref_key:"mainViewRef",ref:d,"filter-open":n.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):p(a).isProjectLoaded?(t(),l("div",Ol,w[2]||(w[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(t(),l("div",Pl,[e("div",El,[e("div",null,x(F.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:V,style:{"font-size":"50px",cursor:"pointer"}})])])):(t(),l("div",{key:0,class:"d-flex flex-column w-100",style:Q({height:b.value+"px"})},[y(Ml,{class:"flex-grow-1"})],4))])]))])):g("",!0)}});const Al=U(Ll,[["__scopeId","data-v-6f796097"]]);export{Al as default};
