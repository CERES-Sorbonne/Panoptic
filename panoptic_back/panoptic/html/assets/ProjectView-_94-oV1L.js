import{d as H,B as X,k as U,D as ne,l as T,b as a,i as ie,t as O,C as Qt,o as f,E as Jt,r as V,c as F,a as w,f as Q,n as q,F as N,s as ee,h as R,G as pe,q as E,e as I,H as It,I as Ue,J as dt,_ as j,K as fe,m as oe,L as W,N as Ct,j as re,O as Le,u as be,Q as ke,R as Ce,w as Ae,v as Oe,S as ze,M as le,y as G,T as se,U as tt,V as at,W as es,X as me,Y as Pt,Z as ts,g as st,$ as ct,a0 as ss,a1 as os,a2 as as,a3 as is,a4 as ns,a5 as rs,a6 as ls,a7 as us,a8 as ds,a9 as cs,aa as zt,ab as Ve,ac as Et,ad as ps,ae as Y,af as it,ag as Rt,ah as hs,ai as Tt,aj as vs,ak as he,al as de,am as fs,an as ms,ao as Lt,ap as gs,aq as At,ar as Ot,as as Vt,at as Pe,A as $e,au as ys,av as bs,aw as _s,ax as Ft,ay as xs,az as ws,aA as ks,aB as Ut,aC as pt,aD as ht,aE as $s,aF as Ms,aG as Ss,aH as Is,aI as Cs,aJ as Ps,aK as zs,p as vt}from"./index-B18Wh5Nh.js";import{V as Es,c as Ee,M as nt,a as Re,G as Rs,T as Dt,d as rt,D as Bt,e as Gt,P as Ht,f as Ts,I as Ls,g as ge,L as As,B as De,h as Os,i as Vs,j as Fs,k as Us,l as Ds,m as ft,S as Bs,O as Gs,W as Hs}from"./three.module-Cl0ZyOCO.js";import{_ as Ns}from"./Tutorial.vue_vue_type_style_index_0_lang-CLj--Q7F.js";const Zs={class:"text-nowrap"},Ws=["onClick"],qs=["onClick"],Ys=H({__name:"FolderOptionDropdown",props:{folder:{}},setup(S){const t=X(),e=S;function o(){t.reImportFolder(e.folder.id)}function s(){confirm(Qt.global.t("main.nav.folders.del_alert"))&&t.deleteFolder(e.folder.id)}return(l,v)=>(f(),U(ne,{teleport:!0},{button:T(()=>v[0]||(v[0]=[a("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:T(({hide:h})=>[a("div",Zs,[a("div",{class:"p-2 bb",onClick:p=>{o(),h()}},v[1]||(v[1]=[a("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ie("Re import")]),8,Ws),v[3]||(v[3]=a("div",{class:"custom-hr"},null,-1)),a("div",{class:"bb p-2",onClick:p=>{s(),h()}},[v[2]||(v[2]=a("i",{class:"bi bi-trash me-1"},null,-1)),ie(O(l.$t("main.nav.folders.del")),1)],8,qs)])]),_:1}))}}),Xs=["onMouseenter"],js=["onClick"],Ks={class:"text-secondary"},Qs=["onClick"],Js=H({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Jt,root:{type:Boolean,default:!0},tab:Object},setup(S){const t=X(),e=S,o=V(null),s=F(()=>{let i={};const d=new Set(e.filterManager.state.folders);return e.folders.map(c=>c.id).forEach(c=>{d.has(c)&&(i[c]=!0)}),i}),l=F(()=>{let i={};return e.folders.map(d=>d.id).forEach(d=>{e.visibleFolders[d]&&(i[d]=!0)}),i}),v=F(()=>{let i={};return e.folders.forEach(d=>{let c=[];s.value[d.id]&&c.push("selected"),i[d.id]=c.join(" ")}),i});function h(i){let d=e.visibleFolders;d[i]?delete d[i]:d[i]=!0}function p(i){let d=new Set(e.filterManager.state.folders);const c=d.has(i),x=t.folders[i].parent!=null&&d.has(t.folders[i].parent);c&&!x?(d.delete(i),Ue(i).forEach($=>d.delete($.id))):(n(i,d),d.add(i),Ue(i).forEach($=>d.add($.id)),dt(t.folders[i]).forEach($=>d.delete($.id))),e.filterManager.setFolders(Array.from(d)),e.tab.setSelectedFolder(d),e.filterManager.update(!0)}function n(i,d){const c=dt(t.folders[i]);let x;for(let $ of c)if(d.has($.id))x=$;else break;x!=null&&Ue(x.id).forEach($=>d.delete($.id))}return(i,d)=>{const c=It("FolderList2",!0);return f(),w("ul",{class:q(e.root?"tree":""),style:Q(e.root?"padding-left:0px;":"")},[(f(!0),w(N,null,ee(S.folders,x=>(f(),w("li",{style:Q(e.root?"padding-left:0px;":""),class:"no-break"},[a("div",{style:{display:"inline"},onMouseenter:$=>o.value=x.id,onMouseleave:d[1]||(d[1]=$=>o.value=null)},[a("summary",{class:q(v.value[x.id]),onClick:$=>p(x.id)},[a("span",{class:q(o.value===x.id?"visible-option":"invisible-option"),onClick:d[0]||(d[0]=pe(()=>{},["stop"]))},[E(Ys,{folder:x},null,8,["folder"])],2),ie(" "+O(x.name)+" ",1),a("span",Ks,O(I(t).folders[x.id].count),1)],10,js)],40,Xs),x.children&&x.children.length>0?(f(),w("i",{key:0,onClick:$=>h(x.id),class:q("bi bi-chevron-"+(l.value[x.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Qs)):R("",!0),x.children&&x.children.length>0&&l.value[x.id]?(f(),U(c,{key:1,folders:x.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager,tab:e.tab},null,8,["folders","visible-folders","filter-manager","tab"])):R("",!0)],4))),256))],6)}}}),eo=j(Js,[["__scopeId","data-v-08c57041"]]),to={class:"text-center"},so={class:"w-100 text-center",style:{"font-size":"10px"}},oo={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},ao=H({__name:"TaskStatus",props:{task:{}},setup(S){const t=S,e=F(()=>t.task.total-t.task.remain-t.task.computing),o=F(()=>t.task.total);return(s,l)=>(f(),w("div",to,[ie(O(t.task.name)+" ",1),a("div",so,O(e.value)+" / "+O(o.value)+" "+O(s.$t("main.nav.tasks.done")),1),o.value>0?(f(),w("div",oo,[a("div",{class:"progress-bar",style:Q(`width: ${e.value/o.value*100}%`)},null,4)])):R("",!0)]))}}),Nt=H({__name:"TabContainer",props:{id:{}},setup(S){const t=fe(),e=S;let o;const s=V(!1);function l(){o=t.getTab(e.id),s.value=!0}return oe(l),W(()=>e.id,async()=>{s.value=!1,await re(),l()}),(v,h)=>s.value&&I(t).loaded?Ct(v.$slots,"default",{key:0,tab:I(o)}):R("",!0)}}),Te={},io={class:"d-flex flex-row"},no={key:2,class:"d-flex",style:{width:"150px"}},ro={class:"flex-grow-1"},lo={key:1,style:{"padding-top":"1px"}},uo={class:"text-center",style:{width:"24px","margin-top":"2px"}},co={style:{width:"20px","margin-top":"2px","flex-shrink":"0"},class:"text-center"},po={key:0},ho={key:0,class:"ms-3 pt-1"},vo={key:1},fo=H({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(S){const{t}=Le({useScope:"global"}),e=be();ke();const o=X(),s=S,l=V(!1),v=V(!1),h=V(""),p=V(!1),n=F(()=>s.tab.state.visibleProperties[s.property.id]==!0),i=F(()=>s.tab.collection.filterManager.state.filter.filters.some(b=>!b.isGroup&&b.propertyId==s.property.id)),d=F(()=>s.tab.collection.groupManager.state.groupBy.includes(s.property.id)),c=F(()=>s.tab.collection.sortManager.state.sortBy.includes(s.property.id)),x=F(()=>{if(i.value)return s.tab.collection.filterManager.state.filter.filters.find(b=>!b.isGroup&&b.propertyId==s.property.id).id}),$=()=>s.tab.collection.filterManager,P=F(()=>s.tab.getSha1Mode());function M(){n.value?s.tab.setVisibleProperty(s.property.id,!1):s.tab.setVisibleProperty(s.property.id,!0)}function C(){s.open&&(l.value?l.value=!1:(l.value=!0,h.value=s.property.name),v.value=!1)}function z(){s.property.type!=se.tag&&s.property.type!=se.multi_tags||(v.value?v.value=!1:v.value=!0,l.value=!1)}function r(){c.value?s.tab.collection.sortManager.delSort(s.property.id):s.tab.collection.sortManager.setSort(s.property.id),s.tab.collection.sortManager.update(!0)}function u(){d.value?s.tab.collection.groupManager.delGroupOption(s.property.id):s.tab.collection.groupManager.setGroupOption(s.property.id),s.tab.collection.groupManager.update(!0)}function m(){confirm(t("common.properties.delete")+": "+s.property.name+" ?   "+s.property.id)&&o.deleteProperty(s.property.id)}async function L(){h.value!=""&&(await o.updateProperty(s.property.id,h.value),C())}function A(){const b=$();i.value?(b.deleteFilter(x.value),Te.filter.hide()):(b.addNewFilter(s.property.id),Te.filter.show())}return W(()=>s.property,()=>{l.value=!1}),(b,_)=>(f(),w("div",{class:q(p.value?"hover-light":"")},[a("div",io,[s.open?(f(),w(N,{key:0},[l.value?R("",!0):(f(),w("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:C},[E(Ce,{type:s.property.type,class:"me-2 btn-icon",onMouseenter:_[0]||(_[0]=g=>p.value=!0),onMouseleave:_[1]||(_[1]=g=>p.value=!1)},null,8,["type"]),a("span",null,O(s.property.name),1)]))],64)):(f(),U(Ce,{key:1,type:s.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),l.value&&s.open?(f(),w("div",no,[a("div",null,[a("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:C,onMouseenter:_[2]||(_[2]=g=>p.value=!0),onMouseleave:_[3]||(_[3]=g=>p.value=!1)},null,32)]),a("div",ro,[s.property.id>=0?Ae((f(),w("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":_[4]||(_[4]=g=>h.value=g),onChange:L},null,544)),[[Oe,h.value]]):(f(),w("span",lo,[E(Ce,{type:s.property.type,class:"me-2 btn-icon"},null,8,["type"]),a("span",null,O(s.property.name),1)]))])])):R("",!0),s.open?(f(),w(N,{key:3},[I(ze)(s.property.type)?(f(),w("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:_[5]||(_[5]=g=>I(e).showModal(I(le).TAG,{propId:s.property.id}))},[E(G,{click:!1,message:"main.nav.properties.open_tags"},{default:T(()=>_[7]||(_[7]=[a("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):R("",!0)],64)):R("",!0),s.open?(f(),w(N,{key:4},[a("div",uo,[s.property.type==I(se).tag||s.property.type==I(se).multi_tags?(f(),w("div",{key:0,onClick:z,style:{cursor:"pointer"}},[v.value?(f(),U(G,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:T(()=>_[8]||(_[8]=[a("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(f(),U(G,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:T(()=>_[9]||(_[9]=[a("i",{class:"bi bi-chevron-right ms-1"},null,-1)])),_:1}))])):R("",!0)]),a("div",co,[s.property.mode==I(tt).id?(f(),U(G,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:T(()=>_[10]||(_[10]=[a("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):R("",!0)])],64)):R("",!0),a("div",{style:{width:"20px","margin-top":"2px","flex-shrink":"0"},onClick:M,class:"btn-icon text-center"},[P.value&&s.property.mode==I(tt).id?(f(),U(G,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:T(()=>[a("span",{class:"bi bi-eye-slash",onClick:_[6]||(_[6]=pe(()=>{},["stop"]))})]),_:1})):(f(),U(G,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:T(()=>[a("span",{class:q("bi bi-eye text-"+(n.value?"primary":"secondary"))},null,2)]),_:1}))])]),s.open?(f(),w("div",po,[l.value?(f(),w("div",ho,[b.property.id!=I(at).folders?(f(),w("div",{key:0,class:q(["options hover-light",i.value?" text-primary":""]),onClick:A},[a("div",null,[_[11]||(_[11]=a("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ie(O(b.$t("main.menu.filters")),1)])],2)):R("",!0),a("div",{class:q(["options hover-light",c.value?" text-primary":""]),onClick:r},[_[12]||(_[12]=a("i",{class:"bi bi-filter me-2"},null,-1)),ie(O(b.$t("main.menu.sort.title")),1)],2),a("div",{class:q(["options hover-light",d.value?" text-primary":""]),onClick:u},[_[13]||(_[13]=a("i",{class:"bi bi-collection me-2"},null,-1)),ie(O(b.$t("main.menu.groupby")),1)],2),s.property.id>=0?(f(),w("div",{key:1,class:"options hover-light",onClick:m},[_[14]||(_[14]=a("i",{class:"bi bi-trash me-2"},null,-1)),ie(O(b.$t("main.nav.properties.delete_property")),1)])):R("",!0)])):v.value?(f(),w("div",vo,[E(es,{property:s.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):R("",!0)])):R("",!0)],2))}}),mo=j(fo,[["__scopeId","data-v-878a3d2a"]]),go={key:0,class:"prop-container"},yo={key:0},bo={key:1},_o={key:0,class:"ms-2 text-capitalize overflow-hidden"},xo={key:1,class:"ms-2"},wo={class:"p-1"},ko=["onClick"],$o=["onClick"],Mo={key:0,class:"ps-1 pe-1"},So={class:"property-item"},Io=H({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(S){const t=X(),e=be(),o=S,s=V(!0),l=V(!1),v=V(""),h=F(()=>o.node.propertyIds.map(z=>t.properties[z])),p=F(()=>o.node.propertyIds.map(z=>o.tab.isVisibleProperty(z)).filter(z=>!z).length==0),n=F(()=>{if(o.node.groupId>=0)return t.propertyGroups[o.node.groupId];if(o.node.groupId==me.DEFAULT)return{id:me.DEFAULT,name:"default"};if(o.node.groupId==me.COMPUTED)return{id:me.COMPUTED,name:"computed"}}),i=F(()=>n.value.id>=0);function d(){s.value=!s.value}function c(z){t.updatePropertyGroup(n.value.id,v.value)}function x(){v.value=n.value.name}function $(){t.deletePropertyGroup(n.value.id)}async function P(){const r={emptyProperties:t.propertyList.filter(m=>m.propertyGroupId==o.node.groupId).map(m=>m.id)};await t.sendCommit(r);const u={emptyPropertyGroups:[o.node.groupId]};await t.sendCommit(u)}async function M(z){if(z.added){let r=z.added.element;const u=t.properties[r];let m=o.node.groupId;m<0&&(m=null),await t.updateProperty(u.id,u.name,m),await t.triggerPropertyTreeChange()}z.moved&&await t.triggerPropertyTreeChange()}function C(){p.value?o.tab.setVisibleProperties(o.node.propertyIds,!1):o.tab.setVisibleProperties(o.node.propertyIds,!0)}return oe(x),W(o,x),(z,r)=>I(t).propertyGroups[o.node.groupId]||o.node.groupId<0?(f(),w("div",go,[E(I(Pt),{list:o.node.propertyIds,"item-key":u=>u,group:o.node.groupId>0||o.node.groupId==I(me).DEFAULT?"properties":void 0,onChange:M},{header:T(()=>[a("div",{class:"d-flex group-container",onClick:d},[s.value?(f(),w("div",yo,r[4]||(r[4]=[a("i",{class:"bi bi-caret-down-fill"},null,-1)]))):R("",!0),s.value?R("",!0):(f(),w("div",bo,r[5]||(r[5]=[a("i",{class:"bi bi-caret-right-fill"},null,-1)]))),o.menuOpen?(f(),w(N,{key:2},[l.value?R("",!0):(f(),w("div",_o,O(n.value.name),1)),l.value?(f(),w("div",xo,[E(ts,{"auto-focus":!0,modelValue:v.value,"onUpdate:modelValue":r[0]||(r[0]=u=>v.value=u),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:c,onCancel:x,onBlur:r[1]||(r[1]=u=>l.value=!1)},null,8,["modelValue"])])):R("",!0),r[8]||(r[8]=a("div",{class:"flex-grow-1"},null,-1)),o.node.groupId>=I(me).DEFAULT?(f(),U(ne,{key:2,onClick:r[2]||(r[2]=pe(()=>{},["prevent","stop"]))},{button:T(()=>r[6]||(r[6]=[a("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:T(({hide:u})=>[a("div",wo,[i.value?(f(),w(N,{key:0},[a("div",{class:"bb",onClick:m=>{l.value=!0,u()}},O(z.$t("main.menu.editName")),9,ko),a("div",{class:"bb",onClick:$},O(z.$t("main.menu.removeGroup")),1)],64)):R("",!0),a("div",{class:"bb",onClick:m=>{P(),u()}},O(z.$t("main.menu.deleteGroupAndProperties")),9,$o)])]),_:1})):R("",!0),o.node.groupId>=-1?(f(),w("div",{key:3,class:"bb me-1",onClick:r[3]||(r[3]=pe(u=>I(e).showModal(I(le).PROPERTY,{group:o.node.groupId}),["stop","prevent"]))},[E(G,{message:z.$t("main.menu.addNewPropertyToGroup")},{default:T(()=>r[7]||(r[7]=[a("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):R("",!0)],64)):R("",!0),o.node.propertyIds.length?(f(),w("div",{key:3,style:{cursor:"pointer","flex-shrink":"0","margin-right":"11px"},onClick:pe(C,["stop"])},[a("span",{class:q("bi bi-eye text-"+(p.value?"primary":"secondary"))},null,2)])):R("",!0)])]),item:T(({element:u,index:m})=>[s.value&&h.value.length&&I(t).properties[u]?(f(),w("div",Mo,[a("div",So,[E(mo,{tab:o.tab,property:I(t).properties[u],open:o.menuOpen},null,8,["tab","property","open"])])])):R("",!0)]),_:1},8,["list","item-key","group"])])):R("",!0)}}),Be=j(Io,[["__scopeId","data-v-f64e1371"]]),Co={key:0,class:"mb-1"},Po=H({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(S,{emit:t}){const e=X(),o=S;function s(l){e.triggerPropertyTreeChange()}return(l,v)=>(f(),U(I(Pt),{list:I(e).propertyTree,onChange:s,"item-key":h=>h.groupId},{item:T(({element:h})=>[h.groupId>=0?(f(),w("div",Co,[E(Be,{tab:o.tab,node:h,"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])])):R("",!0)]),footer:T(()=>[E(Be,{class:"mb-1",tab:o.tab,node:I(e).propertyTree[I(e).propertyTree.length-2],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"]),E(Be,{class:"mb-1",tab:o.tab,node:I(e).propertyTree[I(e).propertyTree.length-1],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),zo={class:""},Eo={class:"m-0",style:{padding:"4px 0px 4px 8px"}},Ro={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},To={class:"flex-grow-1 text-capitalize overflow-hidden"},Lo={key:0,class:"bi bi-chevron-left"},Ao={key:1,class:"bi bi-chevron-right"},Oo={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},Vo={class:"d-flex align-items-center"},Fo={style:{"max-height":"300px",overflow:"auto"}},Uo={key:0,id:"import"},Do={class:"pt-1 pb-2"},Bo={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},Go={key:0,class:"ps-2 pe-2"},Ho={class:"p-1"},No={key:0,class:"custom-hr"},Zo={class:"p-1 mt-0"},Wo={key:0,class:"d-flex p-1"},qo={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Yo={key:1,class:"bb me-1"},Xo={class:"bb me-2"},jo={key:1,class:"mt-2"},Ko=200,Qo=55,Jo=H({__name:"Menu",emits:["export","toggle"],setup(S,{emit:t}){const e=ke(),o=X(),s=be(),l=fe(),v=t,h=V(!1),p=V(!0),n=F(()=>p.value?Ko:Qo),i=async()=>{s.showModal(le.IMPORT)},d=F(()=>e.state.tasks.filter(P=>!P.done)??[]);function c(){s.showModal(le.FOLDERSELECTION,{callback:x,mode:"images"})}function x(P){P&&o.addFolder(P)}function $(){p.value=!p.value,v("toggle")}return(P,M)=>(f(),U(Nt,{id:I(l).mainTab},{default:T(({tab:C})=>[a("div",{class:"menu overflow-scroll",style:Q({width:n.value+"px"})},[a("div",zo,[a("div",null,[a("div",Eo,[a("div",Ro,[p.value?(f(),w(N,{key:0},[a("div",To,O(I(e).state.name),1),E(G,{message:"main.menu.close_project"},{default:T(()=>[a("div",{class:"base-hover p-1",onClick:M[0]||(M[0]=z=>I(s).closeProject(I(e).state.id))},M[6]||(M[6]=[a("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),a("div",{class:"base-hover p-1",onClick:M[1]||(M[1]=z=>I(s).showModal(I(le).SETTINGS))},M[7]||(M[7]=[a("i",{class:"bi bi-gear"},null,-1)]))],64)):R("",!0),a("div",{class:q(["base-hover p-1",p.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:$},[p.value?(f(),w("i",Lo)):(f(),w("i",Ao))],2)])]),p.value?(f(),w(N,{key:0},[M[9]||(M[9]=a("div",{class:"custom-hr"},null,-1)),a("div",Oo,[a("div",Vo,[a("div",null,[a("b",null,O(P.$t("main.nav.folders.title")),1)]),a("div",{id:"add_folder",class:"ms-auto plus",onClick:M[2]||(M[2]=z=>{c(),I(st)()})},[E(G,{message:"main.nav.folders.add"},{default:T(()=>M[8]||(M[8]=[a("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),a("div",Fo,[E(eo,{folders:I(o).folderRoots,"filter-manager":C.collection.filterManager,"visible-folders":C.state.visibleFolders,tab:C},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):R("",!0),p.value?(f(),w(N,{key:1},[d.value&&d.value.length?(f(),w("div",Uo,[M[11]||(M[11]=a("div",{class:"custom-hr"},null,-1)),a("div",Do,[a("div",Bo,[a("div",null,[a("b",null,O(P.$t("main.nav.tasks.title")),1)])]),M[10]||(M[10]=a("div",{class:"custom-hr"},null,-1)),I(e).state.tasks?(f(),w("div",Go,[(f(!0),w(N,null,ee(d.value,(z,r)=>(f(),w("div",Ho,[r?(f(),w("div",No)):R("",!0),E(ao,{task:z},null,8,["task"])]))),256))])):R("",!0)])])):R("",!0)],64)):R("",!0),M[18]||(M[18]=a("div",{class:"custom-hr"},null,-1)),a("div",Zo,[p.value?(f(),w("div",Wo,[E(G,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:T(()=>[a("b",null,O(P.$t("main.nav.properties.title")),1)]),_:1}),M[13]||(M[13]=a("span",{class:"flex-grow-1"},null,-1)),h.value?(f(),w("span",qo,M[12]||(M[12]=[a("span",{class:"sr-only"},null,-1)]))):(f(),w("span",Yo,[E(G,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:T(()=>[a("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:i})]),_:1})])),a("span",Xo,[E(G,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:T(()=>[a("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:M[3]||(M[3]=z=>I(s).showModal(I(le).EXPORT,void 0))})]),_:1})])])):R("",!0),I(e).loaded?(f(),w("div",jo,[E(Po,{tab:C,"menu-open":p.value},null,8,["tab","menu-open"]),p.value?(f(),w(N,{key:0},[M[16]||(M[16]=a("div",{class:"property-item m-0 p-0"},null,-1)),a("div",{id:"add-property",onClick:M[4]||(M[4]=z=>{I(s).showModal(I(le).PROPERTY,void 0),I(st)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[M[14]||(M[14]=a("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),a("span",null,O(P.$t("main.nav.properties.add_property")),1)]),M[17]||(M[17]=a("div",{class:"custom-hr mt-1"},null,-1)),a("div",{onClick:M[5]||(M[5]=z=>I(o).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[M[15]||(M[15]=a("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),a("span",null,O(P.$t("main.nav.properties.add_property_group")),1)])],64)):R("",!0)])):R("",!0)])])])],4)]),_:1},8,["id"]))}}),ea=j(Jo,[["__scopeId","data-v-89a8f03a"]]),ta={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},sa={class:""},oa=["onClick"],aa=H({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(S,{emit:t}){const e=S,o=t;function s(l){o("update:modelValue",l)}return(l,v)=>(f(),U(ne,null,{button:T(()=>[a("div",ta,[a("span",sa,O(l.$t("modals.filters."+e.modelValue)),1)])]),popup:T(({hide:h})=>[a("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:h},[a("div",{class:"base-btn",onClick:v[0]||(v[0]=p=>s(I(ct).and))},O(l.$t("modals.filters.and")),1),v[2]||(v[2]=a("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),a("div",{class:"base-btn",onClick:v[1]||(v[1]=p=>s(I(ct).or))},O(l.$t("modals.filters.or")),1)],8,oa)]),_:1}))}}),ia=["disabled"],na={class:"m-0 p-1"},ra=["onClick"],la=H({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(S,{emit:t}){const e=X(),o=S,s=t,l=F(()=>e.properties[o.propertyId]),v=F(()=>ss(l.value.type));async function h(p){s("update:modelValue",p)}return(p,n)=>(f(),U(ne,{onHide:n[0]||(n[0]=i=>s("hide")),placement:"bottom"},{button:T(()=>[a("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[a("span",null,O(p.$t("modals.filters.operators."+o.modelValue)),1)],8,ia)]),popup:T(({hide:i})=>[a("div",na,[(f(!0),w(N,null,ee(v.value,d=>(f(),w("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>{h(d),i()}},[a("a",null,O(p.$t("modals.filters.operators."+d)),1)],8,ra))),256))])]),_:1}))}}),ua=j(la,[["__scopeId","data-v-0b3d97be"]]),da={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},ca=H({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(S,{emit:t}){const e=S,o=t;function s(l){o("update:modelValue",l)}return(l,v)=>(f(),w("div",da,[I(ze)(l.property.type)?(f(),U(os,{key:0,"model-value":e.modelValue,"onUpdate:modelValue":s,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:e.property,teleport:!1,width:e.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):e.property.type==I(se).color?(f(),U(as,{key:1,"model-value":e.modelValue,"onUpdate:modelValue":s,width:e.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):e.property.type==I(se).number?(f(),U(is,{key:2,"model-value":e.modelValue,"onUpdate:modelValue":s,width:e.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):e.property.type==I(se).url?(f(),U(ns,{key:3,"model-value":e.modelValue,"onUpdate:modelValue":s,width:e.width,offset:-22,class:"sb"},null,8,["model-value","width"])):e.property.type==I(se).checkbox?(f(),U(rs,{key:4,"model-value":e.modelValue,"onUpdate:modelValue":s,label:e.property.name,width:e.width,class:"sb"},null,8,["model-value","label","width"])):e.property.type==I(se).date?(f(),U(ls,{key:5,"model-value":e.modelValue,teleport:!1,"onUpdate:modelValue":s,width:e.width,class:"sb"},null,8,["model-value","width"])):(f(),U(us,{key:6,"model-value":e.modelValue,"onUpdate:modelValue":s,width:e.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),pa={class:"p-0 m-0 ps-2"},ha=H({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(S,{emit:t}){const e=X(),o=S,s=F(()=>e.properties[o.filter.propertyId]),l=F(()=>ds(o.filter.operator));function v(n){o.manager.updateFilter(o.filter.id,{operator:n})}function h(n){o.manager.updateFilter(o.filter.id,{value:n})}function p(n){o.manager.updateFilter(o.filter.id,{propertyId:n.id})}return(n,i)=>(f(),w(N,null,[a("td",pa,[E(cs,{"model-value":s.value,"onUpdate:modelValue":p},null,8,["model-value"])]),a("td",null,[E(ua,{"property-id":s.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":v},null,8,["property-id","model-value"])]),a("td",null,[l.value?(f(),U(ca,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":h,property:s.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):R("",!0)])],64))}}),va={style:{"max-height":"500px",overflow:"auto"}},Zt=H({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(S,{emit:t}){const e=S;function o(s){e.manager.addNewFilter(s,e.group.id),Te.filter.show()}return(s,l)=>(f(),U(ne,{placement:"auto"},{button:T(()=>[Ct(s.$slots,"default")]),popup:T(({hide:v})=>[a("div",va,[E(zt,{onSelect:h=>{o(h),v()},"ignore-ids":[I(at).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),fa={class:"filter-group"},ma={class:"table table-sm"},ga={style:{height:"33px"}},ya={class:""},ba={key:0,class:"m-0 p-0"},_a={key:2,class:"text-secondary"},xa={class:"border rounded"},wa={class:""},ka=["onClick"],$a={class:"d-flex text-secondary ms-2"},Ma={class:"add-options hover-light"},Sa=H({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(S,{emit:t}){X();const e=S,o=F(()=>e.filter),s=F(()=>o.value.filters),l=F(()=>{let n=255-(o.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function v(n){e.manager.deleteFilter(n.id)}function h(n){e.manager.addNewFilterGroup(n)}function p(n,i){e.manager.updateFilterGroup(n,i)}return(n,i)=>(f(),w("div",fa,[a("table",ma,[(f(!0),w(N,null,ee(s.value,(d,c)=>(f(),w("tr",ga,[a("td",ya,[c==0?(f(),w("div",ba,O(n.$t("modals.filters.where")),1)):c==1?(f(),U(aa,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":i[0]||(i[0]=x=>p(o.value.id,x))},null,8,["model-value"])):(f(),w("span",_a,O(n.$t("modals.filters."+o.value.groupOperator)),1))]),d.propertyId!==void 0?(f(),U(ha,{key:0,filter:d,manager:e.manager},null,8,["filter","manager"])):(f(),w("td",{key:1,colspan:"3",style:Q(l.value)},[a("div",xa,[E(Wt,{filter:d,manager:e.manager},null,8,["filter","manager"])])],4)),a("td",wa,[a("span",{class:"base-btn",onClick:x=>v(d)},i[2]||(i[2]=[a("i",{class:"bi bi-trash"},null,-1)]),8,ka)])]))),256))]),a("div",$a,[E(Zt,{group:e.filter,manager:e.manager},{default:T(()=>[a("div",Ma,[i[3]||(i[3]=a("i",{class:"bi bi-plus"},null,-1)),ie(O(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),a("div",{class:"add-options hover-light",onClick:i[1]||(i[1]=d=>h(o.value.id))},[i[4]||(i[4]=a("i",{class:"bi bi-plus"},null,-1)),ie(O(n.$t("modals.filters.new_group")),1)])])]))}}),Wt=j(Sa,[["__scopeId","data-v-cbadcac5"]]),Ia=["onSubmit"],Ca={class:"mb-1"},Pa={class:"d-flex flex-center mt-3",style:{height:"20px"}},za=["onClick"],Ea=["onClick"],Ra=H({__name:"InputOptions",props:{functionId:{},size:{},hideText:{type:Boolean}},emits:["changed"],setup(S,{emit:t}){const e=Ve(),o=S,s=t,l=V([]),v=F(()=>o.size?o.size:12),h=F(()=>o.functionId.slice(0,o.functionId.indexOf(".")));function p(){if(!o.functionId||!e.index[o.functionId])return;const d=e.index[o.functionId].params,c=e.getContext(o.functionId).uiInputs;for(let x of d)x.defaultValue=c[x.name];l.value=JSON.parse(JSON.stringify(d))}async function n(){for(let d in l.value)e.index[o.functionId].params[d].defaultValue=l.value[d].defaultValue;await e.updateDefaultParams(),s("changed")}function i(){p()}return oe(p),(d,c)=>l.value.length?(f(),w("div",{key:0,style:Q({fontSize:v.value+"px"})},[E(ne,null,{button:T(()=>[a("div",null,[E(G,{message:"Options"},{default:T(()=>c[0]||(c[0]=[a("span",{class:"bbb"},[a("i",{class:"bi bi-gear"})],-1)])),_:1})])]),popup:T(({hide:x})=>[a("form",{onSubmit:pe($=>{n(),x()},["prevent"]),class:"p-2"},[(f(!0),w(N,null,ee(l.value,($,P)=>(f(),w("div",Ca,[$.name=="text"&&o.hideText?R("",!0):(f(),U(Et,{key:0,input:$,source:h.value},null,8,["input","source"]))]))),256)),a("div",Pa,[c[1]||(c[1]=a("div",{class:"flex-grow-1"},null,-1)),a("div",{class:"bb",onClick:$=>{i(),x()}},O(d.$t("cancel")),9,za),a("div",{class:"bb",onClick:$=>{n(),x()}},O(d.$t("confirm")),9,Ea)])],40,Ia)]),_:1})],4)):R("",!0)}}),Ta={key:0},La={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"1px"},strole:"status"},ve=H({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(S){const t=S;return(e,o)=>t.loading?(f(),w("div",Ta,[e.loading?(f(),w("div",La,o[0]||(o[0]=[a("span",{class:"visually-hidden"},"Loading...",-1)]))):R("",!0)])):R("",!0)}}),Aa=ps("search",()=>{const S=V(!1);function t(e){S.value=e}return{isLoading:S,setLoading:t}}),Oa={class:"cont3"},Va={class:"select-wrapper"},Fa=["placeholder"],Ua={class:"toolbar"},Da={key:0},Ba=H({__name:"TextSearchInput",props:{tab:{},size:{}},emits:["update:query"],setup(S,{emit:t}){const e=Ve(),o=Aa(),s=S,l=V(null),v=V(!1),h=[{value:"text",icon:"search"},{value:"regex",icon:"regex"}],p=V([]),n=V("text"),i=V(""),d=F(()=>s.size??26),c=F(()=>n.value!="text"&&n.value!="regex");function x(){const u=e.textSearchFunctions.map(m=>({value:m.id,icon:"boxes"}));p.value=[...h,...u]}function $(){s.tab.collection.filterManager.state.query&&(n.value=s.tab.collection.filterManager.state.query.type||"text",i.value=s.tab.collection.filterManager.state.query.text||"")}function P(){i.value="",C()}function M(){C()}function C(){const u={type:n.value,text:i.value};if(c.value){if(!e.index[n.value]){n.value="text",P();return}const m=e.getContext(n.value);m.uiInputs.text=i.value,u.ctx=m}z(u)}async function z(u){r(u,s.tab.collection.filterManager.state.query)||(o.setLoading(!0),s.tab.collection.filterManager.setQuery(u),await s.tab.collection.filterManager.update(!0),s.tab.saveState(),o.setLoading(!1))}function r(u,m){return!(u.type!=m.type||u.text!=m.text||JSON.stringify(u.ctx.uiInputs)!==JSON.stringify(m.ctx.uiInputs))}return x(),W(()=>s.tab.collection.filterManager.state.query,$,{deep:!0}),W(()=>e.textSearchFunctions,x),W(n,C),oe(()=>{x(),$()}),Y.ctrlF.on(()=>l.value?.focus()),(u,m)=>(f(),w("div",Oa,[a("div",Va,[E(it,{options:p.value,modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=L=>n.value=L),placeholder:"Search Mode",class:"bg-white",size:d.value*.6,teleport:!1},null,8,["options","modelValue","size"])]),a("div",{class:q(["input-field d-flex items-align-center",{focus:v.value}]),style:Q({height:d.value+"px"})},[Ae(a("input",{class:"text-input2",style:Q({height:d.value+"px"}),type:"text","onUpdate:modelValue":m[1]||(m[1]=L=>i.value=L),placeholder:u.$t("main.menu.search"),ref_key:"inputElem",ref:l,onFocusin:m[2]||(m[2]=L=>v.value=!0),onFocusout:m[3]||(m[3]=L=>v.value=!1),onBlur:M,onKeypress:m[4]||(m[4]=Rt(L=>L.target.blur(),["enter"]))},null,44,Fa),[[Oe,i.value]]),a("div",Ua,[I(o).isLoading?(f(),w("div",{key:0,style:Q([{fontSize:d.value*.63+"px"},{"margin-right":"2px"}])},[E(ve,{loading:I(o).isLoading},null,8,["loading"])],4)):R("",!0),i.value.length?(f(),w("div",{key:1,style:Q([{fontSize:d.value*.63+"px"},{"margin-right":"2px"}]),onClick:P},m[5]||(m[5]=[a("i",{class:"bi bi-x sb"},null,-1)]),4)):R("",!0)])],6),c.value?(f(),w("div",Da,[E(Ra,{"function-id":n.value,size:s.size*.6,style:Q({fontSize:d.value*.56+"px"}),"hide-text":!0,onChanged:C},null,8,["function-id","size","style"])])):R("",!0)]))}}),qt=j(Ba,[["__scopeId","data-v-dbeda245"]]),Ga={key:0,class:"d-flex flex-row m-0 ms-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ha={key:0},Na={key:0,class:"or-separator"},Za={key:0,class:"or-separator"},Wa={key:0,class:"m-1 p-1"},qa={class:"d-flex align-items-center"},Ya=H({__name:"MainFilterDropdown",props:{tab:{},manager:{}},emits:["update:modelValue"],setup(S,{emit:t}){const e=X(),o=S,s=V(null),l=V(null),v=F(()=>{let p=h(o.manager.state.filter),n={};return p.forEach(i=>n[i.propertyId]=i),Object.values(n)});function h(p){let n=[];for(let i of p.filters)i.isGroup?n.push(...h(i)):n.push(i);return n}return W(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&l.value.hide()}),oe(async()=>{await re(),Te.filter=l.value}),(p,n)=>(f(),U(ne,{ref_key:"dropdownElem",ref:l,placement:"top-start"},{button:T(()=>[a("div",null,[v.value.length||o.manager.state.query?.text?(f(),w("div",Ga,[o.manager.state.query?.text?(f(),w("div",Ha,[n[0]||(n[0]=a("span",{class:"text-primary"},"Text Query",-1)),v.value.length?(f(),w("span",Na,"|")):R("",!0)])):R("",!0),(f(!0),w(N,null,ee(v.value,(i,d)=>(f(),w("div",null,[d>0?(f(),w("span",Za,"|")):R("",!0),i.propertyId==I(at).id?(f(),U(Ce,{key:1,type:I(e).properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):R("",!0),a("span",null,O(I(e).properties[i.propertyId].name),1)]))),256))])):R("",!0)])]),popup:T(()=>[a("div",{class:"m-0 p-0",ref_key:"popupElem",ref:s},[Object.keys(I(e).properties).length>0?(f(),w("div",Wa,[a("div",qa,[E(qt,{tab:o.tab,size:24,class:"flex-grow-1"},null,8,["tab"])]),E(Wt,{filter:o.manager.state.filter,manager:o.manager,parent:s.value},null,8,["filter","manager","parent"])])):R("",!0)],512)]),_:1},512))}}),Xa=j(Ya,[["__scopeId","data-v-ebe802c1"]]),ja={class:"d-flex flex-row filter-form align-items-center"},Ka={class:"pt-1 pb-1"},Qa=H({__name:"FilterForm",props:{tab:hs},setup(S){const t=S;return(e,o)=>(f(),w("div",ja,[a("div",Ka,O(e.$t("main.menu.filters"))+": ",1),E(Xa,{manager:t.tab.collection.filterManager,tab:t.tab},null,8,["manager","tab"]),E(Zt,{manager:t.tab.collection.filterManager,group:t.tab.collection.filterManager.state.filter,class:"p-1"},{default:T(()=>o[0]||(o[0]=[a("span",{class:"base-hover plus-btn text-secondary"},[a("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),Ja=j(Qa,[["__scopeId","data-v-88087d2d"]]),ei={class:""},ti=H({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(S,{emit:t}){const e=S,o=t,s=V(null);return(l,v)=>(f(),U(ne,{ref_key:"dropdownElem",ref:s,"auto-focus":!1},{button:T(()=>v[2]||(v[2]=[a("div",{class:"text-secondary p-1"},[a("span",{class:"base-hover plus-btn"},[a("i",{class:"bi bi-plus"})])],-1)])),popup:T(()=>[a("div",ei,[E(zt,{onClick:v[0]||(v[0]=h=>I(st)()),onSelect:v[1]||(v[1]=h=>{o("select",h),s.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),Yt=j(ti,[["__scopeId","data-v-75cdd8b1"]]),si={class:"base-hover ps-1 pe-1"},oi={class:"main"},ai=["onClick"],ii=H({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(S,{emit:t}){const e=S,o=t,s=Object.values(Tt);function l(v){o("update:modelValue",v)}return(v,h)=>(f(),U(ne,null,{button:T(()=>[a("div",si,O(e.modelValue),1)]),popup:T(({hide:p})=>[a("div",oi,[(f(!0),w(N,null,ee(I(s),n=>(f(),w("div",{class:"base-hover option",onClick:i=>{l(n),p()}},O(n),9,ai))),256))])]),_:1}))}}),ni=j(ii,[["__scopeId","data-v-cc9d0d61"]]),ri={class:""},li={class:"d-flex ipt"},ui={class:"ms-2",min:"1"},di=H({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(S,{emit:t}){const e=S,o=t,s=V(1),l=V(Tt.Year);function v(){e.option.stepSize==s.value&&e.option.stepUnit==l.value||o("change",{stepSize:s.value,stepUnit:l.value})}function h(){s.value=e.option.stepSize??1,l.value=e.option.stepUnit}return W(()=>e.option,h),oe(h),W(s,()=>{(s.value<1||s.value==null||isNaN(s.value))&&(s.value=1)}),(p,n)=>(f(),U(ne,{onHide:v},{button:T(()=>n[2]||(n[2]=[a("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:T(({hide:i,focus:d})=>[a("div",ri,[a("div",li,[a("div",null,[Ae(a("input",{type:"number","onUpdate:modelValue":n[0]||(n[0]=c=>s.value=c)},null,512),[[Oe,s.value]])]),a("div",ui,[E(ni,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=c=>l.value=c),onHide:d},null,8,["modelValue","onHide"])])])])]),_:1}))}}),ci=j(di,[["__scopeId","data-v-a27bea28"]]),pi={class:"d-flex flex-row group-form align-items-center"},hi={class:"me-1"},vi={key:0,class:"bg-selected bg d-flex flex-row m-0 p-0 align-items-center"},fi={key:0,class:"bi bi-chevron-right smaller"},mi=["onClick"],gi=["onClick"],yi=["onClick"],bi=["onClick"],_i=["onClick"],xi=["onClick"],wi=["onClick"],ki=["onClick"],$i=["onClick"],Mi={key:5,class:"bbw"},Si={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ii=H({__name:"GroupForm",props:{isLoading:Boolean,manager:vs},setup(S){const t=X(),e=S;function o(i){e.manager.setGroupOption(i),e.manager.update(!0)}function s(i){e.manager.delGroupOption(i),e.manager.update(!0)}function l(i,d){e.manager.setGroupOption(i,{direction:d}),e.manager.sortGroups(!0)}function v(i,d){e.manager.setGroupOption(i,{type:d}),e.manager.sortGroups(!0)}function h(i,d){e.manager.setGroupOption(i,d),e.manager.update(!0)}const p=F(()=>e.manager.state.groupBy.map(i=>t.properties[i])),n=F(()=>{const i=[];return e.manager.state.groupBy.forEach(d=>{i.push({option:e.manager.state.options[d],property:t.properties[d]})}),i});return(i,d)=>(f(),w("div",pi,[a("div",hi,O(i.$t("main.menu.groupby"))+": ",1),p.value.length?(f(),w("div",vi,[(f(!0),w(N,null,ee(n.value,(c,x)=>(f(),w(N,null,[x>0?(f(),w("i",fi)):R("",!0),a("div",{class:"bbw",onClick:$=>s(c.property.id),id:"remove-group-button"},O(c.property.name),9,mi),c.option.type==I(he).Size?(f(),U(G,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:T(()=>[c.option.direction==I(de).Ascending?(f(),w("i",{key:0,class:"bi bi-sort-up-alt bbw",onClick:$=>v(c.property.id,I(he).Property)},null,8,gi)):(f(),w("i",{key:1,class:"bi bi-sort-down bbw",onClick:$=>v(c.property.id,I(he).Property)},null,8,yi))]),_:2},1024)):(f(),U(G,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:T(()=>[c.property.type==I(se).number?(f(),w(N,{key:0},[c.option.direction==I(de).Ascending?(f(),w("i",{key:0,class:"bi bi-sort-numeric-up bbw",onClick:$=>v(c.property.id,I(he).Size)},null,8,bi)):(f(),w("i",{key:1,class:"bi bi-sort-numeric-down-alt bbw",onClick:$=>v(c.property.id,I(he).Size)},null,8,_i))],64)):(f(),w(N,{key:1},[c.option.direction==I(de).Ascending?(f(),w("i",{key:0,class:"bi bi-sort-alpha-up bbw",onClick:$=>v(c.property.id,I(he).Size)},null,8,xi)):(f(),w("i",{key:1,class:"bi bi-sort-alpha-down-alt bbw",onClick:$=>v(c.property.id,I(he).Size)},null,8,wi))],64))]),_:2},1024)),c.option.direction==I(de).Ascending?(f(),U(G,{key:3,message:"main.menu.sort.order_asc"},{default:T(()=>[a("i",{class:"bi bi-arrow-up bbw",onClick:$=>l(c.property.id,I(de).Descending)},null,8,ki)]),_:2},1024)):(f(),U(G,{key:4,message:"main.menu.sort.order_desc"},{default:T(()=>[a("i",{class:"bi bi-arrow-down bbw",onClick:$=>l(c.property.id,I(de).Ascending)},null,8,$i)]),_:2},1024)),c.property.type==I(se).date?(f(),w("div",Mi,[E(ci,{option:c.option,onChange:$=>h(c.property.id,$)},null,8,["option","onChange"])])):R("",!0)],64))),256)),e.isLoading?(f(),w("i",Si)):R("",!0)])):R("",!0),E(Yt,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:d[0]||(d[0]=c=>o(c))},null,8,["group-ids"])]))}}),Ci=j(Ii,[["__scopeId","data-v-84118e28"]]),Pi={class:"d-flex flex-row sort-form align-items-center"},zi={class:"me-1"},Ei={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg align-items-center"},Ri={key:0,class:"bi bi-chevron-right smaller"},Ti=["onClick"],Li=["onClick"],Ai=["onClick"],Oi=H({__name:"SortForm",props:{manager:fs},setup(S){const t=X(),e=S,o=F(()=>e.manager.state.sortBy.map(p=>({propertyId:p,direction:e.manager.state.options[p].direction}))),s=F(()=>o.value.map(p=>p.propertyId));function l(p){e.manager.setSort(p),e.manager.update(!0)}function v(p){e.manager.delSort(p),e.manager.update(!0)}function h(p,n){e.manager.setSort(p,{direction:n}),e.manager.update(!0)}return(p,n)=>(f(),w("div",Pi,[a("div",zi,O(p.$t("main.menu.sort.title"))+": ",1),o.value.length?(f(),w("div",Ei,[(f(!0),w(N,null,ee(o.value,(i,d)=>(f(),w(N,null,[d>0?(f(),w("i",Ri)):R("",!0),a("div",{class:"bbw",onClick:c=>v(i.propertyId)},O(I(t).properties[i.propertyId].name),9,Ti),i.direction==I(de).Ascending?(f(),U(G,{key:1,message:"main.menu.sort.order_asc"},{default:T(()=>[a("i",{class:"bi bi-arrow-up bbw",onClick:c=>h(i.propertyId,I(de).Descending)},null,8,Li)]),_:2},1024)):(f(),U(G,{key:2,message:"main.menu.sort.order_desc"},{default:T(()=>[a("i",{class:"bi bi-arrow-down bbw",onClick:c=>h(i.propertyId,I(de).Ascending)},null,8,Ai)]),_:2},1024))],64))),256))])):R("",!0),E(Yt,{"group-ids":s.value,onSelect:n[0]||(n[0]=i=>l(i))},null,8,["group-ids"])]))}}),Vi=j(Oi,[["__scopeId","data-v-604e1276"]]),Fi={class:"d-flex tool"},Ui={class:"p-2"},Di={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Bi={class:"border mb-1 p-1"},Gi={class:"me"},Hi={key:0},Ni={key:1},Zi={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},Wi={class:"d-flex center justify-content-center"},qi={key:1,class:"bi bi-arrow-down text-secondary"},Yi={key:3,class:"bi bi-arrow-up text-secondary"},Xi={class:"border mb-1 p-1"},ji={class:"me"},Ki={key:0},Qi={key:1},Ji={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ye=5,en=H({__name:"HistoryDropdown",emits:[],setup(S,{emit:t}){const e=X(),o=V(!1),s=F(()=>o.value?{backgroundColor:"#89b0cd"}:{backgroundColor:"transparent"}),l=F(()=>[...e.history.undo].reverse().slice(0,ye)),v=F(()=>e.history.redo.slice(Math.max(e.history.redo.length-ye,0)));return W(()=>e.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(h,p)=>l.value.length||v.value.length?(f(),U(ne,{key:0},{button:T(()=>[E(G,{message:"dropdown.history.info"},{default:T(()=>[a("div",Fi,[a("div",{style:Q(s.value)},p[2]||(p[2]=[a("i",{class:"bi bi-clock-history me-1 flash"},null,-1)]),4)])]),_:1})]),popup:T(()=>[a("div",Ui,[I(e).history.redo.length>ye?(f(),w("div",Di," + "+O(I(e).history.redo.length-ye),1)):R("",!0),(f(!0),w(N,null,ee(v.value,n=>(f(),w("div",Bi,[a("span",Gi,O(new Date(n.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[3]||(p[3]=a("span",{class:"sep ms-1 me-1"},null,-1)),n.tags?(f(),w("span",Hi,O(n.tags)+" "+O(h.$t("dropdown.history.tags")),1)):R("",!0),n.values?(f(),w("span",Ni,O(n.values)+" "+O(h.$t("dropdown.history.values")),1)):R("",!0)]))),256)),a("div",Zi,[a("div",Wi,[l.value.length?(f(),U(G,{key:0,message:"dropdown.history.undo"},{default:T(()=>[a("div",{class:"bi bi-arrow-down sb",onClick:p[0]||(p[0]=(...n)=>I(e).undo&&I(e).undo(...n))})]),_:1})):(f(),w("div",qi)),p[4]||(p[4]=a("div",{style:{width:"30px"}},null,-1)),v.value.length?(f(),U(G,{key:2,message:"dropdown.history.redo"},{default:T(()=>[a("div",{class:"bi bi-arrow-up sb",onClick:p[1]||(p[1]=(...n)=>I(e).redo&&I(e).redo(...n))})]),_:1})):(f(),w("div",Yi))])]),(f(!0),w(N,null,ee(l.value,n=>(f(),w("div",Xi,[a("span",ji,O(new Date(n.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[5]||(p[5]=a("span",{class:"sep ms-1 me-1"},null,-1)),n.tags?(f(),w("span",Ki,O(n.tags)+" "+O(h.$t("dropdown.history.tags")),1)):R("",!0),n.values?(f(),w("span",Qi,O(n.values)+" "+O(h.$t("dropdown.history.values")),1)):R("",!0)]))),256)),I(e).history.undo.length>ye?(f(),w("div",Ji," + "+O(I(e).history.undo.length-ye),1)):R("",!0)])]),_:1})):R("",!0)}}),tn=j(en,[["__scopeId","data-v-0faa86b5"]]),sn=H({__name:"ToggleReload",props:{tab:{}},emits:[],setup(S,{emit:t}){const e=S,o=F(()=>e.tab.collection.state.autoReload?2:e.tab.collection.runState.isDirty?0:1);function s(){o.value==0?e.tab.collection.update():o.value==1?e.tab.collection.setAutoReload(!0):e.tab.collection.setAutoReload(!1)}return(l,v)=>(f(),w("div",{class:"bb font",onClick:s,style:{width:"26px",height:"26px",overflow:"hidden"}},[o.value==0?(f(),U(G,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:T(()=>v[0]||(v[0]=[a("div",{style:{height:"26px"}},[a("span",{class:"bi bi-arrow-repeat small-arrow text-warning"})],-1)])),_:1})):R("",!0),o.value==1?(f(),U(G,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:T(()=>v[1]||(v[1]=[a("div",{style:{height:"26px"}},[a("span",{class:"bi bi-check2-all text-success small-valid"})],-1)])),_:1})):R("",!0),o.value==2?(f(),U(G,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:T(()=>v[2]||(v[2]=[a("div",{style:{height:"26px"}},[a("span",{class:"bi bi-check2-all text-success small-valid"}),a("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):R("",!0)]))}}),on=j(sn,[["__scopeId","data-v-a5a646f4"]]),an={class:"d-flex flex-row pt-2 ps-2 pb-1 align-items-center"},nn={class:"me-3 d-flex align-items-center"},rn={class:"ms-3 d-flex align-items-center"},ln={class:"ms-3"},un={class:"d-flex flex-wrap content-container ps-2 align-items-center"},dn=H({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(S,{emit:t}){ms();const e=S,o=V({type:"text",text:""}),s=F(()=>Object.keys(e.tab.collection.groupManager.selectedImages.value).map(Number)),l=F(()=>s.value.length);function v(n){e.tab.collection.groupManager.setSha1Mode(n,!0)}function h(){o.value=e.tab.state.filterState.query}function p(n){o.value=n,e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0),e.tab.saveState()}return oe(h),W(()=>e.tab.collection.filterManager.state.query,h),(n,i)=>(f(),w(N,null,[a("div",an,[E(qt,{class:"me-3",style:{"flex-shrink":"0"},tab:e.tab,"onUpdate:query":p},null,8,["tab"]),a("div",nn,[E(G,{message:"main.menu.grid_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:e.tab.state.display=="tree"}]),onClick:i[0]||(i[0]=d=>e.tab.setViewMode("tree"))},i[9]||(i[9]=[a("i",{class:"bi bi-grid-3x3-gap-fill"},null,-1)]),2)]),_:1}),E(G,{message:"main.menu.table_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:e.tab.state.display=="grid"}]),onClick:i[1]||(i[1]=d=>e.tab.setViewMode("grid"))},i[10]||(i[10]=[a("i",{class:"bi bi-table"},null,-1)]),2)]),_:1}),E(G,{message:"main.menu.graph_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:e.tab.state.display=="graph"}]),onClick:i[2]||(i[2]=d=>e.tab.setViewMode("graph"))},i[11]||(i[11]=[a("i",{class:"bi bi-bar-chart"},null,-1)]),2)]),_:1}),E(G,{message:"main.menu.map_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:e.tab.state.display=="map"}]),onClick:i[3]||(i[3]=d=>e.tab.setViewMode("map"))},i[12]||(i[12]=[a("i",{class:"bi bi-map"},null,-1)]),2)]),_:1})]),E(G,{message:"main.menu.image_size_tooltip",click:!1},{default:T(()=>i[13]||(i[13]=[a("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),a("div",null,[E(Lt,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":i[4]||(i[4]=d=>e.tab.state.imageSize=d)},null,8,["modelValue"])]),a("div",rn,[E(G,{message:"main.menu.instance_mode_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:!e.tab.collection.groupManager.state.sha1Mode}]),onClick:i[5]||(i[5]=d=>v(!1))},i[14]||(i[14]=[a("i",{class:"bi bi-image"},null,-1)]),2)]),_:1}),E(G,{message:"main.menu.image_mode_tooltip"},{default:T(()=>[a("div",{class:q(["tool-sm",{selected:e.tab.collection.groupManager.state.sha1Mode}]),onClick:i[6]||(i[6]=d=>v(!0))},i[15]||(i[15]=[a("i",{class:"bi bi-images"},null,-1)]),2)]),_:1})]),a("div",ln,[E(tn)]),a("div",null,[l.value?(f(),U(gs,{key:0,class:"ms-5",style:{"font-size":"14px"},"selected-images-ids":s.value,"onRemove:selected":i[7]||(i[7]=d=>e.tab.collection.groupManager.clearSelection()),onStamped:i[8]||(i[8]=d=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):R("",!0)]),i[17]||(i[17]=a("div",{class:"flex-grow-1"},null,-1)),E(G,{message:"main.menu.issue",class:"bb"},{default:T(()=>i[16]||(i[16]=[a("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),a("div",un,[E(on,{tab:e.tab,class:"me-1"},null,8,["tab"]),E(Ja,{tab:e.tab},null,8,["tab"]),E(Ci,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),E(Vi,{manager:e.tab.collection.sortManager},null,8,["manager"]),i[18]||(i[18]=a("div",null,null,-1))])],64))}}),cn=j(dn,[["__scopeId","data-v-0de48f5f"]]),pn={class:""},hn={class:"d-flex flex-row"},vn=H({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(S,{emit:t}){const e=be(),o=S,s=t,l=F(()=>`width: ${o.size}px; height: ${o.size}px;`);F(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const v=F(()=>o.pile.images[0]);return(h,p)=>(f(),w("div",pn,[E(At,{image:v.value},{default:T(()=>[a("div",{style:Q(l.value),class:"img-container",onClick:p[0]||(p[0]=n=>I(e).showModal(I(le).IMAGE,{image:v.value}))},[E(Ot,{image:v.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),a("div",hn,[E(G,{message:"main.recommand.accept"},{default:T(()=>[a("div",{style:Q(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=n=>s("accept",v.value))}," ✓ ",4)]),_:1}),E(G,{message:"main.recommand.refuse"},{default:T(()=>[a("div",{style:Q(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=n=>s("refuse",v.value))}," ✕ ",4)]),_:1})])]))}}),fn=j(vn,[["__scopeId","data-v-809d667b"]]),mn={class:"bbb"},gn={class:"p-2"},yn=["onClick"],bn={key:0,class:"ms-1"},_n=["onSubmit"],xn={class:"mb-1"},wn={class:"d-flex flex-center mt-3",style:{height:"20px"}},kn=["onClick"],$n=["onClick"],Mn=H({__name:"ActionSelect",props:{action:{},hideGear:{type:Boolean},size:{}},emits:["changed"],setup(S,{emit:t}){const e=Ve(),o=S,s=t,l=F(()=>e.defaultActions[o.action]),v=V([]),h=V(null),p=F(()=>o.size?o.size:12),n=F(()=>Vt(e.index).filter(C=>C.hooks.includes(o.action)).map(C=>C.id)),i=F(()=>h.value.slice(0,h.value.indexOf(".")));function d(){h.value=l.value,c()}function c(){const M=h.value;if(!M||!e.index[M])return;const C=e.index[M].params,z=e.getContext(M).uiInputs;for(let r of C)r.defaultValue=z[r.name];v.value=JSON.parse(JSON.stringify(C))}async function x(){const M=h.value;for(let C in v.value)e.index[M].params[C].defaultValue=v.value[C].defaultValue;await e.updateDefaultParams(),s("changed")}function $(){c()}async function P(M){const C={};C[o.action]=M,await e.updateDefaultActions(C),await d(),s("changed")}return oe(d),(M,C)=>(f(),w("div",{class:"d-flex",style:Q({fontSize:p.value+"px"})},[E(ne,null,{button:T(()=>[a("div",null,[h.value?(f(),U(G,{key:0,class:"p-0 m-0",message:I(e).index[h.value].description},{default:T(()=>[a("span",mn,[ie(O(h.value),1),C[0]||(C[0]=a("i",{class:"ms-1 bi bi-chevron-down"},null,-1))])]),_:1},8,["message"])):R("",!0)])]),popup:T(({hide:z})=>[a("div",gn,[(f(!0),w(N,null,ee(n.value,r=>(f(),w("div",{class:"bb",onClick:u=>{P(r),z()}},[E(G,{message:I(e).index[r].description},{default:T(()=>[ie(O(r),1)]),_:2},1032,["message"])],8,yn))),256))])]),_:1}),v.value.length&&!o.hideGear?(f(),w("div",bn,[E(ne,null,{button:T(()=>[a("div",null,[E(G,{message:"Options"},{default:T(()=>C[1]||(C[1]=[a("span",{class:"bbb"},[a("i",{class:"bi bi-gear"})],-1)])),_:1})])]),popup:T(({hide:z})=>[a("form",{onSubmit:pe(r=>{x(),z()},["prevent"]),class:"p-2"},[(f(!0),w(N,null,ee(v.value,(r,u)=>(f(),w("div",xn,[E(Et,{input:r,source:i.value},null,8,["input","source"])]))),256)),a("div",wn,[C[2]||(C[2]=a("div",{class:"flex-grow-1"},null,-1)),a("div",{class:"bb",onClick:r=>{$(),z()}},O(M.$t("cancel")),9,kn),a("div",{class:"bb",onClick:r=>{x(),z()}},O(M.$t("confirm")),9,$n)])],40,_n)]),_:1})])):R("",!0)],4))}}),Sn={class:"reco-container"},In={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Cn={key:0,class:"bi bi-funnel-fill bb text-primary"},Pn={key:1,class:"bi bi-funnel bb"},zn={class:"text-secondary me-2"},En={style:{"padding-top":"2px"},class:"me-1"},Rn={class:"flex-grow-1"},Tn={class:"d-flex flex-row"},Ln={key:0,class:"separator"},An={class:"d-flex flex-row"},Ge=10,On=H({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(S,{emit:t}){const e=X(),o=Ve(),s=S,l=t,v=V(1),h=Pe([]),p=V(null),n=Pe([]),i=Pe(new Set),d=V(!0),c=[],x=[];async function $(A){const b=[],_=[];n.forEach(g=>{if(g.value!=null){const y=e.properties[g.propertyId];let k=g.value;y.type==se.multi_tags?(k=A.properties[g.propertyId]??[],k=[...k,g.value]):y.type==se.tag&&(k=[k]),y.mode==tt.id?_.push({instanceId:A.id,propertyId:y.id,value:k}):b.push({propertyId:y.id,sha1:A.sha1,value:k})}}),await e.setPropertyValues(_,b)}function P(A){p.value.isSha1Group?p.value.images.filter(b=>b.sha1==A.sha1).forEach(b=>i.add(b.id)):i.add(A.id),L()}function M(){h.length=0;let A=[];const b=x.map(_=>e.instances[_]);if(p.value.isSha1Group){const _={},g=Array.from(new Set(b.map(y=>y.sha1)));g.forEach(y=>_[y]=[]),b.forEach(y=>_[y.sha1].push(y)),g.forEach(y=>A.push({sha1:y,images:e.sha1Index[y]}))}else b.forEach(_=>A.push({sha1:_.sha1,images:[_]}));C(A,h,v.value,s.imageSize,s.width)}function C(A,b,_,g,y){let k=y,D=[],B=0;for(let K=0;K<A.length&&!(b.length>=_);K++){let Z=A[K];if(Z.images=Z.images.filter(ae=>!i.has(ae.id)),Z.images.length==0)continue;let J=g+Ge;if(B+J<k){D.push(Z),B+=J;continue}if(D.length==0)throw new Error("Images seems to be to big for the line");b.push(D),b.length<_&&(D=[Z],B=J)}D.length>0&&b.length<_&&b.push(D)}async function z(){if(!s.group||!o.hasSimilaryFunction)return;const A=o.defaultActions.similar,b=o.getContext(A);b.instanceIds=s.group.images.map(D=>D.id);const _=await o.getSimilarImages(b);if(!_)return;if(!_.groups)throw new Error("No instances in ActionResult");let y=bs(_.groups)[0];if(d.value){const D=new Set(s.tab.collection.filterManager.result.images.map(B=>B.id));y.images=y.images.filter(B=>D.has(B.id))}y.scores&&_s(y),p.value=y,n.length=0;let k=s.group;for(;k;)n.push(...k.meta.propertyValues),k=k.parent;i.clear(),c.length=0,y.images.forEach(D=>c.push(D.id)),L(),l("update")}function r(){d.value=!d.value}function u(){s.tab.collection.groupManager.onResultChange.addListener(L)}function m(){s.tab.collection.groupManager.onResultChange.removeListener(L)}function L(){const A=s.tab.collection.groupManager.result.index[s.group.id];if(!A){l("close");return}x.length=0;const b=new Set(A.images.map(_=>_.id));c.forEach(_=>{b.has(_)||i.has(_)||x.push(_)}),M()}return oe(u),$e(m),oe(z),W(()=>s.group,()=>{z(),i.clear()}),W(()=>s.imageSize,M),W(()=>s.width,M),W(d,z),(A,b)=>(f(),w("div",Sn,[a("div",In,[E(G,{message:"main.recommand.close"},{default:T(()=>[a("div",{class:"text-secondary pe-1",onClick:b[0]||(b[0]=_=>l("close"))},b[2]||(b[2]=[a("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),b[5]||(b[5]=a("div",{class:"b-left pe-1"},null,-1)),E(G,{message:"main.recommand.scroll"},{default:T(()=>[a("div",{class:"text-secondary pe-1",onClick:b[1]||(b[1]=_=>l("scroll",s.group.id))},b[3]||(b[3]=[a("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),b[6]||(b[6]=a("div",{class:"b-left pe-1"},null,-1)),E(G,{message:"main.recommand.filter"},{default:T(()=>[a("div",{class:"text-secondary pe-1",onClick:r},[d.value?(f(),w("span",Cn)):(f(),w("span",Pn))])]),_:1}),b[7]||(b[7]=a("div",{class:"b-left pe-1"},null,-1)),E(G,{message:"main.recommand.reload"},{default:T(()=>[a("div",{class:"text-secondary pe-1",onClick:z},b[4]||(b[4]=[a("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),b[8]||(b[8]=a("div",{class:"b-left pe-1"},null,-1)),E(G,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:T(()=>[a("span",zn,O(A.$t("main.recommand.title")),1)]),_:1}),a("div",En,[E(Mn,{action:"similar",onChanged:z})]),a("div",Rn,[a("div",Tn,[(f(!0),w(N,null,ee(n,(_,g)=>(f(),w(N,null,[E(ys,{class:"",value:_},null,8,["value"]),g<n.length-1?(f(),w("div",Ln)):R("",!0)],64))),256))])])]),a("div",{style:Q("margin-left:"+Ge+"px;")},[(f(!0),w(N,null,ee(h,_=>(f(),w("div",null,[a("div",An,[(f(!0),w(N,null,ee(_,g=>(f(),U(fn,{pile:g,size:s.imageSize,onAccept:$,onRefuse:P,style:Q("margin-right:"+Ge+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),Vn=j(On,[["__scopeId","data-v-c830b08a"]]),Fn={style:{display:"flex"}},Un={class:"info"},Dn={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:se},height:String},setup(S){const t=S,e=V(0),o=V(!1),s={};Object.keys(t.chartData.series).forEach(d=>{s[d]=!1});const l=V({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:t.chartData.dataType===se.date?"datetime":"numeric",categories:t.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:d,seriesIndex:c,dataPointIndex:x,w:$}){const P=t.chartData.series[c].data[x];let M='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';P.images.forEach((z,r)=>{r<10&&(M+=`<div style="width: 75px; height: 75px;"><img src="${z}" style="width: 100%; height: 100%;" /></div>`)}),M+="</div>";let C=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${t.chartData.series[c].name} — </b> ${P.y} Images</span>`;return C+=`<div>${M}</div>`,C}}}),v=()=>{l.value.chart.stacked=!l.value.chart.stacked,o.value=!o.value,e.value+=1},h=()=>{let d;l.value.chart.type==="area"?d={chart:{...l.value.chart,type:"bar"}}:d={chart:{...l.value.chart,type:"area"}},l.value={...l.value,...d},e.value+=1},p=(d,c,x)=>{const P=t.chartData.series[c];let M=Math.max(...P.data.map(C=>C.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(C=>C.remove()),s[c]){s[c]=!1;return}P.data.forEach((C,z)=>{const u=Math.floor(C.y/M*17),m=C.images.slice(0,u),L=`circle[index="${c}"][j="${z}"]`,A=document.querySelector(L),b=parseFloat(A.getAttribute("cx"));m.forEach((_,g)=>{const y=document.createElement("img");y.src=_,y.width=40,y.height=40,y.style.position="absolute";let k=b+40/1.5,D=65+g*40;y.style.left=`${k}px`,y.style.bottom=`${D}px`,y.classList.add("apexcharts-custom-image"),y.addEventListener("mouseover",B=>n(k,D,_)),y.addEventListener("mouseout",i),d.el.appendChild(y)})}),Object.keys(s).forEach(C=>s[C]=!1),s[c]=!0};function n(d,c,x){const $=document.getElementById("zoomed-image");$.style.left=`${d+120*1.5}px`,$.src=x,$.style.bottom=`${c}px`,$.style.display="block"}function i(){const d=document.getElementById("zoomed-image");d.style.display="none"}return(d,c)=>{const x=It("apexchart");return f(),w(N,null,[a("div",Fn,[a("button",{class:"mt-2",onClick:h},O(l.value.chart.type==="area"?d.$t("main.graph-view.histo"):d.$t("main.graph-view.curve")),1),t.chartData.series.length>1?(f(),w("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:v},O(o.value?d.$t("main.graph-view.over"):d.$t("main.graph-view.stack")),1)):R("",!0)]),(f(),U(x,{style:{position:"relative"},key:e.value,height:t.height,type:l.value.chart.type,options:l.value,series:t.chartData.series,onLegendClick:p},null,8,["height","type","options","series"])),a("i",Un,O(d.$t("main.graph-view.info")),1),c[0]||(c[0]=a("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Bn={key:1},Gn=H({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(S,{emit:t}){const e=X(),o=S,s=V(""),l=V(h());function v(){const p=new Set;let n=o.collection.groupManager.getGroupIterator();for(;n;){const i=n.group;if(i.id===0||i.meta.propertyValues&&i.meta.propertyValues[0].value==null){n=n.nextGroup();continue}for(let d of i.children)p.add(d.meta.propertyValues[0].value);i.children.forEach(()=>n=n.nextGroup()),n=n.nextGroup()}return p}function h(){const p={};let n,i=o.collection.groupManager.state.groupBy;if(i.length===0){s.value="Choose at least one date or numeric value to group the images by";return}const d=e.properties[i[0]],c=d.type;if(i.length>2){s.value="Only max two levels of grouping are supported";return}else if(i.length===1)p[d.name]={name:d.name,data:[]};else if(n=Array.from(v()),n.length>20){s.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(c!==se.number&&c!==se.date){s.value="First level of grouping needs to be a date or a numeric property";return}let x=o.collection.groupManager.getGroupIterator();const $=[];for(;x;){const P=x.group;if(P.id===0||P.meta.propertyValues&&P.meta.propertyValues[0].value==null){x=x.nextGroup();continue}let M=P.meta.propertyValues[0];const C=c===se.date?new Date(M.value).getTime():M.value;if($.push(C),d.name in p)p[d.name].data.push({x:C,y:P.images.length,images:P.images.slice(0,20).map(z=>z.urlSmall)});else{const z=P.children.map(u=>u.meta.propertyValues[0].value),r=n.filter(u=>!z.includes(u));for(let u of P.children){const m=u.meta.propertyValues[0].value;if(p[m]===void 0){let L=m;m in e.tags&&(L=e.tags[m].value),p[m]={data:[],name:L}}p[u.meta.propertyValues[0].value].data.push({x:C,y:u.images.length,images:u.images.slice(0,20).map(L=>L.urlSmall)})}for(let u of r){if(p[u]===void 0){let m=u;u in e.tags&&(m=e.tags[u].value),p[u]={data:[],name:m}}p[u].data.push({x:C,y:0,images:[]})}P.children.forEach(()=>x=x.nextGroup())}x=x.nextGroup()}return s.value="",{series:Object.values(p),xValues:$,dataType:c}}return o.collection.groupManager.onResultChange.addListener(()=>l.value=h()),(p,n)=>(f(),w("div",{class:"",style:Q({height:o.height+"px"})},[s.value===""?(f(),U(Dn,{key:0,chartData:l.value,height:o.height-50+"px"},null,8,["chartData","height"])):(f(),w("span",Bn,O(s.value),1))],4))}});class Hn{camera;domElement;spatialIndex;mode="pan";isDragging=!1;isLassoing=!1;prevPos={x:0,y:0};mouse=new Es;animationId=null;isMouseInCanvas=!1;lasso;minZoom=.01;maxZoom=20;zoomSpeed=.001;onUpdate=()=>{};constructor(t,e,o,s){this.camera=t,this.domElement=e,this.lasso=o,this.spatialIndex=s,this.init()}init(){this.domElement.addEventListener("wheel",this.handleWheel,{passive:!1}),this.domElement.addEventListener("mousedown",this.handleMouseDown),this.domElement.addEventListener("mouseenter",this.handleMouseEnter),this.domElement.addEventListener("mouseleave",this.handleMouseLeave),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}handleMouseEnter=()=>{this.isMouseInCanvas=!0};handleMouseLeave=()=>{this.isMouseInCanvas=!1};handleMouseMove=t=>{const e=this.domElement.getBoundingClientRect();if(this.mouse.x=(t.clientX-e.left)/e.width*2-1,this.mouse.y=-((t.clientY-e.top)/e.height)*2+1,this.isLassoing){this.lasso.move(this.getMouseWorldPos(),{x:t.clientX,y:t.clientY}),this.onUpdate();return}if(this.isDragging&&this.mode==="pan"){const o=t.clientX-this.prevPos.x,s=t.clientY-this.prevPos.y,l=(this.camera.right-this.camera.left)/this.camera.zoom,v=(this.camera.top-this.camera.bottom)/this.camera.zoom;this.camera.position.x-=o*(l/e.width),this.camera.position.y+=s*(v/e.height),this.prevPos={x:t.clientX,y:t.clientY},this.onUpdate()}};getHoveredPoint(t){if(this.mode.startsWith("lasso")||!this.isMouseInCanvas)return null;const e=this.getMouseWorldPos(),o=this.camera.zoom,{h:s,z1:l,z2:v}=t;let h=s;o>=l&&o<v?h=s*(l/o):o>=v&&(h=s*(l/v));const p=this.spatialIndex.getPointsInRect({minX:e.x-h,maxX:e.x+h,minY:e.y-h,maxY:e.y+h});p.sort((n,i)=>{const d=Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2),c=Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2);return d-c});for(const n of p){const i=n.ratio>1?1:n.ratio,d=n.ratio>1?1/n.ratio:1,c=i*h/2,x=d*h/2;if(e.x>=n.x-c&&e.x<=n.x+c&&e.y>=n.y-x&&e.y<=n.y+x)return n}return null}handleWheel=t=>{t.preventDefault();const e=this.getMouseWorldPos(),o=t.deltaY*-this.zoomSpeed*this.camera.zoom;this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom+o)),this.camera.updateProjectionMatrix();const s=this.getMouseWorldPos();this.camera.position.x+=e.x-s.x,this.camera.position.y+=e.y-s.y,this.onUpdate()};handleMouseDown=t=>{this.mode.startsWith("lasso")?(this.isLassoing=!0,this.lasso.start(this.getMouseWorldPos(),{x:t.clientX,y:t.clientY})):this.mode==="pan"&&(this.isDragging=!0,this.prevPos={x:t.clientX,y:t.clientY}),this.updateCursor(),this.onUpdate()};handleMouseUp=()=>{this.isLassoing&&(this.isLassoing=!1,this.lasso.end()),this.isDragging=!1,this.updateCursor(),this.onUpdate()};setMode(t){this.isLassoing&&this.lasso.clear(),this.isLassoing=!1,this.isDragging=!1,this.mode=t,this.updateCursor()}getMode(){return this.mode}updateCursor(){this.isLassoing||this.mode.startsWith("lasso")?this.domElement.style.cursor="crosshair":this.isDragging?this.domElement.style.cursor="grabbing":this.mode==="pan"?this.domElement.style.cursor="grab":this.domElement.style.cursor="default"}getMouseWorldPos(){const t=new Ee,e=(this.camera.right-this.camera.left)/this.camera.zoom,o=(this.camera.top-this.camera.bottom)/this.camera.zoom;return t.x=this.camera.position.x+this.mouse.x*e/2,t.y=this.camera.position.y+this.mouse.y*o/2,t}lookAtRect(t,e=500){const o=(t.minX+t.maxX)/2,s=(t.minY+t.maxY)/2,l=t.maxX-t.minX,v=t.maxY-t.minY,h=this.camera.right-this.camera.left,p=this.camera.top-this.camera.bottom,n=h/l,i=p/v,d=Math.max(this.minZoom,Math.min(this.maxZoom,Math.min(n,i)*.9)),c=new Ee(o,s,this.camera.position.z),x=this.camera.position.clone(),$=this.camera.zoom,P=performance.now();this.animationId&&cancelAnimationFrame(this.animationId);const M=C=>{const z=C-P,r=Math.min(z/e,1),u=1-Math.pow(1-r,3);this.camera.position.lerpVectors(x,c,u),this.camera.zoom=$+(d-$)*u,this.camera.updateProjectionMatrix(),this.onUpdate(),r<1?this.animationId=requestAnimationFrame(M):this.animationId=null};this.animationId=requestAnimationFrame(M)}dispose(){this.domElement.removeEventListener("wheel",this.handleWheel),this.domElement.removeEventListener("mousedown",this.handleMouseDown),this.domElement.removeEventListener("mouseenter",this.handleMouseEnter),this.domElement.removeEventListener("mouseleave",this.handleMouseLeave),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}}const mt=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],He=1,xe=8;class lt{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,o]=new Uint8Array(t,0,2);if(e!==219)throw new Error("Data does not appear to be in a KDBush format.");const s=o>>4;if(s!==He)throw new Error(`Got v${s} data when expected v${He}.`);const l=mt[o&15];if(!l)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[h]=new Uint32Array(t,4,1);return new lt(h,v,l,t)}constructor(t,e=64,o=Float64Array,s){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const l=mt.indexOf(this.ArrayType),v=t*2*this.ArrayType.BYTES_PER_ELEMENT,h=t*this.IndexArrayType.BYTES_PER_ELEMENT,p=(8-h%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,xe,t),this.coords=new this.ArrayType(this.data,xe+h+p,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(xe+v+h+p),this.ids=new this.IndexArrayType(this.data,xe,t),this.coords=new this.ArrayType(this.data,xe+h+p,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(He<<4)+l]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=e,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return ot(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:v,nodeSize:h}=this,p=[0,l.length-1,0],n=[];for(;p.length;){const i=p.pop()||0,d=p.pop()||0,c=p.pop()||0;if(d-c<=h){for(let M=c;M<=d;M++){const C=v[2*M],z=v[2*M+1];C>=t&&C<=o&&z>=e&&z<=s&&n.push(l[M])}continue}const x=c+d>>1,$=v[2*x],P=v[2*x+1];$>=t&&$<=o&&P>=e&&P<=s&&n.push(l[x]),(i===0?t<=$:e<=P)&&(p.push(c),p.push(x-1),p.push(1-i)),(i===0?o>=$:s>=P)&&(p.push(x+1),p.push(d),p.push(1-i))}return n}within(t,e,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:l,nodeSize:v}=this,h=[0,s.length-1,0],p=[],n=o*o;for(;h.length;){const i=h.pop()||0,d=h.pop()||0,c=h.pop()||0;if(d-c<=v){for(let M=c;M<=d;M++)gt(l[2*M],l[2*M+1],t,e)<=n&&p.push(s[M]);continue}const x=c+d>>1,$=l[2*x],P=l[2*x+1];gt($,P,t,e)<=n&&p.push(s[x]),(i===0?t-o<=$:e-o<=P)&&(h.push(c),h.push(x-1),h.push(1-i)),(i===0?t+o>=$:e+o>=P)&&(h.push(x+1),h.push(d),h.push(1-i))}return p}}function ot(S,t,e,o,s,l){if(s-o<=e)return;const v=o+s>>1;Xt(S,t,v,o,s,l),ot(S,t,e,o,v-1,1-l),ot(S,t,e,v+1,s,1-l)}function Xt(S,t,e,o,s,l){for(;s>o;){if(s-o>600){const n=s-o+1,i=e-o+1,d=Math.log(n),c=.5*Math.exp(2*d/3),x=.5*Math.sqrt(d*c*(n-c)/n)*(i-n/2<0?-1:1),$=Math.max(o,Math.floor(e-i*c/n+x)),P=Math.min(s,Math.floor(e+(n-i)*c/n+x));Xt(S,t,e,$,P,l)}const v=t[2*e+l];let h=o,p=s;for(we(S,t,o,e),t[2*s+l]>v&&we(S,t,o,s);h<p;){for(we(S,t,h,p),h++,p--;t[2*h+l]<v;)h++;for(;t[2*p+l]>v;)p--}t[2*o+l]===v?we(S,t,o,p):(p++,we(S,t,p,s)),p<=e&&(o=p+1),e<=p&&(s=p-1)}}function we(S,t,e,o){Ne(S,e,o),Ne(t,2*e,2*o),Ne(t,2*e+1,2*o+1)}function Ne(S,t,e){const o=S[t];S[t]=S[e],S[e]=o}function gt(S,t,e,o){const s=S-e,l=t-o;return s*s+l*l}class Nn{tree=null;idToPointMap=new Map;initTree(t){this.idToPointMap.clear(),this.tree=new lt(t.length);for(const e of t){const o=this.tree.add(e.x,e.y);this.idToPointMap.set(o,e),e.id=o}this.tree.finish()}getPointsInRect(t){return this.tree?this.tree.range(t.minX,t.minY,t.maxX,t.maxY).map(o=>this.idToPointMap.get(o)):[]}getNearestPoint(t,e,o=1/0){if(!this.tree)return null;const s=this.tree.within(t,e,o);return s.length===0?null:this.idToPointMap.get(s[0])||null}clear(){this.tree=null,this.idToPointMap.clear()}}class Zn extends nt{_zoomRef={value:1};_zoomParams=new Ee(1,.1,.8);_ratio={value:1};_borderColor={value:new Re(0)};_borderWidth={value:0};_radius={value:.05};constructor(t){super(t),this.onBeforeCompile=e=>{e.uniforms.uZoom=this._zoomRef,e.uniforms.uZoomParams={value:this._zoomParams},e.uniforms.uRatio=this._ratio,e.uniforms.uBorderColor=this._borderColor,e.uniforms.uBorderWidth=this._borderWidth,e.uniforms.uRadius=this._radius,e.vertexShader=`
                varying vec2 vRawUv;
                uniform float uZoom;
                uniform vec3 uZoomParams;
                uniform float uRatio;
                ${e.vertexShader}
            `.replace("#include <begin_vertex>",`
                vec3 transformed = vec3( position );
                float h  = uZoomParams.x;
                float z1 = uZoomParams.y;
                float z2 = uZoomParams.z;

                float zoomScale = h;
                if(uZoom >= z1 && uZoom < z2) {
                    zoomScale = h * (z1 / uZoom);
                } else if(uZoom >= z2) {
                    zoomScale = h * (z1 / z2);
                }

                // Calculate vector scale to fit in 1.0 x 1.0 box while keeping aspect ratio
                vec2 sizeScale;
                if(uRatio > 1.0) {
                    // Landscape: Width fixed to 1.0, Height reduces
                    sizeScale = vec2(1.0, 1.0 / uRatio);
                } else {
                    // Portrait/Square: Height fixed to 1.0, Width reduces
                    sizeScale = vec2(uRatio, 1.0);
                }

                // Apply specific X and Y scaling
                transformed.xy *= sizeScale * zoomScale;
                `).replace("#include <uv_vertex>",`#include <uv_vertex>
                 vRawUv = uv;`),e.fragmentShader=`
                varying vec2 vRawUv;
                uniform float uBorderWidth;
                uniform float uRatio;
                uniform vec3 uBorderColor;
                uniform float uRadius;

                float sdRoundedBox(vec2 p, vec2 b, float r) {
                    vec2 q = abs(p) - b + r;
                    return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - r;
                }

                ${e.fragmentShader}
            `.replace("#include <map_fragment>",`
                vec2 dimensions;
                if(uRatio > 1.0) {
                    dimensions = vec2(1.0, 1.0 / uRatio);
                } else {
                    dimensions = vec2(uRatio, 1.0);
                }
                
                vec2 p = (vRawUv - 0.5) * dimensions;
                vec2 b = dimensions * 0.5;
                
                float d = sdRoundedBox(p, b, uRadius);
                
                float edgeSoftness = 0.002;
                float outsideMask = smoothstep(edgeSoftness, 0.0, d);
                float borderMask = smoothstep(edgeSoftness, 0.0, d + uBorderWidth);

                vec4 texelColor = texture2D( map, vRawUv );
                texelColor.rgb *= diffuse;

                vec3 finalRGB = mix(uBorderColor, texelColor.rgb, borderMask);
                
                diffuseColor = vec4(finalRGB, texelColor.a * outsideMask);
                `),this.userData.shader=e}}setZoomReference(t){this._zoomRef=t}setZoomParams(t){this._zoomParams.set(t.h,t.z1,t.z2)}setRatio(t){this._ratio.value=t}setRadius(t){this._radius.value=t}setBorder(t,e){this._borderWidth.value=t,this._borderColor.value=new Re(e)}}const Wn=new Ht(1,1),qn=new Dt,Ze=1.5,Se=1,yt=2,Yn=.2,Xn=.005;class jn{group;scene;baseImgUrl;animationMap=new Map;textureCache=new Map;zoomRef={value:1};zoomParams={h:1,z1:.2,z2:.8};currentHoveredId=null;constructor(t,e){this.scene=t,this.baseImgUrl=e,this.group=new Rs,this.scene.add(this.group)}updatePositions(){this.animationMap.forEach(t=>{const e=t.point;t.mesh.position.set(e.x,e.y,Ze),t.mesh.scale.set(t.currentScale,t.currentScale,1)})}updateTints(){this.animationMap.forEach(t=>{t.mesh.material.color.set(t.point.tint||"#FFFFFF")})}updateBorder(){this.animationMap.forEach(t=>{const e=t.mesh.material;e.setBorder&&e.setBorder(t.point.border,t.point.borderColor)})}setZoomReference(t){this.zoomRef=t}show(t){t.sort((o,s)=>s.order-o.order);const e=new Set(t.map(o=>o.id));this.animationMap.forEach((o,s)=>{o.isInShowList=e.has(s)}),this.cleanupUnusedImages(),t.forEach(o=>{this.animationMap.has(o.id)?(this.animationMap.get(o.id).point=o,this.updateImagePosition(o)):this.createImage(o)}),this.setZoomParams(this.zoomParams),this.updateTints(),this.updateBorder()}cleanupUnusedImages(){this.animationMap.forEach((t,e)=>{const o=Math.abs(t.targetScale-t.currentScale)>Xn;!t.isInShowList&&!t.isHovered&&!o&&this.removeImage(e)})}getResolutionUrl(t){const e=this.zoomRef.value>7?"large":"medium";return`${this.baseImgUrl}${e}/${t}`}createImage(t){const e=this.getResolutionUrl(t.sha1);this.textureCache.has(e)?this.setupMesh(t,this.textureCache.get(e)):qn.load(e,o=>{o.colorSpace=rt,this.textureCache.set(e,o),this.group.parent&&this.setupMesh(t,o)})}setupMesh(t,e){if(this.animationMap.has(t.id))return;const o=new Zn({map:e,transparent:!0,side:Bt});o.setZoomReference(this.zoomRef),o.setBorder(t.border,t.borderColor),o.setRatio(t.ratio);const s=new Gt(Wn,o);s.position.set(t.x,t.y,Ze),s.renderOrder=2e3+(t.order||0),s.scale.set(1,1,1),this.group.add(s);const l=this.currentHoveredId===t.id;this.animationMap.set(t.id,{mesh:s,point:t,currentScale:Se,targetScale:l?yt:Se,isHovered:l,isInShowList:!0}),l&&(s.renderOrder=Number.MAX_SAFE_INTEGER)}updateImagePosition(t){const e=this.animationMap.get(t.id);e&&e.mesh.position.set(t.x,t.y,Ze)}hover(t){this.currentHoveredId=t.id,this.animationMap.forEach((e,o)=>{o===t.id?(e.isHovered=!0,e.targetScale=yt,e.mesh.renderOrder=Number.MAX_SAFE_INTEGER):e.isHovered&&(e.isHovered=!1,e.targetScale=Se,e.mesh.renderOrder=2e3+(e.point.order||0))}),this.animationMap.has(t.id)||this.createImage(t)}unhover(){this.currentHoveredId=null,this.animationMap.forEach(t=>{t.isHovered&&(t.isHovered=!1,t.targetScale=Se,t.mesh.renderOrder=2e3+(t.point.order||0))})}updateAnimations(){let t=!1;this.animationMap.forEach(e=>{const o=e.targetScale-e.currentScale;Math.abs(o)>.001?(e.currentScale+=o*Yn,e.mesh.scale.set(e.currentScale,e.currentScale,1)):!e.isInShowList&&!e.isHovered&&(t=!0)}),t&&this.cleanupUnusedImages()}removeImage(t){const e=this.animationMap.get(t);e&&(this.group.remove(e.mesh),Array.isArray(e.mesh.material)?e.mesh.material.forEach(o=>o.dispose()):e.mesh.material.dispose(),this.animationMap.delete(t))}setZoomParams(t){this.zoomParams=t,this.animationMap.forEach(e=>{const o=e.mesh.material;o.setZoomParams&&o.setZoomParams(t)})}dispose(){Array.from(this.animationMap.keys()).forEach(e=>this.removeImage(e)),this.group.clear(),this.textureCache.forEach(e=>e.dispose()),this.textureCache.clear(),this.scene.remove(this.group)}}class Kn extends nt{_zoomRef={value:1};_zoomParams=new Ee(1,.1,.11);_radius={value:.05};_showAsPoint={value:0};constructor(t,e,o){super(t),this.onBeforeCompile=s=>{s.uniforms.uGridCols={value:e},s.uniforms.uGridRows={value:o},s.uniforms.uRadius=this._radius,s.uniforms.uZoom=this._zoomRef,s.uniforms.uZoomParams={value:this._zoomParams},s.uniforms.uShowAsPoint=this._showAsPoint,s.vertexShader=`
                attribute vec2 vOffset;
                attribute vec4 vUvTransform; 
                attribute vec4 vTint;
                attribute vec3 vBorderCol;
                attribute float vBorderWidth;
                attribute float vRatioAttr;

                varying vec2 vMappedUv;
                varying vec2 vRawUv; 
                varying vec4 vInstanceTint;
                varying vec3 vInstanceBorder;
                varying float vInstanceBorderWidth;
                varying float vRatio; 

                uniform float uGridCols;
                uniform float uGridRows;
                uniform float uZoom;
                uniform vec3 uZoomParams;
                uniform float uShowAsPoint;

                ${s.vertexShader}
            `.replace("#include <begin_vertex>",`
                vec3 transformed = vec3( position );
                float h  = uZoomParams.x;
                float z1 = uZoomParams.y;
                float z2 = uZoomParams.z;

                // Use the attribute directly
                vRatio = vRatioAttr; 

                // When showing as point, use uniform 1:1 scale
                if(uShowAsPoint > 0.5) {
                    // Point size is always h/uZoom for consistent sizing
                    float pointScale = h/10.0 / uZoom;
                    transformed.xy *= pointScale;
                } else {
                    // Normal image rendering with zoom scaling
                    float zoomScale = h;
                    if(uZoom >= z1 && uZoom < z2) {
                        zoomScale = h * (z1 / uZoom);
                    } else if(uZoom >= z2) {
                        zoomScale = h * (z1 / z2);
                    }

                    // FIT LOGIC: Calculate scale to fit in 1.0 x 1.0 box
                    vec2 sizeScale;
                    if(vRatio > 1.0) {
                        // Landscape: Width is 1.0, Height is 1/Ratio
                        sizeScale = vec2(1.0, 1.0 / vRatio);
                    } else {
                        // Portrait: Height is 1.0, Width is Ratio
                        sizeScale = vec2(vRatio, 1.0);
                    }
                    if(uZoom < z1/2.0) {
                        sizeScale = vec2(1.0, 1.0);
                    }

                    transformed.xy *= sizeScale * zoomScale;
                }
                `).replace("#include <uv_vertex>",`
                #include <uv_vertex>
                vRawUv = uv;
                
                float margin = 0.0005; 
                vec2 safeUv = mix(vec2(margin), vec2(1.0 - margin), uv);
                vec2 correctedUv = safeUv * vUvTransform.xy + vUvTransform.zw;
                vMappedUv = (correctedUv / vec2(uGridCols, uGridRows)) + vOffset;
                
                vInstanceTint = vTint;
                vInstanceBorder = vBorderCol;
                vInstanceBorderWidth = vBorderWidth;
                `),s.fragmentShader=`
                varying vec2 vMappedUv;
                varying vec2 vRawUv;
                varying vec4 vInstanceTint;
                varying vec3 vInstanceBorder;
                varying float vInstanceBorderWidth;
                varying float vRatio;

                uniform float uRadius;
                uniform float uShowAsPoint;

                float sdRoundedBox(vec2 p, vec2 b, float r) {
                    vec2 q = abs(p) - b + r;
                    return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - r;
                }

                ${s.fragmentShader}
            `.replace("#include <map_fragment>",`
                // If showing as point, render a colored circle
                if(uShowAsPoint > 0.5) {
    vec2 p = vRawUv - 0.5;
    float dist = length(p);
    
    // Use a larger radius (0.5 fills the square) to ensure visibility
    float pointRadius = 0.45; 
    float aa = 0.1; // Softer edge for points
    float pointMask = smoothstep(pointRadius + aa, pointRadius, dist);
    
    // Instead of multiplying, use the logic from your image mode:
    // This ensures that if it's visible in image mode, it's visible here.
    vec3 finalRGB = mix(vInstanceBorder, vInstanceTint.rgb, vInstanceTint.a);
    
    // Use 1.0 instead of texelColor.a since there is no texture
    diffuseColor = vec4(finalRGB, pointMask); 
} else {
                    // Normal image rendering
                    vec2 dimensions;
                    if(vRatio > 1.0) {
                        dimensions = vec2(1.0, 1.0 / vRatio);
                    } else {
                        dimensions = vec2(vRatio, 1.0);
                    }
                    
                    vec2 p = (vRawUv - 0.5) * dimensions;
                    vec2 b = dimensions * 0.5;
                    
                    float d = sdRoundedBox(p, b, uRadius);
                    
                    float aa = 0.002; 
                    float outsideMask = smoothstep(aa, 0.0, d);
                    float borderMask = smoothstep(aa, 0.0, d + vInstanceBorderWidth);

                    vec4 texelColor = texture2D( map, vMappedUv );
                    
                    // Mix between original texture and tint color based on tint alpha
                    vec3 tintedColor = mix(texelColor.rgb, vInstanceTint.rgb, vInstanceTint.a);
                    vec3 tintedBorderColor = mix(vInstanceBorder.rgb, vInstanceTint.rgb, vInstanceTint.a);

                    vec3 finalRGB = mix(tintedBorderColor, tintedColor, borderMask);
                    diffuseColor = vec4(finalRGB, texelColor.a * outsideMask);
                }
                `),this.userData.shader=s}}setRadius(t){this._radius.value=t,this.userData.shader&&(this.userData.shader.uniforms.uRadius.value=t)}setZoomParams(t){this._zoomParams.set(t.h,t.z1,t.z2),this.userData.shader&&(this.userData.shader.uniforms.uZoomParams.value=this._zoomParams)}setZoomReference(t){this._zoomRef=t,this.userData.shader&&(this.userData.shader.uniforms.uZoom=t)}setShowAsPoint(t){this._showAsPoint.value=t?1:0,this.userData.shader&&(this.userData.shader.uniforms.uShowAsPoint.value=this._showAsPoint.value)}}class Qn{mesh;geometry;material;points;atlas;matrixHelper=new Ts;colorHelper=new Re;constructor(t,e,o,s){this.points=o,this.atlas=t;const l=t.width/t.cellWidth,v=t.height/t.cellHeight,h=o.length;this.geometry=new Ht(1,1),this.material=new Kn({map:e,transparent:!0,alphaTest:.1,depthTest:!0,depthWrite:!0},l,v),this.mesh=new Ls(this.geometry,this.material,h),this.geometry.setAttribute("vOffset",new ge(new Float32Array(h*2),2)),this.geometry.setAttribute("vUvTransform",new ge(new Float32Array(h*4),4)),this.geometry.setAttribute("vTint",new ge(new Float32Array(h*4),4)),this.geometry.setAttribute("vBorderCol",new ge(new Float32Array(h*3),3)),this.geometry.setAttribute("vBorderWidth",new ge(new Float32Array(h),1)),this.geometry.setAttribute("vRatioAttr",new ge(new Float32Array(h),1)),this.updateUVsAndOffsets(),this.updatePositions(),this.updateRatios(),this.updateTints(),this.updateBorderColors(),this.updateBorderWidths(),this.mesh.frustumCulled=!1,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrixWorld(!0)}updatePositions(){this.points.forEach((t,e)=>{this.matrixHelper.makeScale(1,1,1),this.matrixHelper.setPosition(t.x,t.y,t.z),this.mesh.setMatrixAt(e,this.matrixHelper)}),this.mesh.instanceMatrix.needsUpdate=!0}updateRatios(){const t=this.geometry.getAttribute("vRatioAttr"),e=t.array;this.points.forEach((o,s)=>{e[s]=o.ratio}),t.needsUpdate=!0}updateTints(){const t=this.geometry.getAttribute("vTint"),e=t.array;this.points.forEach((o,s)=>{this.colorHelper.set(o.tint||"#FFFFFF"),e[s*4]=this.colorHelper.r,e[s*4+1]=this.colorHelper.g,e[s*4+2]=this.colorHelper.b,e[s*4+3]=o.tintAlpha??0}),t.needsUpdate=!0}updateBorderColors(){const t=this.geometry.getAttribute("vBorderCol"),e=t.array;this.points.forEach((o,s)=>{this.colorHelper.set(o.borderColor||"#000000"),e[s*3]=this.colorHelper.r,e[s*3+1]=this.colorHelper.g,e[s*3+2]=this.colorHelper.b}),t.needsUpdate=!0}updateBorderWidths(){const t=this.geometry.getAttribute("vBorderWidth"),e=t.array;this.points.forEach((o,s)=>{e[s]=o.border??0}),t.needsUpdate=!0}updateUVsAndOffsets(){const t=this.atlas.width/this.atlas.cellWidth,e=this.atlas.height/this.atlas.cellHeight,o=this.atlas.cellWidth/this.atlas.cellHeight,s=.5,l=s/this.atlas.width*t,v=s/this.atlas.height*e,h=this.geometry.getAttribute("vOffset"),p=this.geometry.getAttribute("vUvTransform"),n=h.array,i=p.array;this.points.forEach((d,c)=>{const x=this.atlas.sha1Mapping[d.sha1];if(x){const C=x[1];n[c*2]=C%t/t,n[c*2+1]=(e-1-Math.floor(C/t))/e}const $=d.ratio;let P=1,M=1;$>o?M=o/$:P=$/o,i[c*4]=P-l*2,i[c*4+1]=M-v*2,i[c*4+2]=(1-P)*.5+l,i[c*4+3]=(1-M)*.5+v}),h.needsUpdate=!0,p.needsUpdate=!0}setZoomReference(t){this.material.setZoomReference(t)}setZoomParams(t){this.material.setZoomParams(t)}setShowAsPoint(t){this.material.setShowAsPoint(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.mesh.dispose()}}class ue{scene;layers=[];_isVisible=!0;_zoomParams;static textureCache=new Map;currentAtlasId=null;constructor(t){this.scene=t}getCacheKey(t,e){return`${t}_${e}`}async loadLayers(t,e,o,s,l){this.currentAtlasId,t.id,this.disposeLayers(),this.currentAtlasId=t.id;const v=new Dt,h=Array.from({length:t.atlasNb},()=>[]);for(let n of e){if(!t.sha1Mapping[n.sha1])continue;let i=t.sha1Mapping[n.sha1][0];h[i].push(n)}let p=Math.max(...h.map(n=>n.length));for(let n=0;n<t.atlasNb;n++){const i=h[n];if(i.length===0)continue;const d=this.getCacheKey(t.id,n),c=`${o}atlas_sheet/${t.id}/${n}`;i.forEach((x,$)=>x.order=n*p+$);try{let x;ue.textureCache.has(d)?x=ue.textureCache.get(d):(x=await v.loadAsync(c),x.colorSpace=rt,x.generateMipmaps=!0,x.minFilter=As,ue.textureCache.set(d,x));const $=new Qn(t,x,i,n);$.setZoomReference(s),$.mesh.visible=this._isVisible,$.setZoomParams(this._zoomParams),$.setShowAsPoint(l),this.layers.push($),this.scene.add($.mesh)}catch(x){console.error(`Failed to load atlas sheet ${n}:`,x)}}}show(){this._isVisible=!0,this.layers.forEach(t=>t.mesh.visible=!0)}hide(){this._isVisible=!1,this.layers.forEach(t=>t.mesh.visible=!1)}disposeLayers(){this.layers.forEach(t=>{this.scene.remove(t.mesh),t.dispose()}),this.layers=[]}dispose(){this.disposeLayers()}static clearTextureCache(){ue.textureCache.forEach(t=>{t.dispose()}),ue.textureCache.clear()}static clearAtlasFromCache(t){const e=[];ue.textureCache.forEach((o,s)=>{s.startsWith(`${t}_`)&&(o.dispose(),e.push(s))}),e.forEach(o=>ue.textureCache.delete(o))}setZoomParams(t){this._zoomParams=t,this.layers.forEach(e=>e.setZoomParams(t))}updateTints(){this.layers.forEach(t=>t.updateTints())}updateBorderColors(){this.layers.forEach(t=>t.updateBorderColors())}updatePositions(){this.layers.forEach(t=>t.updatePositions())}updateBorderWidths(){this.layers.forEach(t=>t.updateBorderWidths())}setShowAsPoint(t){this.layers.forEach(e=>e.setShowAsPoint(t))}}var We,bt;function Jn(){if(bt)return We;bt=1,We=s;function S(l,v){var h=l.x-v.x,p=l.y-v.y;return h*h+p*p}function t(l,v,h){var p=v.x,n=v.y,i=h.x-p,d=h.y-n,c;return(i!==0||d!==0)&&(c=((l.x-p)*i+(l.y-n)*d)/(i*i+d*d),c>1?(p=h.x,n=h.y):c>0&&(p+=i*c,n+=d*c)),i=l.x-p,d=l.y-n,i*i+d*d}function e(l,v){var h,p=l.length,n,i=l[0],d=[i];for(h=1;h<p;h++)n=l[h],S(n,i)>v&&(d.push(n),i=n);return i!==n&&d.push(n),d}function o(l,v){var h=l.length,p=typeof Uint8Array<"u"?Uint8Array:Array,n=new p(h),i=0,d=h-1,c,x,$,P,M=[],C=[],z=[];for(n[i]=n[d]=1;d;){for(x=0,c=i+1;c<d;c++)$=t(l[c],l[i],l[d]),$>x&&(P=c,x=$);x>v&&(n[P]=1,M.push(i),C.push(P),M.push(P),C.push(d)),i=M.pop(),d=C.pop()}for(c=0;c<h;c++)n[c]&&z.push(l[c]);return z}function s(l,v,h){var p=v!==void 0?v*v:1;return h||(l=e(l,p)),l=o(l,p),l}return We}var er=Jn();const tr=Ft(er);var qe={exports:{}},Ye,_t;function jt(){if(_t)return Ye;_t=1,Ye=t;var S=+(Math.pow(2,27)+1);function t(e,o,s){var l=e*o,v=S*e,h=v-e,p=v-h,n=e-p,i=S*o,d=i-o,c=i-d,x=o-c,$=l-p*c,P=$-n*c,M=P-p*x,C=n*x-M;return s?(s[0]=C,s[1]=l,s):[C,l]}return Ye}var Xe,xt;function sr(){if(xt)return Xe;xt=1,Xe=t;function S(e,o){var s=e+o,l=s-e,v=s-l,h=o-l,p=e-v,n=p+h;return n?[n,s]:[s]}function t(e,o){var s=e.length|0,l=o.length|0;if(s===1&&l===1)return S(e[0],o[0]);var v=s+l,h=new Array(v),p=0,n=0,i=0,d=Math.abs,c=e[n],x=d(c),$=o[i],P=d($),M,C;x<P?(C=c,n+=1,n<s&&(c=e[n],x=d(c))):(C=$,i+=1,i<l&&($=o[i],P=d($))),n<s&&x<P||i>=l?(M=c,n+=1,n<s&&(c=e[n],x=d(c))):(M=$,i+=1,i<l&&($=o[i],P=d($)));for(var z=M+C,r=z-M,u=C-r,m=u,L=z,A,b,_,g,y;n<s&&i<l;)x<P?(M=c,n+=1,n<s&&(c=e[n],x=d(c))):(M=$,i+=1,i<l&&($=o[i],P=d($))),C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A;for(;n<s;)M=c,C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A,n+=1,n<s&&(c=e[n]);for(;i<l;)M=$,C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A,i+=1,i<l&&($=o[i]);return m&&(h[p++]=m),L&&(h[p++]=L),p||(h[p++]=0),h.length=p,h}return Xe}var je,wt;function or(){if(wt)return je;wt=1,je=S;function S(t,e,o){var s=t+e,l=s-t,v=s-l,h=e-l,p=t-v;return o?(o[0]=p+h,o[1]=s,o):[p+h,s]}return je}var Ke,kt;function ar(){if(kt)return Ke;kt=1;var S=jt(),t=or();Ke=e;function e(o,s){var l=o.length;if(l===1){var v=S(o[0],s);return v[0]?v:[v[1]]}var h=new Array(2*l),p=[.1,.1],n=[.1,.1],i=0;S(o[0],s,p),p[0]&&(h[i++]=p[0]);for(var d=1;d<l;++d){S(o[d],s,n);var c=p[1];t(c,n[0],p),p[0]&&(h[i++]=p[0]);var x=n[1],$=p[1],P=x+$,M=P-x,C=$-M;p[1]=P,C&&(h[i++]=C)}return p[1]&&(h[i++]=p[1]),i===0&&(h[i++]=0),h.length=i,h}return Ke}var Qe,$t;function ir(){if($t)return Qe;$t=1,Qe=t;function S(e,o){var s=e+o,l=s-e,v=s-l,h=o-l,p=e-v,n=p+h;return n?[n,s]:[s]}function t(e,o){var s=e.length|0,l=o.length|0;if(s===1&&l===1)return S(e[0],-o[0]);var v=s+l,h=new Array(v),p=0,n=0,i=0,d=Math.abs,c=e[n],x=d(c),$=-o[i],P=d($),M,C;x<P?(C=c,n+=1,n<s&&(c=e[n],x=d(c))):(C=$,i+=1,i<l&&($=-o[i],P=d($))),n<s&&x<P||i>=l?(M=c,n+=1,n<s&&(c=e[n],x=d(c))):(M=$,i+=1,i<l&&($=-o[i],P=d($)));for(var z=M+C,r=z-M,u=C-r,m=u,L=z,A,b,_,g,y;n<s&&i<l;)x<P?(M=c,n+=1,n<s&&(c=e[n],x=d(c))):(M=$,i+=1,i<l&&($=-o[i],P=d($))),C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A;for(;n<s;)M=c,C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A,n+=1,n<s&&(c=e[n]);for(;i<l;)M=$,C=m,z=M+C,r=z-M,u=C-r,u&&(h[p++]=u),A=L+z,b=A-L,_=A-b,g=z-b,y=L-_,m=y+g,L=A,i+=1,i<l&&($=-o[i]);return m&&(h[p++]=m),L&&(h[p++]=L),p||(h[p++]=0),h.length=p,h}return Qe}var Mt;function nr(){return Mt||(Mt=1,function(S){var t=jt(),e=sr(),o=ar(),s=ir(),l=5,v=11102230246251565e-32,h=(3+16*v)*v,p=(7+56*v)*v;function n(r,u,m,L){return function(b,_,g){var y=r(r(u(_[1],g[0]),u(-g[1],_[0])),r(u(b[1],_[0]),u(-_[1],b[0]))),k=r(u(b[1],g[0]),u(-g[1],b[0])),D=L(y,k);return D[D.length-1]}}function i(r,u,m,L){return function(b,_,g,y){var k=r(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),_[2]),r(m(r(u(_[1],y[0]),u(-y[1],_[0])),-g[2]),m(r(u(_[1],g[0]),u(-g[1],_[0])),y[2]))),r(m(r(u(_[1],y[0]),u(-y[1],_[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),y[2])))),D=r(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-g[2]),m(r(u(b[1],g[0]),u(-g[1],b[0])),y[2]))),r(m(r(u(_[1],g[0]),u(-g[1],_[0])),b[2]),r(m(r(u(b[1],g[0]),u(-g[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),g[2])))),B=L(k,D);return B[B.length-1]}}function d(r,u,m,L){return function(b,_,g,y,k){var D=r(r(r(m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),g[2]),r(m(r(u(g[1],k[0]),u(-k[1],g[0])),-y[2]),m(r(u(g[1],y[0]),u(-y[1],g[0])),k[2]))),_[3]),r(m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),_[2]),r(m(r(u(_[1],k[0]),u(-k[1],_[0])),-y[2]),m(r(u(_[1],y[0]),u(-y[1],_[0])),k[2]))),-g[3]),m(r(m(r(u(g[1],k[0]),u(-k[1],g[0])),_[2]),r(m(r(u(_[1],k[0]),u(-k[1],_[0])),-g[2]),m(r(u(_[1],g[0]),u(-g[1],_[0])),k[2]))),y[3]))),r(m(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),_[2]),r(m(r(u(_[1],y[0]),u(-y[1],_[0])),-g[2]),m(r(u(_[1],g[0]),u(-g[1],_[0])),y[2]))),-k[3]),r(m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),_[2]),r(m(r(u(_[1],k[0]),u(-k[1],_[0])),-y[2]),m(r(u(_[1],y[0]),u(-y[1],_[0])),k[2]))),b[3]),m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-y[2]),m(r(u(b[1],y[0]),u(-y[1],b[0])),k[2]))),-_[3])))),r(r(m(r(m(r(u(_[1],k[0]),u(-k[1],_[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),k[2]))),y[3]),r(m(r(m(r(u(_[1],y[0]),u(-y[1],_[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),y[2]))),-k[3]),m(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),_[2]),r(m(r(u(_[1],y[0]),u(-y[1],_[0])),-g[2]),m(r(u(_[1],g[0]),u(-g[1],_[0])),y[2]))),b[3]))),r(m(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-g[2]),m(r(u(b[1],g[0]),u(-g[1],b[0])),y[2]))),-_[3]),r(m(r(m(r(u(_[1],y[0]),u(-y[1],_[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),y[2]))),g[3]),m(r(m(r(u(_[1],g[0]),u(-g[1],_[0])),b[2]),r(m(r(u(b[1],g[0]),u(-g[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),g[2]))),-y[3]))))),B=r(r(r(m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),g[2]),r(m(r(u(g[1],k[0]),u(-k[1],g[0])),-y[2]),m(r(u(g[1],y[0]),u(-y[1],g[0])),k[2]))),b[3]),m(r(m(r(u(y[1],k[0]),u(-k[1],y[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-y[2]),m(r(u(b[1],y[0]),u(-y[1],b[0])),k[2]))),-g[3])),r(m(r(m(r(u(g[1],k[0]),u(-k[1],g[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-g[2]),m(r(u(b[1],g[0]),u(-g[1],b[0])),k[2]))),y[3]),m(r(m(r(u(g[1],y[0]),u(-y[1],g[0])),b[2]),r(m(r(u(b[1],y[0]),u(-y[1],b[0])),-g[2]),m(r(u(b[1],g[0]),u(-g[1],b[0])),y[2]))),-k[3]))),r(r(m(r(m(r(u(g[1],k[0]),u(-k[1],g[0])),_[2]),r(m(r(u(_[1],k[0]),u(-k[1],_[0])),-g[2]),m(r(u(_[1],g[0]),u(-g[1],_[0])),k[2]))),b[3]),m(r(m(r(u(g[1],k[0]),u(-k[1],g[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-g[2]),m(r(u(b[1],g[0]),u(-g[1],b[0])),k[2]))),-_[3])),r(m(r(m(r(u(_[1],k[0]),u(-k[1],_[0])),b[2]),r(m(r(u(b[1],k[0]),u(-k[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),k[2]))),g[3]),m(r(m(r(u(_[1],g[0]),u(-g[1],_[0])),b[2]),r(m(r(u(b[1],g[0]),u(-g[1],b[0])),-_[2]),m(r(u(b[1],_[0]),u(-_[1],b[0])),g[2]))),-k[3])))),K=L(D,B);return K[K.length-1]}}function c(r){var u=r===3?n:r===4?i:d;return u(e,t,o,s)}var x=c(3),$=c(4),P=[function(){return 0},function(){return 0},function(u,m){return m[0]-u[0]},function(u,m,L){var A=(u[1]-L[1])*(m[0]-L[0]),b=(u[0]-L[0])*(m[1]-L[1]),_=A-b,g;if(A>0){if(b<=0)return _;g=A+b}else if(A<0){if(b>=0)return _;g=-(A+b)}else return _;var y=h*g;return _>=y||_<=-y?_:x(u,m,L)},function(u,m,L,A){var b=u[0]-A[0],_=m[0]-A[0],g=L[0]-A[0],y=u[1]-A[1],k=m[1]-A[1],D=L[1]-A[1],B=u[2]-A[2],K=m[2]-A[2],Z=L[2]-A[2],J=_*D,ae=g*k,te=g*y,Me=b*D,ce=b*k,_e=_*y,Fe=B*(J-ae)+K*(te-Me)+Z*(ce-_e),Kt=(Math.abs(J)+Math.abs(ae))*Math.abs(B)+(Math.abs(te)+Math.abs(Me))*Math.abs(K)+(Math.abs(ce)+Math.abs(_e))*Math.abs(Z),ut=p*Kt;return Fe>ut||-Fe>ut?Fe:$(u,m,L,A)}];function M(r){var u=P[r.length];return u||(u=P[r.length]=c(r.length)),u.apply(void 0,r)}function C(r,u,m,L,A,b,_){return function(y,k,D,B,K){switch(arguments.length){case 0:case 1:return 0;case 2:return L(y,k);case 3:return A(y,k,D);case 4:return b(y,k,D,B);case 5:return _(y,k,D,B,K)}for(var Z=new Array(arguments.length),J=0;J<arguments.length;++J)Z[J]=arguments[J];return r(Z)}}function z(){for(;P.length<=l;)P.push(c(P.length));S.exports=C.apply(void 0,[M].concat(P));for(var r=0;r<=l;++r)S.exports[r]=P[r]}z()}(qe)),qe.exports}var Je,St;function rr(){if(St)return Je;St=1,Je=t;var S=nr();function t(e,o){for(var s=o[0],l=o[1],v=e.length,h=1,p=v,n=0,i=v-1;n<p;i=n++){var d=e[n],c=e[i],x=d[1],$=c[1];if($<x){if($<l&&l<x){var P=S(d,c,o);if(P===0)return 0;h^=0<P|0}else if(l===x){var M=e[(n+1)%v],C=M[1];if(x<C){var P=S(d,c,o);if(P===0)return 0;h^=0<P|0}}}else if(x<$){if(x<l&&l<$){var P=S(d,c,o);if(P===0)return 0;h^=P<0|0}else if(l===x){var M=e[(n+1)%v],C=M[1];if(C<x){var P=S(d,c,o);if(P===0)return 0;h^=P<0|0}}}else if(l===x){var z=Math.min(d[0],c[0]),r=Math.max(d[0],c[0]);if(n===0){for(;i>0;){var u=(i+v-1)%v,m=e[u];if(m[1]!==l)break;var L=m[0];z=Math.min(z,L),r=Math.max(r,L),i=u}if(i===0)return z<=s&&s<=r?0:1;p=i+1}for(var A=e[(i+v-1)%v][1];n+1<p;){var m=e[n+1];if(m[1]!==l)break;var L=m[0];z=Math.min(z,L),r=Math.max(r,L),n+=1}if(z<=s&&s<=r)return 0;var b=e[(n+1)%v][1];s<z&&A<l!=b<l&&(h^=1)}}return 2*h-1}return Je}var lr=rr();const ur=Ft(lr);class dr{scene;spatialIndex;onLassoComplete;lassoPoints=[];lastScreenPos=null;lassoMesh=null;lassoLine=null;clearTimeoutId=null;FILL_COLOR=43775;FILL_OPACITY=.3;STROKE_COLOR=30668;MIN_PIXEL_DIST_SQ=100;CURVE_TENSION=.5;SMOOTHNESS_MULTIPLIER=10;constructor(t,e,o){this.scene=t,this.spatialIndex=e,this.onLassoComplete=o}initMesh(){if(!this.lassoMesh){const t=new nt({color:this.FILL_COLOR,transparent:!0,opacity:this.FILL_OPACITY,side:Bt,depthTest:!1});this.lassoMesh=new Gt(new De,t),this.lassoMesh.renderOrder=999,this.scene.add(this.lassoMesh)}if(!this.lassoLine){const t=new Os({color:this.STROKE_COLOR,depthTest:!1});this.lassoLine=new Vs(new De,t),this.lassoLine.renderOrder=999,this.scene.add(this.lassoLine)}}start(t,e){this.clearTimeoutId&&(clearTimeout(this.clearTimeoutId),this.clearTimeoutId=null),this.initMesh(),this.lassoPoints=[t],this.lastScreenPos=e,this.lassoMesh&&(this.lassoMesh.visible=!0),this.lassoLine&&(this.lassoLine.visible=!0),this.updateGeometry()}move(t,e){if(this.lassoPoints.length===0||!this.lastScreenPos)return;const o=e.x-this.lastScreenPos.x,s=e.y-this.lastScreenPos.y;o*o+s*s<this.MIN_PIXEL_DIST_SQ||(this.lassoPoints.push(t),this.lastScreenPos=e,this.updateGeometry())}end(){if(this.lassoPoints.length<3){this.clear();return}const t=this.updateGeometry(!0);this.computeSelectedPoints(t),this.clearTimeoutId&&(clearTimeout(this.clearTimeoutId),this.clearTimeoutId=null),this.clear()}updateGeometry(t=!1){if(!this.lassoMesh||!this.lassoLine||this.lassoPoints.length===0)return[];let e=[];if(this.lassoPoints.length>2){const s=new Fs(this.lassoPoints);s.closed=t,s.curveType="centripetal",s.tension=this.CURVE_TENSION;const l=this.lassoPoints.length*this.SMOOTHNESS_MULTIPLIER;e=s.getPoints(l)}else e=[...this.lassoPoints],t&&e.push(this.lassoPoints[0]);const o=new Us;if(e.length>0){o.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)o.lineTo(e[s].x,e[s].y)}return this.lassoMesh.geometry.dispose(),this.lassoMesh.geometry=new Ds(o),this.lassoLine.geometry.dispose(),this.lassoLine.geometry=new De().setFromPoints(e),e}clear(){this.lassoMesh&&(this.lassoMesh.visible=!1,this.lassoMesh.geometry&&this.lassoMesh.geometry.dispose()),this.lassoLine&&(this.lassoLine.visible=!1,this.lassoLine.geometry&&this.lassoLine.geometry.dispose()),this.lassoPoints=[],this.lastScreenPos=null}computeSelectedPoints(t){const e=tr(t,.1),o=xs(e),s=this.spatialIndex.getPointsInRect(o),l=e.map(h=>[h.x,h.y]),v=s.filter(h=>ur(l,[h.x,h.y])<=0);this.onLassoComplete(v)}dispose(){this.clearTimeoutId&&clearTimeout(this.clearTimeoutId),this.lassoMesh&&(this.scene.remove(this.lassoMesh),this.lassoMesh.geometry&&this.lassoMesh.geometry.dispose(),this.lassoMesh.material instanceof ft&&this.lassoMesh.material.dispose(),this.lassoMesh=null),this.lassoLine&&(this.scene.remove(this.lassoLine),this.lassoLine.geometry&&this.lassoLine.geometry.dispose(),this.lassoLine.material instanceof ft&&this.lassoLine.material.dispose(),this.lassoLine=null)}}class cr{container;scene;camera;renderer;controls;requestID=null;resizeObserver;frustumSize=20;zoomParams={h:5,z1:.1,z2:.11};atlasLayers;hdLayer;lassoLayer;spatialIndex=new Nn;globalUniforms={uZoom:{value:1}};onPointSelection=null;onHover=new ws;constructor(t,e){this.container=t,this.scene=new Bs,this.scene.background=new Re(16777215),this.initCamera(),this.initRenderer(),this.atlasLayers=new ue(this.scene),this.atlasLayers.setZoomParams(this.zoomParams),this.hdLayer=new jn(this.scene,e),this.hdLayer.setZoomReference(this.globalUniforms.uZoom),this.hdLayer.setZoomParams(this.zoomParams),this.lassoLayer=new dr(this.scene,this.spatialIndex,o=>{this.onPointSelection&&this.onPointSelection(o)}),this.controls=new Hn(this.camera,this.renderer.domElement,this.lassoLayer,this.spatialIndex),this.resizeObserver=new ResizeObserver(()=>this.onResize()),this.resizeObserver.observe(this.container),this.animate()}initCamera(){const t=this.container.clientWidth/this.container.clientHeight;this.camera=new Gs(this.frustumSize*t/-2,this.frustumSize*t/2,this.frustumSize/2,this.frustumSize/-2,.1,1e3),this.camera.position.z=10,this.camera.zoom=.08,this.camera.updateProjectionMatrix(),this.globalUniforms.uZoom.value=this.camera.zoom}initRenderer(){this.renderer=new Hs({antialias:!0,alpha:!1,powerPreference:"high-performance"}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.outputColorSpace=rt,this.renderer.setClearColor(16777215,1),this.container.appendChild(this.renderer.domElement)}async createMap(t,e,o){const s=X();this.spatialIndex.initTree(e),await this.atlasLayers.loadLayers(t,e,s.baseUrl,this.globalUniforms.uZoom,o)}animate(){this.requestID=requestAnimationFrame(()=>this.animate()),this.globalUniforms.uZoom.value!==this.camera.zoom&&(this.globalUniforms.uZoom.value=this.camera.zoom),this.hdLayer&&(this.hdLayer.updateAnimations(),this.hdLayer.show([])),this.updateHoverState(),this.renderer.render(this.scene,this.camera)}updateHoverState(){const t=this.controls.getHoveredPoint(this.zoomParams);(t?t.id:null)?(this.hdLayer.hover(t),this.onHover.emit(X().sha1Index[t.sha1][0].id)):(this.hdLayer.unhover(),this.onHover.emit())}setMouseMode(t){this.controls.setMode(t)}updateTints(){this.atlasLayers.updateTints(),this.hdLayer.updateTints()}updateBorder(){this.atlasLayers.updateBorderColors(),this.atlasLayers.updateBorderWidths(),this.hdLayer.updateBorder()}updatePosition(){this.atlasLayers.updatePositions()}setShowAsPoint(t){this.atlasLayers.setShowAsPoint(t)}setImageSize(t){this.zoomParams.h=t/50*1,this.hdLayer.setZoomParams(this.zoomParams),this.atlasLayers.setZoomParams(this.zoomParams)}onResize(){const t=this.container.clientWidth/this.container.clientHeight;this.camera.left=this.frustumSize*t/-2,this.camera.right=this.frustumSize*t/2,this.camera.top=this.frustumSize/2,this.camera.bottom=this.frustumSize/-2,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}getImageMaxSize(){const t=this.camera.zoom,{h:e,z1:o,z2:s}=this.zoomParams;let l;return t>=o&&t<s?l=e*(o/t):t>=s?l=e*(o/s):l=e,l}getCameraRect(){const t=this.camera.zoom;return{minX:this.camera.left/t+this.camera.position.x,maxX:this.camera.right/t+this.camera.position.x,minY:this.camera.bottom/t+this.camera.position.y,maxY:this.camera.top/t+this.camera.position.y}}lookAtRect(t){let e=this.getImageMaxSize(),o=ks(t);o.minX-=e,o.minY-=e,o.maxX+=e,o.maxY+=e,this.controls.lookAtRect(o)}dispose(){this.requestID&&cancelAnimationFrame(this.requestID),this.resizeObserver.disconnect(),this.controls.dispose(),this.renderer.dispose(),this.atlasLayers.dispose(),this.hdLayer?.dispose(),this.scene.clear()}}function pr(S){const t=Ut(null),e=V(null),o=X();return oe(()=>{if(!S.value){console.error("MapRenderer: Container ref is null on mount.");return}console.log("Initializing MapRenderer..."),t.value=new cr(S.value,o.baseImgUrl),t.value.onHover.addListener(s=>e.value=s),t.value.animate()}),$e(()=>{t.value&&(console.log("Disposing MapRenderer..."),t.value.dispose(),t.value=null)}),{map:t,hoverInstanceId:e}}const hr={class:"text-center",style:{position:"relative",top:"1px"}},vr={class:"image-container"},fr={key:0,class:"menu-section-card scrollable-section"},mr={class:"section-title"},gr={class:"flex-grow-1"},yr={class:"groups-list"},br=["onMouseover","onMouseleave","onClick"],_r={class:"group-name"},xr={class:"group-count"},wr=H({__name:"MapMenu",props:{selectedMap:{},colorOption:{},groups:{},images:{},hoverImageId:{}},emits:["update:selectedMap","update:spatialFunction","update:colorOption","clusters","hoverGroup","clickGroup","removeClusters"],setup(S,{emit:t}){const{t:e}=Le(),o=X(),s=S,l=t,v=V(!1),h=F(()=>o.instances[s.hoverImageId]);function p(){v.value=!v.value}return(n,i)=>(f(),w("div",{class:q(["map-menu",{collapsed:v.value}])},[a("div",{class:"toggle-header",onClick:p},[a("i",{class:q(v.value?"bi bi-arrow-left-circle":"bi bi-arrow-right-circle")},null,2)]),v.value?R("",!0):(f(),w(N,{key:0},[a("div",hr,O(n.$t("map.main_menu")),1),i[2]||(i[2]=a("div",{class:"mb-2"},null,-1)),a("div",vr,[h.value?(f(),U(At,{key:0,image:h.value,class:""},{default:T(()=>[E(Ot,{image:h.value,width:260,height:200,style:{"margin-left":"10px"}},null,8,["image"])]),_:1},8,["image"])):R("",!0)]),a("div",{class:q(["menu-content mt-2",{hidden:v.value}])},[s.groups.length?(f(),w("div",fr,[a("div",mr,[a("span",gr,O(s.colorOption=="property"?n.$t("map.group_property"):n.$t("map.group_cluster")),1),a("span",null,O(s.groups.length),1),s.colorOption=="cluster"?(f(),w("span",{key:0,class:"sb ms-2",onClick:i[0]||(i[0]=d=>l("removeClusters"))},i[1]||(i[1]=[a("i",{class:"bi bi-x"},null,-1)]))):R("",!0)]),a("div",yr,[(f(!0),w(N,null,ee(s.groups,d=>(f(),w("div",{key:d.id,class:"group-item",onMouseover:c=>l("hoverGroup",{groupId:d.id,value:!0}),onMouseleave:c=>l("hoverGroup",{groupId:d.id,value:!1}),onClick:c=>l("clickGroup",d)},[a("div",{class:"group-color",style:Q({backgroundColor:d.color})},null,4),a("span",_r,O(d.name),1),a("span",xr,O(d.count),1)],40,br))),128))])])):R("",!0)],2)],64))],2))}}),kr=j(wr,[["__scopeId","data-v-376da823"]]),$r="/icons/network2_white.svg",Mr={class:"cont3"},Sr=H({__name:"PointMapSelection",props:{modelValue:{}},emits:["update:modelValue"],setup(S,{emit:t}){const e=X(),o=S,s=t,l=V(null),v=V([]),h=V();async function p(){v.value=Vt(e.maps).map(i=>({value:i.id,label:i.id+": "+i.source+"."+i.name,icon:"geo"}));let n=o.modelValue;n&&!e.maps[n]&&(n=null),!n&&v.value.length&&(console.log("Defaulting to first available map",{old:o.modelValue,new:v.value[0].value}),n=v.value[0].value),n!==h.value&&(h.value=n,s("update:modelValue",n))}return W(()=>o.modelValue,n=>h.value=n),W(()=>e.maps,()=>p()),W(h,n=>s("update:modelValue",n)),oe(()=>{h.value=o.modelValue,p()}),Y.ctrlF.on(()=>l.value?.focus()),(n,i)=>(f(),w("div",Mr,[E(it,{options:v.value,modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=d=>h.value=d),placeholder:n.$t("map.select_map"),"no-border":!0,teleport:!0},null,8,["options","modelValue","placeholder"])]))}}),Ir=j(Sr,[["__scopeId","data-v-e98deea9"]]),Cr={class:"glass-box2 d-flex align-items-center"},Pr={class:"toolbar-item px-1 d-flex align-items-center gap-1"},zr={key:1,style:{"min-width":"150px"},class:"map-select"},Er={class:"toolbar-item"},Rr={class:"toolbar-item d-flex align-items-center gap-1"},Tr={style:{"min-width":"120px"}},Lr={key:0,class:"toobar-item"},Ar=H({__name:"Toolbar",props:{mouseMode:{},imageSize:{},showPoint:{type:Boolean},selectedMap:{},colorOption:{},hasMaps:{type:Boolean},images:{}},emits:["update:mouseMode","update:imageSize","update:showPoint","update:selectedMap","update:colorOption","clusters","delete:map"],setup(S,{emit:t}){const{t:e}=Le(),o=X(),s=S,l=t,v=F(()=>[{value:"property",label:e("map.color_prop"),icon:"stack"},{value:"cluster",label:e("map.color_cluster"),icon:"stack"}]);function h(d){l("update:mouseMode",d)}function p(){X().deleteMap(s.selectedMap)}async function n(d){await o.loadMaps(),l("update:selectedMap",d.value.id)}const i=F(()=>Object.keys(fe().getMainTab().collection.groupManager.selectedImages.value).map(Number).map(d=>o.instances[d]));return(d,c)=>(f(),w("div",Cr,[a("div",Pr,[s.hasMaps?(f(),w("div",{key:0,class:"tool sb",onClick:p},c[8]||(c[8]=[a("i",{class:"bi bi-trash",style:{opacity:"0.8"}},null,-1)]))):R("",!0),s.hasMaps?(f(),w("div",zr,[E(Ir,{"model-value":s.selectedMap,"onUpdate:modelValue":c[0]||(c[0]=x=>l("update:selectedMap",x))},null,8,["model-value"])])):R("",!0)]),a("div",Er,[E(pt,{action:"map",class:"bb ps-1 pe-1",style:{"font-size":"14px"},"no-border":!0,onCall:n,images:i.value},{default:T(()=>[c[9]||(c[9]=a("i",{class:"bi bi-boxes"},null,-1)),ie(" "+O(d.$t("map.create")),1)]),_:1},8,["images"])]),c[15]||(c[15]=a("div",{class:"divider"},null,-1)),a("div",Rr,[a("div",Tr,[E(it,{teleport:!0,options:v.value,"model-value":s.colorOption,"onUpdate:modelValue":c[1]||(c[1]=x=>l("update:colorOption",x)),"no-border":!0},null,8,["options","model-value"])])]),s.colorOption==="cluster"?(f(),w("div",Lr,[E(pt,{images:s.images,action:"group",class:"sb ps-1 pe-1",style:{"font-size":"14px"},"no-border":!0,onGroups:c[2]||(c[2]=x=>l("clusters",x))},{default:T(()=>c[10]||(c[10]=[a("img",{class:"cluster-icon",src:$r},null,-1)])),_:1},8,["images"])])):R("",!0),c[16]||(c[16]=a("div",{class:"divider"},null,-1)),a("div",{class:q(["tool",{selected:s.showPoint}]),onClick:c[3]||(c[3]=x=>l("update:showPoint",!s.showPoint)),title:"Show Points"},c[11]||(c[11]=[a("i",{class:"bi bi-dot"},null,-1)]),2),a("div",{class:q(["tool",{selected:s.mouseMode=="pan"}]),onClick:c[4]||(c[4]=x=>h("pan")),title:"Pan"},c[12]||(c[12]=[a("i",{class:"bi bi-hand-index-thumb"},null,-1)]),2),a("div",{class:q(["tool",{selected:s.mouseMode=="lasso-plus"}]),onClick:c[5]||(c[5]=x=>h("lasso-plus")),title:"Lasso Add"},c[13]||(c[13]=[a("i",{class:"bi bi-plus-circle-dotted"},null,-1)]),2),a("div",{class:q(["tool",{selected:s.mouseMode=="lasso-minus"}]),onClick:c[6]||(c[6]=x=>h("lasso-minus")),title:"Lasso Remove"},c[14]||(c[14]=[a("i",{class:"bi bi-dash-circle-dotted"},null,-1)]),2),c[17]||(c[17]=a("div",{class:"divider"},null,-1)),c[18]||(c[18]=a("div",{class:"tool-icon ms-1"},[a("i",{class:"bi bi-aspect-ratio"})],-1)),E(Lt,{style:{width:"60px"},min:10,max:100,modelValue:s.imageSize,"onUpdate:modelValue":c[7]||(c[7]=x=>l("update:imageSize",x))},null,8,["modelValue"])]))}}),Or=j(Ar,[["__scopeId","data-v-22afe6c7"]]),Vr={class:"main-layout"},Fr={class:"toolbar-container"},Ur={class:"map-view-container"},Dr=.05,Br="#FFFFFF",Gr="#CCCCCC",Hr="#5DACFF",Ie="#777777",Nr=H({__name:"MapView",props:{tab:{}},setup(S){const t=X(),e=S,o=V(null),{map:s,hoverInstanceId:l}=pr(o),v=V("pan"),h=V(1e3),p=V(l.value),n=V(!0),i=V([]);let d=[],c={},x={};const $=V({}),P=Ut([]);function M(g,y){let k=0,D=0,B=0,K=0,Z=!1;for(let J=0;J<g.length;J++){let ae=g[J],te=c[ae.sha1];te&&(Z?(k=Math.min(k,te.x),D=Math.min(D,te.y),B=Math.max(B,te.x),K=Math.max(K,te.y)):(k=te.x,D=te.y,B=te.x,K=te.y,Z=!0))}return{minX:k,minY:D,maxX:B,maxY:K,color:y}}function C(g,y=0){if(g.name)return g.name;if(g.meta.propertyValues?.length){const k=g.meta.propertyValues[0],D=t.properties[k.propertyId];return ze(D.type)?t.tags[k.value]?.value??"undefined":D.name+": "+k.value}return"Group "+y}function z(){P.value.forEach(k=>{k.color=Ie,k.borderColor=Ie,k.border=0,k.tint=Br,k.tintAlpha=0,k.z=1});const g=Object.keys($.value).length>0;for(let k of i.value){const D=$.value[k.id];for(let B of k.points)B.border=Dr,B.borderColor=k.color,D?(B.tintAlpha=0,B.z=1.1):g?(B.tintAlpha=1,B.tint=Gr,B.z=1):(B.tintAlpha=0,B.z=1)}const y=e.tab.collection.groupManager.selectedImages.value;Object.keys(y).map(Number).forEach(k=>{const D=c[t.instances[k].sha1];D&&(D.tint=Hr,D.tintAlpha=.8)}),s.value&&(s.value.updateBorder(),s.value.updateTints(),s.value.updatePosition())}function r(){let g=[];e.tab.state.mapOptions.groupOption==="property"?g=e.tab.collection.groupManager.result.root.children:g=d,g=g.map(Z=>({...Z}));const k=new Set;P.value.forEach(Z=>k.add(Z.sha1));for(let Z of g)Z.images=Z.images.filter(J=>k.has(J.sha1));if(g=g.filter(Z=>Z.images.length>0),!g.length){i.value=[],z();return}const D=g.length,B=Ms(D),K=[];x={},g.forEach((Z,J)=>{let ae=B[J];const te=Z.meta?.propertyValues?.[0]?.propertyId;if(te){const ce=t.properties[te];if(ze(ce.type)){const _e=Z.meta.propertyValues[0].value;_e!==void 0?ae=Ss[t.tags[_e].color].color:ae=Is.color}}x[Z.id]=Z.images.map(ce=>ce.sha1);const Me=Array.from(new Set(Z.images.map(ce=>c[ce.sha1]).filter(Boolean)));K.push({id:Z.id,name:C(Z,J),count:Z.images.length,color:ae,box:M(Z.images,ae),points:Me})}),i.value=K,z()}async function u(g){if(!t.maps[g])return;t.maps[g].data||await t.loadMapData(g),c={};const y=[],k=t.maps[g].data,D=new Set;e.tab.collection.filterManager.result.images.forEach(B=>D.add(B.sha1));for(let B=0;B<k.length;B+=3){const K=k[B];if(!D.has(K))continue;const Z=k[B+1],J=k[B+2],ae=t.sha1Index[K]?.[0];if(!ae)continue;const te={id:ae.id,x:Z,y:J,z:1,color:Ie,sha1:K,ratio:ae.containerRatio,order:1,border:0,tintAlpha:0,borderColor:Ie};y.push(te),c[K]=te}if(P.value=y,r(),s.value){const B=t.atlas;if(!B){n.value=!1;return}s.value.createMap(B,P.value,e.tab.state.mapOptions.showPoints)}}function m(g){g.value?$.value[g.groupId]=!0:delete $.value[g.groupId],$.value={...$.value},z()}const L=g=>{let y=[];for(let k of g)t.sha1Index[k.sha1]&&y.push(...t.sha1Index[k.sha1].map(D=>D.id));v.value=="lasso-plus"&&e.tab.collection.groupManager.selectImages(y),v.value=="lasso-minus"&&e.tab.collection.groupManager.unselectImages(y)};async function A(g){await t.deleteMap(g)}function b(){u(e.tab.state.mapOptions.selectedMap)}function _(){e.tab.state.mapOptions.groupOption=="cluster"&&(d=[],r())}return W(v,g=>{s.value?.setMouseMode(g)}),W(e.tab.collection.groupManager.selectedImages,()=>z()),W(()=>e.tab.state.mapOptions.selectedMap,g=>{g!=null&&u(g)}),W(()=>e.tab.state.mapOptions.groupOption,()=>r()),W(()=>e.tab.state.mapOptions.showPoints,g=>s.value.setShowAsPoint(g)),W(()=>e.tab.state.mapOptions.imageSize,g=>s.value.setImageSize(g)),W(l,()=>{l.value&&(p.value=l.value)}),W(s,g=>{g&&(g.onPointSelection=L,P.value.length>0&&g.atlasLayers&&z(),g.setImageSize(e.tab.state.mapOptions.imageSize))}),W(h,()=>console.log("map width",h.value)),W(()=>e.tab.state.mapOptions,()=>e.tab.saveState(),{deep:!0}),W(()=>t.atlas,async()=>{u(e.tab.state.mapOptions.selectedMap)}),oe(async()=>{e.tab.collection.groupManager.onResultChange.addListener(b),await t.loadMaps(),u(e.tab.state.mapOptions.selectedMap),s.value&&s.value.setMouseMode(v.value)}),$e(()=>{e.tab.collection.groupManager.onResultChange.removeListener(b)}),(g,y)=>(f(),w("div",Vr,[a("div",Fr,[E(Or,{"mouse-mode":v.value,"onUpdate:mouseMode":y[0]||(y[0]=k=>v.value=k),"image-size":e.tab.state.mapOptions.imageSize,"onUpdate:imageSize":y[1]||(y[1]=k=>e.tab.state.mapOptions.imageSize=k),"show-point":e.tab.state.mapOptions.showPoints,"onUpdate:showPoint":y[2]||(y[2]=k=>e.tab.state.mapOptions.showPoints=k),"selected-map":e.tab.state.mapOptions.selectedMap,"onUpdate:selectedMap":y[3]||(y[3]=k=>e.tab.state.mapOptions.selectedMap=k),"color-option":e.tab.state.mapOptions.groupOption,"onUpdate:colorOption":y[4]||(y[4]=k=>{e.tab.state.mapOptions.groupOption=k,e.tab.saveState()}),"has-maps":I(t).hasMaps,images:g.tab.collection.groupManager.result.root.images,onClusters:y[5]||(y[5]=k=>{ht(d)?d.value=k:d=k,r()}),"onDelete:map":A},null,8,["mouse-mode","image-size","show-point","selected-map","color-option","has-maps","images"])]),a("div",Ur,[E($s,{onResize:y[6]||(y[6]=k=>h.value=k),class:"map-resizable-wrapper",disabled:!0},{default:T(()=>[a("div",{class:q(["map-container",{"cursor-grab":v.value=="pan","cursor-lasso":v.value.startsWith("lasso")}])},[a("div",{ref_key:"canvasContainer",ref:o,class:"canvas-wrapper"},null,512)],2)]),_:1}),E(kr,{"selected-map":e.tab.state.mapOptions.selectedMap,"onUpdate:selectedMap":y[7]||(y[7]=k=>e.tab.state.mapOptions.selectedMap=k),"color-option":e.tab.state.mapOptions.groupOption,"onUpdate:colorOption":y[8]||(y[8]=k=>e.tab.state.mapOptions.groupOption=k),"hover-image-id":p.value,groups:i.value,images:g.tab.collection.groupManager.result.root.images,onClusters:y[9]||(y[9]=k=>{ht(d)?d.value=k:d=k,r()}),onHoverGroup:m,onClickGroup:y[10]||(y[10]=k=>I(s)?.lookAtRect(k.box)),onRemoveClusters:_},null,8,["selected-map","color-option","hover-image-id","groups","images"])])]))}}),Zr=j(Nr,[["__scopeId","data-v-cdb0fd9f"]]),Wr={key:0,class:"m-0 p-0"},qr={key:0},Yr=H({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(S,{expose:t}){const e=fe(),o=X(),s=S;t({updateScrollerWidth:C});const l=V({}),v=V(!0),h=V(null),p=V(null),n=V(null),i=V(0),d=V(0),c=Pe({groups:!1}),x=F(()=>s.tab.getVisibleProperties());function $(){h.value&&p.value?i.value=s.height-h.value.clientHeight-p.value.clientHeight:h.value?i.value=s.height-h.value.clientHeight:i.value=0}function P(z){l.value=s.tab.collection.groupManager.result.index[z],re(()=>$())}function M(){l.value={},re(()=>$())}async function C(){await re(),d.value=h.value?.clientWidth??d.value}return oe(()=>{C(),window.addEventListener("resize",C)}),$e(()=>{window.removeEventListener("resize",C)}),W(()=>s.tab.state.imageSize,()=>re($)),W(()=>s.filterOpen,()=>re($)),W(()=>s.height,async()=>{await re($)}),oe($),(z,r)=>(f(),w(N,null,[a("div",{id:"main-content",ref_key:"filterElem",ref:h},[s.filterOpen?(f(),U(cn,{key:0,tab:s.tab,"compute-status":c},null,8,["tab","compute-status"])):R("",!0)],512),a("div",{ref_key:"boxElem",ref:p,class:"m-0 p-0"},[l.value.id?(f(),w("div",Wr,[E(Vn,{tab:s.tab,group:l.value,"image-size":s.tab.state.imageSize,width:d.value,height:50,onClose:M,onScroll:n.value.scrollTo,onUpdate:r[0]||(r[0]=u=>re(()=>$()))},null,8,["tab","group","image-size","width","onScroll"])])):R("",!0)],512),I(o).isLoaded&&d.value>0&&i.value>0&&v.value?(f(),w("div",qr,[s.tab.state.display=="tree"?(f(),U(Cs,{key:0,"input-key":"main-view-tree","group-manager":s.tab.collection.groupManager,"image-size":s.tab.state.imageSize,height:i.value,properties:x.value,"hide-if-modal":!0,"selected-images":s.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:n,width:d.value-20,onRecommend:P,style:{"margin-left":"10px"}},null,8,["group-manager","image-size","height","properties","selected-images","width"])):R("",!0),s.tab.state.display=="grid"?(f(),w("div",{key:1,style:Q([{width:d.value-12+"px"},{"margin-left":"10px"}]),class:"grid-container"},[E(Ps,{tab:z.tab,manager:s.tab.collection.groupManager,height:i.value-15,width:d.value-12,"selected-properties":x.value,class:"p-0 m-0","show-images":!0,"selected-images":s.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:n,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):R("",!0),s.tab.state.display=="graph"?(f(),U(Gn,{key:2,collection:s.tab.collection,height:i.value-15,style:{"margin-left":"10px"}},null,8,["collection","height"])):R("",!0),s.tab.state.display=="map"&&I(e).loaded?(f(),U(Zr,{key:3,style:Q({height:i.value-0+"px"}),tab:s.tab},null,8,["style","tab"])):R("",!0)])):R("",!0)],64))}}),Xr=j(Yr,[["__scopeId","data-v-02e2c96c"]]),jr=H({__name:"TabButton",props:{tab:{}},setup(S){const t=fe(),e=V(""),o=V(null),s=V(!1),l=V(!1),v=S,h=F(()=>v.tab.state.id);function p(){t.selectMainTab(v.tab.state.id)}function n(){l.value=!0,e.value=v.tab.state.name,re(()=>o.value.focus())}function i(){v.tab.renameTab(e.value),l.value=!1}async function d(){confirm("Are you sure to delete Tab: "+v.tab.state.name)&&t.deleteTab(v.tab.state.id)}return oe(()=>{v.tab.isNew&&n()}),(c,x)=>(f(),w("div",{class:"d-flex d-row me-2",onMouseenter:x[1]||(x[1]=$=>s.value=!0),onMouseleave:x[2]||(x[2]=$=>s.value=!1)},[l.value?(f(),w("div",{key:1,class:q(["tab-button",h.value==I(t).mainTab?" active":""])},[a("form",{onSubmit:pe(i,["stop","prevent"])},[Ae(a("input",{onFocusout:i,onKeydown:Rt(i,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":x[0]||(x[0]=$=>e.value=$),ref_key:"inputElem",ref:o},null,544),[[Oe,e.value]])],32)],2)):(f(),w(N,{key:0},[E(G,{message:"main.menu.rename_tab_tooltip"},{default:T(()=>[a("i",{onClick:n,class:q(["bi bi-pencil me-1 tab-icon hover-light",s.value&&I(t).mainTab==h.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),a("div",{class:q(["tab-button",h.value==I(t).mainTab?" active":""]),onClick:p},[a("span",null,O(v.tab.state.name),1)],2),E(G,{message:"main.menu.delete_tab_tooltip"},{default:T(()=>[a("i",{onClick:d,class:q(["btn-icon bi bi-x tab-icon hover-light",s.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Kr={class:"d-flex d-row",style:{cursor:"pointer"}},Qr={class:"pt-1"},Jr={key:0,class:"bb bi bi-chevron-down"},el={key:1,class:"bb bi bi-chevron-right"},tl={style:{"padding-top":"2px","margin-right":"2px"}},sl={class:"lang"},ol=["value"],al=["value"],il=H({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(S,{emit:t}){const{locale:e}=Le(),o=be(),s=fe(),l=S,v=t;async function h(d){await s.addTab("New Tab")}const p=["fr","en"];function n(){v("update:filterOpen",!l.filterOpen)}function i(d){l.reRender();const c=d.target.value;e.value=c,ke().setLang(c)}return(d,c)=>(f(),w("nav",null,[a("div",Kr,[a("div",Qr,[a("span",{onClick:n},[l.filterOpen?(f(),w("i",Jr)):(f(),w("i",el))])]),(f(!0),w(N,null,ee(I(s).loadedTabs,x=>(f(),w("div",null,[E(jr,{tab:I(s).getTab(x)},null,8,["tab"])]))),256)),E(G,{message:"main.menu.add_tab_tooltip"},{default:T(()=>[a("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:h,id:"add-tab-button"},c[2]||(c[2]=[a("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),c[5]||(c[5]=a("div",{class:"flex-grow-1"},null,-1)),I(o).clientState.user?(f(),w("div",{key:0,style:{margin:"2px"},class:"bb me-3 text-secondary",onClick:c[0]||(c[0]=x=>I(zs)().disconnectUser())},O(I(o).clientState.user.name),1)):R("",!0),a("div",tl,[E(G,{message:"modals.notif.icon"},{default:T(()=>[a("span",{class:"bb",onClick:c[1]||(c[1]=x=>I(o).showModal(I(le).NOTIF))},c[3]||(c[3]=[a("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),a("div",sl,[c[4]||(c[4]=a("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),a("select",{value:d.$i18n.locale,onChange:i},[(f(),w(N,null,ee(p,(x,$)=>a("option",{key:`Lang${$}`,value:x},O(x.toUpperCase()),9,al)),64))],40,ol)])])]))}}),et=H({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(S){const t=S,e=F(()=>t.force?"100%":t.max==0?"0%":t.current>=t.max?"100%":Math.floor(t.current/t.max*100)+"%");return(o,s)=>(f(),w("span",null,O(e.value),1))}}),nl={key:0,class:"center"},rl={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},ll={class:"d-flex text-secondary"},ul={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},dl={class:"d-flex text-secondary",style:{"font-size":"14px"}},cl={key:0,class:"bi bi-check text-success"},pl={class:"d-flex text-secondary",style:{"font-size":"14px"}},hl={key:0,class:"bi bi-check text-success"},vl={class:"d-flex text-secondary",style:{"font-size":"14px"}},fl={key:0,class:"bi bi-check text-success"},ml={class:"d-flex text-secondary",style:{"font-size":"14px"}},gl={key:0,class:"bi bi-check text-success"},yl={class:"d-flex text-secondary",style:{"font-size":"14px"}},bl={key:0,class:"bi bi-check text-success"},_l=H({__name:"DataLoad",setup(S){const t=X();return(e,o)=>I(t).loadState?(f(),w("div",nl,[a("div",rl,[a("div",null,[a("div",ll,[o[0]||(o[0]=a("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedProperty},null,8,["loading"]),I(t).loadState.finishedProperty?(f(),w("i",ul)):R("",!0)]),a("div",dl,[o[1]||(o[1]=a("div",{class:"me-1"},"PropertyGroups",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedPropertyGroups},null,8,["loading"]),I(t).loadState.finishedPropertyGroups?(f(),w("i",cl)):R("",!0)]),a("div",pl,[o[2]||(o[2]=a("div",{class:"me-1"},"Tags",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedTags},null,8,["loading"]),I(t).loadState.finishedTags?(f(),w("i",hl)):R("",!0)]),a("div",vl,[o[3]||(o[3]=a("div",{class:"me-1"},"Instances",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedInstance},null,8,["loading"]),I(t).loadState.finishedInstance?(f(),w("i",fl)):R("",!0),E(et,{current:I(t).loadState.counterInstance,max:I(t).loadState.maxInstance,force:I(t).loadState.finishedInstance},null,8,["current","max","force"])]),a("div",ml,[o[4]||(o[4]=a("div",{class:"me-1"},"InstanceValues",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedInstanceValues},null,8,["loading"]),I(t).loadState.finishedInstanceValues?(f(),w("i",gl)):R("",!0),E(et,{current:I(t).loadState.counterInstanceValue,max:I(t).loadState.maxInstanceValue,force:I(t).loadState.finishedInstanceValues},null,8,["current","max","force"])]),a("div",yl,[o[5]||(o[5]=a("div",{class:"me-1"},"ImageValues",-1)),E(ve,{class:"me-2",loading:!I(t).loadState.finishedImageValues},null,8,["loading"]),I(t).loadState.finishedImageValues?(f(),w("i",bl)):R("",!0),E(et,{current:I(t).loadState.counterImageValue,max:I(t).loadState.maxImageValue,force:I(t).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):R("",!0)}}),xl=j(_l,[["__scopeId","data-v-8b416e86"]]),wl={key:0},kl={id:"panoptic"},$l={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Ml={class:"w-100"},Sl={key:0,class:"custom-hr"},Il={key:2,class:"loading"},Cl={class:"text-center"},Pl={key:3,class:"loading"},zl=H({__name:"ProjectView",setup(S){const t=ke(),e=X(),o=be(),s=fe(),l=V(null),v=V(null),h=V(window.innerHeight),p=V(!1),n=V(!0),i=V(!0),d=F(()=>h.value-(v.value?.clientHeight??0)),c=F(()=>l.value?.filteredImages.map(r=>r.id));let x=navigator.userAgent.indexOf("Mac OS X")!==-1;async function $(){n.value=!1,await re(),n.value=!0}oe(async()=>{if(!o.isProjectLoaded){vt.push("/");return}t.init(),re(()=>{window.addEventListener("resize",P),P()}),window.addEventListener("keydown",r=>{r.key=="Meta"&&(Y.cmd=!0),r.key=="Control"&&(Y.ctrl=!0),r.key=="Alt"&&(x&&(Y.ctrl=!0),Y.alt=!0),r.key=="Shift"&&(Y.shift=!0),r.key=="ArrowLeft"&&(Y.left=!0),r.key=="ArrowRight"&&(Y.right=!0),r.key=="Z"&&Y.ctrl&&e.redo(),r.key=="z"&&Y.ctrl&&e.undo(),r.key=="f"&&(Y.ctrl||Y.cmd)&&(r.preventDefault(),Y.ctrlF.emit())}),window.addEventListener("keyup",r=>{r.key=="Meta"&&(Y.cmd=!1),r.key=="Control"&&(Y.ctrl=!1),r.key=="Alt"&&(x&&(Y.ctrl=!1),Y.alt=!1),r.key=="Shift"&&(Y.shift=!1),r.key=="ArrowLeft"&&(Y.left=!1),r.key=="ArrowRight"&&(Y.right=!1)}),window.addEventListener("mousemove",r=>{Y.ctrl=r.ctrlKey,Y.alt=r.altKey,Y.shift=r.shiftKey,Y.cmd=r.metaKey,x&&(Y.ctrl=Y.ctrl||Y.alt)})}),$e(()=>{window.removeEventListener("resize",P),ke().clear()});function P(){h.value=window.innerHeight,p.value=!0}function M(){o.showModal(le.EXPORT,c)}function C(){vt.push("/")}function z(){l.value&&l.value.updateScrollerWidth()}return(r,u)=>n.value?(f(),w("div",wl,[l.value&&!l.value.imageList?(f(),U(Ns,{key:0,tutorial:"project"})):R("",!0),a("div",kl,[a("div",$l,[I(e).isLoaded?I(e).isLoaded?(f(),w(N,{key:1},[a("div",null,[E(ea,{onExport:u[0]||(u[0]=m=>M()),onToggle:z})]),a("div",Ml,[a("div",{class:"ms-1",ref_key:"navElem",ref:v},[E(il,{"re-render":$,filterOpen:i.value,"onUpdate:filterOpen":u[1]||(u[1]=m=>i.value=m)},null,8,["filterOpen"])],512),p.value?(f(),w("div",Sl)):R("",!0),E(Nt,{id:I(s).mainTab},{default:T(({tab:m})=>[E(Xr,{tab:m,height:d.value,ref_key:"mainViewRef",ref:l,"filter-open":i.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):I(o).isProjectLoaded?(f(),w("div",Pl,u[2]||(u[2]=[a("i",{class:"spinner-border",role:"status"},null,-1),a("span",{class:"ms-1"},"Loading...",-1)]))):(f(),w("div",Il,[a("div",Cl,[a("div",null,O(r.$t("main.status.no_project")),1),a("div",{class:"bi bi-house p-3",onClick:C,style:{"font-size":"50px",cursor:"pointer"}})])])):(f(),w("div",{key:0,class:"d-flex flex-column w-100",style:Q({height:h.value+"px"})},[E(xl,{class:"flex-grow-1"})],4))])])])):R("",!0)}}),Ll=j(zl,[["__scopeId","data-v-ddaa0fb1"]]);export{Ll as default};
