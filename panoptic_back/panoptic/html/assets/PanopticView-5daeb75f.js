import{d as T,h as N,r as w,c as I,i as se,o as s,a,b as e,w as le,v as re,F,m as j,s as b,y as ie,t as $,k as M,x as k,n as U,D as J,z as Le,_ as R,A as de,B as A,P as S,C as Ge,e as l,E as $e,l as g,G as Fe,H as De,I as Ne,S as Re,J as Ue,K as je,L as Ae,p as W,f as Y,N as he,O as P,Q as Ee,q as Q,T as He,R as Pe,U as H,V as fe,W as Ie,u as ke,M as te,g as be,X as Be,Y as qe,Z as Se,$ as ze,a0 as Ke,a1 as ee,a2 as X,a3 as Qe,a4 as We,a5 as Ye,a6 as Xe,a7 as Je,a8 as Ze,a9 as ne,aa as et,ab as tt,ac as Z,ad as st,ae as ot,af as at,ag as nt,j as Ce,ah as B,ai as lt}from"./index-89225c08.js";import{_ as it}from"./Tutorial-325b12e3.js";const rt={class:"mb-1 ps-2 pe-2"},dt=["onClick"],xe=T({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const t=N(),o=d,p=r,v=w(null),y=w(""),h=I(()=>{let _=t.propertyList;return o.ignoreIds&&(_=_.filter(c=>!o.ignoreIds.includes(c.id))),_.filter(c=>c.name.includes(y.value))});return se(()=>v.value.focus()),(_,c)=>(s(),a("div",null,[e("div",rt,[le(e("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:v,"onUpdate:modelValue":c[0]||(c[0]=i=>y.value=i)},null,512),[[re,y.value]])]),(s(!0),a(F,null,j(h.value,i=>(s(),a("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:n=>p("select",i.id)},[b(ie,{type:i.type,class:"me-2"},null,8,["type"]),e("a",null,$(i.name),1)],8,dt))),256))]))}}),pt=["disabled"],ut={class:"m-0 p-1"},ct=["onClick"],_t=T({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const t=N(),o=d,p=r,v=w(null),y=I(()=>t.data.properties[o.propertyId]),h=I(()=>Le(y.value.type));async function _(c){p("update:modelValue",c),v.value.hide()}return(c,i)=>(s(),M(J,{onHide:i[0]||(i[0]=n=>p("hide")),ref_key:"dropdownElem",ref:v,parent:o.parent},{button:k(()=>[e("div",{class:U(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[e("span",null,$(c.$t("modals.filters.operators."+o.modelValue)),1)],10,pt)]),popup:k(()=>[e("div",ut,[(s(!0),a(F,null,j(h.value,n=>(s(),a("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>_(n)},[e("a",null,$(c.$t("modals.filters.operators."+n)),1)],8,ct))),256))])]),_:1},8,["parent"]))}});const mt=R(_t,[["__scopeId","data-v-29ed354e"]]),vt=d=>(W("data-v-49043c13"),d=d(),Y(),d),yt={class:"m-0 p-0"},ft={key:1},gt={class:"d-flex mode-header"},ht={class:"me-3"},bt=vt(()=>e("div",{class:"flex-fill"},null,-1)),$t={key:0,class:"me-2",style:{width:"100%"}},kt=T({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=N(),t=d,o=w(null),p=w(null),v=w(null),y=w(0),h=w(null),_=w(null),c=I(()=>t.filterId!==void 0?t.filterId:h.value),i=I(()=>{if(!(c.value==null||c.value==-1))return t.manager.filterIndex[c.value]}),n=I(()=>i.value==null?void 0:r.data.properties[i.value.propertyId]);function u(){y.value=t.mode,t.mode==2&&t.filterId==null&&D(t.propertyId)}function m(){o.value&&o.value.hide()}function f(){y.value=0}function x(){m(),t.manager.deleteFilter(c.value),t.manager.update(!0)}function D(z){let C=t.manager.addNewFilter(z,t.parentId);t.manager.update(!0),h.value=C.id,y.value=2}function K(z){_.value=null,t.manager.updateFilter(c.value,{operator:z}),t.manager.update(!0),p.value&&p.value.focus()}function ae(){console.log("update value",_.value),t.manager.updateFilter(c.value,{value:_.value}),t.manager.update(!0)}function O(){if(!i.value)return;const z=r.data.properties[i.value.propertyId];if(je(z.type))return;const C=_.value??Ae(z.type);i.value.value!=C&&ae()}function E(){i.value&&(r.data.properties[i.value.propertyId].type==S.date&&i.value.value?_.value=new Date(i.value.value):_.value=i.value.value)}return se(E),A(()=>i.value,()=>E()),(z,C)=>(s(),M(J,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:f,parent:t.parent},{button:k(()=>[e("div",yt,[Ge(z.$slots,"default",{},void 0,!0)])]),popup:k(()=>[e("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[y.value!=0?(s(),a(F,{key:0},[y.value==1?(s(),M(xe,{key:0,onSelect:D,"ignore-ids":[l($e).folders]},null,8,["ignore-ids"])):g("",!0),y.value==2?(s(),a("div",ft,[e("div",gt,[e("div",ht,$(n.value.name),1),b(mt,{"property-id":i.value.propertyId,"model-value":i.value.operator,"onUpdate:modelValue":K,parent:v.value},null,8,["property-id","model-value","parent"]),bt,e("div",null,[e("i",{class:"bi bi-trash-fill",onClick:x})])]),l(Fe)(i.value.operator)?(s(),a("div",$t,[n.value.type==l(S).multi_tags||n.value.type==l(S).tag?(s(),M(De,{key:0,modelValue:_.value,"onUpdate:modelValue":[C[0]||(C[0]=V=>_.value=V),ae],"auto-focus":!0,property:l(r).data.properties[i.value.propertyId],ref_key:"inputElem",ref:p,onHide:m},null,8,["modelValue","property"])):n.value.type==l(S).color?(s(),M(Ne,{key:1,property:n.value,modelValue:_.value,"onUpdate:modelValue":[C[1]||(C[1]=V=>_.value=V),C[2]||(C[2]=()=>{m(),O()})]},null,8,["property","modelValue"])):n.value.type==l(S).date?(s(),M(Re,{key:2,property:n.value,modelValue:_.value,"onUpdate:modelValue":[C[3]||(C[3]=V=>_.value=V),C[4]||(C[4]=()=>{m(),O()})]},null,8,["property","modelValue"])):(s(),M(Ue,{key:3,"no-html":!0,modelValue:_.value,"onUpdate:modelValue":C[5]||(C[5]=V=>_.value=V),width:-1,"min-height":20,"no-nl":l(r).data.properties[i.value.propertyId].type==l(S).number,"url-mode":l(r).data.properties[i.value.propertyId].type==l(S).url,"only-number":l(r).data.properties[i.value.propertyId].type==l(S).number,onBlur:O,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):g("",!0)])):g("",!0)],64)):g("",!0)],512)]),_:3},8,["parent"]))}});const ue=R(kt,[["__scopeId","data-v-49043c13"]]),oe=d=>(W("data-v-81b7150f"),d=d(),Y(),d),xt={class:"d-flex flex-row"},wt={key:1,class:"d-flex",style:{width:"150px"}},It={class:"flex-grow-1"},St={key:1,style:{"padding-top":"1px"}},Ct={style:{width:"20px","margin-top":"2px"},class:"text-center"},Mt=oe(()=>e("i",{class:"bi bi-link-45deg"},null,-1)),Vt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Ft=oe(()=>e("i",{class:"bi bi-chevron-down"},null,-1)),Et=oe(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),Pt={key:0,class:"ms-3 pt-1"},zt=oe(()=>e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Tt=oe(()=>e("i",{class:"bi bi-filter me-2"},null,-1)),Ot=oe(()=>e("i",{class:"bi bi-collection me-2"},null,-1)),Lt=oe(()=>e("i",{class:"bi bi-trash me-2"},null,-1)),Gt={key:1},Dt=T({__name:"PropertyOptions",props:{property:Object},setup(d){const r=N(),t=r.getTabManager(),o=d,p=w(!1),v=w(!1),y=w(""),h=w(!1),_=I(()=>r.getTab()),c=I(()=>_.value.visibleProperties[o.property.id]==!0),i=I(()=>t.collection.filterManager.state.filter.filters.some(V=>!V.isGroup&&V.propertyId==o.property.id)),n=I(()=>t.collection.groupManager.state.groupBy.includes(o.property.id)),u=I(()=>t.collection.sortManager.state.sortBy.includes(o.property.id)),m=I(()=>{if(i.value)return t.collection.filterManager.state.filter.filters.find(V=>!V.isGroup&&V.propertyId==o.property.id).id}),f=()=>t.collection.filterManager,x=I(()=>t.getSha1Mode());function D(){c.value?t.setVisibleProperty(o.property.id,!1):t.setVisibleProperty(o.property.id,!0)}function K(){p.value?p.value=!1:(p.value=!0,y.value=o.property.name),v.value=!1}function ae(){o.property.type!=S.tag&&o.property.type!=S.multi_tags||(v.value?v.value=!1:v.value=!0,p.value=!1)}function O(){u.value?t.collection.sortManager.delSort(o.property.id):t.collection.sortManager.setSort(o.property.id),t.collection.sortManager.update(!0)}function E(){n.value?t.collection.groupManager.delGroupOption(o.property.id):t.collection.groupManager.setGroupOption(o.property.id),t.collection.groupManager.update(!0)}function z(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&r.deleteProperty(o.property.id)}async function C(){y.value!=""&&(await r.updateProperty(o.property.id,y.value),K())}return A(()=>o.property,()=>{p.value=!1}),(V,L)=>(s(),a("div",{class:U(h.value?"hover-light":"")},[e("div",xt,[p.value?g("",!0):(s(),a("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[b(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:L[0]||(L[0]=G=>h.value=!0),onMouseleave:L[1]||(L[1]=G=>h.value=!1)},null,8,["type"]),e("span",null,$(o.property.name),1)])),p.value?(s(),a("div",wt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:L[2]||(L[2]=G=>h.value=!0),onMouseleave:L[3]||(L[3]=G=>h.value=!1)},null,32)]),e("div",It,[o.property.id>=0?le((s(),a("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":L[4]||(L[4]=G=>y.value=G),onChange:C},null,544)),[[re,y.value]]):(s(),a("span",St,[b(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,$(o.property.name),1)]))])])):g("",!0),e("div",Ct,[o.property.mode==l(he).id?(s(),M(P,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[Mt]),_:1})):g("",!0)]),e("div",{style:{width:"20px","margin-top":"2px"},onClick:D,class:"btn-icon text-center"},[x.value&&o.property.mode==l(he).id?(s(),M(P,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[e("span",{class:"bi bi-eye-slash",onClick:L[5]||(L[5]=Ee(()=>{},["stop"]))})]),_:1})):(s(),M(P,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[e("span",{class:U("bi bi-eye text-"+(c.value?"primary":"secondary"))},null,2)]),_:1}))]),e("div",Vt,[o.property.type==l(S).tag||o.property.type==l(S).multi_tags?(s(),a("div",{key:0,onClick:ae,style:{cursor:"pointer"}},[v.value?(s(),M(P,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Ft]),_:1})):(s(),M(P,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Et]),_:1}))])):g("",!0)])]),e("div",null,[p.value?(s(),a("div",Pt,[e("div",{class:U(["options hover-light",i.value?" text-primary":""])},[b(ue,{manager:f(),"filter-id":m.value,mode:2,"property-id":d.property.id},{default:k(()=>[zt,Q($(V.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),e("div",{class:U(["options hover-light",u.value?" text-primary":""]),onClick:O},[Tt,Q($(V.$t("main.menu.sort.title")),1)],2),e("div",{class:U(["options hover-light",n.value?" text-primary":""]),onClick:E},[Ot,Q($(V.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),a("div",{key:0,class:"options hover-light",onClick:z},[Lt,Q($(V.$t("main.nav.properties.delete_property")),1)])):g("",!0)])):v.value?(s(),a("div",Gt,[b(He,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):g("",!0)])],2))}});const Me=R(Dt,[["__scopeId","data-v-81b7150f"]]),Nt=e("i",{class:"bi bi-three-dots base-hover"},null,-1),Rt={class:"p-2"},Ut=["onClick"],jt=e("i",{class:"bi bi-arrow-clockwise"},null,-1),At=T({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=N(),t=d;function o(){r.reImportFolder(t.folder.id)}return(p,v)=>(s(),M(J,{teleport:!0},{button:k(()=>[Nt]),popup:k(({hide:y})=>[e("div",Rt,[e("div",{class:"base-hover p-1",onClick:h=>{o(),y()}},[jt,Q(" Re import")],8,Ut)])]),_:1}))}}),Ht=["onMouseenter"],Bt=["onClick"],qt={class:"text-secondary"},Kt=["onClick"],Qt=T({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(d){const r=N(),t=d,o=w(null),p=I(()=>{let i={};const n=new Set(t.filterManager.state.folders);return t.folders.map(u=>u.id).forEach(u=>{n.has(u)&&(i[u]=!0)}),i}),v=I(()=>{let i={};return t.folders.map(n=>n.id).forEach(n=>{t.visibleFolders[n]&&(i[n]=!0)}),i}),y=I(()=>{let i={};return t.folders.forEach(n=>{let u=[];p.value[n.id]&&u.push("selected"),i[n.id]=u.join(" ")}),i});function h(i){let n=t.visibleFolders;n[i]?delete n[i]:n[i]=!0}function _(i){let n=new Set(t.filterManager.state.folders);const u=n.has(i),m=r.data.folders[i].parent!=null&&n.has(r.data.folders[i].parent);u&&!m?(n.delete(i),fe(i).forEach(f=>n.delete(f.id))):(c(i,n),n.add(i),fe(i).forEach(f=>n.add(f.id)),Ie(r.data.folders[i]).forEach(f=>n.delete(f.id))),t.filterManager.setFolders(Array.from(n)),t.filterManager.update(!0)}function c(i,n){const u=Ie(r.data.folders[i]);let m;for(let f of u)if(n.has(f.id))m=f;else break;m!=null&&fe(m.id).forEach(f=>n.delete(f.id))}return(i,n)=>{const u=Pe("FolderList2",!0);return s(),a("ul",{class:U(t.root?"tree":""),style:H(t.root?"padding-left:0px;":"")},[(s(!0),a(F,null,j(d.folders,m=>(s(),a("li",{style:H(t.root?"padding-left:0px;":""),class:"no-break",onMouseenter:f=>o.value=m.id,onMouseleave:n[0]||(n[0]=f=>o.value=null)},[e("summary",{class:U(y.value[m.id]),onClick:f=>_(m.id)},[Q($(m.name)+" ",1),e("span",qt,$(m.count),1)],10,Bt),m.children&&m.children.length>0?(s(),a("i",{key:0,onClick:f=>h(m.id),class:U("bi bi-chevron-"+(v.value[m.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Kt)):g("",!0),e("span",{class:U(o.value===m.id?"visible-option":"invisible-option")},[b(At,{folder:m,style:{display:"inline-block"}},null,8,["folder"])],2),m.children&&m.children.length>0&&v.value[m.id]?(s(),M(u,{key:1,folders:m.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager},null,8,["folders","visible-folders","filter-manager"])):g("",!0)],44,Ht))),256))],6)}}});const Wt=R(Qt,[["__scopeId","data-v-9f26453b"]]),Yt={class:"text-center"},Xt={class:"w-100 text-center",style:{"font-size":"10px"}},Jt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Zt=T({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,t=I(()=>r.task.total-r.task.remain-r.task.computing),o=I(()=>r.task.total);return(p,v)=>(s(),a("div",Yt,[Q($(r.task.name)+" ",1),e("div",Xt,$(t.value)+" / "+$(o.value)+" "+$(p.$t("main.nav.tasks.done")),1),o.value>0?(s(),a("div",Jt,[e("div",{class:"progress-bar",style:H(`width: ${t.value/o.value*100}%`)},null,4)])):g("",!0)]))}}),q=d=>(W("data-v-d95a976a"),d=d(),Y(),d),es={class:"menu overflow-scroll"},ts={class:""},ss={class:"m-0",style:{padding:"4px 0px 4px 8px"}},os={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},as=q(()=>e("i",{class:"bi bi-gear"},null,-1)),ns=[as],ls=q(()=>e("i",{class:"bi bi-arrow-left-right"},null,-1)),is=[ls],rs=q(()=>e("div",{class:"custom-hr"},null,-1)),ds={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ps={class:"d-flex align-items-center"},us=q(()=>e("i",{class:"bi bi-plus"},null,-1)),cs={class:"overflow-scroll"},_s={key:0,id:"import"},ms=q(()=>e("div",{class:"custom-hr"},null,-1)),vs={class:"pt-1 pb-2"},ys={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},fs=q(()=>e("div",{class:"custom-hr"},null,-1)),gs={key:0,class:"ps-2 pe-2"},hs={class:"p-1"},bs={key:0,class:"custom-hr"},$s={key:1,class:"p-2"},ks=q(()=>e("div",{class:"custom-hr"},null,-1)),xs={key:0,class:"float-end"},ws={class:"text-center"},Is={class:"w-100 text-center",style:{"font-size":"10px"}},Ss={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Cs={key:2,class:"p-2"},Ms={class:"w-100 text-center",style:{"font-size":"10px"}},Vs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Fs=q(()=>e("div",{class:"custom-hr"},null,-1)),Es={class:"p-2 mt-0"},Ps={class:"d-flex"},zs=q(()=>e("span",{class:"flex-grow-1"},null,-1)),Ts={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Os=q(()=>e("span",{class:"sr-only"},null,-1)),Ls=[Os],Gs={key:1,class:"bb me-1"},Ds={class:"bb me-2"},Ns={key:0,class:"mt-2"},Rs={key:0,class:"property-item"},Us=q(()=>e("div",{class:"property-item m-0 p-0"},null,-1)),js=q(()=>e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),As=q(()=>e("div",{class:"custom-hr"},null,-1)),Hs={class:"p-2 mt-0"},Bs={key:0,class:"mt-2"},qs={key:0,class:"property-item"},Ks=T({__name:"Menu",emits:["export"],setup(d,{emit:r}){const t=N(),o=ke(),p=t.getTabManager(),v=w(!1);w(null);const y=w(!1),h=async n=>{o.showModal(te.IMPORT)},_=I(()=>t.backendStatus.tasks.filter(n=>!(n.name=="Load Plugin"&&n.done)));function c(){o.showModal(te.FOLDERSELECTION,{callback:i,mode:"images"})}function i(n){n&&t.addFolder(n)}return A(()=>t.status.import.to_import,()=>v.value=!0),(n,u)=>{var m;return s(),a("div",es,[e("div",ts,[e("div",null,[e("div",ss,[e("div",os,[e("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},$((m=l(o).data.status.selectedProject)==null?void 0:m.name),1),e("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=f=>l(o).showModal(l(te).SETTINGS))},ns),e("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=f=>l(o).closeProject())},is)])]),rs,e("div",ds,[e("div",ps,[e("div",null,[e("b",null,$(n.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:u[3]||(u[3]=f=>{c(),l(be)()})},[b(P,{message:"main.nav.folders.add"},{default:k(()=>[us]),_:1})])]),e("div",cs,[l(t).getTab()?(s(),M(Wt,{key:0,folders:l(t).folderRoots,"filter-manager":l(p).collection.filterManager,"visible-folders":l(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):g("",!0)])]),_.value&&_.value.length?(s(),a("div",_s,[ms,e("div",vs,[e("div",ys,[e("div",null,[e("b",null,$(n.$t("main.nav.tasks.title")),1)])]),fs,l(t).backendStatus?(s(),a("div",gs,[(s(!0),a(F,null,j(_.value,(f,x)=>(s(),a("div",hs,[x?(s(),a("div",bs)):g("",!0),b(Zt,{task:f},null,8,["task"])]))),256))])):g("",!0)])])):g("",!0),l(t).status.import.to_import!=null&&l(t).status.import.to_import>0&&v.value?(s(),a("div",$s,[ks,l(t).status.import.done?(s(),a("div",xs,[e("i",{class:"bi bi-x base-hover",onClick:u[4]||(u[4]=f=>v.value=!1)})])):g("",!0),e("div",ws,[e("b",null,$(n.$t("main.menu.import_status_title")),1)]),e("div",Is,$(l(t).status.import.imported)+" / "+$(l(t).status.import.to_import)+" importées ",1),l(t).status.import.to_import>0?(s(),a("div",Ss,[e("div",{class:"progress-bar",style:H(`width: ${l(t).status.import.imported/l(t).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),l(t).status.import.to_import!=null&&l(t).status.import.to_import>0&&v.value?(s(),a("div",Cs,[e("div",Ms,$(l(t).status.import.computed)+" / "+$(l(t).status.import.to_import)+" computed ",1),l(t).status.import.to_import>0?(s(),a("div",Vs,[e("div",{class:"progress-bar",style:H(`width: ${l(t).status.import.computed/l(t).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),Fs,e("div",Es,[e("div",Ps,[b(P,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[e("b",null,$(n.$t("main.nav.properties.title")),1)]),_:1}),zs,y.value?(s(),a("span",Ts,Ls)):(s(),a("span",Gs,[b(P,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h})]),_:1})])),e("span",Ds,[b(P,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u[5]||(u[5]=f=>l(o).showModal(l(te).EXPORT,void 0))})]),_:1})])]),l(t).status.loaded?(s(),a("div",Ns,[(s(!0),a(F,null,j(l(t).data.properties,f=>(s(),a(F,null,[f.id>=0?(s(),a("div",Rs,[b(Me,{property:f},null,8,["property"])])):g("",!0)],64))),256)),Us,e("div",{id:"add-property",onClick:u[6]||(u[6]=f=>{l(o).showModal(l(te).PROPERTY,void 0),l(be)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[js,e("span",null,$(n.$t("main.nav.properties.add_property")),1)])])):g("",!0)]),As,e("div",Hs,[b(P,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[e("b",null,$(n.$t("main.nav.computed.title")),1)]),_:1}),l(t).status.loaded?(s(),a("div",Bs,[(s(!0),a(F,null,j(l(t).data.properties,f=>(s(),a(F,null,[f.id<0?(s(),a("div",qs,[b(P,{pos:"bottom",message:"main.nav.computed."+Math.abs(f.id).toString()+"_tooltip"},{default:k(()=>[b(Me,{property:f},null,8,["property"])]),_:2},1032,["message"])])):g("",!0)],64))),256))])):g("",!0)])])])])}}});const Qs=R(Ks,[["__scopeId","data-v-d95a976a"]]),Ws={class:"text-nowrap text-secondary"},Ve=T({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=N(),t=d,o=I(()=>r.data.properties[t.propertyId].tags);return(p,v)=>(s(),a("div",Ws,[t.value&&t.value.length>0?(s(!0),a(F,{key:0},j(t.value,y=>(s(),a("span",null,[b(Be,{tag:o.value[y].value,color:o.value[y].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),a(F,{key:1},[Q(" Add Tags... ")],64))]))}}),Ys={key:0},Xs={key:1},Js={key:2},Zs={key:3},eo={key:0,class:"bi bi-square"},to={key:1,class:"bi bi-check-square"},so={key:5},oo={key:6},ao={key:7},no={key:8},lo={key:9},io={key:10},ro={key:11},po={key:12},uo={key:13},co={key:1,class:"text-secondary"},_o=T({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,t=I(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":qe[p].color}),o=I(()=>[S._ahash,S._folders,S._sha1,S.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,v)=>d.value!=null?(s(),a(F,{key:0},[r.property.type==l(S)._ahash?(s(),a("div",Ys,$(o.value),1)):g("",!0),r.property.type==l(S)._folders?(s(),a("div",Xs,$(o.value),1)):g("",!0),r.property.type==l(S)._sha1?(s(),a("div",Js,$(o.value),1)):g("",!0),r.property.type==l(S).checkbox?(s(),a("div",Zs,[o.value?(s(),a("i",eo)):(s(),a("i",to))])):g("",!0),r.property.type==l(S).color?(s(),a("div",{key:4,style:H({backgroundColor:t.value}),class:"w-100 h-100"},null,4)):g("",!0),r.property.type==l(S).date?(s(),a("div",so,$(o.value),1)):g("",!0),r.property.type==l(S).image_link?(s(),a("div",oo)):g("",!0),r.property.type==l(S).multi_tags?(s(),a("div",ao,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):g("",!0),r.property.type==l(S).number?(s(),a("div",no,$(o.value),1)):g("",!0),r.property.type==l(S).path?(s(),a("div",lo,$(o.value),1)):g("",!0),r.property.type==l(S).string?(s(),a("div",io,$(o.value),1)):g("",!0),r.property.type==l(S)._id||r.property.type==l(S)._height||r.property.type==l(S)._width?(s(),a("div",ro,$(o.value),1)):g("",!0),r.property.type==l(S).tag?(s(),a("div",po,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):g("",!0),r.property.type==l(S).url?(s(),a("div",uo,$(o.value),1)):g("",!0)],64)):(s(),a("span",co,"..."))}}),mo={class:"d-flex bb ps-1 overflow-hidden"},vo={class:"m-0 p-0 me-2 text-nowrap"},yo={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},fo=T({__name:"FilterPreview",props:{filter:Object},setup(d){const r=N(),t=d,o=I(()=>r.data.properties[t.filter.propertyId]);return(p,v)=>(s(),a("td",mo,[e("div",vo,$(p.$t("modals.filters.operators."+t.filter.operator)),1),l(Fe)(t.filter.operator)?(s(),a("div",yo,[b(_o,{property:o.value,value:t.filter.value},null,8,["property","value"])])):g("",!0)]))}});const go=R(fo,[["__scopeId","data-v-79b26ee7"]]),ho={class:"m-0 bb",style:{}},bo={class:"p-2"},$o=T({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const t=N(),o=d,p=r,v=w(null);function y(h){v.value.hide(),p("update:modelValue",t.data.properties[h])}return(h,_)=>(s(),M(J,{ref_key:"dropdownElem",ref:v,"auto-focus":!1},{button:k(()=>[e("div",ho,[b(ie,{type:o.modelValue.type},null,8,["type"]),Q(" "+$(o.modelValue.name),1)])]),popup:k(()=>[e("div",bo,[b(xe,{modelValue:o.modelValue,"onUpdate:modelValue":_[0]||(_[0]=c=>o.modelValue=c),onSelect:y,"ignore-ids":[l($e).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ce=d=>(W("data-v-b9005f3e"),d=d(),Y(),d),ko={class:"filter-group"},xo={class:"table table-sm"},wo={class:"align-top p-0 m-0"},Io={key:0,class:"m-0 p-0"},So={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Co={class:""},Mo=["onClick"],Vo=ce(()=>e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Fo={key:2,class:"text-secondary"},Eo={key:0,class:"p-0 m-0 ps-2"},Po={key:1,class:"p-0 m-0 ps-2"},zo={class:"border rounded"},To={class:""},Oo=["onClick"],Lo=ce(()=>e("i",{class:"bi bi-trash"},null,-1)),Go=[Lo],Do={class:"d-flex text-secondary ms-2"},No={class:"add-options hover-light"},Ro=ce(()=>e("i",{class:"bi bi-plus"},null,-1)),Uo=ce(()=>e("i",{class:"bi bi-plus"},null,-1)),jo=T({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const t=N(),o=d,p=I(()=>o.filter),v=I(()=>p.value.filters),y=I(()=>{let n=255-(p.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function h(n,u){o.manager.updateFilter(n,{propertyId:u}),o.manager.update(!0)}function _(n){o.manager.deleteFilter(n.id),o.manager.update(!0)}function c(n){o.manager.addNewFilterGroup(n),o.manager.update(!0)}function i(n,u){o.manager.updateFilterGroup(n,u),o.manager.update(!0)}return(n,u)=>{const m=Pe("FilterGroupInput",!0);return s(),a("div",ko,[e("table",xo,[(s(!0),a(F,null,j(v.value,(f,x)=>(s(),a("tr",null,[e("td",wo,[x==0?(s(),a("div",Io,$(n.$t("modals.filters.where")),1)):x==1?(s(),M(J,{key:1},{button:k(()=>[e("div",So,[e("span",Co,$(n.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:D})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:D},[e("div",{class:"base-btn",onClick:u[0]||(u[0]=K=>i(p.value.id,l(Se).and))},$(n.$t("modals.filters.and")),1),Vo,e("div",{class:"base-btn",onClick:u[1]||(u[1]=K=>i(p.value.id,l(Se).or))},$(n.$t("modals.filters.or")),1)],8,Mo)]),_:1})):(s(),a("span",Fo,$(p.value.groupOperator),1))]),f.propertyId!==void 0?(s(),a("td",Eo,[b($o,{"model-value":l(t).data.properties[f.propertyId],"onUpdate:modelValue":D=>h(f.id,D.id)},null,8,["model-value","onUpdate:modelValue"])])):g("",!0),f.propertyId!==void 0?(s(),a("td",Po,[b(ue,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":f.id,parent:o.parent},{default:k(()=>[b(go,{filter:f},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),a("td",{key:2,colspan:"3",style:H(y.value)},[e("div",zo,[b(m,{filter:f,manager:o.manager},null,8,["filter","manager"])])],4)),e("td",To,[e("span",{class:"base-btn",onClick:D=>_(f)},Go,8,Oo)])]))),256))]),e("div",Do,[b(ue,{manager:o.manager,"parent-id":p.value.id},{default:k(()=>[e("div",No,[Ro,Q($(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),e("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=f=>c(p.value.id))},[Uo,Q($(n.$t("modals.filters.new_group")),1)])])])}}});const Ao=R(jo,[["__scopeId","data-v-b9005f3e"]]),Ho=d=>(W("data-v-c6a37a82"),d=d(),Y(),d),Bo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},qo={key:0},Ko=Ho(()=>e("span",{class:"text-primary"},"Text Query",-1)),Qo={key:0,class:"or-separator"},Wo={key:0,class:"or-separator"},Yo={key:0,class:"m-1 p-0"},Xo=T({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(d,{emit:r}){const t=N(),o=d,p=w(null),v=w(null),y=I(()=>{let _=h(o.manager.state.filter),c={};return _.forEach(i=>c[i.propertyId]=i),Object.values(c)});function h(_){let c=[];for(let i of _.filters)i.isGroup?c.push(...h(i)):c.push(i);return c}return A(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&v.value.hide()}),(_,c)=>(s(),M(J,{ref_key:"dropdownElem",ref:v},{button:k(()=>[e("div",null,[y.value.length||o.manager.state.query?(s(),a("div",Bo,[o.manager.state.query?(s(),a("div",qo,[Ko,y.value.length?(s(),a("span",Qo,"|")):g("",!0)])):g("",!0),(s(!0),a(F,null,j(y.value,(i,n)=>(s(),a("div",null,[n>0?(s(),a("span",Wo,"|")):g("",!0),i.propertyId==l($e).id?(s(),M(ie,{key:1,type:l(t).data.properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):g("",!0),e("span",null,$(l(t).data.properties[i.propertyId].name),1)]))),256))])):g("",!0)])]),popup:k(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(l(t).data.properties).length>0?(s(),a("div",Yo,[b(Ao,{filter:o.manager.state.filter,manager:o.manager,parent:p.value},null,8,["filter","manager","parent"])])):g("",!0)],512)]),_:1},512))}});const Jo=R(Xo,[["__scopeId","data-v-c6a37a82"]]),Zo=d=>(W("data-v-1d7e82c5"),d=d(),Y(),d),ea={class:"d-flex flex-row filter-form"},ta={class:"pt-1 pb-1"},sa=Zo(()=>e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)),oa=T({__name:"FilterForm",props:{manager:de},setup(d){const r=d;return(t,o)=>(s(),a("div",ea,[e("div",ta,$(t.$t("main.menu.filters"))+": ",1),b(Jo,{manager:r.manager},null,8,["manager"]),b(ue,{manager:r.manager,class:"p-1"},{default:k(()=>[sa]),_:1},8,["manager"])]))}});const aa=R(oa,[["__scopeId","data-v-1d7e82c5"]]),na=d=>(W("data-v-59c1ca07"),d=d(),Y(),d),la=na(()=>e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)),ia={class:"p-1"},ra=T({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const t=d,o=r,p=w(null);return(v,y)=>(s(),M(J,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[la]),popup:k(()=>[e("div",ia,[b(xe,{onClick:y[0]||(y[0]=h=>l(be)()),onSelect:y[1]||(y[1]=h=>{o("select",h),p.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Te=R(ra,[["__scopeId","data-v-59c1ca07"]]),da={class:"base-hover ps-1 pe-1"},pa={class:"main"},ua=["onClick"],ca=T({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const t=d,o=r,p=Object.values(ze);function v(y){o("update:modelValue",y)}return(y,h)=>(s(),M(J,null,{button:k(()=>[e("div",da,$(t.modelValue),1)]),popup:k(({hide:_})=>[e("div",pa,[(s(!0),a(F,null,j(l(p),c=>(s(),a("div",{class:"base-hover option",onClick:i=>{v(c),_()}},$(c),9,ua))),256))])]),_:1}))}});const _a=R(ca,[["__scopeId","data-v-cc9d0d61"]]),ma=d=>(W("data-v-a27bea28"),d=d(),Y(),d),va=ma(()=>e("i",{class:"bi bi-three-dots-vertical"},null,-1)),ya={class:""},fa={class:"d-flex ipt"},ga={class:"ms-2",min:"1"},ha=T({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const t=d,o=r,p=w(1),v=w(ze.Year);function y(){t.option.stepSize==p.value&&t.option.stepUnit==v.value||o("change",{stepSize:p.value,stepUnit:v.value})}function h(){p.value=t.option.stepSize??1,v.value=t.option.stepUnit}return A(()=>t.option,h),se(h),A(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(_,c)=>(s(),M(J,{onHide:y},{button:k(()=>[va]),popup:k(({hide:i,focus:n})=>[e("div",ya,[e("div",fa,[e("div",null,[le(e("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=u=>p.value=u)},null,512),[[re,p.value]])]),e("div",ga,[b(_a,{modelValue:v.value,"onUpdate:modelValue":c[1]||(c[1]=u=>v.value=u),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ba=R(ha,[["__scopeId","data-v-a27bea28"]]),$a={class:"d-flex flex-row group-form"},ka={class:"pt-1 pb-1"},xa={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},wa={key:0,class:"bi bi-chevron-right smaller"},Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa=["onClick"],Ea=["onClick"],Pa=["onClick"],za=["onClick"],Ta={key:5,class:"sm-btn"},Oa={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},La=T({__name:"GroupForm",props:{isLoading:Boolean,manager:Ke},setup(d){const r=N(),t=d;function o(i){t.manager.setGroupOption(i),t.manager.update(!0)}function p(i){t.manager.delGroupOption(i),t.manager.update(!0)}function v(i,n){t.manager.setGroupOption(i,{direction:n}),t.manager.sortGroups(!0)}function y(i,n){t.manager.setGroupOption(i,{type:n}),t.manager.sortGroups(!0)}function h(i,n){t.manager.setGroupOption(i,n),t.manager.update(!0)}const _=I(()=>t.manager.state.groupBy.map(i=>r.data.properties[i])),c=I(()=>{const i=[];return t.manager.state.groupBy.forEach(n=>{i.push({option:t.manager.state.options[n],property:r.data.properties[n]})}),i});return(i,n)=>(s(),a("div",$a,[e("div",ka,$(i.$t("main.menu.groupby"))+": ",1),_.value.length?(s(),a("div",xa,[(s(!0),a(F,null,j(c.value,(u,m)=>(s(),a(F,null,[m>0?(s(),a("i",wa)):g("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:f=>p(u.property.id),id:"remove-group-button"},$(u.property.name),9,Ia),u.option.type==l(ee).Size?(s(),M(P,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:f=>y(u.property.id,l(ee).Property)},null,8,Sa)):(s(),a("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:f=>y(u.property.id,l(ee).Property)},null,8,Ca))]),_:2},1024)):(s(),M(P,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==l(S).number?(s(),a(F,{key:0},[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:f=>y(u.property.id,l(ee).Size)},null,8,Ma)):(s(),a("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:f=>y(u.property.id,l(ee).Size)},null,8,Va))],64)):(s(),a(F,{key:1},[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:f=>y(u.property.id,l(ee).Size)},null,8,Fa)):(s(),a("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:f=>y(u.property.id,l(ee).Size)},null,8,Ea))],64))]),_:2},1024)),u.option.direction==l(X).Ascending?(s(),M(P,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:f=>v(u.property.id,l(X).Descending)},null,8,Pa)]),_:2},1024)):(s(),M(P,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:f=>v(u.property.id,l(X).Ascending)},null,8,za)]),_:2},1024)),u.property.type==l(S).date?(s(),a("div",Ta,[b(ba,{option:u.option,onChange:f=>h(u.property.id,f)},null,8,["option","onChange"])])):g("",!0)],64))),256)),t.isLoading?(s(),a("i",Oa)):g("",!0)])):g("",!0),b(Te,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:n[0]||(n[0]=u=>o(u))},null,8,["group-ids"])]))}});const Ga=R(La,[["__scopeId","data-v-47631987"]]),Da={class:"d-flex flex-row sort-form"},Na={class:"pt-1 pb-1"},Ra={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ua={key:0,class:"bi bi-chevron-right smaller"},ja=["onClick"],Aa=["onClick"],Ha=["onClick"],Ba=T({__name:"SortForm",props:{manager:Qe},setup(d){const r=N(),t=d,o=I(()=>t.manager.state.sortBy.map(_=>({propertyId:_,direction:t.manager.state.options[_].direction}))),p=I(()=>o.value.map(_=>_.propertyId));function v(_){t.manager.setSort(_),t.manager.update(!0)}function y(_){t.manager.delSort(_),t.manager.update(!0)}function h(_,c){t.manager.setSort(_,{direction:c}),t.manager.update(!0)}return(_,c)=>(s(),a("div",Da,[e("div",Na,$(_.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),a("div",Ra,[(s(!0),a(F,null,j(o.value,(i,n)=>(s(),a(F,null,[n>0?(s(),a("i",Ua)):g("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>y(i.propertyId)},$(l(r).data.properties[i.propertyId].name),9,ja),i.direction==l(X).Ascending?(s(),M(P,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>h(i.propertyId,l(X).Descending)},null,8,Aa)]),_:2},1024)):(s(),M(P,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>h(i.propertyId,l(X).Ascending)},null,8,Ha)]),_:2},1024))],64))),256))])):g("",!0),b(Te,{"group-ids":p.value,onSelect:c[0]||(c[0]=i=>v(i))},null,8,["group-ids"])]))}});const qa=R(Ba,[["__scopeId","data-v-bc2e0a7f"]]),we=d=>(W("data-v-f9f08582"),d=d(),Y(),d),Ka={class:"d-flex flex-row p-2"},Qa=we(()=>e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Wa=["placeholder"],Ya={class:"me-5 d-flex"},Xa=we(()=>e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Ja={class:"ms-5",style:{"font-size":"13px"}},Za=["checked"],en=we(()=>e("span",{class:"ms-1"},"Mode Image unique",-1)),tn={class:"d-flex flex-wrap content-container ps-2"},sn=T({__name:"ContentFilter",props:{tab:We,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){N();const t=d,o=w(""),p=I(()=>Object.keys(t.tab.collection.groupManager.selectedImages).map(Number)),v=I(()=>p.value.length);function y(i){const n=i.target.checked;t.tab.collection.groupManager.setSha1Mode(n,!0)}function h(){o.value=t.tab.state.filterState.query}function _(){t.tab.collection.filterManager.setQuery(o.value),t.tab.collection.filterManager.update(!0)}function c(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return se(h),A(()=>t.tab.collection.filterManager.state.query,h),(i,n)=>(s(),a(F,null,[e("div",Ka,[b(P,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[e("div",{class:U(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[Qa,le(e("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=u=>o.value=u),onChange:_},null,40,Wa),[[re,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:c},"x")],2)]),_:1}),e("div",Ya,[b(P,{message:"main.menu.grid_tooltip"},{default:k(()=>[e("i",{class:U("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=u=>t.tab.state.display="tree")},null,2)]),_:1}),b(P,{message:"main.menu.table_tooltip"},{default:k(()=>[e("i",{id:"toot",class:U("bi bi-table btn-icon"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=u=>t.tab.state.display="grid")},null,2)]),_:1})]),b(P,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[Xa]),_:1}),e("div",null,[b(Ye,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":n[3]||(n[3]=u=>t.tab.state.imageSize=u)},null,8,["modelValue"])]),e("div",Ja,[b(P,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:y},null,40,Za),en]),_:1})]),v.value?(s(),M(Xe,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":n[4]||(n[4]=u=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):g("",!0)]),e("div",tn,[b(aa,{manager:t.tab.collection.filterManager},null,8,["manager"]),b(Ga,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),b(qa,{manager:t.tab.collection.sortManager},null,8,["manager"])])],64))}});const on=R(sn,[["__scopeId","data-v-f9f08582"]]),an={class:""},nn=["src"],ln={class:"d-flex flex-row"},rn=T({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const t=ke();N();const o=d,p=r,v=I(()=>`width: ${o.size}px; height: ${o.size}px;`),y=I(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),h=I(()=>o.pile.images[0]);return(_,c)=>(s(),a("div",an,[b(Je,{image:h.value},{default:k(()=>[e("div",{style:H(v.value),class:"img-container",onClick:c[0]||(c[0]=i=>l(t).showModal(l(te).IMAGE,{image:h.value}))},[e("img",{src:h.value.url,style:H(y.value)},null,12,nn)],4)]),_:1},8,["image"]),e("div",ln,[b(P,{message:"main.recommand.accept"},{default:k(()=>[e("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:c[1]||(c[1]=i=>p("accept",h.value))}," ✓ ",4)]),_:1}),b(P,{message:"main.recommand.refuse"},{default:k(()=>[e("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:c[2]||(c[2]=i=>p("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const dn=R(rn,[["__scopeId","data-v-1ea540e7"]]),pe=d=>(W("data-v-2fea5b23"),d=d(),Y(),d),pn={class:"reco-container"},un={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},cn=pe(()=>e("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),_n=[cn],mn=pe(()=>e("div",{class:"b-left pe-1"},null,-1)),vn=pe(()=>e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),yn=[vn],fn=pe(()=>e("div",{class:"b-left pe-1"},null,-1)),gn={key:0,class:"bi bi-funnel-fill bb text-primary"},hn={key:1,class:"bi bi-funnel bb"},bn=pe(()=>e("div",{class:"b-left pe-1"},null,-1)),$n={class:"text-secondary me-2"},kn={class:"flex-grow-1"},xn={class:"d-flex flex-row"},wn={key:0,class:"separator"},In={class:"d-flex flex-row"},ge=10,Sn=T({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const t=N(),o=Ze(),p=d,v=r,y=w(1),h=ne([]),_=ne([]),c=ne([]),i=ne(new Set),n=w(!0);function u(O){let E=_.indexOf(O);E<0||(_.splice(E,1),x())}async function m(O){const E=[],z=[];c.forEach(C=>{var V;if(C.value!=tt){const L=t.data.properties[C.propertyId];let G=C.value;L.type==S.multi_tags?(G=((V=O.properties[C.propertyId])==null?void 0:V.value)??[],G=[...G,C.value]):L.type==S.tag&&(G=[G]),L.mode==he.id?z.push({instanceId:O.id,propertyId:L.id,value:G}):E.push({propertyId:L.id,sha1:O.sha1,value:G})}}),await t.setPropertyValues(z,E),u(O.sha1)}function f(O){i.add(O.sha1),u(O.sha1)}function x(){h.length=0;const O=_.map(E=>({sha1:E,images:t.data.sha1Index[E]}));D(O,h,y.value,p.imageSize,p.width)}function D(O,E,z,C,V){let L=V,G=[],_e=0;for(let me=0;me<O.length&&!(E.length>=z);me++){let ve=O[me];if(i.has(ve.sha1))continue;let ye=C+ge;if(_e+ye<L){G.push(ve),_e+=ye;continue}if(G.length==0)throw new Error("Images seems to be to big for the line");E.push(G),E.length<z&&(G=[ve],_e=ye)}G.length>0&&E.length<z&&E.push(G)}async function K(){if(!p.group)return;console.log("get reco");const O=p.group.images.map(V=>V.id);let E=await o.getSimilarImages({instanceIds:O});if(E.matches.sort((V,L)=>L.score-V.score),n.value){const V=t.getTabManager(),L=new Set(V.collection.groupManager.result.root.images.map(G=>G.id));E.matches=E.matches.filter(G=>L.has(G.id))}const z=Array.from(new Set(E.matches.map(V=>t.data.images[V.id].sha1)));c.length=0;let C=p.group;for(;C;)c.push(...C.meta.propertyValues),C=C.parent;_.length=0,_.push(...z),i.clear(),x(),v("update")}function ae(){n.value=!n.value}return se(K),A(()=>p.group,()=>{K(),i.clear()}),A(()=>p.imageSize,x),A(()=>p.width,x),A(n,K),(O,E)=>(s(),a("div",pn,[e("div",un,[e("div",{class:"text-secondary pe-1",onClick:E[0]||(E[0]=z=>v("close"))},_n),mn,e("div",{class:"text-secondary pe-1",onClick:E[1]||(E[1]=z=>v("scroll",p.group.id))},yn),fn,e("div",{class:"text-secondary pe-1",onClick:ae},[n.value?(s(),a("span",gn)):(s(),a("span",hn))]),bn,b(P,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[e("span",$n,$(O.$t("main.recommand.title")),1)]),_:1}),e("div",kn,[e("div",xn,[(s(!0),a(F,null,j(c,(z,C)=>(s(),a(F,null,[b(et,{class:"",value:z},null,8,["value"]),C<c.length-1?(s(),a("div",wn)):g("",!0)],64))),256))])])]),e("div",{style:H("margin-left:"+ge+"px;")},[(s(!0),a(F,null,j(h,z=>(s(),a("div",null,[e("div",In,[(s(!0),a(F,null,j(z,C=>(s(),M(dn,{pile:C,size:p.imageSize,onAccept:m,onRefuse:f,style:H("margin-right:"+ge+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Cn=R(Sn,[["__scopeId","data-v-2fea5b23"]]),Mn={key:0,class:"m-0 p-0"},Vn={key:0,style:{"margin-left":"10px"}},Fn=T({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=N(),t=r.getTabManager(),o=d,p=w({}),v=w(null),y=w(null),h=w(null);w([]);const _=w(0),c=w(0),i=ne({groups:!1}),n=I(()=>t.getVisibleProperties());function u(){v.value&&y.value?_.value=o.height-v.value.clientHeight-y.value.clientHeight-5:v.value?_.value=o.height-v.value.clientHeight-5:_.value=0}t.collection.groupManager.onChange.addListener(()=>{h.value&&t.state.display=="tree"&&h.value.computeLines()});function m(x){p.value=t.collection.groupManager.result.index[x],Z(()=>u())}function f(){p.value={},Z(()=>u())}return se(()=>{c.value=v.value.clientWidth,window.addEventListener("resize",()=>{Z(()=>{var x;c.value=((x=v.value)==null?void 0:x.clientWidth)??c.value})})}),A(t.state,x=>{r.updateTabs()},{deep:!0}),A(()=>t.state.imageSize,()=>Z(u)),A(()=>o.height,async()=>{await Z(u)}),(x,D)=>(s(),a(F,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:v},[b(on,{tab:l(t),"compute-status":i},null,8,["tab","compute-status"])],512),e("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[p.value.id?(s(),a("div",Mn,[b(Cn,{group:p.value,"image-size":l(t).state.imageSize,width:c.value,height:50,onClose:f,onScroll:h.value.scrollTo,onUpdate:D[0]||(D[0]=K=>Z(()=>u()))},null,8,["group","image-size","width","onScroll"])])):g("",!0)],512),c.value>0&&_.value>0?(s(),a("div",Vn,[l(t).state.display=="tree"?(s(),M(st,{key:0,"group-manager":l(t).collection.groupManager,"image-size":l(t).state.imageSize,height:_.value-0,properties:n.value,"hide-if-modal":!0,"selected-images":l(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,width:c.value-25,onRecommend:m},null,8,["group-manager","image-size","height","properties","selected-images","width"])):g("",!0),l(t).state.display=="grid"?(s(),a("div",{key:1,style:H({width:c.value-12+"px"}),class:"p-0 m-0 grid-container"},[b(ot,{manager:l(t).collection.groupManager,height:_.value-15,width:c.value-40,"selected-properties":n.value,class:"p-0 m-0","show-images":!0,"selected-images":l(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):g("",!0)])):g("",!0)],64))}});const En=R(Fn,[["__scopeId","data-v-d071a1ff"]]),Pn={class:"d-flex d-row",style:{cursor:"pointer"}},zn=["onMouseenter","onMouseleave"],Tn=["onClick"],On=["onClick"],Ln=["onClick"],Gn=["onSubmit"],Dn=["onKeydown","onUpdate:modelValue"],Nn=e("span",{class:"bi bi-plus"},null,-1),Rn=[Nn],Un={class:"lang"},jn=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),An=["value"],Hn=T({__name:"TabNav",props:{reRender:Function},setup(d){const r=N(),t=w(-1),o=w(""),p=w(null),v=d;function y(m){r.data.selectedTabId==m||_(),r.selectTab(m)}function h(m){t.value=m,o.value=r.data.tabs[m].name,Z(()=>p.value[0].focus())}function _(){t.value=-1,o.value=""}function c(m){r.addTab("New Tab")}async function i(m){confirm("Are you sure to delete Tab: "+m.name)&&await r.removeTab(m.id)}const n=ne({});w(-1);const u=["fr","en"];return(m,f)=>(s(),a("nav",null,[e("div",Pn,[(s(!0),a(F,null,j(l(r).data.tabs,x=>(s(),a("div",{class:"d-flex d-row me-2",onMouseenter:D=>n[x.id]=!0,onMouseleave:D=>n[x.id]=!1},[t.value!=x.id?(s(),a(F,{key:0},[b(P,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[e("i",{onClick:D=>h(x.id),class:U(["bi bi-pencil me-1 tab-icon hover-light",n[x.id]&&l(r).data.selectedTabId==x.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,Tn)]),_:2},1024),e("div",{class:U(["tab-button",x.id==l(r).data.selectedTabId?" active":""]),onClick:D=>y(x.id)},[e("span",null,$(x.name),1)],10,On),b(P,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[e("i",{onClick:D=>i(x),class:U(["btn-icon bi bi-x tab-icon hover-light",n[x.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Ln)]),_:2},1024)],64)):(s(),a("div",{key:1,class:U(["tab-button",x.id==l(r).data.selectedTabId?" active":""])},[e("form",{onSubmit:Ee(_,["stop","prevent"])},[le(e("input",{onFocusout:_,onKeydown:at(_,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":D=>x.name=D,ref_for:!0,ref_key:"inputElem",ref:p},null,40,Dn),[[re,x.name]])],40,Gn)],2))],40,zn))),256)),b(P,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:c,id:"add-tab-button"},Rn)]),_:1}),e("div",Un,[jn,le(e("select",{"onUpdate:modelValue":f[0]||(f[0]=x=>m.$i18n.locale=x),onChange:f[1]||(f[1]=x=>v.reRender())},[(s(),a(F,null,j(u,(x,D)=>e("option",{key:`Lang${D}`,value:x},$(x.toUpperCase()),9,An)),64))],544),[[nt,m.$i18n.locale]])])])]))}});const Oe=d=>(W("data-v-5b158f06"),d=d(),Y(),d),Bn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},qn={key:0},Kn={key:1,class:"w-100"},Qn={key:0,class:"custom-hr"},Wn={key:2,class:"loading"},Yn={class:"text-center"},Xn={key:3,class:"loading"},Jn=Oe(()=>e("i",{class:"spinner-border",role:"status"},null,-1)),Zn=Oe(()=>e("span",{class:"ms-1"},"Loading...",-1)),el=[Jn,Zn],tl=T({__name:"PanopticView",setup(d){const r=N(),t=ke(),o=w(null),p=w(null),v=w(window.innerHeight),y=w(!1),h=I(()=>{var m;return v.value-(((m=p.value)==null?void 0:m.clientHeight)??0)}),_=I(()=>{var m;return(m=o.value)==null?void 0:m.filteredImages.map(f=>f.id)});se(async()=>{t.isProjectLoaded||Ce.push("/"),Z(()=>{window.addEventListener("resize",c),c()}),window.addEventListener("keydown",m=>{m.key=="Control"&&(B.ctrl=!0),m.key=="Alt"&&(B.alt=!0),m.key=="Shift"&&(B.shift=!0),m.key=="ArrowLeft"&&(B.left=!0),m.key=="ArrowRight"&&(B.right=!0,console.log("keeeyy"))}),window.addEventListener("keyup",m=>{m.key=="Control"&&(B.ctrl=!1),m.key=="Alt"&&(B.alt=!1),m.key=="Shift"&&(B.shift=!1),m.key=="ArrowLeft"&&(B.left=!1),m.key=="ArrowRight"&&(B.right=!1)}),window.addEventListener("mousemove",m=>{B.ctrl=m.ctrlKey,B.alt=m.altKey,B.shift=m.shiftKey})}),lt(()=>{window.removeEventListener("resize",c)});function c(){v.value=window.innerHeight,y.value=!0}function i(){t.showModal(te.EXPORT,_)}function n(){r.rerender()}function u(){Ce.push("/")}return(m,f)=>(s(),a(F,null,[b(it,{tutorial:"project"}),(s(),a("div",{id:"panoptic",key:l(r).status.renderNb},[e("div",Bn,[l(r).status.loaded?(s(),a("div",qn,[b(Qs,{onExport:f[0]||(f[0]=x=>i())})])):g("",!0),l(r).status.loaded?(s(),a("div",Kn,[e("div",{class:"ms-3",ref_key:"navElem",ref:p},[b(Hn,{"re-render":n})],512),y.value?(s(),a("div",Qn)):g("",!0),l(r).status.loaded?(s(),M(En,{key:1,"tab-id":l(r).data.selectedTabId,height:h.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):g("",!0)])):l(t).isProjectLoaded?(s(),a("div",Xn,el)):(s(),a("div",Wn,[e("div",Yn,[e("div",null,$(m.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const al=R(tl,[["__scopeId","data-v-5b158f06"]]);export{al as default};
