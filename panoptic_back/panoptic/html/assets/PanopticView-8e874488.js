import{d as L,y as q,r as C,c as V,o as t,j as T,s as x,b as e,t as f,n as N,a,l as H,F as P,D as se,C as Ne,_ as j,E as _e,h as pe,z as B,G as He,H as Oe,e as d,P as De,k as y,q as k,I as we,J as F,K as Ue,L as Be,S as qe,N as Ke,O as Le,Q as Qe,p as Y,f as X,u as ye,x as re,R as Ie,w as ue,v as fe,M as ne,U as z,V as Se,W as Ge,m as ee,X as We,Y as Ye,Z as Me,$ as W,a0 as ke,a1 as Fe,g as Ce,a2 as Xe,T as Ze,a3 as Je,a4 as Te,a5 as et,a6 as Re,a7 as tt,a8 as ie,a9 as te,aa as st,ab as ot,ac as at,ad as nt,ae as lt,af as it,ag as rt,ah as ce,ai as dt,A as ae,aj as ct,ak as pt,al as ut,am as _t,i as Ee,an as A,ao as mt}from"./index-f9099324.js";import{_ as vt}from"./Tutorial-5d65db99.js";const gt=["disabled"],ht={class:"m-0 p-1"},yt=["onClick"],ft=L({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(p,{emit:u}){const s=q(),n=p,r=u,i=C(null),h=V(()=>s.properties[n.propertyId]),$=V(()=>Ne(h.value.type));async function m(_){r("update:modelValue",_),i.value.hide()}return(_,l)=>(t(),T(se,{onHide:l[0]||(l[0]=o=>r("hide")),ref_key:"dropdownElem",ref:i,parent:n.parent},{button:x(()=>[e("div",{class:N(["text-nowrap",n.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:n.disabled},[e("span",null,f(_.$t("modals.filters.operators."+n.modelValue)),1)],10,gt)]),popup:x(()=>[e("div",ht,[(t(!0),a(P,null,H($.value,o=>(t(),a("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>m(o)},[e("a",null,f(_.$t("modals.filters.operators."+o)),1)],8,yt))),256))])]),_:1},8,["parent"]))}});const bt=j(ft,[["__scopeId","data-v-7b1fbda7"]]),$t=p=>(Y("data-v-4210747d"),p=p(),X(),p),kt={class:"m-0 p-0"},xt={style:{"max-height":"400px","overflow-y":"scroll"}},wt={key:0},It={class:"d-flex mode-header"},St={class:"me-3"},Ct=$t(()=>e("div",{class:"flex-fill"},null,-1)),Mt={key:0,class:"me-2",style:{width:"100%"}},Vt=L({__name:"FilterDropdown",props:{manager:_e,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(p){const u=q(),s=p,n=C(null),r=C(null),i=C(null),h=C(0),$=C(null),m=C(null),_=V(()=>s.filterId!==void 0?s.filterId:$.value),l=V(()=>{if(!(_.value==null||_.value==-1))return s.manager.filterIndex[_.value]}),o=V(()=>l.value==null?void 0:u.properties[l.value.propertyId]);function c(){h.value=s.mode,s.mode==2&&s.filterId==null&&S(s.propertyId)}function g(){n.value&&n.value.hide()}function b(){h.value=0}function v(){g(),s.manager.deleteFilter(_.value)}function S(w){let I=s.manager.addNewFilter(w,s.parentId);$.value=I.id,h.value=2}function G(w){m.value=null,s.manager.updateFilter(_.value,{operator:w}),r.value&&r.value.focus(),we(w)||g()}function U(){console.log("update value",m.value),s.manager.updateFilter(_.value,{value:m.value})}function K(){if(!l.value)return;const w=u.properties[l.value.propertyId];if(Le(w.type))return;const I=m.value??Qe(w.type);l.value.value!=I&&U()}function M(){l.value&&(m.value=l.value.value)}return pe(M),B(()=>l.value,()=>M()),(w,I)=>(t(),T(se,{ref_key:"dropdownElem",ref:n,onShow:c,onHide:b,parent:s.parent},{button:x(()=>[e("div",kt,[He(w.$slots,"default",{},void 0,!0)])]),popup:x(()=>[e("div",{class:"container-size bg-white",ref_key:"popupElem",ref:i},[h.value!=0?(t(),a(P,{key:0},[e("div",xt,[h.value==1?(t(),T(Oe,{key:0,onSelect:S,"ignore-ids":[d(De).folders]},null,8,["ignore-ids"])):y("",!0)]),h.value==2?(t(),a("div",wt,[e("div",It,[e("div",St,f(o.value.name),1),k(bt,{"property-id":l.value.propertyId,"model-value":l.value.operator,"onUpdate:modelValue":G,parent:i.value},null,8,["property-id","model-value","parent"]),Ct,e("div",null,[e("i",{class:"bi bi-trash-fill",onClick:v})])]),d(we)(l.value.operator)?(t(),a("div",Mt,[o.value.type==d(F).multi_tags||o.value.type==d(F).tag?(t(),T(Ue,{key:0,modelValue:m.value,"onUpdate:modelValue":[I[0]||(I[0]=R=>m.value=R),U],"auto-focus":!0,property:d(u).properties[l.value.propertyId],ref_key:"inputElem",ref:r,onHide:g},null,8,["modelValue","property"])):o.value.type==d(F).color?(t(),T(Be,{key:1,property:o.value,modelValue:m.value,"onUpdate:modelValue":[I[1]||(I[1]=R=>m.value=R),I[2]||(I[2]=()=>{g(),K()})]},null,8,["property","modelValue"])):o.value.type==d(F).date?(t(),T(qe,{key:2,property:o.value,modelValue:m.value,"onUpdate:modelValue":[I[3]||(I[3]=R=>m.value=R),I[4]||(I[4]=()=>{g(),K()})]},null,8,["property","modelValue"])):(t(),T(Ke,{key:3,"no-html":!0,modelValue:m.value,"onUpdate:modelValue":I[5]||(I[5]=R=>m.value=R),width:-1,"min-height":20,"no-nl":d(u).properties[l.value.propertyId].type==d(F).number,"url-mode":d(u).properties[l.value.propertyId].type==d(F).url,"only-number":d(u).properties[l.value.propertyId].type==d(F).number,onBlur:K,"auto-focus":!0,ref_key:"inputElem",ref:r},null,8,["modelValue","no-nl","url-mode","only-number"]))])):y("",!0)])):y("",!0)],64)):y("",!0)],512)]),_:3},8,["parent"]))}});const he=j(Vt,[["__scopeId","data-v-4210747d"]]),le=p=>(Y("data-v-5cd0a286"),p=p(),X(),p),Ft={class:"d-flex flex-row"},Tt={key:1,class:"d-flex",style:{width:"150px"}},Et={class:"flex-grow-1"},zt={key:1,style:{"padding-top":"1px"}},Pt=le(()=>e("i",{class:"bi bi-arrows-fullscreen"},null,-1)),Ot={style:{width:"20px","margin-top":"2px"},class:"text-center"},Dt=le(()=>e("i",{class:"bi bi-link-45deg"},null,-1)),Lt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Gt=le(()=>e("i",{class:"bi bi-chevron-down"},null,-1)),Rt=le(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),jt={key:0,class:"ms-3 pt-1"},At=le(()=>e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Nt=le(()=>e("i",{class:"bi bi-filter me-2"},null,-1)),Ht=le(()=>e("i",{class:"bi bi-collection me-2"},null,-1)),Ut=le(()=>e("i",{class:"bi bi-trash me-2"},null,-1)),Bt={key:1},qt=L({__name:"PropertyOptions",props:{property:Object},setup(p){const u=ye(),s=re(),n=q(),r=s.getTabManager(),i=p,h=C(!1),$=C(!1),m=C(""),_=C(!1),l=V(()=>s.getTab()),o=V(()=>l.value.visibleProperties[i.property.id]==!0),c=V(()=>r.collection.filterManager.state.filter.filters.some(D=>!D.isGroup&&D.propertyId==i.property.id)),g=V(()=>r.collection.groupManager.state.groupBy.includes(i.property.id)),b=V(()=>r.collection.sortManager.state.sortBy.includes(i.property.id)),v=V(()=>{if(c.value)return r.collection.filterManager.state.filter.filters.find(D=>!D.isGroup&&D.propertyId==i.property.id).id}),S=()=>r.collection.filterManager,G=V(()=>r.getSha1Mode());function U(){o.value?r.setVisibleProperty(i.property.id,!1):r.setVisibleProperty(i.property.id,!0)}function K(){h.value?h.value=!1:(h.value=!0,m.value=i.property.name),$.value=!1}function M(){i.property.type!=F.tag&&i.property.type!=F.multi_tags||($.value?$.value=!1:$.value=!0,h.value=!1)}function w(){b.value?r.collection.sortManager.delSort(i.property.id):r.collection.sortManager.setSort(i.property.id),r.collection.sortManager.update(!0)}function I(){g.value?r.collection.groupManager.delGroupOption(i.property.id):r.collection.groupManager.setGroupOption(i.property.id),r.collection.groupManager.update(!0)}function R(){confirm("Supprimer la propriété: "+i.property.name+" ?   "+i.property.id)&&n.deleteProperty(i.property.id)}async function Q(){m.value!=""&&(await n.updateProperty(i.property.id,m.value),K())}return B(()=>i.property,()=>{h.value=!1}),(D,E)=>(t(),a("div",{class:N(_.value?"hover-light":"")},[e("div",Ft,[h.value?y("",!0):(t(),a("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[k(Ie,{type:i.property.type,class:"me-2 btn-icon",onMouseenter:E[0]||(E[0]=O=>_.value=!0),onMouseleave:E[1]||(E[1]=O=>_.value=!1)},null,8,["type"]),e("span",null,f(i.property.name),1)])),h.value?(t(),a("div",Tt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:E[2]||(E[2]=O=>_.value=!0),onMouseleave:E[3]||(E[3]=O=>_.value=!1)},null,32)]),e("div",Et,[i.property.id>=0?ue((t(),a("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":E[4]||(E[4]=O=>m.value=O),onChange:Q},null,544)),[[fe,m.value]]):(t(),a("span",zt,[k(Ie,{type:i.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,f(i.property.name),1)]))])])):y("",!0),d(Le)(i.property.type)?(t(),a("div",{key:2,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:E[5]||(E[5]=O=>d(u).showModal(d(ne).TAG,{propId:i.property.id}))},[k(z,{click:!1,message:"main.nav.properties.open_tags"},{default:x(()=>[Pt]),_:1})])):y("",!0),e("div",Ot,[i.property.mode==d(Se).id?(t(),T(z,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:x(()=>[Dt]),_:1})):y("",!0)]),e("div",{style:{width:"20px","margin-top":"2px"},onClick:U,class:"btn-icon text-center"},[G.value&&i.property.mode==d(Se).id?(t(),T(z,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:x(()=>[e("span",{class:"bi bi-eye-slash",onClick:E[6]||(E[6]=Ge(()=>{},["stop"]))})]),_:1})):(t(),T(z,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:x(()=>[e("span",{class:N("bi bi-eye text-"+(o.value?"primary":"secondary"))},null,2)]),_:1}))]),e("div",Lt,[i.property.type==d(F).tag||i.property.type==d(F).multi_tags?(t(),a("div",{key:0,onClick:M,style:{cursor:"pointer"}},[$.value?(t(),T(z,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:x(()=>[Gt]),_:1})):(t(),T(z,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:x(()=>[Rt]),_:1}))])):y("",!0)])]),e("div",null,[h.value?(t(),a("div",jt,[e("div",{class:N(["options hover-light",c.value?" text-primary":""])},[k(he,{manager:S(),"filter-id":v.value,mode:2,"property-id":p.property.id},{default:x(()=>[At,ee(f(D.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),e("div",{class:N(["options hover-light",b.value?" text-primary":""]),onClick:w},[Nt,ee(f(D.$t("main.menu.sort.title")),1)],2),e("div",{class:N(["options hover-light",g.value?" text-primary":""]),onClick:I},[Ht,ee(f(D.$t("main.menu.groupby")),1)],2),i.property.id>=0?(t(),a("div",{key:0,class:"options hover-light",onClick:R},[Ut,ee(f(D.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):$.value?(t(),a("div",Bt,[k(We,{property:i.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])],2))}});const ze=j(qt,[["__scopeId","data-v-5cd0a286"]]),Kt=e("i",{class:"bi bi-three-dots base-hover"},null,-1),Qt={class:"text-nowrap"},Wt=["onClick"],Yt=e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),Xt=e("div",{class:"custom-hr"},null,-1),Zt=["onClick"],Jt=e("i",{class:"bi bi-trash me-1"},null,-1),es=L({__name:"FolderOptionDropdown",props:{folder:{}},setup(p){const u=q(),s=p;function n(){u.reImportFolder(s.folder.id)}function r(){confirm(Ye.global.t("main.nav.folders.del_alert"))&&u.deleteFolder(s.folder.id)}return(i,h)=>(t(),T(se,{teleport:!0},{button:x(()=>[Kt]),popup:x(({hide:$})=>[e("div",Qt,[e("div",{class:"p-2 bb",onClick:m=>{n(),$()}},[Yt,ee("Re import")],8,Wt),Xt,e("div",{class:"bb p-2",onClick:m=>{r(),$()}},[Jt,ee(f(i.$t("main.nav.folders.del")),1)],8,Zt)])]),_:1}))}}),ts=["onMouseenter"],ss=["onClick"],os={class:"text-secondary"},as=["onClick"],ns=L({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:_e,root:{type:Boolean,default:!0}},setup(p){const u=q(),s=p,n=C(null),r=V(()=>{let l={};const o=new Set(s.filterManager.state.folders);return s.folders.map(c=>c.id).forEach(c=>{o.has(c)&&(l[c]=!0)}),l}),i=V(()=>{let l={};return s.folders.map(o=>o.id).forEach(o=>{s.visibleFolders[o]&&(l[o]=!0)}),l}),h=V(()=>{let l={};return s.folders.forEach(o=>{let c=[];r.value[o.id]&&c.push("selected"),l[o.id]=c.join(" ")}),l});function $(l){let o=s.visibleFolders;o[l]?delete o[l]:o[l]=!0}function m(l){let o=new Set(s.filterManager.state.folders);const c=o.has(l),g=u.folders[l].parent!=null&&o.has(u.folders[l].parent);c&&!g?(o.delete(l),ke(l).forEach(b=>o.delete(b.id))):(_(l,o),o.add(l),ke(l).forEach(b=>o.add(b.id)),Fe(u.folders[l]).forEach(b=>o.delete(b.id))),s.filterManager.setFolders(Array.from(o)),s.filterManager.update(!0)}function _(l,o){const c=Fe(u.folders[l]);let g;for(let b of c)if(o.has(b.id))g=b;else break;g!=null&&ke(g.id).forEach(b=>o.delete(b.id))}return(l,o)=>{const c=Me("FolderList2",!0);return t(),a("ul",{class:N(s.root?"tree":""),style:W(s.root?"padding-left:0px;":"")},[(t(!0),a(P,null,H(p.folders,g=>(t(),a("li",{style:W(s.root?"padding-left:0px;":""),class:"no-break",onMouseenter:b=>n.value=g.id,onMouseleave:o[0]||(o[0]=b=>n.value=null)},[e("summary",{class:N(h.value[g.id]),onClick:b=>m(g.id)},[ee(f(g.name)+" ",1),e("span",os,f(g.count),1)],10,ss),g.children&&g.children.length>0?(t(),a("i",{key:0,onClick:b=>$(g.id),class:N("bi bi-chevron-"+(i.value[g.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,as)):y("",!0),e("span",{class:N(n.value===g.id?"visible-option":"invisible-option")},[k(es,{folder:g,style:{display:"inline-block"}},null,8,["folder"])],2),g.children&&g.children.length>0&&i.value[g.id]?(t(),T(c,{key:1,folders:g.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager},null,8,["folders","visible-folders","filter-manager"])):y("",!0)],44,ts))),256))],6)}}});const ls=j(ns,[["__scopeId","data-v-940ffff5"]]),is={class:"text-center"},rs={class:"w-100 text-center",style:{"font-size":"10px"}},ds={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},cs=L({__name:"TaskStatus",props:{task:{}},setup(p){const u=p,s=V(()=>u.task.total-u.task.remain-u.task.computing),n=V(()=>u.task.total);return(r,i)=>(t(),a("div",is,[ee(f(u.task.name)+" ",1),e("div",rs,f(s.value)+" / "+f(n.value)+" "+f(r.$t("main.nav.tasks.done")),1),n.value>0?(t(),a("div",ds,[e("div",{class:"progress-bar",style:W(`width: ${s.value/n.value*100}%`)},null,4)])):y("",!0)]))}}),J=p=>(Y("data-v-523e8746"),p=p(),X(),p),ps={class:"menu overflow-scroll"},us={class:""},_s={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ms={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},vs=J(()=>e("i",{class:"bi bi-gear"},null,-1)),gs=[vs],hs=J(()=>e("i",{class:"bi bi-arrow-left-right"},null,-1)),ys=[hs],fs=J(()=>e("div",{class:"custom-hr"},null,-1)),bs={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},$s={class:"d-flex align-items-center"},ks=J(()=>e("i",{class:"bi bi-plus"},null,-1)),xs={style:{"max-height":"300px",overflow:"auto"}},ws={key:0,id:"import"},Is=J(()=>e("div",{class:"custom-hr"},null,-1)),Ss={class:"pt-1 pb-2"},Cs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},Ms=J(()=>e("div",{class:"custom-hr"},null,-1)),Vs={key:0,class:"ps-2 pe-2"},Fs={class:"p-1"},Ts={key:0,class:"custom-hr"},Es=J(()=>e("div",{class:"custom-hr"},null,-1)),zs={class:"p-2 mt-0"},Ps={class:"d-flex"},Os=J(()=>e("span",{class:"flex-grow-1"},null,-1)),Ds={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Ls=J(()=>e("span",{class:"sr-only"},null,-1)),Gs=[Ls],Rs={key:1,class:"bb me-1"},js={class:"bb me-2"},As={key:0,class:"mt-2"},Ns={key:0,class:"property-item"},Hs=J(()=>e("div",{class:"property-item m-0 p-0"},null,-1)),Us=J(()=>e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Bs=J(()=>e("div",{class:"custom-hr"},null,-1)),qs={class:"p-2 mt-0"},Ks={key:0,class:"mt-2"},Qs={key:0,class:"property-item"},Ws=L({__name:"Menu",emits:["export"],setup(p,{emit:u}){const s=re(),n=q(),r=ye(),i=s.getTabManager(),h=C(!1),$=C(!1),m=async c=>{r.showModal(ne.IMPORT)},_=V(()=>s.backendStatus.tasks.filter(c=>!c.done));function l(){r.showModal(ne.FOLDERSELECTION,{callback:o,mode:"images"})}function o(c){c&&n.addFolder(c)}return B(()=>s.status.import.to_import,()=>h.value=!0),(c,g)=>{var b;return t(),a("div",ps,[e("div",us,[e("div",null,[e("div",_s,[e("div",ms,[e("div",{class:"flex-grow-1 text-capitalize",onClick:g[0]||(g[0]=()=>{})},f((b=d(r).data.status.selectedProject)==null?void 0:b.name),1),e("div",{class:"base-hover p-1",onClick:g[1]||(g[1]=v=>d(r).showModal(d(ne).SETTINGS))},gs),e("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:g[2]||(g[2]=v=>d(r).closeProject())},ys)])]),fs,e("div",bs,[e("div",$s,[e("div",null,[e("b",null,f(c.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:g[3]||(g[3]=v=>{l(),d(Ce)()})},[k(z,{message:"main.nav.folders.add"},{default:x(()=>[ks]),_:1})])]),e("div",xs,[d(s).getTab()?(t(),T(ls,{key:0,folders:d(n).folderRoots,"filter-manager":d(i).collection.filterManager,"visible-folders":d(i).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):y("",!0)])]),_.value&&_.value.length?(t(),a("div",ws,[Is,e("div",Ss,[e("div",Cs,[e("div",null,[e("b",null,f(c.$t("main.nav.tasks.title")),1)])]),Ms,d(s).backendStatus?(t(),a("div",Vs,[(t(!0),a(P,null,H(_.value,(v,S)=>(t(),a("div",Fs,[S?(t(),a("div",Ts)):y("",!0),k(cs,{task:v},null,8,["task"])]))),256))])):y("",!0)])])):y("",!0),Es,e("div",zs,[e("div",Ps,[k(z,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:x(()=>[e("b",null,f(c.$t("main.nav.properties.title")),1)]),_:1}),Os,$.value?(t(),a("span",Ds,Gs)):(t(),a("span",Rs,[k(z,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:x(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:m})]),_:1})])),e("span",js,[k(z,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:x(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:g[4]||(g[4]=v=>d(r).showModal(d(ne).EXPORT,void 0))})]),_:1})])]),d(s).status.loaded?(t(),a("div",As,[(t(!0),a(P,null,H(d(n).properties,v=>(t(),a(P,null,[v.id>=0?(t(),a("div",Ns,[k(ze,{property:v},null,8,["property"])])):y("",!0)],64))),256)),Hs,e("div",{id:"add-property",onClick:g[5]||(g[5]=v=>{d(r).showModal(d(ne).PROPERTY,void 0),d(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Us,e("span",null,f(c.$t("main.nav.properties.add_property")),1)])])):y("",!0)]),Bs,e("div",qs,[k(z,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:x(()=>[e("b",null,f(c.$t("main.nav.computed.title")),1)]),_:1}),d(s).status.loaded?(t(),a("div",Ks,[(t(!0),a(P,null,H(d(n).properties,v=>(t(),a(P,null,[v.id<0&&v.id!=d(Xe)?(t(),a("div",Qs,[k(z,{pos:"bottom",message:"main.nav.computed."+Math.abs(v.id).toString()+"_tooltip"},{default:x(()=>[k(ze,{property:v},null,8,["property"])]),_:2},1032,["message"])])):y("",!0)],64))),256))])):y("",!0)])])])])}}});const Ys=j(Ws,[["__scopeId","data-v-523e8746"]]),Xs={class:"text-nowrap text-secondary"},Pe=L({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(p){const u=p;return(s,n)=>(t(),a("div",Xs,[u.value&&u.value.length>0?(t(!0),a(P,{key:0},H(u.value,r=>(t(),a("span",null,[k(Ze,{id:r,class:"me-1"},null,8,["id"])]))),256)):(t(),a(P,{key:1},[ee(" Add Tags... ")],64))]))}}),Zs={key:0},Js={key:1},eo={key:2},to={key:3},so={key:0,class:"bi bi-square"},oo={key:1,class:"bi bi-check-square"},ao={key:5},no={key:6},lo={key:7},io={key:8},ro={key:9},co={key:10},po={key:11},uo={key:12},_o={key:13},mo={key:1,class:"text-secondary"},vo=L({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(p){const u=p,s=V(()=>{if(u.value==null)return"white";let r=Number(u.value);return isNaN(r)||r>12?"gray":Je[r].color}),n=V(()=>[F._ahash,F._folders,F._sha1,F.string].indexOf(u.property.type)!==-1?'"'+u.value+'"':u.value);return(r,i)=>p.value!=null?(t(),a(P,{key:0},[u.property.type==d(F)._ahash?(t(),a("div",Zs,f(n.value),1)):y("",!0),u.property.type==d(F)._folders?(t(),a("div",Js,f(n.value),1)):y("",!0),u.property.type==d(F)._sha1?(t(),a("div",eo,f(n.value),1)):y("",!0),u.property.type==d(F).checkbox?(t(),a("div",to,[n.value?(t(),a("i",so)):(t(),a("i",oo))])):y("",!0),u.property.type==d(F).color?(t(),a("div",{key:4,style:W({backgroundColor:s.value}),class:"w-100 h-100"},null,4)):y("",!0),u.property.type==d(F).date?(t(),a("div",ao,f(n.value),1)):y("",!0),u.property.type==d(F).image_link?(t(),a("div",no)):y("",!0),u.property.type==d(F).multi_tags?(t(),a("div",lo,[k(Pe,{"property-id":u.property.id,value:n.value},null,8,["property-id","value"])])):y("",!0),u.property.type==d(F).number?(t(),a("div",io,f(n.value),1)):y("",!0),u.property.type==d(F).path?(t(),a("div",ro,f(n.value),1)):y("",!0),u.property.type==d(F).string?(t(),a("div",co,f(n.value),1)):y("",!0),u.property.type==d(F)._id||u.property.type==d(F)._height||u.property.type==d(F)._width?(t(),a("div",po,f(n.value),1)):y("",!0),u.property.type==d(F).tag?(t(),a("div",uo,[k(Pe,{"property-id":u.property.id,value:n.value},null,8,["property-id","value"])])):y("",!0),u.property.type==d(F).url?(t(),a("div",_o,f(n.value),1)):y("",!0)],64)):(t(),a("span",mo,"..."))}}),go={class:"d-flex bb ps-1 overflow-hidden"},ho={class:"m-0 p-0 me-2 text-nowrap"},yo={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},fo=L({__name:"FilterPreview",props:{filter:Object},setup(p){const u=q(),s=p,n=V(()=>u.properties[s.filter.propertyId]);return(r,i)=>(t(),a("td",go,[e("div",ho,f(r.$t("modals.filters.operators."+s.filter.operator)),1),d(we)(s.filter.operator)?(t(),a("div",yo,[k(vo,{property:n.value,value:s.filter.value},null,8,["property","value"])])):y("",!0)]))}});const bo=j(fo,[["__scopeId","data-v-34bfc81a"]]),be=p=>(Y("data-v-7c086868"),p=p(),X(),p),$o={class:"filter-group"},ko={class:"table table-sm"},xo={class:"align-top p-0 m-0"},wo={key:0,class:"m-0 p-0"},Io={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},So={class:""},Co=["onClick"],Mo=be(()=>e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Vo={key:2,class:"text-secondary"},Fo={key:0,class:"p-0 m-0 ps-2"},To={key:1,class:"p-0 m-0 ps-2"},Eo={class:"border rounded"},zo={class:""},Po=["onClick"],Oo=be(()=>e("i",{class:"bi bi-trash"},null,-1)),Do=[Oo],Lo={class:"d-flex text-secondary ms-2"},Go={class:"add-options hover-light"},Ro=be(()=>e("i",{class:"bi bi-plus"},null,-1)),jo=be(()=>e("i",{class:"bi bi-plus"},null,-1)),Ao=L({__name:"FilterGroupInput",props:{filter:Object,manager:_e,parent:HTMLElement},emits:["delete"],setup(p,{emit:u}){const s=q(),n=p,r=V(()=>n.filter),i=V(()=>r.value.filters),h=V(()=>{let o=255-(r.value.depth+1)*5;return`background: rgb(${o},${o},${o});`});function $(o,c){n.manager.updateFilter(o,{propertyId:c})}function m(o){n.manager.deleteFilter(o.id)}function _(o){n.manager.addNewFilterGroup(o)}function l(o,c){n.manager.updateFilterGroup(o,c)}return(o,c)=>{const g=Me("FilterGroupInput",!0);return t(),a("div",$o,[e("table",ko,[(t(!0),a(P,null,H(i.value,(b,v)=>(t(),a("tr",null,[e("td",xo,[v==0?(t(),a("div",wo,f(o.$t("modals.filters.where")),1)):v==1?(t(),T(se,{key:1},{button:x(()=>[e("div",Io,[e("span",So,f(o.$t("modals.filters."+r.value.groupOperator)),1)])]),popup:x(({hide:S})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:S},[e("div",{class:"base-btn",onClick:c[0]||(c[0]=G=>l(r.value.id,d(Te).and))},f(o.$t("modals.filters.and")),1),Mo,e("div",{class:"base-btn",onClick:c[1]||(c[1]=G=>l(r.value.id,d(Te).or))},f(o.$t("modals.filters.or")),1)],8,Co)]),_:1})):(t(),a("span",Vo,f(o.$t("modals.filters."+r.value.groupOperator)),1))]),b.propertyId!==void 0?(t(),a("td",Fo,[k(et,{"model-value":d(s).properties[b.propertyId],"onUpdate:modelValue":S=>$(b.id,S.id)},null,8,["model-value","onUpdate:modelValue"])])):y("",!0),b.propertyId!==void 0?(t(),a("td",To,[k(he,{class:"flex-grow-1",manager:p.manager,mode:2,"parent-id":r.value.id,"filter-id":b.id,parent:n.parent},{default:x(()=>[k(bo,{filter:b},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(t(),a("td",{key:2,colspan:"3",style:W(h.value)},[e("div",Eo,[k(g,{filter:b,manager:n.manager},null,8,["filter","manager"])])],4)),e("td",zo,[e("span",{class:"base-btn",onClick:S=>m(b)},Do,8,Po)])]))),256))]),e("div",Lo,[k(he,{manager:n.manager,"parent-id":r.value.id},{default:x(()=>[e("div",Go,[Ro,ee(f(o.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),e("div",{class:"add-options hover-light",onClick:c[2]||(c[2]=b=>_(r.value.id))},[jo,ee(f(o.$t("modals.filters.new_group")),1)])])])}}});const No=j(Ao,[["__scopeId","data-v-7c086868"]]),Ho=p=>(Y("data-v-9832f887"),p=p(),X(),p),Uo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Bo={key:0},qo=Ho(()=>e("span",{class:"text-primary"},"Text Query",-1)),Ko={key:0,class:"or-separator"},Qo={key:0,class:"or-separator"},Wo={key:0,class:"m-1 p-0"},Yo=L({__name:"GlobalFilterInputDropdown",props:{manager:_e},emits:["update:modelValue"],setup(p,{emit:u}){const s=q(),n=p,r=C(null),i=C(null),h=V(()=>{let m=$(n.manager.state.filter),_={};return m.forEach(l=>_[l.propertyId]=l),Object.values(_)});function $(m){let _=[];for(let l of m.filters)l.isGroup?_.push(...$(l)):_.push(l);return _}return B(()=>n.manager.state.filter.filters,()=>{n.manager.state.filter.filters.length==0&&i.value.hide()}),(m,_)=>(t(),T(se,{ref_key:"dropdownElem",ref:i},{button:x(()=>[e("div",null,[h.value.length||n.manager.state.query?(t(),a("div",Uo,[n.manager.state.query?(t(),a("div",Bo,[qo,h.value.length?(t(),a("span",Ko,"|")):y("",!0)])):y("",!0),(t(!0),a(P,null,H(h.value,(l,o)=>(t(),a("div",null,[o>0?(t(),a("span",Qo,"|")):y("",!0),l.propertyId==d(De).id?(t(),T(Ie,{key:1,type:d(s).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),e("span",null,f(d(s).properties[l.propertyId].name),1)]))),256))])):y("",!0)])]),popup:x(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:r},[Object.keys(d(s).properties).length>0?(t(),a("div",Wo,[k(No,{filter:n.manager.state.filter,manager:n.manager,parent:r.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}});const Xo=j(Yo,[["__scopeId","data-v-9832f887"]]),Zo=p=>(Y("data-v-1d7e82c5"),p=p(),X(),p),Jo={class:"d-flex flex-row filter-form"},ea={class:"pt-1 pb-1"},ta=Zo(()=>e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)),sa=L({__name:"FilterForm",props:{manager:_e},setup(p){const u=p;return(s,n)=>(t(),a("div",Jo,[e("div",ea,f(s.$t("main.menu.filters"))+": ",1),k(Xo,{manager:u.manager},null,8,["manager"]),k(he,{manager:u.manager,class:"p-1"},{default:x(()=>[ta]),_:1},8,["manager"])]))}});const oa=j(sa,[["__scopeId","data-v-1d7e82c5"]]),aa=p=>(Y("data-v-2f10e29f"),p=p(),X(),p),na=aa(()=>e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)),la={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},ia=L({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(p,{emit:u}){const s=p,n=u,r=C(null);return(i,h)=>(t(),T(se,{ref_key:"dropdownElem",ref:r,"auto-focus":!1},{button:x(()=>[na]),popup:x(()=>[e("div",la,[k(Oe,{onClick:h[0]||(h[0]=$=>d(Ce)()),onSelect:h[1]||(h[1]=$=>{n("select",$),r.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const je=j(ia,[["__scopeId","data-v-2f10e29f"]]),ra={class:"base-hover ps-1 pe-1"},da={class:"main"},ca=["onClick"],pa=L({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(p,{emit:u}){const s=p,n=u,r=Object.values(Re);function i(h){n("update:modelValue",h)}return(h,$)=>(t(),T(se,null,{button:x(()=>[e("div",ra,f(s.modelValue),1)]),popup:x(({hide:m})=>[e("div",da,[(t(!0),a(P,null,H(d(r),_=>(t(),a("div",{class:"base-hover option",onClick:l=>{i(_),m()}},f(_),9,ca))),256))])]),_:1}))}});const ua=j(pa,[["__scopeId","data-v-cc9d0d61"]]),_a=p=>(Y("data-v-a27bea28"),p=p(),X(),p),ma=_a(()=>e("i",{class:"bi bi-three-dots-vertical"},null,-1)),va={class:""},ga={class:"d-flex ipt"},ha={class:"ms-2",min:"1"},ya=L({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(p,{emit:u}){const s=p,n=u,r=C(1),i=C(Re.Year);function h(){s.option.stepSize==r.value&&s.option.stepUnit==i.value||n("change",{stepSize:r.value,stepUnit:i.value})}function $(){r.value=s.option.stepSize??1,i.value=s.option.stepUnit}return B(()=>s.option,$),pe($),B(r,()=>{(r.value<1||r.value==null||isNaN(r.value))&&(r.value=1)}),(m,_)=>(t(),T(se,{onHide:h},{button:x(()=>[ma]),popup:x(({hide:l,focus:o})=>[e("div",va,[e("div",ga,[e("div",null,[ue(e("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=c=>r.value=c)},null,512),[[fe,r.value]])]),e("div",ha,[k(ua,{modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=c=>i.value=c),onHide:o},null,8,["modelValue","onHide"])])])])]),_:1}))}});const fa=j(ya,[["__scopeId","data-v-a27bea28"]]),ba={class:"d-flex flex-row group-form"},$a={class:"pt-1 pb-1"},ka={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},xa={key:0,class:"bi bi-chevron-right smaller"},wa=["onClick"],Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa=["onClick"],Ta=["onClick"],Ea=["onClick"],za={key:5,class:"sm-btn"},Pa={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Oa=L({__name:"GroupForm",props:{isLoading:Boolean,manager:tt},setup(p){const u=q(),s=p;function n(l){s.manager.setGroupOption(l),s.manager.update(!0)}function r(l){s.manager.delGroupOption(l),s.manager.update(!0)}function i(l,o){s.manager.setGroupOption(l,{direction:o}),s.manager.sortGroups(!0)}function h(l,o){s.manager.setGroupOption(l,{type:o}),s.manager.sortGroups(!0)}function $(l,o){s.manager.setGroupOption(l,o),s.manager.update(!0)}const m=V(()=>s.manager.state.groupBy.map(l=>u.properties[l])),_=V(()=>{const l=[];return s.manager.state.groupBy.forEach(o=>{l.push({option:s.manager.state.options[o],property:u.properties[o]})}),l});return(l,o)=>(t(),a("div",ba,[e("div",$a,f(l.$t("main.menu.groupby"))+": ",1),m.value.length?(t(),a("div",ka,[(t(!0),a(P,null,H(_.value,(c,g)=>(t(),a(P,null,[g>0?(t(),a("i",xa)):y("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:b=>r(c.property.id),id:"remove-group-button"},f(c.property.name),9,wa),c.option.type==d(ie).Size?(t(),T(z,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:x(()=>[c.option.direction==d(te).Ascending?(t(),a("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:b=>h(c.property.id,d(ie).Property)},null,8,Ia)):(t(),a("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:b=>h(c.property.id,d(ie).Property)},null,8,Sa))]),_:2},1024)):(t(),T(z,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:x(()=>[c.property.type==d(F).number?(t(),a(P,{key:0},[c.option.direction==d(te).Ascending?(t(),a("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:b=>h(c.property.id,d(ie).Size)},null,8,Ca)):(t(),a("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:b=>h(c.property.id,d(ie).Size)},null,8,Ma))],64)):(t(),a(P,{key:1},[c.option.direction==d(te).Ascending?(t(),a("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:b=>h(c.property.id,d(ie).Size)},null,8,Va)):(t(),a("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:b=>h(c.property.id,d(ie).Size)},null,8,Fa))],64))]),_:2},1024)),c.option.direction==d(te).Ascending?(t(),T(z,{key:3,message:"main.menu.sort.order_asc"},{default:x(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:b=>i(c.property.id,d(te).Descending)},null,8,Ta)]),_:2},1024)):(t(),T(z,{key:4,message:"main.menu.sort.order_desc"},{default:x(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:b=>i(c.property.id,d(te).Ascending)},null,8,Ea)]),_:2},1024)),c.property.type==d(F).date?(t(),a("div",za,[k(fa,{option:c.option,onChange:b=>$(c.property.id,b)},null,8,["option","onChange"])])):y("",!0)],64))),256)),s.isLoading?(t(),a("i",Pa)):y("",!0)])):y("",!0),k(je,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:o[0]||(o[0]=c=>n(c))},null,8,["group-ids"])]))}});const Da=j(Oa,[["__scopeId","data-v-388718c9"]]),La={class:"d-flex flex-row sort-form"},Ga={class:"pt-1 pb-1"},Ra={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},ja={key:0,class:"bi bi-chevron-right smaller"},Aa=["onClick"],Na=["onClick"],Ha=["onClick"],Ua=L({__name:"SortForm",props:{manager:st},setup(p){const u=q(),s=p,n=V(()=>s.manager.state.sortBy.map(m=>({propertyId:m,direction:s.manager.state.options[m].direction}))),r=V(()=>n.value.map(m=>m.propertyId));function i(m){s.manager.setSort(m),s.manager.update(!0)}function h(m){s.manager.delSort(m),s.manager.update(!0)}function $(m,_){s.manager.setSort(m,{direction:_}),s.manager.update(!0)}return(m,_)=>(t(),a("div",La,[e("div",Ga,f(m.$t("main.menu.sort.title"))+": ",1),n.value.length?(t(),a("div",Ra,[(t(!0),a(P,null,H(n.value,(l,o)=>(t(),a(P,null,[o>0?(t(),a("i",ja)):y("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:c=>h(l.propertyId)},f(d(u).properties[l.propertyId].name),9,Aa),l.direction==d(te).Ascending?(t(),T(z,{key:1,message:"main.menu.sort.order_asc"},{default:x(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:c=>$(l.propertyId,d(te).Descending)},null,8,Na)]),_:2},1024)):(t(),T(z,{key:2,message:"main.menu.sort.order_desc"},{default:x(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:c=>$(l.propertyId,d(te).Ascending)},null,8,Ha)]),_:2},1024))],64))),256))])):y("",!0),k(je,{"group-ids":r.value,onSelect:_[0]||(_[0]=l=>i(l))},null,8,["group-ids"])]))}});const Ba=j(Ua,[["__scopeId","data-v-80dc564a"]]),$e=p=>(Y("data-v-ba1876b2"),p=p(),X(),p),qa=$e(()=>e("i",{class:"bi bi-clock-history me-1"},null,-1)),Ka={class:"p-2"},Qa={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Wa={class:"border mb-1 p-1"},Ya={class:"me"},Xa=$e(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),Za={key:0},Ja={key:1},en={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},tn={class:"d-flex center justify-content-center"},sn={key:1,class:"bi bi-arrow-down text-secondary"},on=$e(()=>e("div",{style:{width:"30px"}},null,-1)),an={key:3,class:"bi bi-arrow-up text-secondary"},nn={class:"border mb-1 p-1"},ln={class:"me"},rn=$e(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),dn={key:0},cn={key:1},pn={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},de=5,un=L({__name:"HistoryDropdown",emits:[],setup(p,{emit:u}){const s=q(),n=C(!1),r=V(()=>n.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),i=V(()=>[...s.history.undo].reverse().slice(0,de)),h=V(()=>s.history.redo.slice(Math.max(s.history.redo.length-de,0)));return B(()=>s.onUndo,()=>{console.log("changed"),n.value=!0,setTimeout(()=>n.value=!1,100)}),($,m)=>i.value.length||h.value.length?(t(),T(se,{key:0},{button:x(()=>[k(z,{message:"dropdown.history.info"},{default:x(()=>[e("div",{class:"d-flex sb flash",style:W([{"font-size":"14px"},r.value])},[qa,e("div",null,f($.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:x(()=>[e("div",Ka,[d(s).history.redo.length>de?(t(),a("div",Qa," + "+f(d(s).history.redo.length-de),1)):y("",!0),(t(!0),a(P,null,H(h.value,_=>(t(),a("div",Wa,[e("span",Ya,f(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),Xa,_.tags?(t(),a("span",Za,f(_.tags)+" "+f($.$t("dropdown.history.tags")),1)):y("",!0),_.values?(t(),a("span",Ja,f(_.values)+" "+f($.$t("dropdown.history.values")),1)):y("",!0)]))),256)),e("div",en,[e("div",tn,[i.value.length?(t(),T(z,{key:0,message:"dropdown.history.undo"},{default:x(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:m[0]||(m[0]=(..._)=>d(s).undo&&d(s).undo(..._))})]),_:1})):(t(),a("div",sn)),on,h.value.length?(t(),T(z,{key:2,message:"dropdown.history.redo"},{default:x(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:m[1]||(m[1]=(..._)=>d(s).redo&&d(s).redo(..._))})]),_:1})):(t(),a("div",an))])]),(t(!0),a(P,null,H(i.value,_=>(t(),a("div",nn,[e("span",ln,f(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),rn,_.tags?(t(),a("span",dn,f(_.tags)+" "+f($.$t("dropdown.history.tags")),1)):y("",!0),_.values?(t(),a("span",cn,f(_.values)+" "+f($.$t("dropdown.history.values")),1)):y("",!0)]))),256)),d(s).history.undo.length>de?(t(),a("div",pn," + "+f(d(s).history.undo.length-de),1)):y("",!0)])]),_:1})):y("",!0)}});const _n=j(un,[["__scopeId","data-v-ba1876b2"]]),Ve=p=>(Y("data-v-6c701a49"),p=p(),X(),p),mn=Ve(()=>e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)),vn=Ve(()=>e("span",{class:"bi bi-check2-all text-success"},null,-1)),gn=Ve(()=>e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)),hn=L({__name:"ToggleReload",emits:[],setup(p,{emit:u}){const s=re(),n=V(()=>s.getTab().autoReload?2:s.getTabManager().collection.state.isDirty?0:1);function r(){n.value==0?s.getTabManager().collection.update():n.value==1?(s.getTab().autoReload=!0,s.updateTabs()):(s.getTab().autoReload=!1,s.updateTabs())}return(i,h)=>(t(),a("div",{class:"bb font",onClick:r,style:{width:"26px",height:"30px",overflow:"hidde"}},[n.value==0?(t(),T(z,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:x(()=>[mn]),_:1})):y("",!0),n.value==1?(t(),T(z,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:x(()=>[vn]),_:1})):y("",!0),n.value==2?(t(),T(z,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:x(()=>[gn]),_:1})):y("",!0)]))}});const yn=j(hn,[["__scopeId","data-v-6c701a49"]]),me=p=>(Y("data-v-bae1075e"),p=p(),X(),p),fn={class:"d-flex flex-row p-2"},bn=me(()=>e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),$n=["placeholder"],kn={class:"me-5 d-flex"},xn=me(()=>e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),wn={class:"ms-5",style:{"font-size":"13px"}},In=["checked"],Sn=me(()=>e("span",{class:"ms-1"},"Mode Image unique",-1)),Cn={class:"ms-4"},Mn=me(()=>e("div",{class:"flex-grow-1"},null,-1)),Vn=me(()=>e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)),Fn={class:"d-flex flex-wrap content-container ps-2"},Tn=L({__name:"ContentFilter",props:{tab:ot,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(p,{emit:u}){const s=p,n=C(""),r=V(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),i=V(()=>r.value.length);function h(l){const o=l.target.checked;s.tab.collection.groupManager.setSha1Mode(o,!0)}function $(){n.value=s.tab.state.filterState.query}function m(){s.tab.collection.filterManager.setQuery(n.value),s.tab.collection.filterManager.update(!0)}function _(){s.tab.collection.filterManager.setQuery(""),s.tab.collection.filterManager.update(!0)}return pe($),B(()=>s.tab.collection.filterManager.state.query,$),(l,o)=>(t(),a(P,null,[e("div",fn,[k(z,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:x(()=>[e("div",{class:N(["d-flex flex-row search-input me-5",n.value?"border-primary":""])},[bn,ue(e("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":o[0]||(o[0]=c=>n.value=c),onChange:m},null,40,$n),[[fe,n.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")],2)]),_:1}),e("div",kn,[k(z,{message:"main.menu.grid_tooltip"},{default:x(()=>[e("i",{class:N("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:o[1]||(o[1]=c=>s.tab.state.display="tree")},null,2)]),_:1}),k(z,{message:"main.menu.table_tooltip"},{default:x(()=>[e("i",{id:"toot",class:N("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:o[2]||(o[2]=c=>s.tab.state.display="grid")},null,2)]),_:1}),k(z,{message:"main.menu.graph_tooltip"},{default:x(()=>[e("i",{id:"toot",class:N("bi bi-bar-chart btn-icon"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:o[3]||(o[3]=c=>s.tab.state.display="graph")},null,2)]),_:1})]),k(z,{message:"main.menu.image_size_tooltip",click:!1},{default:x(()=>[xn]),_:1}),e("div",null,[k(at,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":o[4]||(o[4]=c=>s.tab.state.imageSize=c)},null,8,["modelValue"])]),e("div",wn,[k(z,{message:"main.menu.image_mode_tooltip"},{default:x(()=>[e("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:h},null,40,In),Sn]),_:1})]),e("div",Cn,[k(_n)]),i.value?(t(),T(nt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":r.value,"onRemove:selected":o[5]||(o[5]=c=>s.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0),Mn,k(z,{message:"main.menu.issue",class:"bb"},{default:x(()=>[Vn]),_:1})]),e("div",Fn,[k(yn,{class:"me-1"}),k(oa,{manager:s.tab.collection.filterManager},null,8,["manager"]),k(Da,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),k(Ba,{manager:s.tab.collection.sortManager},null,8,["manager"])])],64))}});const En=j(Tn,[["__scopeId","data-v-bae1075e"]]),zn={class:""},Pn={class:"d-flex flex-row"},On=L({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(p,{emit:u}){const s=ye(),n=p,r=u,i=V(()=>`width: ${n.size}px; height: ${n.size}px;`);V(()=>`max-width: ${n.size-2}px; max-height: ${n.size-1}px;`);const h=V(()=>n.pile.images[0]);return($,m)=>(t(),a("div",zn,[k(it,{image:h.value},{default:x(()=>[e("div",{style:W(i.value),class:"img-container",onClick:m[0]||(m[0]=_=>d(s).showModal(d(ne).IMAGE,{image:h.value}))},[k(lt,{image:h.value,width:n.size-2,height:n.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Pn,[k(z,{message:"main.recommand.accept"},{default:x(()=>[e("div",{style:W(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:m[1]||(m[1]=_=>r("accept",h.value))}," ✓ ",4)]),_:1}),k(z,{message:"main.recommand.refuse"},{default:x(()=>[e("div",{style:W(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:m[2]||(m[2]=_=>r("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const Dn=j(On,[["__scopeId","data-v-809d667b"]]),ve=p=>(Y("data-v-8f1f076a"),p=p(),X(),p),Ln={class:"reco-container"},Gn={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Rn=ve(()=>e("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),jn=[Rn],An=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),Nn=ve(()=>e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Hn=[Nn],Un=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),Bn={key:0,class:"bi bi-funnel-fill bb text-primary"},qn={key:1,class:"bi bi-funnel bb"},Kn=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),Qn={class:"text-secondary me-2"},Wn={class:"flex-grow-1"},Yn={class:"d-flex flex-row"},Xn={key:0,class:"separator"},Zn={class:"d-flex flex-row"},xe=10,Jn=L({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(p,{emit:u}){const s=re(),n=q(),r=rt(),i=p,h=u,$=C(1),m=ce([]),_=ce([]),l=ce([]),o=ce(new Set),c=C(!0);function g(M){let w=_.indexOf(M);w<0||(_.splice(w,1),S())}async function b(M){const w=[],I=[];l.forEach(R=>{if(R.value!=null){const Q=n.properties[R.propertyId];let D=R.value;Q.type==F.multi_tags?(D=M.properties[R.propertyId]??[],D=[...D,R.value]):Q.type==F.tag&&(D=[D]),Q.mode==Se.id?I.push({instanceId:M.id,propertyId:Q.id,value:D}):w.push({propertyId:Q.id,sha1:M.sha1,value:D})}}),await n.setPropertyValues(I,w),g(M.sha1)}function v(M){o.add(M.sha1),g(M.sha1)}function S(){m.length=0;const M=_.map(w=>({sha1:w,images:n.sha1Index[w]}));G(M,m,$.value,i.imageSize,i.width)}function G(M,w,I,R,Q){let D=Q,E=[],O=0;for(let Z=0;Z<M.length&&!(w.length>=I);Z++){let oe=M[Z];if(o.has(oe.sha1))continue;let ge=R+xe;if(O+ge<D){E.push(oe),O+=ge;continue}if(E.length==0)throw new Error("Images seems to be to big for the line");w.push(E),w.length<I&&(E=[oe],O=ge)}E.length>0&&w.length<I&&w.push(E)}async function U(){if(!i.group)return;console.log("get reco");const M=i.group.images.map(E=>E.id);let w=await r.getSimilarImages({instanceIds:M});if(console.log(w),!w.instances)throw new Error("No instances in ActionResult");let I=[];const R=w.instances.scores??[];if(w.instances.ids)for(let E in w.instances.ids){const O={id:w.instances.ids[E],score:R[E]};I.push(O)}else for(let E in w.instances.sha1s){const O=w.instances.sha1s[E];for(let Z of n.sha1Index[O]){const oe={id:Z.id,score:R[E]};I.push(oe)}}if(I.sort((E,O)=>O.score-E.score),c.value){const E=s.getTabManager(),O=new Set(E.collection.groupManager.result.root.images.map(Z=>Z.id));I=I.filter(Z=>O.has(Z.id))}const Q=Array.from(new Set(I.map(E=>n.instances[E.id].sha1)));l.length=0;let D=i.group;for(;D;)l.push(...D.meta.propertyValues),D=D.parent;_.length=0,_.push(...Q),o.clear(),S(),h("update")}function K(){c.value=!c.value}return pe(U),B(()=>i.group,()=>{U(),o.clear()}),B(()=>i.imageSize,S),B(()=>i.width,S),B(c,U),(M,w)=>(t(),a("div",Ln,[e("div",Gn,[e("div",{class:"text-secondary pe-1",onClick:w[0]||(w[0]=I=>h("close"))},jn),An,e("div",{class:"text-secondary pe-1",onClick:w[1]||(w[1]=I=>h("scroll",i.group.id))},Hn),Un,e("div",{class:"text-secondary pe-1",onClick:K},[c.value?(t(),a("span",Bn)):(t(),a("span",qn))]),Kn,k(z,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:x(()=>[e("span",Qn,f(M.$t("main.recommand.title")),1)]),_:1}),e("div",Wn,[e("div",Yn,[(t(!0),a(P,null,H(l,(I,R)=>(t(),a(P,null,[k(dt,{class:"",value:I},null,8,["value"]),R<l.length-1?(t(),a("div",Xn)):y("",!0)],64))),256))])])]),e("div",{style:W("margin-left:"+xe+"px;")},[(t(!0),a(P,null,H(m,I=>(t(),a("div",null,[e("div",Zn,[(t(!0),a(P,null,H(I,R=>(t(),T(Dn,{pile:R,size:i.imageSize,onAccept:b,onRefuse:v,style:W("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const el=j(Jn,[["__scopeId","data-v-8f1f076a"]]);const tl={style:{display:"flex"}},sl={class:"info"},ol=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1),al={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:F},height:String},setup(p){const u=p,s=C(0),n=C(!1),r={};Object.keys(u.chartData.series).forEach(o=>{r[o]=!1});const i=C({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:u.chartData.dataType===F.date?"datetime":"numeric",categories:u.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:o,seriesIndex:c,dataPointIndex:g,w:b}){const v=u.chartData.series[c].data[g];let S='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';v.images.forEach((U,K)=>{K<10&&(S+=`<div style="width: 75px; height: 75px;"><img src="${U}" style="width: 100%; height: 100%;" /></div>`)}),S+="</div>";let G=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${u.chartData.series[c].name} — </b> ${v.y} Images</span>`;return G+=`<div>${S}</div>`,G}}}),h=()=>{i.value.chart.stacked=!i.value.chart.stacked,n.value=!n.value,s.value+=1},$=()=>{let o;i.value.chart.type==="area"?o={chart:{...i.value.chart,type:"bar"}}:o={chart:{...i.value.chart,type:"area"}},i.value={...i.value,...o},s.value+=1},m=(o,c,g)=>{const v=u.chartData.series[c];let S=Math.max(...v.data.map(G=>G.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(G=>G.remove()),r[c]){r[c]=!1;return}v.data.forEach((G,U)=>{const M=Math.floor(G.y/S*17),w=G.images.slice(0,M),I=`circle[index="${c}"][j="${U}"]`,R=document.querySelector(I),Q=parseFloat(R.getAttribute("cx"));w.forEach((D,E)=>{const O=document.createElement("img");O.src=D,O.width=40,O.height=40,O.style.position="absolute";let Z=Q+40/1.5,oe=65+E*40;O.style.left=`${Z}px`,O.style.bottom=`${oe}px`,O.classList.add("apexcharts-custom-image"),O.addEventListener("mouseover",ge=>_(Z,oe,D)),O.addEventListener("mouseout",l),o.el.appendChild(O)})}),Object.keys(r).forEach(G=>r[G]=!1),r[c]=!0};function _(o,c,g){const b=document.getElementById("zoomed-image");b.style.left=`${o+120*1.5}px`,b.src=g,b.style.bottom=`${c}px`,b.style.display="block"}function l(){const o=document.getElementById("zoomed-image");o.style.display="none"}return console.log("test"),(o,c)=>{const g=Me("apexchart");return t(),a(P,null,[e("div",tl,[e("button",{class:"mt-2",onClick:$},f(i.value.chart.type==="area"?o.$t("main.graph-view.histo"):o.$t("main.graph-view.curve")),1),u.chartData.series.length>1?(t(),a("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:h},f(n.value?o.$t("main.graph-view.over"):o.$t("main.graph-view.stack")),1)):y("",!0)]),(t(),T(g,{style:{position:"relative"},key:s.value,height:u.height,type:i.value.chart.type,options:i.value,series:u.chartData.series,onLegendClick:m},null,8,["height","type","options","series"])),e("i",sl,f(o.$t("main.graph-view.info")),1),ol],64)}}},nl={key:1},ll=L({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(p,{emit:u}){const s=q(),n=p,r=C(""),i=C($());function h(){const m=new Set;let _=n.collection.groupManager.getGroupIterator();for(;_;){const l=_.group;if(console.log(l.id),l.id===0||l.meta.propertyValues&&l.meta.propertyValues[0].value==null){_=_.nextGroup();continue}for(let o of l.children)m.add(o.meta.propertyValues[0].value);l.children.forEach(()=>_=_.nextGroup()),_=_.nextGroup()}return m}function $(){const m={};let _,l=n.collection.groupManager.state.groupBy;if(l.length===0){r.value="Choose at least one date or numeric value to group the images by";return}const o=s.properties[l[0]],c=o.type;if(l.length>2){r.value="Only max two levels of grouping are supported";return}else l.length===1?m[o.name]={name:o.name,data:[]}:_=Array.from(h());if(c!==F.number&&c!==F.date){r.value="First level of grouping needs to be a date or a numeric property";return}let g=n.collection.groupManager.getGroupIterator();const b=[];for(;g;){const v=g.group;if(v.id===0||v.meta.propertyValues&&v.meta.propertyValues[0].value==null){g=g.nextGroup();continue}let S=v.meta.propertyValues[0];const G=c===F.date?S.value.getTime():S.value;if(b.push(G),o.name in m)m[o.name].data.push({x:G,y:v.images.length,images:v.images.slice(0,20).map(U=>U.urlSmall)});else{const U=v.children.map(M=>M.meta.propertyValues[0].value),K=_.filter(M=>!U.includes(M));for(let M of v.children){const w=M.meta.propertyValues[0].value;if(m[w]===void 0){let I=w;w in s.tags&&(I=s.tags[w].value),m[w]={data:[],name:I}}m[M.meta.propertyValues[0].value].data.push({x:G,y:M.images.length,images:M.images.slice(0,20).map(I=>I.urlSmall)})}for(let M of K){if(m[M]===void 0){let w=M;M in s.tags&&(w=s.tags[M].value),m[M]={data:[],name:w}}m[M].data.push({x:G,y:0,images:[]})}v.children.forEach(()=>g=g.nextGroup())}g=g.nextGroup()}return r.value="",{series:Object.values(m),xValues:b,dataType:c}}return n.collection.groupManager.onChange.addListener(()=>i.value=$()),(m,_)=>(t(),a("div",{class:"",style:W({height:n.height+"px"})},[r.value===""?(t(),T(al,{key:0,chartData:i.value,height:n.height-50+"px"},null,8,["chartData","height"])):(t(),a("span",nl,f(r.value),1))],4))}}),il={key:0,class:"m-0 p-0"},rl={key:0,style:{"margin-left":"10px"}},dl=L({__name:"MainView",props:{tabId:Number,height:Number},setup(p){const u=re(),s=u.getTabManager(),n=p,r=C({}),i=C(null),h=C(null),$=C(null),m=C(0),_=C(0),l=ce({groups:!1}),o=V(()=>s.getVisibleProperties());function c(){i.value&&h.value?m.value=n.height-i.value.clientHeight-h.value.clientHeight-5:i.value?m.value=n.height-i.value.clientHeight-5:m.value=0}s.collection.groupManager.onChange.addListener(()=>{$.value&&s.state.display=="tree"&&$.value.computeLines()});function g(v){r.value=s.collection.groupManager.result.index[v],ae(()=>c())}function b(){r.value={},ae(()=>c())}return pe(()=>{_.value=i.value.clientWidth,window.addEventListener("resize",()=>{ae(()=>{var v;_.value=((v=i.value)==null?void 0:v.clientWidth)??_.value})})}),B(()=>s.state.imageSize,()=>ae(c)),B(()=>n.height,async()=>{await ae(c)}),B(s.state,v=>{u.updateTabs()},{deep:!0}),(v,S)=>(t(),a(P,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:i},[k(En,{tab:d(s),"compute-status":l},null,8,["tab","compute-status"])],512),e("div",{ref_key:"boxElem",ref:h,class:"m-0 p-0"},[r.value.id?(t(),a("div",il,[k(el,{group:r.value,"image-size":d(s).state.imageSize,width:_.value,height:50,onClose:b,onScroll:$.value.scrollTo,onUpdate:S[0]||(S[0]=G=>ae(()=>c()))},null,8,["group","image-size","width","onScroll"])])):y("",!0)],512),_.value>0&&m.value>0?(t(),a("div",rl,[d(s).state.display=="tree"?(t(),T(ct,{key:0,"group-manager":d(s).collection.groupManager,"image-size":d(s).state.imageSize,height:m.value-0,properties:o.value,"hide-if-modal":!0,"selected-images":d(s).collection.groupManager.selectedImages,ref_key:"imageList",ref:$,width:_.value-25,onRecommend:g},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),d(s).state.display=="grid"?(t(),a("div",{key:1,style:W({width:_.value-12+"px"}),class:"p-0 m-0 grid-container"},[k(pt,{manager:d(s).collection.groupManager,height:m.value-15,width:_.value-40,"selected-properties":o.value,class:"p-0 m-0","show-images":!0,"selected-images":d(s).collection.groupManager.selectedImages,ref_key:"imageList",ref:$,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):y("",!0),d(s).state.display=="graph"?(t(),T(ll,{key:2,collection:d(s).collection,height:m.value-15},null,8,["collection","height"])):y("",!0)])):y("",!0)],64))}});const cl=j(dl,[["__scopeId","data-v-3614dcc8"]]),pl={class:"d-flex d-row",style:{cursor:"pointer"}},ul=["onMouseenter","onMouseleave"],_l=["onClick"],ml=["onClick"],vl=["onClick"],gl=["onSubmit"],hl=["onKeydown","onUpdate:modelValue"],yl=e("span",{class:"bi bi-plus"},null,-1),fl=[yl],bl={class:"lang"},$l=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),kl=["value"],xl=L({__name:"TabNav",props:{reRender:Function},setup(p){const u=re(),s=C(-1),n=C(""),r=C(null),i=p;function h(g){u.data.selectedTabId==g||m(),u.selectTab(g)}function $(g){s.value=g,n.value=u.data.tabs[g].name,ae(()=>r.value[0].focus())}function m(){s.value=-1,n.value=""}function _(g){u.addTab("New Tab")}async function l(g){confirm("Are you sure to delete Tab: "+g.name)&&await u.removeTab(g.id)}const o=ce({});C(-1);const c=["fr","en"];return(g,b)=>(t(),a("nav",null,[e("div",pl,[(t(!0),a(P,null,H(d(u).data.tabs,v=>(t(),a("div",{class:"d-flex d-row me-2",onMouseenter:S=>o[v.id]=!0,onMouseleave:S=>o[v.id]=!1},[s.value!=v.id?(t(),a(P,{key:0},[k(z,{message:"main.menu.rename_tab_tooltip"},{default:x(()=>[e("i",{onClick:S=>$(v.id),class:N(["bi bi-pencil me-1 tab-icon hover-light",o[v.id]&&d(u).data.selectedTabId==v.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,_l)]),_:2},1024),e("div",{class:N(["tab-button",v.id==d(u).data.selectedTabId?" active":""]),onClick:S=>h(v.id)},[e("span",null,f(v.name),1)],10,ml),k(z,{message:"main.menu.delete_tab_tooltip"},{default:x(()=>[e("i",{onClick:S=>l(v),class:N(["btn-icon bi bi-x tab-icon hover-light",o[v.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,vl)]),_:2},1024)],64)):(t(),a("div",{key:1,class:N(["tab-button",v.id==d(u).data.selectedTabId?" active":""])},[e("form",{onSubmit:Ge(m,["stop","prevent"])},[ue(e("input",{onFocusout:m,onKeydown:ut(m,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":S=>v.name=S,ref_for:!0,ref_key:"inputElem",ref:r},null,40,hl),[[fe,v.name]])],40,gl)],2))],40,ul))),256)),k(z,{message:"main.menu.add_tab_tooltip"},{default:x(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_,id:"add-tab-button"},fl)]),_:1}),e("div",bl,[$l,ue(e("select",{"onUpdate:modelValue":b[0]||(b[0]=v=>g.$i18n.locale=v),onChange:b[1]||(b[1]=v=>i.reRender())},[(t(),a(P,null,H(c,(v,S)=>e("option",{key:`Lang${S}`,value:v},f(v.toUpperCase()),9,kl)),64))],544),[[_t,g.$i18n.locale]])])])]))}});const Ae=p=>(Y("data-v-c4d939dc"),p=p(),X(),p),wl={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Il={class:"w-100"},Sl={key:0,class:"custom-hr"},Cl={key:1,class:"loading"},Ml={class:"text-center"},Vl={key:2,class:"loading"},Fl=Ae(()=>e("i",{class:"spinner-border",role:"status"},null,-1)),Tl=Ae(()=>e("span",{class:"ms-1"},"Loading...",-1)),El=[Fl,Tl],zl=L({__name:"PanopticView",setup(p){const u=re(),s=q(),n=ye(),r=C(null),i=C(null),h=C(window.innerHeight),$=C(!1),m=V(()=>{var v;return h.value-(((v=i.value)==null?void 0:v.clientHeight)??0)}),_=V(()=>{var v;return(v=r.value)==null?void 0:v.filteredImages.map(S=>S.id)});let l=navigator.userAgent.indexOf("Mac OS X")!==-1;pe(async()=>{n.isProjectLoaded||Ee.push("/"),ae(()=>{window.addEventListener("resize",o),o()}),window.addEventListener("keydown",v=>{v.key=="Control"&&(A.ctrl=!0),v.key=="Alt"&&(l&&(A.ctrl=!0),A.alt=!0),v.key=="Shift"&&(A.shift=!0),v.key=="ArrowLeft"&&(A.left=!0),v.key=="ArrowRight"&&(A.right=!0,console.log("keeeyy")),v.key=="Z"&&A.ctrl&&s.redo(),v.key=="z"&&A.ctrl&&s.undo()}),window.addEventListener("keyup",v=>{v.key=="Control"&&(A.ctrl=!1),v.key=="Alt"&&(l&&(A.ctrl=!1),A.alt=!1),v.key=="Shift"&&(A.shift=!1),v.key=="ArrowLeft"&&(A.left=!1),v.key=="ArrowRight"&&(A.right=!1)}),window.addEventListener("mousemove",v=>{A.ctrl=v.ctrlKey,A.alt=v.altKey,A.shift=v.shiftKey,l&&(A.ctrl=A.ctrl||A.alt)})}),mt(()=>{window.removeEventListener("resize",o)});function o(){h.value=window.innerHeight,$.value=!0}function c(){n.showModal(ne.EXPORT,_)}function g(){u.rerender()}function b(){Ee.push("/")}return(v,S)=>(t(),a(P,null,[k(vt,{tutorial:"project"}),(t(),a("div",{id:"panoptic",key:d(u).status.renderNb},[e("div",wl,[d(u).status.loaded?(t(),a(P,{key:0},[e("div",null,[k(Ys,{onExport:S[0]||(S[0]=G=>c())})]),e("div",Il,[e("div",{class:"ms-3",ref_key:"navElem",ref:i},[k(xl,{"re-render":g})],512),$.value?(t(),a("div",Sl)):y("",!0),k(cl,{"tab-id":d(u).data.selectedTabId,height:m.value,ref_key:"mainViewRef",ref:r},null,8,["tab-id","height"])])],64)):d(n).isProjectLoaded?(t(),a("div",Vl,El)):(t(),a("div",Cl,[e("div",Ml,[e("div",null,f(v.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:b,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Dl=j(zl,[["__scopeId","data-v-c4d939dc"]]);export{Dl as default};
