import{d as L,h as R,r as I,c as x,o as s,k as V,x as k,b as t,t as g,n as U,a as o,m as j,F as E,D as ee,y as Ge,_ as N,z as ue,i as re,A,B as Ne,C as Ve,e as n,P as Ee,l as y,s as $,E as Te,G as S,H as Re,I as je,S as Ue,J as He,K as Ae,L as Be,p as Q,f as W,N as be,w as pe,v as me,O as $e,Q as z,R as ze,q as X,T as qe,U as Pe,V as B,W as ge,X as Ie,u as we,M as oe,g as ke,Y as Ke,Z as Qe,$ as Se,a0 as We,a1 as Oe,a2 as Ye,a3 as se,a4 as J,a5 as Xe,a6 as Ze,a7 as Je,a8 as et,a9 as tt,aa as st,ab as le,ac as ot,ad as at,ae as te,af as nt,ag as it,ah as lt,ai as rt,j as Ce,aj as H,ak as dt}from"./index-171002d8.js";import{_ as pt}from"./Tutorial-6dd5dd2e.js";const ut=["disabled"],ct={class:"m-0 p-1"},_t=["onClick"],mt=L({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=R(),a=d,p=r,h=I(null),f=x(()=>e.data.properties[a.propertyId]),b=x(()=>Ge(f.value.type));async function m(c){p("update:modelValue",c),h.value.hide()}return(c,l)=>(s(),V(ee,{onHide:l[0]||(l[0]=i=>p("hide")),ref_key:"dropdownElem",ref:h,parent:a.parent},{button:k(()=>[t("div",{class:U(["text-nowrap",a.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:a.disabled},[t("span",null,g(c.$t("modals.filters.operators."+a.modelValue)),1)],10,ut)]),popup:k(()=>[t("div",ct,[(s(!0),o(E,null,j(b.value,i=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>m(i)},[t("a",null,g(c.$t("modals.filters.operators."+i)),1)],8,_t))),256))])]),_:1},8,["parent"]))}});const vt=N(mt,[["__scopeId","data-v-29ed354e"]]),yt=d=>(Q("data-v-319511af"),d=d(),W(),d),ht={class:"m-0 p-0"},gt={key:1},ft={class:"d-flex mode-header"},bt={class:"me-3"},$t=yt(()=>t("div",{class:"flex-fill"},null,-1)),kt={key:0,class:"me-2",style:{width:"100%"}},wt=L({__name:"FilterDropdown",props:{manager:ue,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=R(),e=d,a=I(null),p=I(null),h=I(null),f=I(0),b=I(null),m=I(null),c=x(()=>e.filterId!==void 0?e.filterId:b.value),l=x(()=>{if(!(c.value==null||c.value==-1))return e.manager.filterIndex[c.value]}),i=x(()=>l.value==null?void 0:r.data.properties[l.value.propertyId]);function u(){f.value=e.mode,e.mode==2&&e.filterId==null&&G(e.propertyId)}function _(){a.value&&a.value.hide()}function v(){f.value=0}function w(){_(),e.manager.deleteFilter(c.value),e.manager.update(!0)}function G(T){let F=e.manager.addNewFilter(T,e.parentId);e.manager.update(!0),b.value=F.id,f.value=2}function K(T){m.value=null,e.manager.updateFilter(c.value,{operator:T}),e.manager.update(!0),p.value&&p.value.focus()}function ne(){console.log("update value",m.value),e.manager.updateFilter(c.value,{value:m.value}),e.manager.update(!0)}function D(){if(!l.value)return;const T=r.data.properties[l.value.propertyId];if(Ae(T.type))return;const F=m.value??Be(T.type);l.value.value!=F&&ne()}function M(){l.value&&(m.value=l.value.value)}return re(M),A(()=>l.value,()=>M()),(T,F)=>(s(),V(ee,{ref_key:"dropdownElem",ref:a,onShow:u,onHide:v,parent:e.parent},{button:k(()=>[t("div",ht,[Ne(T.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:h},[f.value!=0?(s(),o(E,{key:0},[f.value==1?(s(),V(Ve,{key:0,onSelect:G,"ignore-ids":[n(Ee).folders]},null,8,["ignore-ids"])):y("",!0),f.value==2?(s(),o("div",gt,[t("div",ft,[t("div",bt,g(i.value.name),1),$(vt,{"property-id":l.value.propertyId,"model-value":l.value.operator,"onUpdate:modelValue":K,parent:h.value},null,8,["property-id","model-value","parent"]),$t,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:w})])]),n(Te)(l.value.operator)?(s(),o("div",kt,[i.value.type==n(S).multi_tags||i.value.type==n(S).tag?(s(),V(Re,{key:0,modelValue:m.value,"onUpdate:modelValue":[F[0]||(F[0]=P=>m.value=P),ne],"auto-focus":!0,property:n(r).data.properties[l.value.propertyId],ref_key:"inputElem",ref:p,onHide:_},null,8,["modelValue","property"])):i.value.type==n(S).color?(s(),V(je,{key:1,property:i.value,modelValue:m.value,"onUpdate:modelValue":[F[1]||(F[1]=P=>m.value=P),F[2]||(F[2]=()=>{_(),D()})]},null,8,["property","modelValue"])):i.value.type==n(S).date?(s(),V(Ue,{key:2,property:i.value,modelValue:m.value,"onUpdate:modelValue":[F[3]||(F[3]=P=>m.value=P),F[4]||(F[4]=()=>{_(),D()})]},null,8,["property","modelValue"])):(s(),V(He,{key:3,"no-html":!0,modelValue:m.value,"onUpdate:modelValue":F[5]||(F[5]=P=>m.value=P),width:-1,"min-height":20,"no-nl":n(r).data.properties[l.value.propertyId].type==n(S).number,"url-mode":n(r).data.properties[l.value.propertyId].type==n(S).url,"only-number":n(r).data.properties[l.value.propertyId].type==n(S).number,onBlur:D,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):y("",!0)])):y("",!0)],64)):y("",!0)],512)]),_:3},8,["parent"]))}});const _e=N(wt,[["__scopeId","data-v-319511af"]]),ae=d=>(Q("data-v-81b7150f"),d=d(),W(),d),xt={class:"d-flex flex-row"},It={key:1,class:"d-flex",style:{width:"150px"}},St={class:"flex-grow-1"},Ct={key:1,style:{"padding-top":"1px"}},Mt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Ft=ae(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),Vt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Et=ae(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Tt=ae(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),zt={key:0,class:"ms-3 pt-1"},Pt=ae(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Ot=ae(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Lt=ae(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Dt=ae(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Gt={key:1},Nt=L({__name:"PropertyOptions",props:{property:Object},setup(d){const r=R(),e=r.getTabManager(),a=d,p=I(!1),h=I(!1),f=I(""),b=I(!1),m=x(()=>r.getTab()),c=x(()=>m.value.visibleProperties[a.property.id]==!0),l=x(()=>e.collection.filterManager.state.filter.filters.some(P=>!P.isGroup&&P.propertyId==a.property.id)),i=x(()=>e.collection.groupManager.state.groupBy.includes(a.property.id)),u=x(()=>e.collection.sortManager.state.sortBy.includes(a.property.id)),_=x(()=>{if(l.value)return e.collection.filterManager.state.filter.filters.find(P=>!P.isGroup&&P.propertyId==a.property.id).id}),v=()=>e.collection.filterManager,w=x(()=>e.getSha1Mode());function G(){c.value?e.setVisibleProperty(a.property.id,!1):e.setVisibleProperty(a.property.id,!0)}function K(){p.value?p.value=!1:(p.value=!0,f.value=a.property.name),h.value=!1}function ne(){a.property.type!=S.tag&&a.property.type!=S.multi_tags||(h.value?h.value=!1:h.value=!0,p.value=!1)}function D(){u.value?e.collection.sortManager.delSort(a.property.id):e.collection.sortManager.setSort(a.property.id),e.collection.sortManager.update(!0)}function M(){i.value?e.collection.groupManager.delGroupOption(a.property.id):e.collection.groupManager.setGroupOption(a.property.id),e.collection.groupManager.update(!0)}function T(){confirm("Supprimer la propriété: "+a.property.name+" ?")&&r.deleteProperty(a.property.id)}async function F(){f.value!=""&&(await r.updateProperty(a.property.id,f.value),K())}return A(()=>a.property,()=>{p.value=!1}),(P,O)=>(s(),o("div",{class:U(b.value?"hover-light":"")},[t("div",xt,[p.value?y("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[$(be,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:O[0]||(O[0]=C=>b.value=!0),onMouseleave:O[1]||(O[1]=C=>b.value=!1)},null,8,["type"]),t("span",null,g(a.property.name),1)])),p.value?(s(),o("div",It,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:O[2]||(O[2]=C=>b.value=!0),onMouseleave:O[3]||(O[3]=C=>b.value=!1)},null,32)]),t("div",St,[a.property.id>=0?pe((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":O[4]||(O[4]=C=>f.value=C),onChange:F},null,544)),[[me,f.value]]):(s(),o("span",Ct,[$(be,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,g(a.property.name),1)]))])])):y("",!0),t("div",Mt,[a.property.mode==n($e).id?(s(),V(z,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[Ft]),_:1})):y("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:G,class:"btn-icon text-center"},[w.value&&a.property.mode==n($e).id?(s(),V(z,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:O[5]||(O[5]=ze(()=>{},["stop"]))})]),_:1})):(s(),V(z,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:U("bi bi-eye text-"+(c.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",Vt,[a.property.type==n(S).tag||a.property.type==n(S).multi_tags?(s(),o("div",{key:0,onClick:ne,style:{cursor:"pointer"}},[h.value?(s(),V(z,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Et]),_:1})):(s(),V(z,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Tt]),_:1}))])):y("",!0)])]),t("div",null,[p.value?(s(),o("div",zt,[t("div",{class:U(["options hover-light",l.value?" text-primary":""])},[$(_e,{manager:v(),"filter-id":_.value,mode:2,"property-id":d.property.id},{default:k(()=>[Pt,X(g(P.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:U(["options hover-light",u.value?" text-primary":""]),onClick:D},[Ot,X(g(P.$t("main.menu.sort.title")),1)],2),t("div",{class:U(["options hover-light",i.value?" text-primary":""]),onClick:M},[Lt,X(g(P.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:T},[Dt,X(g(P.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):h.value?(s(),o("div",Gt,[$(qe,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])],2))}});const Me=N(Nt,[["__scopeId","data-v-81b7150f"]]),Rt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),jt={class:"p-2"},Ut=["onClick"],Ht=t("i",{class:"bi bi-arrow-clockwise"},null,-1),At=L({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=R(),e=d;function a(){r.reImportFolder(e.folder.id)}return(p,h)=>(s(),V(ee,{teleport:!0},{button:k(()=>[Rt]),popup:k(({hide:f})=>[t("div",jt,[t("div",{class:"base-hover p-1",onClick:b=>{a(),f()}},[Ht,X(" Re import")],8,Ut)])]),_:1}))}}),Bt=["onMouseenter"],qt=["onClick"],Kt={class:"text-secondary"},Qt=["onClick"],Wt=L({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:ue,root:{type:Boolean,default:!0}},setup(d){const r=R(),e=d,a=I(null),p=x(()=>{let l={};const i=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{i.has(u)&&(l[u]=!0)}),l}),h=x(()=>{let l={};return e.folders.map(i=>i.id).forEach(i=>{e.visibleFolders[i]&&(l[i]=!0)}),l}),f=x(()=>{let l={};return e.folders.forEach(i=>{let u=[];p.value[i.id]&&u.push("selected"),l[i.id]=u.join(" ")}),l});function b(l){let i=e.visibleFolders;i[l]?delete i[l]:i[l]=!0}function m(l){let i=new Set(e.filterManager.state.folders);const u=i.has(l),_=r.data.folders[l].parent!=null&&i.has(r.data.folders[l].parent);u&&!_?(i.delete(l),ge(l).forEach(v=>i.delete(v.id))):(c(l,i),i.add(l),ge(l).forEach(v=>i.add(v.id)),Ie(r.data.folders[l]).forEach(v=>i.delete(v.id))),e.filterManager.setFolders(Array.from(i)),e.filterManager.update(!0)}function c(l,i){const u=Ie(r.data.folders[l]);let _;for(let v of u)if(i.has(v.id))_=v;else break;_!=null&&ge(_.id).forEach(v=>i.delete(v.id))}return(l,i)=>{const u=Pe("FolderList2",!0);return s(),o("ul",{class:U(e.root?"tree":""),style:B(e.root?"padding-left:0px;":"")},[(s(!0),o(E,null,j(d.folders,_=>(s(),o("li",{style:B(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:v=>a.value=_.id,onMouseleave:i[0]||(i[0]=v=>a.value=null)},[t("summary",{class:U(f.value[_.id]),onClick:v=>m(_.id)},[X(g(_.name)+" ",1),t("span",Kt,g(_.count),1)],10,qt),_.children&&_.children.length>0?(s(),o("i",{key:0,onClick:v=>b(_.id),class:U("bi bi-chevron-"+(h.value[_.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Qt)):y("",!0),t("span",{class:U(a.value===_.id?"visible-option":"invisible-option")},[$(At,{folder:_,style:{display:"inline-block"}},null,8,["folder"])],2),_.children&&_.children.length>0&&h.value[_.id]?(s(),V(u,{key:1,folders:_.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):y("",!0)],44,Bt))),256))],6)}}});const Yt=N(Wt,[["__scopeId","data-v-9f26453b"]]),Xt={class:"text-center"},Zt={class:"w-100 text-center",style:{"font-size":"10px"}},Jt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},es=L({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=x(()=>r.task.total-r.task.remain-r.task.computing),a=x(()=>r.task.total);return(p,h)=>(s(),o("div",Xt,[X(g(r.task.name)+" ",1),t("div",Zt,g(e.value)+" / "+g(a.value)+" "+g(p.$t("main.nav.tasks.done")),1),a.value>0?(s(),o("div",Jt,[t("div",{class:"progress-bar",style:B(`width: ${e.value/a.value*100}%`)},null,4)])):y("",!0)]))}}),q=d=>(Q("data-v-d95a976a"),d=d(),W(),d),ts={class:"menu overflow-scroll"},ss={class:""},os={class:"m-0",style:{padding:"4px 0px 4px 8px"}},as={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ns=q(()=>t("i",{class:"bi bi-gear"},null,-1)),is=[ns],ls=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),rs=[ls],ds=q(()=>t("div",{class:"custom-hr"},null,-1)),ps={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},us={class:"d-flex align-items-center"},cs=q(()=>t("i",{class:"bi bi-plus"},null,-1)),_s={class:"overflow-scroll"},ms={key:0,id:"import"},vs=q(()=>t("div",{class:"custom-hr"},null,-1)),ys={class:"pt-1 pb-2"},hs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},gs=q(()=>t("div",{class:"custom-hr"},null,-1)),fs={key:0,class:"ps-2 pe-2"},bs={class:"p-1"},$s={key:0,class:"custom-hr"},ks={key:1,class:"p-2"},ws=q(()=>t("div",{class:"custom-hr"},null,-1)),xs={key:0,class:"float-end"},Is={class:"text-center"},Ss={class:"w-100 text-center",style:{"font-size":"10px"}},Cs={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ms={key:2,class:"p-2"},Fs={class:"w-100 text-center",style:{"font-size":"10px"}},Vs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Es=q(()=>t("div",{class:"custom-hr"},null,-1)),Ts={class:"p-2 mt-0"},zs={class:"d-flex"},Ps=q(()=>t("span",{class:"flex-grow-1"},null,-1)),Os={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Ls=q(()=>t("span",{class:"sr-only"},null,-1)),Ds=[Ls],Gs={key:1,class:"bb me-1"},Ns={class:"bb me-2"},Rs={key:0,class:"mt-2"},js={key:0,class:"property-item"},Us=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Hs=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),As=q(()=>t("div",{class:"custom-hr"},null,-1)),Bs={class:"p-2 mt-0"},qs={key:0,class:"mt-2"},Ks={key:0,class:"property-item"},Qs=L({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=R(),a=we(),p=e.getTabManager(),h=I(!1);I(null);const f=I(!1),b=async i=>{a.showModal(oe.IMPORT)},m=x(()=>e.backendStatus.tasks.filter(i=>!(i.name=="Load Plugin"&&i.done)));function c(){a.showModal(oe.FOLDERSELECTION,{callback:l,mode:"images"})}function l(i){i&&e.addFolder(i)}return A(()=>e.status.import.to_import,()=>h.value=!0),(i,u)=>{var _;return s(),o("div",ts,[t("div",ss,[t("div",null,[t("div",os,[t("div",as,[t("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},g((_=n(a).data.status.selectedProject)==null?void 0:_.name),1),t("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=v=>n(a).showModal(n(oe).SETTINGS))},is),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=v=>n(a).closeProject())},rs)])]),ds,t("div",ps,[t("div",us,[t("div",null,[t("b",null,g(i.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:u[3]||(u[3]=v=>{c(),n(ke)()})},[$(z,{message:"main.nav.folders.add"},{default:k(()=>[cs]),_:1})])]),t("div",_s,[n(e).getTab()?(s(),V(Yt,{key:0,folders:n(e).folderRoots,"filter-manager":n(p).collection.filterManager,"visible-folders":n(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):y("",!0)])]),m.value&&m.value.length?(s(),o("div",ms,[vs,t("div",ys,[t("div",hs,[t("div",null,[t("b",null,g(i.$t("main.nav.tasks.title")),1)])]),gs,n(e).backendStatus?(s(),o("div",fs,[(s(!0),o(E,null,j(m.value,(v,w)=>(s(),o("div",bs,[w?(s(),o("div",$s)):y("",!0),$(es,{task:v},null,8,["task"])]))),256))])):y("",!0)])])):y("",!0),n(e).status.import.to_import!=null&&n(e).status.import.to_import>0&&h.value?(s(),o("div",ks,[ws,n(e).status.import.done?(s(),o("div",xs,[t("i",{class:"bi bi-x base-hover",onClick:u[4]||(u[4]=v=>h.value=!1)})])):y("",!0),t("div",Is,[t("b",null,g(i.$t("main.menu.import_status_title")),1)]),t("div",Ss,g(n(e).status.import.imported)+" / "+g(n(e).status.import.to_import)+" importées ",1),n(e).status.import.to_import>0?(s(),o("div",Cs,[t("div",{class:"progress-bar",style:B(`width: ${n(e).status.import.imported/n(e).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),n(e).status.import.to_import!=null&&n(e).status.import.to_import>0&&h.value?(s(),o("div",Ms,[t("div",Fs,g(n(e).status.import.computed)+" / "+g(n(e).status.import.to_import)+" computed ",1),n(e).status.import.to_import>0?(s(),o("div",Vs,[t("div",{class:"progress-bar",style:B(`width: ${n(e).status.import.computed/n(e).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),Es,t("div",Ts,[t("div",zs,[$(z,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,g(i.$t("main.nav.properties.title")),1)]),_:1}),Ps,f.value?(s(),o("span",Os,Ds)):(s(),o("span",Gs,[$(z,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:b})]),_:1})])),t("span",Ns,[$(z,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u[5]||(u[5]=v=>n(a).showModal(n(oe).EXPORT,void 0))})]),_:1})])]),n(e).status.loaded?(s(),o("div",Rs,[(s(!0),o(E,null,j(n(e).data.properties,v=>(s(),o(E,null,[v.id>=0?(s(),o("div",js,[$(Me,{property:v},null,8,["property"])])):y("",!0)],64))),256)),Us,t("div",{id:"add-property",onClick:u[6]||(u[6]=v=>{n(a).showModal(n(oe).PROPERTY,void 0),n(ke)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Hs,t("span",null,g(i.$t("main.nav.properties.add_property")),1)])])):y("",!0)]),As,t("div",Bs,[$(z,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,g(i.$t("main.nav.computed.title")),1)]),_:1}),n(e).status.loaded?(s(),o("div",qs,[(s(!0),o(E,null,j(n(e).data.properties,v=>(s(),o(E,null,[v.id<0?(s(),o("div",Ks,[$(z,{pos:"bottom",message:"main.nav.computed."+Math.abs(v.id).toString()+"_tooltip"},{default:k(()=>[$(Me,{property:v},null,8,["property"])]),_:2},1032,["message"])])):y("",!0)],64))),256))])):y("",!0)])])])])}}});const Ws=N(Qs,[["__scopeId","data-v-d95a976a"]]),Ys={class:"text-nowrap text-secondary"},Fe=L({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=R(),e=d,a=x(()=>r.data.properties[e.propertyId].tags);return(p,h)=>(s(),o("div",Ys,[e.value&&e.value.length>0?(s(!0),o(E,{key:0},j(e.value,f=>(s(),o("span",null,[$(Ke,{tag:a.value[f].value,color:a.value[f].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(E,{key:1},[X(" Add Tags... ")],64))]))}}),Xs={key:0},Zs={key:1},Js={key:2},eo={key:3},to={key:0,class:"bi bi-square"},so={key:1,class:"bi bi-check-square"},oo={key:5},ao={key:6},no={key:7},io={key:8},lo={key:9},ro={key:10},po={key:11},uo={key:12},co={key:13},_o={key:1,class:"text-secondary"},mo=L({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=x(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":Qe[p].color}),a=x(()=>[S._ahash,S._folders,S._sha1,S.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,h)=>d.value!=null?(s(),o(E,{key:0},[r.property.type==n(S)._ahash?(s(),o("div",Xs,g(a.value),1)):y("",!0),r.property.type==n(S)._folders?(s(),o("div",Zs,g(a.value),1)):y("",!0),r.property.type==n(S)._sha1?(s(),o("div",Js,g(a.value),1)):y("",!0),r.property.type==n(S).checkbox?(s(),o("div",eo,[a.value?(s(),o("i",to)):(s(),o("i",so))])):y("",!0),r.property.type==n(S).color?(s(),o("div",{key:4,style:B({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):y("",!0),r.property.type==n(S).date?(s(),o("div",oo,g(a.value),1)):y("",!0),r.property.type==n(S).image_link?(s(),o("div",ao)):y("",!0),r.property.type==n(S).multi_tags?(s(),o("div",no,[$(Fe,{"property-id":r.property.id,value:a.value},null,8,["property-id","value"])])):y("",!0),r.property.type==n(S).number?(s(),o("div",io,g(a.value),1)):y("",!0),r.property.type==n(S).path?(s(),o("div",lo,g(a.value),1)):y("",!0),r.property.type==n(S).string?(s(),o("div",ro,g(a.value),1)):y("",!0),r.property.type==n(S)._id||r.property.type==n(S)._height||r.property.type==n(S)._width?(s(),o("div",po,g(a.value),1)):y("",!0),r.property.type==n(S).tag?(s(),o("div",uo,[$(Fe,{"property-id":r.property.id,value:a.value},null,8,["property-id","value"])])):y("",!0),r.property.type==n(S).url?(s(),o("div",co,g(a.value),1)):y("",!0)],64)):(s(),o("span",_o,"..."))}}),vo={class:"d-flex bb ps-1 overflow-hidden"},yo={class:"m-0 p-0 me-2 text-nowrap"},ho={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},go=L({__name:"FilterPreview",props:{filter:Object},setup(d){const r=R(),e=d,a=x(()=>r.data.properties[e.filter.propertyId]);return(p,h)=>(s(),o("td",vo,[t("div",yo,g(p.$t("modals.filters.operators."+e.filter.operator)),1),n(Te)(e.filter.operator)?(s(),o("div",ho,[$(mo,{property:a.value,value:e.filter.value},null,8,["property","value"])])):y("",!0)]))}});const fo=N(go,[["__scopeId","data-v-79b26ee7"]]),ve=d=>(Q("data-v-b9005f3e"),d=d(),W(),d),bo={class:"filter-group"},$o={class:"table table-sm"},ko={class:"align-top p-0 m-0"},wo={key:0,class:"m-0 p-0"},xo={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Io={class:""},So=["onClick"],Co=ve(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Mo={key:2,class:"text-secondary"},Fo={key:0,class:"p-0 m-0 ps-2"},Vo={key:1,class:"p-0 m-0 ps-2"},Eo={class:"border rounded"},To={class:""},zo=["onClick"],Po=ve(()=>t("i",{class:"bi bi-trash"},null,-1)),Oo=[Po],Lo={class:"d-flex text-secondary ms-2"},Do={class:"add-options hover-light"},Go=ve(()=>t("i",{class:"bi bi-plus"},null,-1)),No=ve(()=>t("i",{class:"bi bi-plus"},null,-1)),Ro=L({__name:"FilterGroupInput",props:{filter:Object,manager:ue,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=R(),a=d,p=x(()=>a.filter),h=x(()=>p.value.filters),f=x(()=>{let i=255-(p.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function b(i,u){a.manager.updateFilter(i,{propertyId:u}),a.manager.update(!0)}function m(i){a.manager.deleteFilter(i.id),a.manager.update(!0)}function c(i){a.manager.addNewFilterGroup(i),a.manager.update(!0)}function l(i,u){a.manager.updateFilterGroup(i,u),a.manager.update(!0)}return(i,u)=>{const _=Pe("FilterGroupInput",!0);return s(),o("div",bo,[t("table",$o,[(s(!0),o(E,null,j(h.value,(v,w)=>(s(),o("tr",null,[t("td",ko,[w==0?(s(),o("div",wo,g(i.$t("modals.filters.where")),1)):w==1?(s(),V(ee,{key:1},{button:k(()=>[t("div",xo,[t("span",Io,g(i.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:G})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:G},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=K=>l(p.value.id,n(Se).and))},g(i.$t("modals.filters.and")),1),Co,t("div",{class:"base-btn",onClick:u[1]||(u[1]=K=>l(p.value.id,n(Se).or))},g(i.$t("modals.filters.or")),1)],8,So)]),_:1})):(s(),o("span",Mo,g(p.value.groupOperator),1))]),v.propertyId!==void 0?(s(),o("td",Fo,[$(We,{"model-value":n(e).data.properties[v.propertyId],"onUpdate:modelValue":G=>b(v.id,G.id)},null,8,["model-value","onUpdate:modelValue"])])):y("",!0),v.propertyId!==void 0?(s(),o("td",Vo,[$(_e,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":v.id,parent:a.parent},{default:k(()=>[$(fo,{filter:v},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:B(f.value)},[t("div",Eo,[$(_,{filter:v,manager:a.manager},null,8,["filter","manager"])])],4)),t("td",To,[t("span",{class:"base-btn",onClick:G=>m(v)},Oo,8,zo)])]))),256))]),t("div",Lo,[$(_e,{manager:a.manager,"parent-id":p.value.id},{default:k(()=>[t("div",Do,[Go,X(g(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=v=>c(p.value.id))},[No,X(g(i.$t("modals.filters.new_group")),1)])])])}}});const jo=N(Ro,[["__scopeId","data-v-b9005f3e"]]),Uo=d=>(Q("data-v-c6a37a82"),d=d(),W(),d),Ho={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ao={key:0},Bo=Uo(()=>t("span",{class:"text-primary"},"Text Query",-1)),qo={key:0,class:"or-separator"},Ko={key:0,class:"or-separator"},Qo={key:0,class:"m-1 p-0"},Wo=L({__name:"GlobalFilterInputDropdown",props:{manager:ue},emits:["update:modelValue"],setup(d,{emit:r}){const e=R(),a=d,p=I(null),h=I(null),f=x(()=>{let m=b(a.manager.state.filter),c={};return m.forEach(l=>c[l.propertyId]=l),Object.values(c)});function b(m){let c=[];for(let l of m.filters)l.isGroup?c.push(...b(l)):c.push(l);return c}return A(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&h.value.hide()}),(m,c)=>(s(),V(ee,{ref_key:"dropdownElem",ref:h},{button:k(()=>[t("div",null,[f.value.length||a.manager.state.query?(s(),o("div",Ho,[a.manager.state.query?(s(),o("div",Ao,[Bo,f.value.length?(s(),o("span",qo,"|")):y("",!0)])):y("",!0),(s(!0),o(E,null,j(f.value,(l,i)=>(s(),o("div",null,[i>0?(s(),o("span",Ko,"|")):y("",!0),l.propertyId==n(Ee).id?(s(),V(be,{key:1,type:n(e).data.properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),t("span",null,g(n(e).data.properties[l.propertyId].name),1)]))),256))])):y("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(n(e).data.properties).length>0?(s(),o("div",Qo,[$(jo,{filter:a.manager.state.filter,manager:a.manager,parent:p.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}});const Yo=N(Wo,[["__scopeId","data-v-c6a37a82"]]),Xo=d=>(Q("data-v-1d7e82c5"),d=d(),W(),d),Zo={class:"d-flex flex-row filter-form"},Jo={class:"pt-1 pb-1"},ea=Xo(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),ta=L({__name:"FilterForm",props:{manager:ue},setup(d){const r=d;return(e,a)=>(s(),o("div",Zo,[t("div",Jo,g(e.$t("main.menu.filters"))+": ",1),$(Yo,{manager:r.manager},null,8,["manager"]),$(_e,{manager:r.manager,class:"p-1"},{default:k(()=>[ea]),_:1},8,["manager"])]))}});const sa=N(ta,[["__scopeId","data-v-1d7e82c5"]]),oa=d=>(Q("data-v-59c1ca07"),d=d(),W(),d),aa=oa(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),na={class:"p-1"},ia=L({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,a=r,p=I(null);return(h,f)=>(s(),V(ee,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[aa]),popup:k(()=>[t("div",na,[$(Ve,{onClick:f[0]||(f[0]=b=>n(ke)()),onSelect:f[1]||(f[1]=b=>{a("select",b),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Le=N(ia,[["__scopeId","data-v-59c1ca07"]]),la={class:"base-hover ps-1 pe-1"},ra={class:"main"},da=["onClick"],pa=L({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,a=r,p=Object.values(Oe);function h(f){a("update:modelValue",f)}return(f,b)=>(s(),V(ee,null,{button:k(()=>[t("div",la,g(e.modelValue),1)]),popup:k(({hide:m})=>[t("div",ra,[(s(!0),o(E,null,j(n(p),c=>(s(),o("div",{class:"base-hover option",onClick:l=>{h(c),m()}},g(c),9,da))),256))])]),_:1}))}});const ua=N(pa,[["__scopeId","data-v-cc9d0d61"]]),ca=d=>(Q("data-v-a27bea28"),d=d(),W(),d),_a=ca(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ma={class:""},va={class:"d-flex ipt"},ya={class:"ms-2",min:"1"},ha=L({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,a=r,p=I(1),h=I(Oe.Year);function f(){e.option.stepSize==p.value&&e.option.stepUnit==h.value||a("change",{stepSize:p.value,stepUnit:h.value})}function b(){p.value=e.option.stepSize??1,h.value=e.option.stepUnit}return A(()=>e.option,b),re(b),A(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(m,c)=>(s(),V(ee,{onHide:f},{button:k(()=>[_a]),popup:k(({hide:l,focus:i})=>[t("div",ma,[t("div",va,[t("div",null,[pe(t("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=u=>p.value=u)},null,512),[[me,p.value]])]),t("div",ya,[$(ua,{modelValue:h.value,"onUpdate:modelValue":c[1]||(c[1]=u=>h.value=u),onHide:i},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ga=N(ha,[["__scopeId","data-v-a27bea28"]]),fa={class:"d-flex flex-row group-form"},ba={class:"pt-1 pb-1"},$a={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},ka={key:0,class:"bi bi-chevron-right smaller"},wa=["onClick"],xa=["onClick"],Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Fa=["onClick"],Va=["onClick"],Ea=["onClick"],Ta={key:5,class:"sm-btn"},za={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Pa=L({__name:"GroupForm",props:{isLoading:Boolean,manager:Ye},setup(d){const r=R(),e=d;function a(l){e.manager.setGroupOption(l),e.manager.update(!0)}function p(l){e.manager.delGroupOption(l),e.manager.update(!0)}function h(l,i){e.manager.setGroupOption(l,{direction:i}),e.manager.sortGroups(!0)}function f(l,i){e.manager.setGroupOption(l,{type:i}),e.manager.sortGroups(!0)}function b(l,i){e.manager.setGroupOption(l,i),e.manager.update(!0)}const m=x(()=>e.manager.state.groupBy.map(l=>r.data.properties[l])),c=x(()=>{const l=[];return e.manager.state.groupBy.forEach(i=>{l.push({option:e.manager.state.options[i],property:r.data.properties[i]})}),l});return(l,i)=>(s(),o("div",fa,[t("div",ba,g(l.$t("main.menu.groupby"))+": ",1),m.value.length?(s(),o("div",$a,[(s(!0),o(E,null,j(c.value,(u,_)=>(s(),o(E,null,[_>0?(s(),o("i",ka)):y("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:v=>p(u.property.id),id:"remove-group-button"},g(u.property.name),9,wa),u.option.type==n(se).Size?(s(),V(z,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==n(J).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:v=>f(u.property.id,n(se).Property)},null,8,xa)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:v=>f(u.property.id,n(se).Property)},null,8,Ia))]),_:2},1024)):(s(),V(z,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==n(S).number?(s(),o(E,{key:0},[u.option.direction==n(J).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:v=>f(u.property.id,n(se).Size)},null,8,Sa)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:v=>f(u.property.id,n(se).Size)},null,8,Ca))],64)):(s(),o(E,{key:1},[u.option.direction==n(J).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:v=>f(u.property.id,n(se).Size)},null,8,Ma)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:v=>f(u.property.id,n(se).Size)},null,8,Fa))],64))]),_:2},1024)),u.option.direction==n(J).Ascending?(s(),V(z,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:v=>h(u.property.id,n(J).Descending)},null,8,Va)]),_:2},1024)):(s(),V(z,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:v=>h(u.property.id,n(J).Ascending)},null,8,Ea)]),_:2},1024)),u.property.type==n(S).date?(s(),o("div",Ta,[$(ga,{option:u.option,onChange:v=>b(u.property.id,v)},null,8,["option","onChange"])])):y("",!0)],64))),256)),e.isLoading?(s(),o("i",za)):y("",!0)])):y("",!0),$(Le,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:i[0]||(i[0]=u=>a(u))},null,8,["group-ids"])]))}});const Oa=N(Pa,[["__scopeId","data-v-47631987"]]),La={class:"d-flex flex-row sort-form"},Da={class:"pt-1 pb-1"},Ga={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Na={key:0,class:"bi bi-chevron-right smaller"},Ra=["onClick"],ja=["onClick"],Ua=["onClick"],Ha=L({__name:"SortForm",props:{manager:Xe},setup(d){const r=R(),e=d,a=x(()=>e.manager.state.sortBy.map(m=>({propertyId:m,direction:e.manager.state.options[m].direction}))),p=x(()=>a.value.map(m=>m.propertyId));function h(m){e.manager.setSort(m),e.manager.update(!0)}function f(m){e.manager.delSort(m),e.manager.update(!0)}function b(m,c){e.manager.setSort(m,{direction:c}),e.manager.update(!0)}return(m,c)=>(s(),o("div",La,[t("div",Da,g(m.$t("main.menu.sort.title"))+": ",1),a.value.length?(s(),o("div",Ga,[(s(!0),o(E,null,j(a.value,(l,i)=>(s(),o(E,null,[i>0?(s(),o("i",Na)):y("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>f(l.propertyId)},g(n(r).data.properties[l.propertyId].name),9,Ra),l.direction==n(J).Ascending?(s(),V(z,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>b(l.propertyId,n(J).Descending)},null,8,ja)]),_:2},1024)):(s(),V(z,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>b(l.propertyId,n(J).Ascending)},null,8,Ua)]),_:2},1024))],64))),256))])):y("",!0),$(Le,{"group-ids":p.value,onSelect:c[0]||(c[0]=l=>h(l))},null,8,["group-ids"])]))}});const Aa=N(Ha,[["__scopeId","data-v-bc2e0a7f"]]),ye=d=>(Q("data-v-b6d30616"),d=d(),W(),d),Ba=ye(()=>t("i",{class:"bi bi-clock-history me-1"},null,-1)),qa={class:"p-2"},Ka={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Qa={class:"border mb-1 p-1"},Wa={class:"me"},Ya=ye(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),Xa={key:0},Za={key:1},Ja={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},en={class:"d-flex center justify-content-center"},tn={key:1,class:"bi bi-arrow-down text-secondary"},sn=ye(()=>t("div",{style:{width:"30px"}},null,-1)),on={key:3,class:"bi bi-arrow-up text-secondary"},an={class:"border mb-1 p-1"},nn={class:"me"},ln=ye(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),rn={key:0},dn={key:1},pn={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ie=5,un=L({__name:"HistoryDropdown",emits:[],setup(d,{emit:r}){const e=R(),a=I(!1),p=x(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),h=x(()=>[...e.data.history.undo].reverse().slice(0,ie)),f=x(()=>e.data.history.redo.slice(Math.max(e.data.history.redo.length-ie,0)));return A(()=>e.status.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(b,m)=>(s(),V(ee,null,{button:k(()=>[t("div",{class:"d-flex sb flash",style:B([{"font-size":"14px"},p.value])},[Ba,t("div",null,g(b.$t("dropdown.history.button")),1)],4)]),popup:k(()=>[t("div",qa,[n(e).data.history.redo.length>ie?(s(),o("div",Ka," + "+g(n(e).data.history.redo.length-ie),1)):y("",!0),(s(!0),o(E,null,j(f.value,c=>(s(),o("div",Qa,[t("span",Wa,g(new Date(c.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),Ya,c.tags?(s(),o("span",Xa,g(c.tags)+" "+g(b.$t("dropdown.history.tags")),1)):y("",!0),c.values?(s(),o("span",Za,g(c.values)+" "+g(b.$t("dropdown.history.values")),1)):y("",!0)]))),256)),t("div",Ja,[t("div",en,[h.value.length?(s(),o("div",{key:0,class:"bi bi-arrow-down sb",onClick:m[0]||(m[0]=(...c)=>n(e).undo&&n(e).undo(...c))})):(s(),o("div",tn)),sn,f.value.length?(s(),o("div",{key:2,class:"bi bi-arrow-up sb",onClick:m[1]||(m[1]=(...c)=>n(e).redo&&n(e).redo(...c))})):(s(),o("div",on))])]),(s(!0),o(E,null,j(h.value,c=>(s(),o("div",an,[t("span",nn,g(new Date(c.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),ln,c.tags?(s(),o("span",rn,g(c.tags)+" "+g(b.$t("dropdown.history.tags")),1)):y("",!0),c.values?(s(),o("span",dn,g(c.values)+" "+g(b.$t("dropdown.history.values")),1)):y("",!0)]))),256)),n(e).data.history.undo.length>ie?(s(),o("div",pn," + "+g(n(e).data.history.undo.length-ie),1)):y("",!0)])]),_:1}))}});const cn=N(un,[["__scopeId","data-v-b6d30616"]]),xe=d=>(Q("data-v-15e0935f"),d=d(),W(),d),_n={class:"d-flex flex-row p-2"},mn=xe(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),vn=["placeholder"],yn={class:"me-5 d-flex"},hn=xe(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),gn={class:"ms-5",style:{"font-size":"13px"}},fn=["checked"],bn=xe(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),$n={class:"ms-4"},kn={class:"d-flex flex-wrap content-container ps-2"},wn=L({__name:"ContentFilter",props:{tab:Ze,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){R();const e=d,a=I(""),p=x(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),h=x(()=>p.value.length);function f(l){const i=l.target.checked;e.tab.collection.groupManager.setSha1Mode(i,!0)}function b(){a.value=e.tab.state.filterState.query}function m(){e.tab.collection.filterManager.setQuery(a.value),e.tab.collection.filterManager.update(!0)}function c(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return re(b),A(()=>e.tab.collection.filterManager.state.query,b),(l,i)=>(s(),o(E,null,[t("div",_n,[$(z,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:U(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[mn,pe(t("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":i[0]||(i[0]=u=>a.value=u),onChange:m},null,40,vn),[[me,a.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:c},"x")],2)]),_:1}),t("div",yn,[$(z,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:U("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:i[1]||(i[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),$(z,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:U("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:i[2]||(i[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),$(z,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[hn]),_:1}),t("div",null,[$(Je,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":i[3]||(i[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",gn,[$(z,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:f},null,40,fn),bn]),_:1})]),t("div",$n,[$(cn)]),h.value?(s(),V(et,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":i[4]||(i[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0)]),t("div",kn,[$(sa,{manager:e.tab.collection.filterManager},null,8,["manager"]),$(Oa,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),$(Aa,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const xn=N(wn,[["__scopeId","data-v-15e0935f"]]),In={class:""},Sn=["src"],Cn={class:"d-flex flex-row"},Mn=L({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=we();R();const a=d,p=r,h=x(()=>`width: ${a.size}px; height: ${a.size}px;`),f=x(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`),b=x(()=>a.pile.images[0]);return(m,c)=>(s(),o("div",In,[$(tt,{image:b.value},{default:k(()=>[t("div",{style:B(h.value),class:"img-container",onClick:c[0]||(c[0]=l=>n(e).showModal(n(oe).IMAGE,{image:b.value}))},[t("img",{src:b.value.url,style:B(f.value)},null,12,Sn)],4)]),_:1},8,["image"]),t("div",Cn,[$(z,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:c[1]||(c[1]=l=>p("accept",b.value))}," ✓ ",4)]),_:1}),$(z,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:c[2]||(c[2]=l=>p("refuse",b.value))}," ✕ ",4)]),_:1})])]))}});const Fn=N(Mn,[["__scopeId","data-v-1ea540e7"]]),ce=d=>(Q("data-v-b6c082bd"),d=d(),W(),d),Vn={class:"reco-container"},En={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Tn=ce(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),zn=[Tn],Pn=ce(()=>t("div",{class:"b-left pe-1"},null,-1)),On=ce(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Ln=[On],Dn=ce(()=>t("div",{class:"b-left pe-1"},null,-1)),Gn={key:0,class:"bi bi-funnel-fill bb text-primary"},Nn={key:1,class:"bi bi-funnel bb"},Rn=ce(()=>t("div",{class:"b-left pe-1"},null,-1)),jn={class:"text-secondary me-2"},Un={class:"flex-grow-1"},Hn={class:"d-flex flex-row"},An={key:0,class:"separator"},Bn={class:"d-flex flex-row"},fe=10,qn=L({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=R(),a=st(),p=d,h=r,f=I(1),b=le([]),m=le([]),c=le([]),l=le(new Set),i=I(!0);function u(D){let M=m.indexOf(D);M<0||(m.splice(M,1),w())}async function _(D){const M=[],T=[];c.forEach(F=>{var P;if(F.value!=at){const O=e.data.properties[F.propertyId];let C=F.value;O.type==S.multi_tags?(C=((P=D.properties[F.propertyId])==null?void 0:P.value)??[],C=[...C,F.value]):O.type==S.tag&&(C=[C]),O.mode==$e.id?T.push({instanceId:D.id,propertyId:O.id,value:C}):M.push({propertyId:O.id,sha1:D.sha1,value:C})}}),await e.setPropertyValues(T,M),u(D.sha1)}function v(D){l.add(D.sha1),u(D.sha1)}function w(){b.length=0;const D=m.map(M=>({sha1:M,images:e.data.sha1Index[M]}));G(D,b,f.value,p.imageSize,p.width)}function G(D,M,T,F,P){let O=P,C=[],Y=0;for(let Z=0;Z<D.length&&!(M.length>=T);Z++){let de=D[Z];if(l.has(de.sha1))continue;let he=F+fe;if(Y+he<O){C.push(de),Y+=he;continue}if(C.length==0)throw new Error("Images seems to be to big for the line");M.push(C),M.length<T&&(C=[de],Y=he)}C.length>0&&M.length<T&&M.push(C)}async function K(){if(!p.group)return;console.log("get reco");const D=p.group.images.map(C=>C.id);let M=await a.getSimilarImages({instanceIds:D});if(console.log(M),!M.instances)throw new Error("No instances in ActionResult");let T=[];const F=M.instances.scores??[];if(M.instances.ids)for(let C in M.instances.ids){const Y={id:M.instances.ids[C],score:F[C]};T.push(Y)}else for(let C in M.instances.sha1s){const Y=M.instances.sha1s[C];for(let Z of e.data.sha1Index[Y]){const de={id:Z.id,score:F[C]};T.push(de)}}if(T.sort((C,Y)=>Y.score-C.score),i.value){const C=e.getTabManager(),Y=new Set(C.collection.groupManager.result.root.images.map(Z=>Z.id));T=T.filter(Z=>Y.has(Z.id))}const P=Array.from(new Set(T.map(C=>e.data.images[C.id].sha1)));c.length=0;let O=p.group;for(;O;)c.push(...O.meta.propertyValues),O=O.parent;m.length=0,m.push(...P),l.clear(),w(),h("update")}function ne(){i.value=!i.value}return re(K),A(()=>p.group,()=>{K(),l.clear()}),A(()=>p.imageSize,w),A(()=>p.width,w),A(i,K),(D,M)=>(s(),o("div",Vn,[t("div",En,[t("div",{class:"text-secondary pe-1",onClick:M[0]||(M[0]=T=>h("close"))},zn),Pn,t("div",{class:"text-secondary pe-1",onClick:M[1]||(M[1]=T=>h("scroll",p.group.id))},Ln),Dn,t("div",{class:"text-secondary pe-1",onClick:ne},[i.value?(s(),o("span",Gn)):(s(),o("span",Nn))]),Rn,$(z,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",jn,g(D.$t("main.recommand.title")),1)]),_:1}),t("div",Un,[t("div",Hn,[(s(!0),o(E,null,j(c,(T,F)=>(s(),o(E,null,[$(ot,{class:"",value:T},null,8,["value"]),F<c.length-1?(s(),o("div",An)):y("",!0)],64))),256))])])]),t("div",{style:B("margin-left:"+fe+"px;")},[(s(!0),o(E,null,j(b,T=>(s(),o("div",null,[t("div",Bn,[(s(!0),o(E,null,j(T,F=>(s(),V(Fn,{pile:F,size:p.imageSize,onAccept:_,onRefuse:v,style:B("margin-right:"+fe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Kn=N(qn,[["__scopeId","data-v-b6c082bd"]]),Qn={key:0,class:"m-0 p-0"},Wn={key:0,style:{"margin-left":"10px"}},Yn=L({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=R(),e=r.getTabManager(),a=d,p=I({}),h=I(null),f=I(null),b=I(null);I([]);const m=I(0),c=I(0),l=le({groups:!1}),i=x(()=>e.getVisibleProperties());function u(){h.value&&f.value?m.value=a.height-h.value.clientHeight-f.value.clientHeight-5:h.value?m.value=a.height-h.value.clientHeight-5:m.value=0}e.collection.groupManager.onChange.addListener(()=>{b.value&&e.state.display=="tree"&&b.value.computeLines()});function _(w){p.value=e.collection.groupManager.result.index[w],te(()=>u())}function v(){p.value={},te(()=>u())}return re(()=>{c.value=h.value.clientWidth,window.addEventListener("resize",()=>{te(()=>{var w;c.value=((w=h.value)==null?void 0:w.clientWidth)??c.value})})}),A(e.state,w=>{r.updateTabs()},{deep:!0}),A(()=>e.state.imageSize,()=>te(u)),A(()=>a.height,async()=>{await te(u)}),(w,G)=>(s(),o(E,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:h},[$(xn,{tab:n(e),"compute-status":l},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:f,class:"m-0 p-0"},[p.value.id?(s(),o("div",Qn,[$(Kn,{group:p.value,"image-size":n(e).state.imageSize,width:c.value,height:50,onClose:v,onScroll:b.value.scrollTo,onUpdate:G[0]||(G[0]=K=>te(()=>u()))},null,8,["group","image-size","width","onScroll"])])):y("",!0)],512),c.value>0&&m.value>0?(s(),o("div",Wn,[n(e).state.display=="tree"?(s(),V(nt,{key:0,"group-manager":n(e).collection.groupManager,"image-size":n(e).state.imageSize,height:m.value-0,properties:i.value,"hide-if-modal":!0,"selected-images":n(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,width:c.value-25,onRecommend:_},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),n(e).state.display=="grid"?(s(),o("div",{key:1,style:B({width:c.value-12+"px"}),class:"p-0 m-0 grid-container"},[$(it,{manager:n(e).collection.groupManager,height:m.value-15,width:c.value-40,"selected-properties":i.value,class:"p-0 m-0","show-images":!0,"selected-images":n(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):y("",!0)])):y("",!0)],64))}});const Xn=N(Yn,[["__scopeId","data-v-d071a1ff"]]),Zn={class:"d-flex d-row",style:{cursor:"pointer"}},Jn=["onMouseenter","onMouseleave"],ei=["onClick"],ti=["onClick"],si=["onClick"],oi=["onSubmit"],ai=["onKeydown","onUpdate:modelValue"],ni=t("span",{class:"bi bi-plus"},null,-1),ii=[ni],li={class:"lang"},ri=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),di=["value"],pi=L({__name:"TabNav",props:{reRender:Function},setup(d){const r=R(),e=I(-1),a=I(""),p=I(null),h=d;function f(_){r.data.selectedTabId==_||m(),r.selectTab(_)}function b(_){e.value=_,a.value=r.data.tabs[_].name,te(()=>p.value[0].focus())}function m(){e.value=-1,a.value=""}function c(_){r.addTab("New Tab")}async function l(_){confirm("Are you sure to delete Tab: "+_.name)&&await r.removeTab(_.id)}const i=le({});I(-1);const u=["fr","en"];return(_,v)=>(s(),o("nav",null,[t("div",Zn,[(s(!0),o(E,null,j(n(r).data.tabs,w=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:G=>i[w.id]=!0,onMouseleave:G=>i[w.id]=!1},[e.value!=w.id?(s(),o(E,{key:0},[$(z,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:G=>b(w.id),class:U(["bi bi-pencil me-1 tab-icon hover-light",i[w.id]&&n(r).data.selectedTabId==w.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,ei)]),_:2},1024),t("div",{class:U(["tab-button",w.id==n(r).data.selectedTabId?" active":""]),onClick:G=>f(w.id)},[t("span",null,g(w.name),1)],10,ti),$(z,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:G=>l(w),class:U(["btn-icon bi bi-x tab-icon hover-light",i[w.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,si)]),_:2},1024)],64)):(s(),o("div",{key:1,class:U(["tab-button",w.id==n(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:ze(m,["stop","prevent"])},[pe(t("input",{onFocusout:m,onKeydown:lt(m,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":G=>w.name=G,ref_for:!0,ref_key:"inputElem",ref:p},null,40,ai),[[me,w.name]])],40,oi)],2))],40,Jn))),256)),$(z,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:c,id:"add-tab-button"},ii)]),_:1}),t("div",li,[ri,pe(t("select",{"onUpdate:modelValue":v[0]||(v[0]=w=>_.$i18n.locale=w),onChange:v[1]||(v[1]=w=>h.reRender())},[(s(),o(E,null,j(u,(w,G)=>t("option",{key:`Lang${G}`,value:w},g(w.toUpperCase()),9,di)),64))],544),[[rt,_.$i18n.locale]])])])]))}});const De=d=>(Q("data-v-831fb799"),d=d(),W(),d),ui={class:"d-flex flex-row m-0 p-0 overflow-hidden"},ci={key:0},_i={key:1,class:"w-100"},mi={key:0,class:"custom-hr"},vi={key:2,class:"loading"},yi={class:"text-center"},hi={key:3,class:"loading"},gi=De(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),fi=De(()=>t("span",{class:"ms-1"},"Loading...",-1)),bi=[gi,fi],$i=L({__name:"PanopticView",setup(d){const r=R(),e=we(),a=I(null),p=I(null),h=I(window.innerHeight),f=I(!1),b=x(()=>{var _;return h.value-(((_=p.value)==null?void 0:_.clientHeight)??0)}),m=x(()=>{var _;return(_=a.value)==null?void 0:_.filteredImages.map(v=>v.id)});re(async()=>{e.isProjectLoaded||Ce.push("/"),te(()=>{window.addEventListener("resize",c),c()}),window.addEventListener("keydown",_=>{_.key=="Control"&&(H.ctrl=!0),_.key=="Alt"&&(H.alt=!0),_.key=="Shift"&&(H.shift=!0),_.key=="ArrowLeft"&&(H.left=!0),_.key=="ArrowRight"&&(H.right=!0,console.log("keeeyy")),_.key=="Z"&&H.ctrl&&r.redo(),_.key=="z"&&H.ctrl&&r.undo()}),window.addEventListener("keyup",_=>{_.key=="Control"&&(H.ctrl=!1),_.key=="Alt"&&(H.alt=!1),_.key=="Shift"&&(H.shift=!1),_.key=="ArrowLeft"&&(H.left=!1),_.key=="ArrowRight"&&(H.right=!1)}),window.addEventListener("mousemove",_=>{H.ctrl=_.ctrlKey,H.alt=_.altKey,H.shift=_.shiftKey})}),dt(()=>{window.removeEventListener("resize",c)});function c(){h.value=window.innerHeight,f.value=!0}function l(){e.showModal(oe.EXPORT,m)}function i(){r.rerender()}function u(){Ce.push("/")}return(_,v)=>(s(),o(E,null,[$(pt,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:n(r).status.renderNb},[t("div",ui,[n(r).status.loaded?(s(),o("div",ci,[$(Ws,{onExport:v[0]||(v[0]=w=>l())})])):y("",!0),n(r).status.loaded?(s(),o("div",_i,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[$(pi,{"re-render":i})],512),f.value?(s(),o("div",mi)):y("",!0),n(r).status.loaded?(s(),V(Xn,{key:1,"tab-id":n(r).data.selectedTabId,height:b.value,ref_key:"mainViewRef",ref:a},null,8,["tab-id","height"])):y("",!0)])):n(e).isProjectLoaded?(s(),o("div",hi,bi)):(s(),o("div",vi,[t("div",yi,[t("div",null,g(_.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const xi=N($i,[["__scopeId","data-v-831fb799"]]);export{xi as default};
