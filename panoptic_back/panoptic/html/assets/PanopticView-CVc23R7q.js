import{d as P,B as N,k as I,D as oe,l as _,b as e,i as ee,t as x,V as Ne,o as s,W as Ie,r as M,c as z,a as n,f as Y,n as j,F as O,s as K,h as f,X as ue,q as y,e as u,Y as Ee,Z as ke,$ as ze,_ as A,a0 as pe,m as J,a1 as q,a2 as Oe,j as Z,a3 as Pe,u as ce,a4 as me,a5 as ge,w as ye,v as be,a6 as Le,M as se,y as T,a7 as Se,Q as H,a8 as Ve,a9 as We,aa as de,ab as Ge,I as qe,g as Ce,ac as Te,ad as Qe,ae as Ke,L as Ye,af as Xe,ag as Ze,O as Je,R as et,S as tt,ah as st,ai as ot,aj as De,ak as Re,al as at,am as ne,an as te,ao as nt,ap as lt,aq as it,ar as rt,as as dt,at as ut,au as ve,av as Me,aw as pt,ax as ct,ay as mt,az as gt,aA as vt,aB as ft,aC as yt,p as Fe,C as U}from"./index-BfsQ_WTL.js";import{_ as bt}from"./Tutorial-e77Ou4NG.js";const ht={class:"text-nowrap"},_t=["onClick"],kt=["onClick"],$t=P({__name:"FolderOptionDropdown",props:{folder:{}},setup(k){const d=N(),t=k;function a(){d.reImportFolder(t.folder.id)}function o(){confirm(Ne.global.t("main.nav.folders.del_alert"))&&d.deleteFolder(t.folder.id)}return(m,p)=>(s(),I(oe,{teleport:!0},{button:_(()=>p[0]||(p[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:_(({hide:v})=>[e("div",ht,[e("div",{class:"p-2 bb",onClick:g=>{a(),v()}},p[1]||(p[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ee("Re import")]),8,_t),p[3]||(p[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:g=>{o(),v()}},[p[2]||(p[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),ee(x(m.$t("main.nav.folders.del")),1)],8,kt)])]),_:1}))}}),xt=["onMouseenter"],wt=["onClick"],St={class:"text-secondary"},Ct=["onClick"],It=P({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0}},setup(k){const d=N(),t=k,a=M(null),o=z(()=>{let i={};const l=new Set(t.filterManager.state.folders);return t.folders.map(c=>c.id).forEach(c=>{l.has(c)&&(i[c]=!0)}),i}),m=z(()=>{let i={};return t.folders.map(l=>l.id).forEach(l=>{t.visibleFolders[l]&&(i[l]=!0)}),i}),p=z(()=>{let i={};return t.folders.forEach(l=>{let c=[];o.value[l.id]&&c.push("selected"),i[l.id]=c.join(" ")}),i});function v(i){let l=t.visibleFolders;l[i]?delete l[i]:l[i]=!0}function g(i){let l=new Set(t.filterManager.state.folders);const c=l.has(i),b=d.folders[i].parent!=null&&l.has(d.folders[i].parent);c&&!b?(l.delete(i),ke(i).forEach(w=>l.delete(w.id))):(r(i,l),l.add(i),ke(i).forEach(w=>l.add(w.id)),ze(d.folders[i]).forEach(w=>l.delete(w.id))),t.filterManager.setFolders(Array.from(l)),t.filterManager.update(!0)}function r(i,l){const c=ze(d.folders[i]);let b;for(let w of c)if(l.has(w.id))b=w;else break;b!=null&&ke(b.id).forEach(w=>l.delete(w.id))}return(i,l)=>{const c=Ee("FolderList2",!0);return s(),n("ul",{class:j(t.root?"tree":""),style:Y(t.root?"padding-left:0px;":"")},[(s(!0),n(O,null,K(k.folders,b=>(s(),n("li",{style:Y(t.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:w=>a.value=b.id,onMouseleave:l[1]||(l[1]=w=>a.value=null)},[e("summary",{class:j(p.value[b.id]),onClick:w=>g(b.id)},[e("span",{class:j(a.value===b.id?"visible-option":"invisible-option"),onClick:l[0]||(l[0]=ue(()=>{},["stop"]))},[y($t,{folder:b},null,8,["folder"])],2),ee(" "+x(b.name)+" ",1),e("span",St,x(u(d).folders[b.id].count),1)],10,wt)],40,xt),b.children&&b.children.length>0?(s(),n("i",{key:0,onClick:w=>v(b.id),class:j("bi bi-chevron-"+(m.value[b.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ct)):f("",!0),b.children&&b.children.length>0&&m.value[b.id]?(s(),I(c,{key:1,folders:b.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],4))),256))],6)}}}),Vt=A(It,[["__scopeId","data-v-bbde6fc4"]]),Mt={class:"text-center"},zt={class:"w-100 text-center",style:{"font-size":"10px"}},Tt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ft=P({__name:"TaskStatus",props:{task:{}},setup(k){const d=k,t=z(()=>d.task.total-d.task.remain-d.task.computing),a=z(()=>d.task.total);return(o,m)=>(s(),n("div",Mt,[ee(x(d.task.name)+" ",1),e("div",zt,x(t.value)+" / "+x(a.value)+" "+x(o.$t("main.nav.tasks.done")),1),a.value>0?(s(),n("div",Tt,[e("div",{class:"progress-bar",style:Y(`width: ${t.value/a.value*100}%`)},null,4)])):f("",!0)]))}}),Ae=P({__name:"TabContainer",props:{id:{}},setup(k){const d=pe(),t=k;let a;const o=M(!1);function m(){a=d.getTab(t.id),o.value=!0}return J(m),q(()=>t.id,async()=>{o.value=!1,await Z(),m()}),(p,v)=>o.value&&u(d).loaded?Oe(p.$slots,"default",{key:0,tab:u(a)}):f("",!0)}}),fe={},Et={class:"d-flex flex-row"},Ot={key:2,class:"d-flex",style:{width:"150px"}},Pt={class:"flex-grow-1"},Lt={key:1,style:{"padding-top":"1px"}},Gt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Dt={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},Rt={key:0},At={key:0,class:"ms-3 pt-1"},Ut={key:1},Bt=P({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(k){const{t:d}=Pe({useScope:"global"}),t=ce();me();const a=N(),o=k,m=M(!1),p=M(!1),v=M(""),g=M(!1),r=z(()=>o.tab.state.visibleProperties[o.property.id]==!0),i=z(()=>o.tab.collection.filterManager.state.filter.filters.some(S=>!S.isGroup&&S.propertyId==o.property.id)),l=z(()=>o.tab.collection.groupManager.state.groupBy.includes(o.property.id)),c=z(()=>o.tab.collection.sortManager.state.sortBy.includes(o.property.id)),b=z(()=>{if(i.value)return o.tab.collection.filterManager.state.filter.filters.find(S=>!S.isGroup&&S.propertyId==o.property.id).id}),w=()=>o.tab.collection.filterManager,V=z(()=>o.tab.getSha1Mode());function C(){r.value?o.tab.setVisibleProperty(o.property.id,!1):o.tab.setVisibleProperty(o.property.id,!0)}function h(){o.open&&(m.value?m.value=!1:(m.value=!0,v.value=o.property.name),p.value=!1)}function D(){o.property.type!=H.tag&&o.property.type!=H.multi_tags||(p.value?p.value=!1:p.value=!0,m.value=!1)}function F(){c.value?o.tab.collection.sortManager.delSort(o.property.id):o.tab.collection.sortManager.setSort(o.property.id),o.tab.collection.sortManager.update(!0)}function L(){l.value?o.tab.collection.groupManager.delGroupOption(o.property.id):o.tab.collection.groupManager.setGroupOption(o.property.id),o.tab.collection.groupManager.update(!0)}function B(){confirm(d("common.properties.delete")+": "+o.property.name+" ?   "+o.property.id)&&a.deleteProperty(o.property.id)}async function X(){v.value!=""&&(await a.updateProperty(o.property.id,v.value),h())}function G(){const S=w();i.value?(S.deleteFilter(b.value),fe.filter.hide()):(S.addNewFilter(o.property.id),fe.filter.show())}return q(()=>o.property,()=>{m.value=!1}),(S,$)=>(s(),n("div",{class:j(g.value?"hover-light":"")},[e("div",Et,[o.open?(s(),n(O,{key:0},[m.value?f("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:h},[y(ge,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=R=>g.value=!0),onMouseleave:$[1]||($[1]=R=>g.value=!1)},null,8,["type"]),e("span",null,x(o.property.name),1)]))],64)):(s(),I(ge,{key:1,type:o.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),m.value&&o.open?(s(),n("div",Ot,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:h,onMouseenter:$[2]||($[2]=R=>g.value=!0),onMouseleave:$[3]||($[3]=R=>g.value=!1)},null,32)]),e("div",Pt,[o.property.id>=0?ye((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=R=>v.value=R),onChange:X},null,544)),[[be,v.value]]):(s(),n("span",Lt,[y(ge,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(o.property.name),1)]))])])):f("",!0),o.open?(s(),n(O,{key:3},[u(Le)(o.property.type)?(s(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=R=>u(t).showModal(u(se).TAG,{propId:o.property.id}))},[y(T,{click:!1,message:"main.nav.properties.open_tags"},{default:_(()=>$[7]||($[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",Gt,[o.property.mode==u(Se).id?(s(),I(T,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:_(()=>$[8]||($[8]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:C,class:"btn-icon text-center"},[V.value&&o.property.mode==u(Se).id?(s(),I(T,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:_(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=ue(()=>{},["stop"]))})]),_:1})):(s(),I(T,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:_(()=>[e("span",{class:j("bi bi-eye text-"+(r.value?"primary":"secondary"))},null,2)]),_:1}))]),o.open?(s(),n("div",Dt,[o.property.type==u(H).tag||o.property.type==u(H).multi_tags?(s(),n("div",{key:0,onClick:D,style:{cursor:"pointer"}},[p.value?(s(),I(T,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:_(()=>$[9]||($[9]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(s(),I(T,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:_(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),o.open?(s(),n("div",Rt,[m.value?(s(),n("div",At,[S.property.id!=u(Ve).folders?(s(),n("div",{key:0,class:j(["options hover-light",i.value?" text-primary":""]),onClick:G},[e("div",null,[$[11]||($[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ee(x(S.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:j(["options hover-light",c.value?" text-primary":""]),onClick:F},[$[12]||($[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),ee(x(S.$t("main.menu.sort.title")),1)],2),e("div",{class:j(["options hover-light",l.value?" text-primary":""]),onClick:L},[$[13]||($[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),ee(x(S.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),n("div",{key:1,class:"options hover-light",onClick:B},[$[14]||($[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),ee(x(S.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):p.value?(s(),n("div",Ut,[y(We,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}}),jt=A(Bt,[["__scopeId","data-v-aa687f93"]]),Ht={key:0,class:"prop-container"},Nt={key:0},Wt={key:1},qt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Qt={key:0,class:"ms-2"},Kt={key:0,class:"ps-1 pe-1"},Yt={class:"property-item"},Xt=P({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(k){const d=N(),t=k,a=M(!0),o=M(!1),m=M(""),p=z(()=>t.node.propertyIds.map(w=>d.properties[w])),v=z(()=>{if(t.node.groupId>=0)return d.propertyGroups[t.node.groupId];if(t.node.groupId==de.DEFAULT)return{id:de.DEFAULT,name:"default"};if(t.node.groupId==de.COMPUTED)return{id:de.COMPUTED,name:"computed"}}),g=z(()=>v.value.id>=0);function r(){a.value=!a.value}function i(w){d.updatePropertyGroup(v.value.id,m.value)}function l(){m.value=v.value.name}function c(){d.deletePropertyGroup(v.value.id)}async function b(w){if(w.added){let V=w.added.element;const C=d.properties[V];let h=t.node.groupId;h<0&&(h=null),await d.updateProperty(C.id,C.name,h),await d.triggerPropertyTreeChange()}w.moved&&await d.triggerPropertyTreeChange()}return J(l),q(t,l),(w,V)=>u(d).propertyGroups[t.node.groupId]||t.node.groupId<0?(s(),n("div",Ht,[y(u(Ge),{list:t.node.propertyIds,"item-key":C=>C,group:t.node.groupId>0||t.node.groupId==u(de).DEFAULT?"properties":void 0,onChange:b},{header:_(()=>[e("div",{class:"d-flex group-container",onClick:r},[a.value?(s(),n("div",Nt,V[3]||(V[3]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(s(),n("div",Wt,V[4]||(V[4]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),t.menuOpen?(s(),n(O,{key:2},[o.value?f("",!0):(s(),n("div",qt,x(v.value.name),1)),g.value?(s(),n(O,{key:1},[o.value?(s(),n("div",Qt,[y(qe,{"auto-focus":!0,modelValue:m.value,"onUpdate:modelValue":V[0]||(V[0]=C=>m.value=C),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:i,onCancel:l,onBlur:V[1]||(V[1]=C=>o.value=!1)},null,8,["modelValue"])])):f("",!0),V[7]||(V[7]=e("div",{class:"flex-grow-1"},null,-1)),o.value?f("",!0):(s(),n("div",{key:1,class:"bb me-1",onClick:V[2]||(V[2]=ue(C=>o.value=!0,["stop"]))},V[5]||(V[5]=[e("i",{class:"bi bi-pencil"},null,-1)]))),e("div",{class:"bb me-1",onClick:ue(c,["stop"])},V[6]||(V[6]=[e("i",{class:"bi bi-x"},null,-1)]))],64)):f("",!0)],64)):f("",!0)])]),item:_(({element:C,index:h})=>[a.value&&p.value.length&&u(d).properties[C]?(s(),n("div",Kt,[e("div",Yt,[y(jt,{tab:t.tab,property:u(d).properties[C],open:t.menuOpen},null,8,["tab","property","open"])])])):f("",!0)]),_:1},8,["list","item-key","group"])])):f("",!0)}}),$e=A(Xt,[["__scopeId","data-v-f8660f20"]]),Zt={key:0,class:"mb-1"},Jt=P({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(k,{emit:d}){const t=N(),a=k;function o(m){t.triggerPropertyTreeChange()}return(m,p)=>(s(),I(u(Ge),{list:u(t).propertyTree,onChange:o,"item-key":v=>v.groupId},{item:_(({element:v})=>[v.groupId>=0?(s(),n("div",Zt,[y($e,{tab:a.tab,node:v,"menu-open":a.menuOpen},null,8,["tab","node","menu-open"])])):f("",!0)]),footer:_(()=>[y($e,{class:"mb-1",tab:a.tab,node:u(t).propertyTree[u(t).propertyTree.length-2],"menu-open":a.menuOpen},null,8,["tab","node","menu-open"]),y($e,{class:"mb-1",tab:a.tab,node:u(t).propertyTree[u(t).propertyTree.length-1],"menu-open":a.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),es={class:""},ts={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ss={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},os={class:"flex-grow-1 text-capitalize overflow-hidden"},as={key:0,class:"bi bi-chevron-left"},ns={key:1,class:"bi bi-chevron-right"},ls={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},is={class:"d-flex align-items-center"},rs={style:{"max-height":"300px",overflow:"auto"}},ds={key:0,id:"import"},us={class:"pt-1 pb-2"},ps={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},cs={key:0,class:"ps-2 pe-2"},ms={class:"p-1"},gs={key:0,class:"custom-hr"},vs={class:"p-1 mt-0"},fs={key:0,class:"d-flex p-1"},ys={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},bs={key:1,class:"bb me-1"},hs={class:"bb me-2"},_s={key:1,class:"mt-2"},ks=200,$s=55,xs=P({__name:"Menu",emits:["export","toggle"],setup(k,{emit:d}){const t=me(),a=N(),o=ce(),m=pe(),p=d,v=M(!1),g=M(!1),r=M(!0),i=z(()=>r.value?ks:$s);z(()=>a.propertyList.filter(C=>C.id>=0&&(C.propertyGroupId===void 0||!a.propertyGroups[C.propertyGroupId])));const l=async C=>{o.showModal(se.IMPORT)},c=z(()=>t.backendStatus.tasks.filter(C=>!C.done));function b(){o.showModal(se.FOLDERSELECTION,{callback:w,mode:"images"})}function w(C){C&&a.addFolder(C)}function V(){r.value=!r.value,p("toggle")}return q(()=>t.status.import.to_import,()=>v.value=!0),(C,h)=>(s(),I(Ae,{id:u(m).mainTab},{default:_(({tab:D})=>[e("div",{class:"menu overflow-scroll",style:Y({width:i.value+"px"})},[e("div",es,[e("div",null,[e("div",ts,[e("div",ss,[r.value?(s(),n(O,{key:0},[e("div",os,x(u(o).data.status.selectedProject?.name),1),y(T,{message:"main.menu.close_project"},{default:_(()=>[e("div",{class:"base-hover p-1",onClick:h[0]||(h[0]=F=>u(o).closeProject())},h[6]||(h[6]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:h[1]||(h[1]=F=>u(o).showModal(u(se).SETTINGS))},h[7]||(h[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:j(["base-hover p-1",r.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:V},[r.value?(s(),n("i",as)):(s(),n("i",ns))],2)])]),r.value?(s(),n(O,{key:0},[h[9]||(h[9]=e("div",{class:"custom-hr"},null,-1)),e("div",ls,[e("div",is,[e("div",null,[e("b",null,x(C.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:h[2]||(h[2]=F=>{b(),u(Ce)()})},[y(T,{message:"main.nav.folders.add"},{default:_(()=>h[8]||(h[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",rs,[y(Vt,{folders:u(a).folderRoots,"filter-manager":D.collection.filterManager,"visible-folders":D.state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])])])],64)):f("",!0),r.value?(s(),n(O,{key:1},[c.value&&c.value.length?(s(),n("div",ds,[h[11]||(h[11]=e("div",{class:"custom-hr"},null,-1)),e("div",us,[e("div",ps,[e("div",null,[e("b",null,x(C.$t("main.nav.tasks.title")),1)])]),h[10]||(h[10]=e("div",{class:"custom-hr"},null,-1)),u(t).backendStatus?(s(),n("div",cs,[(s(!0),n(O,null,K(c.value,(F,L)=>(s(),n("div",ms,[L?(s(),n("div",gs)):f("",!0),y(Ft,{task:F},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),h[18]||(h[18]=e("div",{class:"custom-hr"},null,-1)),e("div",vs,[r.value?(s(),n("div",fs,[y(T,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:_(()=>[e("b",null,x(C.$t("main.nav.properties.title")),1)]),_:1}),h[13]||(h[13]=e("span",{class:"flex-grow-1"},null,-1)),g.value?(s(),n("span",ys,h[12]||(h[12]=[e("span",{class:"sr-only"},null,-1)]))):(s(),n("span",bs,[y(T,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:l})]),_:1})])),e("span",hs,[y(T,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h[3]||(h[3]=F=>u(o).showModal(u(se).EXPORT,void 0))})]),_:1})])])):f("",!0),u(t).status.loaded?(s(),n("div",_s,[y(Jt,{tab:D,"menu-open":r.value},null,8,["tab","menu-open"]),r.value?(s(),n(O,{key:0},[h[16]||(h[16]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:h[4]||(h[4]=F=>{u(o).showModal(u(se).PROPERTY,void 0),u(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[14]||(h[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(C.$t("main.nav.properties.add_property")),1)]),h[17]||(h[17]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:h[5]||(h[5]=F=>u(a).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[15]||(h[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(C.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)])])])],4)]),_:1},8,["id"]))}}),ws=A(xs,[["__scopeId","data-v-a1f20652"]]),Ss={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Cs={class:""},Is=["onClick"],Vs=P({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,a=d;function o(m){a("update:modelValue",m)}return(m,p)=>(s(),I(oe,null,{button:_(()=>[e("div",Ss,[e("span",Cs,x(m.$t("modals.filters."+t.modelValue)),1)])]),popup:_(({hide:v})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:v},[e("div",{class:"base-btn",onClick:p[0]||(p[0]=g=>o(u(Te).and))},x(m.$t("modals.filters.and")),1),p[2]||(p[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:p[1]||(p[1]=g=>o(u(Te).or))},x(m.$t("modals.filters.or")),1)],8,Is)]),_:1}))}}),Ms=["disabled"],zs={class:"m-0 p-1"},Ts=["onClick"],Fs=P({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(k,{emit:d}){const t=N(),a=k,o=d,m=z(()=>t.properties[a.propertyId]),p=z(()=>Qe(m.value.type));async function v(g){o("update:modelValue",g)}return(g,r)=>(s(),I(oe,{onHide:r[0]||(r[0]=i=>o("hide")),placement:"bottom"},{button:_(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:a.disabled},[e("span",null,x(g.$t("modals.filters.operators."+a.modelValue)),1)],8,Ms)]),popup:_(({hide:i})=>[e("div",zs,[(s(!0),n(O,null,K(p.value,l=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>{v(l),i()}},[e("a",null,x(g.$t("modals.filters.operators."+l)),1)],8,Ts))),256))])]),_:1}))}}),Es=A(Fs,[["__scopeId","data-v-21b8bb8e"]]),Os={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},Ps=P({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,a=d;function o(m){a("update:modelValue",m)}return(m,p)=>(s(),n("div",Os,[u(Le)(m.property.type)?(s(),I(Ke,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":o,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==u(H).color?(s(),I(Ye,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":o,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).number?(s(),I(Xe,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":o,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).url?(s(),I(Ze,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":o,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).checkbox?(s(),I(Je,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":o,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==u(H).date?(s(),I(et,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":o,width:t.width,class:"sb"},null,8,["model-value","width"])):(s(),I(tt,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":o,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Ls={class:"p-0 m-0 ps-2"},Gs=P({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(k,{emit:d}){const t=N(),a=k,o=z(()=>t.properties[a.filter.propertyId]),m=z(()=>st(a.filter.operator));function p(r){a.manager.updateFilter(a.filter.id,{operator:r})}function v(r){a.manager.updateFilter(a.filter.id,{value:r})}function g(r){a.manager.updateFilter(a.filter.id,{propertyId:r.id})}return(r,i)=>(s(),n(O,null,[e("td",Ls,[y(ot,{"model-value":o.value,"onUpdate:modelValue":g},null,8,["model-value"])]),e("td",null,[y(Es,{"property-id":o.value.id,"model-value":a.filter.operator,"onUpdate:modelValue":p},null,8,["property-id","model-value"])]),e("td",null,[m.value?(s(),I(Ps,{key:0,"model-value":a.filter.value,"onUpdate:modelValue":v,property:o.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),Ds={style:{"max-height":"500px",overflow:"auto"}},Ue=P({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(k,{emit:d}){const t=k;function a(o){t.manager.addNewFilter(o,t.group.id),fe.filter.show()}return(o,m)=>(s(),I(oe,{placement:"auto"},{button:_(()=>[Oe(o.$slots,"default")]),popup:_(({hide:p})=>[e("div",Ds,[y(De,{onSelect:v=>{a(v),p()},"ignore-ids":[u(Ve).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Rs={class:"filter-group"},As={class:"table table-sm"},Us={style:{height:"33px"}},Bs={class:""},js={key:0,class:"m-0 p-0"},Hs={key:2,class:"text-secondary"},Ns={class:"border rounded"},Ws={class:""},qs=["onClick"],Qs={class:"d-flex text-secondary ms-2"},Ks={class:"add-options hover-light"},Ys=P({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(k,{emit:d}){N();const t=k,a=z(()=>t.filter),o=z(()=>a.value.filters),m=z(()=>{let r=255-(a.value.depth+1)*5;return`background: rgb(${r},${r},${r});`});function p(r){t.manager.deleteFilter(r.id)}function v(r){t.manager.addNewFilterGroup(r)}function g(r,i){t.manager.updateFilterGroup(r,i)}return(r,i)=>(s(),n("div",Rs,[e("table",As,[(s(!0),n(O,null,K(o.value,(l,c)=>(s(),n("tr",Us,[e("td",Bs,[c==0?(s(),n("div",js,x(r.$t("modals.filters.where")),1)):c==1?(s(),I(Vs,{key:1,"model-value":a.value.groupOperator,"onUpdate:modelValue":i[0]||(i[0]=b=>g(a.value.id,b))},null,8,["model-value"])):(s(),n("span",Hs,x(r.$t("modals.filters."+a.value.groupOperator)),1))]),l.propertyId!==void 0?(s(),I(Gs,{key:0,filter:l,manager:t.manager},null,8,["filter","manager"])):(s(),n("td",{key:1,colspan:"3",style:Y(m.value)},[e("div",Ns,[y(Be,{filter:l,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",Ws,[e("span",{class:"base-btn",onClick:b=>p(l)},i[2]||(i[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,qs)])]))),256))]),e("div",Qs,[y(Ue,{group:t.filter,manager:t.manager},{default:_(()=>[e("div",Ks,[i[3]||(i[3]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(r.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:i[1]||(i[1]=l=>v(a.value.id))},[i[4]||(i[4]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(r.$t("modals.filters.new_group")),1)])])]))}}),Be=A(Ys,[["__scopeId","data-v-e644f737"]]),Xs={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Zs={key:0},Js={key:0,class:"or-separator"},eo={key:0,class:"or-separator"},to={key:0,class:"m-1 p-1"},so=P({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(k,{emit:d}){const t=N(),a=k,o=M(null),m=M(null),p=z(()=>{let g=v(a.manager.state.filter),r={};return g.forEach(i=>r[i.propertyId]=i),Object.values(r)});function v(g){let r=[];for(let i of g.filters)i.isGroup?r.push(...v(i)):r.push(i);return r}return q(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&m.value.hide()}),J(async()=>{await Z(),fe.filter=m.value}),(g,r)=>(s(),I(oe,{ref_key:"dropdownElem",ref:m,placement:"top-start"},{button:_(()=>[e("div",null,[p.value.length||a.manager.state.query?(s(),n("div",Xs,[a.manager.state.query?(s(),n("div",Zs,[r[0]||(r[0]=e("span",{class:"text-primary"},"Text Query",-1)),p.value.length?(s(),n("span",Js,"|")):f("",!0)])):f("",!0),(s(!0),n(O,null,K(p.value,(i,l)=>(s(),n("div",null,[l>0?(s(),n("span",eo,"|")):f("",!0),i.propertyId==u(Ve).id?(s(),I(ge,{key:1,type:u(t).properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(u(t).properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:_(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:o},[Object.keys(u(t).properties).length>0?(s(),n("div",to,[y(Be,{filter:a.manager.state.filter,manager:a.manager,parent:o.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}}),oo=A(so,[["__scopeId","data-v-56cd3bdb"]]),ao={class:"d-flex flex-row filter-form"},no={class:"pt-1 pb-1"},lo=P({__name:"FilterForm",props:{manager:Ie},setup(k){const d=k;return(t,a)=>(s(),n("div",ao,[e("div",no,x(t.$t("main.menu.filters"))+": ",1),y(oo,{manager:d.manager},null,8,["manager"]),y(Ue,{manager:d.manager,group:d.manager.state.filter,class:"p-1"},{default:_(()=>a[0]||(a[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),io=A(lo,[["__scopeId","data-v-cc2f25ec"]]),ro={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},uo=P({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(k,{emit:d}){const t=k,a=d,o=M(null);return(m,p)=>(s(),I(oe,{ref_key:"dropdownElem",ref:o,"auto-focus":!1},{button:_(()=>p[2]||(p[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:_(()=>[e("div",ro,[y(De,{onClick:p[0]||(p[0]=v=>u(Ce)()),onSelect:p[1]||(p[1]=v=>{a("select",v),o.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),je=A(uo,[["__scopeId","data-v-012e1f38"]]),po={class:"base-hover ps-1 pe-1"},co={class:"main"},mo=["onClick"],go=P({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,a=d,o=Object.values(Re);function m(p){a("update:modelValue",p)}return(p,v)=>(s(),I(oe,null,{button:_(()=>[e("div",po,x(t.modelValue),1)]),popup:_(({hide:g})=>[e("div",co,[(s(!0),n(O,null,K(u(o),r=>(s(),n("div",{class:"base-hover option",onClick:i=>{m(r),g()}},x(r),9,mo))),256))])]),_:1}))}}),vo=A(go,[["__scopeId","data-v-ce3e3774"]]),fo={class:""},yo={class:"d-flex ipt"},bo={class:"ms-2",min:"1"},ho=P({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(k,{emit:d}){const t=k,a=d,o=M(1),m=M(Re.Year);function p(){t.option.stepSize==o.value&&t.option.stepUnit==m.value||a("change",{stepSize:o.value,stepUnit:m.value})}function v(){o.value=t.option.stepSize??1,m.value=t.option.stepUnit}return q(()=>t.option,v),J(v),q(o,()=>{(o.value<1||o.value==null||isNaN(o.value))&&(o.value=1)}),(g,r)=>(s(),I(oe,{onHide:p},{button:_(()=>r[2]||(r[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:_(({hide:i,focus:l})=>[e("div",fo,[e("div",yo,[e("div",null,[ye(e("input",{type:"number","onUpdate:modelValue":r[0]||(r[0]=c=>o.value=c)},null,512),[[be,o.value]])]),e("div",bo,[y(vo,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=c=>m.value=c),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}}),_o=A(ho,[["__scopeId","data-v-78b647dc"]]),ko={class:"d-flex flex-row group-form"},$o={class:"pt-1 pb-1"},xo={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},wo={key:0,class:"bi bi-chevron-right smaller"},So=["onClick"],Co=["onClick"],Io=["onClick"],Vo=["onClick"],Mo=["onClick"],zo=["onClick"],To=["onClick"],Fo=["onClick"],Eo=["onClick"],Oo={key:5,class:"sm-btn"},Po={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Lo=P({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(k){const d=N(),t=k;function a(i){t.manager.setGroupOption(i),t.manager.update(!0)}function o(i){t.manager.delGroupOption(i),t.manager.update(!0)}function m(i,l){t.manager.setGroupOption(i,{direction:l}),t.manager.sortGroups(!0)}function p(i,l){t.manager.setGroupOption(i,{type:l}),t.manager.sortGroups(!0)}function v(i,l){t.manager.setGroupOption(i,l),t.manager.update(!0)}const g=z(()=>t.manager.state.groupBy.map(i=>d.properties[i])),r=z(()=>{const i=[];return t.manager.state.groupBy.forEach(l=>{i.push({option:t.manager.state.options[l],property:d.properties[l]})}),i});return(i,l)=>(s(),n("div",ko,[e("div",$o,x(i.$t("main.menu.groupby"))+": ",1),g.value.length?(s(),n("div",xo,[(s(!0),n(O,null,K(r.value,(c,b)=>(s(),n(O,null,[b>0?(s(),n("i",wo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:w=>o(c.property.id),id:"remove-group-button"},x(c.property.name),9,So),c.option.type==u(ne).Size?(s(),I(T,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:_(()=>[c.option.direction==u(te).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:w=>p(c.property.id,u(ne).Property)},null,8,Co)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:w=>p(c.property.id,u(ne).Property)},null,8,Io))]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:_(()=>[c.property.type==u(H).number?(s(),n(O,{key:0},[c.option.direction==u(te).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:w=>p(c.property.id,u(ne).Size)},null,8,Vo)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:w=>p(c.property.id,u(ne).Size)},null,8,Mo))],64)):(s(),n(O,{key:1},[c.option.direction==u(te).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:w=>p(c.property.id,u(ne).Size)},null,8,zo)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:w=>p(c.property.id,u(ne).Size)},null,8,To))],64))]),_:2},1024)),c.option.direction==u(te).Ascending?(s(),I(T,{key:3,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:w=>m(c.property.id,u(te).Descending)},null,8,Fo)]),_:2},1024)):(s(),I(T,{key:4,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:w=>m(c.property.id,u(te).Ascending)},null,8,Eo)]),_:2},1024)),c.property.type==u(H).date?(s(),n("div",Oo,[y(_o,{option:c.option,onChange:w=>v(c.property.id,w)},null,8,["option","onChange"])])):f("",!0)],64))),256)),t.isLoading?(s(),n("i",Po)):f("",!0)])):f("",!0),y(je,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:l[0]||(l[0]=c=>a(c))},null,8,["group-ids"])]))}}),Go=A(Lo,[["__scopeId","data-v-dcec9b5d"]]),Do={class:"d-flex flex-row sort-form"},Ro={class:"pt-1 pb-1"},Ao={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Uo={key:0,class:"bi bi-chevron-right smaller"},Bo=["onClick"],jo=["onClick"],Ho=["onClick"],No=P({__name:"SortForm",props:{manager:nt},setup(k){const d=N(),t=k,a=z(()=>t.manager.state.sortBy.map(g=>({propertyId:g,direction:t.manager.state.options[g].direction}))),o=z(()=>a.value.map(g=>g.propertyId));function m(g){t.manager.setSort(g),t.manager.update(!0)}function p(g){t.manager.delSort(g),t.manager.update(!0)}function v(g,r){t.manager.setSort(g,{direction:r}),t.manager.update(!0)}return(g,r)=>(s(),n("div",Do,[e("div",Ro,x(g.$t("main.menu.sort.title"))+": ",1),a.value.length?(s(),n("div",Ao,[(s(!0),n(O,null,K(a.value,(i,l)=>(s(),n(O,null,[l>0?(s(),n("i",Uo)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:c=>p(i.propertyId)},x(u(d).properties[i.propertyId].name),9,Bo),i.direction==u(te).Ascending?(s(),I(T,{key:1,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:c=>v(i.propertyId,u(te).Descending)},null,8,jo)]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:c=>v(i.propertyId,u(te).Ascending)},null,8,Ho)]),_:2},1024))],64))),256))])):f("",!0),y(je,{"group-ids":o.value,onSelect:r[0]||(r[0]=i=>m(i))},null,8,["group-ids"])]))}}),Wo=A(No,[["__scopeId","data-v-4e00ef99"]]),qo={class:"p-2"},Qo={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Ko={class:"border mb-1 p-1"},Yo={class:"me"},Xo={key:0},Zo={key:1},Jo={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},ea={class:"d-flex center justify-content-center"},ta={key:1,class:"bi bi-arrow-down text-secondary"},sa={key:3,class:"bi bi-arrow-up text-secondary"},oa={class:"border mb-1 p-1"},aa={class:"me"},na={key:0},la={key:1},ia={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},le=5,ra=P({__name:"HistoryDropdown",emits:[],setup(k,{emit:d}){const t=N(),a=M(!1),o=z(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=z(()=>[...t.history.undo].reverse().slice(0,le)),p=z(()=>t.history.redo.slice(Math.max(t.history.redo.length-le,0)));return q(()=>t.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(v,g)=>m.value.length||p.value.length?(s(),I(oe,{key:0},{button:_(()=>[y(T,{message:"dropdown.history.info"},{default:_(()=>[e("div",{class:"d-flex sb flash",style:Y([{"font-size":"14px"},o.value])},[g[2]||(g[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(v.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:_(()=>[e("div",qo,[u(t).history.redo.length>le?(s(),n("div",Qo," + "+x(u(t).history.redo.length-le),1)):f("",!0),(s(!0),n(O,null,K(p.value,r=>(s(),n("div",Ko,[e("span",Yo,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),g[3]||(g[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(s(),n("span",Xo,x(r.tags)+" "+x(v.$t("dropdown.history.tags")),1)):f("",!0),r.values?(s(),n("span",Zo,x(r.values)+" "+x(v.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",Jo,[e("div",ea,[m.value.length?(s(),I(T,{key:0,message:"dropdown.history.undo"},{default:_(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:g[0]||(g[0]=(...r)=>u(t).undo&&u(t).undo(...r))})]),_:1})):(s(),n("div",ta)),g[4]||(g[4]=e("div",{style:{width:"30px"}},null,-1)),p.value.length?(s(),I(T,{key:2,message:"dropdown.history.redo"},{default:_(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:g[1]||(g[1]=(...r)=>u(t).redo&&u(t).redo(...r))})]),_:1})):(s(),n("div",sa))])]),(s(!0),n(O,null,K(m.value,r=>(s(),n("div",oa,[e("span",aa,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),g[5]||(g[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(s(),n("span",na,x(r.tags)+" "+x(v.$t("dropdown.history.tags")),1)):f("",!0),r.values?(s(),n("span",la,x(r.values)+" "+x(v.$t("dropdown.history.values")),1)):f("",!0)]))),256)),u(t).history.undo.length>le?(s(),n("div",ia," + "+x(u(t).history.undo.length-le),1)):f("",!0)])]),_:1})):f("",!0)}}),da=A(ra,[["__scopeId","data-v-85cd80d0"]]),ua=P({__name:"ToggleReload",props:{tab:{}},emits:[],setup(k,{emit:d}){const t=k,a=z(()=>t.tab.collection.state.autoReload?2:t.tab.collection.runState.isDirty?0:1);function o(){a.value==0?t.tab.collection.update():a.value==1?t.tab.collection.setAutoReload(!0):t.tab.collection.setAutoReload(!1)}return(m,p)=>(s(),n("div",{class:"bb font",onClick:o,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(s(),I(T,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:_(()=>p[0]||(p[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),a.value==1?(s(),I(T,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:_(()=>p[1]||(p[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),a.value==2?(s(),I(T,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:_(()=>p[2]||(p[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}}),pa=A(ua,[["__scopeId","data-v-91d89d17"]]),ca={class:"d-flex flex-row p-2"},ma=["placeholder"],ga={class:"me-5 d-flex"},va={class:"ms-5",style:{"font-size":"13px"}},fa=["checked"],ya={class:"ms-1"},ba={class:"ms-4"},ha={class:"d-flex flex-wrap content-container ps-2"},_a=P({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(k,{emit:d}){const t=k,a=M(""),o=z(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=z(()=>o.value.length);function p(i){const l=i.target.checked;t.tab.collection.groupManager.setSha1Mode(l,!0)}function v(){a.value=t.tab.state.filterState.query}function g(){t.tab.collection.filterManager.setQuery(a.value),t.tab.collection.filterManager.update(!0)}function r(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return J(v),q(()=>t.tab.collection.filterManager.state.query,v),(i,l)=>(s(),n(O,null,[e("div",ca,[y(T,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:_(()=>[e("div",{class:j(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[l[7]||(l[7]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ye(e("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c),onChange:g},null,40,ma),[[be,a.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:r},"x")],2)]),_:1}),e("div",ga,[y(T,{message:"main.menu.grid_tooltip"},{default:_(()=>[e("i",{class:j("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=c=>t.tab.setViewMode("tree"))},null,2)]),_:1}),y(T,{message:"main.menu.table_tooltip"},{default:_(()=>[e("i",{id:"toot",class:j("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=c=>t.tab.setViewMode("grid"))},null,2)]),_:1}),y(T,{message:"main.menu.graph_tooltip"},{default:_(()=>[e("i",{id:"toot",class:j("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:l[3]||(l[3]=c=>t.tab.setViewMode("graph"))},null,2)]),_:1})]),y(T,{message:"main.menu.image_size_tooltip",click:!1},{default:_(()=>l[8]||(l[8]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[y(lt,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":l[4]||(l[4]=c=>t.tab.state.imageSize=c)},null,8,["modelValue"])]),e("div",va,[y(T,{message:"main.menu.image_mode_tooltip"},{default:_(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:p},null,40,fa),e("span",ya,x(i.$t("main.menu.image_mode")),1)]),_:1})]),e("div",ba,[y(da)]),m.value?(s(),I(it,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":o.value,"onRemove:selected":l[5]||(l[5]=c=>t.tab.collection.groupManager.clearSelection()),onStamped:l[6]||(l[6]=c=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),l[10]||(l[10]=e("div",{class:"flex-grow-1"},null,-1)),y(T,{message:"main.menu.issue",class:"bb"},{default:_(()=>l[9]||(l[9]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",ha,[y(pa,{tab:t.tab,class:"me-1"},null,8,["tab"]),y(io,{manager:t.tab.collection.filterManager},null,8,["manager"]),y(Go,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),y(Wo,{manager:t.tab.collection.sortManager},null,8,["manager"])])],64))}}),ka=A(_a,[["__scopeId","data-v-595b0224"]]),$a={class:""},xa={class:"d-flex flex-row"},wa=P({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(k,{emit:d}){const t=ce(),a=k,o=d,m=z(()=>`width: ${a.size}px; height: ${a.size}px;`);z(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`);const p=z(()=>a.pile.images[0]);return(v,g)=>(s(),n("div",$a,[y(rt,{image:p.value},{default:_(()=>[e("div",{style:Y(m.value),class:"img-container",onClick:g[0]||(g[0]=r=>u(t).showModal(u(se).IMAGE,{image:p.value}))},[y(dt,{image:p.value,width:a.size-2,height:a.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",xa,[y(T,{message:"main.recommand.accept"},{default:_(()=>[e("div",{style:Y(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:g[1]||(g[1]=r=>o("accept",p.value))}," ✓ ",4)]),_:1}),y(T,{message:"main.recommand.refuse"},{default:_(()=>[e("div",{style:Y(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:g[2]||(g[2]=r=>o("refuse",p.value))}," ✕ ",4)]),_:1})])]))}}),Sa=A(wa,[["__scopeId","data-v-2ff8fded"]]),Ca={class:"reco-container"},Ia={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Va={key:0,class:"bi bi-funnel-fill bb text-primary"},Ma={key:1,class:"bi bi-funnel bb"},za={class:"text-secondary me-2"},Ta={style:{"padding-top":"2px"},class:"me-1"},Fa={class:"flex-grow-1"},Ea={class:"d-flex flex-row"},Oa={key:0,class:"separator"},Pa={class:"d-flex flex-row"},xe=10,La=P({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(k,{emit:d}){const t=N(),a=ut(),o=k,m=d,p=M(1),v=ve([]),g=M(null),r=ve([]),i=ve(new Set),l=M(!0),c=[],b=[];async function w(G){const S=[],$=[];r.forEach(R=>{if(R.value!=null){const E=t.properties[R.propertyId];let W=R.value;E.type==H.multi_tags?(W=G.properties[R.propertyId]??[],W=[...W,R.value]):E.type==H.tag&&(W=[W]),E.mode==Se.id?$.push({instanceId:G.id,propertyId:E.id,value:W}):S.push({propertyId:E.id,sha1:G.sha1,value:W})}}),await t.setPropertyValues($,S)}function V(G){g.value.isSha1Group?g.value.images.filter(S=>S.sha1==G.sha1).forEach(S=>i.add(S.id)):i.add(G.id),X()}function C(){v.length=0;let G=[];const S=b.map($=>t.instances[$]);if(g.value.isSha1Group){const $={},R=Array.from(new Set(S.map(E=>E.sha1)));R.forEach(E=>$[E]=[]),S.forEach(E=>$[E.sha1].push(E)),R.forEach(E=>G.push({sha1:E,images:t.sha1Index[E]}))}else S.forEach($=>G.push({sha1:$.sha1,images:[$]}));h(G,v,p.value,o.imageSize,o.width)}function h(G,S,$,R,E){let W=E,Q=[],ae=0;for(let he=0;he<G.length&&!(S.length>=$);he++){let re=G[he];if(re.images=re.images.filter(He=>!i.has(He.id)),re.images.length==0)continue;let _e=R+xe;if(ae+_e<W){Q.push(re),ae+=_e;continue}if(Q.length==0)throw new Error("Images seems to be to big for the line");S.push(Q),S.length<$&&(Q=[re],ae=_e)}Q.length>0&&S.length<$&&S.push(Q)}async function D(){if(!o.group||!a.hasSimilaryFunction)return;const G=a.defaultActions.similar,S=a.getContext(G);S.instanceIds=o.group.images.map(Q=>Q.id);const $=await a.getSimilarImages(S);if(!$)return;if(!$.groups)throw new Error("No instances in ActionResult");let E=mt($.groups)[0];if(l.value){const Q=new Set(o.tab.collection.filterManager.result.images.map(ae=>ae.id));E.images=E.images.filter(ae=>Q.has(ae.id))}E.scores&&gt(E),g.value=E,r.length=0;let W=o.group;for(;W;)r.push(...W.meta.propertyValues),W=W.parent;i.clear(),c.length=0,E.images.forEach(Q=>c.push(Q.id)),X(),m("update")}function F(){l.value=!l.value}function L(){o.tab.collection.groupManager.onResultChange.addListener(X)}function B(){o.tab.collection.groupManager.onResultChange.removeListener(X)}function X(){const G=o.tab.collection.groupManager.result.index[o.group.id];if(!G){m("close");return}b.length=0;const S=new Set(G.images.map($=>$.id));c.forEach($=>{S.has($)||i.has($)||b.push($)}),C()}return J(L),Me(B),J(D),q(()=>o.group,()=>{D(),i.clear()}),q(()=>o.imageSize,C),q(()=>o.width,C),q(l,D),(G,S)=>(s(),n("div",Ca,[e("div",Ia,[y(T,{message:"main.recommand.close"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[0]||(S[0]=$=>m("close"))},S[2]||(S[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),S[5]||(S[5]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.scroll"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[1]||(S[1]=$=>m("scroll",o.group.id))},S[3]||(S[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),S[6]||(S[6]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.filter"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:F},[l.value?(s(),n("span",Va)):(s(),n("span",Ma))])]),_:1}),S[7]||(S[7]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.reload"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:D},S[4]||(S[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),S[8]||(S[8]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:_(()=>[e("span",za,x(G.$t("main.recommand.title")),1)]),_:1}),e("div",Ta,[y(pt,{action:"similar",onChanged:D})]),e("div",Fa,[e("div",Ea,[(s(!0),n(O,null,K(r,($,R)=>(s(),n(O,null,[y(ct,{class:"",value:$},null,8,["value"]),R<r.length-1?(s(),n("div",Oa)):f("",!0)],64))),256))])])]),e("div",{style:Y("margin-left:"+xe+"px;")},[(s(!0),n(O,null,K(v,$=>(s(),n("div",null,[e("div",Pa,[(s(!0),n(O,null,K($,R=>(s(),I(Sa,{pile:R,size:o.imageSize,onAccept:w,onRefuse:V,style:Y("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),Ga=A(La,[["__scopeId","data-v-fe023b30"]]),Da={style:{display:"flex"}},Ra={class:"info"},Aa={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:H},height:String},setup(k){const d=k,t=M(0),a=M(!1),o={};Object.keys(d.chartData.series).forEach(l=>{o[l]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:d.chartData.dataType===H.date?"datetime":"numeric",categories:d.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:l,seriesIndex:c,dataPointIndex:b,w}){const V=d.chartData.series[c].data[b];let C='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';V.images.forEach((D,F)=>{F<10&&(C+=`<div style="width: 75px; height: 75px;"><img src="${D}" style="width: 100%; height: 100%;" /></div>`)}),C+="</div>";let h=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${d.chartData.series[c].name} — </b> ${V.y} Images</span>`;return h+=`<div>${C}</div>`,h}}}),p=()=>{m.value.chart.stacked=!m.value.chart.stacked,a.value=!a.value,t.value+=1},v=()=>{let l;m.value.chart.type==="area"?l={chart:{...m.value.chart,type:"bar"}}:l={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...l},t.value+=1},g=(l,c,b)=>{const V=d.chartData.series[c];let C=Math.max(...V.data.map(h=>h.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(h=>h.remove()),o[c]){o[c]=!1;return}V.data.forEach((h,D)=>{const L=Math.floor(h.y/C*17),B=h.images.slice(0,L),X=`circle[index="${c}"][j="${D}"]`,G=document.querySelector(X),S=parseFloat(G.getAttribute("cx"));B.forEach(($,R)=>{const E=document.createElement("img");E.src=$,E.width=40,E.height=40,E.style.position="absolute";let W=S+40/1.5,Q=65+R*40;E.style.left=`${W}px`,E.style.bottom=`${Q}px`,E.classList.add("apexcharts-custom-image"),E.addEventListener("mouseover",ae=>r(W,Q,$)),E.addEventListener("mouseout",i),l.el.appendChild(E)})}),Object.keys(o).forEach(h=>o[h]=!1),o[c]=!0};function r(l,c,b){const w=document.getElementById("zoomed-image");w.style.left=`${l+120*1.5}px`,w.src=b,w.style.bottom=`${c}px`,w.style.display="block"}function i(){const l=document.getElementById("zoomed-image");l.style.display="none"}return(l,c)=>{const b=Ee("apexchart");return s(),n(O,null,[e("div",Da,[e("button",{class:"mt-2",onClick:v},x(m.value.chart.type==="area"?l.$t("main.graph-view.histo"):l.$t("main.graph-view.curve")),1),d.chartData.series.length>1?(s(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:p},x(a.value?l.$t("main.graph-view.over"):l.$t("main.graph-view.stack")),1)):f("",!0)]),(s(),I(b,{style:{position:"relative"},key:t.value,height:d.height,type:m.value.chart.type,options:m.value,series:d.chartData.series,onLegendClick:g},null,8,["height","type","options","series"])),e("i",Ra,x(l.$t("main.graph-view.info")),1),c[0]||(c[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Ua={key:1},Ba=P({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(k,{emit:d}){const t=N(),a=k,o=M(""),m=M(v());function p(){const g=new Set;let r=a.collection.groupManager.getGroupIterator();for(;r;){const i=r.group;if(i.id===0||i.meta.propertyValues&&i.meta.propertyValues[0].value==null){r=r.nextGroup();continue}for(let l of i.children)g.add(l.meta.propertyValues[0].value);i.children.forEach(()=>r=r.nextGroup()),r=r.nextGroup()}return g}function v(){const g={};let r,i=a.collection.groupManager.state.groupBy;if(i.length===0){o.value="Choose at least one date or numeric value to group the images by";return}const l=t.properties[i[0]],c=l.type;if(i.length>2){o.value="Only max two levels of grouping are supported";return}else if(i.length===1)g[l.name]={name:l.name,data:[]};else if(r=Array.from(p()),r.length>20){o.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(c!==H.number&&c!==H.date){o.value="First level of grouping needs to be a date or a numeric property";return}let b=a.collection.groupManager.getGroupIterator();const w=[];for(;b;){const V=b.group;if(V.id===0||V.meta.propertyValues&&V.meta.propertyValues[0].value==null){b=b.nextGroup();continue}let C=V.meta.propertyValues[0];const h=c===H.date?new Date(C.value).getTime():C.value;if(w.push(h),l.name in g)g[l.name].data.push({x:h,y:V.images.length,images:V.images.slice(0,20).map(D=>D.urlSmall)});else{const D=V.children.map(L=>L.meta.propertyValues[0].value),F=r.filter(L=>!D.includes(L));for(let L of V.children){const B=L.meta.propertyValues[0].value;if(g[B]===void 0){let X=B;B in t.tags&&(X=t.tags[B].value),g[B]={data:[],name:X}}g[L.meta.propertyValues[0].value].data.push({x:h,y:L.images.length,images:L.images.slice(0,20).map(X=>X.urlSmall)})}for(let L of F){if(g[L]===void 0){let B=L;L in t.tags&&(B=t.tags[L].value),g[L]={data:[],name:B}}g[L].data.push({x:h,y:0,images:[]})}V.children.forEach(()=>b=b.nextGroup())}b=b.nextGroup()}return o.value="",{series:Object.values(g),xValues:w,dataType:c}}return a.collection.groupManager.onResultChange.addListener(()=>m.value=v()),(g,r)=>(s(),n("div",{class:"",style:Y({height:a.height+"px"})},[o.value===""?(s(),I(Aa,{key:0,chartData:m.value,height:a.height-50+"px"},null,8,["chartData","height"])):(s(),n("span",Ua,x(o.value),1))],4))}}),ja={key:0,class:"m-0 p-0"},Ha={key:0,style:{"margin-left":"10px"}},Na=P({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(k,{expose:d}){me();const t=N(),a=k;d({updateScrollerWidth:C});const o=M({}),m=M(!0),p=M(null),v=M(null),g=M(null),r=M(0),i=M(0),l=ve({groups:!1}),c=z(()=>a.tab.getVisibleProperties());function b(){p.value&&v.value?r.value=a.height-p.value.clientHeight-v.value.clientHeight-5:p.value?r.value=a.height-p.value.clientHeight-5:r.value=0}function w(h){o.value=a.tab.collection.groupManager.result.index[h],Z(()=>b())}function V(){o.value={},Z(()=>b())}async function C(){await Z(),i.value=p.value?.clientWidth??i.value}return J(()=>{i.value=p.value.clientWidth,window.addEventListener("resize",C)}),Me(()=>{window.removeEventListener("resize",C)}),q(()=>a.tab.state.imageSize,()=>Z(b)),q(()=>a.filterOpen,()=>Z(b)),q(()=>a.height,async()=>{await Z(b)}),J(b),J(()=>a.tab.update()),(h,D)=>(s(),n(O,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:p},[a.filterOpen?(s(),I(ka,{key:0,tab:a.tab,"compute-status":l},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:v,class:"m-0 p-0"},[o.value.id?(s(),n("div",ja,[y(Ga,{tab:a.tab,group:o.value,"image-size":a.tab.state.imageSize,width:i.value,height:50,onClose:V,onScroll:g.value.scrollTo,onUpdate:D[0]||(D[0]=F=>Z(()=>b()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),u(t).isLoaded&&i.value>0&&r.value>0&&m.value?(s(),n("div",Ha,[a.tab.state.display=="tree"?(s(),I(vt,{key:0,"group-manager":a.tab.collection.groupManager,"image-size":a.tab.state.imageSize,height:r.value-0,properties:c.value,"hide-if-modal":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:g,width:i.value-25,onRecommend:w},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),a.tab.state.display=="grid"?(s(),n("div",{key:1,style:Y({width:i.value-12+"px"}),class:"p-0 m-0 grid-container"},[y(ft,{tab:h.tab,manager:a.tab.collection.groupManager,height:r.value-15,width:i.value-40,"selected-properties":c.value,class:"p-0 m-0","show-images":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:g,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),a.tab.state.display=="graph"?(s(),I(Ba,{key:2,collection:a.tab.collection,height:r.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}}),Wa=A(Na,[["__scopeId","data-v-813c6f29"]]),qa=P({__name:"TabButton",props:{tab:{}},setup(k){const d=pe(),t=M(""),a=M(null),o=M(!1),m=M(!1),p=k,v=z(()=>p.tab.state.id);function g(){d.selectMainTab(p.tab.state.id)}function r(){m.value=!0,t.value=p.tab.state.name,Z(()=>a.value.focus())}function i(){p.tab.renameTab(t.value),m.value=!1}async function l(){confirm("Are you sure to delete Tab: "+p.tab.state.name)&&d.deleteTab(p.tab.state.id)}return J(()=>{p.tab.isNew&&r()}),(c,b)=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:b[1]||(b[1]=w=>o.value=!0),onMouseleave:b[2]||(b[2]=w=>o.value=!1)},[m.value?(s(),n("div",{key:1,class:j(["tab-button",v.value==u(d).mainTab?" active":""])},[e("form",{onSubmit:ue(i,["stop","prevent"])},[ye(e("input",{onFocusout:i,onKeydown:yt(i,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":b[0]||(b[0]=w=>t.value=w),ref_key:"inputElem",ref:a},null,544),[[be,t.value]])],32)],2)):(s(),n(O,{key:0},[y(T,{message:"main.menu.rename_tab_tooltip"},{default:_(()=>[e("i",{onClick:r,class:j(["bi bi-pencil me-1 tab-icon hover-light",o.value&&u(d).mainTab==v.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:j(["tab-button",v.value==u(d).mainTab?" active":""]),onClick:g},[e("span",null,x(p.tab.state.name),1)],2),y(T,{message:"main.menu.delete_tab_tooltip"},{default:_(()=>[e("i",{onClick:l,class:j(["btn-icon bi bi-x tab-icon hover-light",o.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Qa={class:"d-flex d-row",style:{cursor:"pointer"}},Ka={class:"pt-1"},Ya={key:0,class:"bb bi bi-chevron-down"},Xa={key:1,class:"bb bi bi-chevron-right"},Za={style:{"padding-top":"2px","margin-right":"2px"}},Ja={class:"lang"},en=["value"],tn=["value"],sn=P({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(k,{emit:d}){const{locale:t}=Pe(),a=ce(),o=pe(),m=k,p=d;async function v(l){await o.addTab("New Tab")}const g=["fr","en"];function r(){p("update:filterOpen",!m.filterOpen)}function i(l){m.reRender();const c=l.target.value;t.value=c,me().setLang(c)}return(l,c)=>(s(),n("nav",null,[e("div",Qa,[e("div",Ka,[e("span",{onClick:r},[m.filterOpen?(s(),n("i",Ya)):(s(),n("i",Xa))])]),(s(!0),n(O,null,K(u(o).loadedTabs,b=>(s(),n("div",null,[y(qa,{tab:u(o).getTab(b)},null,8,["tab"])]))),256)),y(T,{message:"main.menu.add_tab_tooltip"},{default:_(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:v,id:"add-tab-button"},c[1]||(c[1]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),c[4]||(c[4]=e("div",{class:"flex-grow-1"},null,-1)),e("div",Za,[y(T,{message:"modals.notif.icon"},{default:_(()=>[e("span",{class:"bb",onClick:c[0]||(c[0]=b=>u(a).showModal(u(se).NOTIF))},c[2]||(c[2]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",Ja,[c[3]||(c[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:l.$i18n.locale,onChange:i},[(s(),n(O,null,K(g,(b,w)=>e("option",{key:`Lang${w}`,value:b},x(b.toUpperCase()),9,tn)),64))],40,en)])])]))}}),on={key:0},an={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},ie=P({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(k){const d=k;return(t,a)=>d.loading?(s(),n("div",on,[t.loading?(s(),n("div",an,a[0]||(a[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),we=P({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(k){const d=k,t=z(()=>d.force?"100%":d.max==0?"0%":d.current>=d.max?"100%":Math.floor(d.current/d.max*100)+"%");return(a,o)=>(s(),n("span",null,x(t.value),1))}}),nn={key:0,class:"center"},ln={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},rn={class:"d-flex text-secondary"},dn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},un={class:"d-flex text-secondary",style:{"font-size":"14px"}},pn={key:0,class:"bi bi-check text-success"},cn={class:"d-flex text-secondary",style:{"font-size":"14px"}},mn={key:0,class:"bi bi-check text-success"},gn={class:"d-flex text-secondary",style:{"font-size":"14px"}},vn={key:0,class:"bi bi-check text-success"},fn={class:"d-flex text-secondary",style:{"font-size":"14px"}},yn={key:0,class:"bi bi-check text-success"},bn={class:"d-flex text-secondary",style:{"font-size":"14px"}},hn={key:0,class:"bi bi-check text-success"},_n=P({__name:"DataLoad",setup(k){const d=N();return(t,a)=>u(d).loadState?(s(),n("div",nn,[e("div",ln,[e("div",null,[e("div",rn,[a[0]||(a[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedProperty},null,8,["loading"]),u(d).loadState.finishedProperty?(s(),n("i",dn)):f("",!0)]),e("div",un,[a[1]||(a[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedPropertyGroups},null,8,["loading"]),u(d).loadState.finishedPropertyGroups?(s(),n("i",pn)):f("",!0)]),e("div",cn,[a[2]||(a[2]=e("div",{class:"me-1"},"Tags",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedTags},null,8,["loading"]),u(d).loadState.finishedTags?(s(),n("i",mn)):f("",!0)]),e("div",gn,[a[3]||(a[3]=e("div",{class:"me-1"},"Instances",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedInstance},null,8,["loading"]),u(d).loadState.finishedInstance?(s(),n("i",vn)):f("",!0),y(we,{current:u(d).loadState.counterInstance,max:u(d).loadState.maxInstance,force:u(d).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",fn,[a[4]||(a[4]=e("div",{class:"me-1"},"InstanceValues",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedInstanceValues},null,8,["loading"]),u(d).loadState.finishedInstanceValues?(s(),n("i",yn)):f("",!0),y(we,{current:u(d).loadState.counterInstanceValue,max:u(d).loadState.maxInstanceValue,force:u(d).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",bn,[a[5]||(a[5]=e("div",{class:"me-1"},"ImageValues",-1)),y(ie,{class:"me-2",loading:!u(d).loadState.finishedImageValues},null,8,["loading"]),u(d).loadState.finishedImageValues?(s(),n("i",hn)):f("",!0),y(we,{current:u(d).loadState.counterImageValue,max:u(d).loadState.maxImageValue,force:u(d).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}}),kn=A(_n,[["__scopeId","data-v-0db6d675"]]),$n={key:0},xn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},wn={class:"w-100"},Sn={key:0,class:"custom-hr"},Cn={key:2,class:"loading"},In={class:"text-center"},Vn={key:3,class:"loading"},Mn={key:1,class:"above"},zn=P({__name:"PanopticView",setup(k){const d=me(),t=N(),a=ce(),o=pe(),m=M(null),p=M(null),v=M(window.innerHeight),g=M(!1),r=M(!0),i=M(!0),l=z(()=>v.value-(p.value?.clientHeight??0)),c=z(()=>m.value?.filteredImages.map(F=>F.id));let b=navigator.userAgent.indexOf("Mac OS X")!==-1;async function w(){r.value=!1,await Z(),r.value=!0}J(async()=>{console.log(a.isProjectLoaded),a.isProjectLoaded||Fe.push("/"),Z(()=>{window.addEventListener("resize",V),V()}),window.addEventListener("keydown",F=>{F.key=="Control"&&(U.ctrl=!0),F.key=="Alt"&&(b&&(U.ctrl=!0),U.alt=!0),F.key=="Shift"&&(U.shift=!0),F.key=="ArrowLeft"&&(U.left=!0),F.key=="ArrowRight"&&(U.right=!0,console.log("keeeyy")),F.key=="Z"&&U.ctrl&&t.redo(),F.key=="z"&&U.ctrl&&t.undo()}),window.addEventListener("keyup",F=>{F.key=="Control"&&(U.ctrl=!1),F.key=="Alt"&&(b&&(U.ctrl=!1),U.alt=!1),F.key=="Shift"&&(U.shift=!1),F.key=="ArrowLeft"&&(U.left=!1),F.key=="ArrowRight"&&(U.right=!1)}),window.addEventListener("mousemove",F=>{U.ctrl=F.ctrlKey,U.alt=F.altKey,U.shift=F.shiftKey,b&&(U.ctrl=U.ctrl||U.alt)})}),Me(()=>{window.removeEventListener("resize",V)});function V(){v.value=window.innerHeight,g.value=!0}function C(){a.showModal(se.EXPORT,c)}function h(){Fe.push("/")}function D(){m.value&&m.value.updateScrollerWidth()}return(F,L)=>(s(),n(O,null,[r.value&&!u(a).state.backendOff?(s(),n("div",$n,[m.value&&!m.value.imageList?(s(),I(bt,{key:0,tutorial:"project"})):f("",!0),(s(),n("div",{id:"panoptic",key:u(d).status.renderNb},[e("div",xn,[u(t).isLoaded?u(t).isLoaded?(s(),n(O,{key:1},[e("div",null,[y(ws,{onExport:L[0]||(L[0]=B=>C()),onToggle:D})]),e("div",wn,[e("div",{class:"ms-1",ref_key:"navElem",ref:p},[y(sn,{"re-render":w,filterOpen:i.value,"onUpdate:filterOpen":L[1]||(L[1]=B=>i.value=B)},null,8,["filterOpen"])],512),g.value?(s(),n("div",Sn)):f("",!0),y(Ae,{id:u(o).mainTab},{default:_(({tab:B})=>[y(Wa,{tab:B,height:l.value,ref_key:"mainViewRef",ref:m,"filter-open":i.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):u(a).isProjectLoaded?(s(),n("div",Vn,L[2]||(L[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(s(),n("div",Cn,[e("div",In,[e("div",null,x(F.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:h,style:{"font-size":"50px",cursor:"pointer"}})])])):(s(),n("div",{key:0,class:"d-flex flex-column w-100",style:Y({height:v.value+"px"})},[y(kn,{class:"flex-grow-1"})],4))])]))])):f("",!0),u(a).state.backendOff?(s(),n("div",Mn,"Lost connection to backend. Verify that panoptic is running and reload page")):f("",!0)],64))}}),En=A(zn,[["__scopeId","data-v-5f4a8ea8"]]);export{En as default};
