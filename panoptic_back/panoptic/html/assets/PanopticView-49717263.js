import{d as D,x as K,r as M,c as C,o as s,j as T,s as x,b as e,t as f,n as U,a as o,l as B,F as z,D as se,y as Ae,_ as A,z as _e,h as ue,A as Q,B as Ne,C as Oe,e as i,P as De,k as y,q as k,E as xe,G as F,H as He,I as Ue,S as Be,J as qe,K as Ke,L as Qe,p as W,f as Y,N as ie,O as we,w as pe,v as ye,Q as Ie,R as E,T as Le,m as ee,U as We,V as Ye,W as Ce,X as q,Y as $e,Z as Fe,u as Me,M as le,g as Se,$ as Xe,a0 as Ze,a1 as Je,a2 as Te,a3 as et,a4 as Ge,a5 as tt,a6 as ne,a7 as te,a8 as st,a9 as ot,aa as at,ab as nt,ac as lt,ad as it,ae as ce,af as rt,ag as ae,ah as dt,ai as ct,aj as ut,ak as pt,i as Ee,al as N,am as _t}from"./index-02feaf53.js";import{_ as mt}from"./Tutorial-c90ed28c.js";const vt=["disabled"],ht={class:"m-0 p-1"},gt=["onClick"],yt=D({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(c,{emit:u}){const t=K(),n=c,l=u,m=M(null),g=C(()=>t.properties[n.propertyId]),b=C(()=>Ae(g.value.type));async function _(p){l("update:modelValue",p),m.value.hide()}return(p,r)=>(s(),T(se,{onHide:r[0]||(r[0]=a=>l("hide")),ref_key:"dropdownElem",ref:m,parent:n.parent},{button:x(()=>[e("div",{class:U(["text-nowrap",n.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:n.disabled},[e("span",null,f(p.$t("modals.filters.operators."+n.modelValue)),1)],10,vt)]),popup:x(()=>[e("div",ht,[(s(!0),o(z,null,B(b.value,a=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:d=>_(a)},[e("a",null,f(p.$t("modals.filters.operators."+a)),1)],8,gt))),256))])]),_:1},8,["parent"]))}});const ft=A(yt,[["__scopeId","data-v-7b1fbda7"]]),bt=c=>(W("data-v-4210747d"),c=c(),Y(),c),$t={class:"m-0 p-0"},kt={style:{"max-height":"400px","overflow-y":"scroll"}},xt={key:0},wt={class:"d-flex mode-header"},It={class:"me-3"},St=bt(()=>e("div",{class:"flex-fill"},null,-1)),Ct={key:0,class:"me-2",style:{width:"100%"}},Mt=D({__name:"FilterDropdown",props:{manager:_e,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(c){const u=K(),t=c,n=M(null),l=M(null),m=M(null),g=M(0),b=M(null),_=M(null),p=C(()=>t.filterId!==void 0?t.filterId:b.value),r=C(()=>{if(!(p.value==null||p.value==-1))return t.manager.filterIndex[p.value]}),a=C(()=>r.value==null?void 0:u.properties[r.value.propertyId]);function d(){g.value=t.mode,t.mode==2&&t.filterId==null&&S(t.propertyId)}function h(){n.value&&n.value.hide()}function $(){g.value=0}function v(){h(),t.manager.deleteFilter(p.value)}function S(w){let I=t.manager.addNewFilter(w,t.parentId);b.value=I.id,g.value=2}function L(w){_.value=null,t.manager.updateFilter(p.value,{operator:w}),l.value&&l.value.focus(),xe(w)||h()}function H(){console.log("update value",_.value),t.manager.updateFilter(p.value,{value:_.value})}function Z(){if(!r.value)return;const w=u.properties[r.value.propertyId];if(Ke(w.type))return;const I=_.value??Qe(w.type);r.value.value!=I&&H()}function V(){r.value&&(_.value=r.value.value)}return ue(V),Q(()=>r.value,()=>V()),(w,I)=>(s(),T(se,{ref_key:"dropdownElem",ref:n,onShow:d,onHide:$,parent:t.parent},{button:x(()=>[e("div",$t,[Ne(w.$slots,"default",{},void 0,!0)])]),popup:x(()=>[e("div",{class:"container-size bg-white",ref_key:"popupElem",ref:m},[g.value!=0?(s(),o(z,{key:0},[e("div",kt,[g.value==1?(s(),T(Oe,{key:0,onSelect:S,"ignore-ids":[i(De).folders]},null,8,["ignore-ids"])):y("",!0)]),g.value==2?(s(),o("div",xt,[e("div",wt,[e("div",It,f(a.value.name),1),k(ft,{"property-id":r.value.propertyId,"model-value":r.value.operator,"onUpdate:modelValue":L,parent:m.value},null,8,["property-id","model-value","parent"]),St,e("div",null,[e("i",{class:"bi bi-trash-fill",onClick:v})])]),i(xe)(r.value.operator)?(s(),o("div",Ct,[a.value.type==i(F).multi_tags||a.value.type==i(F).tag?(s(),T(He,{key:0,modelValue:_.value,"onUpdate:modelValue":[I[0]||(I[0]=G=>_.value=G),H],"auto-focus":!0,property:i(u).properties[r.value.propertyId],ref_key:"inputElem",ref:l,onHide:h},null,8,["modelValue","property"])):a.value.type==i(F).color?(s(),T(Ue,{key:1,property:a.value,modelValue:_.value,"onUpdate:modelValue":[I[1]||(I[1]=G=>_.value=G),I[2]||(I[2]=()=>{h(),Z()})]},null,8,["property","modelValue"])):a.value.type==i(F).date?(s(),T(Be,{key:2,property:a.value,modelValue:_.value,"onUpdate:modelValue":[I[3]||(I[3]=G=>_.value=G),I[4]||(I[4]=()=>{h(),Z()})]},null,8,["property","modelValue"])):(s(),T(qe,{key:3,"no-html":!0,modelValue:_.value,"onUpdate:modelValue":I[5]||(I[5]=G=>_.value=G),width:-1,"min-height":20,"no-nl":i(u).properties[r.value.propertyId].type==i(F).number,"url-mode":i(u).properties[r.value.propertyId].type==i(F).url,"only-number":i(u).properties[r.value.propertyId].type==i(F).number,onBlur:Z,"auto-focus":!0,ref_key:"inputElem",ref:l},null,8,["modelValue","no-nl","url-mode","only-number"]))])):y("",!0)])):y("",!0)],64)):y("",!0)],512)]),_:3},8,["parent"]))}});const ge=A(Mt,[["__scopeId","data-v-4210747d"]]),re=c=>(W("data-v-befaa8f8"),c=c(),Y(),c),Vt={class:"d-flex flex-row"},Ft={key:1,class:"d-flex",style:{width:"150px"}},Tt={class:"flex-grow-1"},Et={key:1,style:{"padding-top":"1px"}},zt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Pt=re(()=>e("i",{class:"bi bi-link-45deg"},null,-1)),Ot={class:"text-center",style:{width:"20px","margin-top":"2px"}},Dt=re(()=>e("i",{class:"bi bi-chevron-down"},null,-1)),Lt=re(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),Gt={key:0,class:"ms-3 pt-1"},Rt=re(()=>e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),jt=re(()=>e("i",{class:"bi bi-filter me-2"},null,-1)),At=re(()=>e("i",{class:"bi bi-collection me-2"},null,-1)),Nt=re(()=>e("i",{class:"bi bi-trash me-2"},null,-1)),Ht={key:1},Ut=D({__name:"PropertyOptions",props:{property:Object},setup(c){const u=ie(),t=K(),n=u.getTabManager(),l=c,m=M(!1),g=M(!1),b=M(""),_=M(!1),p=C(()=>u.getTab()),r=C(()=>p.value.visibleProperties[l.property.id]==!0),a=C(()=>n.collection.filterManager.state.filter.filters.some(R=>!R.isGroup&&R.propertyId==l.property.id)),d=C(()=>n.collection.groupManager.state.groupBy.includes(l.property.id)),h=C(()=>n.collection.sortManager.state.sortBy.includes(l.property.id)),$=C(()=>{if(a.value)return n.collection.filterManager.state.filter.filters.find(R=>!R.isGroup&&R.propertyId==l.property.id).id}),v=()=>n.collection.filterManager,S=C(()=>n.getSha1Mode());function L(){r.value?n.setVisibleProperty(l.property.id,!1):n.setVisibleProperty(l.property.id,!0)}function H(){m.value?m.value=!1:(m.value=!0,b.value=l.property.name),g.value=!1}function Z(){l.property.type!=F.tag&&l.property.type!=F.multi_tags||(g.value?g.value=!1:g.value=!0,m.value=!1)}function V(){h.value?n.collection.sortManager.delSort(l.property.id):n.collection.sortManager.setSort(l.property.id),n.collection.sortManager.update(!0)}function w(){d.value?n.collection.groupManager.delGroupOption(l.property.id):n.collection.groupManager.setGroupOption(l.property.id),n.collection.groupManager.update(!0)}function I(){confirm("Supprimer la propriété: "+l.property.name+" ?")&&t.deleteProperty(l.property.id)}async function G(){b.value!=""&&(await t.updateProperty(l.property.id,b.value),H())}return Q(()=>l.property,()=>{m.value=!1}),(R,P)=>(s(),o("div",{class:U(_.value?"hover-light":"")},[e("div",Vt,[m.value?y("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:H},[k(we,{type:l.property.type,class:"me-2 btn-icon",onMouseenter:P[0]||(P[0]=O=>_.value=!0),onMouseleave:P[1]||(P[1]=O=>_.value=!1)},null,8,["type"]),e("span",null,f(l.property.name),1)])),m.value?(s(),o("div",Ft,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:H,onMouseenter:P[2]||(P[2]=O=>_.value=!0),onMouseleave:P[3]||(P[3]=O=>_.value=!1)},null,32)]),e("div",Tt,[l.property.id>=0?pe((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":P[4]||(P[4]=O=>b.value=O),onChange:G},null,544)),[[ye,b.value]]):(s(),o("span",Et,[k(we,{type:l.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,f(l.property.name),1)]))])])):y("",!0),e("div",zt,[l.property.mode==i(Ie).id?(s(),T(E,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:x(()=>[Pt]),_:1})):y("",!0)]),e("div",{style:{width:"20px","margin-top":"2px"},onClick:L,class:"btn-icon text-center"},[S.value&&l.property.mode==i(Ie).id?(s(),T(E,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:x(()=>[e("span",{class:"bi bi-eye-slash",onClick:P[5]||(P[5]=Le(()=>{},["stop"]))})]),_:1})):(s(),T(E,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:x(()=>[e("span",{class:U("bi bi-eye text-"+(r.value?"primary":"secondary"))},null,2)]),_:1}))]),e("div",Ot,[l.property.type==i(F).tag||l.property.type==i(F).multi_tags?(s(),o("div",{key:0,onClick:Z,style:{cursor:"pointer"}},[g.value?(s(),T(E,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:x(()=>[Dt]),_:1})):(s(),T(E,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:x(()=>[Lt]),_:1}))])):y("",!0)])]),e("div",null,[m.value?(s(),o("div",Gt,[e("div",{class:U(["options hover-light",a.value?" text-primary":""])},[k(ge,{manager:v(),"filter-id":$.value,mode:2,"property-id":c.property.id},{default:x(()=>[Rt,ee(f(R.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),e("div",{class:U(["options hover-light",h.value?" text-primary":""]),onClick:V},[jt,ee(f(R.$t("main.menu.sort.title")),1)],2),e("div",{class:U(["options hover-light",d.value?" text-primary":""]),onClick:w},[At,ee(f(R.$t("main.menu.groupby")),1)],2),l.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:I},[Nt,ee(f(R.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):g.value?(s(),o("div",Ht,[k(We,{property:l.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])],2))}});const ze=A(Ut,[["__scopeId","data-v-befaa8f8"]]),Bt=e("i",{class:"bi bi-three-dots base-hover"},null,-1),qt={class:"text-nowrap"},Kt=["onClick"],Qt=e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),Wt=e("div",{class:"custom-hr"},null,-1),Yt=["onClick"],Xt=e("i",{class:"bi bi-trash me-1"},null,-1),Zt=D({__name:"FolderOptionDropdown",props:{folder:{}},setup(c){const u=K(),t=c;function n(){u.reImportFolder(t.folder.id)}function l(){confirm(Ye.global.t("main.nav.folders.del_alert"))&&u.deleteFolder(t.folder.id)}return(m,g)=>(s(),T(se,{teleport:!0},{button:x(()=>[Bt]),popup:x(({hide:b})=>[e("div",qt,[e("div",{class:"p-2 bb",onClick:_=>{n(),b()}},[Qt,ee("Re import")],8,Kt),Wt,e("div",{class:"bb p-2",onClick:_=>{l(),b()}},[Xt,ee(f(m.$t("main.nav.folders.del")),1)],8,Yt)])]),_:1}))}}),Jt=["onMouseenter"],es=["onClick"],ts={class:"text-secondary"},ss=["onClick"],os=D({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:_e,root:{type:Boolean,default:!0}},setup(c){const u=K(),t=c,n=M(null),l=C(()=>{let r={};const a=new Set(t.filterManager.state.folders);return t.folders.map(d=>d.id).forEach(d=>{a.has(d)&&(r[d]=!0)}),r}),m=C(()=>{let r={};return t.folders.map(a=>a.id).forEach(a=>{t.visibleFolders[a]&&(r[a]=!0)}),r}),g=C(()=>{let r={};return t.folders.forEach(a=>{let d=[];l.value[a.id]&&d.push("selected"),r[a.id]=d.join(" ")}),r});function b(r){let a=t.visibleFolders;a[r]?delete a[r]:a[r]=!0}function _(r){let a=new Set(t.filterManager.state.folders);const d=a.has(r),h=u.folders[r].parent!=null&&a.has(u.folders[r].parent);d&&!h?(a.delete(r),$e(r).forEach($=>a.delete($.id))):(p(r,a),a.add(r),$e(r).forEach($=>a.add($.id)),Fe(u.folders[r]).forEach($=>a.delete($.id))),t.filterManager.setFolders(Array.from(a)),t.filterManager.update(!0)}function p(r,a){const d=Fe(u.folders[r]);let h;for(let $ of d)if(a.has($.id))h=$;else break;h!=null&&$e(h.id).forEach($=>a.delete($.id))}return(r,a)=>{const d=Ce("FolderList2",!0);return s(),o("ul",{class:U(t.root?"tree":""),style:q(t.root?"padding-left:0px;":"")},[(s(!0),o(z,null,B(c.folders,h=>(s(),o("li",{style:q(t.root?"padding-left:0px;":""),class:"no-break",onMouseenter:$=>n.value=h.id,onMouseleave:a[0]||(a[0]=$=>n.value=null)},[e("summary",{class:U(g.value[h.id]),onClick:$=>_(h.id)},[ee(f(h.name)+" ",1),e("span",ts,f(h.count),1)],10,es),h.children&&h.children.length>0?(s(),o("i",{key:0,onClick:$=>b(h.id),class:U("bi bi-chevron-"+(m.value[h.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,ss)):y("",!0),e("span",{class:U(n.value===h.id?"visible-option":"invisible-option")},[k(Zt,{folder:h,style:{display:"inline-block"}},null,8,["folder"])],2),h.children&&h.children.length>0&&m.value[h.id]?(s(),T(d,{key:1,folders:h.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager},null,8,["folders","visible-folders","filter-manager"])):y("",!0)],44,Jt))),256))],6)}}});const as=A(os,[["__scopeId","data-v-940ffff5"]]),ns={class:"text-center"},ls={class:"w-100 text-center",style:{"font-size":"10px"}},is={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},rs=D({__name:"TaskStatus",props:{task:{}},setup(c){const u=c,t=C(()=>u.task.total-u.task.remain-u.task.computing),n=C(()=>u.task.total);return(l,m)=>(s(),o("div",ns,[ee(f(u.task.name)+" ",1),e("div",ls,f(t.value)+" / "+f(n.value)+" "+f(l.$t("main.nav.tasks.done")),1),n.value>0?(s(),o("div",is,[e("div",{class:"progress-bar",style:q(`width: ${t.value/n.value*100}%`)},null,4)])):y("",!0)]))}}),X=c=>(W("data-v-0417dadd"),c=c(),Y(),c),ds={class:"menu overflow-scroll"},cs={class:""},us={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ps={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},_s=X(()=>e("i",{class:"bi bi-gear"},null,-1)),ms=[_s],vs=X(()=>e("i",{class:"bi bi-arrow-left-right"},null,-1)),hs=[vs],gs=X(()=>e("div",{class:"custom-hr"},null,-1)),ys={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},fs={class:"d-flex align-items-center"},bs=X(()=>e("i",{class:"bi bi-plus"},null,-1)),$s={style:{"max-height":"300px",overflow:"auto"}},ks={key:0,id:"import"},xs=X(()=>e("div",{class:"custom-hr"},null,-1)),ws={class:"pt-1 pb-2"},Is={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},Ss=X(()=>e("div",{class:"custom-hr"},null,-1)),Cs={key:0,class:"ps-2 pe-2"},Ms={class:"p-1"},Vs={key:0,class:"custom-hr"},Fs={key:1,class:"p-2"},Ts=X(()=>e("div",{class:"custom-hr"},null,-1)),Es={key:0,class:"float-end"},zs={class:"text-center"},Ps={class:"w-100 text-center",style:{"font-size":"10px"}},Os={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ds={key:2,class:"p-2"},Ls={class:"w-100 text-center",style:{"font-size":"10px"}},Gs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Rs=X(()=>e("div",{class:"custom-hr"},null,-1)),js={class:"p-2 mt-0"},As={class:"d-flex"},Ns=X(()=>e("span",{class:"flex-grow-1"},null,-1)),Hs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Us=X(()=>e("span",{class:"sr-only"},null,-1)),Bs=[Us],qs={key:1,class:"bb me-1"},Ks={class:"bb me-2"},Qs={key:0,class:"mt-2"},Ws={key:0,class:"property-item"},Ys=X(()=>e("div",{class:"property-item m-0 p-0"},null,-1)),Xs=X(()=>e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Zs=X(()=>e("div",{class:"custom-hr"},null,-1)),Js={class:"p-2 mt-0"},eo={key:0,class:"mt-2"},to={key:0,class:"property-item"},so=D({__name:"Menu",emits:["export"],setup(c,{emit:u}){const t=ie(),n=K(),l=Me(),m=t.getTabManager(),g=M(!1),b=M(!1),_=async d=>{l.showModal(le.IMPORT)},p=C(()=>t.backendStatus.tasks.filter(d=>!(d.name=="Load Plugin"&&d.done)));function r(){l.showModal(le.FOLDERSELECTION,{callback:a,mode:"images"})}function a(d){d&&n.addFolder(d)}return Q(()=>t.status.import.to_import,()=>g.value=!0),(d,h)=>{var $;return s(),o("div",ds,[e("div",cs,[e("div",null,[e("div",us,[e("div",ps,[e("div",{class:"flex-grow-1 text-capitalize",onClick:h[0]||(h[0]=()=>{})},f(($=i(l).data.status.selectedProject)==null?void 0:$.name),1),e("div",{class:"base-hover p-1",onClick:h[1]||(h[1]=v=>i(l).showModal(i(le).SETTINGS))},ms),e("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:h[2]||(h[2]=v=>i(l).closeProject())},hs)])]),gs,e("div",ys,[e("div",fs,[e("div",null,[e("b",null,f(d.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:h[3]||(h[3]=v=>{r(),i(Se)()})},[k(E,{message:"main.nav.folders.add"},{default:x(()=>[bs]),_:1})])]),e("div",$s,[i(t).getTab()?(s(),T(as,{key:0,folders:i(n).folderRoots,"filter-manager":i(m).collection.filterManager,"visible-folders":i(m).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):y("",!0)])]),p.value&&p.value.length?(s(),o("div",ks,[xs,e("div",ws,[e("div",Is,[e("div",null,[e("b",null,f(d.$t("main.nav.tasks.title")),1)])]),Ss,i(t).backendStatus?(s(),o("div",Cs,[(s(!0),o(z,null,B(p.value,(v,S)=>(s(),o("div",Ms,[S?(s(),o("div",Vs)):y("",!0),k(rs,{task:v},null,8,["task"])]))),256))])):y("",!0)])])):y("",!0),i(t).status.import.to_import!=null&&i(t).status.import.to_import>0&&g.value?(s(),o("div",Fs,[Ts,i(t).status.import.done?(s(),o("div",Es,[e("i",{class:"bi bi-x base-hover",onClick:h[4]||(h[4]=v=>g.value=!1)})])):y("",!0),e("div",zs,[e("b",null,f(d.$t("main.menu.import_status_title")),1)]),e("div",Ps,f(i(t).status.import.imported)+" / "+f(i(t).status.import.to_import)+" importées ",1),i(t).status.import.to_import>0?(s(),o("div",Os,[e("div",{class:"progress-bar",style:q(`width: ${i(t).status.import.imported/i(t).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),i(t).status.import.to_import!=null&&i(t).status.import.to_import>0&&g.value?(s(),o("div",Ds,[e("div",Ls,f(i(t).status.import.computed)+" / "+f(i(t).status.import.to_import)+" computed ",1),i(t).status.import.to_import>0?(s(),o("div",Gs,[e("div",{class:"progress-bar",style:q(`width: ${i(t).status.import.computed/i(t).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),Rs,e("div",js,[e("div",As,[k(E,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:x(()=>[e("b",null,f(d.$t("main.nav.properties.title")),1)]),_:1}),Ns,b.value?(s(),o("span",Hs,Bs)):(s(),o("span",qs,[k(E,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:x(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:_})]),_:1})])),e("span",Ks,[k(E,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:x(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h[5]||(h[5]=v=>i(l).showModal(i(le).EXPORT,void 0))})]),_:1})])]),i(t).status.loaded?(s(),o("div",Qs,[(s(!0),o(z,null,B(i(n).properties,v=>(s(),o(z,null,[v.id>=0?(s(),o("div",Ws,[k(ze,{property:v},null,8,["property"])])):y("",!0)],64))),256)),Ys,e("div",{id:"add-property",onClick:h[6]||(h[6]=v=>{i(l).showModal(i(le).PROPERTY,void 0),i(Se)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Xs,e("span",null,f(d.$t("main.nav.properties.add_property")),1)])])):y("",!0)]),Zs,e("div",Js,[k(E,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:x(()=>[e("b",null,f(d.$t("main.nav.computed.title")),1)]),_:1}),i(t).status.loaded?(s(),o("div",eo,[(s(!0),o(z,null,B(i(n).properties,v=>(s(),o(z,null,[v.id<0&&v.id!=i(Xe)?(s(),o("div",to,[k(E,{pos:"bottom",message:"main.nav.computed."+Math.abs(v.id).toString()+"_tooltip"},{default:x(()=>[k(ze,{property:v},null,8,["property"])]),_:2},1032,["message"])])):y("",!0)],64))),256))])):y("",!0)])])])])}}});const oo=A(so,[["__scopeId","data-v-0417dadd"]]),ao={class:"text-nowrap text-secondary"},Pe=D({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(c){const u=K(),t=c,n=C(()=>u.properties[t.propertyId].tags);return(l,m)=>(s(),o("div",ao,[t.value&&t.value.length>0?(s(!0),o(z,{key:0},B(t.value,g=>(s(),o("span",null,[k(Ze,{tag:n.value[g].value,color:n.value[g].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(z,{key:1},[ee(" Add Tags... ")],64))]))}}),no={key:0},lo={key:1},io={key:2},ro={key:3},co={key:0,class:"bi bi-square"},uo={key:1,class:"bi bi-check-square"},po={key:5},_o={key:6},mo={key:7},vo={key:8},ho={key:9},go={key:10},yo={key:11},fo={key:12},bo={key:13},$o={key:1,class:"text-secondary"},ko=D({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(c){const u=c,t=C(()=>{if(u.value==null)return"white";let l=Number(u.value);return isNaN(l)||l>12?"gray":Je[l].color}),n=C(()=>[F._ahash,F._folders,F._sha1,F.string].indexOf(u.property.type)!==-1?'"'+u.value+'"':u.value);return(l,m)=>c.value!=null?(s(),o(z,{key:0},[u.property.type==i(F)._ahash?(s(),o("div",no,f(n.value),1)):y("",!0),u.property.type==i(F)._folders?(s(),o("div",lo,f(n.value),1)):y("",!0),u.property.type==i(F)._sha1?(s(),o("div",io,f(n.value),1)):y("",!0),u.property.type==i(F).checkbox?(s(),o("div",ro,[n.value?(s(),o("i",co)):(s(),o("i",uo))])):y("",!0),u.property.type==i(F).color?(s(),o("div",{key:4,style:q({backgroundColor:t.value}),class:"w-100 h-100"},null,4)):y("",!0),u.property.type==i(F).date?(s(),o("div",po,f(n.value),1)):y("",!0),u.property.type==i(F).image_link?(s(),o("div",_o)):y("",!0),u.property.type==i(F).multi_tags?(s(),o("div",mo,[k(Pe,{"property-id":u.property.id,value:n.value},null,8,["property-id","value"])])):y("",!0),u.property.type==i(F).number?(s(),o("div",vo,f(n.value),1)):y("",!0),u.property.type==i(F).path?(s(),o("div",ho,f(n.value),1)):y("",!0),u.property.type==i(F).string?(s(),o("div",go,f(n.value),1)):y("",!0),u.property.type==i(F)._id||u.property.type==i(F)._height||u.property.type==i(F)._width?(s(),o("div",yo,f(n.value),1)):y("",!0),u.property.type==i(F).tag?(s(),o("div",fo,[k(Pe,{"property-id":u.property.id,value:n.value},null,8,["property-id","value"])])):y("",!0),u.property.type==i(F).url?(s(),o("div",bo,f(n.value),1)):y("",!0)],64)):(s(),o("span",$o,"..."))}}),xo={class:"d-flex bb ps-1 overflow-hidden"},wo={class:"m-0 p-0 me-2 text-nowrap"},Io={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},So=D({__name:"FilterPreview",props:{filter:Object},setup(c){const u=K(),t=c,n=C(()=>u.properties[t.filter.propertyId]);return(l,m)=>(s(),o("td",xo,[e("div",wo,f(l.$t("modals.filters.operators."+t.filter.operator)),1),i(xe)(t.filter.operator)?(s(),o("div",Io,[k(ko,{property:n.value,value:t.filter.value},null,8,["property","value"])])):y("",!0)]))}});const Co=A(So,[["__scopeId","data-v-34bfc81a"]]),fe=c=>(W("data-v-7c086868"),c=c(),Y(),c),Mo={class:"filter-group"},Vo={class:"table table-sm"},Fo={class:"align-top p-0 m-0"},To={key:0,class:"m-0 p-0"},Eo={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},zo={class:""},Po=["onClick"],Oo=fe(()=>e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Do={key:2,class:"text-secondary"},Lo={key:0,class:"p-0 m-0 ps-2"},Go={key:1,class:"p-0 m-0 ps-2"},Ro={class:"border rounded"},jo={class:""},Ao=["onClick"],No=fe(()=>e("i",{class:"bi bi-trash"},null,-1)),Ho=[No],Uo={class:"d-flex text-secondary ms-2"},Bo={class:"add-options hover-light"},qo=fe(()=>e("i",{class:"bi bi-plus"},null,-1)),Ko=fe(()=>e("i",{class:"bi bi-plus"},null,-1)),Qo=D({__name:"FilterGroupInput",props:{filter:Object,manager:_e,parent:HTMLElement},emits:["delete"],setup(c,{emit:u}){const t=K(),n=c,l=C(()=>n.filter),m=C(()=>l.value.filters),g=C(()=>{let a=255-(l.value.depth+1)*5;return`background: rgb(${a},${a},${a});`});function b(a,d){n.manager.updateFilter(a,{propertyId:d})}function _(a){n.manager.deleteFilter(a.id)}function p(a){n.manager.addNewFilterGroup(a)}function r(a,d){n.manager.updateFilterGroup(a,d)}return(a,d)=>{const h=Ce("FilterGroupInput",!0);return s(),o("div",Mo,[e("table",Vo,[(s(!0),o(z,null,B(m.value,($,v)=>(s(),o("tr",null,[e("td",Fo,[v==0?(s(),o("div",To,f(a.$t("modals.filters.where")),1)):v==1?(s(),T(se,{key:1},{button:x(()=>[e("div",Eo,[e("span",zo,f(a.$t("modals.filters."+l.value.groupOperator)),1)])]),popup:x(({hide:S})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:S},[e("div",{class:"base-btn",onClick:d[0]||(d[0]=L=>r(l.value.id,i(Te).and))},f(a.$t("modals.filters.and")),1),Oo,e("div",{class:"base-btn",onClick:d[1]||(d[1]=L=>r(l.value.id,i(Te).or))},f(a.$t("modals.filters.or")),1)],8,Po)]),_:1})):(s(),o("span",Do,f(a.$t("modals.filters."+l.value.groupOperator)),1))]),$.propertyId!==void 0?(s(),o("td",Lo,[k(et,{"model-value":i(t).properties[$.propertyId],"onUpdate:modelValue":S=>b($.id,S.id)},null,8,["model-value","onUpdate:modelValue"])])):y("",!0),$.propertyId!==void 0?(s(),o("td",Go,[k(ge,{class:"flex-grow-1",manager:c.manager,mode:2,"parent-id":l.value.id,"filter-id":$.id,parent:n.parent},{default:x(()=>[k(Co,{filter:$},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:q(g.value)},[e("div",Ro,[k(h,{filter:$,manager:n.manager},null,8,["filter","manager"])])],4)),e("td",jo,[e("span",{class:"base-btn",onClick:S=>_($)},Ho,8,Ao)])]))),256))]),e("div",Uo,[k(ge,{manager:n.manager,"parent-id":l.value.id},{default:x(()=>[e("div",Bo,[qo,ee(f(a.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),e("div",{class:"add-options hover-light",onClick:d[2]||(d[2]=$=>p(l.value.id))},[Ko,ee(f(a.$t("modals.filters.new_group")),1)])])])}}});const Wo=A(Qo,[["__scopeId","data-v-7c086868"]]),Yo=c=>(W("data-v-9832f887"),c=c(),Y(),c),Xo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Zo={key:0},Jo=Yo(()=>e("span",{class:"text-primary"},"Text Query",-1)),ea={key:0,class:"or-separator"},ta={key:0,class:"or-separator"},sa={key:0,class:"m-1 p-0"},oa=D({__name:"GlobalFilterInputDropdown",props:{manager:_e},emits:["update:modelValue"],setup(c,{emit:u}){const t=K(),n=c,l=M(null),m=M(null),g=C(()=>{let _=b(n.manager.state.filter),p={};return _.forEach(r=>p[r.propertyId]=r),Object.values(p)});function b(_){let p=[];for(let r of _.filters)r.isGroup?p.push(...b(r)):p.push(r);return p}return Q(()=>n.manager.state.filter.filters,()=>{n.manager.state.filter.filters.length==0&&m.value.hide()}),(_,p)=>(s(),T(se,{ref_key:"dropdownElem",ref:m},{button:x(()=>[e("div",null,[g.value.length||n.manager.state.query?(s(),o("div",Xo,[n.manager.state.query?(s(),o("div",Zo,[Jo,g.value.length?(s(),o("span",ea,"|")):y("",!0)])):y("",!0),(s(!0),o(z,null,B(g.value,(r,a)=>(s(),o("div",null,[a>0?(s(),o("span",ta,"|")):y("",!0),r.propertyId==i(De).id?(s(),T(we,{key:1,type:i(t).properties[r.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),e("span",null,f(i(t).properties[r.propertyId].name),1)]))),256))])):y("",!0)])]),popup:x(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:l},[Object.keys(i(t).properties).length>0?(s(),o("div",sa,[k(Wo,{filter:n.manager.state.filter,manager:n.manager,parent:l.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}});const aa=A(oa,[["__scopeId","data-v-9832f887"]]),na=c=>(W("data-v-1d7e82c5"),c=c(),Y(),c),la={class:"d-flex flex-row filter-form"},ia={class:"pt-1 pb-1"},ra=na(()=>e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)),da=D({__name:"FilterForm",props:{manager:_e},setup(c){const u=c;return(t,n)=>(s(),o("div",la,[e("div",ia,f(t.$t("main.menu.filters"))+": ",1),k(aa,{manager:u.manager},null,8,["manager"]),k(ge,{manager:u.manager,class:"p-1"},{default:x(()=>[ra]),_:1},8,["manager"])]))}});const ca=A(da,[["__scopeId","data-v-1d7e82c5"]]),ua=c=>(W("data-v-2f10e29f"),c=c(),Y(),c),pa=ua(()=>e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)),_a={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},ma=D({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(c,{emit:u}){const t=c,n=u,l=M(null);return(m,g)=>(s(),T(se,{ref_key:"dropdownElem",ref:l,"auto-focus":!1},{button:x(()=>[pa]),popup:x(()=>[e("div",_a,[k(Oe,{onClick:g[0]||(g[0]=b=>i(Se)()),onSelect:g[1]||(g[1]=b=>{n("select",b),l.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Re=A(ma,[["__scopeId","data-v-2f10e29f"]]),va={class:"base-hover ps-1 pe-1"},ha={class:"main"},ga=["onClick"],ya=D({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(c,{emit:u}){const t=c,n=u,l=Object.values(Ge);function m(g){n("update:modelValue",g)}return(g,b)=>(s(),T(se,null,{button:x(()=>[e("div",va,f(t.modelValue),1)]),popup:x(({hide:_})=>[e("div",ha,[(s(!0),o(z,null,B(i(l),p=>(s(),o("div",{class:"base-hover option",onClick:r=>{m(p),_()}},f(p),9,ga))),256))])]),_:1}))}});const fa=A(ya,[["__scopeId","data-v-cc9d0d61"]]),ba=c=>(W("data-v-a27bea28"),c=c(),Y(),c),$a=ba(()=>e("i",{class:"bi bi-three-dots-vertical"},null,-1)),ka={class:""},xa={class:"d-flex ipt"},wa={class:"ms-2",min:"1"},Ia=D({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(c,{emit:u}){const t=c,n=u,l=M(1),m=M(Ge.Year);function g(){t.option.stepSize==l.value&&t.option.stepUnit==m.value||n("change",{stepSize:l.value,stepUnit:m.value})}function b(){l.value=t.option.stepSize??1,m.value=t.option.stepUnit}return Q(()=>t.option,b),ue(b),Q(l,()=>{(l.value<1||l.value==null||isNaN(l.value))&&(l.value=1)}),(_,p)=>(s(),T(se,{onHide:g},{button:x(()=>[$a]),popup:x(({hide:r,focus:a})=>[e("div",ka,[e("div",xa,[e("div",null,[pe(e("input",{type:"number","onUpdate:modelValue":p[0]||(p[0]=d=>l.value=d)},null,512),[[ye,l.value]])]),e("div",wa,[k(fa,{modelValue:m.value,"onUpdate:modelValue":p[1]||(p[1]=d=>m.value=d),onHide:a},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Sa=A(Ia,[["__scopeId","data-v-a27bea28"]]),Ca={class:"d-flex flex-row group-form"},Ma={class:"pt-1 pb-1"},Va={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Fa={key:0,class:"bi bi-chevron-right smaller"},Ta=["onClick"],Ea=["onClick"],za=["onClick"],Pa=["onClick"],Oa=["onClick"],Da=["onClick"],La=["onClick"],Ga=["onClick"],Ra=["onClick"],ja={key:5,class:"sm-btn"},Aa={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Na=D({__name:"GroupForm",props:{isLoading:Boolean,manager:tt},setup(c){const u=K(),t=c;function n(r){t.manager.setGroupOption(r),t.manager.update(!0)}function l(r){t.manager.delGroupOption(r),t.manager.update(!0)}function m(r,a){t.manager.setGroupOption(r,{direction:a}),t.manager.sortGroups(!0)}function g(r,a){t.manager.setGroupOption(r,{type:a}),t.manager.sortGroups(!0)}function b(r,a){t.manager.setGroupOption(r,a),t.manager.update(!0)}const _=C(()=>t.manager.state.groupBy.map(r=>u.properties[r])),p=C(()=>{const r=[];return t.manager.state.groupBy.forEach(a=>{r.push({option:t.manager.state.options[a],property:u.properties[a]})}),r});return(r,a)=>(s(),o("div",Ca,[e("div",Ma,f(r.$t("main.menu.groupby"))+": ",1),_.value.length?(s(),o("div",Va,[(s(!0),o(z,null,B(p.value,(d,h)=>(s(),o(z,null,[h>0?(s(),o("i",Fa)):y("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:$=>l(d.property.id),id:"remove-group-button"},f(d.property.name),9,Ta),d.option.type==i(ne).Size?(s(),T(E,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:x(()=>[d.option.direction==i(te).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:$=>g(d.property.id,i(ne).Property)},null,8,Ea)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:$=>g(d.property.id,i(ne).Property)},null,8,za))]),_:2},1024)):(s(),T(E,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:x(()=>[d.property.type==i(F).number?(s(),o(z,{key:0},[d.option.direction==i(te).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:$=>g(d.property.id,i(ne).Size)},null,8,Pa)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:$=>g(d.property.id,i(ne).Size)},null,8,Oa))],64)):(s(),o(z,{key:1},[d.option.direction==i(te).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:$=>g(d.property.id,i(ne).Size)},null,8,Da)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:$=>g(d.property.id,i(ne).Size)},null,8,La))],64))]),_:2},1024)),d.option.direction==i(te).Ascending?(s(),T(E,{key:3,message:"main.menu.sort.order_asc"},{default:x(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:$=>m(d.property.id,i(te).Descending)},null,8,Ga)]),_:2},1024)):(s(),T(E,{key:4,message:"main.menu.sort.order_desc"},{default:x(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:$=>m(d.property.id,i(te).Ascending)},null,8,Ra)]),_:2},1024)),d.property.type==i(F).date?(s(),o("div",ja,[k(Sa,{option:d.option,onChange:$=>b(d.property.id,$)},null,8,["option","onChange"])])):y("",!0)],64))),256)),t.isLoading?(s(),o("i",Aa)):y("",!0)])):y("",!0),k(Re,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:a[0]||(a[0]=d=>n(d))},null,8,["group-ids"])]))}});const Ha=A(Na,[["__scopeId","data-v-388718c9"]]),Ua={class:"d-flex flex-row sort-form"},Ba={class:"pt-1 pb-1"},qa={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ka={key:0,class:"bi bi-chevron-right smaller"},Qa=["onClick"],Wa=["onClick"],Ya=["onClick"],Xa=D({__name:"SortForm",props:{manager:st},setup(c){const u=K(),t=c,n=C(()=>t.manager.state.sortBy.map(_=>({propertyId:_,direction:t.manager.state.options[_].direction}))),l=C(()=>n.value.map(_=>_.propertyId));function m(_){t.manager.setSort(_),t.manager.update(!0)}function g(_){t.manager.delSort(_),t.manager.update(!0)}function b(_,p){t.manager.setSort(_,{direction:p}),t.manager.update(!0)}return(_,p)=>(s(),o("div",Ua,[e("div",Ba,f(_.$t("main.menu.sort.title"))+": ",1),n.value.length?(s(),o("div",qa,[(s(!0),o(z,null,B(n.value,(r,a)=>(s(),o(z,null,[a>0?(s(),o("i",Ka)):y("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:d=>g(r.propertyId)},f(i(u).properties[r.propertyId].name),9,Qa),r.direction==i(te).Ascending?(s(),T(E,{key:1,message:"main.menu.sort.order_asc"},{default:x(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:d=>b(r.propertyId,i(te).Descending)},null,8,Wa)]),_:2},1024)):(s(),T(E,{key:2,message:"main.menu.sort.order_desc"},{default:x(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:d=>b(r.propertyId,i(te).Ascending)},null,8,Ya)]),_:2},1024))],64))),256))])):y("",!0),k(Re,{"group-ids":l.value,onSelect:p[0]||(p[0]=r=>m(r))},null,8,["group-ids"])]))}});const Za=A(Xa,[["__scopeId","data-v-80dc564a"]]),be=c=>(W("data-v-ba1876b2"),c=c(),Y(),c),Ja=be(()=>e("i",{class:"bi bi-clock-history me-1"},null,-1)),en={class:"p-2"},tn={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},sn={class:"border mb-1 p-1"},on={class:"me"},an=be(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),nn={key:0},ln={key:1},rn={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},dn={class:"d-flex center justify-content-center"},cn={key:1,class:"bi bi-arrow-down text-secondary"},un=be(()=>e("div",{style:{width:"30px"}},null,-1)),pn={key:3,class:"bi bi-arrow-up text-secondary"},_n={class:"border mb-1 p-1"},mn={class:"me"},vn=be(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),hn={key:0},gn={key:1},yn={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},de=5,fn=D({__name:"HistoryDropdown",emits:[],setup(c,{emit:u}){const t=K(),n=M(!1),l=C(()=>n.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=C(()=>[...t.history.undo].reverse().slice(0,de)),g=C(()=>t.history.redo.slice(Math.max(t.history.redo.length-de,0)));return Q(()=>t.onUndo,()=>{console.log("changed"),n.value=!0,setTimeout(()=>n.value=!1,100)}),(b,_)=>m.value.length||g.value.length?(s(),T(se,{key:0},{button:x(()=>[k(E,{message:"dropdown.history.info"},{default:x(()=>[e("div",{class:"d-flex sb flash",style:q([{"font-size":"14px"},l.value])},[Ja,e("div",null,f(b.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:x(()=>[e("div",en,[i(t).history.redo.length>de?(s(),o("div",tn," + "+f(i(t).history.redo.length-de),1)):y("",!0),(s(!0),o(z,null,B(g.value,p=>(s(),o("div",sn,[e("span",on,f(new Date(p.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),an,p.tags?(s(),o("span",nn,f(p.tags)+" "+f(b.$t("dropdown.history.tags")),1)):y("",!0),p.values?(s(),o("span",ln,f(p.values)+" "+f(b.$t("dropdown.history.values")),1)):y("",!0)]))),256)),e("div",rn,[e("div",dn,[m.value.length?(s(),T(E,{key:0,message:"dropdown.history.undo"},{default:x(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:_[0]||(_[0]=(...p)=>i(t).undo&&i(t).undo(...p))})]),_:1})):(s(),o("div",cn)),un,g.value.length?(s(),T(E,{key:2,message:"dropdown.history.redo"},{default:x(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:_[1]||(_[1]=(...p)=>i(t).redo&&i(t).redo(...p))})]),_:1})):(s(),o("div",pn))])]),(s(!0),o(z,null,B(m.value,p=>(s(),o("div",_n,[e("span",mn,f(new Date(p.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),vn,p.tags?(s(),o("span",hn,f(p.tags)+" "+f(b.$t("dropdown.history.tags")),1)):y("",!0),p.values?(s(),o("span",gn,f(p.values)+" "+f(b.$t("dropdown.history.values")),1)):y("",!0)]))),256)),i(t).history.undo.length>de?(s(),o("div",yn," + "+f(i(t).history.undo.length-de),1)):y("",!0)])]),_:1})):y("",!0)}});const bn=A(fn,[["__scopeId","data-v-ba1876b2"]]),Ve=c=>(W("data-v-6c701a49"),c=c(),Y(),c),$n=Ve(()=>e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)),kn=Ve(()=>e("span",{class:"bi bi-check2-all text-success"},null,-1)),xn=Ve(()=>e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)),wn=D({__name:"ToggleReload",emits:[],setup(c,{emit:u}){const t=ie(),n=C(()=>t.getTab().autoReload?2:t.getTabManager().collection.state.isDirty?0:1);function l(){n.value==0?t.getTabManager().collection.update():n.value==1?(t.getTab().autoReload=!0,t.updateTabs()):(t.getTab().autoReload=!1,t.updateTabs())}return(m,g)=>(s(),o("div",{class:"bb font",onClick:l,style:{width:"26px",height:"30px",overflow:"hidde"}},[n.value==0?(s(),T(E,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:x(()=>[$n]),_:1})):y("",!0),n.value==1?(s(),T(E,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:x(()=>[kn]),_:1})):y("",!0),n.value==2?(s(),T(E,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:x(()=>[xn]),_:1})):y("",!0)]))}});const In=A(wn,[["__scopeId","data-v-6c701a49"]]),me=c=>(W("data-v-46bf201d"),c=c(),Y(),c),Sn={class:"d-flex flex-row p-2"},Cn=me(()=>e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Mn=["placeholder"],Vn={class:"me-5 d-flex"},Fn=me(()=>e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Tn={class:"ms-5",style:{"font-size":"13px"}},En=["checked"],zn=me(()=>e("span",{class:"ms-1"},"Mode Image unique",-1)),Pn={class:"ms-4"},On=me(()=>e("div",{class:"flex-grow-1"},null,-1)),Dn=me(()=>e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)),Ln={class:"d-flex flex-wrap content-container ps-2"},Gn=D({__name:"ContentFilter",props:{tab:ot,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(c,{emit:u}){const t=c,n=M(""),l=C(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=C(()=>l.value.length);function g(r){const a=r.target.checked;t.tab.collection.groupManager.setSha1Mode(a,!0)}function b(){n.value=t.tab.state.filterState.query}function _(){t.tab.collection.filterManager.setQuery(n.value),t.tab.collection.filterManager.update(!0)}function p(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return ue(b),Q(()=>t.tab.collection.filterManager.state.query,b),(r,a)=>(s(),o(z,null,[e("div",Sn,[k(E,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:x(()=>[e("div",{class:U(["d-flex flex-row search-input me-5",n.value?"border-primary":""])},[Cn,pe(e("input",{type:"text",class:"input-hidden",placeholder:r.$t("main.menu.search"),"onUpdate:modelValue":a[0]||(a[0]=d=>n.value=d),onChange:_},null,40,Mn),[[ye,n.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:p},"x")],2)]),_:1}),e("div",Vn,[k(E,{message:"main.menu.grid_tooltip"},{default:x(()=>[e("i",{class:U("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:a[1]||(a[1]=d=>t.tab.state.display="tree")},null,2)]),_:1}),k(E,{message:"main.menu.table_tooltip"},{default:x(()=>[e("i",{id:"toot",class:U("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:a[2]||(a[2]=d=>t.tab.state.display="grid")},null,2)]),_:1}),k(E,{message:"main.menu.graph_tooltip"},{default:x(()=>[e("i",{id:"toot",class:U("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:a[3]||(a[3]=d=>t.tab.state.display="graph")},null,2)]),_:1})]),k(E,{message:"main.menu.image_size_tooltip",click:!1},{default:x(()=>[Fn]),_:1}),e("div",null,[k(at,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":a[4]||(a[4]=d=>t.tab.state.imageSize=d)},null,8,["modelValue"])]),e("div",Tn,[k(E,{message:"main.menu.image_mode_tooltip"},{default:x(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:g},null,40,En),zn]),_:1})]),e("div",Pn,[k(bn)]),m.value?(s(),T(nt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":l.value,"onRemove:selected":a[5]||(a[5]=d=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0),On,k(E,{message:"main.menu.issue",class:"bb"},{default:x(()=>[Dn]),_:1})]),e("div",Ln,[k(In,{class:"me-1"}),k(ca,{manager:t.tab.collection.filterManager},null,8,["manager"]),k(Ha,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),k(Za,{manager:t.tab.collection.sortManager},null,8,["manager"])])],64))}});const Rn=A(Gn,[["__scopeId","data-v-46bf201d"]]),jn={class:""},An=["src"],Nn={class:"d-flex flex-row"},Hn=D({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(c,{emit:u}){const t=Me(),n=c,l=u,m=C(()=>`width: ${n.size}px; height: ${n.size}px;`),g=C(()=>`max-width: ${n.size-2}px; max-height: ${n.size-1}px;`),b=C(()=>n.pile.images[0]);return(_,p)=>(s(),o("div",jn,[k(lt,{image:b.value},{default:x(()=>[e("div",{style:q(m.value),class:"img-container",onClick:p[0]||(p[0]=r=>i(t).showModal(i(le).IMAGE,{image:b.value}))},[e("img",{src:b.value.url,style:q(g.value)},null,12,An)],4)]),_:1},8,["image"]),e("div",Nn,[k(E,{message:"main.recommand.accept"},{default:x(()=>[e("div",{style:q(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=r=>l("accept",b.value))}," ✓ ",4)]),_:1}),k(E,{message:"main.recommand.refuse"},{default:x(()=>[e("div",{style:q(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=r=>l("refuse",b.value))}," ✕ ",4)]),_:1})])]))}});const Un=A(Hn,[["__scopeId","data-v-6540ad86"]]),ve=c=>(W("data-v-8f1f076a"),c=c(),Y(),c),Bn={class:"reco-container"},qn={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Kn=ve(()=>e("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),Qn=[Kn],Wn=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),Yn=ve(()=>e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Xn=[Yn],Zn=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),Jn={key:0,class:"bi bi-funnel-fill bb text-primary"},el={key:1,class:"bi bi-funnel bb"},tl=ve(()=>e("div",{class:"b-left pe-1"},null,-1)),sl={class:"text-secondary me-2"},ol={class:"flex-grow-1"},al={class:"d-flex flex-row"},nl={key:0,class:"separator"},ll={class:"d-flex flex-row"},ke=10,il=D({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(c,{emit:u}){const t=ie(),n=K(),l=it(),m=c,g=u,b=M(1),_=ce([]),p=ce([]),r=ce([]),a=ce(new Set),d=M(!0);function h(V){let w=p.indexOf(V);w<0||(p.splice(w,1),S())}async function $(V){const w=[],I=[];r.forEach(G=>{if(G.value!=null){const R=n.properties[G.propertyId];let P=G.value;R.type==F.multi_tags?(P=V.properties[G.propertyId]??[],P=[...P,G.value]):R.type==F.tag&&(P=[P]),R.mode==Ie.id?I.push({instanceId:V.id,propertyId:R.id,value:P}):w.push({propertyId:R.id,sha1:V.sha1,value:P})}}),await n.setPropertyValues(I,w),h(V.sha1)}function v(V){a.add(V.sha1),h(V.sha1)}function S(){_.length=0;const V=p.map(w=>({sha1:w,images:n.sha1Index[w]}));L(V,_,b.value,m.imageSize,m.width)}function L(V,w,I,G,R){let P=R,O=[],j=0;for(let J=0;J<V.length&&!(w.length>=I);J++){let oe=V[J];if(a.has(oe.sha1))continue;let he=G+ke;if(j+he<P){O.push(oe),j+=he;continue}if(O.length==0)throw new Error("Images seems to be to big for the line");w.push(O),w.length<I&&(O=[oe],j=he)}O.length>0&&w.length<I&&w.push(O)}async function H(){if(!m.group)return;console.log("get reco");const V=m.group.images.map(O=>O.id);let w=await l.getSimilarImages({instanceIds:V});if(console.log(w),!w.instances)throw new Error("No instances in ActionResult");let I=[];const G=w.instances.scores??[];if(w.instances.ids)for(let O in w.instances.ids){const j={id:w.instances.ids[O],score:G[O]};I.push(j)}else for(let O in w.instances.sha1s){const j=w.instances.sha1s[O];for(let J of n.sha1Index[j]){const oe={id:J.id,score:G[O]};I.push(oe)}}if(I.sort((O,j)=>j.score-O.score),d.value){const O=t.getTabManager(),j=new Set(O.collection.groupManager.result.root.images.map(J=>J.id));I=I.filter(J=>j.has(J.id))}const R=Array.from(new Set(I.map(O=>n.instances[O.id].sha1)));r.length=0;let P=m.group;for(;P;)r.push(...P.meta.propertyValues),P=P.parent;p.length=0,p.push(...R),a.clear(),S(),g("update")}function Z(){d.value=!d.value}return ue(H),Q(()=>m.group,()=>{H(),a.clear()}),Q(()=>m.imageSize,S),Q(()=>m.width,S),Q(d,H),(V,w)=>(s(),o("div",Bn,[e("div",qn,[e("div",{class:"text-secondary pe-1",onClick:w[0]||(w[0]=I=>g("close"))},Qn),Wn,e("div",{class:"text-secondary pe-1",onClick:w[1]||(w[1]=I=>g("scroll",m.group.id))},Xn),Zn,e("div",{class:"text-secondary pe-1",onClick:Z},[d.value?(s(),o("span",Jn)):(s(),o("span",el))]),tl,k(E,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:x(()=>[e("span",sl,f(V.$t("main.recommand.title")),1)]),_:1}),e("div",ol,[e("div",al,[(s(!0),o(z,null,B(r,(I,G)=>(s(),o(z,null,[k(rt,{class:"",value:I},null,8,["value"]),G<r.length-1?(s(),o("div",nl)):y("",!0)],64))),256))])])]),e("div",{style:q("margin-left:"+ke+"px;")},[(s(!0),o(z,null,B(_,I=>(s(),o("div",null,[e("div",ll,[(s(!0),o(z,null,B(I,G=>(s(),T(Un,{pile:G,size:m.imageSize,onAccept:$,onRefuse:v,style:q("margin-right:"+ke+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const rl=A(il,[["__scopeId","data-v-8f1f076a"]]);const dl={style:{display:"flex"}},cl={class:"info"},ul=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1),pl={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:F},height:String},setup(c){const u=c,t=M(0),n=M(!1),l={};Object.keys(u.chartData.series).forEach(a=>{l[a]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:u.chartData.dataType===F.date?"datetime":"numeric",categories:u.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:a,seriesIndex:d,dataPointIndex:h,w:$}){const v=u.chartData.series[d].data[h];let S='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';v.images.forEach((H,Z)=>{Z<10&&(S+=`<div style="width: 75px; height: 75px;"><img src="${H}" style="width: 100%; height: 100%;" /></div>`)}),S+="</div>";let L=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${u.chartData.series[d].name} — </b> ${v.y} Images</span>`;return L+=`<div>${S}</div>`,L}}}),g=()=>{m.value.chart.stacked=!m.value.chart.stacked,n.value=!n.value,t.value+=1},b=()=>{let a;m.value.chart.type==="area"?a={chart:{...m.value.chart,type:"bar"}}:a={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...a},t.value+=1},_=(a,d,h)=>{const v=u.chartData.series[d];let S=Math.max(...v.data.map(L=>L.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(L=>L.remove()),l[d]){l[d]=!1;return}v.data.forEach((L,H)=>{const V=Math.floor(L.y/S*17),w=L.images.slice(0,V),I=`circle[index="${d}"][j="${H}"]`,G=document.querySelector(I),R=parseFloat(G.getAttribute("cx"));w.forEach((P,O)=>{const j=document.createElement("img");j.src=P,j.width=40,j.height=40,j.style.position="absolute";let J=R+40/1.5,oe=65+O*40;j.style.left=`${J}px`,j.style.bottom=`${oe}px`,j.classList.add("apexcharts-custom-image"),j.addEventListener("mouseover",he=>p(J,oe,P)),j.addEventListener("mouseout",r),a.el.appendChild(j)})}),Object.keys(l).forEach(L=>l[L]=!1),l[d]=!0};function p(a,d,h){const $=document.getElementById("zoomed-image");$.style.left=`${a+120*1.5}px`,$.src=h,$.style.bottom=`${d}px`,$.style.display="block"}function r(){const a=document.getElementById("zoomed-image");a.style.display="none"}return console.log("test"),(a,d)=>{const h=Ce("apexchart");return s(),o(z,null,[e("div",dl,[e("button",{class:"mt-2",onClick:b},f(m.value.chart.type==="area"?a.$t("main.graph-view.histo"):a.$t("main.graph-view.curve")),1),u.chartData.series.length>1?(s(),o("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:g},f(n.value?a.$t("main.graph-view.over"):a.$t("main.graph-view.stack")),1)):y("",!0)]),(s(),T(h,{style:{position:"relative"},key:t.value,height:u.height,type:m.value.chart.type,options:m.value,series:u.chartData.series,onLegendClick:_},null,8,["height","type","options","series"])),e("i",cl,f(a.$t("main.graph-view.info")),1),ul],64)}}},_l={key:1},ml=D({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(c,{emit:u}){const t=K(),n=c,l=M(""),m=M(b());function g(){const _=new Set;let p=n.collection.groupManager.getGroupIterator();for(;p;){const r=p.group;if(console.log(r.id),r.id==="root"){p=p.nextGroup();continue}for(let a of r.children)_.add(a.meta.propertyValues[0].value);r.children.forEach(()=>p=p.nextGroup()),p=p.nextGroup()}return _}function b(){const _={};let p,r=n.collection.groupManager.state.groupBy;if(r.length===0){l.value="Choose at least one date or numeric value to group the images by";return}const a=t.properties[r[0]],d=a.type;if(r.length>2){l.value="Only max two levels of grouping are supported";return}else r.length===1?_[a.name]={name:a.name,data:[]}:p=Array.from(g());if(d!==F.number&&d!==F.date){l.value="First level of grouping needs to be a date or a numeric property";return}let h=n.collection.groupManager.getGroupIterator();const $=[];for(;h;){const v=h.group;if(v.id==="root"){h=h.nextGroup();continue}let S=v.meta.propertyValues[0];const L=d===F.date?S.value.getTime():S.value;if($.push(L),a.name in _)_[a.name].data.push({x:L,y:v.images.length,images:v.images.slice(0,20).map(H=>H.url)});else{const H=v.children.map(V=>V.meta.propertyValues[0].value),Z=p.filter(V=>!H.includes(V));for(let V of v.children){const w=V.meta.propertyValues[0].value;if(_[w]===void 0){let I=w;w in t.tags&&(I=t.tags[w].value),_[w]={data:[],name:I}}_[V.meta.propertyValues[0].value].data.push({x:L,y:V.images.length,images:V.images.slice(0,20).map(I=>I.url)})}for(let V of Z){if(_[V]===void 0){let w=V;V in t.tags&&(w=t.tags[V].value),_[V]={data:[],name:w}}_[V].data.push({x:L,y:0,images:[]})}v.children.forEach(()=>h=h.nextGroup())}h=h.nextGroup()}return l.value="",{series:Object.values(_),xValues:$,dataType:d}}return n.collection.groupManager.onChange.addListener(()=>m.value=b()),(_,p)=>(s(),o("div",{class:"",style:q({height:n.height+"px"})},[l.value===""?(s(),T(pl,{key:0,chartData:m.value,height:n.height-50+"px"},null,8,["chartData","height"])):(s(),o("span",_l,f(l.value),1))],4))}}),vl={key:0,class:"m-0 p-0"},hl={key:0,style:{"margin-left":"10px"}},gl=D({__name:"MainView",props:{tabId:Number,height:Number},setup(c){const u=ie(),t=u.getTabManager(),n=c,l=M({}),m=M(null),g=M(null),b=M(null),_=M(0),p=M(0),r=ce({groups:!1}),a=C(()=>t.getVisibleProperties());function d(){m.value&&g.value?_.value=n.height-m.value.clientHeight-g.value.clientHeight-5:m.value?_.value=n.height-m.value.clientHeight-5:_.value=0}t.collection.groupManager.onChange.addListener(()=>{b.value&&t.state.display=="tree"&&b.value.computeLines()});function h(v){l.value=t.collection.groupManager.result.index[v],ae(()=>d())}function $(){l.value={},ae(()=>d())}return ue(()=>{p.value=m.value.clientWidth,window.addEventListener("resize",()=>{ae(()=>{var v;p.value=((v=m.value)==null?void 0:v.clientWidth)??p.value})})}),Q(()=>t.state.imageSize,()=>ae(d)),Q(()=>n.height,async()=>{await ae(d)}),Q(t.state,v=>{u.updateTabs()},{deep:!0}),(v,S)=>(s(),o(z,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:m},[k(Rn,{tab:i(t),"compute-status":r},null,8,["tab","compute-status"])],512),e("div",{ref_key:"boxElem",ref:g,class:"m-0 p-0"},[l.value.id?(s(),o("div",vl,[k(rl,{group:l.value,"image-size":i(t).state.imageSize,width:p.value,height:50,onClose:$,onScroll:b.value.scrollTo,onUpdate:S[0]||(S[0]=L=>ae(()=>d()))},null,8,["group","image-size","width","onScroll"])])):y("",!0)],512),p.value>0&&_.value>0?(s(),o("div",hl,[i(t).state.display=="tree"?(s(),T(dt,{key:0,"group-manager":i(t).collection.groupManager,"image-size":i(t).state.imageSize,height:_.value-0,properties:a.value,"hide-if-modal":!0,"selected-images":i(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,width:p.value-25,onRecommend:h},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),i(t).state.display=="grid"?(s(),o("div",{key:1,style:q({width:p.value-12+"px"}),class:"p-0 m-0 grid-container"},[k(ct,{manager:i(t).collection.groupManager,height:_.value-15,width:p.value-40,"selected-properties":a.value,class:"p-0 m-0","show-images":!0,"selected-images":i(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):y("",!0),i(t).state.display=="graph"?(s(),T(ml,{key:2,collection:i(t).collection,height:_.value-15},null,8,["collection","height"])):y("",!0)])):y("",!0)],64))}});const yl=A(gl,[["__scopeId","data-v-3614dcc8"]]),fl={class:"d-flex d-row",style:{cursor:"pointer"}},bl=["onMouseenter","onMouseleave"],$l=["onClick"],kl=["onClick"],xl=["onClick"],wl=["onSubmit"],Il=["onKeydown","onUpdate:modelValue"],Sl=e("span",{class:"bi bi-plus"},null,-1),Cl=[Sl],Ml={class:"lang"},Vl=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),Fl=["value"],Tl=D({__name:"TabNav",props:{reRender:Function},setup(c){const u=ie(),t=M(-1),n=M(""),l=M(null),m=c;function g(h){u.data.selectedTabId==h||_(),u.selectTab(h)}function b(h){t.value=h,n.value=u.data.tabs[h].name,ae(()=>l.value[0].focus())}function _(){t.value=-1,n.value=""}function p(h){u.addTab("New Tab")}async function r(h){confirm("Are you sure to delete Tab: "+h.name)&&await u.removeTab(h.id)}const a=ce({});M(-1);const d=["fr","en"];return(h,$)=>(s(),o("nav",null,[e("div",fl,[(s(!0),o(z,null,B(i(u).data.tabs,v=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:S=>a[v.id]=!0,onMouseleave:S=>a[v.id]=!1},[t.value!=v.id?(s(),o(z,{key:0},[k(E,{message:"main.menu.rename_tab_tooltip"},{default:x(()=>[e("i",{onClick:S=>b(v.id),class:U(["bi bi-pencil me-1 tab-icon hover-light",a[v.id]&&i(u).data.selectedTabId==v.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,$l)]),_:2},1024),e("div",{class:U(["tab-button",v.id==i(u).data.selectedTabId?" active":""]),onClick:S=>g(v.id)},[e("span",null,f(v.name),1)],10,kl),k(E,{message:"main.menu.delete_tab_tooltip"},{default:x(()=>[e("i",{onClick:S=>r(v),class:U(["btn-icon bi bi-x tab-icon hover-light",a[v.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,xl)]),_:2},1024)],64)):(s(),o("div",{key:1,class:U(["tab-button",v.id==i(u).data.selectedTabId?" active":""])},[e("form",{onSubmit:Le(_,["stop","prevent"])},[pe(e("input",{onFocusout:_,onKeydown:ut(_,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":S=>v.name=S,ref_for:!0,ref_key:"inputElem",ref:l},null,40,Il),[[ye,v.name]])],40,wl)],2))],40,bl))),256)),k(E,{message:"main.menu.add_tab_tooltip"},{default:x(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:p,id:"add-tab-button"},Cl)]),_:1}),e("div",Ml,[Vl,pe(e("select",{"onUpdate:modelValue":$[0]||($[0]=v=>h.$i18n.locale=v),onChange:$[1]||($[1]=v=>m.reRender())},[(s(),o(z,null,B(d,(v,S)=>e("option",{key:`Lang${S}`,value:v},f(v.toUpperCase()),9,Fl)),64))],544),[[pt,h.$i18n.locale]])])])]))}});const je=c=>(W("data-v-c4d939dc"),c=c(),Y(),c),El={class:"d-flex flex-row m-0 p-0 overflow-hidden"},zl={class:"w-100"},Pl={key:0,class:"custom-hr"},Ol={key:1,class:"loading"},Dl={class:"text-center"},Ll={key:2,class:"loading"},Gl=je(()=>e("i",{class:"spinner-border",role:"status"},null,-1)),Rl=je(()=>e("span",{class:"ms-1"},"Loading...",-1)),jl=[Gl,Rl],Al=D({__name:"PanopticView",setup(c){const u=ie(),t=K(),n=Me(),l=M(null),m=M(null),g=M(window.innerHeight),b=M(!1),_=C(()=>{var v;return g.value-(((v=m.value)==null?void 0:v.clientHeight)??0)}),p=C(()=>{var v;return(v=l.value)==null?void 0:v.filteredImages.map(S=>S.id)});let r=navigator.userAgent.indexOf("Mac OS X")!==-1;ue(async()=>{n.isProjectLoaded||Ee.push("/"),ae(()=>{window.addEventListener("resize",a),a()}),window.addEventListener("keydown",v=>{v.key=="Control"&&(N.ctrl=!0),v.key=="Alt"&&(r&&(N.ctrl=!0),N.alt=!0),v.key=="Shift"&&(N.shift=!0),v.key=="ArrowLeft"&&(N.left=!0),v.key=="ArrowRight"&&(N.right=!0,console.log("keeeyy")),v.key=="Z"&&N.ctrl&&t.redo(),v.key=="z"&&N.ctrl&&t.undo()}),window.addEventListener("keyup",v=>{v.key=="Control"&&(N.ctrl=!1),v.key=="Alt"&&(r&&(N.ctrl=!1),N.alt=!1),v.key=="Shift"&&(N.shift=!1),v.key=="ArrowLeft"&&(N.left=!1),v.key=="ArrowRight"&&(N.right=!1)}),window.addEventListener("mousemove",v=>{N.ctrl=v.ctrlKey,N.alt=v.altKey,N.shift=v.shiftKey,r&&(N.ctrl=N.ctrl||N.alt)})}),_t(()=>{window.removeEventListener("resize",a)});function a(){g.value=window.innerHeight,b.value=!0}function d(){n.showModal(le.EXPORT,p)}function h(){u.rerender()}function $(){Ee.push("/")}return(v,S)=>(s(),o(z,null,[k(mt,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:i(u).status.renderNb},[e("div",El,[i(u).status.loaded?(s(),o(z,{key:0},[e("div",null,[k(oo,{onExport:S[0]||(S[0]=L=>d())})]),e("div",zl,[e("div",{class:"ms-3",ref_key:"navElem",ref:m},[k(Tl,{"re-render":h})],512),b.value?(s(),o("div",Pl)):y("",!0),k(yl,{"tab-id":i(u).data.selectedTabId,height:_.value,ref_key:"mainViewRef",ref:l},null,8,["tab-id","height"])])],64)):i(n).isProjectLoaded?(s(),o("div",Ll,jl)):(s(),o("div",Ol,[e("div",Dl,[e("div",null,f(v.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:$,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Ul=A(Al,[["__scopeId","data-v-c4d939dc"]]);export{Ul as default};
