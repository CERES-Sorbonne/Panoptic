import{d as O,Q as Ge,u as ue,S as de,z as K,r as M,c as T,V as q,o as t,a as n,b as e,F as E,q as _,W as ce,t as x,h as f,k as C,w as fe,v as _e,e as d,X as Te,M as oe,l as b,Y as F,Z as $e,$ as ve,n as H,O as W,a0 as Ce,i as ee,s as j,D as te,a1 as je,_ as U,a2 as Ne,a3 as Ie,a4 as Ee,f as X,a5 as he,a6 as Me,m as J,G as He,a7 as pe,a8 as Pe,j as Z,g as we,a9 as We,aa as qe,ab as ze,ac as Ke,ad as Qe,J as Ye,ae as Xe,af as Ze,K as Je,R as et,L as tt,ag as st,ah as ot,ai as Oe,aj as Le,ak as at,al as ne,am as se,an as nt,ao as lt,ap as it,aq as rt,ar as ut,as as dt,at as me,au as Ve,av as pt,aw as ct,ax as mt,ay as vt,az as gt,aA as ft,aB as _t,p as Fe,A as B}from"./index-488c8ad8.js";import{_ as yt}from"./Tutorial-6a2dd607.js";const ge={},bt={class:"d-flex flex-row"},ht={key:2,class:"d-flex",style:{width:"150px"}},kt={class:"flex-grow-1"},xt={key:1,style:{"padding-top":"1px"}},$t={style:{width:"20px","margin-top":"2px"},class:"text-center"},wt={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},St={key:0},Ct={key:0,class:"ms-3 pt-1"},It={class:"options hover-light"},Vt={class:"p-1",style:{"min-width":"100px"}},Mt={key:1,class:"custom-hr mt-1 mb-1"},zt=["onClick"],Ft={key:1},Gt=O({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(h){const{t:p}=Ge({useScope:"global"}),s=ue();de();const a=K(),o=h,m=M(!1),c=M(!1),y=M(""),v=M(!1),i=T(()=>o.tab.state.visibleProperties[o.property.id]==!0),l=T(()=>o.tab.collection.filterManager.state.filter.filters.some(S=>!S.isGroup&&S.propertyId==o.property.id)),r=T(()=>o.tab.collection.groupManager.state.groupBy.includes(o.property.id)),u=T(()=>o.tab.collection.sortManager.state.sortBy.includes(o.property.id)),g=T(()=>{if(l.value)return o.tab.collection.filterManager.state.filter.filters.find(S=>!S.isGroup&&S.propertyId==o.property.id).id}),w=()=>o.tab.collection.filterManager,D=T(()=>o.tab.getSha1Mode());function A(){i.value?o.tab.setVisibleProperty(o.property.id,!1):o.tab.setVisibleProperty(o.property.id,!0)}function I(){o.open&&(m.value?m.value=!1:(m.value=!0,y.value=o.property.name),c.value=!1)}function k(){o.property.type!=W.tag&&o.property.type!=W.multi_tags||(c.value?c.value=!1:c.value=!0,m.value=!1)}function G(){u.value?o.tab.collection.sortManager.delSort(o.property.id):o.tab.collection.sortManager.setSort(o.property.id),o.tab.collection.sortManager.update(!0)}function L(){r.value?o.tab.collection.groupManager.delGroupOption(o.property.id):o.tab.collection.groupManager.setGroupOption(o.property.id),o.tab.collection.groupManager.update(!0)}function P(){confirm(p("common.properties.delete")+": "+o.property.name+" ?   "+o.property.id)&&a.deleteProperty(o.property.id)}async function Q(){y.value!=""&&(await a.updateProperty(o.property.id,y.value),I())}function R(){const S=w();l.value?(S.deleteFilter(g.value),ge.filter.hide()):(S.addNewFilter(o.property.id),ge.filter.show())}function z(S){a.updateProperty(o.property.id,o.property.name,S)}return q(()=>o.property,()=>{m.value=!1}),(S,$)=>(t(),n("div",{class:H(v.value?"hover-light":"")},[e("div",bt,[o.open?(t(),n(E,{key:0},[m.value?f("",!0):(t(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:I},[_(ce,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=V=>v.value=!0),onMouseleave:$[1]||($[1]=V=>v.value=!1)},null,8,["type"]),e("span",null,x(o.property.name),1)]))],64)):(t(),C(ce,{key:1,type:o.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),m.value&&o.open?(t(),n("div",ht,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:I,onMouseenter:$[2]||($[2]=V=>v.value=!0),onMouseleave:$[3]||($[3]=V=>v.value=!1)},null,32)]),e("div",kt,[o.property.id>=0?fe((t(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=V=>y.value=V),onChange:Q},null,544)),[[_e,y.value]]):(t(),n("span",xt,[_(ce,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(o.property.name),1)]))])])):f("",!0),o.open?(t(),n(E,{key:3},[d(Te)(o.property.type)?(t(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=V=>d(s).showModal(d(oe).TAG,{propId:o.property.id}))},[_(F,{click:!1,message:"main.nav.properties.open_tags"},{default:b(()=>$[8]||($[8]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",$t,[o.property.mode==d($e).id?(t(),C(F,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:b(()=>$[9]||($[9]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:A,class:"btn-icon text-center"},[D.value&&o.property.mode==d($e).id?(t(),C(F,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:b(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=ve(()=>{},["stop"]))})]),_:1})):(t(),C(F,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:b(()=>[e("span",{class:H("bi bi-eye text-"+(i.value?"primary":"secondary"))},null,2)]),_:1}))]),o.open?(t(),n("div",wt,[o.property.type==d(W).tag||o.property.type==d(W).multi_tags?(t(),n("div",{key:0,onClick:k,style:{cursor:"pointer"}},[c.value?(t(),C(F,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:b(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(t(),C(F,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:b(()=>$[11]||($[11]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),o.open?(t(),n("div",St,[m.value?(t(),n("div",Ct,[S.property.id!=d(Ce).folders?(t(),n("div",{key:0,class:H(["options hover-light",l.value?" text-primary":""]),onClick:R},[e("div",null,[$[12]||($[12]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ee(x(S.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:H(["options hover-light",u.value?" text-primary":""]),onClick:G},[$[13]||($[13]=e("i",{class:"bi bi-filter me-2"},null,-1)),ee(x(S.$t("main.menu.sort.title")),1)],2),e("div",{class:H(["options hover-light",r.value?" text-primary":""]),onClick:L},[$[14]||($[14]=e("i",{class:"bi bi-collection me-2"},null,-1)),ee(x(S.$t("main.menu.groupby")),1)],2),o.property.id>=0?(t(),n("div",{key:1,class:"options hover-light",onClick:P},[$[15]||($[15]=e("i",{class:"bi bi-trash me-2"},null,-1)),ee(x(S.$t("main.nav.properties.delete_property")),1)])):f("",!0),o.property.id>=0&&d(a).propertyGroupsList.length?(t(),C(te,{key:2,teleport:!0},{button:b(()=>[e("div",It,[$[16]||($[16]=e("i",{class:"bi bi-folder me-1"},null,-1)),ee(" "+x(S.$t("main.nav.properties.set_group")),1)])]),popup:b(()=>[e("div",Vt,[o.property.propertyGroupId&&d(a).propertyGroups[o.property.propertyGroupId]?(t(),n("div",{key:0,class:"bb",onClick:$[7]||($[7]=V=>z(null))},"None")):f("",!0),o.property.propertyGroupId&&d(a).propertyGroups[o.property.propertyGroupId]?(t(),n("div",Mt)):f("",!0),(t(!0),n(E,null,j(d(a).propertyGroupsList,V=>(t(),n("div",{class:"bb",onClick:N=>z(V.id)},x(V.name),9,zt))),256))])]),_:1})):f("",!0)])):c.value?(t(),n("div",Ft,[_(je,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}});const Se=U(Gt,[["__scopeId","data-v-f4c9ce19"]]),Tt={class:"text-nowrap"},Et=["onClick"],Pt=["onClick"],Ot=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(h){const p=K(),s=h;function a(){p.reImportFolder(s.folder.id)}function o(){confirm(Ne.global.t("main.nav.folders.del_alert"))&&p.deleteFolder(s.folder.id)}return(m,c)=>(t(),C(te,{teleport:!0},{button:b(()=>c[0]||(c[0]=[e("i",{class:"bi bi-three-dots base-hover"},null,-1)])),popup:b(({hide:y})=>[e("div",Tt,[e("div",{class:"p-2 bb",onClick:v=>{a(),y()}},c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ee("Re import")]),8,Et),c[3]||(c[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:v=>{o(),y()}},[c[2]||(c[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),ee(x(m.$t("main.nav.folders.del")),1)],8,Pt)])]),_:1}))}}),Lt=["onMouseenter"],Dt={style:{display:"inline"}},Rt=["onClick"],At={class:"text-secondary"},Ut=["onClick"],Bt=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0}},setup(h){const p=K(),s=h,a=M(null),o=T(()=>{let l={};const r=new Set(s.filterManager.state.folders);return s.folders.map(u=>u.id).forEach(u=>{r.has(u)&&(l[u]=!0)}),l}),m=T(()=>{let l={};return s.folders.map(r=>r.id).forEach(r=>{s.visibleFolders[r]&&(l[r]=!0)}),l}),c=T(()=>{let l={};return s.folders.forEach(r=>{let u=[];o.value[r.id]&&u.push("selected"),l[r.id]=u.join(" ")}),l});function y(l){let r=s.visibleFolders;r[l]?delete r[l]:r[l]=!0}function v(l){let r=new Set(s.filterManager.state.folders);const u=r.has(l),g=p.folders[l].parent!=null&&r.has(p.folders[l].parent);u&&!g?(r.delete(l),he(l).forEach(w=>r.delete(w.id))):(i(l,r),r.add(l),he(l).forEach(w=>r.add(w.id)),Me(p.folders[l]).forEach(w=>r.delete(w.id))),s.filterManager.setFolders(Array.from(r)),s.filterManager.update(!0)}function i(l,r){const u=Me(p.folders[l]);let g;for(let w of u)if(r.has(w.id))g=w;else break;g!=null&&he(g.id).forEach(w=>r.delete(w.id))}return(l,r)=>{const u=Ee("FolderList2",!0);return t(),n("ul",{class:H(s.root?"tree":""),style:X(s.root?"padding-left:0px;":"")},[(t(!0),n(E,null,j(h.folders,g=>(t(),n("li",{style:X(s.root?"padding-left:0px;":""),class:"no-break",onMouseenter:w=>a.value=g.id,onMouseleave:r[0]||(r[0]=w=>a.value=null)},[e("div",Dt,[e("summary",{class:H(c.value[g.id]),onClick:w=>v(g.id)},[ee(x(g.name)+" ",1),e("span",At,x(d(p).folders[g.id].count),1)],10,Rt)]),g.children&&g.children.length>0?(t(),n("i",{key:0,onClick:w=>y(g.id),class:H("bi bi-chevron-"+(m.value[g.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ut)):f("",!0),e("span",{class:H(a.value===g.id?"visible-option":"invisible-option")},[_(Ot,{folder:g,style:{display:"inline-block"}},null,8,["folder"])],2),g.children&&g.children.length>0&&m.value[g.id]?(t(),C(u,{key:1,folders:g.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,Lt))),256))],6)}}});const jt=U(Bt,[["__scopeId","data-v-2aa7e825"]]),Nt={class:"text-center"},Ht={class:"w-100 text-center",style:{"font-size":"10px"}},Wt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},qt=O({__name:"TaskStatus",props:{task:{}},setup(h){const p=h,s=T(()=>p.task.total-p.task.remain-p.task.computing),a=T(()=>p.task.total);return(o,m)=>(t(),n("div",Nt,[ee(x(p.task.name)+" ",1),e("div",Ht,x(s.value)+" / "+x(a.value)+" "+x(o.$t("main.nav.tasks.done")),1),a.value>0?(t(),n("div",Wt,[e("div",{class:"progress-bar",style:X(`width: ${s.value/a.value*100}%`)},null,4)])):f("",!0)]))}}),Kt={class:"prop-container"},Qt={key:0},Yt={key:1},Xt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Zt={key:1,class:"ms-2"},Jt={key:0,class:"ps-1 pe-1 pt-1"},es={class:"property-item"},ts=O({__name:"PropertyGroup",props:{tab:{},group:{},menuOpen:{type:Boolean}},setup(h){const p=K(),s=h,a=M(!0),o=M(!1),m=M(""),c=T(()=>p.propertyList.filter(r=>r.propertyGroupId==s.group.id));function y(){a.value=!a.value}function v(r){p.updatePropertyGroup(s.group.id,m.value)}function i(){m.value=s.group.name}function l(){p.deletePropertyGroup(s.group.id)}return J(i),q(s,i),(r,u)=>(t(),n("div",Kt,[e("div",{class:"d-flex group-container",onClick:y},[a.value?(t(),n("div",Qt,u[3]||(u[3]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(t(),n("div",Yt,u[4]||(u[4]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),s.menuOpen?(t(),n(E,{key:2},[o.value?f("",!0):(t(),n("div",Xt,x(s.group.name),1)),o.value?(t(),n("div",Zt,[_(He,{"auto-focus":!0,modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=g=>m.value=g),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:v,onCancel:i,onBlur:u[1]||(u[1]=g=>o.value=!1)},null,8,["modelValue"])])):f("",!0),u[7]||(u[7]=e("div",{class:"flex-grow-1"},null,-1)),o.value?f("",!0):(t(),n("div",{key:2,class:"bb me-1",onClick:u[2]||(u[2]=ve(g=>o.value=!0,["stop"]))},u[5]||(u[5]=[e("i",{class:"bi bi-pencil"},null,-1)]))),e("div",{class:"bb me-1",onClick:ve(l,["stop"])},u[6]||(u[6]=[e("i",{class:"bi bi-x"},null,-1)]))],64)):f("",!0)]),a.value&&c.value.length?(t(),n("div",Jt,[(t(!0),n(E,null,j(c.value,g=>(t(),n("div",es,[_(Se,{tab:s.tab,property:g,open:s.menuOpen},null,8,["tab","property","open"])]))),256))])):f("",!0)]))}});const ss=U(ts,[["__scopeId","data-v-d485bd74"]]),De=O({__name:"TabContainer",props:{id:{}},setup(h){const p=pe(),s=h;let a;const o=M(!1);function m(){a=p.getTab(s.id),o.value=!0}return J(m),q(()=>s.id,async()=>{o.value=!1,await Z(),m()}),(c,y)=>o.value&&d(p).loaded?Pe(c.$slots,"default",{key:0,tab:d(a)}):f("",!0)}}),os={class:""},as={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ns={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ls={key:0,class:"bi bi-chevron-left"},is={key:1,class:"bi bi-chevron-right"},rs={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},us={class:"d-flex align-items-center"},ds={style:{"max-height":"300px",overflow:"auto"}},ps={key:0,id:"import"},cs={class:"pt-1 pb-2"},ms={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},vs={key:0,class:"ps-2 pe-2"},gs={class:"p-1"},fs={key:0,class:"custom-hr"},_s={class:"p-1 mt-0"},ys={key:0,class:"d-flex p-1"},bs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},hs={key:1,class:"bb me-1"},ks={class:"bb me-2"},xs={key:1,class:"mt-2"},$s={style:{"padding-left":"0px"}},ws={class:"ps-1 pe-1"},Ss={key:0,class:"property-item"},Cs={class:"p-2 mt-0"},Is={key:1,class:"mt-2"},Vs={key:0,class:"property-item"},Ms=200,zs=55,Fs=O({__name:"Menu",emits:["export","toggle"],setup(h,{emit:p}){const s=de(),a=K(),o=ue(),m=pe(),c=p,y=M(!1),v=M(!1),i=M(!0),l=T(()=>i.value?Ms:zs),r=T(()=>a.propertyList.filter(I=>I.id>=0&&(I.propertyGroupId===void 0||!a.propertyGroups[I.propertyGroupId]))),u=async I=>{o.showModal(oe.IMPORT)},g=T(()=>s.backendStatus.tasks.filter(I=>!I.done));function w(){o.showModal(oe.FOLDERSELECTION,{callback:D,mode:"images"})}function D(I){I&&a.addFolder(I)}function A(){i.value=!i.value,c("toggle")}return q(()=>s.status.import.to_import,()=>y.value=!0),(I,k)=>(t(),C(De,{id:d(m).mainTab},{default:b(({tab:G})=>{var L;return[e("div",{class:"menu overflow-scroll",style:X({width:l.value+"px"})},[e("div",os,[e("div",null,[e("div",as,[e("div",ns,[i.value?(t(),n(E,{key:0},[e("div",{class:"flex-grow-1 text-capitalize overflow-hidden",onClick:k[0]||(k[0]=()=>{})},x((L=d(o).data.status.selectedProject)==null?void 0:L.name),1),_(F,{message:"main.menu.close_project"},{default:b(()=>[e("div",{class:"base-hover p-1",onClick:k[1]||(k[1]=P=>d(o).closeProject())},k[7]||(k[7]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:k[2]||(k[2]=P=>d(o).showModal(d(oe).SETTINGS))},k[8]||(k[8]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:H(["base-hover p-1",i.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:A},[i.value?(t(),n("i",ls)):(t(),n("i",is))],2)])]),i.value?(t(),n(E,{key:0},[k[10]||(k[10]=e("div",{class:"custom-hr"},null,-1)),e("div",rs,[e("div",us,[e("div",null,[e("b",null,x(I.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:k[3]||(k[3]=P=>{w(),d(we)()})},[_(F,{message:"main.nav.folders.add"},{default:b(()=>k[9]||(k[9]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",ds,[_(jt,{folders:d(a).folderRoots,"filter-manager":G.collection.filterManager,"visible-folders":G.state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])])])],64)):f("",!0),i.value?(t(),n(E,{key:1},[g.value&&g.value.length?(t(),n("div",ps,[k[12]||(k[12]=e("div",{class:"custom-hr"},null,-1)),e("div",cs,[e("div",ms,[e("div",null,[e("b",null,x(I.$t("main.nav.tasks.title")),1)])]),k[11]||(k[11]=e("div",{class:"custom-hr"},null,-1)),d(s).backendStatus?(t(),n("div",vs,[(t(!0),n(E,null,j(g.value,(P,Q)=>(t(),n("div",gs,[Q?(t(),n("div",fs)):f("",!0),_(qt,{task:P},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),k[19]||(k[19]=e("div",{class:"custom-hr"},null,-1)),e("div",_s,[i.value?(t(),n("div",ys,[_(F,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:b(()=>[e("b",null,x(I.$t("main.nav.properties.title")),1)]),_:1}),k[14]||(k[14]=e("span",{class:"flex-grow-1"},null,-1)),v.value?(t(),n("span",bs,k[13]||(k[13]=[e("span",{class:"sr-only"},null,-1)]))):(t(),n("span",hs,[_(F,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:b(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u})]),_:1})])),e("span",ks,[_(F,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:b(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:k[4]||(k[4]=P=>d(o).showModal(d(oe).EXPORT,void 0))})]),_:1})])])):f("",!0),d(s).status.loaded?(t(),n("div",xs,[(t(!0),n(E,null,j(d(We)(d(a).propertyGroups),P=>(t(),n("div",$s,[_(ss,{tab:G,group:P,class:"mb-1","menu-open":i.value},null,8,["tab","group","menu-open"])]))),256)),(t(!0),n(E,null,j(r.value,P=>(t(),n("div",ws,[P.id>=0?(t(),n("div",Ss,[_(Se,{tab:G,property:P,open:i.value},null,8,["tab","property","open"])])):f("",!0)]))),256)),i.value?(t(),n(E,{key:0},[k[17]||(k[17]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:k[5]||(k[5]=P=>{d(o).showModal(d(oe).PROPERTY,void 0),d(we)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[15]||(k[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property")),1)]),k[18]||(k[18]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:k[6]||(k[6]=P=>d(a).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[16]||(k[16]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)]),k[20]||(k[20]=e("div",{class:"custom-hr"},null,-1)),e("div",Cs,[i.value?(t(),C(F,{key:0,message:"main.nav.computed.computed_tooltip",icon:!0},{default:b(()=>[e("b",null,x(I.$t("main.nav.computed.title")),1)]),_:1})):f("",!0),d(s).status.loaded?(t(),n("div",Is,[(t(!0),n(E,null,j(d(a).properties,P=>(t(),n(E,null,[P.id<0&&P.id!=d(qe)?(t(),n("div",Vs,[_(F,{pos:"bottom",message:"main.nav.computed."+Math.abs(P.id).toString()+"_tooltip"},{default:b(()=>[_(Se,{tab:G,property:P,open:i.value},null,8,["tab","property","open"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])],4)]}),_:1},8,["id"]))}});const Gs=U(Fs,[["__scopeId","data-v-65c5f050"]]),Ts={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Es={class:""},Ps=["onClick"],Os=O({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p;function o(m){a("update:modelValue",m)}return(m,c)=>(t(),C(te,null,{button:b(()=>[e("div",Ts,[e("span",Es,x(m.$t("modals.filters."+s.modelValue)),1)])]),popup:b(({hide:y})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:y},[e("div",{class:"base-btn",onClick:c[0]||(c[0]=v=>o(d(ze).and))},x(m.$t("modals.filters.and")),1),c[2]||(c[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:c[1]||(c[1]=v=>o(d(ze).or))},x(m.$t("modals.filters.or")),1)],8,Ps)]),_:1}))}}),Ls=["disabled"],Ds={class:"m-0 p-1"},Rs=["onClick"],As=O({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(h,{emit:p}){const s=K(),a=h,o=p,m=T(()=>s.properties[a.propertyId]),c=T(()=>Ke(m.value.type));async function y(v){o("update:modelValue",v)}return(v,i)=>(t(),C(te,{onHide:i[0]||(i[0]=l=>o("hide")),placement:"bottom"},{button:b(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:a.disabled},[e("span",null,x(v.$t("modals.filters.operators."+a.modelValue)),1)],8,Ls)]),popup:b(({hide:l})=>[e("div",Ds,[(t(!0),n(E,null,j(c.value,r=>(t(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>{y(r),l()}},[e("a",null,x(v.$t("modals.filters.operators."+r)),1)],8,Rs))),256))])]),_:1}))}});const Us=U(As,[["__scopeId","data-v-21b8bb8e"]]),Bs={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},js=O({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p;function o(m){a("update:modelValue",m)}return(m,c)=>(t(),n("div",Bs,[d(Te)(m.property.type)?(t(),C(Qe,{key:0,"model-value":s.modelValue,"onUpdate:modelValue":o,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:s.property,teleport:!1,width:s.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):s.property.type==d(W).color?(t(),C(Ye,{key:1,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).number?(t(),C(Xe,{key:2,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).url?(t(),C(Ze,{key:3,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).checkbox?(t(),C(Je,{key:4,"model-value":s.modelValue,"onUpdate:modelValue":o,label:s.property.name,width:s.width,class:"sb"},null,8,["model-value","label","width"])):s.property.type==d(W).date?(t(),C(et,{key:5,"model-value":s.modelValue,teleport:!1,"onUpdate:modelValue":o,width:s.width,class:"sb"},null,8,["model-value","width"])):(t(),C(tt,{key:6,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Ns={class:"p-0 m-0 ps-2"},Hs=O({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(h,{emit:p}){const s=K(),a=h,o=T(()=>s.properties[a.filter.propertyId]),m=T(()=>ot(a.filter.operator));function c(i){a.manager.updateFilter(a.filter.id,{operator:i})}function y(i){a.manager.updateFilter(a.filter.id,{value:i})}function v(i){a.manager.updateFilter(a.filter.id,{propertyId:i.id})}return(i,l)=>(t(),n(E,null,[e("td",Ns,[_(st,{"model-value":o.value,"onUpdate:modelValue":v},null,8,["model-value"])]),e("td",null,[_(Us,{"property-id":o.value.id,"model-value":a.filter.operator,"onUpdate:modelValue":c},null,8,["property-id","model-value"])]),e("td",null,[m.value?(t(),C(js,{key:0,"model-value":a.filter.value,"onUpdate:modelValue":y,property:o.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),Ws={style:{"max-height":"500px",overflow:"auto"}},Re=O({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(h,{emit:p}){const s=h;function a(o){s.manager.addNewFilter(o,s.group.id),ge.filter.show()}return(o,m)=>(t(),C(te,{placement:"auto"},{button:b(()=>[Pe(o.$slots,"default")]),popup:b(({hide:c})=>[e("div",Ws,[_(Oe,{onSelect:y=>{a(y),c()},"ignore-ids":[d(Ce).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),qs={class:"filter-group"},Ks={class:"table table-sm"},Qs={style:{height:"33px"}},Ys={class:""},Xs={key:0,class:"m-0 p-0"},Zs={key:2,class:"text-secondary"},Js={class:"border rounded"},eo={class:""},to=["onClick"],so={class:"d-flex text-secondary ms-2"},oo={class:"add-options hover-light"},ao=O({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(h,{emit:p}){K();const s=h,a=T(()=>s.filter),o=T(()=>a.value.filters),m=T(()=>{let i=255-(a.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function c(i){s.manager.deleteFilter(i.id)}function y(i){s.manager.addNewFilterGroup(i)}function v(i,l){s.manager.updateFilterGroup(i,l)}return(i,l)=>(t(),n("div",qs,[e("table",Ks,[(t(!0),n(E,null,j(o.value,(r,u)=>(t(),n("tr",Qs,[e("td",Ys,[u==0?(t(),n("div",Xs,x(i.$t("modals.filters.where")),1)):u==1?(t(),C(Os,{key:1,"model-value":a.value.groupOperator,"onUpdate:modelValue":l[0]||(l[0]=g=>v(a.value.id,g))},null,8,["model-value"])):(t(),n("span",Zs,x(i.$t("modals.filters."+a.value.groupOperator)),1))]),r.propertyId!==void 0?(t(),C(Hs,{key:0,filter:r,manager:s.manager},null,8,["filter","manager"])):(t(),n("td",{key:1,colspan:"3",style:X(m.value)},[e("div",Js,[_(Ae,{filter:r,manager:s.manager},null,8,["filter","manager"])])],4)),e("td",eo,[e("span",{class:"base-btn",onClick:g=>c(r)},l[2]||(l[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,to)])]))),256))]),e("div",so,[_(Re,{group:s.filter,manager:s.manager},{default:b(()=>[e("div",oo,[l[3]||(l[3]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:l[1]||(l[1]=r=>y(a.value.id))},[l[4]||(l[4]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(i.$t("modals.filters.new_group")),1)])])]))}});const Ae=U(ao,[["__scopeId","data-v-e644f737"]]),no={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},lo={key:0},io={key:0,class:"or-separator"},ro={key:0,class:"or-separator"},uo={key:0,class:"m-1 p-1"},po=O({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(h,{emit:p}){const s=K(),a=h,o=M(null),m=M(null),c=T(()=>{let v=y(a.manager.state.filter),i={};return v.forEach(l=>i[l.propertyId]=l),Object.values(i)});function y(v){let i=[];for(let l of v.filters)l.isGroup?i.push(...y(l)):i.push(l);return i}return q(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&m.value.hide()}),J(async()=>{await Z(),ge.filter=m.value}),(v,i)=>(t(),C(te,{ref_key:"dropdownElem",ref:m,placement:"top-start"},{button:b(()=>[e("div",null,[c.value.length||a.manager.state.query?(t(),n("div",no,[a.manager.state.query?(t(),n("div",lo,[i[0]||(i[0]=e("span",{class:"text-primary"},"Text Query",-1)),c.value.length?(t(),n("span",io,"|")):f("",!0)])):f("",!0),(t(!0),n(E,null,j(c.value,(l,r)=>(t(),n("div",null,[r>0?(t(),n("span",ro,"|")):f("",!0),l.propertyId==d(Ce).id?(t(),C(ce,{key:1,type:d(s).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(d(s).properties[l.propertyId].name),1)]))),256))])):f("",!0)])]),popup:b(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:o},[Object.keys(d(s).properties).length>0?(t(),n("div",uo,[_(Ae,{filter:a.manager.state.filter,manager:a.manager,parent:o.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const co=U(po,[["__scopeId","data-v-56cd3bdb"]]),mo={class:"d-flex flex-row filter-form"},vo={class:"pt-1 pb-1"},go=O({__name:"FilterForm",props:{manager:Ie},setup(h){const p=h;return(s,a)=>(t(),n("div",mo,[e("div",vo,x(s.$t("main.menu.filters"))+": ",1),_(co,{manager:p.manager},null,8,["manager"]),_(Re,{manager:p.manager,group:p.manager.state.filter,class:"p-1"},{default:b(()=>a[0]||(a[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}});const fo=U(go,[["__scopeId","data-v-cc2f25ec"]]),_o={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},yo=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(h,{emit:p}){const s=h,a=p,o=M(null);return(m,c)=>(t(),C(te,{ref_key:"dropdownElem",ref:o,"auto-focus":!1},{button:b(()=>c[2]||(c[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:b(()=>[e("div",_o,[_(Oe,{onClick:c[0]||(c[0]=y=>d(we)()),onSelect:c[1]||(c[1]=y=>{a("select",y),o.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ue=U(yo,[["__scopeId","data-v-012e1f38"]]),bo={class:"base-hover ps-1 pe-1"},ho={class:"main"},ko=["onClick"],xo=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p,o=Object.values(Le);function m(c){a("update:modelValue",c)}return(c,y)=>(t(),C(te,null,{button:b(()=>[e("div",bo,x(s.modelValue),1)]),popup:b(({hide:v})=>[e("div",ho,[(t(!0),n(E,null,j(d(o),i=>(t(),n("div",{class:"base-hover option",onClick:l=>{m(i),v()}},x(i),9,ko))),256))])]),_:1}))}});const $o=U(xo,[["__scopeId","data-v-ce3e3774"]]),wo={class:""},So={class:"d-flex ipt"},Co={class:"ms-2",min:"1"},Io=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(h,{emit:p}){const s=h,a=p,o=M(1),m=M(Le.Year);function c(){s.option.stepSize==o.value&&s.option.stepUnit==m.value||a("change",{stepSize:o.value,stepUnit:m.value})}function y(){o.value=s.option.stepSize??1,m.value=s.option.stepUnit}return q(()=>s.option,y),J(y),q(o,()=>{(o.value<1||o.value==null||isNaN(o.value))&&(o.value=1)}),(v,i)=>(t(),C(te,{onHide:c},{button:b(()=>i[2]||(i[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:b(({hide:l,focus:r})=>[e("div",wo,[e("div",So,[e("div",null,[fe(e("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u)},null,512),[[_e,o.value]])]),e("div",Co,[_($o,{modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=u=>m.value=u),onHide:r},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Vo=U(Io,[["__scopeId","data-v-78b647dc"]]),Mo={class:"d-flex flex-row group-form"},zo={class:"pt-1 pb-1"},Fo={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Go={key:0,class:"bi bi-chevron-right smaller"},To=["onClick"],Eo=["onClick"],Po=["onClick"],Oo=["onClick"],Lo=["onClick"],Do=["onClick"],Ro=["onClick"],Ao=["onClick"],Uo=["onClick"],Bo={key:5,class:"sm-btn"},jo={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},No=O({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(h){const p=K(),s=h;function a(l){s.manager.setGroupOption(l),s.manager.update(!0)}function o(l){s.manager.delGroupOption(l),s.manager.update(!0)}function m(l,r){s.manager.setGroupOption(l,{direction:r}),s.manager.sortGroups(!0)}function c(l,r){s.manager.setGroupOption(l,{type:r}),s.manager.sortGroups(!0)}function y(l,r){s.manager.setGroupOption(l,r),s.manager.update(!0)}const v=T(()=>s.manager.state.groupBy.map(l=>p.properties[l])),i=T(()=>{const l=[];return s.manager.state.groupBy.forEach(r=>{l.push({option:s.manager.state.options[r],property:p.properties[r]})}),l});return(l,r)=>(t(),n("div",Mo,[e("div",zo,x(l.$t("main.menu.groupby"))+": ",1),v.value.length?(t(),n("div",Fo,[(t(!0),n(E,null,j(i.value,(u,g)=>(t(),n(E,null,[g>0?(t(),n("i",Go)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:w=>o(u.property.id),id:"remove-group-button"},x(u.property.name),9,To),u.option.type==d(ne).Size?(t(),C(F,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:b(()=>[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Property)},null,8,Eo)):(t(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:w=>c(u.property.id,d(ne).Property)},null,8,Po))]),_:2},1024)):(t(),C(F,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:b(()=>[u.property.type==d(W).number?(t(),n(E,{key:0},[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Oo)):(t(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Lo))],64)):(t(),n(E,{key:1},[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Do)):(t(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Ro))],64))]),_:2},1024)),u.option.direction==d(se).Ascending?(t(),C(F,{key:3,message:"main.menu.sort.order_asc"},{default:b(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:w=>m(u.property.id,d(se).Descending)},null,8,Ao)]),_:2},1024)):(t(),C(F,{key:4,message:"main.menu.sort.order_desc"},{default:b(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:w=>m(u.property.id,d(se).Ascending)},null,8,Uo)]),_:2},1024)),u.property.type==d(W).date?(t(),n("div",Bo,[_(Vo,{option:u.option,onChange:w=>y(u.property.id,w)},null,8,["option","onChange"])])):f("",!0)],64))),256)),s.isLoading?(t(),n("i",jo)):f("",!0)])):f("",!0),_(Ue,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:r[0]||(r[0]=u=>a(u))},null,8,["group-ids"])]))}});const Ho=U(No,[["__scopeId","data-v-dcec9b5d"]]),Wo={class:"d-flex flex-row sort-form"},qo={class:"pt-1 pb-1"},Ko={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Qo={key:0,class:"bi bi-chevron-right smaller"},Yo=["onClick"],Xo=["onClick"],Zo=["onClick"],Jo=O({__name:"SortForm",props:{manager:nt},setup(h){const p=K(),s=h,a=T(()=>s.manager.state.sortBy.map(v=>({propertyId:v,direction:s.manager.state.options[v].direction}))),o=T(()=>a.value.map(v=>v.propertyId));function m(v){s.manager.setSort(v),s.manager.update(!0)}function c(v){s.manager.delSort(v),s.manager.update(!0)}function y(v,i){s.manager.setSort(v,{direction:i}),s.manager.update(!0)}return(v,i)=>(t(),n("div",Wo,[e("div",qo,x(v.$t("main.menu.sort.title"))+": ",1),a.value.length?(t(),n("div",Ko,[(t(!0),n(E,null,j(a.value,(l,r)=>(t(),n(E,null,[r>0?(t(),n("i",Qo)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>c(l.propertyId)},x(d(p).properties[l.propertyId].name),9,Yo),l.direction==d(se).Ascending?(t(),C(F,{key:1,message:"main.menu.sort.order_asc"},{default:b(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>y(l.propertyId,d(se).Descending)},null,8,Xo)]),_:2},1024)):(t(),C(F,{key:2,message:"main.menu.sort.order_desc"},{default:b(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>y(l.propertyId,d(se).Ascending)},null,8,Zo)]),_:2},1024))],64))),256))])):f("",!0),_(Ue,{"group-ids":o.value,onSelect:i[0]||(i[0]=l=>m(l))},null,8,["group-ids"])]))}});const ea=U(Jo,[["__scopeId","data-v-4e00ef99"]]),ta={class:"custom-slider"},sa=["value","min","max","step"],oa=O({__name:"RangeInput",props:{min:{default:0},max:{default:1},step:{default:.1},modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p,o=M(s.modelValue),m=M(null),c=(l,r,u)=>(l-r)/(u-r),y=l=>{m.value.style.setProperty("--ProgressPercent",`${l}%`)};lt(()=>{if(m.value){const l=c(o.value,m.value.min,m.value.max);y(l+0)}});function v(){a("update:modelValue",o.value)}let i=!1;return navigator.userAgent.indexOf("AppleWebKit")!=-1&&(i=!0),q(()=>s.modelValue,()=>o.value=s.modelValue),(l,r)=>(t(),n("div",ta,[e("input",{ref_key:"slider",ref:m,value:o.value,onInput:r[0]||(r[0]=({target:u})=>o.value=parseFloat(u.value)),type:"range",min:l.min,max:l.max,step:l.step,class:"slider",style:X(d(i)?"top:-5px":""),onChange:v},null,44,sa)]))}});const aa=U(oa,[["__scopeId","data-v-5269b272"]]),na={class:"p-2"},la={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ia={class:"border mb-1 p-1"},ra={class:"me"},ua={key:0},da={key:1},pa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},ca={class:"d-flex center justify-content-center"},ma={key:1,class:"bi bi-arrow-down text-secondary"},va={key:3,class:"bi bi-arrow-up text-secondary"},ga={class:"border mb-1 p-1"},fa={class:"me"},_a={key:0},ya={key:1},ba={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},le=5,ha=O({__name:"HistoryDropdown",emits:[],setup(h,{emit:p}){const s=K(),a=M(!1),o=T(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=T(()=>[...s.history.undo].reverse().slice(0,le)),c=T(()=>s.history.redo.slice(Math.max(s.history.redo.length-le,0)));return q(()=>s.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(y,v)=>m.value.length||c.value.length?(t(),C(te,{key:0},{button:b(()=>[_(F,{message:"dropdown.history.info"},{default:b(()=>[e("div",{class:"d-flex sb flash",style:X([{"font-size":"14px"},o.value])},[v[2]||(v[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(y.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:b(()=>[e("div",na,[d(s).history.redo.length>le?(t(),n("div",la," + "+x(d(s).history.redo.length-le),1)):f("",!0),(t(!0),n(E,null,j(c.value,i=>(t(),n("div",ia,[e("span",ra,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[3]||(v[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),n("span",ua,x(i.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),i.values?(t(),n("span",da,x(i.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",pa,[e("div",ca,[m.value.length?(t(),C(F,{key:0,message:"dropdown.history.undo"},{default:b(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:v[0]||(v[0]=(...i)=>d(s).undo&&d(s).undo(...i))})]),_:1})):(t(),n("div",ma)),v[4]||(v[4]=e("div",{style:{width:"30px"}},null,-1)),c.value.length?(t(),C(F,{key:2,message:"dropdown.history.redo"},{default:b(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:v[1]||(v[1]=(...i)=>d(s).redo&&d(s).redo(...i))})]),_:1})):(t(),n("div",va))])]),(t(!0),n(E,null,j(m.value,i=>(t(),n("div",ga,[e("span",fa,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[5]||(v[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),n("span",_a,x(i.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),i.values?(t(),n("span",ya,x(i.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),d(s).history.undo.length>le?(t(),n("div",ba," + "+x(d(s).history.undo.length-le),1)):f("",!0)])]),_:1})):f("",!0)}});const ka=U(ha,[["__scopeId","data-v-85cd80d0"]]),xa=O({__name:"ToggleReload",props:{tab:{}},emits:[],setup(h,{emit:p}){const s=h,a=T(()=>s.tab.collection.state.autoReload?2:s.tab.collection.runState.isDirty?0:1);function o(){a.value==0?s.tab.collection.update():a.value==1?s.tab.collection.setAutoReload(!0):s.tab.collection.setAutoReload(!1)}return(m,c)=>(t(),n("div",{class:"bb font",onClick:o,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(t(),C(F,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:b(()=>c[0]||(c[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),a.value==1?(t(),C(F,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:b(()=>c[1]||(c[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),a.value==2?(t(),C(F,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:b(()=>c[2]||(c[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}});const $a=U(xa,[["__scopeId","data-v-91d89d17"]]),wa={class:"d-flex flex-row p-2"},Sa=["placeholder"],Ca={class:"me-5 d-flex"},Ia={class:"ms-5",style:{"font-size":"13px"}},Va=["checked"],Ma={class:"ms-1"},za={class:"ms-4"},Fa={class:"d-flex flex-wrap content-container ps-2"},Ga=O({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(h,{emit:p}){const s=h,a=M(""),o=T(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),m=T(()=>o.value.length);function c(l){const r=l.target.checked;s.tab.collection.groupManager.setSha1Mode(r,!0)}function y(){a.value=s.tab.state.filterState.query}function v(){s.tab.collection.filterManager.setQuery(a.value),s.tab.collection.filterManager.update(!0)}function i(){s.tab.collection.filterManager.setQuery(""),s.tab.collection.filterManager.update(!0)}return J(y),q(()=>s.tab.collection.filterManager.state.query,y),(l,r)=>(t(),n(E,null,[e("div",wa,[_(F,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:b(()=>[e("div",{class:H(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[r[6]||(r[6]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),fe(e("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":r[0]||(r[0]=u=>a.value=u),onChange:v},null,40,Sa),[[_e,a.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:i},"x")],2)]),_:1}),e("div",Ca,[_(F,{message:"main.menu.grid_tooltip"},{default:b(()=>[e("i",{class:H("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:r[1]||(r[1]=u=>s.tab.setViewMode("tree"))},null,2)]),_:1}),_(F,{message:"main.menu.table_tooltip"},{default:b(()=>[e("i",{id:"toot",class:H("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:r[2]||(r[2]=u=>s.tab.setViewMode("grid"))},null,2)]),_:1}),_(F,{message:"main.menu.graph_tooltip"},{default:b(()=>[e("i",{id:"toot",class:H("bi bi-bar-chart btn-icon"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:r[3]||(r[3]=u=>s.tab.setViewMode("graph"))},null,2)]),_:1})]),_(F,{message:"main.menu.image_size_tooltip",click:!1},{default:b(()=>r[7]||(r[7]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[_(aa,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":r[4]||(r[4]=u=>s.tab.state.imageSize=u)},null,8,["modelValue"])]),e("div",Ia,[_(F,{message:"main.menu.image_mode_tooltip"},{default:b(()=>[e("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:c},null,40,Va),e("span",Ma,x(l.$t("main.menu.image_mode")),1)]),_:1})]),e("div",za,[_(ka)]),m.value?(t(),C(it,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":o.value,"onRemove:selected":r[5]||(r[5]=u=>s.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),r[9]||(r[9]=e("div",{class:"flex-grow-1"},null,-1)),_(F,{message:"main.menu.issue",class:"bb"},{default:b(()=>r[8]||(r[8]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",Fa,[_($a,{tab:s.tab,class:"me-1"},null,8,["tab"]),_(fo,{manager:s.tab.collection.filterManager},null,8,["manager"]),_(Ho,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),_(ea,{manager:s.tab.collection.sortManager},null,8,["manager"])])],64))}});const Ta=U(Ga,[["__scopeId","data-v-609b9ce1"]]),Ea={class:""},Pa={class:"d-flex flex-row"},Oa=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(h,{emit:p}){const s=ue(),a=h,o=p,m=T(()=>`width: ${a.size}px; height: ${a.size}px;`);T(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`);const c=T(()=>a.pile.images[0]);return(y,v)=>(t(),n("div",Ea,[_(ut,{image:c.value},{default:b(()=>[e("div",{style:X(m.value),class:"img-container",onClick:v[0]||(v[0]=i=>d(s).showModal(d(oe).IMAGE,{image:c.value}))},[_(rt,{image:c.value,width:a.size-2,height:a.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Pa,[_(F,{message:"main.recommand.accept"},{default:b(()=>[e("div",{style:X(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:v[1]||(v[1]=i=>o("accept",c.value))}," ✓ ",4)]),_:1}),_(F,{message:"main.recommand.refuse"},{default:b(()=>[e("div",{style:X(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:v[2]||(v[2]=i=>o("refuse",c.value))}," ✕ ",4)]),_:1})])]))}});const La=U(Oa,[["__scopeId","data-v-2ff8fded"]]),Da={class:"reco-container"},Ra={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Aa={key:0,class:"bi bi-funnel-fill bb text-primary"},Ua={key:1,class:"bi bi-funnel bb"},Ba={class:"text-secondary me-2"},ja={style:{"padding-top":"2px"},class:"me-1"},Na={class:"flex-grow-1"},Ha={class:"d-flex flex-row"},Wa={key:0,class:"separator"},qa={class:"d-flex flex-row"},ke=10,Ka=O({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(h,{emit:p}){const s=K(),a=dt(),o=h,m=p,c=M(1),y=me([]),v=M(null),i=me([]),l=me(new Set),r=M(!0),u=[],g=[];async function w(R){const z=[],S=[];i.forEach($=>{if($.value!=null){const V=s.properties[$.propertyId];let N=$.value;V.type==W.multi_tags?(N=R.properties[$.propertyId]??[],N=[...N,$.value]):V.type==W.tag&&(N=[N]),V.mode==$e.id?S.push({instanceId:R.id,propertyId:V.id,value:N}):z.push({propertyId:V.id,sha1:R.sha1,value:N})}}),await s.setPropertyValues(S,z)}function D(R){v.value.isSha1Group?v.value.images.filter(z=>z.sha1==R.sha1).forEach(z=>l.add(z.id)):l.add(R.id),Q()}function A(){y.length=0;let R=[];const z=g.map(S=>s.instances[S]);if(v.value.isSha1Group){const S={},$=Array.from(new Set(z.map(V=>V.sha1)));$.forEach(V=>S[V]=[]),z.forEach(V=>S[V.sha1].push(V)),$.forEach(V=>R.push({sha1:V,images:s.sha1Index[V]}))}else z.forEach(S=>R.push({sha1:S.sha1,images:[S]}));I(R,y,c.value,o.imageSize,o.width)}function I(R,z,S,$,V){let N=V,Y=[],ae=0;for(let ye=0;ye<R.length&&!(z.length>=S);ye++){let re=R[ye];if(re.images=re.images.filter(Be=>!l.has(Be.id)),re.images.length==0)continue;let be=$+ke;if(ae+be<N){Y.push(re),ae+=be;continue}if(Y.length==0)throw new Error("Images seems to be to big for the line");z.push(Y),z.length<S&&(Y=[re],ae=be)}Y.length>0&&z.length<S&&z.push(Y)}async function k(){if(!o.group||!a.hasSimilaryFunction)return;const R=a.defaultActions.similar,z=a.getContext(R);z.instanceIds=o.group.images.map(Y=>Y.id);const S=await a.getSimilarImages(z);if(!S)return;if(!S.groups)throw new Error("No instances in ActionResult");let V=mt(S.groups)[0];if(r.value){const Y=new Set(o.tab.collection.filterManager.result.images.map(ae=>ae.id));V.images=V.images.filter(ae=>Y.has(ae.id))}V.scores&&vt(V),v.value=V,i.length=0;let N=o.group;for(;N;)i.push(...N.meta.propertyValues),N=N.parent;l.clear(),u.length=0,V.images.forEach(Y=>u.push(Y.id)),Q(),m("update")}function G(){r.value=!r.value}function L(){o.tab.collection.groupManager.onResultChange.addListener(Q)}function P(){o.tab.collection.groupManager.onResultChange.removeListener(Q)}function Q(){const R=o.tab.collection.groupManager.result.index[o.group.id];if(!R){m("close");return}g.length=0;const z=new Set(R.images.map(S=>S.id));u.forEach(S=>{z.has(S)||l.has(S)||g.push(S)}),A()}return J(L),Ve(P),J(k),q(()=>o.group,()=>{k(),l.clear()}),q(()=>o.imageSize,A),q(()=>o.width,A),q(r,k),(R,z)=>(t(),n("div",Da,[e("div",Ra,[_(F,{message:"main.recommand.close"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:z[0]||(z[0]=S=>m("close"))},z[2]||(z[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),z[5]||(z[5]=e("div",{class:"b-left pe-1"},null,-1)),_(F,{message:"main.recommand.scroll"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:z[1]||(z[1]=S=>m("scroll",o.group.id))},z[3]||(z[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),z[6]||(z[6]=e("div",{class:"b-left pe-1"},null,-1)),_(F,{message:"main.recommand.filter"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:G},[r.value?(t(),n("span",Aa)):(t(),n("span",Ua))])]),_:1}),z[7]||(z[7]=e("div",{class:"b-left pe-1"},null,-1)),_(F,{message:"main.recommand.reload"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:k},z[4]||(z[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),z[8]||(z[8]=e("div",{class:"b-left pe-1"},null,-1)),_(F,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:b(()=>[e("span",Ba,x(R.$t("main.recommand.title")),1)]),_:1}),e("div",ja,[_(pt,{action:"similar",onChanged:k})]),e("div",Na,[e("div",Ha,[(t(!0),n(E,null,j(i,(S,$)=>(t(),n(E,null,[_(ct,{class:"",value:S},null,8,["value"]),$<i.length-1?(t(),n("div",Wa)):f("",!0)],64))),256))])])]),e("div",{style:X("margin-left:"+ke+"px;")},[(t(!0),n(E,null,j(y,S=>(t(),n("div",null,[e("div",qa,[(t(!0),n(E,null,j(S,$=>(t(),C(La,{pile:$,size:o.imageSize,onAccept:w,onRefuse:D,style:X("margin-right:"+ke+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Qa=U(Ka,[["__scopeId","data-v-fe023b30"]]);const Ya={style:{display:"flex"}},Xa={class:"info"},Za={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:W},height:String},setup(h){const p=h,s=M(0),a=M(!1),o={};Object.keys(p.chartData.series).forEach(r=>{o[r]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:p.chartData.dataType===W.date?"datetime":"numeric",categories:p.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:r,seriesIndex:u,dataPointIndex:g,w}){const D=p.chartData.series[u].data[g];let A='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';D.images.forEach((k,G)=>{G<10&&(A+=`<div style="width: 75px; height: 75px;"><img src="${k}" style="width: 100%; height: 100%;" /></div>`)}),A+="</div>";let I=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${p.chartData.series[u].name} — </b> ${D.y} Images</span>`;return I+=`<div>${A}</div>`,I}}}),c=()=>{m.value.chart.stacked=!m.value.chart.stacked,a.value=!a.value,s.value+=1},y=()=>{let r;m.value.chart.type==="area"?r={chart:{...m.value.chart,type:"bar"}}:r={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...r},s.value+=1},v=(r,u,g)=>{const D=p.chartData.series[u];let A=Math.max(...D.data.map(I=>I.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(I=>I.remove()),o[u]){o[u]=!1;return}D.data.forEach((I,k)=>{const L=Math.floor(I.y/A*17),P=I.images.slice(0,L),Q=`circle[index="${u}"][j="${k}"]`,R=document.querySelector(Q),z=parseFloat(R.getAttribute("cx"));P.forEach((S,$)=>{const V=document.createElement("img");V.src=S,V.width=40,V.height=40,V.style.position="absolute";let N=z+40/1.5,Y=65+$*40;V.style.left=`${N}px`,V.style.bottom=`${Y}px`,V.classList.add("apexcharts-custom-image"),V.addEventListener("mouseover",ae=>i(N,Y,S)),V.addEventListener("mouseout",l),r.el.appendChild(V)})}),Object.keys(o).forEach(I=>o[I]=!1),o[u]=!0};function i(r,u,g){const w=document.getElementById("zoomed-image");w.style.left=`${r+120*1.5}px`,w.src=g,w.style.bottom=`${u}px`,w.style.display="block"}function l(){const r=document.getElementById("zoomed-image");r.style.display="none"}return(r,u)=>{const g=Ee("apexchart");return t(),n(E,null,[e("div",Ya,[e("button",{class:"mt-2",onClick:y},x(m.value.chart.type==="area"?r.$t("main.graph-view.histo"):r.$t("main.graph-view.curve")),1),p.chartData.series.length>1?(t(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:c},x(a.value?r.$t("main.graph-view.over"):r.$t("main.graph-view.stack")),1)):f("",!0)]),(t(),C(g,{style:{position:"relative"},key:s.value,height:p.height,type:m.value.chart.type,options:m.value,series:p.chartData.series,onLegendClick:v},null,8,["height","type","options","series"])),e("i",Xa,x(r.$t("main.graph-view.info")),1),u[0]||(u[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Ja={key:1},en=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(h,{emit:p}){const s=K(),a=h,o=M(""),m=M(y());function c(){const v=new Set;let i=a.collection.groupManager.getGroupIterator();for(;i;){const l=i.group;if(l.id===0||l.meta.propertyValues&&l.meta.propertyValues[0].value==null){i=i.nextGroup();continue}for(let r of l.children)v.add(r.meta.propertyValues[0].value);l.children.forEach(()=>i=i.nextGroup()),i=i.nextGroup()}return v}function y(){const v={};let i,l=a.collection.groupManager.state.groupBy;if(l.length===0){o.value="Choose at least one date or numeric value to group the images by";return}const r=s.properties[l[0]],u=r.type;if(l.length>2){o.value="Only max two levels of grouping are supported";return}else if(l.length===1)v[r.name]={name:r.name,data:[]};else if(i=Array.from(c()),i.length>20){o.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(u!==W.number&&u!==W.date){o.value="First level of grouping needs to be a date or a numeric property";return}let g=a.collection.groupManager.getGroupIterator();const w=[];for(;g;){const D=g.group;if(D.id===0||D.meta.propertyValues&&D.meta.propertyValues[0].value==null){g=g.nextGroup();continue}let A=D.meta.propertyValues[0];const I=u===W.date?new Date(A.value).getTime():A.value;if(w.push(I),r.name in v)v[r.name].data.push({x:I,y:D.images.length,images:D.images.slice(0,20).map(k=>k.urlSmall)});else{const k=D.children.map(L=>L.meta.propertyValues[0].value),G=i.filter(L=>!k.includes(L));for(let L of D.children){const P=L.meta.propertyValues[0].value;if(v[P]===void 0){let Q=P;P in s.tags&&(Q=s.tags[P].value),v[P]={data:[],name:Q}}v[L.meta.propertyValues[0].value].data.push({x:I,y:L.images.length,images:L.images.slice(0,20).map(Q=>Q.urlSmall)})}for(let L of G){if(v[L]===void 0){let P=L;L in s.tags&&(P=s.tags[L].value),v[L]={data:[],name:P}}v[L].data.push({x:I,y:0,images:[]})}D.children.forEach(()=>g=g.nextGroup())}g=g.nextGroup()}return o.value="",{series:Object.values(v),xValues:w,dataType:u}}return a.collection.groupManager.onResultChange.addListener(()=>m.value=y()),(v,i)=>(t(),n("div",{class:"",style:X({height:a.height+"px"})},[o.value===""?(t(),C(Za,{key:0,chartData:m.value,height:a.height-50+"px"},null,8,["chartData","height"])):(t(),n("span",Ja,x(o.value),1))],4))}}),tn={key:0,class:"m-0 p-0"},sn={key:0,style:{"margin-left":"10px"}},on=O({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(h,{expose:p}){de();const s=K(),a=h;p({updateScrollerWidth:A});const o=M({}),m=M(!0),c=M(null),y=M(null),v=M(null),i=M(0),l=M(0),r=me({groups:!1}),u=T(()=>a.tab.getVisibleProperties());function g(){c.value&&y.value?i.value=a.height-c.value.clientHeight-y.value.clientHeight-5:c.value?i.value=a.height-c.value.clientHeight-5:i.value=0}function w(I){o.value=a.tab.collection.groupManager.result.index[I],Z(()=>g())}function D(){o.value={},Z(()=>g())}async function A(){var I;await Z(),l.value=((I=c.value)==null?void 0:I.clientWidth)??l.value}return J(()=>{l.value=c.value.clientWidth,window.addEventListener("resize",A)}),Ve(()=>{window.removeEventListener("resize",A)}),q(()=>a.tab.state.imageSize,()=>Z(g)),q(()=>a.filterOpen,()=>Z(g)),q(()=>a.height,async()=>{await Z(g)}),J(g),J(()=>a.tab.update()),(I,k)=>(t(),n(E,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:c},[a.filterOpen?(t(),C(Ta,{key:0,tab:a.tab,"compute-status":r},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[o.value.id?(t(),n("div",tn,[_(Qa,{tab:a.tab,group:o.value,"image-size":a.tab.state.imageSize,width:l.value,height:50,onClose:D,onScroll:v.value.scrollTo,onUpdate:k[0]||(k[0]=G=>Z(()=>g()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),d(s).isLoaded&&l.value>0&&i.value>0&&m.value?(t(),n("div",sn,[a.tab.state.display=="tree"?(t(),C(gt,{key:0,"group-manager":a.tab.collection.groupManager,"image-size":a.tab.state.imageSize,height:i.value-0,properties:u.value,"hide-if-modal":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,width:l.value-25,onRecommend:w},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),a.tab.state.display=="grid"?(t(),n("div",{key:1,style:X({width:l.value-12+"px"}),class:"p-0 m-0 grid-container"},[_(ft,{tab:I.tab,manager:a.tab.collection.groupManager,height:i.value-15,width:l.value-40,"selected-properties":u.value,class:"p-0 m-0","show-images":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),a.tab.state.display=="graph"?(t(),C(en,{key:2,collection:a.tab.collection,height:i.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}});const an=U(on,[["__scopeId","data-v-813c6f29"]]),nn=O({__name:"TabButton",props:{tab:{}},setup(h){const p=pe(),s=M(""),a=M(null),o=M(!1),m=M(!1),c=h,y=T(()=>c.tab.state.id);function v(){p.selectMainTab(c.tab.state.id)}function i(){m.value=!0,s.value=c.tab.state.name,Z(()=>a.value.focus())}function l(){c.tab.renameTab(s.value),m.value=!1}async function r(){confirm("Are you sure to delete Tab: "+c.tab.state.name)&&p.deleteTab(c.tab.state.id)}return J(()=>{c.tab.isNew&&i()}),(u,g)=>(t(),n("div",{class:"d-flex d-row me-2",onMouseenter:g[1]||(g[1]=w=>o.value=!0),onMouseleave:g[2]||(g[2]=w=>o.value=!1)},[m.value?(t(),n("div",{key:1,class:H(["tab-button",y.value==d(p).mainTab?" active":""])},[e("form",{onSubmit:ve(l,["stop","prevent"])},[fe(e("input",{onFocusout:l,onKeydown:_t(l,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":g[0]||(g[0]=w=>s.value=w),ref_key:"inputElem",ref:a},null,544),[[_e,s.value]])],32)],2)):(t(),n(E,{key:0},[_(F,{message:"main.menu.rename_tab_tooltip"},{default:b(()=>[e("i",{onClick:i,class:H(["bi bi-pencil me-1 tab-icon hover-light",o.value&&d(p).mainTab==y.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:H(["tab-button",y.value==d(p).mainTab?" active":""]),onClick:v},[e("span",null,x(c.tab.state.name),1)],2),_(F,{message:"main.menu.delete_tab_tooltip"},{default:b(()=>[e("i",{onClick:r,class:H(["btn-icon bi bi-x tab-icon hover-light",o.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}});const ln={class:"d-flex d-row",style:{cursor:"pointer"}},rn={class:"pt-1"},un={key:0,class:"bb bi bi-chevron-down"},dn={key:1,class:"bb bi bi-chevron-right"},pn={style:{"padding-top":"2px","margin-right":"2px"}},cn={class:"lang"},mn=["value"],vn=["value"],gn=O({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(h,{emit:p}){const{locale:s}=Ge(),a=ue(),o=pe(),m=h,c=p;async function y(r){await o.addTab("New Tab")}const v=["fr","en"];function i(){c("update:filterOpen",!m.filterOpen)}function l(r){m.reRender();const u=r.target.value;s.value=u,de().setLang(u)}return(r,u)=>(t(),n("nav",null,[e("div",ln,[e("div",rn,[e("span",{onClick:i},[m.filterOpen?(t(),n("i",un)):(t(),n("i",dn))])]),(t(!0),n(E,null,j(d(o).loadedTabs,g=>(t(),n("div",null,[_(nn,{tab:d(o).getTab(g)},null,8,["tab"])]))),256)),_(F,{message:"main.menu.add_tab_tooltip"},{default:b(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:y,id:"add-tab-button"},u[1]||(u[1]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),u[4]||(u[4]=e("div",{class:"flex-grow-1"},null,-1)),e("div",pn,[_(F,{message:"modals.notif.icon"},{default:b(()=>[e("span",{class:"bb",onClick:u[0]||(u[0]=g=>d(a).showModal(d(oe).NOTIF))},u[2]||(u[2]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",cn,[u[3]||(u[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:r.$i18n.locale,onChange:l},[(t(),n(E,null,j(v,(g,w)=>e("option",{key:`Lang${w}`,value:g},x(g.toUpperCase()),9,vn)),64))],40,mn)])])]))}});const fn={key:0},_n={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},ie=O({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(h){const p=h;return(s,a)=>p.loading?(t(),n("div",fn,[s.loading?(t(),n("div",_n,a[0]||(a[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),xe=O({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(h){const p=h,s=T(()=>p.force?"100%":p.max==0?"0%":p.current>=p.max?"100%":Math.floor(p.current/p.max*100)+"%");return(a,o)=>(t(),n("span",null,x(s.value),1))}}),yn={key:0,class:"center"},bn={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},hn={class:"d-flex text-secondary"},kn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},xn={class:"d-flex text-secondary",style:{"font-size":"14px"}},$n={key:0,class:"bi bi-check text-success"},wn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Sn={key:0,class:"bi bi-check text-success"},Cn={class:"d-flex text-secondary",style:{"font-size":"14px"}},In={key:0,class:"bi bi-check text-success"},Vn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Mn={key:0,class:"bi bi-check text-success"},zn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Fn={key:0,class:"bi bi-check text-success"},Gn=O({__name:"DataLoad",setup(h){const p=K();return(s,a)=>d(p).loadState?(t(),n("div",yn,[e("div",bn,[e("div",null,[e("div",hn,[a[0]||(a[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedProperty},null,8,["loading"]),d(p).loadState.finishedProperty?(t(),n("i",kn)):f("",!0)]),e("div",xn,[a[1]||(a[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedPropertyGroups},null,8,["loading"]),d(p).loadState.finishedPropertyGroups?(t(),n("i",$n)):f("",!0)]),e("div",wn,[a[2]||(a[2]=e("div",{class:"me-1"},"Tags",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedTags},null,8,["loading"]),d(p).loadState.finishedTags?(t(),n("i",Sn)):f("",!0)]),e("div",Cn,[a[3]||(a[3]=e("div",{class:"me-1"},"Instances",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedInstance},null,8,["loading"]),d(p).loadState.finishedInstance?(t(),n("i",In)):f("",!0),_(xe,{current:d(p).loadState.counterInstance,max:d(p).loadState.maxInstance,force:d(p).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",Vn,[a[4]||(a[4]=e("div",{class:"me-1"},"InstanceValues",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedInstanceValues},null,8,["loading"]),d(p).loadState.finishedInstanceValues?(t(),n("i",Mn)):f("",!0),_(xe,{current:d(p).loadState.counterInstanceValue,max:d(p).loadState.maxInstanceValue,force:d(p).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",zn,[a[5]||(a[5]=e("div",{class:"me-1"},"ImageValues",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedImageValues},null,8,["loading"]),d(p).loadState.finishedImageValues?(t(),n("i",Fn)):f("",!0),_(xe,{current:d(p).loadState.counterImageValue,max:d(p).loadState.maxImageValue,force:d(p).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}});const Tn=U(Gn,[["__scopeId","data-v-0db6d675"]]),En={key:0},Pn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},On={class:"w-100"},Ln={key:0,class:"custom-hr"},Dn={key:2,class:"loading"},Rn={class:"text-center"},An={key:3,class:"loading"},Un=O({__name:"PanopticView",setup(h){const p=de(),s=K(),a=ue(),o=pe(),m=M(null),c=M(null),y=M(window.innerHeight),v=M(!1),i=M(!0),l=M(!0),r=T(()=>{var G;return y.value-(((G=c.value)==null?void 0:G.clientHeight)??0)}),u=T(()=>{var G;return(G=m.value)==null?void 0:G.filteredImages.map(L=>L.id)});let g=navigator.userAgent.indexOf("Mac OS X")!==-1;async function w(){i.value=!1,await Z(),i.value=!0}J(async()=>{a.isProjectLoaded||Fe.push("/"),Z(()=>{window.addEventListener("resize",D),D()}),window.addEventListener("keydown",G=>{G.key=="Control"&&(B.ctrl=!0),G.key=="Alt"&&(g&&(B.ctrl=!0),B.alt=!0),G.key=="Shift"&&(B.shift=!0),G.key=="ArrowLeft"&&(B.left=!0),G.key=="ArrowRight"&&(B.right=!0,console.log("keeeyy")),G.key=="Z"&&B.ctrl&&s.redo(),G.key=="z"&&B.ctrl&&s.undo()}),window.addEventListener("keyup",G=>{G.key=="Control"&&(B.ctrl=!1),G.key=="Alt"&&(g&&(B.ctrl=!1),B.alt=!1),G.key=="Shift"&&(B.shift=!1),G.key=="ArrowLeft"&&(B.left=!1),G.key=="ArrowRight"&&(B.right=!1)}),window.addEventListener("mousemove",G=>{B.ctrl=G.ctrlKey,B.alt=G.altKey,B.shift=G.shiftKey,g&&(B.ctrl=B.ctrl||B.alt)})}),Ve(()=>{window.removeEventListener("resize",D)});function D(){y.value=window.innerHeight,v.value=!0}function A(){a.showModal(oe.EXPORT,u)}function I(){Fe.push("/")}function k(){m.value&&m.value.updateScrollerWidth()}return(G,L)=>i.value?(t(),n("div",En,[m.value&&!m.value.imageList?(t(),C(yt,{key:0,tutorial:"project"})):f("",!0),(t(),n("div",{id:"panoptic",key:d(p).status.renderNb},[e("div",Pn,[d(s).isLoaded?d(s).isLoaded?(t(),n(E,{key:1},[e("div",null,[_(Gs,{onExport:L[0]||(L[0]=P=>A()),onToggle:k})]),e("div",On,[e("div",{class:"ms-1",ref_key:"navElem",ref:c},[_(gn,{"re-render":w,filterOpen:l.value,"onUpdate:filterOpen":L[1]||(L[1]=P=>l.value=P)},null,8,["filterOpen"])],512),v.value?(t(),n("div",Ln)):f("",!0),_(De,{id:d(o).mainTab},{default:b(({tab:P})=>[_(an,{tab:P,height:r.value,ref_key:"mainViewRef",ref:m,"filter-open":l.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):d(a).isProjectLoaded?(t(),n("div",An,L[2]||(L[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(t(),n("div",Dn,[e("div",Rn,[e("div",null,x(G.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:I,style:{"font-size":"50px",cursor:"pointer"}})])])):(t(),n("div",{key:0,class:"d-flex flex-column w-100",style:X({height:y.value+"px"})},[_(Tn,{class:"flex-grow-1"})],4))])]))])):f("",!0)}});const Nn=U(Un,[["__scopeId","data-v-efb0ce4d"]]);export{Nn as default};
