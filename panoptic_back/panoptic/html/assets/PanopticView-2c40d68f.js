import{d as E,f as G,r as C,c as I,g as ae,o as s,a as l,b as t,w as oe,v as re,F as O,i as R,m as k,x as ie,t as b,l as V,q as $,n as D,D as Z,y as ze,_ as N,z as de,A as q,B as Ce,j as r,P as fe,k as y,C as Me,E as M,G as Le,H as De,I as Ge,J as Ne,K as je,p as W,e as Y,L as ke,N as F,O as he,s as K,T as Re,Q as Ve,R as H,S as me,U as $e,u as ye,M as se,V as Ue,W as He,X as xe,Y as Oe,Z as qe,$ as te,a0 as J,a1 as Ae,a2 as ue,a3 as Be,a4 as Ke,a5 as Fe,a6 as Qe,a7 as We,a8 as Ye,a9 as ne,aa as Xe,ab as Je,ac as Ze,ad as ee,ae as et,af as tt,ag as st,ah as ot,h as we,ai as X,aj as at}from"./index-a182566b.js";const lt={class:"mb-1 ps-2 pe-2"},nt=["onClick"],be=E({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(i,{emit:d}){const e=G(),o=i,c=d,g=C(null),m=C(""),f=I(()=>{let v=e.propertyList;return o.ignoreIds&&(v=v.filter(_=>!o.ignoreIds.includes(_.id))),v.filter(_=>_.name.includes(m.value))});return ae(()=>g.value.focus()),(v,_)=>(s(),l("div",null,[t("div",lt,[oe(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:g,"onUpdate:modelValue":_[0]||(_[0]=a=>m.value=a)},null,512),[[re,m.value]])]),(s(!0),l(O,null,R(f.value,a=>(s(),l("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:n=>c("select",a.id)},[k(ie,{type:a.type,class:"me-2"},null,8,["type"]),t("a",null,b(a.name),1)],8,nt))),256))]))}}),it=["disabled"],rt={class:"m-0 p-1"},dt=["onClick"],ut=E({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(i,{emit:d}){const e=G(),o=i,c=d,g=C(null),m=I(()=>e.data.properties[o.propertyId]),f=I(()=>ze(m.value.type));async function v(_){c("update:modelValue",_),g.value.hide()}return(_,a)=>(s(),V(Z,{onHide:a[0]||(a[0]=n=>c("hide")),ref_key:"dropdownElem",ref:g,parent:o.parent},{button:$(()=>[t("div",{class:D(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,b(_.$t("modals.filters.operators."+o.modelValue)),1)],10,it)]),popup:$(()=>[t("div",rt,[(s(!0),l(O,null,R(f.value,n=>(s(),l("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>v(n)},[t("a",null,b(_.$t("modals.filters.operators."+n)),1)],8,dt))),256))])]),_:1},8,["parent"]))}});const pt=N(ut,[["__scopeId","data-v-29ed354e"]]),ct=i=>(W("data-v-3be6ab26"),i=i(),Y(),i),_t={class:"m-0 p-0"},mt={key:1},vt={class:"d-flex mode-header"},gt={class:"me-3"},ft=ct(()=>t("div",{class:"flex-fill"},null,-1)),ht={key:0,class:"me-2",style:{width:"100%"}},yt=E({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(i){const d=G(),e=i,o=C(null),c=C(null),g=C(null),m=C(0),f=C(-1),v=C(null),_=I(()=>e.filterId!=null?e.filterId:f.value),a=I(()=>{if(!(_.value==null||_.value==-1))return e.manager.filterIndex[_.value]}),n=I(()=>a.value==null?void 0:d.data.properties[a.value.propertyId]);function u(){m.value=e.mode,e.mode==2&&e.filterId==null&&w(e.propertyId)}function p(){o.value&&o.value.hide()}function h(){m.value=0}function S(){p(),e.manager.deleteFilter(_.value),e.manager.update(!0)}function w(j){let z=e.manager.addNewFilter(j,e.parentId);e.manager.update(!0),f.value=z.id,m.value=2}function x(j){e.manager.updateFilter(_.value,{operator:j}),e.manager.update(!0),c.value&&c.value.focus()}function T(){e.manager.updateFilter(_.value,{value:v.value}),e.manager.update(!0)}function P(){if(!a.value)return;const j=d.data.properties[a.value.propertyId];if(Ne(j.type))return;const z=v.value??je(j.type);a.value.value!=z&&T()}function B(){a.value&&(v.value=a.value.value)}return ae(B),q(()=>{var j;return(j=a.value)==null?void 0:j.value},()=>B()),(j,z)=>(s(),V(Z,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:h,parent:e.parent},{button:$(()=>[t("div",_t,[Ce(j.$slots,"default",{},void 0,!0)])]),popup:$(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:g},[m.value!=0?(s(),l(O,{key:0},[m.value==1?(s(),V(be,{key:0,onSelect:w,"ignore-ids":[r(fe).folders]},null,8,["ignore-ids"])):y("",!0),m.value==2?(s(),l("div",mt,[t("div",vt,[t("div",gt,b(n.value.name),1),k(pt,{"property-id":a.value.propertyId,"model-value":a.value.operator,"onUpdate:modelValue":x,parent:g.value},null,8,["property-id","model-value","parent"]),ft,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:S})])]),r(Me)(a.value.operator)?(s(),l("div",ht,[n.value.type==r(M).multi_tags||n.value.type==r(M).tag?(s(),V(Le,{key:0,modelValue:v.value,"onUpdate:modelValue":[z[0]||(z[0]=L=>v.value=L),T],"auto-focus":!0,property:r(d).data.properties[a.value.propertyId],ref_key:"inputElem",ref:c,onHide:p},null,8,["modelValue","property"])):n.value.type==r(M).color?(s(),V(De,{key:1,property:n.value,modelValue:v.value,"onUpdate:modelValue":[z[1]||(z[1]=L=>v.value=L),z[2]||(z[2]=()=>{p(),P()})]},null,8,["property","modelValue"])):(s(),V(Ge,{key:2,"no-html":!0,modelValue:v.value,"onUpdate:modelValue":z[3]||(z[3]=L=>v.value=L),width:-1,"min-height":20,"no-nl":r(d).data.properties[a.value.propertyId].type==r(M).number,"url-mode":r(d).data.properties[a.value.propertyId].type==r(M).url,"only-number":r(d).data.properties[a.value.propertyId].type==r(M).number,onBlur:P,"auto-focus":!0,ref_key:"inputElem",ref:c},null,8,["modelValue","no-nl","url-mode","only-number"]))])):y("",!0)])):y("",!0)],64)):y("",!0)],512)]),_:3},8,["parent"]))}});const pe=N(yt,[["__scopeId","data-v-3be6ab26"]]),le=i=>(W("data-v-66fff643"),i=i(),Y(),i),bt={class:"d-flex flex-row"},kt={key:1,class:"d-flex",style:{width:"150px"}},$t={class:"flex-grow-1"},xt={key:1,style:{"padding-top":"1px"}},wt={style:{width:"20px","margin-top":"2px"},class:"text-center"},It=le(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),St={class:"text-center",style:{width:"20px","margin-top":"2px"}},Ct=le(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Mt=le(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Vt={key:0,class:"ms-3 pt-1"},Ot=le(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Ft=le(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Et=le(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Tt=le(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Pt={key:1},zt=E({__name:"PropertyOptions",props:{property:Object},setup(i){const d=G(),e=d.getTabManager(),o=i,c=C(!1),g=C(!1),m=C(""),f=C(!1),v=I(()=>d.getTab()),_=I(()=>v.value.visibleProperties[o.property.id]==!0),a=I(()=>e.collection.filterManager.state.filter.filters.some(L=>!L.isGroup&&L.propertyId==o.property.id)),n=I(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),u=I(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),p=I(()=>{if(a.value)return e.collection.filterManager.state.filter.filters.find(L=>!L.isGroup&&L.propertyId==o.property.id).id}),h=()=>e.collection.filterManager,S=I(()=>e.getSha1Mode());function w(){_.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function x(){c.value?c.value=!1:(c.value=!0,m.value=o.property.name),g.value=!1}function T(){o.property.type!=M.tag&&o.property.type!=M.multi_tags||(g.value?g.value=!1:g.value=!0,c.value=!1)}function P(){u.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function B(){n.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function j(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&d.deleteProperty(o.property.id)}function z(){m.value!=""&&d.updateProperty(o.property.id,m.value)}return q(()=>o.property,()=>{c.value=!1}),(L,U)=>(s(),l("div",{class:D(f.value?"hover-light":"")},[t("div",bt,[c.value?y("",!0):(s(),l("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:x},[k(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:U[0]||(U[0]=Q=>f.value=!0),onMouseleave:U[1]||(U[1]=Q=>f.value=!1)},null,8,["type"]),t("span",null,b(o.property.name),1)])),c.value?(s(),l("div",kt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:x,onMouseenter:U[2]||(U[2]=Q=>f.value=!0),onMouseleave:U[3]||(U[3]=Q=>f.value=!1)},null,32)]),t("div",$t,[o.property.id>=0?oe((s(),l("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":U[4]||(U[4]=Q=>m.value=Q),onChange:z},null,544)),[[re,m.value]]):(s(),l("span",xt,[k(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,b(o.property.name),1)]))])])):y("",!0),t("div",wt,[o.property.mode==r(ke).id?(s(),V(F,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:$(()=>[It]),_:1})):y("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:w,class:"btn-icon text-center"},[S.value&&o.property.mode==r(ke).id?(s(),V(F,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:$(()=>[t("span",{class:"bi bi-eye-slash",onClick:U[5]||(U[5]=he(()=>{},["stop"]))})]),_:1})):(s(),V(F,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:$(()=>[t("span",{class:D("bi bi-eye text-"+(_.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",St,[o.property.type==r(M).tag||o.property.type==r(M).multi_tags?(s(),l("div",{key:0,onClick:T,style:{cursor:"pointer"}},[g.value?(s(),V(F,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:$(()=>[Ct]),_:1})):(s(),V(F,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:$(()=>[Mt]),_:1}))])):y("",!0)])]),t("div",null,[c.value?(s(),l("div",Vt,[t("div",{class:D(["options hover-light",a.value?" text-primary":""])},[k(pe,{manager:h(),"filter-id":p.value,mode:2,"property-id":i.property.id},{default:$(()=>[Ot,K(b(L.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:D(["options hover-light",u.value?" text-primary":""]),onClick:P},[Ft,K(b(L.$t("main.menu.sort.title")),1)],2),t("div",{class:D(["options hover-light",n.value?" text-primary":""]),onClick:B},[Et,K(b(L.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),l("div",{key:0,class:"options hover-light",onClick:j},[Tt,K(b(L.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):g.value?(s(),l("div",Pt,[k(Re,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])],2))}});const Ie=N(zt,[["__scopeId","data-v-66fff643"]]),Lt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Dt={class:"p-2"},Gt=["onClick"],Nt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),jt=E({__name:"FolderOptionDropdown",props:{folder:{}},setup(i){const d=G(),e=i;function o(){d.reImportFolder(e.folder.id)}return(c,g)=>(s(),V(Z,{teleport:!0},{button:$(()=>[Lt]),popup:$(({hide:m})=>[t("div",Dt,[t("div",{class:"base-hover p-1",onClick:f=>{o(),m()}},[Nt,K(" Re import")],8,Gt)])]),_:1}))}}),Rt=["onMouseenter"],Ut=["onClick"],Ht={class:"text-secondary"},qt=["onClick"],At=E({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(i){const d=G(),e=i,o=C(null),c=I(()=>{let a={};const n=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{n.has(u)&&(a[u]=!0)}),a}),g=I(()=>{let a={};return e.folders.map(n=>n.id).forEach(n=>{e.visibleFolders[n]&&(a[n]=!0)}),a}),m=I(()=>{let a={};return e.folders.forEach(n=>{let u=[];c.value[n.id]&&u.push("selected"),a[n.id]=u.join(" ")}),a});function f(a){let n=e.visibleFolders;n[a]?delete n[a]:n[a]=!0}function v(a){let n=new Set(e.filterManager.state.folders);const u=n.has(a),p=d.data.folders[a].parent!=null&&n.has(d.data.folders[a].parent);u&&!p?(n.delete(a),me(a).forEach(h=>n.delete(h.id))):(_(a,n),n.add(a),me(a).forEach(h=>n.add(h.id)),$e(d.data.folders[a]).forEach(h=>n.delete(h.id))),e.filterManager.setFolders(Array.from(n)),e.filterManager.update(!0)}function _(a,n){const u=$e(d.data.folders[a]);let p;for(let h of u)if(n.has(h.id))p=h;else break;p!=null&&me(p.id).forEach(h=>n.delete(h.id))}return(a,n)=>{const u=Ve("FolderList2",!0);return s(),l("ul",{class:D(e.root?"tree":""),style:H(e.root?"padding-left:0px;":"")},[(s(!0),l(O,null,R(i.folders,p=>(s(),l("li",{style:H(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:h=>o.value=p.id,onMouseleave:n[0]||(n[0]=h=>o.value=null)},[t("summary",{class:D(m.value[p.id]),onClick:h=>v(p.id)},[K(b(p.name)+" ",1),t("span",Ht,b(p.count),1)],10,Ut),p.children&&p.children.length>0?(s(),l("i",{key:0,onClick:h=>f(p.id),class:D("bi bi-chevron-"+(g.value[p.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,qt)):y("",!0),t("span",{class:D(o.value===p.id?"visible-option":"invisible-option")},[k(jt,{folder:p,style:{display:"inline-block"}},null,8,["folder"])],2),p.children&&p.children.length>0&&g.value[p.id]?(s(),V(u,{key:1,folders:p.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):y("",!0)],44,Rt))),256))],6)}}});const Bt=N(At,[["__scopeId","data-v-9f26453b"]]),Kt={class:"text-center"},Qt={class:"w-100 text-center",style:{"font-size":"10px"}},Wt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Yt=E({__name:"TaskStatus",props:{task:{}},setup(i){const d=i,e=I(()=>d.task.total-d.task.remain-d.task.computing),o=I(()=>d.task.total);return(c,g)=>(s(),l("div",Kt,[K(b(d.task.name)+" ",1),t("div",Qt,b(e.value)+" / "+b(o.value)+" "+b(c.$t("main.nav.tasks.done")),1),o.value>0?(s(),l("div",Wt,[t("div",{class:"progress-bar",style:H(`width: ${e.value/o.value*100}%`)},null,4)])):y("",!0)]))}}),A=i=>(W("data-v-8849cbb4"),i=i(),Y(),i),Xt={class:"menu overflow-scroll"},Jt={class:""},Zt={class:"m-0",style:{padding:"4px 0px 4px 8px"}},es={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ts=A(()=>t("i",{class:"bi bi-gear"},null,-1)),ss=[ts],os=A(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),as=[os],ls=A(()=>t("div",{class:"custom-hr"},null,-1)),ns={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},is={class:"d-flex align-items-center"},rs=A(()=>t("i",{class:"bi bi-plus"},null,-1)),ds={class:"overflow-scroll"},us=A(()=>t("div",{class:"custom-hr"},null,-1)),ps={class:"pt-1 pb-2"},cs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},_s=A(()=>t("div",{class:"custom-hr"},null,-1)),ms={key:0,class:"ps-2 pe-2"},vs={class:"p-1"},gs={key:0,class:"custom-hr"},fs={key:0,class:"p-2"},hs=A(()=>t("div",{class:"custom-hr"},null,-1)),ys={key:0,class:"float-end"},bs={class:"text-center"},ks={class:"w-100 text-center",style:{"font-size":"10px"}},$s={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},xs={key:1,class:"p-2"},ws={class:"w-100 text-center",style:{"font-size":"10px"}},Is={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ss=A(()=>t("div",{class:"custom-hr"},null,-1)),Cs={class:"p-2 mt-0"},Ms={class:"d-flex"},Vs=A(()=>t("span",{class:"flex-grow-1"},null,-1)),Os={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Fs=A(()=>t("span",{class:"sr-only"},null,-1)),Es=[Fs],Ts={key:1,class:"me-3"},Ps={class:"me-3"},zs={key:0,class:"mt-2"},Ls={key:0,class:"property-item"},Ds=A(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Gs=A(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ns=A(()=>t("div",{class:"custom-hr"},null,-1)),js={class:"p-2 mt-0"},Rs={key:0,class:"mt-2"},Us={key:0,class:"property-item"},Hs=E({__name:"Menu",emits:["export"],setup(i,{emit:d}){const e=G(),o=ye(),c=e.getTabManager(),g=C(!1);C(null);const m=C(!1),f=async a=>{o.showModal(se.IMPORT)};function v(){o.showModal(se.FOLDERSELECTION,{callback:_,mode:"images"})}function _(a){a&&e.addFolder(a)}return q(()=>e.status.import.to_import,()=>g.value=!0),(a,n)=>{var u;return s(),l("div",Xt,[t("div",Jt,[t("div",null,[t("div",Zt,[t("div",es,[t("div",{class:"flex-grow-1 text-capitalize",onClick:n[0]||(n[0]=()=>{})},b((u=r(o).data.status.selectedProject)==null?void 0:u.name),1),t("div",{class:"base-hover p-1",onClick:n[1]||(n[1]=p=>r(o).showModal(r(se).SETTINGS))},ss),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:n[2]||(n[2]=p=>r(o).closeProject())},as)])]),ls,t("div",ns,[t("div",is,[t("div",null,[t("b",null,b(a.$t("main.nav.folders.title")),1)]),t("div",{class:"ms-auto plus",onClick:v},[k(F,{message:"main.nav.folders.add"},{default:$(()=>[rs]),_:1})])]),t("div",ds,[r(e).getTab()?(s(),V(Bt,{key:0,folders:r(e).folderRoots,"filter-manager":r(c).collection.filterManager,"visible-folders":r(c).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):y("",!0)])]),us,t("div",ps,[t("div",cs,[t("div",null,[t("b",null,b(a.$t("main.nav.tasks.title")),1)])]),_s,r(e).backendStatus?(s(),l("div",ms,[(s(!0),l(O,null,R(r(e).backendStatus.tasks,(p,h)=>(s(),l("div",vs,[h?(s(),l("div",gs)):y("",!0),k(Yt,{task:p},null,8,["task"])]))),256))])):y("",!0)]),r(e).status.import.to_import!=null&&r(e).status.import.to_import>0&&g.value?(s(),l("div",fs,[hs,r(e).status.import.done?(s(),l("div",ys,[t("i",{class:"bi bi-x base-hover",onClick:n[3]||(n[3]=p=>g.value=!1)})])):y("",!0),t("div",bs,[t("b",null,b(a.$t("main.menu.import_status_title")),1)]),t("div",ks,b(r(e).status.import.imported)+" / "+b(r(e).status.import.to_import)+" importées ",1),r(e).status.import.to_import>0?(s(),l("div",$s,[t("div",{class:"progress-bar",style:H(`width: ${r(e).status.import.imported/r(e).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),r(e).status.import.to_import!=null&&r(e).status.import.to_import>0&&g.value?(s(),l("div",xs,[t("div",ws,b(r(e).status.import.computed)+" / "+b(r(e).status.import.to_import)+" computed ",1),r(e).status.import.to_import>0?(s(),l("div",Is,[t("div",{class:"progress-bar",style:H(`width: ${r(e).status.import.computed/r(e).status.import.to_import*100}%`)},null,4)])):y("",!0)])):y("",!0),Ss,t("div",Cs,[t("div",Ms,[k(F,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:$(()=>[t("b",null,b(a.$t("main.nav.properties.title")),1)]),_:1}),Vs,m.value?(s(),l("span",Os,Es)):(s(),l("span",Ts,[k(F,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:$(()=>[t("i",{class:"bi bi-file-earmark-arrow-up btn-icon text-secondary",onClick:f})]),_:1})])),t("span",Ps,[k(F,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:$(()=>[t("i",{class:"bi bi-box-arrow-down btn-icon text-secondary",onClick:n[4]||(n[4]=p=>r(o).showModal(r(se).EXPORT,void 0))})]),_:1})])]),r(e).status.loaded?(s(),l("div",zs,[(s(!0),l(O,null,R(r(e).data.properties,p=>(s(),l(O,null,[p.id>=0?(s(),l("div",Ls,[k(Ie,{property:p},null,8,["property"])])):y("",!0)],64))),256)),Ds,t("div",{onClick:n[5]||(n[5]=p=>r(o).showModal(r(se).PROPERTY,void 0)),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Gs,t("span",null,b(a.$t("main.nav.properties.add_property")),1)])])):y("",!0)]),Ns,t("div",js,[k(F,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:$(()=>[t("b",null,b(a.$t("main.nav.computed.title")),1)]),_:1}),r(e).status.loaded?(s(),l("div",Rs,[(s(!0),l(O,null,R(r(e).data.properties,p=>(s(),l(O,null,[p.id<0?(s(),l("div",Us,[k(F,{pos:"bottom",message:"main.nav.computed."+Math.abs(p.id).toString()+"_tooltip"},{default:$(()=>[k(Ie,{property:p},null,8,["property"])]),_:2},1032,["message"])])):y("",!0)],64))),256))])):y("",!0)])])])])}}});const qs=N(Hs,[["__scopeId","data-v-8849cbb4"]]),As={class:"text-nowrap text-secondary"},Se=E({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(i){const d=G(),e=i,o=I(()=>d.data.properties[e.propertyId].tags);return(c,g)=>(s(),l("div",As,[e.value&&e.value.length>0?(s(!0),l(O,{key:0},R(e.value,m=>(s(),l("span",null,[k(Ue,{tag:o.value[m].value,color:o.value[m].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),l(O,{key:1},[K(" Add Tags... ")],64))]))}}),Bs={key:0},Ks={key:1},Qs={key:2},Ws={key:3},Ys={key:0,class:"bi bi-square"},Xs={key:1,class:"bi bi-check-square"},Js={key:5},Zs={key:6},eo={key:7},to={key:8},so={key:9},oo={key:10},ao={key:11},lo={key:12},no={key:13},io={key:1,class:"text-secondary"},ro=E({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(i){const d=i,e=I(()=>{if(d.value==null)return"white";let c=Number(d.value);return isNaN(c)||c>12?"gray":He[c].color}),o=I(()=>[M._ahash,M._folders,M._sha1,M.string].indexOf(d.property.type)!==-1?'"'+d.value+'"':d.value);return(c,g)=>i.value!=null?(s(),l(O,{key:0},[d.property.type==r(M)._ahash?(s(),l("div",Bs,b(o.value),1)):y("",!0),d.property.type==r(M)._folders?(s(),l("div",Ks,b(o.value),1)):y("",!0),d.property.type==r(M)._sha1?(s(),l("div",Qs,b(o.value),1)):y("",!0),d.property.type==r(M).checkbox?(s(),l("div",Ws,[o.value?(s(),l("i",Ys)):(s(),l("i",Xs))])):y("",!0),d.property.type==r(M).color?(s(),l("div",{key:4,style:H({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):y("",!0),d.property.type==r(M).date?(s(),l("div",Js,b(o.value),1)):y("",!0),d.property.type==r(M).image_link?(s(),l("div",Zs)):y("",!0),d.property.type==r(M).multi_tags?(s(),l("div",eo,[k(Se,{"property-id":d.property.id,value:o.value},null,8,["property-id","value"])])):y("",!0),d.property.type==r(M).number?(s(),l("div",to,b(o.value),1)):y("",!0),d.property.type==r(M).path?(s(),l("div",so,b(o.value),1)):y("",!0),d.property.type==r(M).string?(s(),l("div",oo,b(o.value),1)):y("",!0),d.property.type==r(M)._id||d.property.type==r(M)._height||d.property.type==r(M)._width?(s(),l("div",ao,b(o.value),1)):y("",!0),d.property.type==r(M).tag?(s(),l("div",lo,[k(Se,{"property-id":d.property.id,value:o.value},null,8,["property-id","value"])])):y("",!0),d.property.type==r(M).url?(s(),l("div",no,b(o.value),1)):y("",!0)],64)):(s(),l("span",io,"..."))}}),uo={class:"d-flex hover-light ps-1 overflow-hidden"},po={class:"m-0 p-0 me-2 text-nowrap"},co={key:0,class:"m-0 p-0 me-2",style:{width:"150px"}},_o=E({__name:"FilterPreview",props:{filter:Object},setup(i){const d=G(),e=i,o=I(()=>d.data.properties[e.filter.propertyId]);return(c,g)=>(s(),l("td",uo,[t("div",po,b(c.$t("modals.filters.operators."+e.filter.operator)),1),r(Me)(e.filter.operator)?(s(),l("div",co,[k(ro,{property:o.value,value:e.filter.value},null,8,["property","value"])])):y("",!0)]))}});const mo=N(_o,[["__scopeId","data-v-bdac3fdc"]]),vo={class:"m-0 base-btn",style:{padding:"1px 2px"}},go={class:"p-2"},fo=E({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(i,{emit:d}){const e=G(),o=i,c=d,g=C(null);function m(f){g.value.hide(),c("update:modelValue",e.data.properties[f])}return(f,v)=>(s(),V(Z,{ref_key:"dropdownElem",ref:g,"auto-focus":!1},{button:$(()=>[t("div",vo,[k(ie,{type:o.modelValue.type},null,8,["type"]),K(" "+b(o.modelValue.name),1)])]),popup:$(()=>[t("div",go,[k(be,{modelValue:o.modelValue,"onUpdate:modelValue":v[0]||(v[0]=_=>o.modelValue=_),onSelect:m,"ignore-ids":[r(fe).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ce=i=>(W("data-v-b71e9f72"),i=i(),Y(),i),ho={class:"filter-group"},yo={class:"table table-sm"},bo={class:"align-top ps-2"},ko={key:0,class:"m-0 p-0"},$o={class:"p-0 hover-light ps-1",style:{width:"50px",cursor:"pointer","border-radius":"3px"}},xo={class:""},wo=["onClick"],Io=ce(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),So={key:2,class:"text-secondary"},Co={key:0,class:"p-0 m-0 ps-2"},Mo={key:1,class:"p-0 m-0 ps-2"},Vo={class:"border rounded"},Oo={class:""},Fo=["onClick"],Eo=ce(()=>t("i",{class:"bi bi-trash"},null,-1)),To=[Eo],Po={class:"d-flex text-secondary ms-2"},zo={class:"add-options hover-light"},Lo=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),Do=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),Go=E({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(i,{emit:d}){const e=G(),o=i,c=I(()=>o.filter),g=I(()=>c.value.filters),m=I(()=>{let n=255-(c.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function f(n,u){o.manager.updateFilter(n,{propertyId:u}),o.manager.update(!0)}function v(n){o.manager.deleteFilter(n.id),o.manager.update(!0)}function _(n){o.manager.addNewFilterGroup(n),o.manager.update(!0)}function a(n,u){o.manager.updateFilterGroup(n,u),o.manager.update(!0)}return(n,u)=>{const p=Ve("FilterGroupInput",!0);return s(),l("div",ho,[t("table",yo,[(s(!0),l(O,null,R(g.value,(h,S)=>(s(),l("tr",null,[t("td",bo,[S==0?(s(),l("div",ko,b(n.$t("modals.filters.where")),1)):S==1?(s(),V(Z,{key:1},{button:$(()=>[t("div",$o,[t("span",xo,b(n.$t("modals.filters."+c.value.groupOperator)),1)])]),popup:$(({hide:w})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:w},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=x=>a(c.value.id,r(xe).and))},b(n.$t("modals.filters.and")),1),Io,t("div",{class:"base-btn",onClick:u[1]||(u[1]=x=>a(c.value.id,r(xe).or))},b(n.$t("modals.filters.or")),1)],8,wo)]),_:1})):(s(),l("span",So,b(c.value.groupOperator),1))]),h.propertyId!==void 0?(s(),l("td",Co,[k(fo,{"model-value":r(e).data.properties[h.propertyId],"onUpdate:modelValue":w=>f(h.id,w.id)},null,8,["model-value","onUpdate:modelValue"])])):y("",!0),h.propertyId!==void 0?(s(),l("td",Mo,[k(pe,{class:"flex-grow-1",manager:i.manager,mode:2,"parent-id":c.value.id,"filter-id":h.id,parent:o.parent},{default:$(()=>[k(mo,{filter:h},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),l("td",{key:2,colspan:"3",style:H(m.value)},[t("div",Vo,[k(p,{filter:h,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",Oo,[t("span",{class:"base-btn",onClick:w=>v(h)},To,8,Fo)])]))),256))]),t("div",Po,[k(pe,{manager:o.manager,"parent-id":c.value.id},{default:$(()=>[t("div",zo,[Lo,K(b(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=h=>_(c.value.id))},[Do,K(b(n.$t("modals.filters.new_group")),1)])])])}}});const No=N(Go,[["__scopeId","data-v-b71e9f72"]]),jo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ro={key:0,class:"or-separator"},Uo={key:0,class:"m-1 p-0"},Ho=E({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(i,{emit:d}){const e=G(),o=i,c=C(null),g=C(null),m=I(()=>{let v=f(o.manager.state.filter),_={};return v.forEach(a=>_[a.propertyId]=a),Object.values(_)});function f(v){let _=[];for(let a of v.filters)a.isGroup?_.push(...f(a)):_.push(a);return _}return q(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&g.value.hide()}),(v,_)=>(s(),V(Z,{ref_key:"dropdownElem",ref:g},{button:$(()=>[t("div",null,[m.value.length?(s(),l("div",jo,[(s(!0),l(O,null,R(m.value,(a,n)=>(s(),l("div",null,[n>0?(s(),l("span",Ro,"|")):y("",!0),a.propertyId==r(fe).id?(s(),V(ie,{key:1,type:r(e).data.properties[a.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),t("span",null,b(r(e).data.properties[a.propertyId].name),1)]))),256))])):y("",!0)])]),popup:$(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:c},[Object.keys(r(e).data.properties).length>0?(s(),l("div",Uo,[k(No,{filter:o.manager.state.filter,manager:o.manager,parent:c.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}});const qo=N(Ho,[["__scopeId","data-v-76c39275"]]),Ao=i=>(W("data-v-4759a81b"),i=i(),Y(),i),Bo={class:"d-flex flex-row filter-form"},Ko={class:"pt-1 pb-1"},Qo=Ao(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),Wo=E({__name:"FilterForm",props:{manager:de},setup(i){const d=i;return(e,o)=>(s(),l("div",Bo,[t("div",Ko,b(e.$t("main.menu.filters"))+": ",1),k(qo,{"model-value":d.manager.filter,manager:d.manager},null,8,["model-value","manager"]),k(pe,{manager:d.manager,class:"p-1"},{default:$(()=>[Qo]),_:1},8,["manager"])]))}});const Yo=N(Wo,[["__scopeId","data-v-4759a81b"]]),Xo=i=>(W("data-v-e5b49562"),i=i(),Y(),i),Jo=Xo(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),Zo={class:"p-1"},ea=E({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(i,{emit:d}){const e=i,o=d,c=C(null);return(g,m)=>(s(),V(Z,{ref_key:"dropdownElem",ref:c,"auto-focus":!1},{button:$(()=>[Jo]),popup:$(()=>[t("div",Zo,[k(be,{onSelect:m[0]||(m[0]=f=>{o("select",f),c.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ee=N(ea,[["__scopeId","data-v-e5b49562"]]),ta={class:"base-hover ps-1 pe-1"},sa={class:"main"},oa=["onClick"],aa=E({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:d}){const e=i,o=d,c=Object.values(Oe);function g(m){o("update:modelValue",m)}return(m,f)=>(s(),V(Z,null,{button:$(()=>[t("div",ta,b(e.modelValue),1)]),popup:$(({hide:v})=>[t("div",sa,[(s(!0),l(O,null,R(r(c),_=>(s(),l("div",{class:"base-hover option",onClick:a=>{g(_),v()}},b(_),9,oa))),256))])]),_:1}))}});const la=N(aa,[["__scopeId","data-v-cc9d0d61"]]),na=i=>(W("data-v-a27bea28"),i=i(),Y(),i),ia=na(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ra={class:""},da={class:"d-flex ipt"},ua={class:"ms-2",min:"1"},pa=E({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(i,{emit:d}){const e=i,o=d,c=C(1),g=C(Oe.Year);function m(){e.option.stepSize==c.value&&e.option.stepUnit==g.value||o("change",{stepSize:c.value,stepUnit:g.value})}function f(){c.value=e.option.stepSize??1,g.value=e.option.stepUnit}return q(()=>e.option,f),ae(f),q(c,()=>{(c.value<1||c.value==null||isNaN(c.value))&&(c.value=1)}),(v,_)=>(s(),V(Z,{onHide:m},{button:$(()=>[ia]),popup:$(({hide:a,focus:n})=>[t("div",ra,[t("div",da,[t("div",null,[oe(t("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=u=>c.value=u)},null,512),[[re,c.value]])]),t("div",ua,[k(la,{modelValue:g.value,"onUpdate:modelValue":_[1]||(_[1]=u=>g.value=u),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ca=N(pa,[["__scopeId","data-v-a27bea28"]]),_a={class:"d-flex flex-row group-form"},ma={class:"pt-1 pb-1"},va={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},ga={key:0,class:"bi bi-chevron-right smaller"},fa=["onClick"],ha=["onClick"],ya=["onClick"],ba=["onClick"],ka=["onClick"],$a=["onClick"],xa=["onClick"],wa=["onClick"],Ia=["onClick"],Sa={key:5,class:"sm-btn"},Ca={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ma=E({__name:"GroupForm",props:{isLoading:Boolean,manager:qe},setup(i){const d=G(),e=i;function o(a){e.manager.setGroupOption(a),e.manager.update(!0)}function c(a){e.manager.delGroupOption(a),e.manager.update(!0)}function g(a,n){e.manager.setGroupOption(a,{direction:n}),e.manager.sortGroups(!0)}function m(a,n){e.manager.setGroupOption(a,{type:n}),e.manager.sortGroups(!0)}function f(a,n){e.manager.setGroupOption(a,n),e.manager.update(!0)}const v=I(()=>e.manager.state.groupBy.map(a=>d.data.properties[a])),_=I(()=>{const a=[];return e.manager.state.groupBy.forEach(n=>{a.push({option:e.manager.state.options[n],property:d.data.properties[n]})}),a});return(a,n)=>(s(),l("div",_a,[t("div",ma,b(a.$t("main.menu.groupby"))+": ",1),v.value.length?(s(),l("div",va,[(s(!0),l(O,null,R(_.value,(u,p)=>(s(),l(O,null,[p>0?(s(),l("i",ga)):y("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:h=>c(u.property.id)},b(u.property.name),9,fa),u.option.type==r(te).Size?(s(),V(F,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:$(()=>[u.option.direction==r(J).Ascending?(s(),l("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:h=>m(u.property.id,r(te).Property)},null,8,ha)):(s(),l("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:h=>m(u.property.id,r(te).Property)},null,8,ya))]),_:2},1024)):(s(),V(F,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:$(()=>[u.property.type==r(M).number?(s(),l(O,{key:0},[u.option.direction==r(J).Ascending?(s(),l("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:h=>m(u.property.id,r(te).Size)},null,8,ba)):(s(),l("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:h=>m(u.property.id,r(te).Size)},null,8,ka))],64)):(s(),l(O,{key:1},[u.option.direction==r(J).Ascending?(s(),l("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:h=>m(u.property.id,r(te).Size)},null,8,$a)):(s(),l("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:h=>m(u.property.id,r(te).Size)},null,8,xa))],64))]),_:2},1024)),u.option.direction==r(J).Ascending?(s(),V(F,{key:3,message:"main.menu.sort.order_asc"},{default:$(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:h=>g(u.property.id,r(J).Descending)},null,8,wa)]),_:2},1024)):(s(),V(F,{key:4,message:"main.menu.sort.order_desc"},{default:$(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:h=>g(u.property.id,r(J).Ascending)},null,8,Ia)]),_:2},1024)),u.property.type==r(M).date?(s(),l("div",Sa,[k(ca,{option:u.option,onChange:h=>f(u.property.id,h)},null,8,["option","onChange"])])):y("",!0)],64))),256)),e.isLoading?(s(),l("i",Ca)):y("",!0)])):y("",!0),k(Ee,{"group-ids":e.manager.state.groupBy,onSelect:n[0]||(n[0]=u=>o(u))},null,8,["group-ids"])]))}});const Va=N(Ma,[["__scopeId","data-v-3971e969"]]),Oa={class:"d-flex flex-row sort-form"},Fa={class:"pt-1 pb-1"},Ea={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ta={key:0,class:"bi bi-chevron-right smaller"},Pa=["onClick"],za=["onClick"],La=["onClick"],Da=E({__name:"SortForm",props:{manager:Ae},setup(i){const d=G(),e=i,o=I(()=>e.manager.state.sortBy.map(v=>({propertyId:v,direction:e.manager.state.options[v].direction}))),c=I(()=>o.value.map(v=>v.propertyId));function g(v){e.manager.setSort(v),e.manager.update(!0)}function m(v){e.manager.delSort(v),e.manager.update(!0)}function f(v,_){e.manager.setSort(v,{direction:_}),e.manager.update(!0)}return(v,_)=>(s(),l("div",Oa,[t("div",Fa,b(v.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),l("div",Ea,[(s(!0),l(O,null,R(o.value,(a,n)=>(s(),l(O,null,[n>0?(s(),l("i",Ta)):y("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>m(a.propertyId)},b(r(d).data.properties[a.propertyId].name),9,Pa),a.direction==r(J).Ascending?(s(),V(F,{key:1,message:"main.menu.sort.order_asc"},{default:$(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>f(a.propertyId,r(J).Descending)},null,8,za)]),_:2},1024)):(s(),V(F,{key:2,message:"main.menu.sort.order_desc"},{default:$(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>f(a.propertyId,r(J).Ascending)},null,8,La)]),_:2},1024))],64))),256))])):y("",!0),k(Ee,{"group-ids":c.value,onSelect:_[0]||(_[0]=a=>g(a))},null,8,["group-ids"])]))}});const Ga=N(Da,[["__scopeId","data-v-bc2e0a7f"]]);var ge={name:"Toggle",emits:["input","update:modelValue","change"],props:{value:{validator:function(i){return d=>["number","string","boolean"].indexOf(typeof d)!==-1||d==null},required:!1},modelValue:{validator:function(i){return d=>["number","string","boolean"].indexOf(typeof d)!==-1||d==null},required:!1},id:{type:[String,Number],required:!1,default:"toggle"},name:{type:[String,Number],required:!1,default:"toggle"},disabled:{type:Boolean,required:!1,default:!1},required:{type:Boolean,required:!1,default:!1},falseValue:{type:[String,Number,Boolean],required:!1,default:!1},trueValue:{type:[String,Number,Boolean],required:!1,default:!0},onLabel:{type:[String,Object],required:!1,default:""},offLabel:{type:[String,Object],required:!1,default:""},classes:{type:Object,required:!1,default:()=>({})},labelledby:{type:String,required:!1},describedby:{type:String,required:!1},aria:{required:!1,type:Object,default:()=>({})}},setup(i,d){const e=function(m,f,v){const{value:_,modelValue:a,falseValue:n,trueValue:u,disabled:p}=ue(m),h=a&&a.value!==void 0?a:_,S=I(()=>h.value===u.value),w=P=>{f.emit("input",P),f.emit("update:modelValue",P),f.emit("change",P)},x=()=>{w(u.value)},T=()=>{w(n.value)};return[null,void 0,!1,0,"0","off"].indexOf(h.value)!==-1&&[n.value,u.value].indexOf(h.value)===-1&&T(),[!0,1,"1","on"].indexOf(h.value)!==-1&&[n.value,u.value].indexOf(h.value)===-1&&x(),{externalValue:h,checked:S,update:w,check:x,uncheck:T,handleInput:P=>{w(P.target.checked?u.value:n.value)},handleClick:()=>{p.value||(S.value?T():x())}}}(i,d),o=function(m,f,v){const{trueValue:_,falseValue:a,onLabel:n,offLabel:u}=ue(m),p=v.checked,h=v.update;return{label:I(()=>{let S=p.value?n.value:u.value;return S||(S="&nbsp;"),S}),toggle:()=>{h(p.value?a.value:_.value)},on:()=>{h(_.value)},off:()=>{h(a.value)}}}(i,0,{checked:e.checked,update:e.update}),c=function(m,f,v){const _=ue(m),a=_.disabled,n=v.checked,u=I(()=>({container:"toggle-container",toggle:"toggle",toggleOn:"toggle-on",toggleOff:"toggle-off",toggleOnDisabled:"toggle-on-disabled",toggleOffDisabled:"toggle-off-disabled",handle:"toggle-handle",handleOn:"toggle-handle-on",handleOff:"toggle-handle-off",handleOnDisabled:"toggle-handle-on-disabled",handleOffDisabled:"toggle-handle-off-disabled",label:"toggle-label",..._.classes.value}));return{classList:I(()=>({container:u.value.container,toggle:[u.value.toggle,a.value?n.value?u.value.toggleOnDisabled:u.value.toggleOffDisabled:n.value?u.value.toggleOn:u.value.toggleOff],handle:[u.value.handle,a.value?n.value?u.value.handleOnDisabled:u.value.handleOffDisabled:n.value?u.value.handleOn:u.value.handleOff],label:u.value.label}))}}(i,0,{checked:e.checked}),g=function(m,f,v){const{disabled:_}=ue(m),a=v.check,n=v.uncheck,u=v.checked;return{handleSpace:()=>{_.value||(u.value?n():a())}}}(i,0,{check:e.check,uncheck:e.uncheck,checked:e.checked});return{...e,...c,...o,...g}}};const Na=["tabindex","aria-checked","aria-describedby","aria-labelledby"],ja=["id","name","value","checked","disabled"],Ra=["innerHTML"],Ua=["checked"];ge.render=function(i,d,e,o,c,g){return s(),l("div",Ke({class:i.classList.container,tabindex:e.disabled?void 0:0,"aria-checked":i.checked,"aria-describedby":e.describedby,"aria-labelledby":e.labelledby,role:"switch"},e.aria,{onKeypress:d[1]||(d[1]=Fe(he((...m)=>i.handleSpace&&i.handleSpace(...m),["prevent"]),["space"]))}),[oe(t("input",{type:"checkbox",id:e.id,name:e.name,value:e.trueValue,checked:i.checked,disabled:e.disabled},null,8,ja),[[Be,!1]]),t("div",{class:D(i.classList.toggle),onClick:d[0]||(d[0]=(...m)=>i.handleClick&&i.handleClick(...m))},[t("span",{class:D(i.classList.handle)},null,2),Ce(i.$slots,"label",{checked:i.checked,classList:i.classList},()=>[t("span",{class:D(i.classList.label),innerHTML:i.label},null,10,Ra)]),e.required?(s(),l("input",{key:0,type:"checkbox",style:{appearance:"none",height:"1px",margin:"0",padding:"0",fontSize:"0",background:"transparent",position:"absolute",width:"100%",bottom:"0",outline:"none"},checked:i.checked,"aria-hidden":"true",tabindex:"-1",required:""},null,8,Ua)):y("v-if",!0)],2)],16,Na)},ge.__file="src/Toggle.vue";const Te=i=>(W("data-v-bcbc4b72"),i=i(),Y(),i),Ha={class:"d-flex flex-row p-2"},qa={class:"d-flex flex-row search-input me-5"},Aa=Te(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Ba=["placeholder"],Ka={class:"me-5 d-flex"},Qa=Te(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Wa={class:"ms-5"},Ya={class:"d-flex flex-wrap content-container ps-2"},Xa=E({__name:"ContentFilter",props:{tab:Qe,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(i,{emit:d}){const e=i,o=C(""),c=I(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),g=I(()=>c.value.length);function m(a){e.tab.collection.groupManager.setSha1Mode(a,!0)}function f(){o.value=e.tab.state.filterState.query}function v(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function _(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return ae(f),q(()=>e.tab.collection.filterManager.state.query,f),(a,n)=>(s(),l(O,null,[t("div",Ha,[k(F,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:$(()=>[t("div",qa,[Aa,oe(t("input",{type:"text",class:"input-hidden",placeholder:a.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=u=>o.value=u),onChange:v},null,40,Ba),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")])]),_:1}),t("div",Ka,[k(F,{message:"main.menu.grid_tooltip"},{default:$(()=>[t("i",{class:D("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),k(F,{message:"main.menu.table_tooltip"},{default:$(()=>[t("i",{id:"toot",class:D("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),k(F,{message:"main.menu.image_size_tooltip",click:!1},{default:$(()=>[Qa]),_:1}),t("div",null,[k(We,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":n[3]||(n[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",Wa,[k(F,{message:"main.menu.image_mode_tooltip"},{default:$(()=>[k(r(ge),{"model-value":e.tab.collection.groupManager.state.sha1Mode,"onUpdate:modelValue":m,"on-label":a.$t("main.menu.sha1_images"),"off-label":a.$t("main.menu.all_images"),class:"custom-toggle"},null,8,["model-value","on-label","off-label"])]),_:1})]),g.value?(s(),V(Ye,{key:0,class:"ms-5","selected-images-ids":c.value,"onRemove:selected":n[4]||(n[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0)]),t("div",Ya,[k(Yo,{manager:e.tab.collection.filterManager},null,8,["manager"]),k(Va,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),k(Ga,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Ja=N(Xa,[["__scopeId","data-v-bcbc4b72"]]),Za={class:""},el={key:0,class:"image-count"},tl=["src"],sl={class:"d-flex flex-row"},ol=E({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(i,{emit:d}){const e=ye();G();const o=i,c=d,g=I(()=>`width: ${o.size}px; height: ${o.size}px;`),m=I(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),f=I(()=>o.pile.images[0]);return(v,_)=>(s(),l("div",Za,[t("div",{style:H(g.value),class:"img-container",onClick:_[0]||(_[0]=a=>r(e).showModal(r(se).IMAGE,{image:f.value}))},[o.pile.images.length>1?(s(),l("div",el,b(o.pile.images.length),1)):y("",!0),t("img",{src:f.value.url,style:H(m.value)},null,12,tl)],4),t("div",sl,[k(F,{message:"main.recommand.accept"},{default:$(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:_[1]||(_[1]=a=>c("accept",f.value))}," ✓ ",4)]),_:1}),k(F,{message:"main.recommand.refuse"},{default:$(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:_[2]||(_[2]=a=>c("refuse",f.value))}," ✕ ",4)]),_:1})])]))}});const al=N(ol,[["__scopeId","data-v-e7fb8487"]]),ll=i=>(W("data-v-778a4fed"),i=i(),Y(),i),nl={class:"reco-container"},il={class:"d-flex flex-row m-0 ps-2 pb-2"},rl={class:"text-secondary me-2"},dl={class:"flex-grow-1"},ul={class:"d-flex flex-row"},pl={key:0,class:"separator"},cl=ll(()=>t("i",{class:"bi bi-x"},null,-1)),_l=[cl],ml={class:"d-flex flex-row"},ve=10,vl=E({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(i,{emit:d}){const e=G(),o=i,c=d,g=C(1),m=ne([]),f=ne([]),v=ne([]),_=ne(new Set);function a(w){let x=f.indexOf(w);x<0||(f.splice(x,1),p())}function n(w){v.forEach(x=>{if(x.value!=Ze){const T=e.data.properties[x.propertyId];let P=x.value;T.type==M.multi_tags?e.setTagPropertyValue(x.propertyId,w,[P],"add"):e.setPropertyValue(x.propertyId,w,P)}}),a(w.sha1)}function u(w){_.add(w.sha1),a(w.sha1)}function p(){m.length=0;const w=f.map(x=>({sha1:x,images:e.data.sha1Index[x]}));h(w,m,g.value,o.imageSize,o.width)}function h(w,x,T,P,B){let j=B,z=[],L=0;for(let U=0;U<w.length&&!(x.length>=T);U++){let Q=w[U];if(Q.images[0],_.has(Q.sha1))continue;let _e=P+ve;if(L+_e<j){z.push(Q),L+=_e;continue}if(z.length==0)throw new Error("Images seems to be to big for the line");x.push(z),x.length<T&&(z=[Q],L=_e)}z.length>0&&x.length<T&&x.push(z)}async function S(){if(!o.group)return;console.log("get reco");const w=o.group.images.map(B=>B.id);let x=await Xe({instanceIds:w});x.matches.sort((B,j)=>j.score-B.score);const T=Array.from(new Set(x.matches.map(B=>e.data.images[B.id].sha1)));v.length=0;let P=o.group;for(;P;)v.push(...P.meta.propertyValues),P=P.parent;f.length=0,f.push(...T),p(),_.clear(),c("update")}return ae(S),q(()=>o.group,()=>{S(),_.clear()}),q(()=>o.imageSize,p),q(()=>o.width,p),(w,x)=>(s(),l("div",nl,[t("div",il,[k(F,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:$(()=>[t("span",rl,b(w.$t("main.recommand.title")),1)]),_:1}),t("div",dl,[t("div",ul,[(s(!0),l(O,null,R(v,(T,P)=>(s(),l(O,null,[k(Je,{class:"",value:T},null,8,["value"]),P<v.length-1?(s(),l("div",pl)):y("",!0)],64))),256))])]),t("span",{class:"text-secondary scroll ps-1 pe-1 clickable",onClick:x[0]||(x[0]=T=>c("scroll",o.group.id))},b(w.$t("main.recommand.group")),1),t("span",{class:"text-secondary me-1 close ps-1 pe-1 clickable",onClick:x[1]||(x[1]=T=>c("close"))},_l)]),t("div",{style:H("margin-left:"+ve+"px;")},[(s(!0),l(O,null,R(m,T=>(s(),l("div",null,[t("div",ml,[(s(!0),l(O,null,R(T,P=>(s(),V(al,{pile:P,size:o.imageSize,onAccept:n,onRefuse:u,style:H("margin-right:"+ve+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const gl=N(vl,[["__scopeId","data-v-778a4fed"]]),fl={key:0,class:"m-0 p-0"},hl={key:0,style:{"margin-left":"10px"}},yl=E({__name:"MainView",props:{tabId:Number,height:Number},setup(i){const d=G(),e=d.getTabManager(),o=i,c=C({}),g=C(null),m=C(null),f=C(null),v=C([]),_=C(0),a=C(0),n=ne({groups:!1}),u=I(()=>e.getVisibleProperties());function p(){g.value&&m.value?_.value=o.height-g.value.clientHeight-m.value.clientHeight-5:g.value?_.value=o.height-g.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{f.value&&e.state.display=="tree"&&f.value.computeLines()});function h(x){c.value=e.collection.groupManager.result.index[x],ee(()=>p())}async function S(x){x===""?v.value=[]:v.value=await st({text:x})}function w(){c.value={},ee(()=>p())}return ae(()=>{a.value=g.value.clientWidth,window.addEventListener("resize",()=>{ee(()=>{var x;a.value=((x=g.value)==null?void 0:x.clientWidth)??a.value})})}),q(e.state,()=>{d.updateTab(e.state)},{deep:!0}),q(()=>e.state.imageSize,()=>ee(p)),q(()=>o.height,async()=>{await ee(p)}),(x,T)=>(s(),l(O,null,[t("div",{class:"",ref_key:"filterElem",ref:g},[k(Ja,{tab:r(e),"compute-status":n,onSearchImages:S},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:m,class:"m-0 p-0"},[c.value.id?(s(),l("div",fl,[k(gl,{group:c.value,"image-size":r(e).state.imageSize,width:a.value,height:50,onClose:w,onScroll:f.value.scrollTo,onUpdate:T[0]||(T[0]=P=>ee(()=>p()))},null,8,["group","image-size","width","onScroll"])])):y("",!0)],512),a.value>0&&_.value>0?(s(),l("div",hl,[r(e).state.display=="tree"?(s(),V(et,{key:0,"group-manager":r(e).collection.groupManager,"image-size":r(e).state.imageSize,height:_.value-0,properties:u.value,"selected-images":r(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:f,width:a.value-10,onRecommend:h},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),r(e).state.display=="grid"?(s(),l("div",{key:1,style:H({width:a.value-12+"px"}),class:"p-0 m-0 grid-container"},[k(tt,{manager:r(e).collection.groupManager,height:_.value-15,width:a.value-40,"selected-properties":u.value,class:"p-0 m-0","show-images":!0,"selected-images":r(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:f},null,8,["manager","height","width","selected-properties","selected-images"])],4)):y("",!0)])):y("",!0)],64))}});const bl=N(yl,[["__scopeId","data-v-5ff9a749"]]),kl={class:"d-flex d-row",style:{cursor:"pointer"}},$l=["onMouseenter","onMouseleave"],xl=["onClick"],wl=["onClick"],Il=["onClick"],Sl=["onSubmit"],Cl=["onKeydown","onUpdate:modelValue"],Ml=t("span",{class:"bi bi-plus"},null,-1),Vl=[Ml],Ol={class:"lang"},Fl=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),El=["value"],Tl=E({__name:"TabNav",props:{reRender:Function},setup(i){const d=G(),e=C(-1),o=C(""),c=C(null),g=i;function m(p){d.data.selectedTabId==p||v(),d.selectTab(p)}function f(p){e.value=p,o.value=d.data.tabs[p].name,ee(()=>c.value[0].focus())}function v(){e.value=-1,o.value=""}function _(p){d.addTab("New Tab")}async function a(p){confirm("Are you sure to delete Tab: "+p.name)&&await d.removeTab(p.id)}const n=ne({});C(-1);const u=["fr","en"];return(p,h)=>(s(),l("nav",null,[t("div",kl,[(s(!0),l(O,null,R(r(d).data.tabs,S=>(s(),l("div",{class:"d-flex d-row me-2",onMouseenter:w=>n[S.id]=!0,onMouseleave:w=>n[S.id]=!1},[e.value!=S.id?(s(),l(O,{key:0},[k(F,{message:"main.menu.rename_tab_tooltip"},{default:$(()=>[t("i",{onClick:w=>f(S.id),class:D(["bi bi-pencil me-1 tab-icon hover-light",n[S.id]&&r(d).data.selectedTabId==S.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,xl)]),_:2},1024),t("div",{class:D(["tab-button",S.id==r(d).data.selectedTabId?" active":""]),onClick:w=>m(S.id)},[t("span",null,b(S.name),1)],10,wl),k(F,{message:"main.menu.delete_tab_tooltip"},{default:$(()=>[t("i",{onClick:w=>a(S),class:D(["btn-icon bi bi-x tab-icon hover-light",n[S.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Il)]),_:2},1024)],64)):(s(),l("div",{key:1,class:D(["tab-button",S.id==r(d).data.selectedTabId?" active":""])},[t("form",{onSubmit:he(v,["stop","prevent"])},[oe(t("input",{onFocusout:v,onKeydown:Fe(v,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":w=>S.name=w,ref_for:!0,ref_key:"inputElem",ref:c},null,40,Cl),[[re,S.name]])],40,Sl)],2))],40,$l))),256)),k(F,{message:"main.menu.add_tab_tooltip"},{default:$(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_},Vl)]),_:1}),t("div",Ol,[Fl,oe(t("select",{"onUpdate:modelValue":h[0]||(h[0]=S=>p.$i18n.locale=S),onChange:h[1]||(h[1]=S=>g.reRender())},[(s(),l(O,null,R(u,(S,w)=>t("option",{key:`Lang${w}`,value:S},b(S.toUpperCase()),9,El)),64))],544),[[ot,p.$i18n.locale]])])])]))}});const Pe=i=>(W("data-v-6ad6a4b6"),i=i(),Y(),i),Pl={class:"d-flex flex-row m-0 p-0 overflow-hidden"},zl={key:0},Ll={key:1,class:"w-100"},Dl={key:0,class:"custom-hr"},Gl={key:2,class:"loading"},Nl={class:"text-center"},jl={key:3,class:"loading"},Rl=Pe(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Ul=Pe(()=>t("span",{class:"ms-1"},"Loading...",-1)),Hl=[Rl,Ul],ql=E({__name:"PanopticView",setup(i){const d=G(),e=ye(),o=C(null),c=C(null),g=C(window.innerHeight),m=C(!1),f=I(()=>{var p;return g.value-(((p=c.value)==null?void 0:p.clientHeight)??0)}),v=I(()=>{var p;return(p=o.value)==null?void 0:p.filteredImages.map(h=>h.id)});ae(async()=>{e.isProjectLoaded||we.push("/"),ee(()=>{window.addEventListener("resize",_),_()}),window.addEventListener("keydown",p=>{p.key=="Control"&&(X.ctrl=!0),p.key=="Alt"&&(X.alt=!0),p.key=="Shift"&&(X.shift=!0)}),window.addEventListener("keyup",p=>{p.key=="Control"&&(X.ctrl=!1),p.key=="Alt"&&(X.alt=!1),p.key=="Shift"&&(X.shift=!1)}),window.addEventListener("mousemove",p=>{X.ctrl=p.ctrlKey,X.alt=p.altKey,X.shift=p.shiftKey})}),at(()=>{window.removeEventListener("resize",_)});function _(){g.value=window.innerHeight,m.value=!0}function a(){e.showModal(se.EXPORT,v)}function n(){d.rerender()}function u(){we.push("/")}return(p,h)=>(s(),l("div",{id:"panoptic",key:r(d).status.renderNb},[t("div",Pl,[r(d).status.loaded?(s(),l("div",zl,[k(qs,{onExport:h[0]||(h[0]=S=>a())})])):y("",!0),r(d).status.loaded?(s(),l("div",Ll,[t("div",{class:"ms-3",ref_key:"navElem",ref:c},[k(Tl,{"re-render":n})],512),m.value?(s(),l("div",Dl)):y("",!0),r(d).status.loaded?(s(),V(bl,{key:1,"tab-id":r(d).data.selectedTabId,height:f.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):y("",!0)])):r(e).isProjectLoaded?(s(),l("div",jl,Hl)):(s(),l("div",Gl,[t("div",Nl,[t("div",null,b(p.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))}});const Bl=N(ql,[["__scopeId","data-v-6ad6a4b6"]]);export{Bl as default};
