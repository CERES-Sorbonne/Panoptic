import{d as O,A as H,k as V,D as se,l as _,b as e,i as te,t as x,S as He,o as s,V as Ie,r as M,c as z,a as n,f as X,n as B,F as P,s as Y,h as f,W as pe,q as y,e as u,X as Ee,Y as ke,Z as Te,_ as U,$ as ce,m as J,a0 as q,a1 as Pe,j as Z,a2 as Oe,u as de,a3 as me,a4 as ge,w as ye,v as be,a5 as Ge,M as ee,x as F,a6 as Se,O as N,a7 as Ve,a8 as We,a9 as le,aa as Le,H as qe,g as Ce,ab as ze,ac as Qe,ad as Ke,K as Ye,ae as Xe,af as Ze,L as Je,R as et,Q as tt,ag as st,ah as ot,ai as De,aj as Ae,ak as at,al as ne,am as oe,an as nt,ao as lt,ap as it,aq as rt,ar as dt,as as ut,at as pt,au as ve,av as Me,aw as ct,ax as mt,ay as gt,az as vt,aA as ft,aB as yt,aC as bt,p as Fe,B as j}from"./index-DWXsa7iI.js";import{_ as ht}from"./Tutorial-C9Gk__cm.js";const _t={class:"text-nowrap"},kt=["onClick"],$t=["onClick"],xt=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(k){const d=H(),t=k;function o(){d.reImportFolder(t.folder.id)}function a(){confirm(He.global.t("main.nav.folders.del_alert"))&&d.deleteFolder(t.folder.id)}return(m,p)=>(s(),V(se,{teleport:!0},{button:_(()=>p[0]||(p[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:_(({hide:b})=>[e("div",_t,[e("div",{class:"p-2 bb",onClick:g=>{o(),b()}},p[1]||(p[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),te("Re import")]),8,kt),p[3]||(p[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:g=>{a(),b()}},[p[2]||(p[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),te(x(m.$t("main.nav.folders.del")),1)],8,$t)])]),_:1}))}}),wt=["onMouseenter"],St=["onClick"],Ct={class:"text-secondary"},It=["onClick"],Vt=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0},tab:Object},setup(k){const d=H(),t=k,o=M(null),a=z(()=>{let i={};const l=new Set(t.filterManager.state.folders);return t.folders.map(c=>c.id).forEach(c=>{l.has(c)&&(i[c]=!0)}),i}),m=z(()=>{let i={};return t.folders.map(l=>l.id).forEach(l=>{t.visibleFolders[l]&&(i[l]=!0)}),i}),p=z(()=>{let i={};return t.folders.forEach(l=>{let c=[];a.value[l.id]&&c.push("selected"),i[l.id]=c.join(" ")}),i});function b(i){let l=t.visibleFolders;l[i]?delete l[i]:l[i]=!0}function g(i){let l=new Set(t.filterManager.state.folders);const c=l.has(i),h=d.folders[i].parent!=null&&l.has(d.folders[i].parent);c&&!h?(l.delete(i),ke(i).forEach(S=>l.delete(S.id))):(r(i,l),l.add(i),ke(i).forEach(S=>l.add(S.id)),Te(d.folders[i]).forEach(S=>l.delete(S.id))),t.filterManager.setFolders(Array.from(l)),t.tab.setSelectedFolder(l),t.filterManager.update(!0)}function r(i,l){const c=Te(d.folders[i]);let h;for(let S of c)if(l.has(S.id))h=S;else break;h!=null&&ke(h.id).forEach(S=>l.delete(S.id))}return(i,l)=>{const c=Ee("FolderList2",!0);return s(),n("ul",{class:B(t.root?"tree":""),style:X(t.root?"padding-left:0px;":"")},[(s(!0),n(P,null,Y(k.folders,h=>(s(),n("li",{style:X(t.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:S=>o.value=h.id,onMouseleave:l[1]||(l[1]=S=>o.value=null)},[e("summary",{class:B(p.value[h.id]),onClick:S=>g(h.id)},[e("span",{class:B(o.value===h.id?"visible-option":"invisible-option"),onClick:l[0]||(l[0]=pe(()=>{},["stop"]))},[y(xt,{folder:h},null,8,["folder"])],2),te(" "+x(h.name)+" ",1),e("span",Ct,x(u(d).folders[h.id].count),1)],10,St)],40,wt),h.children&&h.children.length>0?(s(),n("i",{key:0,onClick:S=>b(h.id),class:B("bi bi-chevron-"+(m.value[h.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,It)):f("",!0),h.children&&h.children.length>0&&m.value[h.id]?(s(),V(c,{key:1,folders:h.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager,tab:t.tab},null,8,["folders","visible-folders","filter-manager","tab"])):f("",!0)],4))),256))],6)}}}),Mt=U(Vt,[["__scopeId","data-v-08c57041"]]),Tt={class:"text-center"},zt={class:"w-100 text-center",style:{"font-size":"10px"}},Ft={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Et=O({__name:"TaskStatus",props:{task:{}},setup(k){const d=k,t=z(()=>d.task.total-d.task.remain-d.task.computing),o=z(()=>d.task.total);return(a,m)=>(s(),n("div",Tt,[te(x(d.task.name)+" ",1),e("div",zt,x(t.value)+" / "+x(o.value)+" "+x(a.$t("main.nav.tasks.done")),1),o.value>0?(s(),n("div",Ft,[e("div",{class:"progress-bar",style:X(`width: ${t.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),Re=O({__name:"TabContainer",props:{id:{}},setup(k){const d=ce(),t=k;let o;const a=M(!1);function m(){o=d.getTab(t.id),a.value=!0}return J(m),q(()=>t.id,async()=>{a.value=!1,await Z(),m()}),(p,b)=>a.value&&u(d).loaded?Pe(p.$slots,"default",{key:0,tab:u(o)}):f("",!0)}}),fe={},Pt={class:"d-flex flex-row"},Ot={key:2,class:"d-flex",style:{width:"150px"}},Gt={class:"flex-grow-1"},Lt={key:1,style:{"padding-top":"1px"}},Dt={style:{width:"20px","margin-top":"2px"},class:"text-center"},At={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},Rt={key:0},Ut={key:0,class:"ms-3 pt-1"},jt={key:1},Bt=O({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(k){const{t:d}=Oe({useScope:"global"}),t=de();me();const o=H(),a=k,m=M(!1),p=M(!1),b=M(""),g=M(!1),r=z(()=>a.tab.state.visibleProperties[a.property.id]==!0),i=z(()=>a.tab.collection.filterManager.state.filter.filters.some(w=>!w.isGroup&&w.propertyId==a.property.id)),l=z(()=>a.tab.collection.groupManager.state.groupBy.includes(a.property.id)),c=z(()=>a.tab.collection.sortManager.state.sortBy.includes(a.property.id)),h=z(()=>{if(i.value)return a.tab.collection.filterManager.state.filter.filters.find(w=>!w.isGroup&&w.propertyId==a.property.id).id}),S=()=>a.tab.collection.filterManager,L=z(()=>a.tab.getSha1Mode());function I(){r.value?a.tab.setVisibleProperty(a.property.id,!1):a.tab.setVisibleProperty(a.property.id,!0)}function v(){a.open&&(m.value?m.value=!1:(m.value=!0,b.value=a.property.name),p.value=!1)}function T(){a.property.type!=N.tag&&a.property.type!=N.multi_tags||(p.value?p.value=!1:p.value=!0,m.value=!1)}function C(){c.value?a.tab.collection.sortManager.delSort(a.property.id):a.tab.collection.sortManager.setSort(a.property.id),a.tab.collection.sortManager.update(!0)}function G(){l.value?a.tab.collection.groupManager.delGroupOption(a.property.id):a.tab.collection.groupManager.setGroupOption(a.property.id),a.tab.collection.groupManager.update(!0)}function R(){confirm(d("common.properties.delete")+": "+a.property.name+" ?   "+a.property.id)&&o.deleteProperty(a.property.id)}async function Q(){b.value!=""&&(await o.updateProperty(a.property.id,b.value),v())}function A(){const w=S();i.value?(w.deleteFilter(h.value),fe.filter.hide()):(w.addNewFilter(a.property.id),fe.filter.show())}return q(()=>a.property,()=>{m.value=!1}),(w,$)=>(s(),n("div",{class:B(g.value?"hover-light":"")},[e("div",Pt,[a.open?(s(),n(P,{key:0},[m.value?f("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:v},[y(ge,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=D=>g.value=!0),onMouseleave:$[1]||($[1]=D=>g.value=!1)},null,8,["type"]),e("span",null,x(a.property.name),1)]))],64)):(s(),V(ge,{key:1,type:a.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),m.value&&a.open?(s(),n("div",Ot,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:v,onMouseenter:$[2]||($[2]=D=>g.value=!0),onMouseleave:$[3]||($[3]=D=>g.value=!1)},null,32)]),e("div",Gt,[a.property.id>=0?ye((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=D=>b.value=D),onChange:Q},null,544)),[[be,b.value]]):(s(),n("span",Lt,[y(ge,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(a.property.name),1)]))])])):f("",!0),a.open?(s(),n(P,{key:3},[u(Ge)(a.property.type)?(s(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=D=>u(t).showModal(u(ee).TAG,{propId:a.property.id}))},[y(F,{click:!1,message:"main.nav.properties.open_tags"},{default:_(()=>$[7]||($[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",Dt,[a.property.mode==u(Se).id?(s(),V(F,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:_(()=>$[8]||($[8]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:I,class:"btn-icon text-center"},[L.value&&a.property.mode==u(Se).id?(s(),V(F,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:_(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=pe(()=>{},["stop"]))})]),_:1})):(s(),V(F,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:_(()=>[e("span",{class:B("bi bi-eye text-"+(r.value?"primary":"secondary"))},null,2)]),_:1}))]),a.open?(s(),n("div",At,[a.property.type==u(N).tag||a.property.type==u(N).multi_tags?(s(),n("div",{key:0,onClick:T,style:{cursor:"pointer"}},[p.value?(s(),V(F,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:_(()=>$[9]||($[9]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(s(),V(F,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:_(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),a.open?(s(),n("div",Rt,[m.value?(s(),n("div",Ut,[w.property.id!=u(Ve).folders?(s(),n("div",{key:0,class:B(["options hover-light",i.value?" text-primary":""]),onClick:A},[e("div",null,[$[11]||($[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),te(x(w.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:B(["options hover-light",c.value?" text-primary":""]),onClick:C},[$[12]||($[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),te(x(w.$t("main.menu.sort.title")),1)],2),e("div",{class:B(["options hover-light",l.value?" text-primary":""]),onClick:G},[$[13]||($[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),te(x(w.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),n("div",{key:1,class:"options hover-light",onClick:R},[$[14]||($[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),te(x(w.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):p.value?(s(),n("div",jt,[y(We,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}}),Nt=U(Bt,[["__scopeId","data-v-22b53ad7"]]),Ht={key:0,class:"prop-container"},Wt={key:0},qt={key:1},Qt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Kt={key:1,class:"ms-2"},Yt={class:"p-1"},Xt=["onClick"],Zt=["onClick"],Jt={key:0,class:"ps-1 pe-1"},es={class:"property-item"},ts=O({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(k){const d=H(),t=de(),o=k,a=M(!0),m=M(!1),p=M(""),b=z(()=>o.node.propertyIds.map(I=>d.properties[I])),g=z(()=>{if(o.node.groupId>=0)return d.propertyGroups[o.node.groupId];if(o.node.groupId==le.DEFAULT)return{id:le.DEFAULT,name:"default"};if(o.node.groupId==le.COMPUTED)return{id:le.COMPUTED,name:"computed"}}),r=z(()=>g.value.id>=0);function i(){a.value=!a.value}function l(I){d.updatePropertyGroup(g.value.id,p.value)}function c(){p.value=g.value.name}function h(){d.deletePropertyGroup(g.value.id)}async function S(){let I=d.propertyList.filter(v=>v.propertyGroupId==o.node.groupId);for(let v of I)await d.deleteProperty(v.id);o.node.groupId>=0&&await d.deletePropertyGroup(o.node.groupId)}async function L(I){if(I.added){let v=I.added.element;const T=d.properties[v];let C=o.node.groupId;C<0&&(C=null),await d.updateProperty(T.id,T.name,C),await d.triggerPropertyTreeChange()}I.moved&&await d.triggerPropertyTreeChange()}return J(c),q(o,c),(I,v)=>u(d).propertyGroups[o.node.groupId]||o.node.groupId<0?(s(),n("div",Ht,[y(u(Le),{list:o.node.propertyIds,"item-key":T=>T,group:o.node.groupId>0||o.node.groupId==u(le).DEFAULT?"properties":void 0,onChange:L},{header:_(()=>[e("div",{class:"d-flex group-container",onClick:i},[a.value?(s(),n("div",Wt,v[4]||(v[4]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(s(),n("div",qt,v[5]||(v[5]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),o.menuOpen?(s(),n(P,{key:2},[m.value?f("",!0):(s(),n("div",Qt,x(g.value.name),1)),m.value?(s(),n("div",Kt,[y(qe,{"auto-focus":!0,modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=T=>p.value=T),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:l,onCancel:c,onBlur:v[1]||(v[1]=T=>m.value=!1)},null,8,["modelValue"])])):f("",!0),v[8]||(v[8]=e("div",{class:"flex-grow-1"},null,-1)),o.node.groupId>=u(le).DEFAULT?(s(),V(se,{key:2,onClick:v[2]||(v[2]=pe(()=>{},["prevent","stop"]))},{button:_(()=>v[6]||(v[6]=[e("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:_(({hide:T})=>[e("div",Yt,[r.value?(s(),n(P,{key:0},[e("div",{class:"bb",onClick:C=>{m.value=!0,T()}},x(I.$t("main.menu.editName")),9,Xt),e("div",{class:"bb",onClick:h},x(I.$t("main.menu.removeGroup")),1)],64)):f("",!0),e("div",{class:"bb",onClick:C=>{S(),T()}},x(I.$t("main.menu.deleteGroupAndProperties")),9,Zt)])]),_:1})):f("",!0),o.node.groupId>=-1?(s(),n("div",{key:3,class:"bb me-2",onClick:v[3]||(v[3]=pe(T=>u(t).showModal(u(ee).PROPERTY,{group:o.node.groupId}),["stop","prevent"]))},[y(F,{message:I.$t("main.menu.addNewPropertyToGroup")},{default:_(()=>v[7]||(v[7]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):f("",!0)],64)):f("",!0)])]),item:_(({element:T,index:C})=>[a.value&&b.value.length&&u(d).properties[T]?(s(),n("div",Jt,[e("div",es,[y(Nt,{tab:o.tab,property:u(d).properties[T],open:o.menuOpen},null,8,["tab","property","open"])])])):f("",!0)]),_:1},8,["list","item-key","group"])])):f("",!0)}}),$e=U(ts,[["__scopeId","data-v-03863055"]]),ss={key:0,class:"mb-1"},os=O({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(k,{emit:d}){const t=H(),o=k;function a(m){t.triggerPropertyTreeChange()}return(m,p)=>(s(),V(u(Le),{list:u(t).propertyTree,onChange:a,"item-key":b=>b.groupId},{item:_(({element:b})=>[b.groupId>=0?(s(),n("div",ss,[y($e,{tab:o.tab,node:b,"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])])):f("",!0)]),footer:_(()=>[y($e,{class:"mb-1",tab:o.tab,node:u(t).propertyTree[u(t).propertyTree.length-2],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"]),y($e,{class:"mb-1",tab:o.tab,node:u(t).propertyTree[u(t).propertyTree.length-1],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),as={class:""},ns={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ls={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},is={class:"flex-grow-1 text-capitalize overflow-hidden"},rs={key:0,class:"bi bi-chevron-left"},ds={key:1,class:"bi bi-chevron-right"},us={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ps={class:"d-flex align-items-center"},cs={style:{"max-height":"300px",overflow:"auto"}},ms={key:0,id:"import"},gs={class:"pt-1 pb-2"},vs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},fs={key:0,class:"ps-2 pe-2"},ys={class:"p-1"},bs={key:0,class:"custom-hr"},hs={class:"p-1 mt-0"},_s={key:0,class:"d-flex p-1"},ks={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},$s={key:1,class:"bb me-1"},xs={class:"bb me-2"},ws={key:1,class:"mt-2"},Ss=200,Cs=55,Is=O({__name:"Menu",emits:["export","toggle"],setup(k,{emit:d}){const t=me(),o=H(),a=de(),m=ce(),p=d,b=M(!1),g=M(!1),r=M(!0),i=z(()=>r.value?Ss:Cs);z(()=>o.propertyList.filter(I=>I.id>=0&&(I.propertyGroupId===void 0||!o.propertyGroups[I.propertyGroupId])));const l=async I=>{a.showModal(ee.IMPORT)},c=z(()=>t.backendStatus.tasks.filter(I=>!I.done));function h(){a.showModal(ee.FOLDERSELECTION,{callback:S,mode:"images"})}function S(I){I&&o.addFolder(I)}function L(){r.value=!r.value,p("toggle")}return q(()=>t.status.import.to_import,()=>b.value=!0),(I,v)=>(s(),V(Re,{id:u(m).mainTab},{default:_(({tab:T})=>[e("div",{class:"menu overflow-scroll",style:X({width:i.value+"px"})},[e("div",as,[e("div",null,[e("div",ns,[e("div",ls,[r.value?(s(),n(P,{key:0},[e("div",is,x(u(a).data.status.selectedProject?.name),1),y(F,{message:"main.menu.close_project"},{default:_(()=>[e("div",{class:"base-hover p-1",onClick:v[0]||(v[0]=C=>u(a).closeProject(u(a).projectId))},v[6]||(v[6]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:v[1]||(v[1]=C=>u(a).showModal(u(ee).SETTINGS))},v[7]||(v[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:B(["base-hover p-1",r.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:L},[r.value?(s(),n("i",rs)):(s(),n("i",ds))],2)])]),r.value?(s(),n(P,{key:0},[v[9]||(v[9]=e("div",{class:"custom-hr"},null,-1)),e("div",us,[e("div",ps,[e("div",null,[e("b",null,x(I.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:v[2]||(v[2]=C=>{h(),u(Ce)()})},[y(F,{message:"main.nav.folders.add"},{default:_(()=>v[8]||(v[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",cs,[y(Mt,{folders:u(o).folderRoots,"filter-manager":T.collection.filterManager,"visible-folders":T.state.visibleFolders,tab:T},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):f("",!0),r.value?(s(),n(P,{key:1},[c.value&&c.value.length?(s(),n("div",ms,[v[11]||(v[11]=e("div",{class:"custom-hr"},null,-1)),e("div",gs,[e("div",vs,[e("div",null,[e("b",null,x(I.$t("main.nav.tasks.title")),1)])]),v[10]||(v[10]=e("div",{class:"custom-hr"},null,-1)),u(t).backendStatus?(s(),n("div",fs,[(s(!0),n(P,null,Y(c.value,(C,G)=>(s(),n("div",ys,[G?(s(),n("div",bs)):f("",!0),y(Et,{task:C},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),v[18]||(v[18]=e("div",{class:"custom-hr"},null,-1)),e("div",hs,[r.value?(s(),n("div",_s,[y(F,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:_(()=>[e("b",null,x(I.$t("main.nav.properties.title")),1)]),_:1}),v[13]||(v[13]=e("span",{class:"flex-grow-1"},null,-1)),g.value?(s(),n("span",ks,v[12]||(v[12]=[e("span",{class:"sr-only"},null,-1)]))):(s(),n("span",$s,[y(F,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:l})]),_:1})])),e("span",xs,[y(F,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:v[3]||(v[3]=C=>u(a).showModal(u(ee).EXPORT,void 0))})]),_:1})])])):f("",!0),u(t).status.loaded?(s(),n("div",ws,[y(os,{tab:T,"menu-open":r.value},null,8,["tab","menu-open"]),r.value?(s(),n(P,{key:0},[v[16]||(v[16]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:v[4]||(v[4]=C=>{u(a).showModal(u(ee).PROPERTY,void 0),u(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[v[14]||(v[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property")),1)]),v[17]||(v[17]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:v[5]||(v[5]=C=>u(o).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[v[15]||(v[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)])])])],4)]),_:1},8,["id"]))}}),Vs=U(Is,[["__scopeId","data-v-d7ff69eb"]]),Ms={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Ts={class:""},zs=["onClick"],Fs=O({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,o=d;function a(m){o("update:modelValue",m)}return(m,p)=>(s(),V(se,null,{button:_(()=>[e("div",Ms,[e("span",Ts,x(m.$t("modals.filters."+t.modelValue)),1)])]),popup:_(({hide:b})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:b},[e("div",{class:"base-btn",onClick:p[0]||(p[0]=g=>a(u(ze).and))},x(m.$t("modals.filters.and")),1),p[2]||(p[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:p[1]||(p[1]=g=>a(u(ze).or))},x(m.$t("modals.filters.or")),1)],8,zs)]),_:1}))}}),Es=["disabled"],Ps={class:"m-0 p-1"},Os=["onClick"],Gs=O({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(k,{emit:d}){const t=H(),o=k,a=d,m=z(()=>t.properties[o.propertyId]),p=z(()=>Qe(m.value.type));async function b(g){a("update:modelValue",g)}return(g,r)=>(s(),V(se,{onHide:r[0]||(r[0]=i=>a("hide")),placement:"bottom"},{button:_(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[e("span",null,x(g.$t("modals.filters.operators."+o.modelValue)),1)],8,Es)]),popup:_(({hide:i})=>[e("div",Ps,[(s(!0),n(P,null,Y(p.value,l=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>{b(l),i()}},[e("a",null,x(g.$t("modals.filters.operators."+l)),1)],8,Os))),256))])]),_:1}))}}),Ls=U(Gs,[["__scopeId","data-v-0b3d97be"]]),Ds={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},As=O({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,o=d;function a(m){o("update:modelValue",m)}return(m,p)=>(s(),n("div",Ds,[u(Ge)(m.property.type)?(s(),V(Ke,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":a,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==u(N).color?(s(),V(Ye,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==u(N).number?(s(),V(Xe,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==u(N).url?(s(),V(Ze,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==u(N).checkbox?(s(),V(Je,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":a,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==u(N).date?(s(),V(et,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":a,width:t.width,class:"sb"},null,8,["model-value","width"])):(s(),V(tt,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Rs={class:"p-0 m-0 ps-2"},Us=O({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(k,{emit:d}){const t=H(),o=k,a=z(()=>t.properties[o.filter.propertyId]),m=z(()=>st(o.filter.operator));function p(r){o.manager.updateFilter(o.filter.id,{operator:r})}function b(r){o.manager.updateFilter(o.filter.id,{value:r})}function g(r){o.manager.updateFilter(o.filter.id,{propertyId:r.id})}return(r,i)=>(s(),n(P,null,[e("td",Rs,[y(ot,{"model-value":a.value,"onUpdate:modelValue":g},null,8,["model-value"])]),e("td",null,[y(Ls,{"property-id":a.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":p},null,8,["property-id","model-value"])]),e("td",null,[m.value?(s(),V(As,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":b,property:a.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),js={style:{"max-height":"500px",overflow:"auto"}},Ue=O({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(k,{emit:d}){const t=k;function o(a){t.manager.addNewFilter(a,t.group.id),fe.filter.show()}return(a,m)=>(s(),V(se,{placement:"auto"},{button:_(()=>[Pe(a.$slots,"default")]),popup:_(({hide:p})=>[e("div",js,[y(De,{onSelect:b=>{o(b),p()},"ignore-ids":[u(Ve).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Bs={class:"filter-group"},Ns={class:"table table-sm"},Hs={style:{height:"33px"}},Ws={class:""},qs={key:0,class:"m-0 p-0"},Qs={key:2,class:"text-secondary"},Ks={class:"border rounded"},Ys={class:""},Xs=["onClick"],Zs={class:"d-flex text-secondary ms-2"},Js={class:"add-options hover-light"},eo=O({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(k,{emit:d}){H();const t=k,o=z(()=>t.filter),a=z(()=>o.value.filters),m=z(()=>{let r=255-(o.value.depth+1)*5;return`background: rgb(${r},${r},${r});`});function p(r){t.manager.deleteFilter(r.id)}function b(r){t.manager.addNewFilterGroup(r)}function g(r,i){t.manager.updateFilterGroup(r,i)}return(r,i)=>(s(),n("div",Bs,[e("table",Ns,[(s(!0),n(P,null,Y(a.value,(l,c)=>(s(),n("tr",Hs,[e("td",Ws,[c==0?(s(),n("div",qs,x(r.$t("modals.filters.where")),1)):c==1?(s(),V(Fs,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":i[0]||(i[0]=h=>g(o.value.id,h))},null,8,["model-value"])):(s(),n("span",Qs,x(r.$t("modals.filters."+o.value.groupOperator)),1))]),l.propertyId!==void 0?(s(),V(Us,{key:0,filter:l,manager:t.manager},null,8,["filter","manager"])):(s(),n("td",{key:1,colspan:"3",style:X(m.value)},[e("div",Ks,[y(je,{filter:l,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",Ys,[e("span",{class:"base-btn",onClick:h=>p(l)},i[2]||(i[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Xs)])]))),256))]),e("div",Zs,[y(Ue,{group:t.filter,manager:t.manager},{default:_(()=>[e("div",Js,[i[3]||(i[3]=e("i",{class:"bi bi-plus"},null,-1)),te(x(r.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:i[1]||(i[1]=l=>b(o.value.id))},[i[4]||(i[4]=e("i",{class:"bi bi-plus"},null,-1)),te(x(r.$t("modals.filters.new_group")),1)])])]))}}),je=U(eo,[["__scopeId","data-v-cbadcac5"]]),to={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},so={key:0},oo={key:0,class:"or-separator"},ao={key:0,class:"or-separator"},no={key:0,class:"m-1 p-1"},lo=O({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(k,{emit:d}){const t=H(),o=k,a=M(null),m=M(null),p=z(()=>{let g=b(o.manager.state.filter),r={};return g.forEach(i=>r[i.propertyId]=i),Object.values(r)});function b(g){let r=[];for(let i of g.filters)i.isGroup?r.push(...b(i)):r.push(i);return r}return q(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&m.value.hide()}),J(async()=>{await Z(),fe.filter=m.value}),(g,r)=>(s(),V(se,{ref_key:"dropdownElem",ref:m,placement:"top-start"},{button:_(()=>[e("div",null,[p.value.length||o.manager.state.query?(s(),n("div",to,[o.manager.state.query?(s(),n("div",so,[r[0]||(r[0]=e("span",{class:"text-primary"},"Text Query",-1)),p.value.length?(s(),n("span",oo,"|")):f("",!0)])):f("",!0),(s(!0),n(P,null,Y(p.value,(i,l)=>(s(),n("div",null,[l>0?(s(),n("span",ao,"|")):f("",!0),i.propertyId==u(Ve).id?(s(),V(ge,{key:1,type:u(t).properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(u(t).properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:_(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:a},[Object.keys(u(t).properties).length>0?(s(),n("div",no,[y(je,{filter:o.manager.state.filter,manager:o.manager,parent:a.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}}),io=U(lo,[["__scopeId","data-v-7dbca090"]]),ro={class:"d-flex flex-row filter-form"},uo={class:"pt-1 pb-1"},po=O({__name:"FilterForm",props:{manager:Ie},setup(k){const d=k;return(t,o)=>(s(),n("div",ro,[e("div",uo,x(t.$t("main.menu.filters"))+": ",1),y(io,{manager:d.manager},null,8,["manager"]),y(Ue,{manager:d.manager,group:d.manager.state.filter,class:"p-1"},{default:_(()=>o[0]||(o[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),co=U(po,[["__scopeId","data-v-aad7b24a"]]),mo={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},go=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(k,{emit:d}){const t=k,o=d,a=M(null);return(m,p)=>(s(),V(se,{ref_key:"dropdownElem",ref:a,"auto-focus":!1},{button:_(()=>p[2]||(p[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:_(()=>[e("div",mo,[y(De,{onClick:p[0]||(p[0]=b=>u(Ce)()),onSelect:p[1]||(p[1]=b=>{o("select",b),a.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),Be=U(go,[["__scopeId","data-v-2f10e29f"]]),vo={class:"base-hover ps-1 pe-1"},fo={class:"main"},yo=["onClick"],bo=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:d}){const t=k,o=d,a=Object.values(Ae);function m(p){o("update:modelValue",p)}return(p,b)=>(s(),V(se,null,{button:_(()=>[e("div",vo,x(t.modelValue),1)]),popup:_(({hide:g})=>[e("div",fo,[(s(!0),n(P,null,Y(u(a),r=>(s(),n("div",{class:"base-hover option",onClick:i=>{m(r),g()}},x(r),9,yo))),256))])]),_:1}))}}),ho=U(bo,[["__scopeId","data-v-cc9d0d61"]]),_o={class:""},ko={class:"d-flex ipt"},$o={class:"ms-2",min:"1"},xo=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(k,{emit:d}){const t=k,o=d,a=M(1),m=M(Ae.Year);function p(){t.option.stepSize==a.value&&t.option.stepUnit==m.value||o("change",{stepSize:a.value,stepUnit:m.value})}function b(){a.value=t.option.stepSize??1,m.value=t.option.stepUnit}return q(()=>t.option,b),J(b),q(a,()=>{(a.value<1||a.value==null||isNaN(a.value))&&(a.value=1)}),(g,r)=>(s(),V(se,{onHide:p},{button:_(()=>r[2]||(r[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:_(({hide:i,focus:l})=>[e("div",_o,[e("div",ko,[e("div",null,[ye(e("input",{type:"number","onUpdate:modelValue":r[0]||(r[0]=c=>a.value=c)},null,512),[[be,a.value]])]),e("div",$o,[y(ho,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=c=>m.value=c),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}}),wo=U(xo,[["__scopeId","data-v-a27bea28"]]),So={class:"d-flex flex-row group-form"},Co={class:"pt-1 pb-1"},Io={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Vo={key:0,class:"bi bi-chevron-right smaller"},Mo=["onClick"],To=["onClick"],zo=["onClick"],Fo=["onClick"],Eo=["onClick"],Po=["onClick"],Oo=["onClick"],Go=["onClick"],Lo=["onClick"],Do={key:5,class:"sm-btn"},Ao={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ro=O({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(k){const d=H(),t=k;function o(i){t.manager.setGroupOption(i),t.manager.update(!0)}function a(i){t.manager.delGroupOption(i),t.manager.update(!0)}function m(i,l){t.manager.setGroupOption(i,{direction:l}),t.manager.sortGroups(!0)}function p(i,l){t.manager.setGroupOption(i,{type:l}),t.manager.sortGroups(!0)}function b(i,l){t.manager.setGroupOption(i,l),t.manager.update(!0)}const g=z(()=>t.manager.state.groupBy.map(i=>d.properties[i])),r=z(()=>{const i=[];return t.manager.state.groupBy.forEach(l=>{i.push({option:t.manager.state.options[l],property:d.properties[l]})}),i});return(i,l)=>(s(),n("div",So,[e("div",Co,x(i.$t("main.menu.groupby"))+": ",1),g.value.length?(s(),n("div",Io,[(s(!0),n(P,null,Y(r.value,(c,h)=>(s(),n(P,null,[h>0?(s(),n("i",Vo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:S=>a(c.property.id),id:"remove-group-button"},x(c.property.name),9,Mo),c.option.type==u(ne).Size?(s(),V(F,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:_(()=>[c.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:S=>p(c.property.id,u(ne).Property)},null,8,To)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:S=>p(c.property.id,u(ne).Property)},null,8,zo))]),_:2},1024)):(s(),V(F,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:_(()=>[c.property.type==u(N).number?(s(),n(P,{key:0},[c.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:S=>p(c.property.id,u(ne).Size)},null,8,Fo)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:S=>p(c.property.id,u(ne).Size)},null,8,Eo))],64)):(s(),n(P,{key:1},[c.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:S=>p(c.property.id,u(ne).Size)},null,8,Po)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:S=>p(c.property.id,u(ne).Size)},null,8,Oo))],64))]),_:2},1024)),c.option.direction==u(oe).Ascending?(s(),V(F,{key:3,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:S=>m(c.property.id,u(oe).Descending)},null,8,Go)]),_:2},1024)):(s(),V(F,{key:4,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:S=>m(c.property.id,u(oe).Ascending)},null,8,Lo)]),_:2},1024)),c.property.type==u(N).date?(s(),n("div",Do,[y(wo,{option:c.option,onChange:S=>b(c.property.id,S)},null,8,["option","onChange"])])):f("",!0)],64))),256)),t.isLoading?(s(),n("i",Ao)):f("",!0)])):f("",!0),y(Be,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:l[0]||(l[0]=c=>o(c))},null,8,["group-ids"])]))}}),Uo=U(Ro,[["__scopeId","data-v-388718c9"]]),jo={class:"d-flex flex-row sort-form"},Bo={class:"pt-1 pb-1"},No={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ho={key:0,class:"bi bi-chevron-right smaller"},Wo=["onClick"],qo=["onClick"],Qo=["onClick"],Ko=O({__name:"SortForm",props:{manager:nt},setup(k){const d=H(),t=k,o=z(()=>t.manager.state.sortBy.map(g=>({propertyId:g,direction:t.manager.state.options[g].direction}))),a=z(()=>o.value.map(g=>g.propertyId));function m(g){t.manager.setSort(g),t.manager.update(!0)}function p(g){t.manager.delSort(g),t.manager.update(!0)}function b(g,r){t.manager.setSort(g,{direction:r}),t.manager.update(!0)}return(g,r)=>(s(),n("div",jo,[e("div",Bo,x(g.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),n("div",No,[(s(!0),n(P,null,Y(o.value,(i,l)=>(s(),n(P,null,[l>0?(s(),n("i",Ho)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:c=>p(i.propertyId)},x(u(d).properties[i.propertyId].name),9,Wo),i.direction==u(oe).Ascending?(s(),V(F,{key:1,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:c=>b(i.propertyId,u(oe).Descending)},null,8,qo)]),_:2},1024)):(s(),V(F,{key:2,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:c=>b(i.propertyId,u(oe).Ascending)},null,8,Qo)]),_:2},1024))],64))),256))])):f("",!0),y(Be,{"group-ids":a.value,onSelect:r[0]||(r[0]=i=>m(i))},null,8,["group-ids"])]))}}),Yo=U(Ko,[["__scopeId","data-v-80dc564a"]]),Xo={class:"p-2"},Zo={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Jo={class:"border mb-1 p-1"},ea={class:"me"},ta={key:0},sa={key:1},oa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},aa={class:"d-flex center justify-content-center"},na={key:1,class:"bi bi-arrow-down text-secondary"},la={key:3,class:"bi bi-arrow-up text-secondary"},ia={class:"border mb-1 p-1"},ra={class:"me"},da={key:0},ua={key:1},pa={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ie=5,ca=O({__name:"HistoryDropdown",emits:[],setup(k,{emit:d}){const t=H(),o=M(!1),a=z(()=>o.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=z(()=>[...t.history.undo].reverse().slice(0,ie)),p=z(()=>t.history.redo.slice(Math.max(t.history.redo.length-ie,0)));return q(()=>t.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(b,g)=>m.value.length||p.value.length?(s(),V(se,{key:0},{button:_(()=>[y(F,{message:"dropdown.history.info"},{default:_(()=>[e("div",{class:"d-flex sb flash",style:X([{"font-size":"14px"},a.value])},[g[2]||(g[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(b.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:_(()=>[e("div",Xo,[u(t).history.redo.length>ie?(s(),n("div",Zo," + "+x(u(t).history.redo.length-ie),1)):f("",!0),(s(!0),n(P,null,Y(p.value,r=>(s(),n("div",Jo,[e("span",ea,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),g[3]||(g[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(s(),n("span",ta,x(r.tags)+" "+x(b.$t("dropdown.history.tags")),1)):f("",!0),r.values?(s(),n("span",sa,x(r.values)+" "+x(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",oa,[e("div",aa,[m.value.length?(s(),V(F,{key:0,message:"dropdown.history.undo"},{default:_(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:g[0]||(g[0]=(...r)=>u(t).undo&&u(t).undo(...r))})]),_:1})):(s(),n("div",na)),g[4]||(g[4]=e("div",{style:{width:"30px"}},null,-1)),p.value.length?(s(),V(F,{key:2,message:"dropdown.history.redo"},{default:_(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:g[1]||(g[1]=(...r)=>u(t).redo&&u(t).redo(...r))})]),_:1})):(s(),n("div",la))])]),(s(!0),n(P,null,Y(m.value,r=>(s(),n("div",ia,[e("span",ra,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),g[5]||(g[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(s(),n("span",da,x(r.tags)+" "+x(b.$t("dropdown.history.tags")),1)):f("",!0),r.values?(s(),n("span",ua,x(r.values)+" "+x(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),u(t).history.undo.length>ie?(s(),n("div",pa," + "+x(u(t).history.undo.length-ie),1)):f("",!0)])]),_:1})):f("",!0)}}),ma=U(ca,[["__scopeId","data-v-b5086318"]]),ga=O({__name:"ToggleReload",props:{tab:{}},emits:[],setup(k,{emit:d}){const t=k,o=z(()=>t.tab.collection.state.autoReload?2:t.tab.collection.runState.isDirty?0:1);function a(){o.value==0?t.tab.collection.update():o.value==1?t.tab.collection.setAutoReload(!0):t.tab.collection.setAutoReload(!1)}return(m,p)=>(s(),n("div",{class:"bb font",onClick:a,style:{width:"26px",height:"30px",overflow:"hidde"}},[o.value==0?(s(),V(F,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:_(()=>p[0]||(p[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),o.value==1?(s(),V(F,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:_(()=>p[1]||(p[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),o.value==2?(s(),V(F,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:_(()=>p[2]||(p[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}}),va=U(ga,[["__scopeId","data-v-4047bb79"]]),fa={class:"d-flex flex-row p-2"},ya=["placeholder"],ba={class:"me-5 d-flex"},ha={class:"ms-5",style:{"font-size":"13px"}},_a=["checked"],ka={class:"ms-1"},$a={class:"ms-4"},xa={class:"d-flex flex-wrap content-container ps-2"},wa=O({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(k,{emit:d}){lt();const t=k,o=M(""),a=z(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=z(()=>a.value.length);function p(i){const l=i.target.checked;t.tab.collection.groupManager.setSha1Mode(l,!0)}function b(){o.value=t.tab.state.filterState.query}function g(){t.tab.collection.filterManager.setQuery(o.value),t.tab.collection.filterManager.update(!0)}function r(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return J(b),q(()=>t.tab.collection.filterManager.state.query,b),(i,l)=>(s(),n(P,null,[e("div",fa,[y(F,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:_(()=>[e("div",{class:B(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[l[7]||(l[7]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ye(e("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=c=>o.value=c),onChange:g},null,40,ya),[[be,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:r},"x")],2)]),_:1}),e("div",ba,[y(F,{message:"main.menu.grid_tooltip"},{default:_(()=>[e("i",{class:B("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=c=>t.tab.setViewMode("tree"))},null,2)]),_:1}),y(F,{message:"main.menu.table_tooltip"},{default:_(()=>[e("i",{id:"toot",class:B("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=c=>t.tab.setViewMode("grid"))},null,2)]),_:1}),y(F,{message:"main.menu.graph_tooltip"},{default:_(()=>[e("i",{id:"toot",class:B("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:l[3]||(l[3]=c=>t.tab.setViewMode("graph"))},null,2)]),_:1})]),y(F,{message:"main.menu.image_size_tooltip",click:!1},{default:_(()=>l[8]||(l[8]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[y(it,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":l[4]||(l[4]=c=>t.tab.state.imageSize=c)},null,8,["modelValue"])]),e("div",ha,[y(F,{message:"main.menu.image_mode_tooltip"},{default:_(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:p},null,40,_a),e("span",ka,x(i.$t("main.menu.image_mode")),1)]),_:1})]),e("div",$a,[y(ma)]),m.value?(s(),V(rt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":a.value,"onRemove:selected":l[5]||(l[5]=c=>t.tab.collection.groupManager.clearSelection()),onStamped:l[6]||(l[6]=c=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),l[10]||(l[10]=e("div",{class:"flex-grow-1"},null,-1)),y(F,{message:"main.menu.issue",class:"bb"},{default:_(()=>l[9]||(l[9]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",xa,[y(va,{tab:t.tab,class:"me-1"},null,8,["tab"]),y(co,{manager:t.tab.collection.filterManager},null,8,["manager"]),y(Uo,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),y(Yo,{manager:t.tab.collection.sortManager},null,8,["manager"]),l[11]||(l[11]=e("div",null,null,-1))])],64))}}),Sa=U(wa,[["__scopeId","data-v-83f17360"]]),Ca={class:""},Ia={class:"d-flex flex-row"},Va=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(k,{emit:d}){const t=de(),o=k,a=d,m=z(()=>`width: ${o.size}px; height: ${o.size}px;`);z(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const p=z(()=>o.pile.images[0]);return(b,g)=>(s(),n("div",Ca,[y(dt,{image:p.value},{default:_(()=>[e("div",{style:X(m.value),class:"img-container",onClick:g[0]||(g[0]=r=>u(t).showModal(u(ee).IMAGE,{image:p.value}))},[y(ut,{image:p.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Ia,[y(F,{message:"main.recommand.accept"},{default:_(()=>[e("div",{style:X(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:g[1]||(g[1]=r=>a("accept",p.value))}," ✓ ",4)]),_:1}),y(F,{message:"main.recommand.refuse"},{default:_(()=>[e("div",{style:X(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:g[2]||(g[2]=r=>a("refuse",p.value))}," ✕ ",4)]),_:1})])]))}}),Ma=U(Va,[["__scopeId","data-v-809d667b"]]),Ta={class:"reco-container"},za={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Fa={key:0,class:"bi bi-funnel-fill bb text-primary"},Ea={key:1,class:"bi bi-funnel bb"},Pa={class:"text-secondary me-2"},Oa={style:{"padding-top":"2px"},class:"me-1"},Ga={class:"flex-grow-1"},La={class:"d-flex flex-row"},Da={key:0,class:"separator"},Aa={class:"d-flex flex-row"},xe=10,Ra=O({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(k,{emit:d}){const t=H(),o=pt(),a=k,m=d,p=M(1),b=ve([]),g=M(null),r=ve([]),i=ve(new Set),l=M(!0),c=[],h=[];async function S(A){const w=[],$=[];r.forEach(D=>{if(D.value!=null){const E=t.properties[D.propertyId];let W=D.value;E.type==N.multi_tags?(W=A.properties[D.propertyId]??[],W=[...W,D.value]):E.type==N.tag&&(W=[W]),E.mode==Se.id?$.push({instanceId:A.id,propertyId:E.id,value:W}):w.push({propertyId:E.id,sha1:A.sha1,value:W})}}),await t.setPropertyValues($,w)}function L(A){g.value.isSha1Group?g.value.images.filter(w=>w.sha1==A.sha1).forEach(w=>i.add(w.id)):i.add(A.id),Q()}function I(){b.length=0;let A=[];const w=h.map($=>t.instances[$]);if(g.value.isSha1Group){const $={},D=Array.from(new Set(w.map(E=>E.sha1)));D.forEach(E=>$[E]=[]),w.forEach(E=>$[E.sha1].push(E)),D.forEach(E=>A.push({sha1:E,images:t.sha1Index[E]}))}else w.forEach($=>A.push({sha1:$.sha1,images:[$]}));v(A,b,p.value,a.imageSize,a.width)}function v(A,w,$,D,E){let W=E,K=[],ae=0;for(let he=0;he<A.length&&!(w.length>=$);he++){let ue=A[he];if(ue.images=ue.images.filter(Ne=>!i.has(Ne.id)),ue.images.length==0)continue;let _e=D+xe;if(ae+_e<W){K.push(ue),ae+=_e;continue}if(K.length==0)throw new Error("Images seems to be to big for the line");w.push(K),w.length<$&&(K=[ue],ae=_e)}K.length>0&&w.length<$&&w.push(K)}async function T(){if(!a.group||!o.hasSimilaryFunction)return;const A=o.defaultActions.similar,w=o.getContext(A);w.instanceIds=a.group.images.map(K=>K.id);const $=await o.getSimilarImages(w);if(!$)return;if(!$.groups)throw new Error("No instances in ActionResult");let E=gt($.groups)[0];if(l.value){const K=new Set(a.tab.collection.filterManager.result.images.map(ae=>ae.id));E.images=E.images.filter(ae=>K.has(ae.id))}E.scores&&vt(E),g.value=E,r.length=0;let W=a.group;for(;W;)r.push(...W.meta.propertyValues),W=W.parent;i.clear(),c.length=0,E.images.forEach(K=>c.push(K.id)),Q(),m("update")}function C(){l.value=!l.value}function G(){a.tab.collection.groupManager.onResultChange.addListener(Q)}function R(){a.tab.collection.groupManager.onResultChange.removeListener(Q)}function Q(){const A=a.tab.collection.groupManager.result.index[a.group.id];if(!A){m("close");return}h.length=0;const w=new Set(A.images.map($=>$.id));c.forEach($=>{w.has($)||i.has($)||h.push($)}),I()}return J(G),Me(R),J(T),q(()=>a.group,()=>{T(),i.clear()}),q(()=>a.imageSize,I),q(()=>a.width,I),q(l,T),(A,w)=>(s(),n("div",Ta,[e("div",za,[y(F,{message:"main.recommand.close"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:w[0]||(w[0]=$=>m("close"))},w[2]||(w[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),w[5]||(w[5]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{message:"main.recommand.scroll"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:w[1]||(w[1]=$=>m("scroll",a.group.id))},w[3]||(w[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),w[6]||(w[6]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{message:"main.recommand.filter"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:C},[l.value?(s(),n("span",Fa)):(s(),n("span",Ea))])]),_:1}),w[7]||(w[7]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{message:"main.recommand.reload"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:T},w[4]||(w[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),w[8]||(w[8]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:_(()=>[e("span",Pa,x(A.$t("main.recommand.title")),1)]),_:1}),e("div",Oa,[y(ct,{action:"similar",onChanged:T})]),e("div",Ga,[e("div",La,[(s(!0),n(P,null,Y(r,($,D)=>(s(),n(P,null,[y(mt,{class:"",value:$},null,8,["value"]),D<r.length-1?(s(),n("div",Da)):f("",!0)],64))),256))])])]),e("div",{style:X("margin-left:"+xe+"px;")},[(s(!0),n(P,null,Y(b,$=>(s(),n("div",null,[e("div",Aa,[(s(!0),n(P,null,Y($,D=>(s(),V(Ma,{pile:D,size:a.imageSize,onAccept:S,onRefuse:L,style:X("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),Ua=U(Ra,[["__scopeId","data-v-c830b08a"]]),ja={style:{display:"flex"}},Ba={class:"info"},Na={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:N},height:String},setup(k){const d=k,t=M(0),o=M(!1),a={};Object.keys(d.chartData.series).forEach(l=>{a[l]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:d.chartData.dataType===N.date?"datetime":"numeric",categories:d.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:l,seriesIndex:c,dataPointIndex:h,w:S}){const L=d.chartData.series[c].data[h];let I='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';L.images.forEach((T,C)=>{C<10&&(I+=`<div style="width: 75px; height: 75px;"><img src="${T}" style="width: 100%; height: 100%;" /></div>`)}),I+="</div>";let v=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${d.chartData.series[c].name} — </b> ${L.y} Images</span>`;return v+=`<div>${I}</div>`,v}}}),p=()=>{m.value.chart.stacked=!m.value.chart.stacked,o.value=!o.value,t.value+=1},b=()=>{let l;m.value.chart.type==="area"?l={chart:{...m.value.chart,type:"bar"}}:l={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...l},t.value+=1},g=(l,c,h)=>{const L=d.chartData.series[c];let I=Math.max(...L.data.map(v=>v.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(v=>v.remove()),a[c]){a[c]=!1;return}L.data.forEach((v,T)=>{const G=Math.floor(v.y/I*17),R=v.images.slice(0,G),Q=`circle[index="${c}"][j="${T}"]`,A=document.querySelector(Q),w=parseFloat(A.getAttribute("cx"));R.forEach(($,D)=>{const E=document.createElement("img");E.src=$,E.width=40,E.height=40,E.style.position="absolute";let W=w+40/1.5,K=65+D*40;E.style.left=`${W}px`,E.style.bottom=`${K}px`,E.classList.add("apexcharts-custom-image"),E.addEventListener("mouseover",ae=>r(W,K,$)),E.addEventListener("mouseout",i),l.el.appendChild(E)})}),Object.keys(a).forEach(v=>a[v]=!1),a[c]=!0};function r(l,c,h){const S=document.getElementById("zoomed-image");S.style.left=`${l+120*1.5}px`,S.src=h,S.style.bottom=`${c}px`,S.style.display="block"}function i(){const l=document.getElementById("zoomed-image");l.style.display="none"}return(l,c)=>{const h=Ee("apexchart");return s(),n(P,null,[e("div",ja,[e("button",{class:"mt-2",onClick:b},x(m.value.chart.type==="area"?l.$t("main.graph-view.histo"):l.$t("main.graph-view.curve")),1),d.chartData.series.length>1?(s(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:p},x(o.value?l.$t("main.graph-view.over"):l.$t("main.graph-view.stack")),1)):f("",!0)]),(s(),V(h,{style:{position:"relative"},key:t.value,height:d.height,type:m.value.chart.type,options:m.value,series:d.chartData.series,onLegendClick:g},null,8,["height","type","options","series"])),e("i",Ba,x(l.$t("main.graph-view.info")),1),c[0]||(c[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Ha={key:1},Wa=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(k,{emit:d}){const t=H(),o=k,a=M(""),m=M(b());function p(){const g=new Set;let r=o.collection.groupManager.getGroupIterator();for(;r;){const i=r.group;if(i.id===0||i.meta.propertyValues&&i.meta.propertyValues[0].value==null){r=r.nextGroup();continue}for(let l of i.children)g.add(l.meta.propertyValues[0].value);i.children.forEach(()=>r=r.nextGroup()),r=r.nextGroup()}return g}function b(){const g={};let r,i=o.collection.groupManager.state.groupBy;if(i.length===0){a.value="Choose at least one date or numeric value to group the images by";return}const l=t.properties[i[0]],c=l.type;if(i.length>2){a.value="Only max two levels of grouping are supported";return}else if(i.length===1)g[l.name]={name:l.name,data:[]};else if(r=Array.from(p()),r.length>20){a.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(c!==N.number&&c!==N.date){a.value="First level of grouping needs to be a date or a numeric property";return}let h=o.collection.groupManager.getGroupIterator();const S=[];for(;h;){const L=h.group;if(L.id===0||L.meta.propertyValues&&L.meta.propertyValues[0].value==null){h=h.nextGroup();continue}let I=L.meta.propertyValues[0];const v=c===N.date?new Date(I.value).getTime():I.value;if(S.push(v),l.name in g)g[l.name].data.push({x:v,y:L.images.length,images:L.images.slice(0,20).map(T=>T.urlSmall)});else{const T=L.children.map(G=>G.meta.propertyValues[0].value),C=r.filter(G=>!T.includes(G));for(let G of L.children){const R=G.meta.propertyValues[0].value;if(g[R]===void 0){let Q=R;R in t.tags&&(Q=t.tags[R].value),g[R]={data:[],name:Q}}g[G.meta.propertyValues[0].value].data.push({x:v,y:G.images.length,images:G.images.slice(0,20).map(Q=>Q.urlSmall)})}for(let G of C){if(g[G]===void 0){let R=G;G in t.tags&&(R=t.tags[G].value),g[G]={data:[],name:R}}g[G].data.push({x:v,y:0,images:[]})}L.children.forEach(()=>h=h.nextGroup())}h=h.nextGroup()}return a.value="",{series:Object.values(g),xValues:S,dataType:c}}return o.collection.groupManager.onResultChange.addListener(()=>m.value=b()),(g,r)=>(s(),n("div",{class:"",style:X({height:o.height+"px"})},[a.value===""?(s(),V(Na,{key:0,chartData:m.value,height:o.height-50+"px"},null,8,["chartData","height"])):(s(),n("span",Ha,x(a.value),1))],4))}}),qa={key:0,class:"m-0 p-0"},Qa={key:0,style:{"margin-left":"10px"}},Ka=O({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(k,{expose:d}){me();const t=H(),o=k;d({updateScrollerWidth:I});const a=M({}),m=M(!0),p=M(null),b=M(null),g=M(null),r=M(0),i=M(0),l=ve({groups:!1}),c=z(()=>o.tab.getVisibleProperties());function h(){p.value&&b.value?r.value=o.height-p.value.clientHeight-b.value.clientHeight-5:p.value?r.value=o.height-p.value.clientHeight-5:r.value=0}function S(T){a.value=o.tab.collection.groupManager.result.index[T],Z(()=>h())}function L(){a.value={},Z(()=>h())}async function I(){await Z(),i.value=p.value?.clientWidth??i.value}J(()=>{i.value=p.value.clientWidth,window.addEventListener("resize",I)}),Me(()=>{window.removeEventListener("resize",I)});function v(T,C){const G=performance.now(),R=[];for(let D=0;D<T;D++)R.push(Math.floor(Math.random()*1e3));const Q=performance.now();console.log(`Array initialization took ${(Q-G).toFixed(2)} ms`);const A=performance.now(),w=R.reduce((D,E)=>D+(E>C?1:0),0),$=performance.now();console.log(`Counting values > ${C} took ${($-A).toFixed(2)} ms`),console.log(`Count: ${w}`)}return v(1e6,500),q(()=>o.tab.state.imageSize,()=>Z(h)),q(()=>o.filterOpen,()=>Z(h)),q(()=>o.height,async()=>{await Z(h)}),J(h),J(()=>o.tab.update()),(T,C)=>(s(),n(P,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:p},[o.filterOpen?(s(),V(Sa,{key:0,tab:o.tab,"compute-status":l},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:b,class:"m-0 p-0"},[a.value.id?(s(),n("div",qa,[y(Ua,{tab:o.tab,group:a.value,"image-size":o.tab.state.imageSize,width:i.value,height:50,onClose:L,onScroll:g.value.scrollTo,onUpdate:C[0]||(C[0]=G=>Z(()=>h()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),u(t).isLoaded&&i.value>0&&r.value>0&&m.value?(s(),n("div",Qa,[o.tab.state.display=="tree"?(s(),V(ft,{key:0,"input-key":"main-view-tree","group-manager":o.tab.collection.groupManager,"image-size":o.tab.state.imageSize,height:r.value-0,properties:c.value,"hide-if-modal":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:g,width:i.value-25,onRecommend:S},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),o.tab.state.display=="grid"?(s(),n("div",{key:1,style:X({width:i.value-12+"px"}),class:"p-0 m-0 grid-container"},[y(yt,{tab:T.tab,manager:o.tab.collection.groupManager,height:r.value-15,width:i.value-40,"selected-properties":c.value,class:"p-0 m-0","show-images":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:g,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),o.tab.state.display=="graph"?(s(),V(Wa,{key:2,collection:o.tab.collection,height:r.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}}),Ya=U(Ka,[["__scopeId","data-v-eb7c14c2"]]),Xa=O({__name:"TabButton",props:{tab:{}},setup(k){const d=ce(),t=M(""),o=M(null),a=M(!1),m=M(!1),p=k,b=z(()=>p.tab.state.id);function g(){d.selectMainTab(p.tab.state.id)}function r(){m.value=!0,t.value=p.tab.state.name,Z(()=>o.value.focus())}function i(){p.tab.renameTab(t.value),m.value=!1}async function l(){confirm("Are you sure to delete Tab: "+p.tab.state.name)&&d.deleteTab(p.tab.state.id)}return J(()=>{p.tab.isNew&&r()}),(c,h)=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:h[1]||(h[1]=S=>a.value=!0),onMouseleave:h[2]||(h[2]=S=>a.value=!1)},[m.value?(s(),n("div",{key:1,class:B(["tab-button",b.value==u(d).mainTab?" active":""])},[e("form",{onSubmit:pe(i,["stop","prevent"])},[ye(e("input",{onFocusout:i,onKeydown:bt(i,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":h[0]||(h[0]=S=>t.value=S),ref_key:"inputElem",ref:o},null,544),[[be,t.value]])],32)],2)):(s(),n(P,{key:0},[y(F,{message:"main.menu.rename_tab_tooltip"},{default:_(()=>[e("i",{onClick:r,class:B(["bi bi-pencil me-1 tab-icon hover-light",a.value&&u(d).mainTab==b.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:B(["tab-button",b.value==u(d).mainTab?" active":""]),onClick:g},[e("span",null,x(p.tab.state.name),1)],2),y(F,{message:"main.menu.delete_tab_tooltip"},{default:_(()=>[e("i",{onClick:l,class:B(["btn-icon bi bi-x tab-icon hover-light",a.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Za={class:"d-flex d-row",style:{cursor:"pointer"}},Ja={class:"pt-1"},en={key:0,class:"bb bi bi-chevron-down"},tn={key:1,class:"bb bi bi-chevron-right"},sn={style:{"padding-top":"2px","margin-right":"2px"}},on={class:"lang"},an=["value"],nn=["value"],ln=O({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(k,{emit:d}){const{locale:t}=Oe(),o=de(),a=ce(),m=k,p=d;async function b(l){await a.addTab("New Tab")}const g=["fr","en"];function r(){p("update:filterOpen",!m.filterOpen)}function i(l){m.reRender();const c=l.target.value;t.value=c,me().setLang(c)}return(l,c)=>(s(),n("nav",null,[e("div",Za,[e("div",Ja,[e("span",{onClick:r},[m.filterOpen?(s(),n("i",en)):(s(),n("i",tn))])]),(s(!0),n(P,null,Y(u(a).loadedTabs,h=>(s(),n("div",null,[y(Xa,{tab:u(a).getTab(h)},null,8,["tab"])]))),256)),y(F,{message:"main.menu.add_tab_tooltip"},{default:_(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:b,id:"add-tab-button"},c[1]||(c[1]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),c[4]||(c[4]=e("div",{class:"flex-grow-1"},null,-1)),e("div",sn,[y(F,{message:"modals.notif.icon"},{default:_(()=>[e("span",{class:"bb",onClick:c[0]||(c[0]=h=>u(o).showModal(u(ee).NOTIF))},c[2]||(c[2]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",on,[c[3]||(c[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:l.$i18n.locale,onChange:i},[(s(),n(P,null,Y(g,(h,S)=>e("option",{key:`Lang${S}`,value:h},x(h.toUpperCase()),9,nn)),64))],40,an)])])]))}}),rn={key:0},dn={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},re=O({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(k){const d=k;return(t,o)=>d.loading?(s(),n("div",rn,[t.loading?(s(),n("div",dn,o[0]||(o[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),we=O({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(k){const d=k,t=z(()=>d.force?"100%":d.max==0?"0%":d.current>=d.max?"100%":Math.floor(d.current/d.max*100)+"%");return(o,a)=>(s(),n("span",null,x(t.value),1))}}),un={key:0,class:"center"},pn={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},cn={class:"d-flex text-secondary"},mn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},gn={class:"d-flex text-secondary",style:{"font-size":"14px"}},vn={key:0,class:"bi bi-check text-success"},fn={class:"d-flex text-secondary",style:{"font-size":"14px"}},yn={key:0,class:"bi bi-check text-success"},bn={class:"d-flex text-secondary",style:{"font-size":"14px"}},hn={key:0,class:"bi bi-check text-success"},_n={class:"d-flex text-secondary",style:{"font-size":"14px"}},kn={key:0,class:"bi bi-check text-success"},$n={class:"d-flex text-secondary",style:{"font-size":"14px"}},xn={key:0,class:"bi bi-check text-success"},wn=O({__name:"DataLoad",setup(k){const d=H();return(t,o)=>u(d).loadState?(s(),n("div",un,[e("div",pn,[e("div",null,[e("div",cn,[o[0]||(o[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedProperty},null,8,["loading"]),u(d).loadState.finishedProperty?(s(),n("i",mn)):f("",!0)]),e("div",gn,[o[1]||(o[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedPropertyGroups},null,8,["loading"]),u(d).loadState.finishedPropertyGroups?(s(),n("i",vn)):f("",!0)]),e("div",fn,[o[2]||(o[2]=e("div",{class:"me-1"},"Tags",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedTags},null,8,["loading"]),u(d).loadState.finishedTags?(s(),n("i",yn)):f("",!0)]),e("div",bn,[o[3]||(o[3]=e("div",{class:"me-1"},"Instances",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedInstance},null,8,["loading"]),u(d).loadState.finishedInstance?(s(),n("i",hn)):f("",!0),y(we,{current:u(d).loadState.counterInstance,max:u(d).loadState.maxInstance,force:u(d).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",_n,[o[4]||(o[4]=e("div",{class:"me-1"},"InstanceValues",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedInstanceValues},null,8,["loading"]),u(d).loadState.finishedInstanceValues?(s(),n("i",kn)):f("",!0),y(we,{current:u(d).loadState.counterInstanceValue,max:u(d).loadState.maxInstanceValue,force:u(d).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",$n,[o[5]||(o[5]=e("div",{class:"me-1"},"ImageValues",-1)),y(re,{class:"me-2",loading:!u(d).loadState.finishedImageValues},null,8,["loading"]),u(d).loadState.finishedImageValues?(s(),n("i",xn)):f("",!0),y(we,{current:u(d).loadState.counterImageValue,max:u(d).loadState.maxImageValue,force:u(d).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}}),Sn=U(wn,[["__scopeId","data-v-8b416e86"]]),Cn={key:0},In={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Vn={class:"w-100"},Mn={key:0,class:"custom-hr"},Tn={key:2,class:"loading"},zn={class:"text-center"},Fn={key:3,class:"loading"},En={key:1,class:"above"},Pn=O({__name:"PanopticView",setup(k){const d=me(),t=H(),o=de(),a=ce(),m=M(null),p=M(null),b=M(window.innerHeight),g=M(!1),r=M(!0),i=M(!0),l=z(()=>b.value-(p.value?.clientHeight??0)),c=z(()=>m.value?.filteredImages.map(C=>C.id));let h=navigator.userAgent.indexOf("Mac OS X")!==-1;async function S(){r.value=!1,await Z(),r.value=!0}J(async()=>{console.log(o.isProjectLoaded),o.isProjectLoaded||Fe.push("/"),Z(()=>{window.addEventListener("resize",L),L()}),window.addEventListener("keydown",C=>{C.key=="Control"&&(j.ctrl=!0),C.key=="Alt"&&(h&&(j.ctrl=!0),j.alt=!0),C.key=="Shift"&&(j.shift=!0),C.key=="ArrowLeft"&&(j.left=!0),C.key=="ArrowRight"&&(j.right=!0,console.log("keeeyy")),C.key=="Z"&&j.ctrl&&t.redo(),C.key=="z"&&j.ctrl&&t.undo()}),window.addEventListener("keyup",C=>{C.key=="Control"&&(j.ctrl=!1),C.key=="Alt"&&(h&&(j.ctrl=!1),j.alt=!1),C.key=="Shift"&&(j.shift=!1),C.key=="ArrowLeft"&&(j.left=!1),C.key=="ArrowRight"&&(j.right=!1)}),window.addEventListener("mousemove",C=>{j.ctrl=C.ctrlKey,j.alt=C.altKey,j.shift=C.shiftKey,h&&(j.ctrl=j.ctrl||j.alt)})}),Me(()=>{window.removeEventListener("resize",L)});function L(){b.value=window.innerHeight,g.value=!0}function I(){o.showModal(ee.EXPORT,c)}function v(){Fe.push("/")}function T(){m.value&&m.value.updateScrollerWidth()}return(C,G)=>(s(),n(P,null,[r.value&&!u(o).state.backendOff?(s(),n("div",Cn,[m.value&&!m.value.imageList?(s(),V(ht,{key:0,tutorial:"project"})):f("",!0),(s(),n("div",{id:"panoptic",key:u(d).status.renderNb},[e("div",In,[u(t).isLoaded?u(t).isLoaded?(s(),n(P,{key:1},[e("div",null,[y(Vs,{onExport:G[0]||(G[0]=R=>I()),onToggle:T})]),e("div",Vn,[e("div",{class:"ms-1",ref_key:"navElem",ref:p},[y(ln,{"re-render":S,filterOpen:i.value,"onUpdate:filterOpen":G[1]||(G[1]=R=>i.value=R)},null,8,["filterOpen"])],512),g.value?(s(),n("div",Mn)):f("",!0),y(Re,{id:u(a).mainTab},{default:_(({tab:R})=>[y(Ya,{tab:R,height:l.value,ref_key:"mainViewRef",ref:m,"filter-open":i.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):u(o).isProjectLoaded?(s(),n("div",Fn,G[2]||(G[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(s(),n("div",Tn,[e("div",zn,[e("div",null,x(C.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:v,style:{"font-size":"50px",cursor:"pointer"}})])])):(s(),n("div",{key:0,class:"d-flex flex-column w-100",style:X({height:b.value+"px"})},[y(Sn,{class:"flex-grow-1"})],4))])]))])):f("",!0),u(o).state.backendOff?(s(),n("div",En,"Lost connection to backend. Verify that panoptic is running and reload page")):f("",!0)],64))}}),Ln=U(Pn,[["__scopeId","data-v-411c21e8"]]);export{Ln as default};
