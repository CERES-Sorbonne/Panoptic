import{d as G,B as H,k as I,D as se,l as _,b as e,i as te,t as x,V as He,o as s,W as Ie,r as V,c as z,a as n,f as Y,n as j,F as O,s as K,h as f,X as ce,q as y,e as d,Y as Ee,Z as ke,$ as Te,_ as U,a0 as me,m as J,a1 as Q,a2 as Pe,j as Z,a3 as Oe,u as ue,a4 as de,a5 as ge,w as ye,v as be,a6 as Ge,M as ee,y as T,a7 as Se,Q as N,a8 as Ve,a9 as We,aa as le,ab as Le,I as qe,g as Ce,ac as ze,ad as Qe,ae as Ke,L as Ye,af as Xe,ag as Ze,O as Je,R as et,S as tt,ah as st,ai as ot,aj as De,ak as Re,al as at,am as ne,an as oe,ao as nt,ap as lt,C as A,aq as it,ar as rt,as as dt,at as ut,au as pt,av as ve,aw as Me,ax as ct,ay as mt,az as gt,aA as vt,aB as ft,aC as yt,aD as bt,aE as ht,p as Fe}from"./index-CYsI59n2.js";import{_ as _t}from"./Tutorial.vue_vue_type_style_index_0_lang-DiDgl6w3.js";const kt={class:"text-nowrap"},$t=["onClick"],xt=["onClick"],wt=G({__name:"FolderOptionDropdown",props:{folder:{}},setup(k){const r=H(),t=k;function o(){r.reImportFolder(t.folder.id)}function a(){confirm(He.global.t("main.nav.folders.del_alert"))&&r.deleteFolder(t.folder.id)}return(g,m)=>(s(),I(se,{teleport:!0},{button:_(()=>m[0]||(m[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:_(({hide:b})=>[e("div",kt,[e("div",{class:"p-2 bb",onClick:p=>{o(),b()}},m[1]||(m[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),te("Re import")]),8,$t),m[3]||(m[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:p=>{a(),b()}},[m[2]||(m[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),te(x(g.$t("main.nav.folders.del")),1)],8,xt)])]),_:1}))}}),St=["onMouseenter"],Ct=["onClick"],It={class:"text-secondary"},Vt=["onClick"],Mt=G({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0},tab:Object},setup(k){const r=H(),t=k,o=V(null),a=z(()=>{let l={};const c=new Set(t.filterManager.state.folders);return t.folders.map(i=>i.id).forEach(i=>{c.has(i)&&(l[i]=!0)}),l}),g=z(()=>{let l={};return t.folders.map(c=>c.id).forEach(c=>{t.visibleFolders[c]&&(l[c]=!0)}),l}),m=z(()=>{let l={};return t.folders.forEach(c=>{let i=[];a.value[c.id]&&i.push("selected"),l[c.id]=i.join(" ")}),l});function b(l){let c=t.visibleFolders;c[l]?delete c[l]:c[l]=!0}function p(l){let c=new Set(t.filterManager.state.folders);const i=c.has(l),v=r.folders[l].parent!=null&&c.has(r.folders[l].parent);i&&!v?(c.delete(l),ke(l).forEach(C=>c.delete(C.id))):(u(l,c),c.add(l),ke(l).forEach(C=>c.add(C.id)),Te(r.folders[l]).forEach(C=>c.delete(C.id))),t.filterManager.setFolders(Array.from(c)),t.tab.setSelectedFolder(c),t.filterManager.update(!0)}function u(l,c){const i=Te(r.folders[l]);let v;for(let C of i)if(c.has(C.id))v=C;else break;v!=null&&ke(v.id).forEach(C=>c.delete(C.id))}return(l,c)=>{const i=Ee("FolderList2",!0);return s(),n("ul",{class:j(t.root?"tree":""),style:Y(t.root?"padding-left:0px;":"")},[(s(!0),n(O,null,K(k.folders,v=>(s(),n("li",{style:Y(t.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:C=>o.value=v.id,onMouseleave:c[1]||(c[1]=C=>o.value=null)},[e("summary",{class:j(m.value[v.id]),onClick:C=>p(v.id)},[e("span",{class:j(o.value===v.id?"visible-option":"invisible-option"),onClick:c[0]||(c[0]=ce(()=>{},["stop"]))},[y(wt,{folder:v},null,8,["folder"])],2),te(" "+x(v.name)+" ",1),e("span",It,x(d(r).folders[v.id].count),1)],10,Ct)],40,St),v.children&&v.children.length>0?(s(),n("i",{key:0,onClick:C=>b(v.id),class:j("bi bi-chevron-"+(g.value[v.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Vt)):f("",!0),v.children&&v.children.length>0&&g.value[v.id]?(s(),I(i,{key:1,folders:v.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager,tab:t.tab},null,8,["folders","visible-folders","filter-manager","tab"])):f("",!0)],4))),256))],6)}}}),Tt=U(Mt,[["__scopeId","data-v-411b308b"]]),zt={class:"text-center"},Ft={class:"w-100 text-center",style:{"font-size":"10px"}},Et={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Pt=G({__name:"TaskStatus",props:{task:{}},setup(k){const r=k,t=z(()=>r.task.total-r.task.remain-r.task.computing),o=z(()=>r.task.total);return(a,g)=>(s(),n("div",zt,[te(x(r.task.name)+" ",1),e("div",Ft,x(t.value)+" / "+x(o.value)+" "+x(a.$t("main.nav.tasks.done")),1),o.value>0?(s(),n("div",Et,[e("div",{class:"progress-bar",style:Y(`width: ${t.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),Ae=G({__name:"TabContainer",props:{id:{}},setup(k){const r=me(),t=k;let o;const a=V(!1);function g(){o=r.getTab(t.id),a.value=!0}return J(g),Q(()=>t.id,async()=>{a.value=!1,await Z(),g()}),(m,b)=>a.value&&d(r).loaded?Pe(m.$slots,"default",{key:0,tab:d(o)}):f("",!0)}}),fe={},Ot={class:"d-flex flex-row"},Gt={key:2,class:"d-flex",style:{width:"150px"}},Lt={class:"flex-grow-1"},Dt={key:1,style:{"padding-top":"1px"}},Rt={style:{width:"20px","margin-top":"2px"},class:"text-center"},At={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},Ut={key:0},Bt={key:0,class:"ms-3 pt-1"},jt={key:1},Nt=G({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(k){const{t:r}=Oe({useScope:"global"}),t=ue();de();const o=H(),a=k,g=V(!1),m=V(!1),b=V(""),p=V(!1),u=z(()=>a.tab.state.visibleProperties[a.property.id]==!0),l=z(()=>a.tab.collection.filterManager.state.filter.filters.some(S=>!S.isGroup&&S.propertyId==a.property.id)),c=z(()=>a.tab.collection.groupManager.state.groupBy.includes(a.property.id)),i=z(()=>a.tab.collection.sortManager.state.sortBy.includes(a.property.id)),v=z(()=>{if(l.value)return a.tab.collection.filterManager.state.filter.filters.find(S=>!S.isGroup&&S.propertyId==a.property.id).id}),C=()=>a.tab.collection.filterManager,E=z(()=>a.tab.getSha1Mode());function h(){u.value?a.tab.setVisibleProperty(a.property.id,!1):a.tab.setVisibleProperty(a.property.id,!0)}function w(){a.open&&(g.value?g.value=!1:(g.value=!0,b.value=a.property.name),m.value=!1)}function M(){a.property.type!=N.tag&&a.property.type!=N.multi_tags||(m.value?m.value=!1:m.value=!0,g.value=!1)}function F(){i.value?a.tab.collection.sortManager.delSort(a.property.id):a.tab.collection.sortManager.setSort(a.property.id),a.tab.collection.sortManager.update(!0)}function L(){c.value?a.tab.collection.groupManager.delGroupOption(a.property.id):a.tab.collection.groupManager.setGroupOption(a.property.id),a.tab.collection.groupManager.update(!0)}function B(){confirm(r("common.properties.delete")+": "+a.property.name+" ?   "+a.property.id)&&o.deleteProperty(a.property.id)}async function X(){b.value!=""&&(await o.updateProperty(a.property.id,b.value),w())}function D(){const S=C();l.value?(S.deleteFilter(v.value),fe.filter.hide()):(S.addNewFilter(a.property.id),fe.filter.show())}return Q(()=>a.property,()=>{g.value=!1}),(S,$)=>(s(),n("div",{class:j(p.value?"hover-light":"")},[e("div",Ot,[a.open?(s(),n(O,{key:0},[g.value?f("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:w},[y(ge,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=R=>p.value=!0),onMouseleave:$[1]||($[1]=R=>p.value=!1)},null,8,["type"]),e("span",null,x(a.property.name),1)]))],64)):(s(),I(ge,{key:1,type:a.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),g.value&&a.open?(s(),n("div",Gt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:w,onMouseenter:$[2]||($[2]=R=>p.value=!0),onMouseleave:$[3]||($[3]=R=>p.value=!1)},null,32)]),e("div",Lt,[a.property.id>=0?ye((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=R=>b.value=R),onChange:X},null,544)),[[be,b.value]]):(s(),n("span",Dt,[y(ge,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(a.property.name),1)]))])])):f("",!0),a.open?(s(),n(O,{key:3},[d(Ge)(a.property.type)?(s(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=R=>d(t).showModal(d(ee).TAG,{propId:a.property.id}))},[y(T,{click:!1,message:"main.nav.properties.open_tags"},{default:_(()=>$[7]||($[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",Rt,[a.property.mode==d(Se).id?(s(),I(T,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:_(()=>$[8]||($[8]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:h,class:"btn-icon text-center"},[E.value&&a.property.mode==d(Se).id?(s(),I(T,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:_(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=ce(()=>{},["stop"]))})]),_:1})):(s(),I(T,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:_(()=>[e("span",{class:j("bi bi-eye text-"+(u.value?"primary":"secondary"))},null,2)]),_:1}))]),a.open?(s(),n("div",At,[a.property.type==d(N).tag||a.property.type==d(N).multi_tags?(s(),n("div",{key:0,onClick:M,style:{cursor:"pointer"}},[m.value?(s(),I(T,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:_(()=>$[9]||($[9]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(s(),I(T,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:_(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),a.open?(s(),n("div",Ut,[g.value?(s(),n("div",Bt,[S.property.id!=d(Ve).folders?(s(),n("div",{key:0,class:j(["options hover-light",l.value?" text-primary":""]),onClick:D},[e("div",null,[$[11]||($[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),te(x(S.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:j(["options hover-light",i.value?" text-primary":""]),onClick:F},[$[12]||($[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),te(x(S.$t("main.menu.sort.title")),1)],2),e("div",{class:j(["options hover-light",c.value?" text-primary":""]),onClick:L},[$[13]||($[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),te(x(S.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),n("div",{key:1,class:"options hover-light",onClick:B},[$[14]||($[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),te(x(S.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):m.value?(s(),n("div",jt,[y(We,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}}),Ht=U(Nt,[["__scopeId","data-v-aa687f93"]]),Wt={key:0,class:"prop-container"},qt={key:0},Qt={key:1},Kt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Yt={key:1,class:"ms-2"},Xt={class:"p-1"},Zt=["onClick"],Jt=["onClick"],es={key:0,class:"ps-1 pe-1"},ts={class:"property-item"},ss=G({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(k){const r=H(),t=ue(),o=k,a=V(!0),g=V(!1),m=V(""),b=z(()=>o.node.propertyIds.map(h=>r.properties[h])),p=z(()=>{if(o.node.groupId>=0)return r.propertyGroups[o.node.groupId];if(o.node.groupId==le.DEFAULT)return{id:le.DEFAULT,name:"default"};if(o.node.groupId==le.COMPUTED)return{id:le.COMPUTED,name:"computed"}}),u=z(()=>p.value.id>=0);function l(){a.value=!a.value}function c(h){r.updatePropertyGroup(p.value.id,m.value)}function i(){m.value=p.value.name}function v(){r.deletePropertyGroup(p.value.id)}async function C(){let h=r.propertyList.filter(w=>w.propertyGroupId==o.node.groupId);for(let w of h)await r.deleteProperty(w.id);o.node.groupId>=0&&await r.deletePropertyGroup(o.node.groupId)}async function E(h){if(h.added){let w=h.added.element;const M=r.properties[w];let F=o.node.groupId;F<0&&(F=null),await r.updateProperty(M.id,M.name,F),await r.triggerPropertyTreeChange()}h.moved&&await r.triggerPropertyTreeChange()}return J(i),Q(o,i),(h,w)=>d(r).propertyGroups[o.node.groupId]||o.node.groupId<0?(s(),n("div",Wt,[y(d(Le),{list:o.node.propertyIds,"item-key":M=>M,group:o.node.groupId>0||o.node.groupId==d(le).DEFAULT?"properties":void 0,onChange:E},{header:_(()=>[e("div",{class:"d-flex group-container",onClick:l},[a.value?(s(),n("div",qt,w[4]||(w[4]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(s(),n("div",Qt,w[5]||(w[5]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),o.menuOpen?(s(),n(O,{key:2},[g.value?f("",!0):(s(),n("div",Kt,x(p.value.name),1)),g.value?(s(),n("div",Yt,[y(qe,{"auto-focus":!0,modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=M=>m.value=M),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:c,onCancel:i,onBlur:w[1]||(w[1]=M=>g.value=!1)},null,8,["modelValue"])])):f("",!0),w[8]||(w[8]=e("div",{class:"flex-grow-1"},null,-1)),o.node.groupId>=d(le).DEFAULT?(s(),I(se,{key:2,onClick:w[2]||(w[2]=ce(()=>{},["prevent","stop"]))},{button:_(()=>w[6]||(w[6]=[e("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:_(({hide:M})=>[e("div",Xt,[u.value?(s(),n(O,{key:0},[e("div",{class:"bb",onClick:F=>{g.value=!0,M()}},x(h.$t("main.menu.editName")),9,Zt),e("div",{class:"bb",onClick:v},x(h.$t("main.menu.removeGroup")),1)],64)):f("",!0),e("div",{class:"bb",onClick:F=>{C(),M()}},x(h.$t("main.menu.deleteGroupAndProperties")),9,Jt)])]),_:1})):f("",!0),o.node.groupId>=-1?(s(),n("div",{key:3,class:"bb me-2",onClick:w[3]||(w[3]=ce(M=>d(t).showModal(d(ee).PROPERTY,{group:o.node.groupId}),["stop","prevent"]))},[y(T,{message:h.$t("main.menu.addNewPropertyToGroup")},{default:_(()=>w[7]||(w[7]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):f("",!0)],64)):f("",!0)])]),item:_(({element:M,index:F})=>[a.value&&b.value.length&&d(r).properties[M]?(s(),n("div",es,[e("div",ts,[y(Ht,{tab:o.tab,property:d(r).properties[M],open:o.menuOpen},null,8,["tab","property","open"])])])):f("",!0)]),_:1},8,["list","item-key","group"])])):f("",!0)}}),$e=U(ss,[["__scopeId","data-v-96e18bee"]]),os={key:0,class:"mb-1"},as=G({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(k,{emit:r}){const t=H(),o=k;function a(g){t.triggerPropertyTreeChange()}return(g,m)=>(s(),I(d(Le),{list:d(t).propertyTree,onChange:a,"item-key":b=>b.groupId},{item:_(({element:b})=>[b.groupId>=0?(s(),n("div",os,[y($e,{tab:o.tab,node:b,"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])])):f("",!0)]),footer:_(()=>[y($e,{class:"mb-1",tab:o.tab,node:d(t).propertyTree[d(t).propertyTree.length-2],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"]),y($e,{class:"mb-1",tab:o.tab,node:d(t).propertyTree[d(t).propertyTree.length-1],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),ns={class:""},ls={class:"m-0",style:{padding:"4px 0px 4px 8px"}},is={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},rs={class:"flex-grow-1 text-capitalize overflow-hidden"},ds={key:0,class:"bi bi-chevron-left"},us={key:1,class:"bi bi-chevron-right"},ps={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},cs={class:"d-flex align-items-center"},ms={style:{"max-height":"300px",overflow:"auto"}},gs={key:0,id:"import"},vs={class:"pt-1 pb-2"},fs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},ys={key:0,class:"ps-2 pe-2"},bs={class:"p-1"},hs={key:0,class:"custom-hr"},_s={class:"p-1 mt-0"},ks={key:0,class:"d-flex p-1"},$s={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},xs={key:1,class:"bb me-1"},ws={class:"bb me-2"},Ss={key:1,class:"mt-2"},Cs=200,Is=55,Vs=G({__name:"Menu",emits:["export","toggle"],setup(k,{emit:r}){const t=de(),o=H(),a=ue(),g=me(),m=r,b=V(!1),p=V(!0),u=z(()=>p.value?Cs:Is),l=async()=>{a.showModal(ee.IMPORT)},c=z(()=>t.state.tasks.filter(E=>!E.done)??[]);function i(){a.showModal(ee.FOLDERSELECTION,{callback:v,mode:"images"})}function v(E){E&&o.addFolder(E)}function C(){p.value=!p.value,m("toggle")}return(E,h)=>(s(),I(Ae,{id:d(g).mainTab},{default:_(({tab:w})=>[e("div",{class:"menu overflow-scroll",style:Y({width:u.value+"px"})},[e("div",ns,[e("div",null,[e("div",ls,[e("div",is,[p.value?(s(),n(O,{key:0},[e("div",rs,x(d(t).state.name),1),y(T,{message:"main.menu.close_project"},{default:_(()=>[e("div",{class:"base-hover p-1",onClick:h[0]||(h[0]=M=>d(a).closeProject(d(t).state.id))},h[6]||(h[6]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:h[1]||(h[1]=M=>d(a).showModal(d(ee).SETTINGS))},h[7]||(h[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:j(["base-hover p-1",p.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:C},[p.value?(s(),n("i",ds)):(s(),n("i",us))],2)])]),p.value?(s(),n(O,{key:0},[h[9]||(h[9]=e("div",{class:"custom-hr"},null,-1)),e("div",ps,[e("div",cs,[e("div",null,[e("b",null,x(E.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:h[2]||(h[2]=M=>{i(),d(Ce)()})},[y(T,{message:"main.nav.folders.add"},{default:_(()=>h[8]||(h[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",ms,[y(Tt,{folders:d(o).folderRoots,"filter-manager":w.collection.filterManager,"visible-folders":w.state.visibleFolders,tab:w},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):f("",!0),p.value?(s(),n(O,{key:1},[c.value&&c.value.length?(s(),n("div",gs,[h[11]||(h[11]=e("div",{class:"custom-hr"},null,-1)),e("div",vs,[e("div",fs,[e("div",null,[e("b",null,x(E.$t("main.nav.tasks.title")),1)])]),h[10]||(h[10]=e("div",{class:"custom-hr"},null,-1)),d(t).state.tasks?(s(),n("div",ys,[(s(!0),n(O,null,K(c.value,(M,F)=>(s(),n("div",bs,[F?(s(),n("div",hs)):f("",!0),y(Pt,{task:M},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),h[18]||(h[18]=e("div",{class:"custom-hr"},null,-1)),e("div",_s,[p.value?(s(),n("div",ks,[y(T,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:_(()=>[e("b",null,x(E.$t("main.nav.properties.title")),1)]),_:1}),h[13]||(h[13]=e("span",{class:"flex-grow-1"},null,-1)),b.value?(s(),n("span",$s,h[12]||(h[12]=[e("span",{class:"sr-only"},null,-1)]))):(s(),n("span",xs,[y(T,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:l})]),_:1})])),e("span",ws,[y(T,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h[3]||(h[3]=M=>d(a).showModal(d(ee).EXPORT,void 0))})]),_:1})])])):f("",!0),d(t).loaded?(s(),n("div",Ss,[y(as,{tab:w,"menu-open":p.value},null,8,["tab","menu-open"]),p.value?(s(),n(O,{key:0},[h[16]||(h[16]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:h[4]||(h[4]=M=>{d(a).showModal(d(ee).PROPERTY,void 0),d(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[14]||(h[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(E.$t("main.nav.properties.add_property")),1)]),h[17]||(h[17]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:h[5]||(h[5]=M=>d(o).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[15]||(h[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(E.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)])])])],4)]),_:1},8,["id"]))}}),Ms=U(Vs,[["__scopeId","data-v-33a01314"]]),Ts={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},zs={class:""},Fs=["onClick"],Es=G({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r;function a(g){o("update:modelValue",g)}return(g,m)=>(s(),I(se,null,{button:_(()=>[e("div",Ts,[e("span",zs,x(g.$t("modals.filters."+t.modelValue)),1)])]),popup:_(({hide:b})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:b},[e("div",{class:"base-btn",onClick:m[0]||(m[0]=p=>a(d(ze).and))},x(g.$t("modals.filters.and")),1),m[2]||(m[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:m[1]||(m[1]=p=>a(d(ze).or))},x(g.$t("modals.filters.or")),1)],8,Fs)]),_:1}))}}),Ps=["disabled"],Os={class:"m-0 p-1"},Gs=["onClick"],Ls=G({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(k,{emit:r}){const t=H(),o=k,a=r,g=z(()=>t.properties[o.propertyId]),m=z(()=>Qe(g.value.type));async function b(p){a("update:modelValue",p)}return(p,u)=>(s(),I(se,{onHide:u[0]||(u[0]=l=>a("hide")),placement:"bottom"},{button:_(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[e("span",null,x(p.$t("modals.filters.operators."+o.modelValue)),1)],8,Ps)]),popup:_(({hide:l})=>[e("div",Os,[(s(!0),n(O,null,K(m.value,c=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:i=>{b(c),l()}},[e("a",null,x(p.$t("modals.filters.operators."+c)),1)],8,Gs))),256))])]),_:1}))}}),Ds=U(Ls,[["__scopeId","data-v-21b8bb8e"]]),Rs={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},As=G({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r;function a(g){o("update:modelValue",g)}return(g,m)=>(s(),n("div",Rs,[d(Ge)(g.property.type)?(s(),I(Ke,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":a,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==d(N).color?(s(),I(Ye,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==d(N).number?(s(),I(Xe,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==d(N).url?(s(),I(Ze,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==d(N).checkbox?(s(),I(Je,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":a,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==d(N).date?(s(),I(et,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":a,width:t.width,class:"sb"},null,8,["model-value","width"])):(s(),I(tt,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Us={class:"p-0 m-0 ps-2"},Bs=G({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(k,{emit:r}){const t=H(),o=k,a=z(()=>t.properties[o.filter.propertyId]),g=z(()=>st(o.filter.operator));function m(u){o.manager.updateFilter(o.filter.id,{operator:u})}function b(u){o.manager.updateFilter(o.filter.id,{value:u})}function p(u){o.manager.updateFilter(o.filter.id,{propertyId:u.id})}return(u,l)=>(s(),n(O,null,[e("td",Us,[y(ot,{"model-value":a.value,"onUpdate:modelValue":p},null,8,["model-value"])]),e("td",null,[y(Ds,{"property-id":a.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":m},null,8,["property-id","model-value"])]),e("td",null,[g.value?(s(),I(As,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":b,property:a.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),js={style:{"max-height":"500px",overflow:"auto"}},Ue=G({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(k,{emit:r}){const t=k;function o(a){t.manager.addNewFilter(a,t.group.id),fe.filter.show()}return(a,g)=>(s(),I(se,{placement:"auto"},{button:_(()=>[Pe(a.$slots,"default")]),popup:_(({hide:m})=>[e("div",js,[y(De,{onSelect:b=>{o(b),m()},"ignore-ids":[d(Ve).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Ns={class:"filter-group"},Hs={class:"table table-sm"},Ws={style:{height:"33px"}},qs={class:""},Qs={key:0,class:"m-0 p-0"},Ks={key:2,class:"text-secondary"},Ys={class:"border rounded"},Xs={class:""},Zs=["onClick"],Js={class:"d-flex text-secondary ms-2"},eo={class:"add-options hover-light"},to=G({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(k,{emit:r}){H();const t=k,o=z(()=>t.filter),a=z(()=>o.value.filters),g=z(()=>{let u=255-(o.value.depth+1)*5;return`background: rgb(${u},${u},${u});`});function m(u){t.manager.deleteFilter(u.id)}function b(u){t.manager.addNewFilterGroup(u)}function p(u,l){t.manager.updateFilterGroup(u,l)}return(u,l)=>(s(),n("div",Ns,[e("table",Hs,[(s(!0),n(O,null,K(a.value,(c,i)=>(s(),n("tr",Ws,[e("td",qs,[i==0?(s(),n("div",Qs,x(u.$t("modals.filters.where")),1)):i==1?(s(),I(Es,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":l[0]||(l[0]=v=>p(o.value.id,v))},null,8,["model-value"])):(s(),n("span",Ks,x(u.$t("modals.filters."+o.value.groupOperator)),1))]),c.propertyId!==void 0?(s(),I(Bs,{key:0,filter:c,manager:t.manager},null,8,["filter","manager"])):(s(),n("td",{key:1,colspan:"3",style:Y(g.value)},[e("div",Ys,[y(Be,{filter:c,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",Xs,[e("span",{class:"base-btn",onClick:v=>m(c)},l[2]||(l[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Zs)])]))),256))]),e("div",Js,[y(Ue,{group:t.filter,manager:t.manager},{default:_(()=>[e("div",eo,[l[3]||(l[3]=e("i",{class:"bi bi-plus"},null,-1)),te(x(u.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:l[1]||(l[1]=c=>b(o.value.id))},[l[4]||(l[4]=e("i",{class:"bi bi-plus"},null,-1)),te(x(u.$t("modals.filters.new_group")),1)])])]))}}),Be=U(to,[["__scopeId","data-v-e644f737"]]),so={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},oo={key:0},ao={key:0,class:"or-separator"},no={key:0,class:"or-separator"},lo={key:0,class:"m-1 p-1"},io=G({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(k,{emit:r}){const t=H(),o=k,a=V(null),g=V(null),m=z(()=>{let p=b(o.manager.state.filter),u={};return p.forEach(l=>u[l.propertyId]=l),Object.values(u)});function b(p){let u=[];for(let l of p.filters)l.isGroup?u.push(...b(l)):u.push(l);return u}return Q(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&g.value.hide()}),J(async()=>{await Z(),fe.filter=g.value}),(p,u)=>(s(),I(se,{ref_key:"dropdownElem",ref:g,placement:"top-start"},{button:_(()=>[e("div",null,[m.value.length||o.manager.state.query?(s(),n("div",so,[o.manager.state.query?(s(),n("div",oo,[u[0]||(u[0]=e("span",{class:"text-primary"},"Text Query",-1)),m.value.length?(s(),n("span",ao,"|")):f("",!0)])):f("",!0),(s(!0),n(O,null,K(m.value,(l,c)=>(s(),n("div",null,[c>0?(s(),n("span",no,"|")):f("",!0),l.propertyId==d(Ve).id?(s(),I(ge,{key:1,type:d(t).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(d(t).properties[l.propertyId].name),1)]))),256))])):f("",!0)])]),popup:_(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:a},[Object.keys(d(t).properties).length>0?(s(),n("div",lo,[y(Be,{filter:o.manager.state.filter,manager:o.manager,parent:a.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}}),ro=U(io,[["__scopeId","data-v-56cd3bdb"]]),uo={class:"d-flex flex-row filter-form"},po={class:"pt-1 pb-1"},co=G({__name:"FilterForm",props:{manager:Ie},setup(k){const r=k;return(t,o)=>(s(),n("div",uo,[e("div",po,x(t.$t("main.menu.filters"))+": ",1),y(ro,{manager:r.manager},null,8,["manager"]),y(Ue,{manager:r.manager,group:r.manager.state.filter,class:"p-1"},{default:_(()=>o[0]||(o[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),mo=U(co,[["__scopeId","data-v-cc2f25ec"]]),go={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},vo=G({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(k,{emit:r}){const t=k,o=r,a=V(null);return(g,m)=>(s(),I(se,{ref_key:"dropdownElem",ref:a,"auto-focus":!1},{button:_(()=>m[2]||(m[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:_(()=>[e("div",go,[y(De,{onClick:m[0]||(m[0]=b=>d(Ce)()),onSelect:m[1]||(m[1]=b=>{o("select",b),a.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),je=U(vo,[["__scopeId","data-v-012e1f38"]]),fo={class:"base-hover ps-1 pe-1"},yo={class:"main"},bo=["onClick"],ho=G({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r,a=Object.values(Re);function g(m){o("update:modelValue",m)}return(m,b)=>(s(),I(se,null,{button:_(()=>[e("div",fo,x(t.modelValue),1)]),popup:_(({hide:p})=>[e("div",yo,[(s(!0),n(O,null,K(d(a),u=>(s(),n("div",{class:"base-hover option",onClick:l=>{g(u),p()}},x(u),9,bo))),256))])]),_:1}))}}),_o=U(ho,[["__scopeId","data-v-ce3e3774"]]),ko={class:""},$o={class:"d-flex ipt"},xo={class:"ms-2",min:"1"},wo=G({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(k,{emit:r}){const t=k,o=r,a=V(1),g=V(Re.Year);function m(){t.option.stepSize==a.value&&t.option.stepUnit==g.value||o("change",{stepSize:a.value,stepUnit:g.value})}function b(){a.value=t.option.stepSize??1,g.value=t.option.stepUnit}return Q(()=>t.option,b),J(b),Q(a,()=>{(a.value<1||a.value==null||isNaN(a.value))&&(a.value=1)}),(p,u)=>(s(),I(se,{onHide:m},{button:_(()=>u[2]||(u[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:_(({hide:l,focus:c})=>[e("div",ko,[e("div",$o,[e("div",null,[ye(e("input",{type:"number","onUpdate:modelValue":u[0]||(u[0]=i=>a.value=i)},null,512),[[be,a.value]])]),e("div",xo,[y(_o,{modelValue:g.value,"onUpdate:modelValue":u[1]||(u[1]=i=>g.value=i),onHide:c},null,8,["modelValue","onHide"])])])])]),_:1}))}}),So=U(wo,[["__scopeId","data-v-78b647dc"]]),Co={class:"d-flex flex-row group-form"},Io={class:"pt-1 pb-1"},Vo={key:0,class:"bg-selected bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Mo={key:0,class:"bi bi-chevron-right smaller"},To=["onClick"],zo=["onClick"],Fo=["onClick"],Eo=["onClick"],Po=["onClick"],Oo=["onClick"],Go=["onClick"],Lo=["onClick"],Do=["onClick"],Ro={key:5,class:"sm-btn"},Ao={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Uo=G({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(k){const r=H(),t=k;function o(l){t.manager.setGroupOption(l),t.manager.update(!0)}function a(l){t.manager.delGroupOption(l),t.manager.update(!0)}function g(l,c){t.manager.setGroupOption(l,{direction:c}),t.manager.sortGroups(!0)}function m(l,c){t.manager.setGroupOption(l,{type:c}),t.manager.sortGroups(!0)}function b(l,c){t.manager.setGroupOption(l,c),t.manager.update(!0)}const p=z(()=>t.manager.state.groupBy.map(l=>r.properties[l])),u=z(()=>{const l=[];return t.manager.state.groupBy.forEach(c=>{l.push({option:t.manager.state.options[c],property:r.properties[c]})}),l});return(l,c)=>(s(),n("div",Co,[e("div",Io,x(l.$t("main.menu.groupby"))+": ",1),p.value.length?(s(),n("div",Vo,[(s(!0),n(O,null,K(u.value,(i,v)=>(s(),n(O,null,[v>0?(s(),n("i",Mo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:C=>a(i.property.id),id:"remove-group-button"},x(i.property.name),9,To),i.option.type==d(ne).Size?(s(),I(T,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:_(()=>[i.option.direction==d(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:C=>m(i.property.id,d(ne).Property)},null,8,zo)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:C=>m(i.property.id,d(ne).Property)},null,8,Fo))]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:_(()=>[i.property.type==d(N).number?(s(),n(O,{key:0},[i.option.direction==d(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:C=>m(i.property.id,d(ne).Size)},null,8,Eo)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:C=>m(i.property.id,d(ne).Size)},null,8,Po))],64)):(s(),n(O,{key:1},[i.option.direction==d(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:C=>m(i.property.id,d(ne).Size)},null,8,Oo)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:C=>m(i.property.id,d(ne).Size)},null,8,Go))],64))]),_:2},1024)),i.option.direction==d(oe).Ascending?(s(),I(T,{key:3,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:C=>g(i.property.id,d(oe).Descending)},null,8,Lo)]),_:2},1024)):(s(),I(T,{key:4,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:C=>g(i.property.id,d(oe).Ascending)},null,8,Do)]),_:2},1024)),i.property.type==d(N).date?(s(),n("div",Ro,[y(So,{option:i.option,onChange:C=>b(i.property.id,C)},null,8,["option","onChange"])])):f("",!0)],64))),256)),t.isLoading?(s(),n("i",Ao)):f("",!0)])):f("",!0),y(je,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:c[0]||(c[0]=i=>o(i))},null,8,["group-ids"])]))}}),Bo=U(Uo,[["__scopeId","data-v-81bcbb10"]]),jo={class:"d-flex flex-row sort-form"},No={class:"pt-1 pb-1"},Ho={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Wo={key:0,class:"bi bi-chevron-right smaller"},qo=["onClick"],Qo=["onClick"],Ko=["onClick"],Yo=G({__name:"SortForm",props:{manager:nt},setup(k){const r=H(),t=k,o=z(()=>t.manager.state.sortBy.map(p=>({propertyId:p,direction:t.manager.state.options[p].direction}))),a=z(()=>o.value.map(p=>p.propertyId));function g(p){t.manager.setSort(p),t.manager.update(!0)}function m(p){t.manager.delSort(p),t.manager.update(!0)}function b(p,u){t.manager.setSort(p,{direction:u}),t.manager.update(!0)}return(p,u)=>(s(),n("div",jo,[e("div",No,x(p.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),n("div",Ho,[(s(!0),n(O,null,K(o.value,(l,c)=>(s(),n(O,null,[c>0?(s(),n("i",Wo)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:i=>m(l.propertyId)},x(d(r).properties[l.propertyId].name),9,qo),l.direction==d(oe).Ascending?(s(),I(T,{key:1,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:i=>b(l.propertyId,d(oe).Descending)},null,8,Qo)]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:i=>b(l.propertyId,d(oe).Ascending)},null,8,Ko)]),_:2},1024))],64))),256))])):f("",!0),y(je,{"group-ids":a.value,onSelect:u[0]||(u[0]=l=>g(l))},null,8,["group-ids"])]))}}),Xo=U(Yo,[["__scopeId","data-v-4e00ef99"]]),Zo={class:"p-2"},Jo={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ea={class:"border mb-1 p-1"},ta={class:"me"},sa={key:0},oa={key:1},aa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},na={class:"d-flex center justify-content-center"},la={key:1,class:"bi bi-arrow-down text-secondary"},ia={key:3,class:"bi bi-arrow-up text-secondary"},ra={class:"border mb-1 p-1"},da={class:"me"},ua={key:0},pa={key:1},ca={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ie=5,ma=G({__name:"HistoryDropdown",emits:[],setup(k,{emit:r}){const t=H(),o=V(!1),a=z(()=>o.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),g=z(()=>[...t.history.undo].reverse().slice(0,ie)),m=z(()=>t.history.redo.slice(Math.max(t.history.redo.length-ie,0)));return Q(()=>t.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(b,p)=>g.value.length||m.value.length?(s(),I(se,{key:0},{button:_(()=>[y(T,{message:"dropdown.history.info"},{default:_(()=>[e("div",{class:"d-flex sb flash",style:Y([{"font-size":"14px"},a.value])},[p[2]||(p[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(b.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:_(()=>[e("div",Zo,[d(t).history.redo.length>ie?(s(),n("div",Jo," + "+x(d(t).history.redo.length-ie),1)):f("",!0),(s(!0),n(O,null,K(m.value,u=>(s(),n("div",ea,[e("span",ta,x(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[3]||(p[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),u.tags?(s(),n("span",sa,x(u.tags)+" "+x(b.$t("dropdown.history.tags")),1)):f("",!0),u.values?(s(),n("span",oa,x(u.values)+" "+x(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",aa,[e("div",na,[g.value.length?(s(),I(T,{key:0,message:"dropdown.history.undo"},{default:_(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:p[0]||(p[0]=(...u)=>d(t).undo&&d(t).undo(...u))})]),_:1})):(s(),n("div",la)),p[4]||(p[4]=e("div",{style:{width:"30px"}},null,-1)),m.value.length?(s(),I(T,{key:2,message:"dropdown.history.redo"},{default:_(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:p[1]||(p[1]=(...u)=>d(t).redo&&d(t).redo(...u))})]),_:1})):(s(),n("div",ia))])]),(s(!0),n(O,null,K(g.value,u=>(s(),n("div",ra,[e("span",da,x(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[5]||(p[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),u.tags?(s(),n("span",ua,x(u.tags)+" "+x(b.$t("dropdown.history.tags")),1)):f("",!0),u.values?(s(),n("span",pa,x(u.values)+" "+x(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),d(t).history.undo.length>ie?(s(),n("div",ca," + "+x(d(t).history.undo.length-ie),1)):f("",!0)])]),_:1})):f("",!0)}}),ga=U(ma,[["__scopeId","data-v-85cd80d0"]]),va=G({__name:"ToggleReload",props:{tab:{}},emits:[],setup(k,{emit:r}){const t=k,o=z(()=>t.tab.collection.state.autoReload?2:t.tab.collection.runState.isDirty?0:1);function a(){o.value==0?t.tab.collection.update():o.value==1?t.tab.collection.setAutoReload(!0):t.tab.collection.setAutoReload(!1)}return(g,m)=>(s(),n("div",{class:"bb font",onClick:a,style:{width:"26px",height:"30px",overflow:"hidde"}},[o.value==0?(s(),I(T,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:_(()=>m[0]||(m[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),o.value==1?(s(),I(T,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:_(()=>m[1]||(m[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),o.value==2?(s(),I(T,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:_(()=>m[2]||(m[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}}),fa=U(va,[["__scopeId","data-v-91d89d17"]]),ya={class:"d-flex flex-row p-2"},ba=["placeholder"],ha={class:"me-5 d-flex"},_a={class:"ms-5",style:{"font-size":"13px"}},ka=["checked"],$a={class:"ms-1"},xa={class:"ms-4"},wa={class:"d-flex flex-wrap content-container ps-2"},Sa=G({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(k,{emit:r}){lt();const t=k,o=V(""),a=V(),g=z(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=z(()=>g.value.length);function b(c){const i=c.target.checked;t.tab.collection.groupManager.setSha1Mode(i,!0)}function p(){o.value=t.tab.state.filterState.query}function u(){t.tab.collection.filterManager.setQuery(o.value),t.tab.collection.filterManager.update(!0)}function l(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return J(p),Q(()=>t.tab.collection.filterManager.state.query,p),A.ctrlF.on(()=>a.value.focus()),(c,i)=>(s(),n(O,null,[e("div",ya,[y(T,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:_(()=>[e("div",{class:j(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[i[7]||(i[7]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ye(e("input",{type:"text",class:"input-hidden",placeholder:c.$t("main.menu.search"),"onUpdate:modelValue":i[0]||(i[0]=v=>o.value=v),onChange:u,ref_key:"textInput",ref:a},null,40,ba),[[be,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:l},"x")],2)]),_:1}),e("div",ha,[y(T,{message:"main.menu.grid_tooltip"},{default:_(()=>[e("i",{class:j("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:i[1]||(i[1]=v=>t.tab.setViewMode("tree"))},null,2)]),_:1}),y(T,{message:"main.menu.table_tooltip"},{default:_(()=>[e("i",{id:"toot",class:j("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:i[2]||(i[2]=v=>t.tab.setViewMode("grid"))},null,2)]),_:1}),y(T,{message:"main.menu.graph_tooltip"},{default:_(()=>[e("i",{id:"toot",class:j("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:i[3]||(i[3]=v=>t.tab.setViewMode("graph"))},null,2)]),_:1})]),y(T,{message:"main.menu.image_size_tooltip",click:!1},{default:_(()=>i[8]||(i[8]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[y(it,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":i[4]||(i[4]=v=>t.tab.state.imageSize=v)},null,8,["modelValue"])]),e("div",_a,[y(T,{message:"main.menu.image_mode_tooltip"},{default:_(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:b},null,40,ka),e("span",$a,x(c.$t("main.menu.image_mode")),1)]),_:1})]),e("div",xa,[y(ga)]),m.value?(s(),I(rt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":g.value,"onRemove:selected":i[5]||(i[5]=v=>t.tab.collection.groupManager.clearSelection()),onStamped:i[6]||(i[6]=v=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),i[10]||(i[10]=e("div",{class:"flex-grow-1"},null,-1)),y(T,{message:"main.menu.issue",class:"bb"},{default:_(()=>i[9]||(i[9]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",wa,[y(fa,{tab:t.tab,class:"me-1"},null,8,["tab"]),y(mo,{manager:t.tab.collection.filterManager},null,8,["manager"]),y(Bo,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),y(Xo,{manager:t.tab.collection.sortManager},null,8,["manager"]),i[11]||(i[11]=e("div",null,null,-1))])],64))}}),Ca=U(Sa,[["__scopeId","data-v-bb517fea"]]),Ia={class:""},Va={class:"d-flex flex-row"},Ma=G({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(k,{emit:r}){const t=ue(),o=k,a=r,g=z(()=>`width: ${o.size}px; height: ${o.size}px;`);z(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const m=z(()=>o.pile.images[0]);return(b,p)=>(s(),n("div",Ia,[y(dt,{image:m.value},{default:_(()=>[e("div",{style:Y(g.value),class:"img-container",onClick:p[0]||(p[0]=u=>d(t).showModal(d(ee).IMAGE,{image:m.value}))},[y(ut,{image:m.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Va,[y(T,{message:"main.recommand.accept"},{default:_(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=u=>a("accept",m.value))}," ✓ ",4)]),_:1}),y(T,{message:"main.recommand.refuse"},{default:_(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=u=>a("refuse",m.value))}," ✕ ",4)]),_:1})])]))}}),Ta=U(Ma,[["__scopeId","data-v-2ff8fded"]]),za={class:"reco-container"},Fa={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Ea={key:0,class:"bi bi-funnel-fill bb text-primary"},Pa={key:1,class:"bi bi-funnel bb"},Oa={class:"text-secondary me-2"},Ga={style:{"padding-top":"2px"},class:"me-1"},La={class:"flex-grow-1"},Da={class:"d-flex flex-row"},Ra={key:0,class:"separator"},Aa={class:"d-flex flex-row"},xe=10,Ua=G({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(k,{emit:r}){const t=H(),o=pt(),a=k,g=r,m=V(1),b=ve([]),p=V(null),u=ve([]),l=ve(new Set),c=V(!0),i=[],v=[];async function C(D){const S=[],$=[];u.forEach(R=>{if(R.value!=null){const P=t.properties[R.propertyId];let W=R.value;P.type==N.multi_tags?(W=D.properties[R.propertyId]??[],W=[...W,R.value]):P.type==N.tag&&(W=[W]),P.mode==Se.id?$.push({instanceId:D.id,propertyId:P.id,value:W}):S.push({propertyId:P.id,sha1:D.sha1,value:W})}}),await t.setPropertyValues($,S)}function E(D){p.value.isSha1Group?p.value.images.filter(S=>S.sha1==D.sha1).forEach(S=>l.add(S.id)):l.add(D.id),X()}function h(){b.length=0;let D=[];const S=v.map($=>t.instances[$]);if(p.value.isSha1Group){const $={},R=Array.from(new Set(S.map(P=>P.sha1)));R.forEach(P=>$[P]=[]),S.forEach(P=>$[P.sha1].push(P)),R.forEach(P=>D.push({sha1:P,images:t.sha1Index[P]}))}else S.forEach($=>D.push({sha1:$.sha1,images:[$]}));w(D,b,m.value,a.imageSize,a.width)}function w(D,S,$,R,P){let W=P,q=[],ae=0;for(let he=0;he<D.length&&!(S.length>=$);he++){let pe=D[he];if(pe.images=pe.images.filter(Ne=>!l.has(Ne.id)),pe.images.length==0)continue;let _e=R+xe;if(ae+_e<W){q.push(pe),ae+=_e;continue}if(q.length==0)throw new Error("Images seems to be to big for the line");S.push(q),S.length<$&&(q=[pe],ae=_e)}q.length>0&&S.length<$&&S.push(q)}async function M(){if(!a.group||!o.hasSimilaryFunction)return;const D=o.defaultActions.similar,S=o.getContext(D);S.instanceIds=a.group.images.map(q=>q.id);const $=await o.getSimilarImages(S);if(!$)return;if(!$.groups)throw new Error("No instances in ActionResult");let P=gt($.groups)[0];if(c.value){const q=new Set(a.tab.collection.filterManager.result.images.map(ae=>ae.id));P.images=P.images.filter(ae=>q.has(ae.id))}P.scores&&vt(P),p.value=P,u.length=0;let W=a.group;for(;W;)u.push(...W.meta.propertyValues),W=W.parent;l.clear(),i.length=0,P.images.forEach(q=>i.push(q.id)),X(),g("update")}function F(){c.value=!c.value}function L(){a.tab.collection.groupManager.onResultChange.addListener(X)}function B(){a.tab.collection.groupManager.onResultChange.removeListener(X)}function X(){const D=a.tab.collection.groupManager.result.index[a.group.id];if(!D){g("close");return}v.length=0;const S=new Set(D.images.map($=>$.id));i.forEach($=>{S.has($)||l.has($)||v.push($)}),h()}return J(L),Me(B),J(M),Q(()=>a.group,()=>{M(),l.clear()}),Q(()=>a.imageSize,h),Q(()=>a.width,h),Q(c,M),(D,S)=>(s(),n("div",za,[e("div",Fa,[y(T,{message:"main.recommand.close"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[0]||(S[0]=$=>g("close"))},S[2]||(S[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),S[5]||(S[5]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.scroll"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[1]||(S[1]=$=>g("scroll",a.group.id))},S[3]||(S[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),S[6]||(S[6]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.filter"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:F},[c.value?(s(),n("span",Ea)):(s(),n("span",Pa))])]),_:1}),S[7]||(S[7]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{message:"main.recommand.reload"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:M},S[4]||(S[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),S[8]||(S[8]=e("div",{class:"b-left pe-1"},null,-1)),y(T,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:_(()=>[e("span",Oa,x(D.$t("main.recommand.title")),1)]),_:1}),e("div",Ga,[y(ct,{action:"similar",onChanged:M})]),e("div",La,[e("div",Da,[(s(!0),n(O,null,K(u,($,R)=>(s(),n(O,null,[y(mt,{class:"",value:$},null,8,["value"]),R<u.length-1?(s(),n("div",Ra)):f("",!0)],64))),256))])])]),e("div",{style:Y("margin-left:"+xe+"px;")},[(s(!0),n(O,null,K(b,$=>(s(),n("div",null,[e("div",Aa,[(s(!0),n(O,null,K($,R=>(s(),I(Ta,{pile:R,size:a.imageSize,onAccept:C,onRefuse:E,style:Y("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),Ba=U(Ua,[["__scopeId","data-v-fe023b30"]]),ja={style:{display:"flex"}},Na={class:"info"},Ha={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:N},height:String},setup(k){const r=k,t=V(0),o=V(!1),a={};Object.keys(r.chartData.series).forEach(c=>{a[c]=!1});const g=V({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:r.chartData.dataType===N.date?"datetime":"numeric",categories:r.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:c,seriesIndex:i,dataPointIndex:v,w:C}){const E=r.chartData.series[i].data[v];let h='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';E.images.forEach((M,F)=>{F<10&&(h+=`<div style="width: 75px; height: 75px;"><img src="${M}" style="width: 100%; height: 100%;" /></div>`)}),h+="</div>";let w=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${r.chartData.series[i].name} — </b> ${E.y} Images</span>`;return w+=`<div>${h}</div>`,w}}}),m=()=>{g.value.chart.stacked=!g.value.chart.stacked,o.value=!o.value,t.value+=1},b=()=>{let c;g.value.chart.type==="area"?c={chart:{...g.value.chart,type:"bar"}}:c={chart:{...g.value.chart,type:"area"}},g.value={...g.value,...c},t.value+=1},p=(c,i,v)=>{const E=r.chartData.series[i];let h=Math.max(...E.data.map(w=>w.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(w=>w.remove()),a[i]){a[i]=!1;return}E.data.forEach((w,M)=>{const L=Math.floor(w.y/h*17),B=w.images.slice(0,L),X=`circle[index="${i}"][j="${M}"]`,D=document.querySelector(X),S=parseFloat(D.getAttribute("cx"));B.forEach(($,R)=>{const P=document.createElement("img");P.src=$,P.width=40,P.height=40,P.style.position="absolute";let W=S+40/1.5,q=65+R*40;P.style.left=`${W}px`,P.style.bottom=`${q}px`,P.classList.add("apexcharts-custom-image"),P.addEventListener("mouseover",ae=>u(W,q,$)),P.addEventListener("mouseout",l),c.el.appendChild(P)})}),Object.keys(a).forEach(w=>a[w]=!1),a[i]=!0};function u(c,i,v){const C=document.getElementById("zoomed-image");C.style.left=`${c+120*1.5}px`,C.src=v,C.style.bottom=`${i}px`,C.style.display="block"}function l(){const c=document.getElementById("zoomed-image");c.style.display="none"}return(c,i)=>{const v=Ee("apexchart");return s(),n(O,null,[e("div",ja,[e("button",{class:"mt-2",onClick:b},x(g.value.chart.type==="area"?c.$t("main.graph-view.histo"):c.$t("main.graph-view.curve")),1),r.chartData.series.length>1?(s(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:m},x(o.value?c.$t("main.graph-view.over"):c.$t("main.graph-view.stack")),1)):f("",!0)]),(s(),I(v,{style:{position:"relative"},key:t.value,height:r.height,type:g.value.chart.type,options:g.value,series:r.chartData.series,onLegendClick:p},null,8,["height","type","options","series"])),e("i",Na,x(c.$t("main.graph-view.info")),1),i[0]||(i[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Wa={key:1},qa=G({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(k,{emit:r}){const t=H(),o=k,a=V(""),g=V(b());function m(){const p=new Set;let u=o.collection.groupManager.getGroupIterator();for(;u;){const l=u.group;if(l.id===0||l.meta.propertyValues&&l.meta.propertyValues[0].value==null){u=u.nextGroup();continue}for(let c of l.children)p.add(c.meta.propertyValues[0].value);l.children.forEach(()=>u=u.nextGroup()),u=u.nextGroup()}return p}function b(){const p={};let u,l=o.collection.groupManager.state.groupBy;if(l.length===0){a.value="Choose at least one date or numeric value to group the images by";return}const c=t.properties[l[0]],i=c.type;if(l.length>2){a.value="Only max two levels of grouping are supported";return}else if(l.length===1)p[c.name]={name:c.name,data:[]};else if(u=Array.from(m()),u.length>20){a.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(i!==N.number&&i!==N.date){a.value="First level of grouping needs to be a date or a numeric property";return}let v=o.collection.groupManager.getGroupIterator();const C=[];for(;v;){const E=v.group;if(E.id===0||E.meta.propertyValues&&E.meta.propertyValues[0].value==null){v=v.nextGroup();continue}let h=E.meta.propertyValues[0];const w=i===N.date?new Date(h.value).getTime():h.value;if(C.push(w),c.name in p)p[c.name].data.push({x:w,y:E.images.length,images:E.images.slice(0,20).map(M=>M.urlSmall)});else{const M=E.children.map(L=>L.meta.propertyValues[0].value),F=u.filter(L=>!M.includes(L));for(let L of E.children){const B=L.meta.propertyValues[0].value;if(p[B]===void 0){let X=B;B in t.tags&&(X=t.tags[B].value),p[B]={data:[],name:X}}p[L.meta.propertyValues[0].value].data.push({x:w,y:L.images.length,images:L.images.slice(0,20).map(X=>X.urlSmall)})}for(let L of F){if(p[L]===void 0){let B=L;L in t.tags&&(B=t.tags[L].value),p[L]={data:[],name:B}}p[L].data.push({x:w,y:0,images:[]})}E.children.forEach(()=>v=v.nextGroup())}v=v.nextGroup()}return a.value="",{series:Object.values(p),xValues:C,dataType:i}}return o.collection.groupManager.onResultChange.addListener(()=>g.value=b()),(p,u)=>(s(),n("div",{class:"",style:Y({height:o.height+"px"})},[a.value===""?(s(),I(Ha,{key:0,chartData:g.value,height:o.height-50+"px"},null,8,["chartData","height"])):(s(),n("span",Wa,x(a.value),1))],4))}}),Qa={key:0,class:"m-0 p-0"},Ka={key:0,style:{"margin-left":"10px"}},Ya=G({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(k,{expose:r}){de();const t=H(),o=k;r({updateScrollerWidth:h});const a=V({}),g=V(!0),m=V(null),b=V(null),p=V(null),u=V(0),l=V(0),c=ve({groups:!1}),i=z(()=>o.tab.getVisibleProperties());function v(){m.value&&b.value?u.value=o.height-m.value.clientHeight-b.value.clientHeight-5:m.value?u.value=o.height-m.value.clientHeight-5:u.value=0}function C(w){a.value=o.tab.collection.groupManager.result.index[w],Z(()=>v())}function E(){a.value={},Z(()=>v())}async function h(){await Z(),l.value=m.value?.clientWidth??l.value}return J(()=>{l.value=m.value.clientWidth,window.addEventListener("resize",h)}),Me(()=>{window.removeEventListener("resize",h)}),Q(()=>o.tab.state.imageSize,()=>Z(v)),Q(()=>o.filterOpen,()=>Z(v)),Q(()=>o.height,async()=>{await Z(v)}),J(v),(w,M)=>(s(),n(O,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:m},[o.filterOpen?(s(),I(Ca,{key:0,tab:o.tab,"compute-status":c},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:b,class:"m-0 p-0"},[a.value.id?(s(),n("div",Qa,[y(Ba,{tab:o.tab,group:a.value,"image-size":o.tab.state.imageSize,width:l.value,height:50,onClose:E,onScroll:p.value.scrollTo,onUpdate:M[0]||(M[0]=F=>Z(()=>v()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),d(t).isLoaded&&l.value>0&&u.value>0&&g.value?(s(),n("div",Ka,[o.tab.state.display=="tree"?(s(),I(ft,{key:0,"input-key":"main-view-tree","group-manager":o.tab.collection.groupManager,"image-size":o.tab.state.imageSize,height:u.value-0,properties:i.value,"hide-if-modal":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:p,width:l.value-25,onRecommend:C},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),o.tab.state.display=="grid"?(s(),n("div",{key:1,style:Y({width:l.value-12+"px"}),class:"p-0 m-0 grid-container"},[y(yt,{tab:w.tab,manager:o.tab.collection.groupManager,height:u.value-15,width:l.value-40,"selected-properties":i.value,class:"p-0 m-0","show-images":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:p,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),o.tab.state.display=="graph"?(s(),I(qa,{key:2,collection:o.tab.collection,height:u.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}}),Xa=U(Ya,[["__scopeId","data-v-872542dd"]]),Za=G({__name:"TabButton",props:{tab:{}},setup(k){const r=me(),t=V(""),o=V(null),a=V(!1),g=V(!1),m=k,b=z(()=>m.tab.state.id);function p(){r.selectMainTab(m.tab.state.id)}function u(){g.value=!0,t.value=m.tab.state.name,Z(()=>o.value.focus())}function l(){m.tab.renameTab(t.value),g.value=!1}async function c(){confirm("Are you sure to delete Tab: "+m.tab.state.name)&&r.deleteTab(m.tab.state.id)}return J(()=>{m.tab.isNew&&u()}),(i,v)=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:v[1]||(v[1]=C=>a.value=!0),onMouseleave:v[2]||(v[2]=C=>a.value=!1)},[g.value?(s(),n("div",{key:1,class:j(["tab-button",b.value==d(r).mainTab?" active":""])},[e("form",{onSubmit:ce(l,["stop","prevent"])},[ye(e("input",{onFocusout:l,onKeydown:bt(l,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":v[0]||(v[0]=C=>t.value=C),ref_key:"inputElem",ref:o},null,544),[[be,t.value]])],32)],2)):(s(),n(O,{key:0},[y(T,{message:"main.menu.rename_tab_tooltip"},{default:_(()=>[e("i",{onClick:u,class:j(["bi bi-pencil me-1 tab-icon hover-light",a.value&&d(r).mainTab==b.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:j(["tab-button",b.value==d(r).mainTab?" active":""]),onClick:p},[e("span",null,x(m.tab.state.name),1)],2),y(T,{message:"main.menu.delete_tab_tooltip"},{default:_(()=>[e("i",{onClick:c,class:j(["btn-icon bi bi-x tab-icon hover-light",a.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Ja={class:"d-flex d-row",style:{cursor:"pointer"}},en={class:"pt-1"},tn={key:0,class:"bb bi bi-chevron-down"},sn={key:1,class:"bb bi bi-chevron-right"},on={style:{"padding-top":"2px","margin-right":"2px"}},an={class:"lang"},nn=["value"],ln=["value"],rn=G({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(k,{emit:r}){const{locale:t}=Oe(),o=ue(),a=me(),g=k,m=r;async function b(c){await a.addTab("New Tab")}const p=["fr","en"];function u(){m("update:filterOpen",!g.filterOpen)}function l(c){g.reRender();const i=c.target.value;t.value=i,de().setLang(i)}return(c,i)=>(s(),n("nav",null,[e("div",Ja,[e("div",en,[e("span",{onClick:u},[g.filterOpen?(s(),n("i",tn)):(s(),n("i",sn))])]),(s(!0),n(O,null,K(d(a).loadedTabs,v=>(s(),n("div",null,[y(Za,{tab:d(a).getTab(v)},null,8,["tab"])]))),256)),y(T,{message:"main.menu.add_tab_tooltip"},{default:_(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:b,id:"add-tab-button"},i[2]||(i[2]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),i[5]||(i[5]=e("div",{class:"flex-grow-1"},null,-1)),d(o).clientState.user?(s(),n("div",{key:0,style:{margin:"2px"},class:"bb me-3 text-secondary",onClick:i[0]||(i[0]=v=>d(ht)().disconnectUser())},x(d(o).clientState.user.name),1)):f("",!0),e("div",on,[y(T,{message:"modals.notif.icon"},{default:_(()=>[e("span",{class:"bb",onClick:i[1]||(i[1]=v=>d(o).showModal(d(ee).NOTIF))},i[3]||(i[3]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",an,[i[4]||(i[4]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:c.$i18n.locale,onChange:l},[(s(),n(O,null,K(p,(v,C)=>e("option",{key:`Lang${C}`,value:v},x(v.toUpperCase()),9,ln)),64))],40,nn)])])]))}}),dn={key:0},un={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},re=G({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(k){const r=k;return(t,o)=>r.loading?(s(),n("div",dn,[t.loading?(s(),n("div",un,o[0]||(o[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),we=G({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(k){const r=k,t=z(()=>r.force?"100%":r.max==0?"0%":r.current>=r.max?"100%":Math.floor(r.current/r.max*100)+"%");return(o,a)=>(s(),n("span",null,x(t.value),1))}}),pn={key:0,class:"center"},cn={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},mn={class:"d-flex text-secondary"},gn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},vn={class:"d-flex text-secondary",style:{"font-size":"14px"}},fn={key:0,class:"bi bi-check text-success"},yn={class:"d-flex text-secondary",style:{"font-size":"14px"}},bn={key:0,class:"bi bi-check text-success"},hn={class:"d-flex text-secondary",style:{"font-size":"14px"}},_n={key:0,class:"bi bi-check text-success"},kn={class:"d-flex text-secondary",style:{"font-size":"14px"}},$n={key:0,class:"bi bi-check text-success"},xn={class:"d-flex text-secondary",style:{"font-size":"14px"}},wn={key:0,class:"bi bi-check text-success"},Sn=G({__name:"DataLoad",setup(k){const r=H();return(t,o)=>d(r).loadState?(s(),n("div",pn,[e("div",cn,[e("div",null,[e("div",mn,[o[0]||(o[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedProperty},null,8,["loading"]),d(r).loadState.finishedProperty?(s(),n("i",gn)):f("",!0)]),e("div",vn,[o[1]||(o[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedPropertyGroups},null,8,["loading"]),d(r).loadState.finishedPropertyGroups?(s(),n("i",fn)):f("",!0)]),e("div",yn,[o[2]||(o[2]=e("div",{class:"me-1"},"Tags",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedTags},null,8,["loading"]),d(r).loadState.finishedTags?(s(),n("i",bn)):f("",!0)]),e("div",hn,[o[3]||(o[3]=e("div",{class:"me-1"},"Instances",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedInstance},null,8,["loading"]),d(r).loadState.finishedInstance?(s(),n("i",_n)):f("",!0),y(we,{current:d(r).loadState.counterInstance,max:d(r).loadState.maxInstance,force:d(r).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",kn,[o[4]||(o[4]=e("div",{class:"me-1"},"InstanceValues",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedInstanceValues},null,8,["loading"]),d(r).loadState.finishedInstanceValues?(s(),n("i",$n)):f("",!0),y(we,{current:d(r).loadState.counterInstanceValue,max:d(r).loadState.maxInstanceValue,force:d(r).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",xn,[o[5]||(o[5]=e("div",{class:"me-1"},"ImageValues",-1)),y(re,{class:"me-2",loading:!d(r).loadState.finishedImageValues},null,8,["loading"]),d(r).loadState.finishedImageValues?(s(),n("i",wn)):f("",!0),y(we,{current:d(r).loadState.counterImageValue,max:d(r).loadState.maxImageValue,force:d(r).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}}),Cn=U(Sn,[["__scopeId","data-v-0db6d675"]]),In={key:0},Vn={id:"panoptic"},Mn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Tn={class:"w-100"},zn={key:0,class:"custom-hr"},Fn={key:2,class:"loading"},En={class:"text-center"},Pn={key:3,class:"loading"},On=G({__name:"ProjectView",setup(k){const r=de(),t=H(),o=ue(),a=me(),g=V(null),m=V(null),b=V(window.innerHeight),p=V(!1),u=V(!0),l=V(!0),c=z(()=>b.value-(m.value?.clientHeight??0)),i=z(()=>g.value?.filteredImages.map(F=>F.id));let v=navigator.userAgent.indexOf("Mac OS X")!==-1;async function C(){u.value=!1,await Z(),u.value=!0}J(async()=>{if(!o.isProjectLoaded){Fe.push("/");return}r.init(),Z(()=>{window.addEventListener("resize",E),E()}),window.addEventListener("keydown",F=>{F.key=="Control"&&(A.ctrl=!0),F.key=="Alt"&&(v&&(A.ctrl=!0),A.alt=!0),F.key=="Shift"&&(A.shift=!0),F.key=="ArrowLeft"&&(A.left=!0),F.key=="ArrowRight"&&(A.right=!0),F.key=="Z"&&A.ctrl&&t.redo(),F.key=="z"&&A.ctrl&&t.undo(),F.key=="f"&&A.ctrl&&A.ctrlF.emit()}),window.addEventListener("keyup",F=>{F.key=="Control"&&(A.ctrl=!1),F.key=="Alt"&&(v&&(A.ctrl=!1),A.alt=!1),F.key=="Shift"&&(A.shift=!1),F.key=="ArrowLeft"&&(A.left=!1),F.key=="ArrowRight"&&(A.right=!1)}),window.addEventListener("mousemove",F=>{A.ctrl=F.ctrlKey,A.alt=F.altKey,A.shift=F.shiftKey,v&&(A.ctrl=A.ctrl||A.alt)})}),Me(()=>{window.removeEventListener("resize",E),de().clear()});function E(){b.value=window.innerHeight,p.value=!0}function h(){o.showModal(ee.EXPORT,i)}function w(){Fe.push("/")}function M(){g.value&&g.value.updateScrollerWidth()}return(F,L)=>u.value?(s(),n("div",In,[g.value&&!g.value.imageList?(s(),I(_t,{key:0,tutorial:"project"})):f("",!0),e("div",Vn,[e("div",Mn,[d(t).isLoaded?d(t).isLoaded?(s(),n(O,{key:1},[e("div",null,[y(Ms,{onExport:L[0]||(L[0]=B=>h()),onToggle:M})]),e("div",Tn,[e("div",{class:"ms-1",ref_key:"navElem",ref:m},[y(rn,{"re-render":C,filterOpen:l.value,"onUpdate:filterOpen":L[1]||(L[1]=B=>l.value=B)},null,8,["filterOpen"])],512),p.value?(s(),n("div",zn)):f("",!0),y(Ae,{id:d(a).mainTab},{default:_(({tab:B})=>[y(Xa,{tab:B,height:c.value,ref_key:"mainViewRef",ref:g,"filter-open":l.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):d(o).isProjectLoaded?(s(),n("div",Pn,L[2]||(L[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(s(),n("div",Fn,[e("div",En,[e("div",null,x(F.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:w,style:{"font-size":"50px",cursor:"pointer"}})])])):(s(),n("div",{key:0,class:"d-flex flex-column w-100",style:Y({height:b.value+"px"})},[y(Cn,{class:"flex-grow-1"})],4))])])])):f("",!0)}}),Dn=U(On,[["__scopeId","data-v-7d0d9665"]]);export{Dn as default};
