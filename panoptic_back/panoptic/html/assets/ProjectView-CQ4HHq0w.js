import{d as G,B as q,k as V,D as te,l as h,b as e,i as Z,t as k,V as We,o,W as Ie,r as M,c as z,a as l,f as Q,n as B,F as P,s as K,h as y,X as le,q as b,e as c,Y as Oe,Z as ke,$ as Te,_ as N,a0 as me,m as J,a1 as H,a2 as Pe,j as ee,a3 as Ge,u as pe,a4 as de,a5 as ve,w as ye,v as be,a6 as Le,M as se,y as F,Q as j,a7 as Se,a8 as Ve,a9 as Ke,aa as ie,ab as De,I as Qe,g as Ce,ac as Fe,ad as Ye,ae as Xe,L as Ze,af as Je,ag as et,O as tt,R as st,S as ot,ah as at,ai as nt,aj as Re,ak as Ae,al as lt,am as ne,an as oe,ao as it,ap as Me,aq as rt,C as R,ar as Ue,as as ut,at as dt,au as pt,av as ct,aw as mt,ax as ge,ay as ze,az as vt,aA as gt,aB as ft,aC as yt,aD as bt,aE as ht,aF as _t,p as Ee}from"./index-BWiVc6Et.js";import{_ as kt}from"./Tutorial.vue_vue_type_style_index_0_lang-DCqmVJOM.js";const $t={class:"text-nowrap"},xt=["onClick"],wt=["onClick"],St=G({__name:"FolderOptionDropdown",props:{folder:{}},setup(_){const u=q(),t=_;function s(){u.reImportFolder(t.folder.id)}function a(){confirm(We.global.t("main.nav.folders.del_alert"))&&u.deleteFolder(t.folder.id)}return(m,p)=>(o(),V(te,{teleport:!0},{button:h(()=>p[0]||(p[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:h(({hide:g})=>[e("div",$t,[e("div",{class:"p-2 bb",onClick:d=>{s(),g()}},p[1]||(p[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),Z("Re import")]),8,xt),p[3]||(p[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:d=>{a(),g()}},[p[2]||(p[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),Z(k(m.$t("main.nav.folders.del")),1)],8,wt)])]),_:1}))}}),Ct=["onMouseenter"],It=["onClick"],Vt={class:"text-secondary"},Mt=["onClick"],zt=G({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0},tab:Object},setup(_){const u=q(),t=_,s=M(null),a=z(()=>{let n={};const r=new Set(t.filterManager.state.folders);return t.folders.map(v=>v.id).forEach(v=>{r.has(v)&&(n[v]=!0)}),n}),m=z(()=>{let n={};return t.folders.map(r=>r.id).forEach(r=>{t.visibleFolders[r]&&(n[r]=!0)}),n}),p=z(()=>{let n={};return t.folders.forEach(r=>{let v=[];a.value[r.id]&&v.push("selected"),n[r.id]=v.join(" ")}),n});function g(n){let r=t.visibleFolders;r[n]?delete r[n]:r[n]=!0}function d(n){let r=new Set(t.filterManager.state.folders);const v=r.has(n),f=u.folders[n].parent!=null&&r.has(u.folders[n].parent);v&&!f?(r.delete(n),ke(n).forEach(S=>r.delete(S.id))):(i(n,r),r.add(n),ke(n).forEach(S=>r.add(S.id)),Te(u.folders[n]).forEach(S=>r.delete(S.id))),t.filterManager.setFolders(Array.from(r)),t.tab.setSelectedFolder(r),t.filterManager.update(!0)}function i(n,r){const v=Te(u.folders[n]);let f;for(let S of v)if(r.has(S.id))f=S;else break;f!=null&&ke(f.id).forEach(S=>r.delete(S.id))}return(n,r)=>{const v=Oe("FolderList2",!0);return o(),l("ul",{class:B(t.root?"tree":""),style:Q(t.root?"padding-left:0px;":"")},[(o(!0),l(P,null,K(_.folders,f=>(o(),l("li",{style:Q(t.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:S=>s.value=f.id,onMouseleave:r[1]||(r[1]=S=>s.value=null)},[e("summary",{class:B(p.value[f.id]),onClick:S=>d(f.id)},[e("span",{class:B(s.value===f.id?"visible-option":"invisible-option"),onClick:r[0]||(r[0]=le(()=>{},["stop"]))},[b(St,{folder:f},null,8,["folder"])],2),Z(" "+k(f.name)+" ",1),e("span",Vt,k(c(u).folders[f.id].count),1)],10,It)],40,Ct),f.children&&f.children.length>0?(o(),l("i",{key:0,onClick:S=>g(f.id),class:B("bi bi-chevron-"+(m.value[f.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Mt)):y("",!0),f.children&&f.children.length>0&&m.value[f.id]?(o(),V(v,{key:1,folders:f.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager,tab:t.tab},null,8,["folders","visible-folders","filter-manager","tab"])):y("",!0)],4))),256))],6)}}}),Tt=N(zt,[["__scopeId","data-v-4f6f42f4"]]),Ft={class:"text-center"},Et={class:"w-100 text-center",style:{"font-size":"10px"}},Ot={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Pt=G({__name:"TaskStatus",props:{task:{}},setup(_){const u=_,t=z(()=>u.task.total-u.task.remain-u.task.computing),s=z(()=>u.task.total);return(a,m)=>(o(),l("div",Ft,[Z(k(u.task.name)+" ",1),e("div",Et,k(t.value)+" / "+k(s.value)+" "+k(a.$t("main.nav.tasks.done")),1),s.value>0?(o(),l("div",Ot,[e("div",{class:"progress-bar",style:Q(`width: ${t.value/s.value*100}%`)},null,4)])):y("",!0)]))}}),Be=G({__name:"TabContainer",props:{id:{}},setup(_){const u=me(),t=_;let s;const a=M(!1);function m(){s=u.getTab(t.id),a.value=!0}return J(m),H(()=>t.id,async()=>{a.value=!1,await ee(),m()}),(p,g)=>a.value&&c(u).loaded?Pe(p.$slots,"default",{key:0,tab:c(s)}):y("",!0)}}),fe={},Gt={class:"d-flex flex-row"},Lt={key:2,class:"d-flex",style:{width:"150px"}},Dt={class:"flex-grow-1"},Rt={key:1,style:{"padding-top":"1px"}},At={class:"text-center",style:{width:"24px","margin-top":"2px"}},Ut={style:{width:"20px","margin-top":"2px","flex-shrink":"0"},class:"text-center"},Bt={key:0},Nt={key:0,class:"ms-3 pt-1"},jt={key:1},Ht=G({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(_){const{t:u}=Ge({useScope:"global"}),t=pe();de();const s=q(),a=_,m=M(!1),p=M(!1),g=M(""),d=M(!1),i=z(()=>a.tab.state.visibleProperties[a.property.id]==!0),n=z(()=>a.tab.collection.filterManager.state.filter.filters.some(I=>!I.isGroup&&I.propertyId==a.property.id)),r=z(()=>a.tab.collection.groupManager.state.groupBy.includes(a.property.id)),v=z(()=>a.tab.collection.sortManager.state.sortBy.includes(a.property.id)),f=z(()=>{if(n.value)return a.tab.collection.filterManager.state.filter.filters.find(I=>!I.isGroup&&I.propertyId==a.property.id).id}),S=()=>a.tab.collection.filterManager,O=z(()=>a.tab.getSha1Mode());function x(){i.value?a.tab.setVisibleProperty(a.property.id,!1):a.tab.setVisibleProperty(a.property.id,!0)}function E(){a.open&&(m.value?m.value=!1:(m.value=!0,g.value=a.property.name),p.value=!1)}function C(){a.property.type!=j.tag&&a.property.type!=j.multi_tags||(p.value?p.value=!1:p.value=!0,m.value=!1)}function $(){v.value?a.tab.collection.sortManager.delSort(a.property.id):a.tab.collection.sortManager.setSort(a.property.id),a.tab.collection.sortManager.update(!0)}function T(){r.value?a.tab.collection.groupManager.delGroupOption(a.property.id):a.tab.collection.groupManager.setGroupOption(a.property.id),a.tab.collection.groupManager.update(!0)}function D(){confirm(u("common.properties.delete")+": "+a.property.name+" ?   "+a.property.id)&&s.deleteProperty(a.property.id)}async function X(){g.value!=""&&(await s.updateProperty(a.property.id,g.value),E())}function A(){const I=S();n.value?(I.deleteFilter(f.value),fe.filter.hide()):(I.addNewFilter(a.property.id),fe.filter.show())}return H(()=>a.property,()=>{m.value=!1}),(I,w)=>(o(),l("div",{class:B(d.value?"hover-light":"")},[e("div",Gt,[a.open?(o(),l(P,{key:0},[m.value?y("",!0):(o(),l("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:E},[b(ve,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:w[0]||(w[0]=U=>d.value=!0),onMouseleave:w[1]||(w[1]=U=>d.value=!1)},null,8,["type"]),e("span",null,k(a.property.name),1)]))],64)):(o(),V(ve,{key:1,type:a.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),m.value&&a.open?(o(),l("div",Lt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:E,onMouseenter:w[2]||(w[2]=U=>d.value=!0),onMouseleave:w[3]||(w[3]=U=>d.value=!1)},null,32)]),e("div",Dt,[a.property.id>=0?ye((o(),l("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":w[4]||(w[4]=U=>g.value=U),onChange:X},null,544)),[[be,g.value]]):(o(),l("span",Rt,[b(ve,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,k(a.property.name),1)]))])])):y("",!0),a.open?(o(),l(P,{key:3},[c(Le)(a.property.type)?(o(),l("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:w[5]||(w[5]=U=>c(t).showModal(c(se).TAG,{propId:a.property.id}))},[b(F,{click:!1,message:"main.nav.properties.open_tags"},{default:h(()=>w[7]||(w[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):y("",!0)],64)):y("",!0),a.open?(o(),l(P,{key:4},[e("div",At,[a.property.type==c(j).tag||a.property.type==c(j).multi_tags?(o(),l("div",{key:0,onClick:C,style:{cursor:"pointer"}},[p.value?(o(),V(F,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:h(()=>w[8]||(w[8]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(o(),V(F,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:h(()=>w[9]||(w[9]=[e("i",{class:"bi bi-chevron-right ms-1"},null,-1)])),_:1}))])):y("",!0)]),e("div",Ut,[a.property.mode==c(Se).id?(o(),V(F,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:h(()=>w[10]||(w[10]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):y("",!0)])],64)):y("",!0),e("div",{style:{width:"20px","margin-top":"2px","flex-shrink":"0"},onClick:x,class:"btn-icon text-center"},[O.value&&a.property.mode==c(Se).id?(o(),V(F,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:h(()=>[e("span",{class:"bi bi-eye-slash",onClick:w[6]||(w[6]=le(()=>{},["stop"]))})]),_:1})):(o(),V(F,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:h(()=>[e("span",{class:B("bi bi-eye text-"+(i.value?"primary":"secondary"))},null,2)]),_:1}))])]),a.open?(o(),l("div",Bt,[m.value?(o(),l("div",Nt,[I.property.id!=c(Ve).folders?(o(),l("div",{key:0,class:B(["options hover-light",n.value?" text-primary":""]),onClick:A},[e("div",null,[w[11]||(w[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Z(k(I.$t("main.menu.filters")),1)])],2)):y("",!0),e("div",{class:B(["options hover-light",v.value?" text-primary":""]),onClick:$},[w[12]||(w[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),Z(k(I.$t("main.menu.sort.title")),1)],2),e("div",{class:B(["options hover-light",r.value?" text-primary":""]),onClick:T},[w[13]||(w[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),Z(k(I.$t("main.menu.groupby")),1)],2),a.property.id>=0?(o(),l("div",{key:1,class:"options hover-light",onClick:D},[w[14]||(w[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),Z(k(I.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):p.value?(o(),l("div",jt,[b(Ke,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])):y("",!0)],2))}}),qt=N(Ht,[["__scopeId","data-v-7f4c496c"]]),Wt={key:0,class:"prop-container"},Kt={key:0},Qt={key:1},Yt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Xt={key:1,class:"ms-2"},Zt={class:"p-1"},Jt=["onClick"],es=["onClick"],ts={key:0,class:"ps-1 pe-1"},ss={class:"property-item"},os=G({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(_){const u=q(),t=pe(),s=_,a=M(!0),m=M(!1),p=M(""),g=z(()=>s.node.propertyIds.map(C=>u.properties[C])),d=z(()=>s.node.propertyIds.map(C=>s.tab.isVisibleProperty(C)).filter(C=>!C).length==0),i=z(()=>{if(s.node.groupId>=0)return u.propertyGroups[s.node.groupId];if(s.node.groupId==ie.DEFAULT)return{id:ie.DEFAULT,name:"default"};if(s.node.groupId==ie.COMPUTED)return{id:ie.COMPUTED,name:"computed"}}),n=z(()=>i.value.id>=0);function r(){a.value=!a.value}function v(C){u.updatePropertyGroup(i.value.id,p.value)}function f(){p.value=i.value.name}function S(){u.deletePropertyGroup(i.value.id)}async function O(){const $={emptyProperties:u.propertyList.filter(D=>D.propertyGroupId==s.node.groupId).map(D=>D.id)};await u.sendCommit($);const T={emptyPropertyGroups:[s.node.groupId]};await u.sendCommit(T)}async function x(C){if(C.added){let $=C.added.element;const T=u.properties[$];let D=s.node.groupId;D<0&&(D=null),await u.updateProperty(T.id,T.name,D),await u.triggerPropertyTreeChange()}C.moved&&await u.triggerPropertyTreeChange()}function E(){d.value?s.tab.setVisibleProperties(s.node.propertyIds,!1):s.tab.setVisibleProperties(s.node.propertyIds,!0)}return J(f),H(s,f),(C,$)=>c(u).propertyGroups[s.node.groupId]||s.node.groupId<0?(o(),l("div",Wt,[b(c(De),{list:s.node.propertyIds,"item-key":T=>T,group:s.node.groupId>0||s.node.groupId==c(ie).DEFAULT?"properties":void 0,onChange:x},{header:h(()=>[e("div",{class:"d-flex group-container",onClick:r},[a.value?(o(),l("div",Kt,$[4]||($[4]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):y("",!0),a.value?y("",!0):(o(),l("div",Qt,$[5]||($[5]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),s.menuOpen?(o(),l(P,{key:2},[m.value?y("",!0):(o(),l("div",Yt,k(i.value.name),1)),m.value?(o(),l("div",Xt,[b(Qe,{"auto-focus":!0,modelValue:p.value,"onUpdate:modelValue":$[0]||($[0]=T=>p.value=T),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:v,onCancel:f,onBlur:$[1]||($[1]=T=>m.value=!1)},null,8,["modelValue"])])):y("",!0),$[8]||($[8]=e("div",{class:"flex-grow-1"},null,-1)),s.node.groupId>=c(ie).DEFAULT?(o(),V(te,{key:2,onClick:$[2]||($[2]=le(()=>{},["prevent","stop"]))},{button:h(()=>$[6]||($[6]=[e("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:h(({hide:T})=>[e("div",Zt,[n.value?(o(),l(P,{key:0},[e("div",{class:"bb",onClick:D=>{m.value=!0,T()}},k(C.$t("main.menu.editName")),9,Jt),e("div",{class:"bb",onClick:S},k(C.$t("main.menu.removeGroup")),1)],64)):y("",!0),e("div",{class:"bb",onClick:D=>{O(),T()}},k(C.$t("main.menu.deleteGroupAndProperties")),9,es)])]),_:1})):y("",!0),s.node.groupId>=-1?(o(),l("div",{key:3,class:"bb me-1",onClick:$[3]||($[3]=le(T=>c(t).showModal(c(se).PROPERTY,{group:s.node.groupId}),["stop","prevent"]))},[b(F,{message:C.$t("main.menu.addNewPropertyToGroup")},{default:h(()=>$[7]||($[7]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):y("",!0)],64)):y("",!0),s.node.propertyIds.length?(o(),l("div",{key:3,style:{cursor:"pointer","flex-shrink":"0","margin-right":"11px"},onClick:le(E,["stop"])},[e("span",{class:B("bi bi-eye text-"+(d.value?"primary":"secondary"))},null,2)])):y("",!0)])]),item:h(({element:T,index:D})=>[a.value&&g.value.length&&c(u).properties[T]?(o(),l("div",ts,[e("div",ss,[b(qt,{tab:s.tab,property:c(u).properties[T],open:s.menuOpen},null,8,["tab","property","open"])])])):y("",!0)]),_:1},8,["list","item-key","group"])])):y("",!0)}}),$e=N(os,[["__scopeId","data-v-56326eaf"]]),as={key:0,class:"mb-1"},ns=G({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(_,{emit:u}){const t=q(),s=_;function a(m){t.triggerPropertyTreeChange()}return(m,p)=>(o(),V(c(De),{list:c(t).propertyTree,onChange:a,"item-key":g=>g.groupId},{item:h(({element:g})=>[g.groupId>=0?(o(),l("div",as,[b($e,{tab:s.tab,node:g,"menu-open":s.menuOpen},null,8,["tab","node","menu-open"])])):y("",!0)]),footer:h(()=>[b($e,{class:"mb-1",tab:s.tab,node:c(t).propertyTree[c(t).propertyTree.length-2],"menu-open":s.menuOpen},null,8,["tab","node","menu-open"]),b($e,{class:"mb-1",tab:s.tab,node:c(t).propertyTree[c(t).propertyTree.length-1],"menu-open":s.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),ls={class:""},is={class:"m-0",style:{padding:"4px 0px 4px 8px"}},rs={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},us={class:"flex-grow-1 text-capitalize overflow-hidden"},ds={key:0,class:"bi bi-chevron-left"},ps={key:1,class:"bi bi-chevron-right"},cs={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ms={class:"d-flex align-items-center"},vs={style:{"max-height":"300px",overflow:"auto"}},gs={key:0,id:"import"},fs={class:"pt-1 pb-2"},ys={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},bs={key:0,class:"ps-2 pe-2"},hs={class:"p-1"},_s={key:0,class:"custom-hr"},ks={class:"p-1 mt-0"},$s={key:0,class:"d-flex p-1"},xs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},ws={key:1,class:"bb me-1"},Ss={class:"bb me-2"},Cs={key:1,class:"mt-2"},Is=200,Vs=55,Ms=G({__name:"Menu",emits:["export","toggle"],setup(_,{emit:u}){const t=de(),s=q(),a=pe(),m=me(),p=u,g=M(!1),d=M(!0),i=z(()=>d.value?Is:Vs),n=async()=>{a.showModal(se.IMPORT)},r=z(()=>t.state.tasks.filter(O=>!O.done)??[]);function v(){a.showModal(se.FOLDERSELECTION,{callback:f,mode:"images"})}function f(O){O&&s.addFolder(O)}function S(){d.value=!d.value,p("toggle")}return(O,x)=>(o(),V(Be,{id:c(m).mainTab},{default:h(({tab:E})=>[e("div",{class:"menu overflow-scroll",style:Q({width:i.value+"px"})},[e("div",ls,[e("div",null,[e("div",is,[e("div",rs,[d.value?(o(),l(P,{key:0},[e("div",us,k(c(t).state.name),1),b(F,{message:"main.menu.close_project"},{default:h(()=>[e("div",{class:"base-hover p-1",onClick:x[0]||(x[0]=C=>c(a).closeProject(c(t).state.id))},x[6]||(x[6]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:x[1]||(x[1]=C=>c(a).showModal(c(se).SETTINGS))},x[7]||(x[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):y("",!0),e("div",{class:B(["base-hover p-1",d.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:S},[d.value?(o(),l("i",ds)):(o(),l("i",ps))],2)])]),d.value?(o(),l(P,{key:0},[x[9]||(x[9]=e("div",{class:"custom-hr"},null,-1)),e("div",cs,[e("div",ms,[e("div",null,[e("b",null,k(O.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:x[2]||(x[2]=C=>{v(),c(Ce)()})},[b(F,{message:"main.nav.folders.add"},{default:h(()=>x[8]||(x[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",vs,[b(Tt,{folders:c(s).folderRoots,"filter-manager":E.collection.filterManager,"visible-folders":E.state.visibleFolders,tab:E},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):y("",!0),d.value?(o(),l(P,{key:1},[r.value&&r.value.length?(o(),l("div",gs,[x[11]||(x[11]=e("div",{class:"custom-hr"},null,-1)),e("div",fs,[e("div",ys,[e("div",null,[e("b",null,k(O.$t("main.nav.tasks.title")),1)])]),x[10]||(x[10]=e("div",{class:"custom-hr"},null,-1)),c(t).state.tasks?(o(),l("div",bs,[(o(!0),l(P,null,K(r.value,(C,$)=>(o(),l("div",hs,[$?(o(),l("div",_s)):y("",!0),b(Pt,{task:C},null,8,["task"])]))),256))])):y("",!0)])])):y("",!0)],64)):y("",!0),x[18]||(x[18]=e("div",{class:"custom-hr"},null,-1)),e("div",ks,[d.value?(o(),l("div",$s,[b(F,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:h(()=>[e("b",null,k(O.$t("main.nav.properties.title")),1)]),_:1}),x[13]||(x[13]=e("span",{class:"flex-grow-1"},null,-1)),g.value?(o(),l("span",xs,x[12]||(x[12]=[e("span",{class:"sr-only"},null,-1)]))):(o(),l("span",ws,[b(F,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:h(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:n})]),_:1})])),e("span",Ss,[b(F,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:h(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:x[3]||(x[3]=C=>c(a).showModal(c(se).EXPORT,void 0))})]),_:1})])])):y("",!0),c(t).loaded?(o(),l("div",Cs,[b(ns,{tab:E,"menu-open":d.value},null,8,["tab","menu-open"]),d.value?(o(),l(P,{key:0},[x[16]||(x[16]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:x[4]||(x[4]=C=>{c(a).showModal(c(se).PROPERTY,void 0),c(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[x[14]||(x[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,k(O.$t("main.nav.properties.add_property")),1)]),x[17]||(x[17]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:x[5]||(x[5]=C=>c(s).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[x[15]||(x[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,k(O.$t("main.nav.properties.add_property_group")),1)])],64)):y("",!0)])):y("",!0)])])])],4)]),_:1},8,["id"]))}}),zs=N(Ms,[["__scopeId","data-v-33a01314"]]),Ts={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Fs={class:""},Es=["onClick"],Os=G({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(_,{emit:u}){const t=_,s=u;function a(m){s("update:modelValue",m)}return(m,p)=>(o(),V(te,null,{button:h(()=>[e("div",Ts,[e("span",Fs,k(m.$t("modals.filters."+t.modelValue)),1)])]),popup:h(({hide:g})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:g},[e("div",{class:"base-btn",onClick:p[0]||(p[0]=d=>a(c(Fe).and))},k(m.$t("modals.filters.and")),1),p[2]||(p[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:p[1]||(p[1]=d=>a(c(Fe).or))},k(m.$t("modals.filters.or")),1)],8,Es)]),_:1}))}}),Ps=["disabled"],Gs={class:"m-0 p-1"},Ls=["onClick"],Ds=G({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(_,{emit:u}){const t=q(),s=_,a=u,m=z(()=>t.properties[s.propertyId]),p=z(()=>Ye(m.value.type));async function g(d){a("update:modelValue",d)}return(d,i)=>(o(),V(te,{onHide:i[0]||(i[0]=n=>a("hide")),placement:"bottom"},{button:h(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:s.disabled},[e("span",null,k(d.$t("modals.filters.operators."+s.modelValue)),1)],8,Ps)]),popup:h(({hide:n})=>[e("div",Gs,[(o(!0),l(P,null,K(p.value,r=>(o(),l("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:v=>{g(r),n()}},[e("a",null,k(d.$t("modals.filters.operators."+r)),1)],8,Ls))),256))])]),_:1}))}}),Rs=N(Ds,[["__scopeId","data-v-21b8bb8e"]]),As={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},Us=G({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(_,{emit:u}){const t=_,s=u;function a(m){s("update:modelValue",m)}return(m,p)=>(o(),l("div",As,[c(Le)(m.property.type)?(o(),V(Xe,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":a,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==c(j).color?(o(),V(Ze,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==c(j).number?(o(),V(Je,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==c(j).url?(o(),V(et,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==c(j).checkbox?(o(),V(tt,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":a,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==c(j).date?(o(),V(st,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":a,width:t.width,class:"sb"},null,8,["model-value","width"])):(o(),V(ot,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Bs={class:"p-0 m-0 ps-2"},Ns=G({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(_,{emit:u}){const t=q(),s=_,a=z(()=>t.properties[s.filter.propertyId]),m=z(()=>at(s.filter.operator));function p(i){s.manager.updateFilter(s.filter.id,{operator:i})}function g(i){s.manager.updateFilter(s.filter.id,{value:i})}function d(i){s.manager.updateFilter(s.filter.id,{propertyId:i.id})}return(i,n)=>(o(),l(P,null,[e("td",Bs,[b(nt,{"model-value":a.value,"onUpdate:modelValue":d},null,8,["model-value"])]),e("td",null,[b(Rs,{"property-id":a.value.id,"model-value":s.filter.operator,"onUpdate:modelValue":p},null,8,["property-id","model-value"])]),e("td",null,[m.value?(o(),V(Us,{key:0,"model-value":s.filter.value,"onUpdate:modelValue":g,property:a.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):y("",!0)])],64))}}),js={style:{"max-height":"500px",overflow:"auto"}},Ne=G({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(_,{emit:u}){const t=_;function s(a){t.manager.addNewFilter(a,t.group.id),fe.filter.show()}return(a,m)=>(o(),V(te,{placement:"auto"},{button:h(()=>[Pe(a.$slots,"default")]),popup:h(({hide:p})=>[e("div",js,[b(Re,{onSelect:g=>{s(g),p()},"ignore-ids":[c(Ve).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Hs={class:"filter-group"},qs={class:"table table-sm"},Ws={style:{height:"33px"}},Ks={class:""},Qs={key:0,class:"m-0 p-0"},Ys={key:2,class:"text-secondary"},Xs={class:"border rounded"},Zs={class:""},Js=["onClick"],eo={class:"d-flex text-secondary ms-2"},to={class:"add-options hover-light"},so=G({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(_,{emit:u}){q();const t=_,s=z(()=>t.filter),a=z(()=>s.value.filters),m=z(()=>{let i=255-(s.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function p(i){t.manager.deleteFilter(i.id)}function g(i){t.manager.addNewFilterGroup(i)}function d(i,n){t.manager.updateFilterGroup(i,n)}return(i,n)=>(o(),l("div",Hs,[e("table",qs,[(o(!0),l(P,null,K(a.value,(r,v)=>(o(),l("tr",Ws,[e("td",Ks,[v==0?(o(),l("div",Qs,k(i.$t("modals.filters.where")),1)):v==1?(o(),V(Os,{key:1,"model-value":s.value.groupOperator,"onUpdate:modelValue":n[0]||(n[0]=f=>d(s.value.id,f))},null,8,["model-value"])):(o(),l("span",Ys,k(i.$t("modals.filters."+s.value.groupOperator)),1))]),r.propertyId!==void 0?(o(),V(Ns,{key:0,filter:r,manager:t.manager},null,8,["filter","manager"])):(o(),l("td",{key:1,colspan:"3",style:Q(m.value)},[e("div",Xs,[b(je,{filter:r,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",Zs,[e("span",{class:"base-btn",onClick:f=>p(r)},n[2]||(n[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Js)])]))),256))]),e("div",eo,[b(Ne,{group:t.filter,manager:t.manager},{default:h(()=>[e("div",to,[n[3]||(n[3]=e("i",{class:"bi bi-plus"},null,-1)),Z(k(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:n[1]||(n[1]=r=>g(s.value.id))},[n[4]||(n[4]=e("i",{class:"bi bi-plus"},null,-1)),Z(k(i.$t("modals.filters.new_group")),1)])])]))}}),je=N(so,[["__scopeId","data-v-e644f737"]]),oo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},ao={key:0},no={key:0,class:"or-separator"},lo={key:0,class:"or-separator"},io={key:0,class:"m-1 p-1"},ro=G({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(_,{emit:u}){const t=q(),s=_,a=M(null),m=M(null),p=z(()=>{let d=g(s.manager.state.filter),i={};return d.forEach(n=>i[n.propertyId]=n),Object.values(i)});function g(d){let i=[];for(let n of d.filters)n.isGroup?i.push(...g(n)):i.push(n);return i}return H(()=>s.manager.state.filter.filters,()=>{s.manager.state.filter.filters.length==0&&m.value.hide()}),J(async()=>{await ee(),fe.filter=m.value}),(d,i)=>(o(),V(te,{ref_key:"dropdownElem",ref:m,placement:"top-start"},{button:h(()=>[e("div",null,[p.value.length||s.manager.state.query?.text?(o(),l("div",oo,[s.manager.state.query?.text?(o(),l("div",ao,[i[0]||(i[0]=e("span",{class:"text-primary"},"Text Query",-1)),p.value.length?(o(),l("span",no,"|")):y("",!0)])):y("",!0),(o(!0),l(P,null,K(p.value,(n,r)=>(o(),l("div",null,[r>0?(o(),l("span",lo,"|")):y("",!0),n.propertyId==c(Ve).id?(o(),V(ve,{key:1,type:c(t).properties[n.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),e("span",null,k(c(t).properties[n.propertyId].name),1)]))),256))])):y("",!0)])]),popup:h(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:a},[Object.keys(c(t).properties).length>0?(o(),l("div",io,[b(je,{filter:s.manager.state.filter,manager:s.manager,parent:a.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}}),uo=N(ro,[["__scopeId","data-v-6382f4d7"]]),po={class:"d-flex flex-row filter-form"},co={class:"pt-1 pb-1"},mo=G({__name:"FilterForm",props:{manager:Ie},setup(_){const u=_;return(t,s)=>(o(),l("div",po,[e("div",co,k(t.$t("main.menu.filters"))+": ",1),b(uo,{manager:u.manager},null,8,["manager"]),b(Ne,{manager:u.manager,group:u.manager.state.filter,class:"p-1"},{default:h(()=>s[0]||(s[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),vo=N(mo,[["__scopeId","data-v-cc2f25ec"]]),go={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},fo=G({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(_,{emit:u}){const t=_,s=u,a=M(null);return(m,p)=>(o(),V(te,{ref_key:"dropdownElem",ref:a,"auto-focus":!1},{button:h(()=>p[2]||(p[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:h(()=>[e("div",go,[b(Re,{onClick:p[0]||(p[0]=g=>c(Ce)()),onSelect:p[1]||(p[1]=g=>{s("select",g),a.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),He=N(fo,[["__scopeId","data-v-012e1f38"]]),yo={class:"base-hover ps-1 pe-1"},bo={class:"main"},ho=["onClick"],_o=G({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(_,{emit:u}){const t=_,s=u,a=Object.values(Ae);function m(p){s("update:modelValue",p)}return(p,g)=>(o(),V(te,null,{button:h(()=>[e("div",yo,k(t.modelValue),1)]),popup:h(({hide:d})=>[e("div",bo,[(o(!0),l(P,null,K(c(a),i=>(o(),l("div",{class:"base-hover option",onClick:n=>{m(i),d()}},k(i),9,ho))),256))])]),_:1}))}}),ko=N(_o,[["__scopeId","data-v-ce3e3774"]]),$o={class:""},xo={class:"d-flex ipt"},wo={class:"ms-2",min:"1"},So=G({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(_,{emit:u}){const t=_,s=u,a=M(1),m=M(Ae.Year);function p(){t.option.stepSize==a.value&&t.option.stepUnit==m.value||s("change",{stepSize:a.value,stepUnit:m.value})}function g(){a.value=t.option.stepSize??1,m.value=t.option.stepUnit}return H(()=>t.option,g),J(g),H(a,()=>{(a.value<1||a.value==null||isNaN(a.value))&&(a.value=1)}),(d,i)=>(o(),V(te,{onHide:p},{button:h(()=>i[2]||(i[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:h(({hide:n,focus:r})=>[e("div",$o,[e("div",xo,[e("div",null,[ye(e("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=v=>a.value=v)},null,512),[[be,a.value]])]),e("div",wo,[b(ko,{modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=v=>m.value=v),onHide:r},null,8,["modelValue","onHide"])])])])]),_:1}))}}),Co=N(So,[["__scopeId","data-v-78b647dc"]]),Io={class:"d-flex flex-row group-form"},Vo={class:"pt-1 pb-1"},Mo={key:0,class:"bg-selected bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},zo={key:0,class:"bi bi-chevron-right smaller"},To=["onClick"],Fo=["onClick"],Eo=["onClick"],Oo=["onClick"],Po=["onClick"],Go=["onClick"],Lo=["onClick"],Do=["onClick"],Ro=["onClick"],Ao={key:5,class:"sm-btn"},Uo={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Bo=G({__name:"GroupForm",props:{isLoading:Boolean,manager:lt},setup(_){const u=q(),t=_;function s(n){t.manager.setGroupOption(n),t.manager.update(!0)}function a(n){t.manager.delGroupOption(n),t.manager.update(!0)}function m(n,r){t.manager.setGroupOption(n,{direction:r}),t.manager.sortGroups(!0)}function p(n,r){t.manager.setGroupOption(n,{type:r}),t.manager.sortGroups(!0)}function g(n,r){t.manager.setGroupOption(n,r),t.manager.update(!0)}const d=z(()=>t.manager.state.groupBy.map(n=>u.properties[n])),i=z(()=>{const n=[];return t.manager.state.groupBy.forEach(r=>{n.push({option:t.manager.state.options[r],property:u.properties[r]})}),n});return(n,r)=>(o(),l("div",Io,[e("div",Vo,k(n.$t("main.menu.groupby"))+": ",1),d.value.length?(o(),l("div",Mo,[(o(!0),l(P,null,K(i.value,(v,f)=>(o(),l(P,null,[f>0?(o(),l("i",zo)):y("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:S=>a(v.property.id),id:"remove-group-button"},k(v.property.name),9,To),v.option.type==c(ne).Size?(o(),V(F,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:h(()=>[v.option.direction==c(oe).Ascending?(o(),l("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:S=>p(v.property.id,c(ne).Property)},null,8,Fo)):(o(),l("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:S=>p(v.property.id,c(ne).Property)},null,8,Eo))]),_:2},1024)):(o(),V(F,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:h(()=>[v.property.type==c(j).number?(o(),l(P,{key:0},[v.option.direction==c(oe).Ascending?(o(),l("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:S=>p(v.property.id,c(ne).Size)},null,8,Oo)):(o(),l("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:S=>p(v.property.id,c(ne).Size)},null,8,Po))],64)):(o(),l(P,{key:1},[v.option.direction==c(oe).Ascending?(o(),l("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:S=>p(v.property.id,c(ne).Size)},null,8,Go)):(o(),l("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:S=>p(v.property.id,c(ne).Size)},null,8,Lo))],64))]),_:2},1024)),v.option.direction==c(oe).Ascending?(o(),V(F,{key:3,message:"main.menu.sort.order_asc"},{default:h(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:S=>m(v.property.id,c(oe).Descending)},null,8,Do)]),_:2},1024)):(o(),V(F,{key:4,message:"main.menu.sort.order_desc"},{default:h(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:S=>m(v.property.id,c(oe).Ascending)},null,8,Ro)]),_:2},1024)),v.property.type==c(j).date?(o(),l("div",Ao,[b(Co,{option:v.option,onChange:S=>g(v.property.id,S)},null,8,["option","onChange"])])):y("",!0)],64))),256)),t.isLoading?(o(),l("i",Uo)):y("",!0)])):y("",!0),b(He,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:r[0]||(r[0]=v=>s(v))},null,8,["group-ids"])]))}}),No=N(Bo,[["__scopeId","data-v-81bcbb10"]]),jo={class:"d-flex flex-row sort-form"},Ho={class:"pt-1 pb-1"},qo={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Wo={key:0,class:"bi bi-chevron-right smaller"},Ko=["onClick"],Qo=["onClick"],Yo=["onClick"],Xo=G({__name:"SortForm",props:{manager:it},setup(_){const u=q(),t=_,s=z(()=>t.manager.state.sortBy.map(d=>({propertyId:d,direction:t.manager.state.options[d].direction}))),a=z(()=>s.value.map(d=>d.propertyId));function m(d){t.manager.setSort(d),t.manager.update(!0)}function p(d){t.manager.delSort(d),t.manager.update(!0)}function g(d,i){t.manager.setSort(d,{direction:i}),t.manager.update(!0)}return(d,i)=>(o(),l("div",jo,[e("div",Ho,k(d.$t("main.menu.sort.title"))+": ",1),s.value.length?(o(),l("div",qo,[(o(!0),l(P,null,K(s.value,(n,r)=>(o(),l(P,null,[r>0?(o(),l("i",Wo)):y("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:v=>p(n.propertyId)},k(c(u).properties[n.propertyId].name),9,Ko),n.direction==c(oe).Ascending?(o(),V(F,{key:1,message:"main.menu.sort.order_asc"},{default:h(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:v=>g(n.propertyId,c(oe).Descending)},null,8,Qo)]),_:2},1024)):(o(),V(F,{key:2,message:"main.menu.sort.order_desc"},{default:h(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:v=>g(n.propertyId,c(oe).Ascending)},null,8,Yo)]),_:2},1024))],64))),256))])):y("",!0),b(He,{"group-ids":a.value,onSelect:i[0]||(i[0]=n=>m(n))},null,8,["group-ids"])]))}}),Zo=N(Xo,[["__scopeId","data-v-4e00ef99"]]),Jo={class:"p-2"},ea={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ta={class:"border mb-1 p-1"},sa={class:"me"},oa={key:0},aa={key:1},na={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},la={class:"d-flex center justify-content-center"},ia={key:1,class:"bi bi-arrow-down text-secondary"},ra={key:3,class:"bi bi-arrow-up text-secondary"},ua={class:"border mb-1 p-1"},da={class:"me"},pa={key:0},ca={key:1},ma={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},re=5,va=G({__name:"HistoryDropdown",emits:[],setup(_,{emit:u}){const t=q(),s=M(!1),a=z(()=>s.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=z(()=>[...t.history.undo].reverse().slice(0,re)),p=z(()=>t.history.redo.slice(Math.max(t.history.redo.length-re,0)));return H(()=>t.onUndo,()=>{console.log("changed"),s.value=!0,setTimeout(()=>s.value=!1,100)}),(g,d)=>m.value.length||p.value.length?(o(),V(te,{key:0},{button:h(()=>[b(F,{message:"dropdown.history.info"},{default:h(()=>[e("div",{class:"d-flex sb flash",style:Q([{"font-size":"14px"},a.value])},[d[2]||(d[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,k(g.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:h(()=>[e("div",Jo,[c(t).history.redo.length>re?(o(),l("div",ea," + "+k(c(t).history.redo.length-re),1)):y("",!0),(o(!0),l(P,null,K(p.value,i=>(o(),l("div",ta,[e("span",sa,k(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),d[3]||(d[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(o(),l("span",oa,k(i.tags)+" "+k(g.$t("dropdown.history.tags")),1)):y("",!0),i.values?(o(),l("span",aa,k(i.values)+" "+k(g.$t("dropdown.history.values")),1)):y("",!0)]))),256)),e("div",na,[e("div",la,[m.value.length?(o(),V(F,{key:0,message:"dropdown.history.undo"},{default:h(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:d[0]||(d[0]=(...i)=>c(t).undo&&c(t).undo(...i))})]),_:1})):(o(),l("div",ia)),d[4]||(d[4]=e("div",{style:{width:"30px"}},null,-1)),p.value.length?(o(),V(F,{key:2,message:"dropdown.history.redo"},{default:h(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:d[1]||(d[1]=(...i)=>c(t).redo&&c(t).redo(...i))})]),_:1})):(o(),l("div",ra))])]),(o(!0),l(P,null,K(m.value,i=>(o(),l("div",ua,[e("span",da,k(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),d[5]||(d[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(o(),l("span",pa,k(i.tags)+" "+k(g.$t("dropdown.history.tags")),1)):y("",!0),i.values?(o(),l("span",ca,k(i.values)+" "+k(g.$t("dropdown.history.values")),1)):y("",!0)]))),256)),c(t).history.undo.length>re?(o(),l("div",ma," + "+k(c(t).history.undo.length-re),1)):y("",!0)])]),_:1})):y("",!0)}}),ga=N(va,[["__scopeId","data-v-85cd80d0"]]),fa=G({__name:"ToggleReload",props:{tab:{}},emits:[],setup(_,{emit:u}){const t=_,s=z(()=>t.tab.collection.state.autoReload?2:t.tab.collection.runState.isDirty?0:1);function a(){s.value==0?t.tab.collection.update():s.value==1?t.tab.collection.setAutoReload(!0):t.tab.collection.setAutoReload(!1)}return(m,p)=>(o(),l("div",{class:"bb font",onClick:a,style:{width:"26px",height:"30px",overflow:"hidde"}},[s.value==0?(o(),V(F,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:h(()=>p[0]||(p[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):y("",!0),s.value==1?(o(),V(F,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:h(()=>p[1]||(p[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):y("",!0),s.value==2?(o(),V(F,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:h(()=>p[2]||(p[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):y("",!0)]))}}),ya=N(fa,[["__scopeId","data-v-91d89d17"]]),ba={class:"display"},ha={key:1,class:"display"},_a={class:"p-0"},ka=["onClick"],$a={key:2},xa={key:0,class:"text-gray-500 p-2 text-sm"},wa=G({__name:"SelectDropdown",props:{options:{},modelValue:{},placeholder:{},size:{}},emits:["update:modelValue","changed"],setup(_,{emit:u}){const t=_,s=u,a=z(()=>t.options.find(g=>g.value===t.modelValue)),m=z(()=>t.size?t.size:14),p=(g,d)=>{g.disabled||(s("update:modelValue",g.value),s("changed",g.value),d())};return(g,d)=>(o(),V(te,{placement:"bottom-start"},{button:h(()=>[e("div",{style:Q([{fontSize:m.value+"px"},{"white-space":"nowrap"}])},[a.value.description?(o(),V(F,{key:0,message:a.value.description},{default:h(()=>[a.value.icon?(o(),l("span",{key:0,class:B(["bi bi-"+a.value.icon,"me-0"])},null,2)):y("",!0),e("span",ba,[Z(k(a.value.label??a.value.value)+" ",1),d[0]||(d[0]=e("i",{class:"ms-1 bi bi-chevron-down"},null,-1))])]),_:1},8,["message"])):(o(),l("span",ha,[a.value.icon?(o(),l("span",{key:0,class:B(["bi bi-"+a.value.icon,"me-0"])},null,2)):y("",!0),Z(" "+k(a.value.label??a.value.value)+" ",1),d[1]||(d[1]=e("i",{class:"ms-1 bi bi-chevron-down"},null,-1))]))],4)]),popup:h(({hide:i})=>[e("div",_a,[(o(!0),l(P,null,K(g.options,n=>(o(),l("div",{key:n.value,class:B(["bb",{"is-selected":n.value===g.modelValue,"is-disabled":n.disabled}]),onClick:r=>p(n,i)},[n.icon?(o(),l("span",{key:0,class:B(["bi bi-"+n.icon,"me-2"])},null,2)):y("",!0),n.description?(o(),V(F,{key:1,message:n.description},{default:h(()=>[Z(k(n.label??n.value),1)]),_:2},1032,["message"])):(o(),l("span",$a,k(n.label??n.value),1))],10,ka))),128)),g.options.length===0?(o(),l("div",xa," No options available ")):y("",!0)])]),_:1}))}}),Sa=N(wa,[["__scopeId","data-v-19abb783"]]),Ca=["onSubmit"],Ia={class:"mb-1"},Va={class:"d-flex flex-center mt-3",style:{height:"20px"}},Ma=["onClick"],za=["onClick"],Ta=G({__name:"InputOptions",props:{functionId:{},size:{},hideText:{type:Boolean}},emits:["changed"],setup(_,{emit:u}){const t=Me(),s=_,a=u,m=M([]),p=z(()=>s.size?s.size:12),g=z(()=>s.functionId.slice(0,s.functionId.indexOf(".")));function d(){if(!s.functionId||!t.index[s.functionId])return;const r=t.index[s.functionId].params,v=t.getContext(s.functionId).uiInputs;for(let f of r)f.defaultValue=v[f.name];m.value=JSON.parse(JSON.stringify(r))}async function i(){for(let r in m.value)t.index[s.functionId].params[r].defaultValue=m.value[r].defaultValue;await t.updateDefaultParams(),a("changed")}function n(){d()}return J(d),(r,v)=>m.value.length?(o(),l("div",{key:0,style:Q({fontSize:p.value+"px"})},[b(te,null,{button:h(()=>[e("div",null,[b(F,{message:"Options"},{default:h(()=>v[0]||(v[0]=[e("span",{class:"bbb"},[e("i",{class:"bi bi-gear"})],-1)])),_:1})])]),popup:h(({hide:f})=>[e("form",{onSubmit:le(S=>{i(),f()},["prevent"]),class:"p-2"},[(o(!0),l(P,null,K(m.value,(S,O)=>(o(),l("div",Ia,[S.name=="text"&&s.hideText?y("",!0):(o(),V(rt,{key:0,input:S,source:g.value},null,8,["input","source"]))]))),256)),e("div",Va,[v[1]||(v[1]=e("div",{class:"flex-grow-1"},null,-1)),e("div",{class:"bb",onClick:S=>{n(),f()}},k(r.$t("cancel")),9,Ma),e("div",{class:"bb",onClick:S=>{i(),f()}},k(r.$t("confirm")),9,za)])],40,Ca)]),_:1})],4)):y("",!0)}}),Fa={class:"cont3"},Ea={class:"select-wrapper"},Oa=["placeholder"],Pa={style:{width:"22px"}},Ga={key:0},La=G({__name:"TextSearchInput",props:{query:{}},emits:["update:query"],setup(_,{emit:u}){const t=Me(),s=_,a=u,m=M(null),p=M(!1),g=[{value:"text",icon:"search"},{value:"regex",icon:"regex"}],d=M([]),i=M("text"),n=M(""),r=z(()=>i.value!="text"&&i.value!="regex");function v(){const E=t.textSearchFunctions.map(C=>({value:C.id,icon:"boxes"}));d.value=[...g,...E]}function f(){s.query&&(i.value=s.query.type||"text",n.value=s.query.text||"")}function S(){n.value="",x()}function O(){x()}function x(){const E={type:i.value,text:n.value};if(r.value){if(!t.index[i.value]){i.value="text",S();return}const C=t.getContext(i.value);C.uiInputs.text=n.value,E.ctx=C}a("update:query",E)}return v(),H(()=>s.query,f,{deep:!0}),H(()=>t.textSearchFunctions,v),H(i,x),J(()=>{v(),f()}),R.ctrlF.on(()=>m.value?.focus()),(E,C)=>(o(),l("div",Fa,[e("div",Ea,[b(Sa,{options:d.value,modelValue:i.value,"onUpdate:modelValue":C[0]||(C[0]=$=>i.value=$),placeholder:"Search Mode",class:"bg-white"},null,8,["options","modelValue"])]),e("div",{class:B(["input-field d-flex items-align-center",{focus:p.value}])},[ye(e("input",{class:"text-input2",type:"text","onUpdate:modelValue":C[1]||(C[1]=$=>n.value=$),placeholder:E.$t("main.menu.search"),ref_key:"inputElem",ref:m,onFocusin:C[2]||(C[2]=$=>p.value=!0),onFocusout:C[3]||(C[3]=$=>p.value=!1),onKeypress:Ue(O,["enter"])},null,40,Oa),[[be,n.value]]),e("div",Pa,[n.value.length?(o(),l("i",{key:0,class:"bi bi-x sb",onClick:S})):y("",!0)])],2),r.value?(o(),l("div",Ga,[b(Ta,{"function-id":i.value,size:14,"hide-text":!0,onChanged:x},null,8,["function-id"])])):y("",!0)]))}}),Da=N(La,[["__scopeId","data-v-1067ab55"]]),Ra={class:"d-flex flex-row p-2 align-items-center"},Aa={class:"me-5 d-flex"},Ua={class:"ms-5",style:{"font-size":"13px"}},Ba=["checked"],Na={class:"ms-1"},ja={class:"ms-4"},Ha={class:"d-flex flex-wrap content-container ps-2"},qa=G({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(_,{emit:u}){ut();const t=_,s=M(),a=z(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=z(()=>a.value.length);function p(i){const n=i.target.checked;t.tab.collection.groupManager.setSha1Mode(n,!0)}function g(){console.log("get local",t.tab.state.filterState.query),s.value=t.tab.state.filterState.query}function d(i){s.value=i,t.tab.collection.filterManager.setQuery(s.value),t.tab.collection.filterManager.update(!0),t.tab.saveState()}return J(g),H(()=>t.tab.collection.filterManager.state.query,g),(i,n)=>(o(),l(P,null,[e("div",Ra,[b(Da,{class:"me-1",style:{"flex-shrink":"0"},query:s.value,"onUpdate:query":d},null,8,["query"]),e("div",Aa,[b(F,{message:"main.menu.grid_tooltip"},{default:h(()=>[e("i",{class:B("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:n[0]||(n[0]=r=>t.tab.setViewMode("tree"))},null,2)]),_:1}),b(F,{message:"main.menu.table_tooltip"},{default:h(()=>[e("i",{id:"toot",class:B("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:n[1]||(n[1]=r=>t.tab.setViewMode("grid"))},null,2)]),_:1}),b(F,{message:"main.menu.graph_tooltip"},{default:h(()=>[e("i",{id:"toot",class:B("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:n[2]||(n[2]=r=>t.tab.setViewMode("graph"))},null,2)]),_:1})]),b(F,{message:"main.menu.image_size_tooltip",click:!1},{default:h(()=>n[6]||(n[6]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[b(dt,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":n[3]||(n[3]=r=>t.tab.state.imageSize=r)},null,8,["modelValue"])]),e("div",Ua,[b(F,{message:"main.menu.image_mode_tooltip"},{default:h(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:p},null,40,Ba),e("span",Na,k(i.$t("main.menu.image_mode")),1)]),_:1})]),e("div",ja,[b(ga)]),m.value?(o(),V(pt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":a.value,"onRemove:selected":n[4]||(n[4]=r=>t.tab.collection.groupManager.clearSelection()),onStamped:n[5]||(n[5]=r=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0),n[8]||(n[8]=e("div",{class:"flex-grow-1"},null,-1)),b(F,{message:"main.menu.issue",class:"bb"},{default:h(()=>n[7]||(n[7]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",Ha,[b(ya,{tab:t.tab,class:"me-1"},null,8,["tab"]),b(vo,{manager:t.tab.collection.filterManager},null,8,["manager"]),b(No,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),b(Zo,{manager:t.tab.collection.sortManager},null,8,["manager"]),n[9]||(n[9]=e("div",null,null,-1))])],64))}}),Wa=N(qa,[["__scopeId","data-v-1eda7a31"]]),Ka={class:""},Qa={class:"d-flex flex-row"},Ya=G({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(_,{emit:u}){const t=pe(),s=_,a=u,m=z(()=>`width: ${s.size}px; height: ${s.size}px;`);z(()=>`max-width: ${s.size-2}px; max-height: ${s.size-1}px;`);const p=z(()=>s.pile.images[0]);return(g,d)=>(o(),l("div",Ka,[b(ct,{image:p.value},{default:h(()=>[e("div",{style:Q(m.value),class:"img-container",onClick:d[0]||(d[0]=i=>c(t).showModal(c(se).IMAGE,{image:p.value}))},[b(mt,{image:p.value,width:s.size-2,height:s.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Qa,[b(F,{message:"main.recommand.accept"},{default:h(()=>[e("div",{style:Q(["width: "+s.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:d[1]||(d[1]=i=>a("accept",p.value))}," ✓ ",4)]),_:1}),b(F,{message:"main.recommand.refuse"},{default:h(()=>[e("div",{style:Q(["width: "+s.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:d[2]||(d[2]=i=>a("refuse",p.value))}," ✕ ",4)]),_:1})])]))}}),Xa=N(Ya,[["__scopeId","data-v-2ff8fded"]]),Za={class:"reco-container"},Ja={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},en={key:0,class:"bi bi-funnel-fill bb text-primary"},tn={key:1,class:"bi bi-funnel bb"},sn={class:"text-secondary me-2"},on={style:{"padding-top":"2px"},class:"me-1"},an={class:"flex-grow-1"},nn={class:"d-flex flex-row"},ln={key:0,class:"separator"},rn={class:"d-flex flex-row"},xe=10,un=G({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(_,{emit:u}){const t=q(),s=Me(),a=_,m=u,p=M(1),g=ge([]),d=M(null),i=ge([]),n=ge(new Set),r=M(!0),v=[],f=[];async function S(A){const I=[],w=[];i.forEach(U=>{if(U.value!=null){const L=t.properties[U.propertyId];let W=U.value;L.type==j.multi_tags?(W=A.properties[U.propertyId]??[],W=[...W,U.value]):L.type==j.tag&&(W=[W]),L.mode==Se.id?w.push({instanceId:A.id,propertyId:L.id,value:W}):I.push({propertyId:L.id,sha1:A.sha1,value:W})}}),await t.setPropertyValues(w,I)}function O(A){d.value.isSha1Group?d.value.images.filter(I=>I.sha1==A.sha1).forEach(I=>n.add(I.id)):n.add(A.id),X()}function x(){g.length=0;let A=[];const I=f.map(w=>t.instances[w]);if(d.value.isSha1Group){const w={},U=Array.from(new Set(I.map(L=>L.sha1)));U.forEach(L=>w[L]=[]),I.forEach(L=>w[L.sha1].push(L)),U.forEach(L=>A.push({sha1:L,images:t.sha1Index[L]}))}else I.forEach(w=>A.push({sha1:w.sha1,images:[w]}));E(A,g,p.value,a.imageSize,a.width)}function E(A,I,w,U,L){let W=L,Y=[],ae=0;for(let he=0;he<A.length&&!(I.length>=w);he++){let ce=A[he];if(ce.images=ce.images.filter(qe=>!n.has(qe.id)),ce.images.length==0)continue;let _e=U+xe;if(ae+_e<W){Y.push(ce),ae+=_e;continue}if(Y.length==0)throw new Error("Images seems to be to big for the line");I.push(Y),I.length<w&&(Y=[ce],ae=_e)}Y.length>0&&I.length<w&&I.push(Y)}async function C(){if(!a.group||!s.hasSimilaryFunction)return;const A=s.defaultActions.similar,I=s.getContext(A);I.instanceIds=a.group.images.map(Y=>Y.id);const w=await s.getSimilarImages(I);if(!w)return;if(!w.groups)throw new Error("No instances in ActionResult");let L=ft(w.groups)[0];if(r.value){const Y=new Set(a.tab.collection.filterManager.result.images.map(ae=>ae.id));L.images=L.images.filter(ae=>Y.has(ae.id))}L.scores&&yt(L),d.value=L,i.length=0;let W=a.group;for(;W;)i.push(...W.meta.propertyValues),W=W.parent;n.clear(),v.length=0,L.images.forEach(Y=>v.push(Y.id)),X(),m("update")}function $(){r.value=!r.value}function T(){a.tab.collection.groupManager.onResultChange.addListener(X)}function D(){a.tab.collection.groupManager.onResultChange.removeListener(X)}function X(){const A=a.tab.collection.groupManager.result.index[a.group.id];if(!A){m("close");return}f.length=0;const I=new Set(A.images.map(w=>w.id));v.forEach(w=>{I.has(w)||n.has(w)||f.push(w)}),x()}return J(T),ze(D),J(C),H(()=>a.group,()=>{C(),n.clear()}),H(()=>a.imageSize,x),H(()=>a.width,x),H(r,C),(A,I)=>(o(),l("div",Za,[e("div",Ja,[b(F,{message:"main.recommand.close"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:I[0]||(I[0]=w=>m("close"))},I[2]||(I[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),I[5]||(I[5]=e("div",{class:"b-left pe-1"},null,-1)),b(F,{message:"main.recommand.scroll"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:I[1]||(I[1]=w=>m("scroll",a.group.id))},I[3]||(I[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),I[6]||(I[6]=e("div",{class:"b-left pe-1"},null,-1)),b(F,{message:"main.recommand.filter"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:$},[r.value?(o(),l("span",en)):(o(),l("span",tn))])]),_:1}),I[7]||(I[7]=e("div",{class:"b-left pe-1"},null,-1)),b(F,{message:"main.recommand.reload"},{default:h(()=>[e("div",{class:"text-secondary pe-1",onClick:C},I[4]||(I[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),I[8]||(I[8]=e("div",{class:"b-left pe-1"},null,-1)),b(F,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:h(()=>[e("span",sn,k(A.$t("main.recommand.title")),1)]),_:1}),e("div",on,[b(vt,{action:"similar",onChanged:C})]),e("div",an,[e("div",nn,[(o(!0),l(P,null,K(i,(w,U)=>(o(),l(P,null,[b(gt,{class:"",value:w},null,8,["value"]),U<i.length-1?(o(),l("div",ln)):y("",!0)],64))),256))])])]),e("div",{style:Q("margin-left:"+xe+"px;")},[(o(!0),l(P,null,K(g,w=>(o(),l("div",null,[e("div",rn,[(o(!0),l(P,null,K(w,U=>(o(),V(Xa,{pile:U,size:a.imageSize,onAccept:S,onRefuse:O,style:Q("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),dn=N(un,[["__scopeId","data-v-fe023b30"]]),pn={style:{display:"flex"}},cn={class:"info"},mn={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:j},height:String},setup(_){const u=_,t=M(0),s=M(!1),a={};Object.keys(u.chartData.series).forEach(r=>{a[r]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:u.chartData.dataType===j.date?"datetime":"numeric",categories:u.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:r,seriesIndex:v,dataPointIndex:f,w:S}){const O=u.chartData.series[v].data[f];let x='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';O.images.forEach((C,$)=>{$<10&&(x+=`<div style="width: 75px; height: 75px;"><img src="${C}" style="width: 100%; height: 100%;" /></div>`)}),x+="</div>";let E=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${u.chartData.series[v].name} — </b> ${O.y} Images</span>`;return E+=`<div>${x}</div>`,E}}}),p=()=>{m.value.chart.stacked=!m.value.chart.stacked,s.value=!s.value,t.value+=1},g=()=>{let r;m.value.chart.type==="area"?r={chart:{...m.value.chart,type:"bar"}}:r={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...r},t.value+=1},d=(r,v,f)=>{const O=u.chartData.series[v];let x=Math.max(...O.data.map(E=>E.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(E=>E.remove()),a[v]){a[v]=!1;return}O.data.forEach((E,C)=>{const T=Math.floor(E.y/x*17),D=E.images.slice(0,T),X=`circle[index="${v}"][j="${C}"]`,A=document.querySelector(X),I=parseFloat(A.getAttribute("cx"));D.forEach((w,U)=>{const L=document.createElement("img");L.src=w,L.width=40,L.height=40,L.style.position="absolute";let W=I+40/1.5,Y=65+U*40;L.style.left=`${W}px`,L.style.bottom=`${Y}px`,L.classList.add("apexcharts-custom-image"),L.addEventListener("mouseover",ae=>i(W,Y,w)),L.addEventListener("mouseout",n),r.el.appendChild(L)})}),Object.keys(a).forEach(E=>a[E]=!1),a[v]=!0};function i(r,v,f){const S=document.getElementById("zoomed-image");S.style.left=`${r+120*1.5}px`,S.src=f,S.style.bottom=`${v}px`,S.style.display="block"}function n(){const r=document.getElementById("zoomed-image");r.style.display="none"}return(r,v)=>{const f=Oe("apexchart");return o(),l(P,null,[e("div",pn,[e("button",{class:"mt-2",onClick:g},k(m.value.chart.type==="area"?r.$t("main.graph-view.histo"):r.$t("main.graph-view.curve")),1),u.chartData.series.length>1?(o(),l("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:p},k(s.value?r.$t("main.graph-view.over"):r.$t("main.graph-view.stack")),1)):y("",!0)]),(o(),V(f,{style:{position:"relative"},key:t.value,height:u.height,type:m.value.chart.type,options:m.value,series:u.chartData.series,onLegendClick:d},null,8,["height","type","options","series"])),e("i",cn,k(r.$t("main.graph-view.info")),1),v[0]||(v[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},vn={key:1},gn=G({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(_,{emit:u}){const t=q(),s=_,a=M(""),m=M(g());function p(){const d=new Set;let i=s.collection.groupManager.getGroupIterator();for(;i;){const n=i.group;if(n.id===0||n.meta.propertyValues&&n.meta.propertyValues[0].value==null){i=i.nextGroup();continue}for(let r of n.children)d.add(r.meta.propertyValues[0].value);n.children.forEach(()=>i=i.nextGroup()),i=i.nextGroup()}return d}function g(){const d={};let i,n=s.collection.groupManager.state.groupBy;if(n.length===0){a.value="Choose at least one date or numeric value to group the images by";return}const r=t.properties[n[0]],v=r.type;if(n.length>2){a.value="Only max two levels of grouping are supported";return}else if(n.length===1)d[r.name]={name:r.name,data:[]};else if(i=Array.from(p()),i.length>20){a.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(v!==j.number&&v!==j.date){a.value="First level of grouping needs to be a date or a numeric property";return}let f=s.collection.groupManager.getGroupIterator();const S=[];for(;f;){const O=f.group;if(O.id===0||O.meta.propertyValues&&O.meta.propertyValues[0].value==null){f=f.nextGroup();continue}let x=O.meta.propertyValues[0];const E=v===j.date?new Date(x.value).getTime():x.value;if(S.push(E),r.name in d)d[r.name].data.push({x:E,y:O.images.length,images:O.images.slice(0,20).map(C=>C.urlSmall)});else{const C=O.children.map(T=>T.meta.propertyValues[0].value),$=i.filter(T=>!C.includes(T));for(let T of O.children){const D=T.meta.propertyValues[0].value;if(d[D]===void 0){let X=D;D in t.tags&&(X=t.tags[D].value),d[D]={data:[],name:X}}d[T.meta.propertyValues[0].value].data.push({x:E,y:T.images.length,images:T.images.slice(0,20).map(X=>X.urlSmall)})}for(let T of $){if(d[T]===void 0){let D=T;T in t.tags&&(D=t.tags[T].value),d[T]={data:[],name:D}}d[T].data.push({x:E,y:0,images:[]})}O.children.forEach(()=>f=f.nextGroup())}f=f.nextGroup()}return a.value="",{series:Object.values(d),xValues:S,dataType:v}}return s.collection.groupManager.onResultChange.addListener(()=>m.value=g()),(d,i)=>(o(),l("div",{class:"",style:Q({height:s.height+"px"})},[a.value===""?(o(),V(mn,{key:0,chartData:m.value,height:s.height-50+"px"},null,8,["chartData","height"])):(o(),l("span",vn,k(a.value),1))],4))}}),fn={key:0,class:"m-0 p-0"},yn={key:0,style:{"margin-left":"10px"}},bn=G({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(_,{expose:u}){de();const t=q(),s=_;u({updateScrollerWidth:x});const a=M({}),m=M(!0),p=M(null),g=M(null),d=M(null),i=M(0),n=M(0),r=ge({groups:!1}),v=z(()=>s.tab.getVisibleProperties());function f(){p.value&&g.value?i.value=s.height-p.value.clientHeight-g.value.clientHeight-5:p.value?i.value=s.height-p.value.clientHeight-5:i.value=0}function S(E){a.value=s.tab.collection.groupManager.result.index[E],ee(()=>f())}function O(){a.value={},ee(()=>f())}async function x(){await ee(),n.value=p.value?.clientWidth??n.value}return J(()=>{n.value=p.value.clientWidth,window.addEventListener("resize",x)}),ze(()=>{window.removeEventListener("resize",x)}),H(()=>s.tab.state.imageSize,()=>ee(f)),H(()=>s.filterOpen,()=>ee(f)),H(()=>s.height,async()=>{await ee(f)}),J(f),(E,C)=>(o(),l(P,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:p},[s.filterOpen?(o(),V(Wa,{key:0,tab:s.tab,"compute-status":r},null,8,["tab","compute-status"])):y("",!0)],512),e("div",{ref_key:"boxElem",ref:g,class:"m-0 p-0"},[a.value.id?(o(),l("div",fn,[b(dn,{tab:s.tab,group:a.value,"image-size":s.tab.state.imageSize,width:n.value,height:50,onClose:O,onScroll:d.value.scrollTo,onUpdate:C[0]||(C[0]=$=>ee(()=>f()))},null,8,["tab","group","image-size","width","onScroll"])])):y("",!0)],512),c(t).isLoaded&&n.value>0&&i.value>0&&m.value?(o(),l("div",yn,[s.tab.state.display=="tree"?(o(),V(bt,{key:0,"input-key":"main-view-tree","group-manager":s.tab.collection.groupManager,"image-size":s.tab.state.imageSize,height:i.value-0,properties:v.value,"hide-if-modal":!0,"selected-images":s.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:d,width:n.value-25,onRecommend:S},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),s.tab.state.display=="grid"?(o(),l("div",{key:1,style:Q({width:n.value-12+"px"}),class:"p-0 m-0 grid-container"},[b(ht,{tab:E.tab,manager:s.tab.collection.groupManager,height:i.value-15,width:n.value-40,"selected-properties":v.value,class:"p-0 m-0","show-images":!0,"selected-images":s.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:d,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):y("",!0),s.tab.state.display=="graph"?(o(),V(gn,{key:2,collection:s.tab.collection,height:i.value-15},null,8,["collection","height"])):y("",!0)])):y("",!0)],64))}}),hn=N(bn,[["__scopeId","data-v-872542dd"]]),_n=G({__name:"TabButton",props:{tab:{}},setup(_){const u=me(),t=M(""),s=M(null),a=M(!1),m=M(!1),p=_,g=z(()=>p.tab.state.id);function d(){u.selectMainTab(p.tab.state.id)}function i(){m.value=!0,t.value=p.tab.state.name,ee(()=>s.value.focus())}function n(){p.tab.renameTab(t.value),m.value=!1}async function r(){confirm("Are you sure to delete Tab: "+p.tab.state.name)&&u.deleteTab(p.tab.state.id)}return J(()=>{p.tab.isNew&&i()}),(v,f)=>(o(),l("div",{class:"d-flex d-row me-2",onMouseenter:f[1]||(f[1]=S=>a.value=!0),onMouseleave:f[2]||(f[2]=S=>a.value=!1)},[m.value?(o(),l("div",{key:1,class:B(["tab-button",g.value==c(u).mainTab?" active":""])},[e("form",{onSubmit:le(n,["stop","prevent"])},[ye(e("input",{onFocusout:n,onKeydown:Ue(n,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":f[0]||(f[0]=S=>t.value=S),ref_key:"inputElem",ref:s},null,544),[[be,t.value]])],32)],2)):(o(),l(P,{key:0},[b(F,{message:"main.menu.rename_tab_tooltip"},{default:h(()=>[e("i",{onClick:i,class:B(["bi bi-pencil me-1 tab-icon hover-light",a.value&&c(u).mainTab==g.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:B(["tab-button",g.value==c(u).mainTab?" active":""]),onClick:d},[e("span",null,k(p.tab.state.name),1)],2),b(F,{message:"main.menu.delete_tab_tooltip"},{default:h(()=>[e("i",{onClick:r,class:B(["btn-icon bi bi-x tab-icon hover-light",a.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),kn={class:"d-flex d-row",style:{cursor:"pointer"}},$n={class:"pt-1"},xn={key:0,class:"bb bi bi-chevron-down"},wn={key:1,class:"bb bi bi-chevron-right"},Sn={style:{"padding-top":"2px","margin-right":"2px"}},Cn={class:"lang"},In=["value"],Vn=["value"],Mn=G({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(_,{emit:u}){const{locale:t}=Ge(),s=pe(),a=me(),m=_,p=u;async function g(r){await a.addTab("New Tab")}const d=["fr","en"];function i(){p("update:filterOpen",!m.filterOpen)}function n(r){m.reRender();const v=r.target.value;t.value=v,de().setLang(v)}return(r,v)=>(o(),l("nav",null,[e("div",kn,[e("div",$n,[e("span",{onClick:i},[m.filterOpen?(o(),l("i",xn)):(o(),l("i",wn))])]),(o(!0),l(P,null,K(c(a).loadedTabs,f=>(o(),l("div",null,[b(_n,{tab:c(a).getTab(f)},null,8,["tab"])]))),256)),b(F,{message:"main.menu.add_tab_tooltip"},{default:h(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:g,id:"add-tab-button"},v[2]||(v[2]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),v[5]||(v[5]=e("div",{class:"flex-grow-1"},null,-1)),c(s).clientState.user?(o(),l("div",{key:0,style:{margin:"2px"},class:"bb me-3 text-secondary",onClick:v[0]||(v[0]=f=>c(_t)().disconnectUser())},k(c(s).clientState.user.name),1)):y("",!0),e("div",Sn,[b(F,{message:"modals.notif.icon"},{default:h(()=>[e("span",{class:"bb",onClick:v[1]||(v[1]=f=>c(s).showModal(c(se).NOTIF))},v[3]||(v[3]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",Cn,[v[4]||(v[4]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:r.$i18n.locale,onChange:n},[(o(),l(P,null,K(d,(f,S)=>e("option",{key:`Lang${S}`,value:f},k(f.toUpperCase()),9,Vn)),64))],40,In)])])]))}}),zn={key:0},Tn={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},ue=G({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(_){const u=_;return(t,s)=>u.loading?(o(),l("div",zn,[t.loading?(o(),l("div",Tn,s[0]||(s[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):y("",!0)])):y("",!0)}}),we=G({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(_){const u=_,t=z(()=>u.force?"100%":u.max==0?"0%":u.current>=u.max?"100%":Math.floor(u.current/u.max*100)+"%");return(s,a)=>(o(),l("span",null,k(t.value),1))}}),Fn={key:0,class:"center"},En={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},On={class:"d-flex text-secondary"},Pn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},Gn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Ln={key:0,class:"bi bi-check text-success"},Dn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Rn={key:0,class:"bi bi-check text-success"},An={class:"d-flex text-secondary",style:{"font-size":"14px"}},Un={key:0,class:"bi bi-check text-success"},Bn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Nn={key:0,class:"bi bi-check text-success"},jn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Hn={key:0,class:"bi bi-check text-success"},qn=G({__name:"DataLoad",setup(_){const u=q();return(t,s)=>c(u).loadState?(o(),l("div",Fn,[e("div",En,[e("div",null,[e("div",On,[s[0]||(s[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedProperty},null,8,["loading"]),c(u).loadState.finishedProperty?(o(),l("i",Pn)):y("",!0)]),e("div",Gn,[s[1]||(s[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedPropertyGroups},null,8,["loading"]),c(u).loadState.finishedPropertyGroups?(o(),l("i",Ln)):y("",!0)]),e("div",Dn,[s[2]||(s[2]=e("div",{class:"me-1"},"Tags",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedTags},null,8,["loading"]),c(u).loadState.finishedTags?(o(),l("i",Rn)):y("",!0)]),e("div",An,[s[3]||(s[3]=e("div",{class:"me-1"},"Instances",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedInstance},null,8,["loading"]),c(u).loadState.finishedInstance?(o(),l("i",Un)):y("",!0),b(we,{current:c(u).loadState.counterInstance,max:c(u).loadState.maxInstance,force:c(u).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",Bn,[s[4]||(s[4]=e("div",{class:"me-1"},"InstanceValues",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedInstanceValues},null,8,["loading"]),c(u).loadState.finishedInstanceValues?(o(),l("i",Nn)):y("",!0),b(we,{current:c(u).loadState.counterInstanceValue,max:c(u).loadState.maxInstanceValue,force:c(u).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",jn,[s[5]||(s[5]=e("div",{class:"me-1"},"ImageValues",-1)),b(ue,{class:"me-2",loading:!c(u).loadState.finishedImageValues},null,8,["loading"]),c(u).loadState.finishedImageValues?(o(),l("i",Hn)):y("",!0),b(we,{current:c(u).loadState.counterImageValue,max:c(u).loadState.maxImageValue,force:c(u).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):y("",!0)}}),Wn=N(qn,[["__scopeId","data-v-0db6d675"]]),Kn={key:0},Qn={id:"panoptic"},Yn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Xn={class:"w-100"},Zn={key:0,class:"custom-hr"},Jn={key:2,class:"loading"},el={class:"text-center"},tl={key:3,class:"loading"},sl=G({__name:"ProjectView",setup(_){const u=de(),t=q(),s=pe(),a=me(),m=M(null),p=M(null),g=M(window.innerHeight),d=M(!1),i=M(!0),n=M(!0),r=z(()=>g.value-(p.value?.clientHeight??0)),v=z(()=>m.value?.filteredImages.map($=>$.id));let f=navigator.userAgent.indexOf("Mac OS X")!==-1;async function S(){i.value=!1,await ee(),i.value=!0}J(async()=>{if(!s.isProjectLoaded){Ee.push("/");return}u.init(),ee(()=>{window.addEventListener("resize",O),O()}),window.addEventListener("keydown",$=>{$.key=="Meta"&&(R.cmd=!0),$.key=="Control"&&(R.ctrl=!0),$.key=="Alt"&&(f&&(R.ctrl=!0),R.alt=!0),$.key=="Shift"&&(R.shift=!0),$.key=="ArrowLeft"&&(R.left=!0),$.key=="ArrowRight"&&(R.right=!0),$.key=="Z"&&R.ctrl&&t.redo(),$.key=="z"&&R.ctrl&&t.undo(),$.key=="f"&&(R.ctrl||R.cmd)&&($.preventDefault(),R.ctrlF.emit())}),window.addEventListener("keyup",$=>{$.key=="Meta"&&(R.cmd=!1),$.key=="Control"&&(R.ctrl=!1),$.key=="Alt"&&(f&&(R.ctrl=!1),R.alt=!1),$.key=="Shift"&&(R.shift=!1),$.key=="ArrowLeft"&&(R.left=!1),$.key=="ArrowRight"&&(R.right=!1)}),window.addEventListener("mousemove",$=>{R.ctrl=$.ctrlKey,R.alt=$.altKey,R.shift=$.shiftKey,R.cmd=$.metaKey,f&&(R.ctrl=R.ctrl||R.alt)})}),ze(()=>{window.removeEventListener("resize",O),de().clear()});function O(){g.value=window.innerHeight,d.value=!0}function x(){s.showModal(se.EXPORT,v)}function E(){Ee.push("/")}function C(){m.value&&m.value.updateScrollerWidth()}return($,T)=>i.value?(o(),l("div",Kn,[m.value&&!m.value.imageList?(o(),V(kt,{key:0,tutorial:"project"})):y("",!0),e("div",Qn,[e("div",Yn,[c(t).isLoaded?c(t).isLoaded?(o(),l(P,{key:1},[e("div",null,[b(zs,{onExport:T[0]||(T[0]=D=>x()),onToggle:C})]),e("div",Xn,[e("div",{class:"ms-1",ref_key:"navElem",ref:p},[b(Mn,{"re-render":S,filterOpen:n.value,"onUpdate:filterOpen":T[1]||(T[1]=D=>n.value=D)},null,8,["filterOpen"])],512),d.value?(o(),l("div",Zn)):y("",!0),b(Be,{id:c(a).mainTab},{default:h(({tab:D})=>[b(hn,{tab:D,height:r.value,ref_key:"mainViewRef",ref:m,"filter-open":n.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):c(s).isProjectLoaded?(o(),l("div",tl,T[2]||(T[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(o(),l("div",Jn,[e("div",el,[e("div",null,k($.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:E,style:{"font-size":"50px",cursor:"pointer"}})])])):(o(),l("div",{key:0,class:"d-flex flex-column w-100",style:Q({height:g.value+"px"})},[b(Wn,{class:"flex-grow-1"})],4))])])])):y("",!0)}}),nl=N(sl,[["__scopeId","data-v-bd31bdaa"]]);export{nl as default};
