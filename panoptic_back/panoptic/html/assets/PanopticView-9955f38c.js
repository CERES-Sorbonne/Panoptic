import{d as P,f as L,r as x,c as S,g as oe,o as s,a,b as t,w as le,v as re,F,i as R,q as $,x as ie,t as b,l as V,s as k,n as D,D as Z,y as Ee,_ as N,z as de,A as B,B as Pe,j as i,P as ve,k as g,C as Ie,E as M,G as Te,H as ze,I as Oe,J as Ge,K as Le,p as W,e as Y,L as he,N as E,O as Se,m as Q,T as Ne,Q as Ce,R as A,S as _e,U as be,u as ye,M as se,V as De,W as Re,X as $e,Y as Me,Z as Ue,$ as te,a0 as J,a1 as je,a2 as Ae,a3 as He,a4 as Be,a5 as qe,a6 as ne,a7 as Ke,a8 as Qe,a9 as We,aa as ee,ab as Ye,ac as Xe,ad as Je,ae as Ze,af as et,h as ke,ag as H,ah as tt}from"./index-c1637869.js";const st={class:"mb-1 ps-2 pe-2"},ot=["onClick"],fe=P({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const e=L(),o=d,p=r,v=x(null),y=x(""),h=S(()=>{let m=e.propertyList;return o.ignoreIds&&(m=m.filter(_=>!o.ignoreIds.includes(_.id))),m.filter(_=>_.name.includes(y.value))});return oe(()=>v.value.focus()),(m,_)=>(s(),a("div",null,[t("div",st,[le(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:v,"onUpdate:modelValue":_[0]||(_[0]=n=>y.value=n)},null,512),[[re,y.value]])]),(s(!0),a(F,null,R(h.value,n=>(s(),a("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:l=>p("select",n.id)},[$(ie,{type:n.type,class:"me-2"},null,8,["type"]),t("a",null,b(n.name),1)],8,ot))),256))]))}}),at=["disabled"],nt={class:"m-0 p-1"},lt=["onClick"],it=P({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=r,v=x(null),y=S(()=>e.data.properties[o.propertyId]),h=S(()=>Ee(y.value.type));async function m(_){p("update:modelValue",_),v.value.hide()}return(_,n)=>(s(),V(Z,{onHide:n[0]||(n[0]=l=>p("hide")),ref_key:"dropdownElem",ref:v,parent:o.parent},{button:k(()=>[t("div",{class:D(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,b(_.$t("modals.filters.operators."+o.modelValue)),1)],10,at)]),popup:k(()=>[t("div",nt,[(s(!0),a(F,null,R(h.value,l=>(s(),a("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>m(l)},[t("a",null,b(_.$t("modals.filters.operators."+l)),1)],8,lt))),256))])]),_:1},8,["parent"]))}});const rt=N(it,[["__scopeId","data-v-29ed354e"]]),dt=d=>(W("data-v-25365fdd"),d=d(),Y(),d),pt={class:"m-0 p-0"},ut={key:1},ct={class:"d-flex mode-header"},_t={class:"me-3"},mt=dt(()=>t("div",{class:"flex-fill"},null,-1)),vt={key:0,class:"me-2",style:{width:"100%"}},yt=P({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=L(),e=d,o=x(null),p=x(null),v=x(null),y=x(0),h=x(null),m=x(null),_=S(()=>e.filterId!==void 0?e.filterId:h.value),n=S(()=>{if(!(_.value==null||_.value==-1))return e.manager.filterIndex[_.value]}),l=S(()=>n.value==null?void 0:r.data.properties[n.value.propertyId]);function u(){y.value=e.mode,e.mode==2&&e.filterId==null&&I(e.propertyId)}function c(){o.value&&o.value.hide()}function f(){y.value=0}function C(){c(),e.manager.deleteFilter(_.value),e.manager.update(!0)}function I(j){let z=e.manager.addNewFilter(j,e.parentId);e.manager.update(!0),h.value=z.id,y.value=2}function w(j){e.manager.updateFilter(_.value,{operator:j}),e.manager.update(!0),p.value&&p.value.focus()}function T(){e.manager.updateFilter(_.value,{value:m.value}),e.manager.update(!0)}function G(){if(!n.value)return;const j=r.data.properties[n.value.propertyId];if(Ge(j.type))return;const z=m.value??Le(j.type);n.value.value!=z&&T()}function K(){n.value&&(m.value=n.value.value)}return oe(K),B(()=>n.value,()=>K()),(j,z)=>(s(),V(Z,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:f,parent:e.parent},{button:k(()=>[t("div",pt,[Pe(j.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[y.value!=0?(s(),a(F,{key:0},[y.value==1?(s(),V(fe,{key:0,onSelect:I,"ignore-ids":[i(ve).folders]},null,8,["ignore-ids"])):g("",!0),y.value==2?(s(),a("div",ut,[t("div",ct,[t("div",_t,b(l.value.name),1),$(rt,{"property-id":n.value.propertyId,"model-value":n.value.operator,"onUpdate:modelValue":w,parent:v.value},null,8,["property-id","model-value","parent"]),mt,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:C})])]),i(Ie)(n.value.operator)?(s(),a("div",vt,[l.value.type==i(M).multi_tags||l.value.type==i(M).tag?(s(),V(Te,{key:0,modelValue:m.value,"onUpdate:modelValue":[z[0]||(z[0]=O=>m.value=O),T],"auto-focus":!0,property:i(r).data.properties[n.value.propertyId],ref_key:"inputElem",ref:p,onHide:c},null,8,["modelValue","property"])):l.value.type==i(M).color?(s(),V(ze,{key:1,property:l.value,modelValue:m.value,"onUpdate:modelValue":[z[1]||(z[1]=O=>m.value=O),z[2]||(z[2]=()=>{c(),G()})]},null,8,["property","modelValue"])):(s(),V(Oe,{key:2,"no-html":!0,modelValue:m.value,"onUpdate:modelValue":z[3]||(z[3]=O=>m.value=O),width:-1,"min-height":20,"no-nl":i(r).data.properties[n.value.propertyId].type==i(M).number,"url-mode":i(r).data.properties[n.value.propertyId].type==i(M).url,"only-number":i(r).data.properties[n.value.propertyId].type==i(M).number,onBlur:G,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):g("",!0)])):g("",!0)],64)):g("",!0)],512)]),_:3},8,["parent"]))}});const pe=N(yt,[["__scopeId","data-v-25365fdd"]]),ae=d=>(W("data-v-66fff643"),d=d(),Y(),d),ft={class:"d-flex flex-row"},gt={key:1,class:"d-flex",style:{width:"150px"}},ht={class:"flex-grow-1"},bt={key:1,style:{"padding-top":"1px"}},$t={style:{width:"20px","margin-top":"2px"},class:"text-center"},kt=ae(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),wt={class:"text-center",style:{width:"20px","margin-top":"2px"}},xt=ae(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),It=ae(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),St={key:0,class:"ms-3 pt-1"},Ct=ae(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Mt=ae(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Vt=ae(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Ft=ae(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Et={key:1},Pt=P({__name:"PropertyOptions",props:{property:Object},setup(d){const r=L(),e=r.getTabManager(),o=d,p=x(!1),v=x(!1),y=x(""),h=x(!1),m=S(()=>r.getTab()),_=S(()=>m.value.visibleProperties[o.property.id]==!0),n=S(()=>e.collection.filterManager.state.filter.filters.some(O=>!O.isGroup&&O.propertyId==o.property.id)),l=S(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),u=S(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),c=S(()=>{if(n.value)return e.collection.filterManager.state.filter.filters.find(O=>!O.isGroup&&O.propertyId==o.property.id).id}),f=()=>e.collection.filterManager,C=S(()=>e.getSha1Mode());function I(){_.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function w(){p.value?p.value=!1:(p.value=!0,y.value=o.property.name),v.value=!1}function T(){o.property.type!=M.tag&&o.property.type!=M.multi_tags||(v.value?v.value=!1:v.value=!0,p.value=!1)}function G(){u.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function K(){l.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function j(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&r.deleteProperty(o.property.id)}function z(){y.value!=""&&r.updateProperty(o.property.id,y.value)}return B(()=>o.property,()=>{p.value=!1}),(O,U)=>(s(),a("div",{class:D(h.value?"hover-light":"")},[t("div",ft,[p.value?g("",!0):(s(),a("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:w},[$(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:U[0]||(U[0]=X=>h.value=!0),onMouseleave:U[1]||(U[1]=X=>h.value=!1)},null,8,["type"]),t("span",null,b(o.property.name),1)])),p.value?(s(),a("div",gt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:w,onMouseenter:U[2]||(U[2]=X=>h.value=!0),onMouseleave:U[3]||(U[3]=X=>h.value=!1)},null,32)]),t("div",ht,[o.property.id>=0?le((s(),a("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":U[4]||(U[4]=X=>y.value=X),onChange:z},null,544)),[[re,y.value]]):(s(),a("span",bt,[$(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,b(o.property.name),1)]))])])):g("",!0),t("div",$t,[o.property.mode==i(he).id?(s(),V(E,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[kt]),_:1})):g("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:I,class:"btn-icon text-center"},[C.value&&o.property.mode==i(he).id?(s(),V(E,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:U[5]||(U[5]=Se(()=>{},["stop"]))})]),_:1})):(s(),V(E,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:D("bi bi-eye text-"+(_.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",wt,[o.property.type==i(M).tag||o.property.type==i(M).multi_tags?(s(),a("div",{key:0,onClick:T,style:{cursor:"pointer"}},[v.value?(s(),V(E,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[xt]),_:1})):(s(),V(E,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[It]),_:1}))])):g("",!0)])]),t("div",null,[p.value?(s(),a("div",St,[t("div",{class:D(["options hover-light",n.value?" text-primary":""])},[$(pe,{manager:f(),"filter-id":c.value,mode:2,"property-id":d.property.id},{default:k(()=>[Ct,Q(b(O.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:D(["options hover-light",u.value?" text-primary":""]),onClick:G},[Mt,Q(b(O.$t("main.menu.sort.title")),1)],2),t("div",{class:D(["options hover-light",l.value?" text-primary":""]),onClick:K},[Vt,Q(b(O.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),a("div",{key:0,class:"options hover-light",onClick:j},[Ft,Q(b(O.$t("main.nav.properties.delete_property")),1)])):g("",!0)])):v.value?(s(),a("div",Et,[$(Ne,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):g("",!0)])],2))}});const we=N(Pt,[["__scopeId","data-v-66fff643"]]),Tt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),zt={class:"p-2"},Ot=["onClick"],Gt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),Lt=P({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=L(),e=d;function o(){r.reImportFolder(e.folder.id)}return(p,v)=>(s(),V(Z,{teleport:!0},{button:k(()=>[Tt]),popup:k(({hide:y})=>[t("div",zt,[t("div",{class:"base-hover p-1",onClick:h=>{o(),y()}},[Gt,Q(" Re import")],8,Ot)])]),_:1}))}}),Nt=["onMouseenter"],Dt=["onClick"],Rt={class:"text-secondary"},Ut=["onClick"],jt=P({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(d){const r=L(),e=d,o=x(null),p=S(()=>{let n={};const l=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{l.has(u)&&(n[u]=!0)}),n}),v=S(()=>{let n={};return e.folders.map(l=>l.id).forEach(l=>{e.visibleFolders[l]&&(n[l]=!0)}),n}),y=S(()=>{let n={};return e.folders.forEach(l=>{let u=[];p.value[l.id]&&u.push("selected"),n[l.id]=u.join(" ")}),n});function h(n){let l=e.visibleFolders;l[n]?delete l[n]:l[n]=!0}function m(n){let l=new Set(e.filterManager.state.folders);const u=l.has(n),c=r.data.folders[n].parent!=null&&l.has(r.data.folders[n].parent);u&&!c?(l.delete(n),_e(n).forEach(f=>l.delete(f.id))):(_(n,l),l.add(n),_e(n).forEach(f=>l.add(f.id)),be(r.data.folders[n]).forEach(f=>l.delete(f.id))),e.filterManager.setFolders(Array.from(l)),e.filterManager.update(!0)}function _(n,l){const u=be(r.data.folders[n]);let c;for(let f of u)if(l.has(f.id))c=f;else break;c!=null&&_e(c.id).forEach(f=>l.delete(f.id))}return(n,l)=>{const u=Ce("FolderList2",!0);return s(),a("ul",{class:D(e.root?"tree":""),style:A(e.root?"padding-left:0px;":"")},[(s(!0),a(F,null,R(d.folders,c=>(s(),a("li",{style:A(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:f=>o.value=c.id,onMouseleave:l[0]||(l[0]=f=>o.value=null)},[t("summary",{class:D(y.value[c.id]),onClick:f=>m(c.id)},[Q(b(c.name)+" ",1),t("span",Rt,b(c.count),1)],10,Dt),c.children&&c.children.length>0?(s(),a("i",{key:0,onClick:f=>h(c.id),class:D("bi bi-chevron-"+(v.value[c.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ut)):g("",!0),t("span",{class:D(o.value===c.id?"visible-option":"invisible-option")},[$(Lt,{folder:c,style:{display:"inline-block"}},null,8,["folder"])],2),c.children&&c.children.length>0&&v.value[c.id]?(s(),V(u,{key:1,folders:c.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):g("",!0)],44,Nt))),256))],6)}}});const At=N(jt,[["__scopeId","data-v-9f26453b"]]),Ht={class:"text-center"},Bt={class:"w-100 text-center",style:{"font-size":"10px"}},qt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Kt=P({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=S(()=>r.task.total-r.task.remain-r.task.computing),o=S(()=>r.task.total);return(p,v)=>(s(),a("div",Ht,[Q(b(r.task.name)+" ",1),t("div",Bt,b(e.value)+" / "+b(o.value)+" "+b(p.$t("main.nav.tasks.done")),1),o.value>0?(s(),a("div",qt,[t("div",{class:"progress-bar",style:A(`width: ${e.value/o.value*100}%`)},null,4)])):g("",!0)]))}}),q=d=>(W("data-v-b4f30c1e"),d=d(),Y(),d),Qt={class:"menu overflow-scroll"},Wt={class:""},Yt={class:"m-0",style:{padding:"4px 0px 4px 8px"}},Xt={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},Jt=q(()=>t("i",{class:"bi bi-gear"},null,-1)),Zt=[Jt],es=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),ts=[es],ss=q(()=>t("div",{class:"custom-hr"},null,-1)),os={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},as={class:"d-flex align-items-center"},ns=q(()=>t("i",{class:"bi bi-plus"},null,-1)),ls={class:"overflow-scroll"},is={key:0},rs=q(()=>t("div",{class:"custom-hr"},null,-1)),ds={class:"pt-1 pb-2"},ps={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},us=q(()=>t("div",{class:"custom-hr"},null,-1)),cs={key:0,class:"ps-2 pe-2"},_s={class:"p-1"},ms={key:0,class:"custom-hr"},vs={key:1,class:"p-2"},ys=q(()=>t("div",{class:"custom-hr"},null,-1)),fs={key:0,class:"float-end"},gs={class:"text-center"},hs={class:"w-100 text-center",style:{"font-size":"10px"}},bs={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},$s={key:2,class:"p-2"},ks={class:"w-100 text-center",style:{"font-size":"10px"}},ws={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},xs=q(()=>t("div",{class:"custom-hr"},null,-1)),Is={class:"p-2 mt-0"},Ss={class:"d-flex"},Cs=q(()=>t("span",{class:"flex-grow-1"},null,-1)),Ms={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Vs=q(()=>t("span",{class:"sr-only"},null,-1)),Fs=[Vs],Es={key:1,class:"me-3"},Ps={class:"me-3"},Ts={key:0,class:"mt-2"},zs={key:0,class:"property-item"},Os=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Gs=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ls=q(()=>t("div",{class:"custom-hr"},null,-1)),Ns={class:"p-2 mt-0"},Ds={key:0,class:"mt-2"},Rs={key:0,class:"property-item"},Us=P({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=L(),o=ye(),p=e.getTabManager(),v=x(!1);x(null);const y=x(!1),h=async l=>{o.showModal(se.IMPORT)},m=S(()=>e.backendStatus.tasks.filter(l=>!(l.name=="Load Plugin"&&l.done)));function _(){o.showModal(se.FOLDERSELECTION,{callback:n,mode:"images"})}function n(l){l&&e.addFolder(l)}return B(()=>e.status.import.to_import,()=>v.value=!0),(l,u)=>{var c;return s(),a("div",Qt,[t("div",Wt,[t("div",null,[t("div",Yt,[t("div",Xt,[t("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},b((c=i(o).data.status.selectedProject)==null?void 0:c.name),1),t("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=f=>i(o).showModal(i(se).SETTINGS))},Zt),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=f=>i(o).closeProject())},ts)])]),ss,t("div",os,[t("div",as,[t("div",null,[t("b",null,b(l.$t("main.nav.folders.title")),1)]),t("div",{class:"ms-auto plus",onClick:_},[$(E,{message:"main.nav.folders.add"},{default:k(()=>[ns]),_:1})])]),t("div",ls,[i(e).getTab()?(s(),V(At,{key:0,folders:i(e).folderRoots,"filter-manager":i(p).collection.filterManager,"visible-folders":i(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):g("",!0)])]),m.value&&m.value.length?(s(),a("div",is,[rs,t("div",ds,[t("div",ps,[t("div",null,[t("b",null,b(l.$t("main.nav.tasks.title")),1)])]),us,i(e).backendStatus?(s(),a("div",cs,[(s(!0),a(F,null,R(m.value,(f,C)=>(s(),a("div",_s,[C?(s(),a("div",ms)):g("",!0),$(Kt,{task:f},null,8,["task"])]))),256))])):g("",!0)])])):g("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&v.value?(s(),a("div",vs,[ys,i(e).status.import.done?(s(),a("div",fs,[t("i",{class:"bi bi-x base-hover",onClick:u[3]||(u[3]=f=>v.value=!1)})])):g("",!0),t("div",gs,[t("b",null,b(l.$t("main.menu.import_status_title")),1)]),t("div",hs,b(i(e).status.import.imported)+" / "+b(i(e).status.import.to_import)+" importées ",1),i(e).status.import.to_import>0?(s(),a("div",bs,[t("div",{class:"progress-bar",style:A(`width: ${i(e).status.import.imported/i(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&v.value?(s(),a("div",$s,[t("div",ks,b(i(e).status.import.computed)+" / "+b(i(e).status.import.to_import)+" computed ",1),i(e).status.import.to_import>0?(s(),a("div",ws,[t("div",{class:"progress-bar",style:A(`width: ${i(e).status.import.computed/i(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),xs,t("div",Is,[t("div",Ss,[$(E,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,b(l.$t("main.nav.properties.title")),1)]),_:1}),Cs,y.value?(s(),a("span",Ms,Fs)):(s(),a("span",Es,[$(E,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-file-earmark-arrow-up btn-icon text-secondary",onClick:h})]),_:1})])),t("span",Ps,[$(E,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-down btn-icon text-secondary",onClick:u[4]||(u[4]=f=>i(o).showModal(i(se).EXPORT,void 0))})]),_:1})])]),i(e).status.loaded?(s(),a("div",Ts,[(s(!0),a(F,null,R(i(e).data.properties,f=>(s(),a(F,null,[f.id>=0?(s(),a("div",zs,[$(we,{property:f},null,8,["property"])])):g("",!0)],64))),256)),Os,t("div",{onClick:u[5]||(u[5]=f=>i(o).showModal(i(se).PROPERTY,void 0)),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Gs,t("span",null,b(l.$t("main.nav.properties.add_property")),1)])])):g("",!0)]),Ls,t("div",Ns,[$(E,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,b(l.$t("main.nav.computed.title")),1)]),_:1}),i(e).status.loaded?(s(),a("div",Ds,[(s(!0),a(F,null,R(i(e).data.properties,f=>(s(),a(F,null,[f.id<0?(s(),a("div",Rs,[$(E,{pos:"bottom",message:"main.nav.computed."+Math.abs(f.id).toString()+"_tooltip"},{default:k(()=>[$(we,{property:f},null,8,["property"])]),_:2},1032,["message"])])):g("",!0)],64))),256))])):g("",!0)])])])])}}});const js=N(Us,[["__scopeId","data-v-b4f30c1e"]]),As={class:"text-nowrap text-secondary"},xe=P({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=L(),e=d,o=S(()=>r.data.properties[e.propertyId].tags);return(p,v)=>(s(),a("div",As,[e.value&&e.value.length>0?(s(!0),a(F,{key:0},R(e.value,y=>(s(),a("span",null,[$(De,{tag:o.value[y].value,color:o.value[y].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),a(F,{key:1},[Q(" Add Tags... ")],64))]))}}),Hs={key:0},Bs={key:1},qs={key:2},Ks={key:3},Qs={key:0,class:"bi bi-square"},Ws={key:1,class:"bi bi-check-square"},Ys={key:5},Xs={key:6},Js={key:7},Zs={key:8},eo={key:9},to={key:10},so={key:11},oo={key:12},ao={key:13},no={key:1,class:"text-secondary"},lo=P({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=S(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":Re[p].color}),o=S(()=>[M._ahash,M._folders,M._sha1,M.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,v)=>d.value!=null?(s(),a(F,{key:0},[r.property.type==i(M)._ahash?(s(),a("div",Hs,b(o.value),1)):g("",!0),r.property.type==i(M)._folders?(s(),a("div",Bs,b(o.value),1)):g("",!0),r.property.type==i(M)._sha1?(s(),a("div",qs,b(o.value),1)):g("",!0),r.property.type==i(M).checkbox?(s(),a("div",Ks,[o.value?(s(),a("i",Qs)):(s(),a("i",Ws))])):g("",!0),r.property.type==i(M).color?(s(),a("div",{key:4,style:A({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):g("",!0),r.property.type==i(M).date?(s(),a("div",Ys,b(o.value),1)):g("",!0),r.property.type==i(M).image_link?(s(),a("div",Xs)):g("",!0),r.property.type==i(M).multi_tags?(s(),a("div",Js,[$(xe,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):g("",!0),r.property.type==i(M).number?(s(),a("div",Zs,b(o.value),1)):g("",!0),r.property.type==i(M).path?(s(),a("div",eo,b(o.value),1)):g("",!0),r.property.type==i(M).string?(s(),a("div",to,b(o.value),1)):g("",!0),r.property.type==i(M)._id||r.property.type==i(M)._height||r.property.type==i(M)._width?(s(),a("div",so,b(o.value),1)):g("",!0),r.property.type==i(M).tag?(s(),a("div",oo,[$(xe,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):g("",!0),r.property.type==i(M).url?(s(),a("div",ao,b(o.value),1)):g("",!0)],64)):(s(),a("span",no,"..."))}}),io={class:"d-flex bb ps-1 overflow-hidden"},ro={class:"m-0 p-0 me-2 text-nowrap"},po={key:0,class:"m-0 p-0 me-2",style:{width:"150px"}},uo=P({__name:"FilterPreview",props:{filter:Object},setup(d){const r=L(),e=d,o=S(()=>r.data.properties[e.filter.propertyId]);return(p,v)=>(s(),a("td",io,[t("div",ro,b(p.$t("modals.filters.operators."+e.filter.operator)),1),i(Ie)(e.filter.operator)?(s(),a("div",po,[$(lo,{property:o.value,value:e.filter.value},null,8,["property","value"])])):g("",!0)]))}});const co=N(uo,[["__scopeId","data-v-532e0b3f"]]),_o={class:"m-0 bb",style:{}},mo={class:"p-2"},vo=P({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=r,v=x(null);function y(h){v.value.hide(),p("update:modelValue",e.data.properties[h])}return(h,m)=>(s(),V(Z,{ref_key:"dropdownElem",ref:v,"auto-focus":!1},{button:k(()=>[t("div",_o,[$(ie,{type:o.modelValue.type},null,8,["type"]),Q(" "+b(o.modelValue.name),1)])]),popup:k(()=>[t("div",mo,[$(fe,{modelValue:o.modelValue,"onUpdate:modelValue":m[0]||(m[0]=_=>o.modelValue=_),onSelect:y,"ignore-ids":[i(ve).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ue=d=>(W("data-v-b9005f3e"),d=d(),Y(),d),yo={class:"filter-group"},fo={class:"table table-sm"},go={class:"align-top p-0 m-0"},ho={key:0,class:"m-0 p-0"},bo={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},$o={class:""},ko=["onClick"],wo=ue(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),xo={key:2,class:"text-secondary"},Io={key:0,class:"p-0 m-0 ps-2"},So={key:1,class:"p-0 m-0 ps-2"},Co={class:"border rounded"},Mo={class:""},Vo=["onClick"],Fo=ue(()=>t("i",{class:"bi bi-trash"},null,-1)),Eo=[Fo],Po={class:"d-flex text-secondary ms-2"},To={class:"add-options hover-light"},zo=ue(()=>t("i",{class:"bi bi-plus"},null,-1)),Oo=ue(()=>t("i",{class:"bi bi-plus"},null,-1)),Go=P({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=L(),o=d,p=S(()=>o.filter),v=S(()=>p.value.filters),y=S(()=>{let l=255-(p.value.depth+1)*5;return`background: rgb(${l},${l},${l});`});function h(l,u){o.manager.updateFilter(l,{propertyId:u}),o.manager.update(!0)}function m(l){o.manager.deleteFilter(l.id),o.manager.update(!0)}function _(l){o.manager.addNewFilterGroup(l),o.manager.update(!0)}function n(l,u){o.manager.updateFilterGroup(l,u),o.manager.update(!0)}return(l,u)=>{const c=Ce("FilterGroupInput",!0);return s(),a("div",yo,[t("table",fo,[(s(!0),a(F,null,R(v.value,(f,C)=>(s(),a("tr",null,[t("td",go,[C==0?(s(),a("div",ho,b(l.$t("modals.filters.where")),1)):C==1?(s(),V(Z,{key:1},{button:k(()=>[t("div",bo,[t("span",$o,b(l.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:I})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:I},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=w=>n(p.value.id,i($e).and))},b(l.$t("modals.filters.and")),1),wo,t("div",{class:"base-btn",onClick:u[1]||(u[1]=w=>n(p.value.id,i($e).or))},b(l.$t("modals.filters.or")),1)],8,ko)]),_:1})):(s(),a("span",xo,b(p.value.groupOperator),1))]),f.propertyId!==void 0?(s(),a("td",Io,[$(vo,{"model-value":i(e).data.properties[f.propertyId],"onUpdate:modelValue":I=>h(f.id,I.id)},null,8,["model-value","onUpdate:modelValue"])])):g("",!0),f.propertyId!==void 0?(s(),a("td",So,[$(pe,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":f.id,parent:o.parent},{default:k(()=>[$(co,{filter:f},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),a("td",{key:2,colspan:"3",style:A(y.value)},[t("div",Co,[$(c,{filter:f,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",Mo,[t("span",{class:"base-btn",onClick:I=>m(f)},Eo,8,Vo)])]))),256))]),t("div",Po,[$(pe,{manager:o.manager,"parent-id":p.value.id},{default:k(()=>[t("div",To,[zo,Q(b(l.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=f=>_(p.value.id))},[Oo,Q(b(l.$t("modals.filters.new_group")),1)])])])}}});const Lo=N(Go,[["__scopeId","data-v-b9005f3e"]]),No=d=>(W("data-v-c6a37a82"),d=d(),Y(),d),Do={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ro={key:0},Uo=No(()=>t("span",{class:"text-primary"},"Text Query",-1)),jo={key:0,class:"or-separator"},Ao={key:0,class:"or-separator"},Ho={key:0,class:"m-1 p-0"},Bo=P({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=x(null),v=x(null),y=S(()=>{let m=h(o.manager.state.filter),_={};return m.forEach(n=>_[n.propertyId]=n),Object.values(_)});function h(m){let _=[];for(let n of m.filters)n.isGroup?_.push(...h(n)):_.push(n);return _}return B(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&v.value.hide()}),(m,_)=>(s(),V(Z,{ref_key:"dropdownElem",ref:v},{button:k(()=>[t("div",null,[y.value.length||o.manager.state.query?(s(),a("div",Do,[o.manager.state.query?(s(),a("div",Ro,[Uo,y.value.length?(s(),a("span",jo,"|")):g("",!0)])):g("",!0),(s(!0),a(F,null,R(y.value,(n,l)=>(s(),a("div",null,[l>0?(s(),a("span",Ao,"|")):g("",!0),n.propertyId==i(ve).id?(s(),V(ie,{key:1,type:i(e).data.properties[n.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):g("",!0),t("span",null,b(i(e).data.properties[n.propertyId].name),1)]))),256))])):g("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(i(e).data.properties).length>0?(s(),a("div",Ho,[$(Lo,{filter:o.manager.state.filter,manager:o.manager,parent:p.value},null,8,["filter","manager","parent"])])):g("",!0)],512)]),_:1},512))}});const qo=N(Bo,[["__scopeId","data-v-c6a37a82"]]),Ko=d=>(W("data-v-1d7e82c5"),d=d(),Y(),d),Qo={class:"d-flex flex-row filter-form"},Wo={class:"pt-1 pb-1"},Yo=Ko(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),Xo=P({__name:"FilterForm",props:{manager:de},setup(d){const r=d;return(e,o)=>(s(),a("div",Qo,[t("div",Wo,b(e.$t("main.menu.filters"))+": ",1),$(qo,{manager:r.manager},null,8,["manager"]),$(pe,{manager:r.manager,class:"p-1"},{default:k(()=>[Yo]),_:1},8,["manager"])]))}});const Jo=N(Xo,[["__scopeId","data-v-1d7e82c5"]]),Zo=d=>(W("data-v-e5b49562"),d=d(),Y(),d),ea=Zo(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),ta={class:"p-1"},sa=P({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,o=r,p=x(null);return(v,y)=>(s(),V(Z,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[ea]),popup:k(()=>[t("div",ta,[$(fe,{onSelect:y[0]||(y[0]=h=>{o("select",h),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ve=N(sa,[["__scopeId","data-v-e5b49562"]]),oa={class:"base-hover ps-1 pe-1"},aa={class:"main"},na=["onClick"],la=P({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,o=r,p=Object.values(Me);function v(y){o("update:modelValue",y)}return(y,h)=>(s(),V(Z,null,{button:k(()=>[t("div",oa,b(e.modelValue),1)]),popup:k(({hide:m})=>[t("div",aa,[(s(!0),a(F,null,R(i(p),_=>(s(),a("div",{class:"base-hover option",onClick:n=>{v(_),m()}},b(_),9,na))),256))])]),_:1}))}});const ia=N(la,[["__scopeId","data-v-cc9d0d61"]]),ra=d=>(W("data-v-a27bea28"),d=d(),Y(),d),da=ra(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),pa={class:""},ua={class:"d-flex ipt"},ca={class:"ms-2",min:"1"},_a=P({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,o=r,p=x(1),v=x(Me.Year);function y(){e.option.stepSize==p.value&&e.option.stepUnit==v.value||o("change",{stepSize:p.value,stepUnit:v.value})}function h(){p.value=e.option.stepSize??1,v.value=e.option.stepUnit}return B(()=>e.option,h),oe(h),B(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(m,_)=>(s(),V(Z,{onHide:y},{button:k(()=>[da]),popup:k(({hide:n,focus:l})=>[t("div",pa,[t("div",ua,[t("div",null,[le(t("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=u=>p.value=u)},null,512),[[re,p.value]])]),t("div",ca,[$(ia,{modelValue:v.value,"onUpdate:modelValue":_[1]||(_[1]=u=>v.value=u),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ma=N(_a,[["__scopeId","data-v-a27bea28"]]),va={class:"d-flex flex-row group-form"},ya={class:"pt-1 pb-1"},fa={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},ga={key:0,class:"bi bi-chevron-right smaller"},ha=["onClick"],ba=["onClick"],$a=["onClick"],ka=["onClick"],wa=["onClick"],xa=["onClick"],Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma={key:5,class:"sm-btn"},Va={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Fa=P({__name:"GroupForm",props:{isLoading:Boolean,manager:Ue},setup(d){const r=L(),e=d;function o(n){e.manager.setGroupOption(n),e.manager.update(!0)}function p(n){e.manager.delGroupOption(n),e.manager.update(!0)}function v(n,l){e.manager.setGroupOption(n,{direction:l}),e.manager.sortGroups(!0)}function y(n,l){e.manager.setGroupOption(n,{type:l}),e.manager.sortGroups(!0)}function h(n,l){e.manager.setGroupOption(n,l),e.manager.update(!0)}const m=S(()=>e.manager.state.groupBy.map(n=>r.data.properties[n])),_=S(()=>{const n=[];return e.manager.state.groupBy.forEach(l=>{n.push({option:e.manager.state.options[l],property:r.data.properties[l]})}),n});return(n,l)=>(s(),a("div",va,[t("div",ya,b(n.$t("main.menu.groupby"))+": ",1),m.value.length?(s(),a("div",fa,[(s(!0),a(F,null,R(_.value,(u,c)=>(s(),a(F,null,[c>0?(s(),a("i",ga)):g("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:f=>p(u.property.id)},b(u.property.name),9,ha),u.option.type==i(te).Size?(s(),V(E,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:f=>y(u.property.id,i(te).Property)},null,8,ba)):(s(),a("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:f=>y(u.property.id,i(te).Property)},null,8,$a))]),_:2},1024)):(s(),V(E,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==i(M).number?(s(),a(F,{key:0},[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:f=>y(u.property.id,i(te).Size)},null,8,ka)):(s(),a("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:f=>y(u.property.id,i(te).Size)},null,8,wa))],64)):(s(),a(F,{key:1},[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:f=>y(u.property.id,i(te).Size)},null,8,xa)):(s(),a("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:f=>y(u.property.id,i(te).Size)},null,8,Ia))],64))]),_:2},1024)),u.option.direction==i(J).Ascending?(s(),V(E,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:f=>v(u.property.id,i(J).Descending)},null,8,Sa)]),_:2},1024)):(s(),V(E,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:f=>v(u.property.id,i(J).Ascending)},null,8,Ca)]),_:2},1024)),u.property.type==i(M).date?(s(),a("div",Ma,[$(ma,{option:u.option,onChange:f=>h(u.property.id,f)},null,8,["option","onChange"])])):g("",!0)],64))),256)),e.isLoading?(s(),a("i",Va)):g("",!0)])):g("",!0),$(Ve,{"group-ids":e.manager.state.groupBy,onSelect:l[0]||(l[0]=u=>o(u))},null,8,["group-ids"])]))}});const Ea=N(Fa,[["__scopeId","data-v-3971e969"]]),Pa={class:"d-flex flex-row sort-form"},Ta={class:"pt-1 pb-1"},za={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Oa={key:0,class:"bi bi-chevron-right smaller"},Ga=["onClick"],La=["onClick"],Na=["onClick"],Da=P({__name:"SortForm",props:{manager:je},setup(d){const r=L(),e=d,o=S(()=>e.manager.state.sortBy.map(m=>({propertyId:m,direction:e.manager.state.options[m].direction}))),p=S(()=>o.value.map(m=>m.propertyId));function v(m){e.manager.setSort(m),e.manager.update(!0)}function y(m){e.manager.delSort(m),e.manager.update(!0)}function h(m,_){e.manager.setSort(m,{direction:_}),e.manager.update(!0)}return(m,_)=>(s(),a("div",Pa,[t("div",Ta,b(m.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),a("div",za,[(s(!0),a(F,null,R(o.value,(n,l)=>(s(),a(F,null,[l>0?(s(),a("i",Oa)):g("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>y(n.propertyId)},b(i(r).data.properties[n.propertyId].name),9,Ga),n.direction==i(J).Ascending?(s(),V(E,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>h(n.propertyId,i(J).Descending)},null,8,La)]),_:2},1024)):(s(),V(E,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>h(n.propertyId,i(J).Ascending)},null,8,Na)]),_:2},1024))],64))),256))])):g("",!0),$(Ve,{"group-ids":p.value,onSelect:_[0]||(_[0]=n=>v(n))},null,8,["group-ids"])]))}});const Ra=N(Da,[["__scopeId","data-v-bc2e0a7f"]]),ge=d=>(W("data-v-938d3c79"),d=d(),Y(),d),Ua={class:"d-flex flex-row p-2"},ja=ge(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Aa=["placeholder"],Ha={class:"me-5 d-flex"},Ba=ge(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),qa={class:"ms-5",style:{"font-size":"13px"}},Ka=["checked"],Qa=ge(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),Wa={class:"d-flex flex-wrap content-container ps-2"},Ya=P({__name:"ContentFilter",props:{tab:Ae,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){const e=d,o=x(""),p=S(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),v=S(()=>p.value.length);function y(n){const l=n.target.checked;e.tab.collection.groupManager.setSha1Mode(l,!0)}function h(){o.value=e.tab.state.filterState.query}function m(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function _(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return oe(h),B(()=>e.tab.collection.filterManager.state.query,h),(n,l)=>(s(),a(F,null,[t("div",Ua,[$(E,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:D(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[ja,le(t("input",{type:"text",class:"input-hidden",placeholder:n.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=u=>o.value=u),onChange:m},null,40,Aa),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")],2)]),_:1}),t("div",Ha,[$(E,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:D("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),$(E,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:D("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),$(E,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[Ba]),_:1}),t("div",null,[$(He,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":l[3]||(l[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",qa,[$(E,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:y},null,40,Ka),Qa]),_:1})]),v.value?(s(),V(Be,{key:0,class:"ms-5","selected-images-ids":p.value,"onRemove:selected":l[4]||(l[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):g("",!0)]),t("div",Wa,[$(Jo,{manager:e.tab.collection.filterManager},null,8,["manager"]),$(Ea,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),$(Ra,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Xa=N(Ya,[["__scopeId","data-v-938d3c79"]]),Ja={class:""},Za=["src"],en={class:"d-flex flex-row"},tn=P({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=ye();L();const o=d,p=r,v=S(()=>`width: ${o.size}px; height: ${o.size}px;`),y=S(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),h=S(()=>o.pile.images[0]);return(m,_)=>(s(),a("div",Ja,[$(qe,{image:h.value},{default:k(()=>[t("div",{style:A(v.value),class:"img-container",onClick:_[0]||(_[0]=n=>i(e).showModal(i(se).IMAGE,{image:h.value}))},[t("img",{src:h.value.url,style:A(y.value)},null,12,Za)],4)]),_:1},8,["image"]),t("div",en,[$(E,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:A(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:_[1]||(_[1]=n=>p("accept",h.value))}," ✓ ",4)]),_:1}),$(E,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:A(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:_[2]||(_[2]=n=>p("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const sn=N(tn,[["__scopeId","data-v-1ea540e7"]]),on=d=>(W("data-v-35e00f94"),d=d(),Y(),d),an={class:"reco-container"},nn={class:"d-flex flex-row m-0 ps-2 pb-2"},ln={class:"text-secondary me-2"},rn={class:"flex-grow-1"},dn={class:"d-flex flex-row"},pn={key:0,class:"separator"},un=on(()=>t("i",{class:"bi bi-x"},null,-1)),cn=[un],_n={class:"d-flex flex-row"},me=10,mn=P({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=L(),o=d,p=r,v=x(1),y=ne([]),h=ne([]),m=ne([]),_=ne(new Set);function n(I){let w=h.indexOf(I);w<0||(h.splice(w,1),c())}function l(I){m.forEach(w=>{if(w.value!=We){const T=e.data.properties[w.propertyId];let G=w.value;T.type==M.multi_tags?e.setTagPropertyValue(w.propertyId,I,[G],"add"):e.setPropertyValue(w.propertyId,I,G)}}),n(I.sha1)}function u(I){_.add(I.sha1),n(I.sha1)}function c(){y.length=0;const I=h.map(w=>({sha1:w,images:e.data.sha1Index[w]}));f(I,y,v.value,o.imageSize,o.width)}function f(I,w,T,G,K){let j=K,z=[],O=0;for(let U=0;U<I.length&&!(w.length>=T);U++){let X=I[U];if(_.has(X.sha1))continue;let ce=G+me;if(O+ce<j){z.push(X),O+=ce;continue}if(z.length==0)throw new Error("Images seems to be to big for the line");w.push(z),w.length<T&&(z=[X],O=ce)}z.length>0&&w.length<T&&w.push(z)}async function C(){if(!o.group)return;console.log("get reco");const I=o.group.images.map(K=>K.id);let w=await Ke({instanceIds:I});w.matches.sort((K,j)=>j.score-K.score);const T=Array.from(new Set(w.matches.map(K=>e.data.images[K.id].sha1)));m.length=0;let G=o.group;for(;G;)m.push(...G.meta.propertyValues),G=G.parent;h.length=0,h.push(...T),_.clear(),c(),p("update")}return oe(C),B(()=>o.group,()=>{C(),_.clear()}),B(()=>o.imageSize,c),B(()=>o.width,c),(I,w)=>(s(),a("div",an,[t("div",nn,[$(E,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",ln,b(I.$t("main.recommand.title")),1)]),_:1}),t("div",rn,[t("div",dn,[(s(!0),a(F,null,R(m,(T,G)=>(s(),a(F,null,[$(Qe,{class:"",value:T},null,8,["value"]),G<m.length-1?(s(),a("div",pn)):g("",!0)],64))),256))])]),t("span",{class:"text-secondary scroll ps-1 pe-1 clickable",onClick:w[0]||(w[0]=T=>p("scroll",o.group.id))},b(I.$t("main.recommand.group")),1),t("span",{class:"text-secondary me-1 close ps-1 pe-1 clickable",onClick:w[1]||(w[1]=T=>p("close"))},cn)]),t("div",{style:A("margin-left:"+me+"px;")},[(s(!0),a(F,null,R(y,T=>(s(),a("div",null,[t("div",_n,[(s(!0),a(F,null,R(T,G=>(s(),V(sn,{pile:G,size:o.imageSize,onAccept:l,onRefuse:u,style:A("margin-right:"+me+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const vn=N(mn,[["__scopeId","data-v-35e00f94"]]),yn={key:0,class:"m-0 p-0"},fn={key:0,style:{"margin-left":"10px"}},gn=P({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=L(),e=r.getTabManager(),o=d,p=x({}),v=x(null),y=x(null),h=x(null),m=x([]),_=x(0),n=x(0),l=ne({groups:!1}),u=S(()=>e.getVisibleProperties());function c(){v.value&&y.value?_.value=o.height-v.value.clientHeight-y.value.clientHeight-5:v.value?_.value=o.height-v.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{h.value&&e.state.display=="tree"&&h.value.computeLines()});function f(w){p.value=e.collection.groupManager.result.index[w],ee(()=>c())}async function C(w){w===""?m.value=[]:m.value=await Je({text:w})}function I(){p.value={},ee(()=>c())}return oe(()=>{n.value=v.value.clientWidth,window.addEventListener("resize",()=>{ee(()=>{var w;n.value=((w=v.value)==null?void 0:w.clientWidth)??n.value})})}),B(e.state,w=>{r.updateTab(e.state)},{deep:!0}),B(()=>e.state.imageSize,()=>ee(c)),B(()=>o.height,async()=>{await ee(c)}),(w,T)=>(s(),a(F,null,[t("div",{class:"",ref_key:"filterElem",ref:v},[$(Xa,{tab:i(e),"compute-status":l,onSearchImages:C},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[p.value.id?(s(),a("div",yn,[$(vn,{group:p.value,"image-size":i(e).state.imageSize,width:n.value,height:50,onClose:I,onScroll:h.value.scrollTo,onUpdate:T[0]||(T[0]=G=>ee(()=>c()))},null,8,["group","image-size","width","onScroll"])])):g("",!0)],512),n.value>0&&_.value>0?(s(),a("div",fn,[i(e).state.display=="tree"?(s(),V(Ye,{key:0,"group-manager":i(e).collection.groupManager,"image-size":i(e).state.imageSize,height:_.value-0,properties:u.value,"hide-if-modal":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,width:n.value-25,onRecommend:f},null,8,["group-manager","image-size","height","properties","selected-images","width"])):g("",!0),i(e).state.display=="grid"?(s(),a("div",{key:1,style:A({width:n.value-12+"px"}),class:"p-0 m-0 grid-container"},[$(Xe,{manager:i(e).collection.groupManager,height:_.value-15,width:n.value-40,"selected-properties":u.value,class:"p-0 m-0","show-images":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):g("",!0)])):g("",!0)],64))}});const hn=N(gn,[["__scopeId","data-v-7ec7f905"]]),bn={class:"d-flex d-row",style:{cursor:"pointer"}},$n=["onMouseenter","onMouseleave"],kn=["onClick"],wn=["onClick"],xn=["onClick"],In=["onSubmit"],Sn=["onKeydown","onUpdate:modelValue"],Cn=t("span",{class:"bi bi-plus"},null,-1),Mn=[Cn],Vn={class:"lang"},Fn=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),En=["value"],Pn=P({__name:"TabNav",props:{reRender:Function},setup(d){const r=L(),e=x(-1),o=x(""),p=x(null),v=d;function y(c){r.data.selectedTabId==c||m(),r.selectTab(c)}function h(c){e.value=c,o.value=r.data.tabs[c].name,ee(()=>p.value[0].focus())}function m(){e.value=-1,o.value=""}function _(c){r.addTab("New Tab")}async function n(c){confirm("Are you sure to delete Tab: "+c.name)&&await r.removeTab(c.id)}const l=ne({});x(-1);const u=["fr","en"];return(c,f)=>(s(),a("nav",null,[t("div",bn,[(s(!0),a(F,null,R(i(r).data.tabs,C=>(s(),a("div",{class:"d-flex d-row me-2",onMouseenter:I=>l[C.id]=!0,onMouseleave:I=>l[C.id]=!1},[e.value!=C.id?(s(),a(F,{key:0},[$(E,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:I=>h(C.id),class:D(["bi bi-pencil me-1 tab-icon hover-light",l[C.id]&&i(r).data.selectedTabId==C.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,kn)]),_:2},1024),t("div",{class:D(["tab-button",C.id==i(r).data.selectedTabId?" active":""]),onClick:I=>y(C.id)},[t("span",null,b(C.name),1)],10,wn),$(E,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:I=>n(C),class:D(["btn-icon bi bi-x tab-icon hover-light",l[C.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,xn)]),_:2},1024)],64)):(s(),a("div",{key:1,class:D(["tab-button",C.id==i(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:Se(m,["stop","prevent"])},[le(t("input",{onFocusout:m,onKeydown:Ze(m,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":I=>C.name=I,ref_for:!0,ref_key:"inputElem",ref:p},null,40,Sn),[[re,C.name]])],40,In)],2))],40,$n))),256)),$(E,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_},Mn)]),_:1}),t("div",Vn,[Fn,le(t("select",{"onUpdate:modelValue":f[0]||(f[0]=C=>c.$i18n.locale=C),onChange:f[1]||(f[1]=C=>v.reRender())},[(s(),a(F,null,R(u,(C,I)=>t("option",{key:`Lang${I}`,value:C},b(C.toUpperCase()),9,En)),64))],544),[[et,c.$i18n.locale]])])])]))}});const Fe=d=>(W("data-v-d6013f9a"),d=d(),Y(),d),Tn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},zn={key:0},On={key:1,class:"w-100"},Gn={key:0,class:"custom-hr"},Ln={key:2,class:"loading"},Nn={class:"text-center"},Dn={key:3,class:"loading"},Rn=Fe(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Un=Fe(()=>t("span",{class:"ms-1"},"Loading...",-1)),jn=[Rn,Un],An=P({__name:"PanopticView",setup(d){const r=L(),e=ye(),o=x(null),p=x(null),v=x(window.innerHeight),y=x(!1),h=S(()=>{var c;return v.value-(((c=p.value)==null?void 0:c.clientHeight)??0)}),m=S(()=>{var c;return(c=o.value)==null?void 0:c.filteredImages.map(f=>f.id)});oe(async()=>{e.isProjectLoaded||ke.push("/"),ee(()=>{window.addEventListener("resize",_),_()}),window.addEventListener("keydown",c=>{c.key=="Control"&&(H.ctrl=!0),c.key=="Alt"&&(H.alt=!0),c.key=="Shift"&&(H.shift=!0),c.key=="ArrowLeft"&&(H.left=!0),c.key=="ArrowRight"&&(H.right=!0)}),window.addEventListener("keyup",c=>{c.key=="Control"&&(H.ctrl=!1),c.key=="Alt"&&(H.alt=!1),c.key=="Shift"&&(H.shift=!1),c.key=="ArrowLeft"&&(H.left=!1),c.key=="ArrowRight"&&(H.right=!1)}),window.addEventListener("mousemove",c=>{H.ctrl=c.ctrlKey,H.alt=c.altKey,H.shift=c.shiftKey})}),tt(()=>{window.removeEventListener("resize",_)});function _(){v.value=window.innerHeight,y.value=!0}function n(){e.showModal(se.EXPORT,m)}function l(){r.rerender()}function u(){ke.push("/")}return(c,f)=>(s(),a("div",{id:"panoptic",key:i(r).status.renderNb},[t("div",Tn,[i(r).status.loaded?(s(),a("div",zn,[$(js,{onExport:f[0]||(f[0]=C=>n())})])):g("",!0),i(r).status.loaded?(s(),a("div",On,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[$(Pn,{"re-render":l})],512),y.value?(s(),a("div",Gn)):g("",!0),i(r).status.loaded?(s(),V(hn,{key:1,"tab-id":i(r).data.selectedTabId,height:h.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):g("",!0)])):i(e).isProjectLoaded?(s(),a("div",Dn,jn)):(s(),a("div",Ln,[t("div",Nn,[t("div",null,b(c.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))}});const Bn=N(An,[["__scopeId","data-v-d6013f9a"]]);export{Bn as default};
