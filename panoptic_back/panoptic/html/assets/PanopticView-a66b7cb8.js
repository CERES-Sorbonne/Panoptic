import{d as z,h as G,r as w,c as I,i as se,o as s,a,b as t,w as le,v as re,F,m as U,s as b,y as ie,t as $,k as V,x as k,n as R,D as J,z as Le,_ as D,A as de,B as A,P as S,C as Ge,e as l,E as be,l as f,G as Fe,H as De,I as Ne,S as Re,J as Ue,K as je,L as Ae,p as W,f as Y,N as we,O as P,Q as Ee,q as Q,T as He,R as Pe,U as H,V as ge,W as Ie,u as $e,M as te,g as he,X as Be,Y as qe,Z as Se,$ as Te,a0 as Ke,a1 as ee,a2 as X,a3 as Qe,a4 as We,a5 as Ye,a6 as Xe,a7 as Je,a8 as Ze,a9 as ne,aa as et,ab as tt,ac as Z,ad as st,ae as ot,af as at,ag as nt,j as Ce,ah as B,ai as lt}from"./index-ea6422f7.js";import{_ as it}from"./Tutorial-4af7d63c.js";const rt={class:"mb-1 ps-2 pe-2"},dt=["onClick"],ke=z({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null),y=w(""),h=I(()=>{let _=e.propertyList;return o.ignoreIds&&(_=_.filter(c=>!o.ignoreIds.includes(c.id))),_.filter(c=>c.name.includes(y.value))});return se(()=>v.value.focus()),(_,c)=>(s(),a("div",null,[t("div",rt,[le(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:v,"onUpdate:modelValue":c[0]||(c[0]=i=>y.value=i)},null,512),[[re,y.value]])]),(s(!0),a(F,null,U(h.value,i=>(s(),a("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:n=>p("select",i.id)},[b(ie,{type:i.type,class:"me-2"},null,8,["type"]),t("a",null,$(i.name),1)],8,dt))),256))]))}}),pt=["disabled"],ut={class:"m-0 p-1"},ct=["onClick"],_t=z({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null),y=I(()=>e.data.properties[o.propertyId]),h=I(()=>Le(y.value.type));async function _(c){p("update:modelValue",c),v.value.hide()}return(c,i)=>(s(),V(J,{onHide:i[0]||(i[0]=n=>p("hide")),ref_key:"dropdownElem",ref:v,parent:o.parent},{button:k(()=>[t("div",{class:R(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,$(c.$t("modals.filters.operators."+o.modelValue)),1)],10,pt)]),popup:k(()=>[t("div",ut,[(s(!0),a(F,null,U(h.value,n=>(s(),a("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>_(n)},[t("a",null,$(c.$t("modals.filters.operators."+n)),1)],8,ct))),256))])]),_:1},8,["parent"]))}});const mt=D(_t,[["__scopeId","data-v-aacbd4a2"]]),vt=d=>(W("data-v-71a7cad7"),d=d(),Y(),d),yt={class:"m-0 p-0"},gt={key:1},ft={class:"d-flex mode-header"},ht={class:"me-3"},bt=vt(()=>t("div",{class:"flex-fill"},null,-1)),$t={key:0,class:"me-2",style:{width:"100%"}},kt=z({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=G(),e=d,o=w(null),p=w(null),v=w(null),y=w(0),h=w(null),_=w(null),c=I(()=>e.filterId!==void 0?e.filterId:h.value),i=I(()=>{if(!(c.value==null||c.value==-1))return e.manager.filterIndex[c.value]}),n=I(()=>i.value==null?void 0:r.data.properties[i.value.propertyId]);function u(){y.value=e.mode,e.mode==2&&e.filterId==null&&L(e.propertyId)}function m(){o.value&&o.value.hide()}function g(){y.value=0}function x(){m(),e.manager.deleteFilter(c.value),e.manager.update(!0)}function L(T){let M=e.manager.addNewFilter(T,e.parentId);e.manager.update(!0),h.value=M.id,y.value=2}function K(T){_.value=null,e.manager.updateFilter(c.value,{operator:T}),e.manager.update(!0),p.value&&p.value.focus()}function ae(){console.log("update value",_.value),e.manager.updateFilter(c.value,{value:_.value}),e.manager.update(!0)}function O(){if(!i.value)return;const T=r.data.properties[i.value.propertyId];if(je(T.type))return;const M=_.value??Ae(T.type);i.value.value!=M&&ae()}function C(){i.value&&(r.data.properties[i.value.propertyId].type==S.date&&i.value.value?_.value=new Date(i.value.value):_.value=i.value.value)}return se(C),A(()=>i.value,()=>C()),(T,M)=>(s(),V(J,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:g,parent:e.parent},{button:k(()=>[t("div",yt,[Ge(T.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[y.value!=0?(s(),a(F,{key:0},[y.value==1?(s(),V(ke,{key:0,onSelect:L,"ignore-ids":[l(be).folders]},null,8,["ignore-ids"])):f("",!0),y.value==2?(s(),a("div",gt,[t("div",ft,[t("div",ht,$(n.value.name),1),b(mt,{"property-id":i.value.propertyId,"model-value":i.value.operator,"onUpdate:modelValue":K,parent:v.value},null,8,["property-id","model-value","parent"]),bt,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:x})])]),l(Fe)(i.value.operator)?(s(),a("div",$t,[n.value.type==l(S).multi_tags||n.value.type==l(S).tag?(s(),V(De,{key:0,modelValue:_.value,"onUpdate:modelValue":[M[0]||(M[0]=E=>_.value=E),ae],"auto-focus":!0,property:l(r).data.properties[i.value.propertyId],ref_key:"inputElem",ref:p,onHide:m},null,8,["modelValue","property"])):n.value.type==l(S).color?(s(),V(Ne,{key:1,property:n.value,modelValue:_.value,"onUpdate:modelValue":[M[1]||(M[1]=E=>_.value=E),M[2]||(M[2]=()=>{m(),O()})]},null,8,["property","modelValue"])):n.value.type==l(S).date?(s(),V(Re,{key:2,property:n.value,modelValue:_.value,"onUpdate:modelValue":[M[3]||(M[3]=E=>_.value=E),M[4]||(M[4]=()=>{m(),O()})]},null,8,["property","modelValue"])):(s(),V(Ue,{key:3,"no-html":!0,modelValue:_.value,"onUpdate:modelValue":M[5]||(M[5]=E=>_.value=E),width:-1,"min-height":20,"no-nl":l(r).data.properties[i.value.propertyId].type==l(S).number,"url-mode":l(r).data.properties[i.value.propertyId].type==l(S).url,"only-number":l(r).data.properties[i.value.propertyId].type==l(S).number,onBlur:O,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):f("",!0)])):f("",!0)],64)):f("",!0)],512)]),_:3},8,["parent"]))}});const ue=D(kt,[["__scopeId","data-v-71a7cad7"]]),oe=d=>(W("data-v-12268ff8"),d=d(),Y(),d),xt={class:"d-flex flex-row"},wt={key:1,class:"d-flex",style:{width:"150px"}},It={class:"flex-grow-1"},St={key:1,style:{"padding-top":"1px"}},Ct={style:{width:"20px","margin-top":"2px"},class:"text-center"},Mt=oe(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),Vt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Ft=oe(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Et=oe(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Pt={key:0,class:"ms-3 pt-1"},Tt=oe(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),zt=oe(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Ot=oe(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Lt=oe(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Gt={key:1},Dt=z({__name:"PropertyOptions",props:{property:Object},setup(d){const r=G(),e=r.getTabManager(),o=d,p=w(!1),v=w(!1),y=w(""),h=w(!1),_=I(()=>r.getTab()),c=I(()=>_.value.visibleProperties[o.property.id]==!0),i=I(()=>e.collection.filterManager.state.filter.filters.some(E=>!E.isGroup&&E.propertyId==o.property.id)),n=I(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),u=I(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),m=I(()=>{if(i.value)return e.collection.filterManager.state.filter.filters.find(E=>!E.isGroup&&E.propertyId==o.property.id).id}),g=()=>e.collection.filterManager,x=I(()=>e.getSha1Mode());function L(){c.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function K(){p.value?p.value=!1:(p.value=!0,y.value=o.property.name),v.value=!1}function ae(){o.property.type!=S.tag&&o.property.type!=S.multi_tags||(v.value?v.value=!1:v.value=!0,p.value=!1)}function O(){u.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function C(){n.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function T(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&r.deleteProperty(o.property.id)}async function M(){y.value!=""&&(await r.updateProperty(o.property.id,y.value),K())}return A(()=>o.property,()=>{p.value=!1}),(E,N)=>(s(),a("div",{class:R(h.value?"hover-light":"")},[t("div",xt,[p.value?f("",!0):(s(),a("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[b(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:N[0]||(N[0]=j=>h.value=!0),onMouseleave:N[1]||(N[1]=j=>h.value=!1)},null,8,["type"]),t("span",null,$(o.property.name),1)])),p.value?(s(),a("div",wt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:N[2]||(N[2]=j=>h.value=!0),onMouseleave:N[3]||(N[3]=j=>h.value=!1)},null,32)]),t("div",It,[o.property.id>=0?le((s(),a("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":N[4]||(N[4]=j=>y.value=j),onChange:M},null,544)),[[re,y.value]]):(s(),a("span",St,[b(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,$(o.property.name),1)]))])])):f("",!0),t("div",Ct,[o.property.mode==l(we).id?(s(),V(P,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[Mt]),_:1})):f("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:L,class:"btn-icon text-center"},[x.value&&o.property.mode==l(we).id?(s(),V(P,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:N[5]||(N[5]=Ee(()=>{},["stop"]))})]),_:1})):(s(),V(P,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:R("bi bi-eye text-"+(c.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",Vt,[o.property.type==l(S).tag||o.property.type==l(S).multi_tags?(s(),a("div",{key:0,onClick:ae,style:{cursor:"pointer"}},[v.value?(s(),V(P,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Ft]),_:1})):(s(),V(P,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Et]),_:1}))])):f("",!0)])]),t("div",null,[p.value?(s(),a("div",Pt,[t("div",{class:R(["options hover-light",i.value?" text-primary":""])},[b(ue,{manager:g(),"filter-id":m.value,mode:2,"property-id":d.property.id},{default:k(()=>[Tt,Q($(E.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:R(["options hover-light",u.value?" text-primary":""]),onClick:O},[zt,Q($(E.$t("main.menu.sort.title")),1)],2),t("div",{class:R(["options hover-light",n.value?" text-primary":""]),onClick:C},[Ot,Q($(E.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),a("div",{key:0,class:"options hover-light",onClick:T},[Lt,Q($(E.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):v.value?(s(),a("div",Gt,[b(He,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])],2))}});const Me=D(Dt,[["__scopeId","data-v-12268ff8"]]),Nt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Rt={class:"p-2"},Ut=["onClick"],jt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),At=z({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=G(),e=d;function o(){r.reImportFolder(e.folder.id)}return(p,v)=>(s(),V(J,{teleport:!0},{button:k(()=>[Nt]),popup:k(({hide:y})=>[t("div",Rt,[t("div",{class:"base-hover p-1",onClick:h=>{o(),y()}},[jt,Q(" Re import")],8,Ut)])]),_:1}))}}),Ht=["onMouseenter"],Bt=["onClick"],qt={class:"text-secondary"},Kt=["onClick"],Qt=z({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(d){const r=G(),e=d,o=w(null),p=I(()=>{let i={};const n=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{n.has(u)&&(i[u]=!0)}),i}),v=I(()=>{let i={};return e.folders.map(n=>n.id).forEach(n=>{e.visibleFolders[n]&&(i[n]=!0)}),i}),y=I(()=>{let i={};return e.folders.forEach(n=>{let u=[];p.value[n.id]&&u.push("selected"),i[n.id]=u.join(" ")}),i});function h(i){let n=e.visibleFolders;n[i]?delete n[i]:n[i]=!0}function _(i){let n=new Set(e.filterManager.state.folders);const u=n.has(i),m=r.data.folders[i].parent!=null&&n.has(r.data.folders[i].parent);u&&!m?(n.delete(i),ge(i).forEach(g=>n.delete(g.id))):(c(i,n),n.add(i),ge(i).forEach(g=>n.add(g.id)),Ie(r.data.folders[i]).forEach(g=>n.delete(g.id))),e.filterManager.setFolders(Array.from(n)),e.filterManager.update(!0)}function c(i,n){const u=Ie(r.data.folders[i]);let m;for(let g of u)if(n.has(g.id))m=g;else break;m!=null&&ge(m.id).forEach(g=>n.delete(g.id))}return(i,n)=>{const u=Pe("FolderList2",!0);return s(),a("ul",{class:R(e.root?"tree":""),style:H(e.root?"padding-left:0px;":"")},[(s(!0),a(F,null,U(d.folders,m=>(s(),a("li",{style:H(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:g=>o.value=m.id,onMouseleave:n[0]||(n[0]=g=>o.value=null)},[t("summary",{class:R(y.value[m.id]),onClick:g=>_(m.id)},[Q($(m.name)+" ",1),t("span",qt,$(m.count),1)],10,Bt),m.children&&m.children.length>0?(s(),a("i",{key:0,onClick:g=>h(m.id),class:R("bi bi-chevron-"+(v.value[m.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Kt)):f("",!0),t("span",{class:R(o.value===m.id?"visible-option":"invisible-option")},[b(At,{folder:m,style:{display:"inline-block"}},null,8,["folder"])],2),m.children&&m.children.length>0&&v.value[m.id]?(s(),V(u,{key:1,folders:m.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,Ht))),256))],6)}}});const Wt=D(Qt,[["__scopeId","data-v-8463ee59"]]),Yt={class:"text-center"},Xt={class:"w-100 text-center",style:{"font-size":"10px"}},Jt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Zt=z({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=I(()=>r.task.total-r.task.remain-r.task.computing),o=I(()=>r.task.total);return(p,v)=>(s(),a("div",Yt,[Q($(r.task.name)+" ",1),t("div",Xt,$(e.value)+" / "+$(o.value)+" "+$(p.$t("main.nav.tasks.done")),1),o.value>0?(s(),a("div",Jt,[t("div",{class:"progress-bar",style:H(`width: ${e.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),q=d=>(W("data-v-2c6f22bc"),d=d(),Y(),d),es={class:"menu overflow-scroll"},ts={class:""},ss={class:"m-0",style:{padding:"4px 0px 4px 8px"}},os={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},as=q(()=>t("i",{class:"bi bi-gear"},null,-1)),ns=[as],ls=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),is=[ls],rs=q(()=>t("div",{class:"custom-hr"},null,-1)),ds={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ps={class:"d-flex align-items-center"},us=q(()=>t("i",{class:"bi bi-plus"},null,-1)),cs={class:"overflow-scroll"},_s={key:0,id:"import"},ms=q(()=>t("div",{class:"custom-hr"},null,-1)),vs={class:"pt-1 pb-2"},ys={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},gs=q(()=>t("div",{class:"custom-hr"},null,-1)),fs={key:0,class:"ps-2 pe-2"},hs={class:"p-1"},bs={key:0,class:"custom-hr"},$s={key:1,class:"p-2"},ks=q(()=>t("div",{class:"custom-hr"},null,-1)),xs={key:0,class:"float-end"},ws={class:"text-center"},Is={class:"w-100 text-center",style:{"font-size":"10px"}},Ss={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Cs={key:2,class:"p-2"},Ms={class:"w-100 text-center",style:{"font-size":"10px"}},Vs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Fs=q(()=>t("div",{class:"custom-hr"},null,-1)),Es={class:"p-2 mt-0"},Ps={class:"d-flex"},Ts=q(()=>t("span",{class:"flex-grow-1"},null,-1)),zs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Os=q(()=>t("span",{class:"sr-only"},null,-1)),Ls=[Os],Gs={key:1,class:"bb me-1"},Ds={class:"bb me-2"},Ns={key:0,class:"mt-2"},Rs={key:0,class:"property-item"},Us=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),js=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),As=q(()=>t("div",{class:"custom-hr"},null,-1)),Hs={class:"p-2 mt-0"},Bs={key:0,class:"mt-2"},qs={key:0,class:"property-item"},Ks=z({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=G(),o=$e(),p=e.getTabManager(),v=w(!1);w(null);const y=w(!1),h=async n=>{o.showModal(te.IMPORT)},_=I(()=>e.backendStatus.tasks.filter(n=>!(n.name=="Load Plugin"&&n.done)));function c(){o.showModal(te.FOLDERSELECTION,{callback:i,mode:"images"})}function i(n){n&&e.addFolder(n)}return A(()=>e.status.import.to_import,()=>v.value=!0),(n,u)=>{var m;return s(),a("div",es,[t("div",ts,[t("div",null,[t("div",ss,[t("div",os,[t("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},$((m=l(o).data.status.selectedProject)==null?void 0:m.name),1),t("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=g=>l(o).showModal(l(te).SETTINGS))},ns),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=g=>l(o).closeProject())},is)])]),rs,t("div",ds,[t("div",ps,[t("div",null,[t("b",null,$(n.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:u[3]||(u[3]=g=>{c(),l(he)()})},[b(P,{message:"main.nav.folders.add"},{default:k(()=>[us]),_:1})])]),t("div",cs,[l(e).getTab()?(s(),V(Wt,{key:0,folders:l(e).folderRoots,"filter-manager":l(p).collection.filterManager,"visible-folders":l(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):f("",!0)])]),_.value&&_.value.length?(s(),a("div",_s,[ms,t("div",vs,[t("div",ys,[t("div",null,[t("b",null,$(n.$t("main.nav.tasks.title")),1)])]),gs,l(e).backendStatus?(s(),a("div",fs,[(s(!0),a(F,null,U(_.value,(g,x)=>(s(),a("div",hs,[x?(s(),a("div",bs)):f("",!0),b(Zt,{task:g},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&v.value?(s(),a("div",$s,[ks,l(e).status.import.done?(s(),a("div",xs,[t("i",{class:"bi bi-x base-hover",onClick:u[4]||(u[4]=g=>v.value=!1)})])):f("",!0),t("div",ws,[t("b",null,$(n.$t("main.menu.import_status_title")),1)]),t("div",Is,$(l(e).status.import.imported)+" / "+$(l(e).status.import.to_import)+" importées ",1),l(e).status.import.to_import>0?(s(),a("div",Ss,[t("div",{class:"progress-bar",style:H(`width: ${l(e).status.import.imported/l(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&v.value?(s(),a("div",Cs,[t("div",Ms,$(l(e).status.import.computed)+" / "+$(l(e).status.import.to_import)+" computed ",1),l(e).status.import.to_import>0?(s(),a("div",Vs,[t("div",{class:"progress-bar",style:H(`width: ${l(e).status.import.computed/l(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),Fs,t("div",Es,[t("div",Ps,[b(P,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,$(n.$t("main.nav.properties.title")),1)]),_:1}),Ts,y.value?(s(),a("span",zs,Ls)):(s(),a("span",Gs,[b(P,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h})]),_:1})])),t("span",Ds,[b(P,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u[5]||(u[5]=g=>l(o).showModal(l(te).EXPORT,void 0))})]),_:1})])]),l(e).status.loaded?(s(),a("div",Ns,[(s(!0),a(F,null,U(l(e).data.properties,g=>(s(),a(F,null,[g.id>=0?(s(),a("div",Rs,[b(Me,{property:g},null,8,["property"])])):f("",!0)],64))),256)),Us,t("div",{id:"add-property",onClick:u[6]||(u[6]=g=>{l(o).showModal(l(te).PROPERTY,void 0),l(he)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[js,t("span",null,$(n.$t("main.nav.properties.add_property")),1)])])):f("",!0)]),As,t("div",Hs,[b(P,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,$(n.$t("main.nav.computed.title")),1)]),_:1}),l(e).status.loaded?(s(),a("div",Bs,[(s(!0),a(F,null,U(l(e).data.properties,g=>(s(),a(F,null,[g.id<0?(s(),a("div",qs,[b(P,{pos:"bottom",message:"main.nav.computed."+Math.abs(g.id).toString()+"_tooltip"},{default:k(()=>[b(Me,{property:g},null,8,["property"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])])}}});const Qs=D(Ks,[["__scopeId","data-v-2c6f22bc"]]),Ws={class:"text-nowrap text-secondary"},Ve=z({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=G(),e=d,o=I(()=>r.data.properties[e.propertyId].tags);return(p,v)=>(s(),a("div",Ws,[e.value&&e.value.length>0?(s(!0),a(F,{key:0},U(e.value,y=>(s(),a("span",null,[b(Be,{tag:o.value[y].value,color:o.value[y].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),a(F,{key:1},[Q(" Add Tags... ")],64))]))}}),Ys={key:0},Xs={key:1},Js={key:2},Zs={key:3},eo={key:0,class:"bi bi-square"},to={key:1,class:"bi bi-check-square"},so={key:5},oo={key:6},ao={key:7},no={key:8},lo={key:9},io={key:10},ro={key:11},po={key:12},uo={key:13},co={key:1,class:"text-secondary"},_o=z({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=I(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":qe[p].color}),o=I(()=>[S._ahash,S._folders,S._sha1,S.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,v)=>d.value!=null?(s(),a(F,{key:0},[r.property.type==l(S)._ahash?(s(),a("div",Ys,$(o.value),1)):f("",!0),r.property.type==l(S)._folders?(s(),a("div",Xs,$(o.value),1)):f("",!0),r.property.type==l(S)._sha1?(s(),a("div",Js,$(o.value),1)):f("",!0),r.property.type==l(S).checkbox?(s(),a("div",Zs,[o.value?(s(),a("i",eo)):(s(),a("i",to))])):f("",!0),r.property.type==l(S).color?(s(),a("div",{key:4,style:H({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):f("",!0),r.property.type==l(S).date?(s(),a("div",so,$(o.value),1)):f("",!0),r.property.type==l(S).image_link?(s(),a("div",oo)):f("",!0),r.property.type==l(S).multi_tags?(s(),a("div",ao,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==l(S).number?(s(),a("div",no,$(o.value),1)):f("",!0),r.property.type==l(S).path?(s(),a("div",lo,$(o.value),1)):f("",!0),r.property.type==l(S).string?(s(),a("div",io,$(o.value),1)):f("",!0),r.property.type==l(S)._id||r.property.type==l(S)._height||r.property.type==l(S)._width?(s(),a("div",ro,$(o.value),1)):f("",!0),r.property.type==l(S).tag?(s(),a("div",po,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==l(S).url?(s(),a("div",uo,$(o.value),1)):f("",!0)],64)):(s(),a("span",co,"..."))}}),mo={class:"d-flex bb ps-1 overflow-hidden"},vo={class:"m-0 p-0 me-2 text-nowrap"},yo={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},go=z({__name:"FilterPreview",props:{filter:Object},setup(d){const r=G(),e=d,o=I(()=>r.data.properties[e.filter.propertyId]);return(p,v)=>(s(),a("td",mo,[t("div",vo,$(p.$t("modals.filters.operators."+e.filter.operator)),1),l(Fe)(e.filter.operator)?(s(),a("div",yo,[b(_o,{property:o.value,value:e.filter.value},null,8,["property","value"])])):f("",!0)]))}});const fo=D(go,[["__scopeId","data-v-718bc241"]]),ho={class:"m-0 bb",style:{}},bo={class:"p-2"},$o=z({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null);function y(h){v.value.hide(),p("update:modelValue",e.data.properties[h])}return(h,_)=>(s(),V(J,{ref_key:"dropdownElem",ref:v,"auto-focus":!1},{button:k(()=>[t("div",ho,[b(ie,{type:o.modelValue.type},null,8,["type"]),Q(" "+$(o.modelValue.name),1)])]),popup:k(()=>[t("div",bo,[b(ke,{modelValue:o.modelValue,"onUpdate:modelValue":_[0]||(_[0]=c=>o.modelValue=c),onSelect:y,"ignore-ids":[l(be).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ce=d=>(W("data-v-64496007"),d=d(),Y(),d),ko={class:"filter-group"},xo={class:"table table-sm"},wo={class:"align-top p-0 m-0"},Io={key:0,class:"m-0 p-0"},So={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Co={class:""},Mo=["onClick"],Vo=ce(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Fo={key:2,class:"text-secondary"},Eo={key:0,class:"p-0 m-0 ps-2"},Po={key:1,class:"p-0 m-0 ps-2"},To={class:"border rounded"},zo={class:""},Oo=["onClick"],Lo=ce(()=>t("i",{class:"bi bi-trash"},null,-1)),Go=[Lo],Do={class:"d-flex text-secondary ms-2"},No={class:"add-options hover-light"},Ro=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),Uo=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),jo=z({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=G(),o=d,p=I(()=>o.filter),v=I(()=>p.value.filters),y=I(()=>{let n=255-(p.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function h(n,u){o.manager.updateFilter(n,{propertyId:u}),o.manager.update(!0)}function _(n){o.manager.deleteFilter(n.id),o.manager.update(!0)}function c(n){o.manager.addNewFilterGroup(n),o.manager.update(!0)}function i(n,u){o.manager.updateFilterGroup(n,u),o.manager.update(!0)}return(n,u)=>{const m=Pe("FilterGroupInput",!0);return s(),a("div",ko,[t("table",xo,[(s(!0),a(F,null,U(v.value,(g,x)=>(s(),a("tr",null,[t("td",wo,[x==0?(s(),a("div",Io,$(n.$t("modals.filters.where")),1)):x==1?(s(),V(J,{key:1},{button:k(()=>[t("div",So,[t("span",Co,$(n.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:L})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:L},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=K=>i(p.value.id,l(Se).and))},$(n.$t("modals.filters.and")),1),Vo,t("div",{class:"base-btn",onClick:u[1]||(u[1]=K=>i(p.value.id,l(Se).or))},$(n.$t("modals.filters.or")),1)],8,Mo)]),_:1})):(s(),a("span",Fo,$(p.value.groupOperator),1))]),g.propertyId!==void 0?(s(),a("td",Eo,[b($o,{"model-value":l(e).data.properties[g.propertyId],"onUpdate:modelValue":L=>h(g.id,L.id)},null,8,["model-value","onUpdate:modelValue"])])):f("",!0),g.propertyId!==void 0?(s(),a("td",Po,[b(ue,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":g.id,parent:o.parent},{default:k(()=>[b(fo,{filter:g},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),a("td",{key:2,colspan:"3",style:H(y.value)},[t("div",To,[b(m,{filter:g,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",zo,[t("span",{class:"base-btn",onClick:L=>_(g)},Go,8,Oo)])]))),256))]),t("div",Do,[b(ue,{manager:o.manager,"parent-id":p.value.id},{default:k(()=>[t("div",No,[Ro,Q($(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=g=>c(p.value.id))},[Uo,Q($(n.$t("modals.filters.new_group")),1)])])])}}});const Ao=D(jo,[["__scopeId","data-v-64496007"]]),Ho=d=>(W("data-v-408ec377"),d=d(),Y(),d),Bo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},qo={key:0},Ko=Ho(()=>t("span",{class:"text-primary"},"Text Query",-1)),Qo={key:0,class:"or-separator"},Wo={key:0,class:"or-separator"},Yo={key:0,class:"m-1 p-0"},Xo=z({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=w(null),v=w(null),y=I(()=>{let _=h(o.manager.state.filter),c={};return _.forEach(i=>c[i.propertyId]=i),Object.values(c)});function h(_){let c=[];for(let i of _.filters)i.isGroup?c.push(...h(i)):c.push(i);return c}return A(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&v.value.hide()}),(_,c)=>(s(),V(J,{ref_key:"dropdownElem",ref:v},{button:k(()=>[t("div",null,[y.value.length||o.manager.state.query?(s(),a("div",Bo,[o.manager.state.query?(s(),a("div",qo,[Ko,y.value.length?(s(),a("span",Qo,"|")):f("",!0)])):f("",!0),(s(!0),a(F,null,U(y.value,(i,n)=>(s(),a("div",null,[n>0?(s(),a("span",Wo,"|")):f("",!0),i.propertyId==l(be).id?(s(),V(ie,{key:1,type:l(e).data.properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),t("span",null,$(l(e).data.properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(l(e).data.properties).length>0?(s(),a("div",Yo,[b(Ao,{filter:o.manager.state.filter,manager:o.manager,parent:p.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const Jo=D(Xo,[["__scopeId","data-v-408ec377"]]),Zo=d=>(W("data-v-2996f7ff"),d=d(),Y(),d),ea={class:"d-flex flex-row filter-form"},ta={class:"pt-1 pb-1"},sa=Zo(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),oa=z({__name:"FilterForm",props:{manager:de},setup(d){const r=d;return(e,o)=>(s(),a("div",ea,[t("div",ta,$(e.$t("main.menu.filters"))+": ",1),b(Jo,{manager:r.manager},null,8,["manager"]),b(ue,{manager:r.manager,class:"p-1"},{default:k(()=>[sa]),_:1},8,["manager"])]))}});const aa=D(oa,[["__scopeId","data-v-2996f7ff"]]),na=d=>(W("data-v-6c4310e6"),d=d(),Y(),d),la=na(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),ia={class:"p-1"},ra=z({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,o=r,p=w(null);return(v,y)=>(s(),V(J,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[la]),popup:k(()=>[t("div",ia,[b(ke,{onClick:y[0]||(y[0]=h=>l(he)()),onSelect:y[1]||(y[1]=h=>{o("select",h),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const ze=D(ra,[["__scopeId","data-v-6c4310e6"]]),da={class:"base-hover ps-1 pe-1"},pa={class:"main"},ua=["onClick"],ca=z({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,o=r,p=Object.values(Te);function v(y){o("update:modelValue",y)}return(y,h)=>(s(),V(J,null,{button:k(()=>[t("div",da,$(e.modelValue),1)]),popup:k(({hide:_})=>[t("div",pa,[(s(!0),a(F,null,U(l(p),c=>(s(),a("div",{class:"base-hover option",onClick:i=>{v(c),_()}},$(c),9,ua))),256))])]),_:1}))}});const _a=D(ca,[["__scopeId","data-v-ce3e3774"]]),ma=d=>(W("data-v-78b647dc"),d=d(),Y(),d),va=ma(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ya={class:""},ga={class:"d-flex ipt"},fa={class:"ms-2",min:"1"},ha=z({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,o=r,p=w(1),v=w(Te.Year);function y(){e.option.stepSize==p.value&&e.option.stepUnit==v.value||o("change",{stepSize:p.value,stepUnit:v.value})}function h(){p.value=e.option.stepSize??1,v.value=e.option.stepUnit}return A(()=>e.option,h),se(h),A(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(_,c)=>(s(),V(J,{onHide:y},{button:k(()=>[va]),popup:k(({hide:i,focus:n})=>[t("div",ya,[t("div",ga,[t("div",null,[le(t("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=u=>p.value=u)},null,512),[[re,p.value]])]),t("div",fa,[b(_a,{modelValue:v.value,"onUpdate:modelValue":c[1]||(c[1]=u=>v.value=u),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ba=D(ha,[["__scopeId","data-v-78b647dc"]]),$a={class:"d-flex flex-row group-form"},ka={class:"pt-1 pb-1"},xa={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},wa={key:0,class:"bi bi-chevron-right smaller"},Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa=["onClick"],Ea=["onClick"],Pa=["onClick"],Ta=["onClick"],za={key:5,class:"sm-btn"},Oa={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},La=z({__name:"GroupForm",props:{isLoading:Boolean,manager:Ke},setup(d){const r=G(),e=d;function o(i){e.manager.setGroupOption(i),e.manager.update(!0)}function p(i){e.manager.delGroupOption(i),e.manager.update(!0)}function v(i,n){e.manager.setGroupOption(i,{direction:n}),e.manager.sortGroups(!0)}function y(i,n){e.manager.setGroupOption(i,{type:n}),e.manager.sortGroups(!0)}function h(i,n){e.manager.setGroupOption(i,n),e.manager.update(!0)}const _=I(()=>e.manager.state.groupBy.map(i=>r.data.properties[i])),c=I(()=>{const i=[];return e.manager.state.groupBy.forEach(n=>{i.push({option:e.manager.state.options[n],property:r.data.properties[n]})}),i});return(i,n)=>(s(),a("div",$a,[t("div",ka,$(i.$t("main.menu.groupby"))+": ",1),_.value.length?(s(),a("div",xa,[(s(!0),a(F,null,U(c.value,(u,m)=>(s(),a(F,null,[m>0?(s(),a("i",wa)):f("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:g=>p(u.property.id),id:"remove-group-button"},$(u.property.name),9,Ia),u.option.type==l(ee).Size?(s(),V(P,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Property)},null,8,Sa)):(s(),a("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:g=>y(u.property.id,l(ee).Property)},null,8,Ca))]),_:2},1024)):(s(),V(P,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==l(S).number?(s(),a(F,{key:0},[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Ma)):(s(),a("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Va))],64)):(s(),a(F,{key:1},[u.option.direction==l(X).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Fa)):(s(),a("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Ea))],64))]),_:2},1024)),u.option.direction==l(X).Ascending?(s(),V(P,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:g=>v(u.property.id,l(X).Descending)},null,8,Pa)]),_:2},1024)):(s(),V(P,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:g=>v(u.property.id,l(X).Ascending)},null,8,Ta)]),_:2},1024)),u.property.type==l(S).date?(s(),a("div",za,[b(ba,{option:u.option,onChange:g=>h(u.property.id,g)},null,8,["option","onChange"])])):f("",!0)],64))),256)),e.isLoading?(s(),a("i",Oa)):f("",!0)])):f("",!0),b(ze,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:n[0]||(n[0]=u=>o(u))},null,8,["group-ids"])]))}});const Ga=D(La,[["__scopeId","data-v-a81aec71"]]),Da={class:"d-flex flex-row sort-form"},Na={class:"pt-1 pb-1"},Ra={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ua={key:0,class:"bi bi-chevron-right smaller"},ja=["onClick"],Aa=["onClick"],Ha=["onClick"],Ba=z({__name:"SortForm",props:{manager:Qe},setup(d){const r=G(),e=d,o=I(()=>e.manager.state.sortBy.map(_=>({propertyId:_,direction:e.manager.state.options[_].direction}))),p=I(()=>o.value.map(_=>_.propertyId));function v(_){e.manager.setSort(_),e.manager.update(!0)}function y(_){e.manager.delSort(_),e.manager.update(!0)}function h(_,c){e.manager.setSort(_,{direction:c}),e.manager.update(!0)}return(_,c)=>(s(),a("div",Da,[t("div",Na,$(_.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),a("div",Ra,[(s(!0),a(F,null,U(o.value,(i,n)=>(s(),a(F,null,[n>0?(s(),a("i",Ua)):f("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>y(i.propertyId)},$(l(r).data.properties[i.propertyId].name),9,ja),i.direction==l(X).Ascending?(s(),V(P,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>h(i.propertyId,l(X).Descending)},null,8,Aa)]),_:2},1024)):(s(),V(P,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>h(i.propertyId,l(X).Ascending)},null,8,Ha)]),_:2},1024))],64))),256))])):f("",!0),b(ze,{"group-ids":p.value,onSelect:c[0]||(c[0]=i=>v(i))},null,8,["group-ids"])]))}});const qa=D(Ba,[["__scopeId","data-v-fea1308e"]]),xe=d=>(W("data-v-ce27c1c0"),d=d(),Y(),d),Ka={class:"d-flex flex-row p-2"},Qa=xe(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Wa=["placeholder"],Ya={class:"me-5 d-flex"},Xa=xe(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Ja={class:"ms-5",style:{"font-size":"13px"}},Za=["checked"],en=xe(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),tn={class:"d-flex flex-wrap content-container ps-2"},sn=z({__name:"ContentFilter",props:{tab:We,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){const e=d,o=w(""),p=I(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),v=I(()=>p.value.length);function y(i){const n=i.target.checked;e.tab.collection.groupManager.setSha1Mode(n,!0)}function h(){o.value=e.tab.state.filterState.query}function _(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function c(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return se(h),A(()=>e.tab.collection.filterManager.state.query,h),(i,n)=>(s(),a(F,null,[t("div",Ka,[b(P,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:R(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[Qa,le(t("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=u=>o.value=u),onChange:_},null,40,Wa),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:c},"x")],2)]),_:1}),t("div",Ya,[b(P,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:R("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),b(P,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:R("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),b(P,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[Xa]),_:1}),t("div",null,[b(Ye,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":n[3]||(n[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",Ja,[b(P,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:y},null,40,Za),en]),_:1})]),v.value?(s(),V(Xe,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":n[4]||(n[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0)]),t("div",tn,[b(aa,{manager:e.tab.collection.filterManager},null,8,["manager"]),b(Ga,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),b(qa,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const on=D(sn,[["__scopeId","data-v-ce27c1c0"]]),an={class:""},nn=["src"],ln={class:"d-flex flex-row"},rn=z({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=$e();G();const o=d,p=r,v=I(()=>`width: ${o.size}px; height: ${o.size}px;`),y=I(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),h=I(()=>o.pile.images[0]);return(_,c)=>(s(),a("div",an,[b(Je,{image:h.value},{default:k(()=>[t("div",{style:H(v.value),class:"img-container",onClick:c[0]||(c[0]=i=>l(e).showModal(l(te).IMAGE,{image:h.value}))},[t("img",{src:h.value.url,style:H(y.value)},null,12,nn)],4)]),_:1},8,["image"]),t("div",ln,[b(P,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:c[1]||(c[1]=i=>p("accept",h.value))}," ✓ ",4)]),_:1}),b(P,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:c[2]||(c[2]=i=>p("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const dn=D(rn,[["__scopeId","data-v-1cd7ace4"]]),pe=d=>(W("data-v-8d3876ca"),d=d(),Y(),d),pn={class:"reco-container"},un={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},cn=pe(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),_n=[cn],mn=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),vn=pe(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),yn=[vn],gn=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),fn={key:0,class:"bi bi-funnel-fill bb text-primary"},hn={key:1,class:"bi bi-funnel bb"},bn=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),$n={class:"text-secondary me-2"},kn={class:"flex-grow-1"},xn={class:"d-flex flex-row"},wn={key:0,class:"separator"},In={class:"d-flex flex-row"},fe=10,Sn=z({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=G(),o=Ze(),p=d,v=r,y=w(1),h=ne([]),_=ne([]),c=ne([]),i=ne(new Set),n=w(!0);function u(O){let C=_.indexOf(O);C<0||(_.splice(C,1),x())}function m(O){console.log(c),c.forEach(C=>{if(console.log(C.value),C.value!=tt){const T=e.data.properties[C.propertyId];let M=C.value;console.log(T.type),T.type==S.multi_tags?e.setTagPropertyValue(C.propertyId,O,[M],"add"):T.type==S.tag?e.setPropertyValue(C.propertyId,O,[M]):e.setPropertyValue(C.propertyId,O,M)}}),u(O.sha1)}function g(O){i.add(O.sha1),u(O.sha1)}function x(){h.length=0;const O=_.map(C=>({sha1:C,images:e.data.sha1Index[C]}));L(O,h,y.value,p.imageSize,p.width)}function L(O,C,T,M,E){let N=E,j=[],_e=0;for(let me=0;me<O.length&&!(C.length>=T);me++){let ve=O[me];if(i.has(ve.sha1))continue;let ye=M+fe;if(_e+ye<N){j.push(ve),_e+=ye;continue}if(j.length==0)throw new Error("Images seems to be to big for the line");C.push(j),C.length<T&&(j=[ve],_e=ye)}j.length>0&&C.length<T&&C.push(j)}async function K(){if(!p.group)return;console.log("get reco");const O=p.group.images.map(E=>E.id);let C=await o.getSimilarImages({instanceIds:O});if(C.matches.sort((E,N)=>N.score-E.score),n.value){const E=e.getTabManager(),N=new Set(E.collection.groupManager.result.root.images.map(j=>j.id));C.matches=C.matches.filter(j=>N.has(j.id))}const T=Array.from(new Set(C.matches.map(E=>e.data.images[E.id].sha1)));c.length=0;let M=p.group;for(;M;)c.push(...M.meta.propertyValues),M=M.parent;_.length=0,_.push(...T),i.clear(),x(),v("update")}function ae(){n.value=!n.value}return se(K),A(()=>p.group,()=>{K(),i.clear()}),A(()=>p.imageSize,x),A(()=>p.width,x),A(n,K),(O,C)=>(s(),a("div",pn,[t("div",un,[t("div",{class:"text-secondary pe-1",onClick:C[0]||(C[0]=T=>v("close"))},_n),mn,t("div",{class:"text-secondary pe-1",onClick:C[1]||(C[1]=T=>v("scroll",p.group.id))},yn),gn,t("div",{class:"text-secondary pe-1",onClick:ae},[n.value?(s(),a("span",fn)):(s(),a("span",hn))]),bn,b(P,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",$n,$(O.$t("main.recommand.title")),1)]),_:1}),t("div",kn,[t("div",xn,[(s(!0),a(F,null,U(c,(T,M)=>(s(),a(F,null,[b(et,{class:"",value:T},null,8,["value"]),M<c.length-1?(s(),a("div",wn)):f("",!0)],64))),256))])])]),t("div",{style:H("margin-left:"+fe+"px;")},[(s(!0),a(F,null,U(h,T=>(s(),a("div",null,[t("div",In,[(s(!0),a(F,null,U(T,M=>(s(),V(dn,{pile:M,size:p.imageSize,onAccept:m,onRefuse:g,style:H("margin-right:"+fe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Cn=D(Sn,[["__scopeId","data-v-8d3876ca"]]),Mn={key:0,class:"m-0 p-0"},Vn={key:0,style:{"margin-left":"10px"}},Fn=z({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=G(),e=r.getTabManager(),o=d,p=w({}),v=w(null),y=w(null),h=w(null);w([]);const _=w(0),c=w(0),i=ne({groups:!1}),n=I(()=>e.getVisibleProperties());function u(){v.value&&y.value?_.value=o.height-v.value.clientHeight-y.value.clientHeight-5:v.value?_.value=o.height-v.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{h.value&&e.state.display=="tree"&&h.value.computeLines()});function m(x){p.value=e.collection.groupManager.result.index[x],Z(()=>u())}function g(){p.value={},Z(()=>u())}return se(()=>{c.value=v.value.clientWidth,window.addEventListener("resize",()=>{Z(()=>{var x;c.value=((x=v.value)==null?void 0:x.clientWidth)??c.value})})}),A(e.state,x=>{r.updateTabs()},{deep:!0}),A(()=>e.state.imageSize,()=>Z(u)),A(()=>o.height,async()=>{await Z(u)}),(x,L)=>(s(),a(F,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:v},[b(on,{tab:l(e),"compute-status":i},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[p.value.id?(s(),a("div",Mn,[b(Cn,{group:p.value,"image-size":l(e).state.imageSize,width:c.value,height:50,onClose:g,onScroll:h.value.scrollTo,onUpdate:L[0]||(L[0]=K=>Z(()=>u()))},null,8,["group","image-size","width","onScroll"])])):f("",!0)],512),c.value>0&&_.value>0?(s(),a("div",Vn,[l(e).state.display=="tree"?(s(),V(st,{key:0,"group-manager":l(e).collection.groupManager,"image-size":l(e).state.imageSize,height:_.value-0,properties:n.value,"hide-if-modal":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,width:c.value-25,onRecommend:m},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),l(e).state.display=="grid"?(s(),a("div",{key:1,style:H({width:c.value-12+"px"}),class:"p-0 m-0 grid-container"},[b(ot,{manager:l(e).collection.groupManager,height:_.value-15,width:c.value-40,"selected-properties":n.value,class:"p-0 m-0","show-images":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):f("",!0)])):f("",!0)],64))}});const En=D(Fn,[["__scopeId","data-v-e19df669"]]),Pn={class:"d-flex d-row",style:{cursor:"pointer"}},Tn=["onMouseenter","onMouseleave"],zn=["onClick"],On=["onClick"],Ln=["onClick"],Gn=["onSubmit"],Dn=["onKeydown","onUpdate:modelValue"],Nn=t("span",{class:"bi bi-plus"},null,-1),Rn=[Nn],Un={class:"lang"},jn=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),An=["value"],Hn=z({__name:"TabNav",props:{reRender:Function},setup(d){const r=G(),e=w(-1),o=w(""),p=w(null),v=d;function y(m){r.data.selectedTabId==m||_(),r.selectTab(m)}function h(m){e.value=m,o.value=r.data.tabs[m].name,Z(()=>p.value[0].focus())}function _(){e.value=-1,o.value=""}function c(m){r.addTab("New Tab")}async function i(m){confirm("Are you sure to delete Tab: "+m.name)&&await r.removeTab(m.id)}const n=ne({});w(-1);const u=["fr","en"];return(m,g)=>(s(),a("nav",null,[t("div",Pn,[(s(!0),a(F,null,U(l(r).data.tabs,x=>(s(),a("div",{class:"d-flex d-row me-2",onMouseenter:L=>n[x.id]=!0,onMouseleave:L=>n[x.id]=!1},[e.value!=x.id?(s(),a(F,{key:0},[b(P,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:L=>h(x.id),class:R(["bi bi-pencil me-1 tab-icon hover-light",n[x.id]&&l(r).data.selectedTabId==x.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,zn)]),_:2},1024),t("div",{class:R(["tab-button",x.id==l(r).data.selectedTabId?" active":""]),onClick:L=>y(x.id)},[t("span",null,$(x.name),1)],10,On),b(P,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:L=>i(x),class:R(["btn-icon bi bi-x tab-icon hover-light",n[x.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Ln)]),_:2},1024)],64)):(s(),a("div",{key:1,class:R(["tab-button",x.id==l(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:Ee(_,["stop","prevent"])},[le(t("input",{onFocusout:_,onKeydown:at(_,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":L=>x.name=L,ref_for:!0,ref_key:"inputElem",ref:p},null,40,Dn),[[re,x.name]])],40,Gn)],2))],40,Tn))),256)),b(P,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:c,id:"add-tab-button"},Rn)]),_:1}),t("div",Un,[jn,le(t("select",{"onUpdate:modelValue":g[0]||(g[0]=x=>m.$i18n.locale=x),onChange:g[1]||(g[1]=x=>v.reRender())},[(s(),a(F,null,U(u,(x,L)=>t("option",{key:`Lang${L}`,value:x},$(x.toUpperCase()),9,An)),64))],544),[[nt,m.$i18n.locale]])])])]))}});const Oe=d=>(W("data-v-9b5e2e9e"),d=d(),Y(),d),Bn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},qn={key:0},Kn={key:1,class:"w-100"},Qn={key:0,class:"custom-hr"},Wn={key:2,class:"loading"},Yn={class:"text-center"},Xn={key:3,class:"loading"},Jn=Oe(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Zn=Oe(()=>t("span",{class:"ms-1"},"Loading...",-1)),el=[Jn,Zn],tl=z({__name:"PanopticView",setup(d){const r=G(),e=$e(),o=w(null),p=w(null),v=w(window.innerHeight),y=w(!1),h=I(()=>{var m;return v.value-(((m=p.value)==null?void 0:m.clientHeight)??0)}),_=I(()=>{var m;return(m=o.value)==null?void 0:m.filteredImages.map(g=>g.id)});se(async()=>{e.isProjectLoaded||Ce.push("/"),Z(()=>{window.addEventListener("resize",c),c()}),window.addEventListener("keydown",m=>{m.key=="Control"&&(B.ctrl=!0),m.key=="Alt"&&(B.alt=!0),m.key=="Shift"&&(B.shift=!0),m.key=="ArrowLeft"&&(B.left=!0),m.key=="ArrowRight"&&(B.right=!0,console.log("keeeyy"))}),window.addEventListener("keyup",m=>{m.key=="Control"&&(B.ctrl=!1),m.key=="Alt"&&(B.alt=!1),m.key=="Shift"&&(B.shift=!1),m.key=="ArrowLeft"&&(B.left=!1),m.key=="ArrowRight"&&(B.right=!1)}),window.addEventListener("mousemove",m=>{B.ctrl=m.ctrlKey,B.alt=m.altKey,B.shift=m.shiftKey})}),lt(()=>{window.removeEventListener("resize",c)});function c(){v.value=window.innerHeight,y.value=!0}function i(){e.showModal(te.EXPORT,_)}function n(){r.rerender()}function u(){Ce.push("/")}return(m,g)=>(s(),a(F,null,[b(it,{tutorial:"project"}),(s(),a("div",{id:"panoptic",key:l(r).status.renderNb},[t("div",Bn,[l(r).status.loaded?(s(),a("div",qn,[b(Qs,{onExport:g[0]||(g[0]=x=>i())})])):f("",!0),l(r).status.loaded?(s(),a("div",Kn,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[b(Hn,{"re-render":n})],512),y.value?(s(),a("div",Qn)):f("",!0),l(r).status.loaded?(s(),V(En,{key:1,"tab-id":l(r).data.selectedTabId,height:h.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):f("",!0)])):l(e).isProjectLoaded?(s(),a("div",Xn,el)):(s(),a("div",Wn,[t("div",Yn,[t("div",null,$(m.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const al=D(tl,[["__scopeId","data-v-9b5e2e9e"]]);export{al as default};
