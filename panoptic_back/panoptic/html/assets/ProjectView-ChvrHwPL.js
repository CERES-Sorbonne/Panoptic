import{d as D,B as Z,k as P,D as ue,l as w,b as t,i as ae,t as S,C as Ct,o as n,E as Xe,r as z,c as A,a as u,f as se,n as W,F as R,s as ee,h as b,G as he,q as _,e as v,H as rt,I as Be,J as st,_ as Y,K as Fe,m as ie,L as K,N as ut,j as de,O as dt,u as Me,Q as Ie,R as Ae,w as Pe,v as Le,S as pt,M as me,y as O,T as te,U as Ye,V as Ze,W as It,X as Se,Y as ct,Z as Mt,g as Ke,$ as ot,a0 as Vt,a1 as zt,a2 as Et,a3 as Ft,a4 as Pt,a5 as Tt,a6 as At,a7 as Ot,a8 as Gt,a9 as Lt,aa as mt,ab as ft,ac as Dt,ad as we,ae as ge,af as Rt,ag as De,ah as vt,ai as H,aj as gt,ak as Ut,al as Bt,am as jt,an as Nt,ao as Ht,ap as Oe,A as Re,aq as qt,ar as Wt,as as Yt,at as Kt,au as Qt,av as Xt,aw as Zt,ax as Jt,ay as es,az as ts,aA as ss,p as nt}from"./index-BqbEgbub.js";import{S as os,O as ns,W as as,a as Te,G as ls,V as is,R as rs,c as us,C as ds,M as at,I as ps,b as cs,T as ms,P as fs,d as vs,e as gs}from"./three.module-Heq5pfhU.js";import{_ as ys}from"./Tutorial.vue_vue_type_style_index_0_lang-BZky6D63.js";const hs={class:"text-nowrap"},bs=["onClick"],_s=["onClick"],ws=D({__name:"FolderOptionDropdown",props:{folder:{}},setup(y){const l=Z(),s=y;function e(){l.reImportFolder(s.folder.id)}function o(){confirm(Ct.global.t("main.nav.folders.del_alert"))&&l.deleteFolder(s.folder.id)}return(p,c)=>(n(),P(ue,{teleport:!0},{button:w(()=>c[0]||(c[0]=[t("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:w(({hide:m})=>[t("div",hs,[t("div",{class:"p-2 bb",onClick:i=>{e(),m()}},c[1]||(c[1]=[t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ae("Re import")]),8,bs),c[3]||(c[3]=t("div",{class:"custom-hr"},null,-1)),t("div",{class:"bb p-2",onClick:i=>{o(),m()}},[c[2]||(c[2]=t("i",{class:"bi bi-trash me-1"},null,-1)),ae(S(p.$t("main.nav.folders.del")),1)],8,_s)])]),_:1}))}}),xs=["onMouseenter"],ks=["onClick"],$s={class:"text-secondary"},Ss=["onClick"],Cs=D({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Xe,root:{type:Boolean,default:!0},tab:Object},setup(y){const l=Z(),s=y,e=z(null),o=A(()=>{let a={};const d=new Set(s.filterManager.state.folders);return s.folders.map(f=>f.id).forEach(f=>{d.has(f)&&(a[f]=!0)}),a}),p=A(()=>{let a={};return s.folders.map(d=>d.id).forEach(d=>{s.visibleFolders[d]&&(a[d]=!0)}),a}),c=A(()=>{let a={};return s.folders.forEach(d=>{let f=[];o.value[d.id]&&f.push("selected"),a[d.id]=f.join(" ")}),a});function m(a){let d=s.visibleFolders;d[a]?delete d[a]:d[a]=!0}function i(a){let d=new Set(s.filterManager.state.folders);const f=d.has(a),g=l.folders[a].parent!=null&&d.has(l.folders[a].parent);f&&!g?(d.delete(a),Be(a).forEach($=>d.delete($.id))):(r(a,d),d.add(a),Be(a).forEach($=>d.add($.id)),st(l.folders[a]).forEach($=>d.delete($.id))),s.filterManager.setFolders(Array.from(d)),s.tab.setSelectedFolder(d),s.filterManager.update(!0)}function r(a,d){const f=st(l.folders[a]);let g;for(let $ of f)if(d.has($.id))g=$;else break;g!=null&&Be(g.id).forEach($=>d.delete($.id))}return(a,d)=>{const f=rt("FolderList2",!0);return n(),u("ul",{class:W(s.root?"tree":""),style:se(s.root?"padding-left:0px;":"")},[(n(!0),u(R,null,ee(y.folders,g=>(n(),u("li",{style:se(s.root?"padding-left:0px;":""),class:"no-break"},[t("div",{style:{display:"inline"},onMouseenter:$=>e.value=g.id,onMouseleave:d[1]||(d[1]=$=>e.value=null)},[t("summary",{class:W(c.value[g.id]),onClick:$=>i(g.id)},[t("span",{class:W(e.value===g.id?"visible-option":"invisible-option"),onClick:d[0]||(d[0]=he(()=>{},["stop"]))},[_(ws,{folder:g},null,8,["folder"])],2),ae(" "+S(g.name)+" ",1),t("span",$s,S(v(l).folders[g.id].count),1)],10,ks)],40,xs),g.children&&g.children.length>0?(n(),u("i",{key:0,onClick:$=>m(g.id),class:W("bi bi-chevron-"+(p.value[g.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ss)):b("",!0),g.children&&g.children.length>0&&p.value[g.id]?(n(),P(f,{key:1,folders:g.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager,tab:s.tab},null,8,["folders","visible-folders","filter-manager","tab"])):b("",!0)],4))),256))],6)}}}),Is=Y(Cs,[["__scopeId","data-v-08c57041"]]),Ms={class:"text-center"},Vs={class:"w-100 text-center",style:{"font-size":"10px"}},zs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Es=D({__name:"TaskStatus",props:{task:{}},setup(y){const l=y,s=A(()=>l.task.total-l.task.remain-l.task.computing),e=A(()=>l.task.total);return(o,p)=>(n(),u("div",Ms,[ae(S(l.task.name)+" ",1),t("div",Vs,S(s.value)+" / "+S(e.value)+" "+S(o.$t("main.nav.tasks.done")),1),e.value>0?(n(),u("div",zs,[t("div",{class:"progress-bar",style:se(`width: ${s.value/e.value*100}%`)},null,4)])):b("",!0)]))}}),yt=D({__name:"TabContainer",props:{id:{}},setup(y){const l=Fe(),s=y;let e;const o=z(!1);function p(){e=l.getTab(s.id),o.value=!0}return ie(p),K(()=>s.id,async()=>{o.value=!1,await de(),p()}),(c,m)=>o.value&&v(l).loaded?ut(c.$slots,"default",{key:0,tab:v(e)}):b("",!0)}}),Ge={},Fs={class:"d-flex flex-row"},Ps={key:2,class:"d-flex",style:{width:"150px"}},Ts={class:"flex-grow-1"},As={key:1,style:{"padding-top":"1px"}},Os={class:"text-center",style:{width:"24px","margin-top":"2px"}},Gs={style:{width:"20px","margin-top":"2px","flex-shrink":"0"},class:"text-center"},Ls={key:0},Ds={key:0,class:"ms-3 pt-1"},Rs={key:1},Us=D({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(y){const{t:l}=dt({useScope:"global"}),s=Me();Ie();const e=Z(),o=y,p=z(!1),c=z(!1),m=z(""),i=z(!1),r=A(()=>o.tab.state.visibleProperties[o.property.id]==!0),a=A(()=>o.tab.collection.filterManager.state.filter.filters.some(V=>!V.isGroup&&V.propertyId==o.property.id)),d=A(()=>o.tab.collection.groupManager.state.groupBy.includes(o.property.id)),f=A(()=>o.tab.collection.sortManager.state.sortBy.includes(o.property.id)),g=A(()=>{if(a.value)return o.tab.collection.filterManager.state.filter.filters.find(V=>!V.isGroup&&V.propertyId==o.property.id).id}),$=()=>o.tab.collection.filterManager,M=A(()=>o.tab.getSha1Mode());function k(){r.value?o.tab.setVisibleProperty(o.property.id,!1):o.tab.setVisibleProperty(o.property.id,!0)}function T(){o.open&&(p.value?p.value=!1:(p.value=!0,m.value=o.property.name),c.value=!1)}function x(){o.property.type!=te.tag&&o.property.type!=te.multi_tags||(c.value?c.value=!1:c.value=!0,p.value=!1)}function h(){f.value?o.tab.collection.sortManager.delSort(o.property.id):o.tab.collection.sortManager.setSort(o.property.id),o.tab.collection.sortManager.update(!0)}function E(){d.value?o.tab.collection.groupManager.delGroupOption(o.property.id):o.tab.collection.groupManager.setGroupOption(o.property.id),o.tab.collection.groupManager.update(!0)}function G(){confirm(l("common.properties.delete")+": "+o.property.name+" ?   "+o.property.id)&&e.deleteProperty(o.property.id)}async function oe(){m.value!=""&&(await e.updateProperty(o.property.id,m.value),T())}function j(){const V=$();a.value?(V.deleteFilter(g.value),Ge.filter.hide()):(V.addNewFilter(o.property.id),Ge.filter.show())}return K(()=>o.property,()=>{p.value=!1}),(V,C)=>(n(),u("div",{class:W(i.value?"hover-light":"")},[t("div",Fs,[o.open?(n(),u(R,{key:0},[p.value?b("",!0):(n(),u("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:T},[_(Ae,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:C[0]||(C[0]=q=>i.value=!0),onMouseleave:C[1]||(C[1]=q=>i.value=!1)},null,8,["type"]),t("span",null,S(o.property.name),1)]))],64)):(n(),P(Ae,{key:1,type:o.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),p.value&&o.open?(n(),u("div",Ps,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:T,onMouseenter:C[2]||(C[2]=q=>i.value=!0),onMouseleave:C[3]||(C[3]=q=>i.value=!1)},null,32)]),t("div",Ts,[o.property.id>=0?Pe((n(),u("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":C[4]||(C[4]=q=>m.value=q),onChange:oe},null,544)),[[Le,m.value]]):(n(),u("span",As,[_(Ae,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,S(o.property.name),1)]))])])):b("",!0),o.open?(n(),u(R,{key:3},[v(pt)(o.property.type)?(n(),u("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:C[5]||(C[5]=q=>v(s).showModal(v(me).TAG,{propId:o.property.id}))},[_(O,{click:!1,message:"main.nav.properties.open_tags"},{default:w(()=>C[7]||(C[7]=[t("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):b("",!0)],64)):b("",!0),o.open?(n(),u(R,{key:4},[t("div",Os,[o.property.type==v(te).tag||o.property.type==v(te).multi_tags?(n(),u("div",{key:0,onClick:x,style:{cursor:"pointer"}},[c.value?(n(),P(O,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:w(()=>C[8]||(C[8]=[t("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(n(),P(O,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:w(()=>C[9]||(C[9]=[t("i",{class:"bi bi-chevron-right ms-1"},null,-1)])),_:1}))])):b("",!0)]),t("div",Gs,[o.property.mode==v(Ye).id?(n(),P(O,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:w(()=>C[10]||(C[10]=[t("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):b("",!0)])],64)):b("",!0),t("div",{style:{width:"20px","margin-top":"2px","flex-shrink":"0"},onClick:k,class:"btn-icon text-center"},[M.value&&o.property.mode==v(Ye).id?(n(),P(O,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:w(()=>[t("span",{class:"bi bi-eye-slash",onClick:C[6]||(C[6]=he(()=>{},["stop"]))})]),_:1})):(n(),P(O,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:w(()=>[t("span",{class:W("bi bi-eye text-"+(r.value?"primary":"secondary"))},null,2)]),_:1}))])]),o.open?(n(),u("div",Ls,[p.value?(n(),u("div",Ds,[V.property.id!=v(Ze).folders?(n(),u("div",{key:0,class:W(["options hover-light",a.value?" text-primary":""]),onClick:j},[t("div",null,[C[11]||(C[11]=t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ae(S(V.$t("main.menu.filters")),1)])],2)):b("",!0),t("div",{class:W(["options hover-light",f.value?" text-primary":""]),onClick:h},[C[12]||(C[12]=t("i",{class:"bi bi-filter me-2"},null,-1)),ae(S(V.$t("main.menu.sort.title")),1)],2),t("div",{class:W(["options hover-light",d.value?" text-primary":""]),onClick:E},[C[13]||(C[13]=t("i",{class:"bi bi-collection me-2"},null,-1)),ae(S(V.$t("main.menu.groupby")),1)],2),o.property.id>=0?(n(),u("div",{key:1,class:"options hover-light",onClick:G},[C[14]||(C[14]=t("i",{class:"bi bi-trash me-2"},null,-1)),ae(S(V.$t("main.nav.properties.delete_property")),1)])):b("",!0)])):c.value?(n(),u("div",Rs,[_(It,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):b("",!0)])):b("",!0)],2))}}),Bs=Y(Us,[["__scopeId","data-v-878a3d2a"]]),js={key:0,class:"prop-container"},Ns={key:0},Hs={key:1},qs={key:0,class:"ms-2 text-capitalize overflow-hidden"},Ws={key:1,class:"ms-2"},Ys={class:"p-1"},Ks=["onClick"],Qs=["onClick"],Xs={key:0,class:"ps-1 pe-1"},Zs={class:"property-item"},Js=D({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(y){const l=Z(),s=Me(),e=y,o=z(!0),p=z(!1),c=z(""),m=A(()=>e.node.propertyIds.map(x=>l.properties[x])),i=A(()=>e.node.propertyIds.map(x=>e.tab.isVisibleProperty(x)).filter(x=>!x).length==0),r=A(()=>{if(e.node.groupId>=0)return l.propertyGroups[e.node.groupId];if(e.node.groupId==Se.DEFAULT)return{id:Se.DEFAULT,name:"default"};if(e.node.groupId==Se.COMPUTED)return{id:Se.COMPUTED,name:"computed"}}),a=A(()=>r.value.id>=0);function d(){o.value=!o.value}function f(x){l.updatePropertyGroup(r.value.id,c.value)}function g(){c.value=r.value.name}function $(){l.deletePropertyGroup(r.value.id)}async function M(){const h={emptyProperties:l.propertyList.filter(G=>G.propertyGroupId==e.node.groupId).map(G=>G.id)};await l.sendCommit(h);const E={emptyPropertyGroups:[e.node.groupId]};await l.sendCommit(E)}async function k(x){if(x.added){let h=x.added.element;const E=l.properties[h];let G=e.node.groupId;G<0&&(G=null),await l.updateProperty(E.id,E.name,G),await l.triggerPropertyTreeChange()}x.moved&&await l.triggerPropertyTreeChange()}function T(){i.value?e.tab.setVisibleProperties(e.node.propertyIds,!1):e.tab.setVisibleProperties(e.node.propertyIds,!0)}return ie(g),K(e,g),(x,h)=>v(l).propertyGroups[e.node.groupId]||e.node.groupId<0?(n(),u("div",js,[_(v(ct),{list:e.node.propertyIds,"item-key":E=>E,group:e.node.groupId>0||e.node.groupId==v(Se).DEFAULT?"properties":void 0,onChange:k},{header:w(()=>[t("div",{class:"d-flex group-container",onClick:d},[o.value?(n(),u("div",Ns,h[4]||(h[4]=[t("i",{class:"bi bi-caret-down-fill"},null,-1)]))):b("",!0),o.value?b("",!0):(n(),u("div",Hs,h[5]||(h[5]=[t("i",{class:"bi bi-caret-right-fill"},null,-1)]))),e.menuOpen?(n(),u(R,{key:2},[p.value?b("",!0):(n(),u("div",qs,S(r.value.name),1)),p.value?(n(),u("div",Ws,[_(Mt,{"auto-focus":!0,modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=E=>c.value=E),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:f,onCancel:g,onBlur:h[1]||(h[1]=E=>p.value=!1)},null,8,["modelValue"])])):b("",!0),h[8]||(h[8]=t("div",{class:"flex-grow-1"},null,-1)),e.node.groupId>=v(Se).DEFAULT?(n(),P(ue,{key:2,onClick:h[2]||(h[2]=he(()=>{},["prevent","stop"]))},{button:w(()=>h[6]||(h[6]=[t("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:w(({hide:E})=>[t("div",Ys,[a.value?(n(),u(R,{key:0},[t("div",{class:"bb",onClick:G=>{p.value=!0,E()}},S(x.$t("main.menu.editName")),9,Ks),t("div",{class:"bb",onClick:$},S(x.$t("main.menu.removeGroup")),1)],64)):b("",!0),t("div",{class:"bb",onClick:G=>{M(),E()}},S(x.$t("main.menu.deleteGroupAndProperties")),9,Qs)])]),_:1})):b("",!0),e.node.groupId>=-1?(n(),u("div",{key:3,class:"bb me-1",onClick:h[3]||(h[3]=he(E=>v(s).showModal(v(me).PROPERTY,{group:e.node.groupId}),["stop","prevent"]))},[_(O,{message:x.$t("main.menu.addNewPropertyToGroup")},{default:w(()=>h[7]||(h[7]=[t("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):b("",!0)],64)):b("",!0),e.node.propertyIds.length?(n(),u("div",{key:3,style:{cursor:"pointer","flex-shrink":"0","margin-right":"11px"},onClick:he(T,["stop"])},[t("span",{class:W("bi bi-eye text-"+(i.value?"primary":"secondary"))},null,2)])):b("",!0)])]),item:w(({element:E,index:G})=>[o.value&&m.value.length&&v(l).properties[E]?(n(),u("div",Xs,[t("div",Zs,[_(Bs,{tab:e.tab,property:v(l).properties[E],open:e.menuOpen},null,8,["tab","property","open"])])])):b("",!0)]),_:1},8,["list","item-key","group"])])):b("",!0)}}),je=Y(Js,[["__scopeId","data-v-47f82ff6"]]),eo={key:0,class:"mb-1"},to=D({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(y,{emit:l}){const s=Z(),e=y;function o(p){s.triggerPropertyTreeChange()}return(p,c)=>(n(),P(v(ct),{list:v(s).propertyTree,onChange:o,"item-key":m=>m.groupId},{item:w(({element:m})=>[m.groupId>=0?(n(),u("div",eo,[_(je,{tab:e.tab,node:m,"menu-open":e.menuOpen},null,8,["tab","node","menu-open"])])):b("",!0)]),footer:w(()=>[_(je,{class:"mb-1",tab:e.tab,node:v(s).propertyTree[v(s).propertyTree.length-2],"menu-open":e.menuOpen},null,8,["tab","node","menu-open"]),_(je,{class:"mb-1",tab:e.tab,node:v(s).propertyTree[v(s).propertyTree.length-1],"menu-open":e.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),so={class:""},oo={class:"m-0",style:{padding:"4px 0px 4px 8px"}},no={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ao={class:"flex-grow-1 text-capitalize overflow-hidden"},lo={key:0,class:"bi bi-chevron-left"},io={key:1,class:"bi bi-chevron-right"},ro={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},uo={class:"d-flex align-items-center"},po={style:{"max-height":"300px",overflow:"auto"}},co={key:0,id:"import"},mo={class:"pt-1 pb-2"},fo={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},vo={key:0,class:"ps-2 pe-2"},go={class:"p-1"},yo={key:0,class:"custom-hr"},ho={class:"p-1 mt-0"},bo={key:0,class:"d-flex p-1"},_o={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},wo={key:1,class:"bb me-1"},xo={class:"bb me-2"},ko={key:1,class:"mt-2"},$o=200,So=55,Co=D({__name:"Menu",emits:["export","toggle"],setup(y,{emit:l}){const s=Ie(),e=Z(),o=Me(),p=Fe(),c=l,m=z(!1),i=z(!0),r=A(()=>i.value?$o:So),a=async()=>{o.showModal(me.IMPORT)},d=A(()=>s.state.tasks.filter(M=>!M.done)??[]);function f(){o.showModal(me.FOLDERSELECTION,{callback:g,mode:"images"})}function g(M){M&&e.addFolder(M)}function $(){i.value=!i.value,c("toggle")}return(M,k)=>(n(),P(yt,{id:v(p).mainTab},{default:w(({tab:T})=>[t("div",{class:"menu overflow-scroll",style:se({width:r.value+"px"})},[t("div",so,[t("div",null,[t("div",oo,[t("div",no,[i.value?(n(),u(R,{key:0},[t("div",ao,S(v(s).state.name),1),_(O,{message:"main.menu.close_project"},{default:w(()=>[t("div",{class:"base-hover p-1",onClick:k[0]||(k[0]=x=>v(o).closeProject(v(s).state.id))},k[6]||(k[6]=[t("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),t("div",{class:"base-hover p-1",onClick:k[1]||(k[1]=x=>v(o).showModal(v(me).SETTINGS))},k[7]||(k[7]=[t("i",{class:"bi bi-gear"},null,-1)]))],64)):b("",!0),t("div",{class:W(["base-hover p-1",i.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:$},[i.value?(n(),u("i",lo)):(n(),u("i",io))],2)])]),i.value?(n(),u(R,{key:0},[k[9]||(k[9]=t("div",{class:"custom-hr"},null,-1)),t("div",ro,[t("div",uo,[t("div",null,[t("b",null,S(M.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:k[2]||(k[2]=x=>{f(),v(Ke)()})},[_(O,{message:"main.nav.folders.add"},{default:w(()=>k[8]||(k[8]=[t("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),t("div",po,[_(Is,{folders:v(e).folderRoots,"filter-manager":T.collection.filterManager,"visible-folders":T.state.visibleFolders,tab:T},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):b("",!0),i.value?(n(),u(R,{key:1},[d.value&&d.value.length?(n(),u("div",co,[k[11]||(k[11]=t("div",{class:"custom-hr"},null,-1)),t("div",mo,[t("div",fo,[t("div",null,[t("b",null,S(M.$t("main.nav.tasks.title")),1)])]),k[10]||(k[10]=t("div",{class:"custom-hr"},null,-1)),v(s).state.tasks?(n(),u("div",vo,[(n(!0),u(R,null,ee(d.value,(x,h)=>(n(),u("div",go,[h?(n(),u("div",yo)):b("",!0),_(Es,{task:x},null,8,["task"])]))),256))])):b("",!0)])])):b("",!0)],64)):b("",!0),k[18]||(k[18]=t("div",{class:"custom-hr"},null,-1)),t("div",ho,[i.value?(n(),u("div",bo,[_(O,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:w(()=>[t("b",null,S(M.$t("main.nav.properties.title")),1)]),_:1}),k[13]||(k[13]=t("span",{class:"flex-grow-1"},null,-1)),m.value?(n(),u("span",_o,k[12]||(k[12]=[t("span",{class:"sr-only"},null,-1)]))):(n(),u("span",wo,[_(O,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:w(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:a})]),_:1})])),t("span",xo,[_(O,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:w(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:k[3]||(k[3]=x=>v(o).showModal(v(me).EXPORT,void 0))})]),_:1})])])):b("",!0),v(s).loaded?(n(),u("div",ko,[_(to,{tab:T,"menu-open":i.value},null,8,["tab","menu-open"]),i.value?(n(),u(R,{key:0},[k[16]||(k[16]=t("div",{class:"property-item m-0 p-0"},null,-1)),t("div",{id:"add-property",onClick:k[4]||(k[4]=x=>{v(o).showModal(v(me).PROPERTY,void 0),v(Ke)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[14]||(k[14]=t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),t("span",null,S(M.$t("main.nav.properties.add_property")),1)]),k[17]||(k[17]=t("div",{class:"custom-hr mt-1"},null,-1)),t("div",{onClick:k[5]||(k[5]=x=>v(e).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[15]||(k[15]=t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),t("span",null,S(M.$t("main.nav.properties.add_property_group")),1)])],64)):b("",!0)])):b("",!0)])])])],4)]),_:1},8,["id"]))}}),Io=Y(Co,[["__scopeId","data-v-89a8f03a"]]),Mo={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Vo={class:""},zo=["onClick"],Eo=D({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(y,{emit:l}){const s=y,e=l;function o(p){e("update:modelValue",p)}return(p,c)=>(n(),P(ue,null,{button:w(()=>[t("div",Mo,[t("span",Vo,S(p.$t("modals.filters."+s.modelValue)),1)])]),popup:w(({hide:m})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:m},[t("div",{class:"base-btn",onClick:c[0]||(c[0]=i=>o(v(ot).and))},S(p.$t("modals.filters.and")),1),c[2]||(c[2]=t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),t("div",{class:"base-btn",onClick:c[1]||(c[1]=i=>o(v(ot).or))},S(p.$t("modals.filters.or")),1)],8,zo)]),_:1}))}}),Fo=["disabled"],Po={class:"m-0 p-1"},To=["onClick"],Ao=D({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(y,{emit:l}){const s=Z(),e=y,o=l,p=A(()=>s.properties[e.propertyId]),c=A(()=>Vt(p.value.type));async function m(i){o("update:modelValue",i)}return(i,r)=>(n(),P(ue,{onHide:r[0]||(r[0]=a=>o("hide")),placement:"bottom"},{button:w(()=>[t("div",{class:"text-nowrap sb ps-1 pe-1",disabled:e.disabled},[t("span",null,S(i.$t("modals.filters.operators."+e.modelValue)),1)],8,Fo)]),popup:w(({hide:a})=>[t("div",Po,[(n(!0),u(R,null,ee(c.value,d=>(n(),u("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:f=>{m(d),a()}},[t("a",null,S(i.$t("modals.filters.operators."+d)),1)],8,To))),256))])]),_:1}))}}),Oo=Y(Ao,[["__scopeId","data-v-0b3d97be"]]),Go={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},Lo=D({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(y,{emit:l}){const s=y,e=l;function o(p){e("update:modelValue",p)}return(p,c)=>(n(),u("div",Go,[v(pt)(p.property.type)?(n(),P(zt,{key:0,"model-value":s.modelValue,"onUpdate:modelValue":o,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:s.property,teleport:!1,width:s.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):s.property.type==v(te).color?(n(),P(Et,{key:1,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):s.property.type==v(te).number?(n(),P(Ft,{key:2,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):s.property.type==v(te).url?(n(),P(Pt,{key:3,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"])):s.property.type==v(te).checkbox?(n(),P(Tt,{key:4,"model-value":s.modelValue,"onUpdate:modelValue":o,label:s.property.name,width:s.width,class:"sb"},null,8,["model-value","label","width"])):s.property.type==v(te).date?(n(),P(At,{key:5,"model-value":s.modelValue,teleport:!1,"onUpdate:modelValue":o,width:s.width,class:"sb"},null,8,["model-value","width"])):(n(),P(Ot,{key:6,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Do={class:"p-0 m-0 ps-2"},Ro=D({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(y,{emit:l}){const s=Z(),e=y,o=A(()=>s.properties[e.filter.propertyId]),p=A(()=>Gt(e.filter.operator));function c(r){e.manager.updateFilter(e.filter.id,{operator:r})}function m(r){e.manager.updateFilter(e.filter.id,{value:r})}function i(r){e.manager.updateFilter(e.filter.id,{propertyId:r.id})}return(r,a)=>(n(),u(R,null,[t("td",Do,[_(Lt,{"model-value":o.value,"onUpdate:modelValue":i},null,8,["model-value"])]),t("td",null,[_(Oo,{"property-id":o.value.id,"model-value":e.filter.operator,"onUpdate:modelValue":c},null,8,["property-id","model-value"])]),t("td",null,[p.value?(n(),P(Lo,{key:0,"model-value":e.filter.value,"onUpdate:modelValue":m,property:o.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):b("",!0)])],64))}}),Uo={style:{"max-height":"500px",overflow:"auto"}},ht=D({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(y,{emit:l}){const s=y;function e(o){s.manager.addNewFilter(o,s.group.id),Ge.filter.show()}return(o,p)=>(n(),P(ue,{placement:"auto"},{button:w(()=>[ut(o.$slots,"default")]),popup:w(({hide:c})=>[t("div",Uo,[_(mt,{onSelect:m=>{e(m),c()},"ignore-ids":[v(Ze).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Bo={class:"filter-group"},jo={class:"table table-sm"},No={style:{height:"33px"}},Ho={class:""},qo={key:0,class:"m-0 p-0"},Wo={key:2,class:"text-secondary"},Yo={class:"border rounded"},Ko={class:""},Qo=["onClick"],Xo={class:"d-flex text-secondary ms-2"},Zo={class:"add-options hover-light"},Jo=D({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(y,{emit:l}){Z();const s=y,e=A(()=>s.filter),o=A(()=>e.value.filters),p=A(()=>{let r=255-(e.value.depth+1)*5;return`background: rgb(${r},${r},${r});`});function c(r){s.manager.deleteFilter(r.id)}function m(r){s.manager.addNewFilterGroup(r)}function i(r,a){s.manager.updateFilterGroup(r,a)}return(r,a)=>(n(),u("div",Bo,[t("table",jo,[(n(!0),u(R,null,ee(o.value,(d,f)=>(n(),u("tr",No,[t("td",Ho,[f==0?(n(),u("div",qo,S(r.$t("modals.filters.where")),1)):f==1?(n(),P(Eo,{key:1,"model-value":e.value.groupOperator,"onUpdate:modelValue":a[0]||(a[0]=g=>i(e.value.id,g))},null,8,["model-value"])):(n(),u("span",Wo,S(r.$t("modals.filters."+e.value.groupOperator)),1))]),d.propertyId!==void 0?(n(),P(Ro,{key:0,filter:d,manager:s.manager},null,8,["filter","manager"])):(n(),u("td",{key:1,colspan:"3",style:se(p.value)},[t("div",Yo,[_(bt,{filter:d,manager:s.manager},null,8,["filter","manager"])])],4)),t("td",Ko,[t("span",{class:"base-btn",onClick:g=>c(d)},a[2]||(a[2]=[t("i",{class:"bi bi-trash"},null,-1)]),8,Qo)])]))),256))]),t("div",Xo,[_(ht,{group:s.filter,manager:s.manager},{default:w(()=>[t("div",Zo,[a[3]||(a[3]=t("i",{class:"bi bi-plus"},null,-1)),ae(S(r.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),t("div",{class:"add-options hover-light",onClick:a[1]||(a[1]=d=>m(e.value.id))},[a[4]||(a[4]=t("i",{class:"bi bi-plus"},null,-1)),ae(S(r.$t("modals.filters.new_group")),1)])])]))}}),bt=Y(Jo,[["__scopeId","data-v-cbadcac5"]]),en={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},tn={key:0},sn={key:0,class:"or-separator"},on={key:0,class:"or-separator"},nn={key:0,class:"m-1 p-1"},an=D({__name:"MainFilterDropdown",props:{manager:Xe},emits:["update:modelValue"],setup(y,{emit:l}){const s=Z(),e=y,o=z(null),p=z(null),c=A(()=>{let i=m(e.manager.state.filter),r={};return i.forEach(a=>r[a.propertyId]=a),Object.values(r)});function m(i){let r=[];for(let a of i.filters)a.isGroup?r.push(...m(a)):r.push(a);return r}return K(()=>e.manager.state.filter.filters,()=>{e.manager.state.filter.filters.length==0&&p.value.hide()}),ie(async()=>{await de(),Ge.filter=p.value}),(i,r)=>(n(),P(ue,{ref_key:"dropdownElem",ref:p,placement:"top-start"},{button:w(()=>[t("div",null,[c.value.length||e.manager.state.query?.text?(n(),u("div",en,[e.manager.state.query?.text?(n(),u("div",tn,[r[0]||(r[0]=t("span",{class:"text-primary"},"Text Query",-1)),c.value.length?(n(),u("span",sn,"|")):b("",!0)])):b("",!0),(n(!0),u(R,null,ee(c.value,(a,d)=>(n(),u("div",null,[d>0?(n(),u("span",on,"|")):b("",!0),a.propertyId==v(Ze).id?(n(),P(Ae,{key:1,type:v(s).properties[a.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):b("",!0),t("span",null,S(v(s).properties[a.propertyId].name),1)]))),256))])):b("",!0)])]),popup:w(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:o},[Object.keys(v(s).properties).length>0?(n(),u("div",nn,[_(bt,{filter:e.manager.state.filter,manager:e.manager,parent:o.value},null,8,["filter","manager","parent"])])):b("",!0)],512)]),_:1},512))}}),ln=Y(an,[["__scopeId","data-v-dd2d67a7"]]),rn={class:"d-flex flex-row filter-form"},un={class:"pt-1 pb-1"},dn=D({__name:"FilterForm",props:{manager:Xe},setup(y){const l=y;return(s,e)=>(n(),u("div",rn,[t("div",un,S(s.$t("main.menu.filters"))+": ",1),_(ln,{manager:l.manager},null,8,["manager"]),_(ht,{manager:l.manager,group:l.manager.state.filter,class:"p-1"},{default:w(()=>e[0]||(e[0]=[t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),pn=Y(dn,[["__scopeId","data-v-aad7b24a"]]),cn={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},mn=D({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(y,{emit:l}){const s=y,e=l,o=z(null);return(p,c)=>(n(),P(ue,{ref_key:"dropdownElem",ref:o,"auto-focus":!1},{button:w(()=>c[2]||(c[2]=[t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)])),popup:w(()=>[t("div",cn,[_(mt,{onClick:c[0]||(c[0]=m=>v(Ke)()),onSelect:c[1]||(c[1]=m=>{e("select",m),o.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),_t=Y(mn,[["__scopeId","data-v-2f10e29f"]]),fn={class:"base-hover ps-1 pe-1"},vn={class:"main"},gn=["onClick"],yn=D({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(y,{emit:l}){const s=y,e=l,o=Object.values(ft);function p(c){e("update:modelValue",c)}return(c,m)=>(n(),P(ue,null,{button:w(()=>[t("div",fn,S(s.modelValue),1)]),popup:w(({hide:i})=>[t("div",vn,[(n(!0),u(R,null,ee(v(o),r=>(n(),u("div",{class:"base-hover option",onClick:a=>{p(r),i()}},S(r),9,gn))),256))])]),_:1}))}}),hn=Y(yn,[["__scopeId","data-v-cc9d0d61"]]),bn={class:""},_n={class:"d-flex ipt"},wn={class:"ms-2",min:"1"},xn=D({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(y,{emit:l}){const s=y,e=l,o=z(1),p=z(ft.Year);function c(){s.option.stepSize==o.value&&s.option.stepUnit==p.value||e("change",{stepSize:o.value,stepUnit:p.value})}function m(){o.value=s.option.stepSize??1,p.value=s.option.stepUnit}return K(()=>s.option,m),ie(m),K(o,()=>{(o.value<1||o.value==null||isNaN(o.value))&&(o.value=1)}),(i,r)=>(n(),P(ue,{onHide:c},{button:w(()=>r[2]||(r[2]=[t("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:w(({hide:a,focus:d})=>[t("div",bn,[t("div",_n,[t("div",null,[Pe(t("input",{type:"number","onUpdate:modelValue":r[0]||(r[0]=f=>o.value=f)},null,512),[[Le,o.value]])]),t("div",wn,[_(hn,{modelValue:p.value,"onUpdate:modelValue":r[1]||(r[1]=f=>p.value=f),onHide:d},null,8,["modelValue","onHide"])])])])]),_:1}))}}),kn=Y(xn,[["__scopeId","data-v-a27bea28"]]),$n={class:"d-flex flex-row group-form"},Sn={class:"pt-1 pb-1"},Cn={key:0,class:"bg-selected bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},In={key:0,class:"bi bi-chevron-right smaller"},Mn=["onClick"],Vn=["onClick"],zn=["onClick"],En=["onClick"],Fn=["onClick"],Pn=["onClick"],Tn=["onClick"],An=["onClick"],On=["onClick"],Gn={key:5,class:"sm-btn"},Ln={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Dn=D({__name:"GroupForm",props:{isLoading:Boolean,manager:Dt},setup(y){const l=Z(),s=y;function e(a){s.manager.setGroupOption(a),s.manager.update(!0)}function o(a){s.manager.delGroupOption(a),s.manager.update(!0)}function p(a,d){s.manager.setGroupOption(a,{direction:d}),s.manager.sortGroups(!0)}function c(a,d){s.manager.setGroupOption(a,{type:d}),s.manager.sortGroups(!0)}function m(a,d){s.manager.setGroupOption(a,d),s.manager.update(!0)}const i=A(()=>s.manager.state.groupBy.map(a=>l.properties[a])),r=A(()=>{const a=[];return s.manager.state.groupBy.forEach(d=>{a.push({option:s.manager.state.options[d],property:l.properties[d]})}),a});return(a,d)=>(n(),u("div",$n,[t("div",Sn,S(a.$t("main.menu.groupby"))+": ",1),i.value.length?(n(),u("div",Cn,[(n(!0),u(R,null,ee(r.value,(f,g)=>(n(),u(R,null,[g>0?(n(),u("i",In)):b("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:$=>o(f.property.id),id:"remove-group-button"},S(f.property.name),9,Mn),f.option.type==v(we).Size?(n(),P(O,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:w(()=>[f.option.direction==v(ge).Ascending?(n(),u("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:$=>c(f.property.id,v(we).Property)},null,8,Vn)):(n(),u("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:$=>c(f.property.id,v(we).Property)},null,8,zn))]),_:2},1024)):(n(),P(O,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:w(()=>[f.property.type==v(te).number?(n(),u(R,{key:0},[f.option.direction==v(ge).Ascending?(n(),u("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:$=>c(f.property.id,v(we).Size)},null,8,En)):(n(),u("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:$=>c(f.property.id,v(we).Size)},null,8,Fn))],64)):(n(),u(R,{key:1},[f.option.direction==v(ge).Ascending?(n(),u("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:$=>c(f.property.id,v(we).Size)},null,8,Pn)):(n(),u("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:$=>c(f.property.id,v(we).Size)},null,8,Tn))],64))]),_:2},1024)),f.option.direction==v(ge).Ascending?(n(),P(O,{key:3,message:"main.menu.sort.order_asc"},{default:w(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:$=>p(f.property.id,v(ge).Descending)},null,8,An)]),_:2},1024)):(n(),P(O,{key:4,message:"main.menu.sort.order_desc"},{default:w(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:$=>p(f.property.id,v(ge).Ascending)},null,8,On)]),_:2},1024)),f.property.type==v(te).date?(n(),u("div",Gn,[_(kn,{option:f.option,onChange:$=>m(f.property.id,$)},null,8,["option","onChange"])])):b("",!0)],64))),256)),s.isLoading?(n(),u("i",Ln)):b("",!0)])):b("",!0),_(_t,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:d[0]||(d[0]=f=>e(f))},null,8,["group-ids"])]))}}),Rn=Y(Dn,[["__scopeId","data-v-beb2e1ca"]]),Un={class:"d-flex flex-row sort-form"},Bn={class:"pt-1 pb-1"},jn={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Nn={key:0,class:"bi bi-chevron-right smaller"},Hn=["onClick"],qn=["onClick"],Wn=["onClick"],Yn=D({__name:"SortForm",props:{manager:Rt},setup(y){const l=Z(),s=y,e=A(()=>s.manager.state.sortBy.map(i=>({propertyId:i,direction:s.manager.state.options[i].direction}))),o=A(()=>e.value.map(i=>i.propertyId));function p(i){s.manager.setSort(i),s.manager.update(!0)}function c(i){s.manager.delSort(i),s.manager.update(!0)}function m(i,r){s.manager.setSort(i,{direction:r}),s.manager.update(!0)}return(i,r)=>(n(),u("div",Un,[t("div",Bn,S(i.$t("main.menu.sort.title"))+": ",1),e.value.length?(n(),u("div",jn,[(n(!0),u(R,null,ee(e.value,(a,d)=>(n(),u(R,null,[d>0?(n(),u("i",Nn)):b("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:f=>c(a.propertyId)},S(v(l).properties[a.propertyId].name),9,Hn),a.direction==v(ge).Ascending?(n(),P(O,{key:1,message:"main.menu.sort.order_asc"},{default:w(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:f=>m(a.propertyId,v(ge).Descending)},null,8,qn)]),_:2},1024)):(n(),P(O,{key:2,message:"main.menu.sort.order_desc"},{default:w(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:f=>m(a.propertyId,v(ge).Ascending)},null,8,Wn)]),_:2},1024))],64))),256))])):b("",!0),_(_t,{"group-ids":o.value,onSelect:r[0]||(r[0]=a=>p(a))},null,8,["group-ids"])]))}}),Kn=Y(Yn,[["__scopeId","data-v-80dc564a"]]),Qn={class:"p-2"},Xn={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Zn={class:"border mb-1 p-1"},Jn={class:"me"},ea={key:0},ta={key:1},sa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},oa={class:"d-flex center justify-content-center"},na={key:1,class:"bi bi-arrow-down text-secondary"},aa={key:3,class:"bi bi-arrow-up text-secondary"},la={class:"border mb-1 p-1"},ia={class:"me"},ra={key:0},ua={key:1},da={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Ce=5,pa=D({__name:"HistoryDropdown",emits:[],setup(y,{emit:l}){const s=Z(),e=z(!1),o=A(()=>e.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),p=A(()=>[...s.history.undo].reverse().slice(0,Ce)),c=A(()=>s.history.redo.slice(Math.max(s.history.redo.length-Ce,0)));return K(()=>s.onUndo,()=>{console.log("changed"),e.value=!0,setTimeout(()=>e.value=!1,100)}),(m,i)=>p.value.length||c.value.length?(n(),P(ue,{key:0},{button:w(()=>[_(O,{message:"dropdown.history.info"},{default:w(()=>[t("div",{class:"d-flex sb flash",style:se([{"font-size":"14px"},o.value])},[i[2]||(i[2]=t("i",{class:"bi bi-clock-history me-1"},null,-1)),t("div",null,S(m.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:w(()=>[t("div",Qn,[v(s).history.redo.length>Ce?(n(),u("div",Xn," + "+S(v(s).history.redo.length-Ce),1)):b("",!0),(n(!0),u(R,null,ee(c.value,r=>(n(),u("div",Zn,[t("span",Jn,S(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),i[3]||(i[3]=t("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(n(),u("span",ea,S(r.tags)+" "+S(m.$t("dropdown.history.tags")),1)):b("",!0),r.values?(n(),u("span",ta,S(r.values)+" "+S(m.$t("dropdown.history.values")),1)):b("",!0)]))),256)),t("div",sa,[t("div",oa,[p.value.length?(n(),P(O,{key:0,message:"dropdown.history.undo"},{default:w(()=>[t("div",{class:"bi bi-arrow-down sb",onClick:i[0]||(i[0]=(...r)=>v(s).undo&&v(s).undo(...r))})]),_:1})):(n(),u("div",na)),i[4]||(i[4]=t("div",{style:{width:"30px"}},null,-1)),c.value.length?(n(),P(O,{key:2,message:"dropdown.history.redo"},{default:w(()=>[t("div",{class:"bi bi-arrow-up sb",onClick:i[1]||(i[1]=(...r)=>v(s).redo&&v(s).redo(...r))})]),_:1})):(n(),u("div",aa))])]),(n(!0),u(R,null,ee(p.value,r=>(n(),u("div",la,[t("span",ia,S(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),i[5]||(i[5]=t("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(n(),u("span",ra,S(r.tags)+" "+S(m.$t("dropdown.history.tags")),1)):b("",!0),r.values?(n(),u("span",ua,S(r.values)+" "+S(m.$t("dropdown.history.values")),1)):b("",!0)]))),256)),v(s).history.undo.length>Ce?(n(),u("div",da," + "+S(v(s).history.undo.length-Ce),1)):b("",!0)])]),_:1})):b("",!0)}}),ca=Y(pa,[["__scopeId","data-v-b5086318"]]),ma=D({__name:"ToggleReload",props:{tab:{}},emits:[],setup(y,{emit:l}){const s=y,e=A(()=>s.tab.collection.state.autoReload?2:s.tab.collection.runState.isDirty?0:1);function o(){e.value==0?s.tab.collection.update():e.value==1?s.tab.collection.setAutoReload(!0):s.tab.collection.setAutoReload(!1)}return(p,c)=>(n(),u("div",{class:"bb font",onClick:o,style:{width:"26px",height:"30px",overflow:"hidde"}},[e.value==0?(n(),P(O,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:w(()=>c[0]||(c[0]=[t("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):b("",!0),e.value==1?(n(),P(O,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:w(()=>c[1]||(c[1]=[t("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):b("",!0),e.value==2?(n(),P(O,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:w(()=>c[2]||(c[2]=[t("div",{style:{height:"30px"}},[t("span",{class:"bi bi-check2-all text-success small-valid"}),t("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):b("",!0)]))}}),fa=Y(ma,[["__scopeId","data-v-4047bb79"]]),va={class:"display"},ga={key:1,class:"display"},ya={class:"p-0"},ha=["onClick"],ba={key:2},_a={key:0,class:"text-gray-500 p-2 text-sm"},wa=D({__name:"SelectDropdown",props:{options:{},modelValue:{},placeholder:{},size:{}},emits:["update:modelValue","changed"],setup(y,{emit:l}){const s=y,e=l,o=A(()=>s.options.find(m=>m.value===s.modelValue)),p=A(()=>s.size?s.size:14),c=(m,i)=>{m.disabled||(e("update:modelValue",m.value),e("changed",m.value),i())};return(m,i)=>(n(),P(ue,{placement:"bottom-start"},{button:w(()=>[t("div",{style:se([{fontSize:p.value+"px"},{"white-space":"nowrap"}])},[o.value.description?(n(),P(O,{key:0,message:o.value.description},{default:w(()=>[o.value.icon?(n(),u("span",{key:0,class:W(["bi bi-"+o.value.icon,"me-0"])},null,2)):b("",!0),t("span",va,[ae(S(o.value.label??o.value.value)+" ",1),i[0]||(i[0]=t("i",{class:"ms-1 bi bi-chevron-down"},null,-1))])]),_:1},8,["message"])):(n(),u("span",ga,[o.value.icon?(n(),u("span",{key:0,class:W(["bi bi-"+o.value.icon,"me-0"])},null,2)):b("",!0),ae(" "+S(o.value.label??o.value.value)+" ",1),i[1]||(i[1]=t("i",{class:"ms-1 bi bi-chevron-down"},null,-1))]))],4)]),popup:w(({hide:r})=>[t("div",ya,[(n(!0),u(R,null,ee(m.options,a=>(n(),u("div",{key:a.value,class:W(["bb",{"is-selected":a.value===m.modelValue,"is-disabled":a.disabled}]),onClick:d=>c(a,r)},[a.icon?(n(),u("span",{key:0,class:W(["bi bi-"+a.icon,"me-2"])},null,2)):b("",!0),a.description?(n(),P(O,{key:1,message:a.description},{default:w(()=>[ae(S(a.label??a.value),1)]),_:2},1032,["message"])):(n(),u("span",ba,S(a.label??a.value),1))],10,ha))),128)),m.options.length===0?(n(),u("div",_a," No options available ")):b("",!0)])]),_:1}))}}),xa=Y(wa,[["__scopeId","data-v-fe417e96"]]),ka=["onSubmit"],$a={class:"mb-1"},Sa={class:"d-flex flex-center mt-3",style:{height:"20px"}},Ca=["onClick"],Ia=["onClick"],Ma=D({__name:"InputOptions",props:{functionId:{},size:{},hideText:{type:Boolean}},emits:["changed"],setup(y,{emit:l}){const s=De(),e=y,o=l,p=z([]),c=A(()=>e.size?e.size:12),m=A(()=>e.functionId.slice(0,e.functionId.indexOf(".")));function i(){if(!e.functionId||!s.index[e.functionId])return;const d=s.index[e.functionId].params,f=s.getContext(e.functionId).uiInputs;for(let g of d)g.defaultValue=f[g.name];p.value=JSON.parse(JSON.stringify(d))}async function r(){for(let d in p.value)s.index[e.functionId].params[d].defaultValue=p.value[d].defaultValue;await s.updateDefaultParams(),o("changed")}function a(){i()}return ie(i),(d,f)=>p.value.length?(n(),u("div",{key:0,style:se({fontSize:c.value+"px"})},[_(ue,null,{button:w(()=>[t("div",null,[_(O,{message:"Options"},{default:w(()=>f[0]||(f[0]=[t("span",{class:"bbb"},[t("i",{class:"bi bi-gear"})],-1)])),_:1})])]),popup:w(({hide:g})=>[t("form",{onSubmit:he($=>{r(),g()},["prevent"]),class:"p-2"},[(n(!0),u(R,null,ee(p.value,($,M)=>(n(),u("div",$a,[$.name=="text"&&e.hideText?b("",!0):(n(),P(vt,{key:0,input:$,source:m.value},null,8,["input","source"]))]))),256)),t("div",Sa,[f[1]||(f[1]=t("div",{class:"flex-grow-1"},null,-1)),t("div",{class:"bb",onClick:$=>{a(),g()}},S(d.$t("cancel")),9,Ca),t("div",{class:"bb",onClick:$=>{r(),g()}},S(d.$t("confirm")),9,Ia)])],40,ka)]),_:1})],4)):b("",!0)}}),Va={class:"cont3"},za={class:"select-wrapper"},Ea=["placeholder"],Fa={style:{width:"22px"}},Pa={key:0},Ta=D({__name:"TextSearchInput",props:{query:{}},emits:["update:query"],setup(y,{emit:l}){const s=De(),e=y,o=l,p=z(null),c=z(!1),m=[{value:"text",icon:"search"},{value:"regex",icon:"regex"}],i=z([]),r=z("text"),a=z(""),d=A(()=>r.value!="text"&&r.value!="regex");function f(){const T=s.textSearchFunctions.map(x=>({value:x.id,icon:"boxes"}));i.value=[...m,...T]}function g(){e.query&&(r.value=e.query.type||"text",a.value=e.query.text||"")}function $(){a.value="",k()}function M(){k()}function k(){const T={type:r.value,text:a.value};if(d.value){if(!s.index[r.value]){r.value="text",$();return}const x=s.getContext(r.value);x.uiInputs.text=a.value,T.ctx=x}o("update:query",T)}return f(),K(()=>e.query,g,{deep:!0}),K(()=>s.textSearchFunctions,f),K(r,k),ie(()=>{f(),g()}),H.ctrlF.on(()=>p.value?.focus()),(T,x)=>(n(),u("div",Va,[t("div",za,[_(xa,{options:i.value,modelValue:r.value,"onUpdate:modelValue":x[0]||(x[0]=h=>r.value=h),placeholder:"Search Mode",class:"bg-white"},null,8,["options","modelValue"])]),t("div",{class:W(["input-field d-flex items-align-center",{focus:c.value}])},[Pe(t("input",{class:"text-input2",type:"text","onUpdate:modelValue":x[1]||(x[1]=h=>a.value=h),placeholder:T.$t("main.menu.search"),ref_key:"inputElem",ref:p,onFocusin:x[2]||(x[2]=h=>c.value=!0),onFocusout:x[3]||(x[3]=h=>c.value=!1),onKeypress:gt(M,["enter"])},null,40,Ea),[[Le,a.value]]),t("div",Fa,[a.value.length?(n(),u("i",{key:0,class:"bi bi-x sb",onClick:$})):b("",!0)])],2),d.value?(n(),u("div",Pa,[_(Ma,{"function-id":r.value,size:14,"hide-text":!0,onChanged:k},null,8,["function-id"])])):b("",!0)]))}}),Aa=Y(Ta,[["__scopeId","data-v-4dce1564"]]),Oa={class:"d-flex flex-row p-2 align-items-center"},Ga={class:"me-3 d-flex"},La={class:"ms-5",style:{"font-size":"13px"}},Da=["checked"],Ra={class:"ms-1"},Ua={class:"ms-4"},Ba={class:"d-flex flex-wrap content-container ps-2"},ja=D({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(y,{emit:l}){Ut();const s=y,e=z(),o=A(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),p=A(()=>o.value.length);function c(r){const a=r.target.checked;s.tab.collection.groupManager.setSha1Mode(a,!0)}function m(){console.log("get local",s.tab.state.filterState.query),e.value=s.tab.state.filterState.query}function i(r){e.value=r,s.tab.collection.filterManager.setQuery(e.value),s.tab.collection.filterManager.update(!0),s.tab.saveState()}return ie(m),K(()=>s.tab.collection.filterManager.state.query,m),(r,a)=>(n(),u(R,null,[t("div",Oa,[_(Aa,{class:"me-3",style:{"flex-shrink":"0"},query:e.value,"onUpdate:query":i},null,8,["query"]),t("div",Ga,[_(O,{message:"main.menu.grid_tooltip"},{default:w(()=>[t("i",{class:W("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:a[0]||(a[0]=d=>s.tab.setViewMode("tree"))},null,2)]),_:1}),_(O,{message:"main.menu.table_tooltip"},{default:w(()=>[t("i",{id:"toot",class:W("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:a[1]||(a[1]=d=>s.tab.setViewMode("grid"))},null,2)]),_:1}),_(O,{message:"main.menu.graph_tooltip"},{default:w(()=>[t("i",{id:"toot",class:W("bi bi-bar-chart btn-icon me-2"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:a[2]||(a[2]=d=>s.tab.setViewMode("graph"))},null,2)]),_:1}),_(O,{message:"main.menu.map_tooltip"},{default:w(()=>[t("i",{id:"toot",class:W("bi bi-map btn-icon"+(s.tab.state.display=="map"?"":" text-secondary")),onClick:a[3]||(a[3]=d=>s.tab.setViewMode("map"))},null,2)]),_:1})]),_(O,{message:"main.menu.image_size_tooltip",click:!1},{default:w(()=>a[7]||(a[7]=[t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),t("div",null,[_(Bt,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":a[4]||(a[4]=d=>s.tab.state.imageSize=d)},null,8,["modelValue"])]),t("div",La,[_(O,{message:"main.menu.image_mode_tooltip"},{default:w(()=>[t("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:c},null,40,Da),t("span",Ra,S(r.$t("main.menu.image_mode")),1)]),_:1})]),t("div",Ua,[_(ca)]),p.value?(n(),P(jt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":o.value,"onRemove:selected":a[5]||(a[5]=d=>s.tab.collection.groupManager.clearSelection()),onStamped:a[6]||(a[6]=d=>s.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):b("",!0),a[9]||(a[9]=t("div",{class:"flex-grow-1"},null,-1)),_(O,{message:"main.menu.issue",class:"bb"},{default:w(()=>a[8]||(a[8]=[t("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),t("div",Ba,[_(fa,{tab:s.tab,class:"me-1"},null,8,["tab"]),_(pn,{manager:s.tab.collection.filterManager},null,8,["manager"]),_(Rn,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),_(Kn,{manager:s.tab.collection.sortManager},null,8,["manager"]),a[10]||(a[10]=t("div",null,null,-1))])],64))}}),Na=Y(ja,[["__scopeId","data-v-38a71071"]]),Ha={class:""},qa={class:"d-flex flex-row"},Wa=D({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(y,{emit:l}){const s=Me(),e=y,o=l,p=A(()=>`width: ${e.size}px; height: ${e.size}px;`);A(()=>`max-width: ${e.size-2}px; max-height: ${e.size-1}px;`);const c=A(()=>e.pile.images[0]);return(m,i)=>(n(),u("div",Ha,[_(Nt,{image:c.value},{default:w(()=>[t("div",{style:se(p.value),class:"img-container",onClick:i[0]||(i[0]=r=>v(s).showModal(v(me).IMAGE,{image:c.value}))},[_(Ht,{image:c.value,width:e.size-2,height:e.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),t("div",qa,[_(O,{message:"main.recommand.accept"},{default:w(()=>[t("div",{style:se(["width: "+e.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:i[1]||(i[1]=r=>o("accept",c.value))}," ✓ ",4)]),_:1}),_(O,{message:"main.recommand.refuse"},{default:w(()=>[t("div",{style:se(["width: "+e.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:i[2]||(i[2]=r=>o("refuse",c.value))}," ✕ ",4)]),_:1})])]))}}),Ya=Y(Wa,[["__scopeId","data-v-809d667b"]]),Ka={class:"reco-container"},Qa={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Xa={key:0,class:"bi bi-funnel-fill bb text-primary"},Za={key:1,class:"bi bi-funnel bb"},Ja={class:"text-secondary me-2"},el={style:{"padding-top":"2px"},class:"me-1"},tl={class:"flex-grow-1"},sl={class:"d-flex flex-row"},ol={key:0,class:"separator"},nl={class:"d-flex flex-row"},Ne=10,al=D({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(y,{emit:l}){const s=Z(),e=De(),o=y,p=l,c=z(1),m=Oe([]),i=z(null),r=Oe([]),a=Oe(new Set),d=z(!0),f=[],g=[];async function $(j){const V=[],C=[];r.forEach(q=>{if(q.value!=null){const U=s.properties[q.propertyId];let J=q.value;U.type==te.multi_tags?(J=j.properties[q.propertyId]??[],J=[...J,q.value]):U.type==te.tag&&(J=[J]),U.mode==Ye.id?C.push({instanceId:j.id,propertyId:U.id,value:J}):V.push({propertyId:U.id,sha1:j.sha1,value:J})}}),await s.setPropertyValues(C,V)}function M(j){i.value.isSha1Group?i.value.images.filter(V=>V.sha1==j.sha1).forEach(V=>a.add(V.id)):a.add(j.id),oe()}function k(){m.length=0;let j=[];const V=g.map(C=>s.instances[C]);if(i.value.isSha1Group){const C={},q=Array.from(new Set(V.map(U=>U.sha1)));q.forEach(U=>C[U]=[]),V.forEach(U=>C[U.sha1].push(U)),q.forEach(U=>j.push({sha1:U,images:s.sha1Index[U]}))}else V.forEach(C=>j.push({sha1:C.sha1,images:[C]}));T(j,m,c.value,o.imageSize,o.width)}function T(j,V,C,q,U){let J=U,Q=[],ce=0;for(let Ve=0;Ve<j.length&&!(V.length>=C);Ve++){let fe=j[Ve];if(fe.images=fe.images.filter(ve=>!a.has(ve.id)),fe.images.length==0)continue;let ke=q+Ne;if(ce+ke<J){Q.push(fe),ce+=ke;continue}if(Q.length==0)throw new Error("Images seems to be to big for the line");V.push(Q),V.length<C&&(Q=[fe],ce=ke)}Q.length>0&&V.length<C&&V.push(Q)}async function x(){if(!o.group||!e.hasSimilaryFunction)return;const j=e.defaultActions.similar,V=e.getContext(j);V.instanceIds=o.group.images.map(Q=>Q.id);const C=await e.getSimilarImages(V);if(!C)return;if(!C.groups)throw new Error("No instances in ActionResult");let U=Yt(C.groups)[0];if(d.value){const Q=new Set(o.tab.collection.filterManager.result.images.map(ce=>ce.id));U.images=U.images.filter(ce=>Q.has(ce.id))}U.scores&&Kt(U),i.value=U,r.length=0;let J=o.group;for(;J;)r.push(...J.meta.propertyValues),J=J.parent;a.clear(),f.length=0,U.images.forEach(Q=>f.push(Q.id)),oe(),p("update")}function h(){d.value=!d.value}function E(){o.tab.collection.groupManager.onResultChange.addListener(oe)}function G(){o.tab.collection.groupManager.onResultChange.removeListener(oe)}function oe(){const j=o.tab.collection.groupManager.result.index[o.group.id];if(!j){p("close");return}g.length=0;const V=new Set(j.images.map(C=>C.id));f.forEach(C=>{V.has(C)||a.has(C)||g.push(C)}),k()}return ie(E),Re(G),ie(x),K(()=>o.group,()=>{x(),a.clear()}),K(()=>o.imageSize,k),K(()=>o.width,k),K(d,x),(j,V)=>(n(),u("div",Ka,[t("div",Qa,[_(O,{message:"main.recommand.close"},{default:w(()=>[t("div",{class:"text-secondary pe-1",onClick:V[0]||(V[0]=C=>p("close"))},V[2]||(V[2]=[t("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),V[5]||(V[5]=t("div",{class:"b-left pe-1"},null,-1)),_(O,{message:"main.recommand.scroll"},{default:w(()=>[t("div",{class:"text-secondary pe-1",onClick:V[1]||(V[1]=C=>p("scroll",o.group.id))},V[3]||(V[3]=[t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),V[6]||(V[6]=t("div",{class:"b-left pe-1"},null,-1)),_(O,{message:"main.recommand.filter"},{default:w(()=>[t("div",{class:"text-secondary pe-1",onClick:h},[d.value?(n(),u("span",Xa)):(n(),u("span",Za))])]),_:1}),V[7]||(V[7]=t("div",{class:"b-left pe-1"},null,-1)),_(O,{message:"main.recommand.reload"},{default:w(()=>[t("div",{class:"text-secondary pe-1",onClick:x},V[4]||(V[4]=[t("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),V[8]||(V[8]=t("div",{class:"b-left pe-1"},null,-1)),_(O,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:w(()=>[t("span",Ja,S(j.$t("main.recommand.title")),1)]),_:1}),t("div",el,[_(qt,{action:"similar",onChanged:x})]),t("div",tl,[t("div",sl,[(n(!0),u(R,null,ee(r,(C,q)=>(n(),u(R,null,[_(Wt,{class:"",value:C},null,8,["value"]),q<r.length-1?(n(),u("div",ol)):b("",!0)],64))),256))])])]),t("div",{style:se("margin-left:"+Ne+"px;")},[(n(!0),u(R,null,ee(m,C=>(n(),u("div",null,[t("div",nl,[(n(!0),u(R,null,ee(C,q=>(n(),P(Ya,{pile:q,size:o.imageSize,onAccept:$,onRefuse:M,style:se("margin-right:"+Ne+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),ll=Y(al,[["__scopeId","data-v-c830b08a"]]),il={style:{display:"flex"}},rl={class:"info"},ul={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:te},height:String},setup(y){const l=y,s=z(0),e=z(!1),o={};Object.keys(l.chartData.series).forEach(d=>{o[d]=!1});const p=z({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:l.chartData.dataType===te.date?"datetime":"numeric",categories:l.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:d,seriesIndex:f,dataPointIndex:g,w:$}){const M=l.chartData.series[f].data[g];let k='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';M.images.forEach((x,h)=>{h<10&&(k+=`<div style="width: 75px; height: 75px;"><img src="${x}" style="width: 100%; height: 100%;" /></div>`)}),k+="</div>";let T=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${l.chartData.series[f].name} — </b> ${M.y} Images</span>`;return T+=`<div>${k}</div>`,T}}}),c=()=>{p.value.chart.stacked=!p.value.chart.stacked,e.value=!e.value,s.value+=1},m=()=>{let d;p.value.chart.type==="area"?d={chart:{...p.value.chart,type:"bar"}}:d={chart:{...p.value.chart,type:"area"}},p.value={...p.value,...d},s.value+=1},i=(d,f,g)=>{const M=l.chartData.series[f];let k=Math.max(...M.data.map(T=>T.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(T=>T.remove()),o[f]){o[f]=!1;return}M.data.forEach((T,x)=>{const E=Math.floor(T.y/k*17),G=T.images.slice(0,E),oe=`circle[index="${f}"][j="${x}"]`,j=document.querySelector(oe),V=parseFloat(j.getAttribute("cx"));G.forEach((C,q)=>{const U=document.createElement("img");U.src=C,U.width=40,U.height=40,U.style.position="absolute";let J=V+40/1.5,Q=65+q*40;U.style.left=`${J}px`,U.style.bottom=`${Q}px`,U.classList.add("apexcharts-custom-image"),U.addEventListener("mouseover",ce=>r(J,Q,C)),U.addEventListener("mouseout",a),d.el.appendChild(U)})}),Object.keys(o).forEach(T=>o[T]=!1),o[f]=!0};function r(d,f,g){const $=document.getElementById("zoomed-image");$.style.left=`${d+120*1.5}px`,$.src=g,$.style.bottom=`${f}px`,$.style.display="block"}function a(){const d=document.getElementById("zoomed-image");d.style.display="none"}return(d,f)=>{const g=rt("apexchart");return n(),u(R,null,[t("div",il,[t("button",{class:"mt-2",onClick:m},S(p.value.chart.type==="area"?d.$t("main.graph-view.histo"):d.$t("main.graph-view.curve")),1),l.chartData.series.length>1?(n(),u("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:c},S(e.value?d.$t("main.graph-view.over"):d.$t("main.graph-view.stack")),1)):b("",!0)]),(n(),P(g,{style:{position:"relative"},key:s.value,height:l.height,type:p.value.chart.type,options:p.value,series:l.chartData.series,onLegendClick:i},null,8,["height","type","options","series"])),t("i",rl,S(d.$t("main.graph-view.info")),1),f[0]||(f[0]=t("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},dl={key:1},pl=D({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(y,{emit:l}){const s=Z(),e=y,o=z(""),p=z(m());function c(){const i=new Set;let r=e.collection.groupManager.getGroupIterator();for(;r;){const a=r.group;if(a.id===0||a.meta.propertyValues&&a.meta.propertyValues[0].value==null){r=r.nextGroup();continue}for(let d of a.children)i.add(d.meta.propertyValues[0].value);a.children.forEach(()=>r=r.nextGroup()),r=r.nextGroup()}return i}function m(){const i={};let r,a=e.collection.groupManager.state.groupBy;if(a.length===0){o.value="Choose at least one date or numeric value to group the images by";return}const d=s.properties[a[0]],f=d.type;if(a.length>2){o.value="Only max two levels of grouping are supported";return}else if(a.length===1)i[d.name]={name:d.name,data:[]};else if(r=Array.from(c()),r.length>20){o.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(f!==te.number&&f!==te.date){o.value="First level of grouping needs to be a date or a numeric property";return}let g=e.collection.groupManager.getGroupIterator();const $=[];for(;g;){const M=g.group;if(M.id===0||M.meta.propertyValues&&M.meta.propertyValues[0].value==null){g=g.nextGroup();continue}let k=M.meta.propertyValues[0];const T=f===te.date?new Date(k.value).getTime():k.value;if($.push(T),d.name in i)i[d.name].data.push({x:T,y:M.images.length,images:M.images.slice(0,20).map(x=>x.urlSmall)});else{const x=M.children.map(E=>E.meta.propertyValues[0].value),h=r.filter(E=>!x.includes(E));for(let E of M.children){const G=E.meta.propertyValues[0].value;if(i[G]===void 0){let oe=G;G in s.tags&&(oe=s.tags[G].value),i[G]={data:[],name:oe}}i[E.meta.propertyValues[0].value].data.push({x:T,y:E.images.length,images:E.images.slice(0,20).map(oe=>oe.urlSmall)})}for(let E of h){if(i[E]===void 0){let G=E;E in s.tags&&(G=s.tags[E].value),i[E]={data:[],name:G}}i[E].data.push({x:T,y:0,images:[]})}M.children.forEach(()=>g=g.nextGroup())}g=g.nextGroup()}return o.value="",{series:Object.values(i),xValues:$,dataType:f}}return e.collection.groupManager.onResultChange.addListener(()=>p.value=m()),(i,r)=>(n(),u("div",{class:"",style:se({height:e.height+"px"})},[o.value===""?(n(),P(ul,{key:0,chartData:p.value,height:e.height-50+"px"},null,8,["chartData","height"])):(n(),u("span",dl,S(o.value),1))],4))}}),cl={key:0},ml={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"0px"},strole:"status"},xe=D({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(y){const l=y;return(s,e)=>l.loading?(n(),u("div",cl,[s.loading?(n(),u("div",ml,e[0]||(e[0]=[t("span",{class:"visually-hidden"},"Loading...",-1)]))):b("",!0)])):b("",!0)}}),fl={class:"bbb"},vl={class:"p-2"},gl=["onClick"],yl={key:0,class:"ms-1 me-1"},hl=["onSubmit"],bl={class:"mb-1"},_l={class:"d-flex flex-center mt-3",style:{height:"20px"}},wl=["onClick"],xl=["onClick"],kl=D({__name:"ActionSelectButton",props:{action:{},hideGear:{type:Boolean},size:{}},emits:["changed","result"],setup(y,{emit:l}){const s=De(),e=y,o=l,p=z(!1),c=A(()=>s.defaultActions[e.action]),m=z([]),i=z(null),r=A(()=>e.size?e.size:12),a=A(()=>Qt(s.index).filter(h=>h.hooks.includes(e.action)).map(h=>h.id)),d=A(()=>i.value.slice(0,i.value.indexOf(".")));function f(){i.value=c.value,g()}function g(){const x=i.value;if(!x||!s.index[x])return;const h=s.index[x].params,E=s.getContext(x).uiInputs;for(let G of h)G.defaultValue=E[G.name];m.value=JSON.parse(JSON.stringify(h))}async function $(){const x=i.value;for(let h in m.value)s.index[x].params[h].defaultValue=m.value[h].defaultValue;await s.updateDefaultParams(),o("changed")}function M(){g()}async function k(x){const h={};h[e.action]=x,await s.updateDefaultActions(h),await f(),o("changed")}async function T(){p.value=!0,await de();try{const x={function:i.value,context:s.getContext(i.value)},h=await Xt(x);o("result",h)}catch(x){console.warn(x)}p.value=!1}return ie(f),K(()=>s.index,()=>{i.value||f()}),(x,h)=>(n(),u("div",{class:"d-flex",style:se({fontSize:r.value+"px"})},[_(ue,null,{button:w(()=>[t("div",null,[i.value?(n(),P(O,{key:0,class:"p-0 m-0",message:v(s).index[i.value].description},{default:w(()=>[t("span",fl,[ae(S(i.value),1),h[0]||(h[0]=t("i",{class:"ms-1 bi bi-chevron-down"},null,-1))])]),_:1},8,["message"])):b("",!0)])]),popup:w(({hide:E})=>[t("div",vl,[(n(!0),u(R,null,ee(a.value,G=>(n(),u("div",{class:"bb",onClick:oe=>{k(G),E()}},[_(O,{message:v(s).index[G].description},{default:w(()=>[ae(S(G),1)]),_:2},1032,["message"])],8,gl))),256))])]),_:1}),m.value.length&&!e.hideGear?(n(),u("div",yl,[_(ue,null,{button:w(()=>[t("div",null,[_(O,{message:"Options"},{default:w(()=>h[1]||(h[1]=[t("span",{class:"bbb"},[t("i",{class:"bi bi-gear"})],-1)])),_:1})])]),popup:w(({hide:E})=>[t("form",{onSubmit:he(G=>{$(),E()},["prevent"]),class:"p-2"},[(n(!0),u(R,null,ee(m.value,(G,oe)=>(n(),u("div",bl,[_(vt,{input:G,source:d.value},null,8,["input","source"])]))),256)),t("div",_l,[h[2]||(h[2]=t("div",{class:"flex-grow-1"},null,-1)),t("div",{class:"bb",onClick:G=>{M(),E()}},S(x.$t("cancel")),9,wl),t("div",{class:"bb",onClick:G=>{$(),E()}},S(x.$t("confirm")),9,xl)])],40,hl)]),_:1})])):b("",!0),t("div",{class:"bbb d-flex",onClick:T,style:{"align-items":"center","column-gap":"4px"}},[_(xe,{loading:p.value},null,8,["loading"]),h[3]||(h[3]=t("div",null,"Compute",-1))])],4))}}),lt=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],He=1,ze=8;class Je{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,e]=new Uint8Array(l,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=e>>4;if(o!==He)throw new Error(`Got v${o} data when expected v${He}.`);const p=lt[e&15];if(!p)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(l,2,1),[m]=new Uint32Array(l,4,1);return new Je(m,c,p,l)}constructor(l,s=64,e=Float64Array,o){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=e,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const p=lt.indexOf(this.ArrayType),c=l*2*this.ArrayType.BYTES_PER_ELEMENT,m=l*this.IndexArrayType.BYTES_PER_ELEMENT,i=(8-m%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${e}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,ze,l),this.coords=new this.ArrayType(this.data,ze+m+i,l*2),this._pos=l*2,this._finished=!0):(this.data=new ArrayBuffer(ze+c+m+i),this.ids=new this.IndexArrayType(this.data,ze,l),this.coords=new this.ArrayType(this.data,ze+m+i,l*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(He<<4)+p]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=l)}add(l,s){const e=this._pos>>1;return this.ids[e]=e,this.coords[this._pos++]=l,this.coords[this._pos++]=s,e}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return Qe(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,s,e,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:c,nodeSize:m}=this,i=[0,p.length-1,0],r=[];for(;i.length;){const a=i.pop()||0,d=i.pop()||0,f=i.pop()||0;if(d-f<=m){for(let k=f;k<=d;k++){const T=c[2*k],x=c[2*k+1];T>=l&&T<=e&&x>=s&&x<=o&&r.push(p[k])}continue}const g=f+d>>1,$=c[2*g],M=c[2*g+1];$>=l&&$<=e&&M>=s&&M<=o&&r.push(p[g]),(a===0?l<=$:s<=M)&&(i.push(f),i.push(g-1),i.push(1-a)),(a===0?e>=$:o>=M)&&(i.push(g+1),i.push(d),i.push(1-a))}return r}within(l,s,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:p,nodeSize:c}=this,m=[0,o.length-1,0],i=[],r=e*e;for(;m.length;){const a=m.pop()||0,d=m.pop()||0,f=m.pop()||0;if(d-f<=c){for(let k=f;k<=d;k++)it(p[2*k],p[2*k+1],l,s)<=r&&i.push(o[k]);continue}const g=f+d>>1,$=p[2*g],M=p[2*g+1];it($,M,l,s)<=r&&i.push(o[g]),(a===0?l-e<=$:s-e<=M)&&(m.push(f),m.push(g-1),m.push(1-a)),(a===0?l+e>=$:s+e>=M)&&(m.push(g+1),m.push(d),m.push(1-a))}return i}}function Qe(y,l,s,e,o,p){if(o-e<=s)return;const c=e+o>>1;wt(y,l,c,e,o,p),Qe(y,l,s,e,c-1,1-p),Qe(y,l,s,c+1,o,1-p)}function wt(y,l,s,e,o,p){for(;o>e;){if(o-e>600){const r=o-e+1,a=s-e+1,d=Math.log(r),f=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*f*(r-f)/r)*(a-r/2<0?-1:1),$=Math.max(e,Math.floor(s-a*f/r+g)),M=Math.min(o,Math.floor(s+(r-a)*f/r+g));wt(y,l,s,$,M,p)}const c=l[2*s+p];let m=e,i=o;for(Ee(y,l,e,s),l[2*o+p]>c&&Ee(y,l,e,o);m<i;){for(Ee(y,l,m,i),m++,i--;l[2*m+p]<c;)m++;for(;l[2*i+p]>c;)i--}l[2*e+p]===c?Ee(y,l,e,i):(i++,Ee(y,l,i,o)),i<=s&&(e=i+1),s<=i&&(o=i-1)}}function Ee(y,l,s,e){qe(y,s,e),qe(l,2*s,2*e),qe(l,2*s+1,2*e+1)}function qe(y,l,s){const e=y[l];y[l]=y[s],y[s]=e}function it(y,l,s,e){const o=y-s,p=l-e;return o*o+p*p}const $l={class:"point-cloud-wrapper"},Sl={key:0,class:"loading-overlay"},Cl=.01,Il=.1,Ml=D({__name:"ImageMap",props:{points:{default:()=>[]},pointSize:{default:.1},backgroundColor:{default:1710618},showImages:{type:Boolean},showPoints:{type:Boolean}},setup(y,{expose:l}){const s=Z(),e=y,o=z(null),p=z(!1);let c=null,m=null,i=null,r=null,a=null,d=!0;const f=new Map,g={small:new Map,raw:new Map};let $,M=null,k=new rs,T=new is,x=null,h=null,E=new Map;ie(()=>{G(),j(),ke(),o.value&&(M=new ResizeObserver(()=>Ve()),M.observe(o.value))}),Re(()=>{$&&cancelAnimationFrame($),M&&M.disconnect(),oe()}),K(()=>e.points,F=>{j()}),K(()=>e.backgroundColor,F=>{i&&i.setClearColor(new Te(F))});const G=()=>{if(!o.value)return;const F=o.value.clientWidth,I=o.value.clientHeight;c=new os;const B=10,L=F/I;m=new ns(B*L/-2,B*L/2,B/2,B/-2,.1,1e3),m.position.z=10,i=new as({antialias:!0,alpha:!1}),i.setSize(F,I),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.setClearColor(new Te(e.backgroundColor)),o.value.appendChild(i.domElement),ce(i.domElement,m),a=new ls,a.visible=!0,c.add(a)},oe=()=>{i&&o.value&&(o.value.removeChild(i.domElement),i.dispose()),r&&(r.geometry.dispose(),Array.isArray(r.material)?r.material.forEach(F=>F.dispose()):r.material.dispose()),Object.values(g).forEach(F=>F.forEach(I=>I.dispose())),Object.values(g).forEach(F=>F.clear()),f.clear(),c=null,m=null,i=null,r=null,a=null},j=()=>{if(!c)return;p.value=!0;const F=e.points;if(r&&(c.remove(r),r.geometry.dispose(),r=null),f.clear(),F.length===0){p.value=!1;return}const I=new ds(e.pointSize,32),B=new at({color:16777215}),L=new ps(I,B,F.length),re=new cs,ne=new Te;for(let X=0;X<F.length;X++){const N=F[X];f.set(N.sha1,X),re.position.set(N.x,N.y,0),re.updateMatrix(),L.setMatrixAt(X,re.matrix),ne.set(N.color),L.setColorAt(X,ne)}L.instanceMatrix.needsUpdate=!0,L.instanceColor&&(L.instanceColor.needsUpdate=!0),r=L,c.add(L),V(F),e.showImages&&Q(),p.value=!1,ve()};function V(F){E=new Map,h=new Je(F.length);for(let I of F){const B=h.add(I.x,I.y);E.set(B,I),I.id=B}h.finish()}function C(F,I,B,L){return h.range(F,I,B,L).map(ne=>E.get(ne))}const q=(F,I)=>{if(!r)return;const B=f.get(F);if(B!==void 0){const L=new Te(I);r.setColorAt(B,L),r.instanceColor&&(r.instanceColor.needsUpdate=!0)}},U=F=>{F?(a.visible=!0,Q()):a.visible=!1},J=F=>{F?(r.visible=!0,Q()):r.visible=!1};K(()=>e.showImages,U),K(()=>e.showPoints,J);const Q=()=>{if(!e.showImages||!m||!a||!e.points.length)return;const F=a;for(;F.children.length>0;)F.remove(F.children[0]);const I=m.zoom,B=m.left/I+m.position.x,L=m.right/I+m.position.x,re=m.top/I+m.position.y,ne=m.bottom/I+m.position.y;let X=1/I*10;X=Math.min(100,X),X=Math.max(4,X);let N="small";I>5&&(N="raw");const le=new ms,be=kt(I);let ye=C(B,ne,L,re);be>1.25&&(ye=$t(ye,be)),ye.forEach(pe=>{const $e=new fs(e.pointSize*X*pe.ratio,e.pointSize*X),_e=new at({color:16777215,transparent:!0});if(g[N].has(pe.id))_e.map=g[N].get(pe.id);else{const St=s.baseImgUrl+N+"/"+pe.sha1;le.load(St,Ue=>{Ue.colorSpace=vs,g[N].set(pe.id,Ue),_e.map=Ue,_e.needsUpdate=!0,ve()},void 0,()=>_e.color.setHex(16711680))}const tt=new gs($e,_e);tt.position.set(pe.x,pe.y,0),F.add(tt)})},ce=(F,I)=>{F.addEventListener("wheel",N=>{N.preventDefault();const le=.001*I.zoom;I.zoom+=N.deltaY*-le,I.zoom=Math.max(.01,Math.min(20,I.zoom)),I.updateProjectionMatrix(),ve(),e.showImages&&fe()},{passive:!1});let B=!1,L={x:0,y:0};const re=F.clientWidth,ne=F.clientHeight;F.addEventListener("mousedown",N=>{B=!0,L={x:N.clientX,y:N.clientY},F.style.cursor="grabbing",ve()}),window.addEventListener("mousemove",N=>{if(!B)return;const le=N.clientX-L.x,be=N.clientY-L.y,ye=(I.right-I.left)/I.zoom,pe=(I.top-I.bottom)/I.zoom,$e=ye/re,_e=pe/ne;I.position.x-=le*$e,I.position.y+=be*_e,L={x:N.clientX,y:N.clientY},I.updateProjectionMatrix(),ve(),e.showImages&&fe()}),window.addEventListener("mouseup",()=>{B=!1,F.style.cursor="grab",I.updateProjectionMatrix(),ve(),e.showImages&&fe()}),window.addEventListener("mouseleave",()=>{B=!1,F.style.cursor="default"}),F.style.cursor="grab",i.domElement.addEventListener("mousemove",X,!1);function X(N){const le=i.domElement.getBoundingClientRect();T.x=(N.clientX-le.left)/le.width*2-1,T.y=-((N.clientY-le.top)/le.height)*2+1}},Ve=()=>{if(!o.value||!m||!i)return;const F=o.value.clientWidth,I=o.value.clientHeight,B=F/I,L=10;m.left=L*B/-2,m.right=L*B/2,m.top=L/2,m.bottom=L/-2,m.updateProjectionMatrix(),i.setSize(F,I),e.showImages&&Q()},fe=()=>{Q()},ke=()=>{$=requestAnimationFrame(ke),e.showImages&&xt(),i&&c&&m&&d&&(d=!1,i.render(c,m))};function ve(){d=!0}const xt=()=>{if(!m||!a||!e.showImages)return;k.setFromCamera(T,m);const F=k.intersectObjects(a.children);let I=null,B=1/0;if(F.length>0)for(const L of F){const re=L.object,ne=new us;re.getWorldPosition(ne),ne.project(m);const X=ne.x-T.x,N=ne.y-T.y,le=X*X+N*N;le<B&&(B=le,I=re)}I!==x&&(x&&et(x,!1),I&&et(I,!0),x=I)},et=(F,I)=>{F.position.z=I?Il:Cl;const B=I?2:1;F.scale.set(B,B,1),ve()};function kt(F,I=4,B=[.25,.5,1,2,4,8,16]){for(let L=B.length-1;L>=0;L--)if(F>=B[L])return I/Math.pow(2,L);return I*2}function $t(F,I){const B=new Map;for(const L of F){const re=Math.floor(L.x/I),ne=Math.floor(L.y/I),X=`${re},${ne}`,N=re*I,le=(ne+1)*I,be=L.x-N,ye=L.y-le,pe=be*be+ye*ye,$e=B.get(X);(!$e||pe<$e.distSq)&&B.set(X,{point:L,distSq:pe})}return Array.from(B.values()).map(L=>L.point)}return l({setPointColor:q,updatePoints:j}),(F,I)=>(n(),u("div",$l,[t("div",{ref_key:"canvasContainer",ref:o,class:"canvas-container"},null,512),p.value?(n(),u("div",Sl," Processing points... ")):b("",!0)]))}}),Vl=Y(Ml,[["__scopeId","data-v-a8239a59"]]),zl={class:"d-flex flex-column"},El={class:"d-flex pt-1",style:{"column-gap":"4px","align-items":"center"}},Fl={class:"flex-grow-1",style:{"margin-right":"10px","margin-top":"8px"}},Pl=D({__name:"MapView",emits:[],setup(y,{emit:l}){const s=Z();let e=Zt([]);const o=z(!0),p=z(!0),c=z(null),m=z({function:"",context:void 0});function i(r){e.value=[];const a=r.value;for(let d in r.value){const f=a[d],g=s.sha1Index[d][0],$={x:f[0],y:f[1],color:"#FF00FF",sha1:d,ratio:g.containerRatio};e.value.push($)}c.value.updatePoints(e)}return(r,a)=>(n(),u("div",zl,[t("div",El,[a[3]||(a[3]=t("div",null,"Select Maping Function",-1)),_(kl,{size:15,action:"map",onChanged:a[0]||(a[0]=d=>m.value=d),onResult:i}),t("div",null,[Pe(t("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=d=>o.value=d)},null,512),[[Jt,o.value]]),a[2]||(a[2]=ae(" show Images"))])]),t("div",Fl,[_(Vl,{points:v(e),"point-size":.05,"show-images":o.value,"show-points":p.value,"background-color":"#FFFFFF",ref_key:"mapElem",ref:c},null,8,["points","show-images","show-points"])])]))}}),Tl={key:0,class:"m-0 p-0"},Al={key:0,style:{"margin-left":"10px"}},Ol=D({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(y,{expose:l}){Ie();const s=Z(),e=y;l({updateScrollerWidth:k});const o=z({}),p=z(!0),c=z(null),m=z(null),i=z(null),r=z(0),a=z(0),d=Oe({groups:!1}),f=A(()=>e.tab.getVisibleProperties());function g(){c.value&&m.value?r.value=e.height-c.value.clientHeight-m.value.clientHeight-5:c.value?r.value=e.height-c.value.clientHeight-5:r.value=0}function $(T){o.value=e.tab.collection.groupManager.result.index[T],de(()=>g())}function M(){o.value={},de(()=>g())}async function k(){await de(),a.value=c.value?.clientWidth??a.value}return ie(()=>{a.value=c.value.clientWidth,window.addEventListener("resize",k)}),Re(()=>{window.removeEventListener("resize",k)}),K(()=>e.tab.state.imageSize,()=>de(g)),K(()=>e.filterOpen,()=>de(g)),K(()=>e.height,async()=>{await de(g)}),ie(g),(T,x)=>(n(),u(R,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:c},[e.filterOpen?(n(),P(Na,{key:0,tab:e.tab,"compute-status":d},null,8,["tab","compute-status"])):b("",!0)],512),t("div",{ref_key:"boxElem",ref:m,class:"m-0 p-0"},[o.value.id?(n(),u("div",Tl,[_(ll,{tab:e.tab,group:o.value,"image-size":e.tab.state.imageSize,width:a.value,height:50,onClose:M,onScroll:i.value.scrollTo,onUpdate:x[0]||(x[0]=h=>de(()=>g()))},null,8,["tab","group","image-size","width","onScroll"])])):b("",!0)],512),v(s).isLoaded&&a.value>0&&r.value>0&&p.value?(n(),u("div",Al,[e.tab.state.display=="tree"?(n(),P(es,{key:0,"input-key":"main-view-tree","group-manager":e.tab.collection.groupManager,"image-size":e.tab.state.imageSize,height:r.value-0,properties:f.value,"hide-if-modal":!0,"selected-images":e.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:i,width:a.value-25,onRecommend:$},null,8,["group-manager","image-size","height","properties","selected-images","width"])):b("",!0),e.tab.state.display=="grid"?(n(),u("div",{key:1,style:se({width:a.value-12+"px"}),class:"p-0 m-0 grid-container"},[_(ts,{tab:T.tab,manager:e.tab.collection.groupManager,height:r.value-15,width:a.value-40,"selected-properties":f.value,class:"p-0 m-0","show-images":!0,"selected-images":e.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:i,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):b("",!0),e.tab.state.display=="graph"?(n(),P(pl,{key:2,collection:e.tab.collection,height:r.value-15},null,8,["collection","height"])):b("",!0),e.tab.state.display=="map"?(n(),P(Pl,{key:3,style:se({height:r.value-10+"px"})},null,8,["style"])):b("",!0)])):b("",!0)],64))}}),Gl=Y(Ol,[["__scopeId","data-v-87abde29"]]),Ll=D({__name:"TabButton",props:{tab:{}},setup(y){const l=Fe(),s=z(""),e=z(null),o=z(!1),p=z(!1),c=y,m=A(()=>c.tab.state.id);function i(){l.selectMainTab(c.tab.state.id)}function r(){p.value=!0,s.value=c.tab.state.name,de(()=>e.value.focus())}function a(){c.tab.renameTab(s.value),p.value=!1}async function d(){confirm("Are you sure to delete Tab: "+c.tab.state.name)&&l.deleteTab(c.tab.state.id)}return ie(()=>{c.tab.isNew&&r()}),(f,g)=>(n(),u("div",{class:"d-flex d-row me-2",onMouseenter:g[1]||(g[1]=$=>o.value=!0),onMouseleave:g[2]||(g[2]=$=>o.value=!1)},[p.value?(n(),u("div",{key:1,class:W(["tab-button",m.value==v(l).mainTab?" active":""])},[t("form",{onSubmit:he(a,["stop","prevent"])},[Pe(t("input",{onFocusout:a,onKeydown:gt(a,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":g[0]||(g[0]=$=>s.value=$),ref_key:"inputElem",ref:e},null,544),[[Le,s.value]])],32)],2)):(n(),u(R,{key:0},[_(O,{message:"main.menu.rename_tab_tooltip"},{default:w(()=>[t("i",{onClick:r,class:W(["bi bi-pencil me-1 tab-icon hover-light",o.value&&v(l).mainTab==m.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),t("div",{class:W(["tab-button",m.value==v(l).mainTab?" active":""]),onClick:i},[t("span",null,S(c.tab.state.name),1)],2),_(O,{message:"main.menu.delete_tab_tooltip"},{default:w(()=>[t("i",{onClick:d,class:W(["btn-icon bi bi-x tab-icon hover-light",o.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Dl={class:"d-flex d-row",style:{cursor:"pointer"}},Rl={class:"pt-1"},Ul={key:0,class:"bb bi bi-chevron-down"},Bl={key:1,class:"bb bi bi-chevron-right"},jl={style:{"padding-top":"2px","margin-right":"2px"}},Nl={class:"lang"},Hl=["value"],ql=["value"],Wl=D({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(y,{emit:l}){const{locale:s}=dt(),e=Me(),o=Fe(),p=y,c=l;async function m(d){await o.addTab("New Tab")}const i=["fr","en"];function r(){c("update:filterOpen",!p.filterOpen)}function a(d){p.reRender();const f=d.target.value;s.value=f,Ie().setLang(f)}return(d,f)=>(n(),u("nav",null,[t("div",Dl,[t("div",Rl,[t("span",{onClick:r},[p.filterOpen?(n(),u("i",Ul)):(n(),u("i",Bl))])]),(n(!0),u(R,null,ee(v(o).loadedTabs,g=>(n(),u("div",null,[_(Ll,{tab:v(o).getTab(g)},null,8,["tab"])]))),256)),_(O,{message:"main.menu.add_tab_tooltip"},{default:w(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:m,id:"add-tab-button"},f[2]||(f[2]=[t("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),f[5]||(f[5]=t("div",{class:"flex-grow-1"},null,-1)),v(e).clientState.user?(n(),u("div",{key:0,style:{margin:"2px"},class:"bb me-3 text-secondary",onClick:f[0]||(f[0]=g=>v(ss)().disconnectUser())},S(v(e).clientState.user.name),1)):b("",!0),t("div",jl,[_(O,{message:"modals.notif.icon"},{default:w(()=>[t("span",{class:"bb",onClick:f[1]||(f[1]=g=>v(e).showModal(v(me).NOTIF))},f[3]||(f[3]=[t("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),t("div",Nl,[f[4]||(f[4]=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),t("select",{value:d.$i18n.locale,onChange:a},[(n(),u(R,null,ee(i,(g,$)=>t("option",{key:`Lang${$}`,value:g},S(g.toUpperCase()),9,ql)),64))],40,Hl)])])]))}}),We=D({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(y){const l=y,s=A(()=>l.force?"100%":l.max==0?"0%":l.current>=l.max?"100%":Math.floor(l.current/l.max*100)+"%");return(e,o)=>(n(),u("span",null,S(s.value),1))}}),Yl={key:0,class:"center"},Kl={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},Ql={class:"d-flex text-secondary"},Xl={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},Zl={class:"d-flex text-secondary",style:{"font-size":"14px"}},Jl={key:0,class:"bi bi-check text-success"},ei={class:"d-flex text-secondary",style:{"font-size":"14px"}},ti={key:0,class:"bi bi-check text-success"},si={class:"d-flex text-secondary",style:{"font-size":"14px"}},oi={key:0,class:"bi bi-check text-success"},ni={class:"d-flex text-secondary",style:{"font-size":"14px"}},ai={key:0,class:"bi bi-check text-success"},li={class:"d-flex text-secondary",style:{"font-size":"14px"}},ii={key:0,class:"bi bi-check text-success"},ri=D({__name:"DataLoad",setup(y){const l=Z();return(s,e)=>v(l).loadState?(n(),u("div",Yl,[t("div",Kl,[t("div",null,[t("div",Ql,[e[0]||(e[0]=t("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedProperty},null,8,["loading"]),v(l).loadState.finishedProperty?(n(),u("i",Xl)):b("",!0)]),t("div",Zl,[e[1]||(e[1]=t("div",{class:"me-1"},"PropertyGroups",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedPropertyGroups},null,8,["loading"]),v(l).loadState.finishedPropertyGroups?(n(),u("i",Jl)):b("",!0)]),t("div",ei,[e[2]||(e[2]=t("div",{class:"me-1"},"Tags",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedTags},null,8,["loading"]),v(l).loadState.finishedTags?(n(),u("i",ti)):b("",!0)]),t("div",si,[e[3]||(e[3]=t("div",{class:"me-1"},"Instances",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedInstance},null,8,["loading"]),v(l).loadState.finishedInstance?(n(),u("i",oi)):b("",!0),_(We,{current:v(l).loadState.counterInstance,max:v(l).loadState.maxInstance,force:v(l).loadState.finishedInstance},null,8,["current","max","force"])]),t("div",ni,[e[4]||(e[4]=t("div",{class:"me-1"},"InstanceValues",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedInstanceValues},null,8,["loading"]),v(l).loadState.finishedInstanceValues?(n(),u("i",ai)):b("",!0),_(We,{current:v(l).loadState.counterInstanceValue,max:v(l).loadState.maxInstanceValue,force:v(l).loadState.finishedInstanceValues},null,8,["current","max","force"])]),t("div",li,[e[5]||(e[5]=t("div",{class:"me-1"},"ImageValues",-1)),_(xe,{class:"me-2",loading:!v(l).loadState.finishedImageValues},null,8,["loading"]),v(l).loadState.finishedImageValues?(n(),u("i",ii)):b("",!0),_(We,{current:v(l).loadState.counterImageValue,max:v(l).loadState.maxImageValue,force:v(l).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):b("",!0)}}),ui=Y(ri,[["__scopeId","data-v-8b416e86"]]),di={key:0},pi={id:"panoptic"},ci={class:"d-flex flex-row m-0 p-0 overflow-hidden"},mi={class:"w-100"},fi={key:0,class:"custom-hr"},vi={key:2,class:"loading"},gi={class:"text-center"},yi={key:3,class:"loading"},hi=D({__name:"ProjectView",setup(y){const l=Ie(),s=Z(),e=Me(),o=Fe(),p=z(null),c=z(null),m=z(window.innerHeight),i=z(!1),r=z(!0),a=z(!0),d=A(()=>m.value-(c.value?.clientHeight??0)),f=A(()=>p.value?.filteredImages.map(h=>h.id));let g=navigator.userAgent.indexOf("Mac OS X")!==-1;async function $(){r.value=!1,await de(),r.value=!0}ie(async()=>{if(!e.isProjectLoaded){nt.push("/");return}l.init(),de(()=>{window.addEventListener("resize",M),M()}),window.addEventListener("keydown",h=>{h.key=="Meta"&&(H.cmd=!0),h.key=="Control"&&(H.ctrl=!0),h.key=="Alt"&&(g&&(H.ctrl=!0),H.alt=!0),h.key=="Shift"&&(H.shift=!0),h.key=="ArrowLeft"&&(H.left=!0),h.key=="ArrowRight"&&(H.right=!0),h.key=="Z"&&H.ctrl&&s.redo(),h.key=="z"&&H.ctrl&&s.undo(),h.key=="f"&&(H.ctrl||H.cmd)&&(h.preventDefault(),H.ctrlF.emit())}),window.addEventListener("keyup",h=>{h.key=="Meta"&&(H.cmd=!1),h.key=="Control"&&(H.ctrl=!1),h.key=="Alt"&&(g&&(H.ctrl=!1),H.alt=!1),h.key=="Shift"&&(H.shift=!1),h.key=="ArrowLeft"&&(H.left=!1),h.key=="ArrowRight"&&(H.right=!1)}),window.addEventListener("mousemove",h=>{H.ctrl=h.ctrlKey,H.alt=h.altKey,H.shift=h.shiftKey,H.cmd=h.metaKey,g&&(H.ctrl=H.ctrl||H.alt)})}),Re(()=>{window.removeEventListener("resize",M),Ie().clear()});function M(){m.value=window.innerHeight,i.value=!0}function k(){e.showModal(me.EXPORT,f)}function T(){nt.push("/")}function x(){p.value&&p.value.updateScrollerWidth()}return(h,E)=>r.value?(n(),u("div",di,[p.value&&!p.value.imageList?(n(),P(ys,{key:0,tutorial:"project"})):b("",!0),t("div",pi,[t("div",ci,[v(s).isLoaded?v(s).isLoaded?(n(),u(R,{key:1},[t("div",null,[_(Io,{onExport:E[0]||(E[0]=G=>k()),onToggle:x})]),t("div",mi,[t("div",{class:"ms-1",ref_key:"navElem",ref:c},[_(Wl,{"re-render":$,filterOpen:a.value,"onUpdate:filterOpen":E[1]||(E[1]=G=>a.value=G)},null,8,["filterOpen"])],512),i.value?(n(),u("div",fi)):b("",!0),_(yt,{id:v(o).mainTab},{default:w(({tab:G})=>[_(Gl,{tab:G,height:d.value,ref_key:"mainViewRef",ref:p,"filter-open":a.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):v(e).isProjectLoaded?(n(),u("div",yi,E[2]||(E[2]=[t("i",{class:"spinner-border",role:"status"},null,-1),t("span",{class:"ms-1"},"Loading...",-1)]))):(n(),u("div",vi,[t("div",gi,[t("div",null,S(h.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:T,style:{"font-size":"50px",cursor:"pointer"}})])])):(n(),u("div",{key:0,class:"d-flex flex-column w-100",style:se({height:m.value+"px"})},[_(ui,{class:"flex-grow-1"})],4))])])])):b("",!0)}}),xi=Y(hi,[["__scopeId","data-v-ddaa0fb1"]]);export{xi as default};
