import{d as z,h as N,r as x,c as I,i as se,o as s,a as o,b as t,w as ie,v as de,F as V,m as U,s as $,y as re,t as g,k as M,x as k,n as j,D as X,z as Ge,_ as R,A as pe,B as A,P as S,C as Ne,e as n,E as we,l as f,G as Te,H as Re,I as Ue,S as je,J as He,K as Ae,L as Be,p as Q,f as W,N as $e,O as T,Q as ze,q as Y,T as qe,R as Pe,U as B,V as fe,W as Ce,u as xe,M as te,g as ke,X as Ke,Y as Qe,Z as Me,$ as Oe,a0 as We,a1 as ee,a2 as Z,a3 as Ye,a4 as Xe,a5 as Ze,a6 as Je,a7 as et,a8 as tt,a9 as le,aa as st,ab as ot,ac as J,ad as at,ae as nt,af as lt,ag as it,j as Ve,ah as H,ai as rt}from"./index-6c4a3a52.js";import{_ as dt}from"./Tutorial-1ca30169.js";const pt={class:"mb-1 ps-2 pe-2"},ut=["onClick"],Ie=z({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const e=N(),a=d,p=r,v=x(null),y=x(""),b=I(()=>{let _=e.propertyList;return a.ignoreIds&&(_=_.filter(u=>!a.ignoreIds.includes(u.id))),_.filter(u=>u.name.includes(y.value))});return se(()=>v.value.focus()),(_,u)=>(s(),o("div",null,[t("div",pt,[ie(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:v,"onUpdate:modelValue":u[0]||(u[0]=i=>y.value=i)},null,512),[[de,y.value]])]),(s(!0),o(V,null,U(b.value,i=>(s(),o("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:l=>p("select",i.id)},[$(re,{type:i.type,class:"me-2"},null,8,["type"]),t("a",null,g(i.name),1)],8,ut))),256))]))}}),ct=["disabled"],_t={class:"m-0 p-1"},mt=["onClick"],vt=z({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=N(),a=d,p=r,v=x(null),y=I(()=>e.data.properties[a.propertyId]),b=I(()=>Ge(y.value.type));async function _(u){p("update:modelValue",u),v.value.hide()}return(u,i)=>(s(),M(X,{onHide:i[0]||(i[0]=l=>p("hide")),ref_key:"dropdownElem",ref:v,parent:a.parent},{button:k(()=>[t("div",{class:j(["text-nowrap",a.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:a.disabled},[t("span",null,g(u.$t("modals.filters.operators."+a.modelValue)),1)],10,ct)]),popup:k(()=>[t("div",_t,[(s(!0),o(V,null,U(b.value,l=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>_(l)},[t("a",null,g(u.$t("modals.filters.operators."+l)),1)],8,mt))),256))])]),_:1},8,["parent"]))}});const yt=R(vt,[["__scopeId","data-v-29ed354e"]]),gt=d=>(Q("data-v-49043c13"),d=d(),W(),d),ht={class:"m-0 p-0"},ft={key:1},bt={class:"d-flex mode-header"},$t={class:"me-3"},kt=gt(()=>t("div",{class:"flex-fill"},null,-1)),wt={key:0,class:"me-2",style:{width:"100%"}},xt=z({__name:"FilterDropdown",props:{manager:pe,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=N(),e=d,a=x(null),p=x(null),v=x(null),y=x(0),b=x(null),_=x(null),u=I(()=>e.filterId!==void 0?e.filterId:b.value),i=I(()=>{if(!(u.value==null||u.value==-1))return e.manager.filterIndex[u.value]}),l=I(()=>i.value==null?void 0:r.data.properties[i.value.propertyId]);function c(){y.value=e.mode,e.mode==2&&e.filterId==null&&G(e.propertyId)}function m(){a.value&&a.value.hide()}function h(){y.value=0}function w(){m(),e.manager.deleteFilter(u.value),e.manager.update(!0)}function G(P){let C=e.manager.addNewFilter(P,e.parentId);e.manager.update(!0),b.value=C.id,y.value=2}function K(P){_.value=null,e.manager.updateFilter(u.value,{operator:P}),e.manager.update(!0),p.value&&p.value.focus()}function ae(){console.log("update value",_.value),e.manager.updateFilter(u.value,{value:_.value}),e.manager.update(!0)}function O(){if(!i.value)return;const P=r.data.properties[i.value.propertyId];if(Ae(P.type))return;const C=_.value??Be(P.type);i.value.value!=C&&ae()}function E(){i.value&&(r.data.properties[i.value.propertyId].type==S.date&&i.value.value?_.value=new Date(i.value.value):_.value=i.value.value)}return se(E),A(()=>i.value,()=>E()),(P,C)=>(s(),M(X,{ref_key:"dropdownElem",ref:a,onShow:c,onHide:h,parent:e.parent},{button:k(()=>[t("div",ht,[Ne(P.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[y.value!=0?(s(),o(V,{key:0},[y.value==1?(s(),M(Ie,{key:0,onSelect:G,"ignore-ids":[n(we).folders]},null,8,["ignore-ids"])):f("",!0),y.value==2?(s(),o("div",ft,[t("div",bt,[t("div",$t,g(l.value.name),1),$(yt,{"property-id":i.value.propertyId,"model-value":i.value.operator,"onUpdate:modelValue":K,parent:v.value},null,8,["property-id","model-value","parent"]),kt,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:w})])]),n(Te)(i.value.operator)?(s(),o("div",wt,[l.value.type==n(S).multi_tags||l.value.type==n(S).tag?(s(),M(Re,{key:0,modelValue:_.value,"onUpdate:modelValue":[C[0]||(C[0]=F=>_.value=F),ae],"auto-focus":!0,property:n(r).data.properties[i.value.propertyId],ref_key:"inputElem",ref:p,onHide:m},null,8,["modelValue","property"])):l.value.type==n(S).color?(s(),M(Ue,{key:1,property:l.value,modelValue:_.value,"onUpdate:modelValue":[C[1]||(C[1]=F=>_.value=F),C[2]||(C[2]=()=>{m(),O()})]},null,8,["property","modelValue"])):l.value.type==n(S).date?(s(),M(je,{key:2,property:l.value,modelValue:_.value,"onUpdate:modelValue":[C[3]||(C[3]=F=>_.value=F),C[4]||(C[4]=()=>{m(),O()})]},null,8,["property","modelValue"])):(s(),M(He,{key:3,"no-html":!0,modelValue:_.value,"onUpdate:modelValue":C[5]||(C[5]=F=>_.value=F),width:-1,"min-height":20,"no-nl":n(r).data.properties[i.value.propertyId].type==n(S).number,"url-mode":n(r).data.properties[i.value.propertyId].type==n(S).url,"only-number":n(r).data.properties[i.value.propertyId].type==n(S).number,onBlur:O,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):f("",!0)])):f("",!0)],64)):f("",!0)],512)]),_:3},8,["parent"]))}});const ce=R(xt,[["__scopeId","data-v-49043c13"]]),oe=d=>(Q("data-v-81b7150f"),d=d(),W(),d),It={class:"d-flex flex-row"},St={key:1,class:"d-flex",style:{width:"150px"}},Ct={class:"flex-grow-1"},Mt={key:1,style:{"padding-top":"1px"}},Vt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Ft=oe(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),Et={class:"text-center",style:{width:"20px","margin-top":"2px"}},Tt=oe(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),zt=oe(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Pt={key:0,class:"ms-3 pt-1"},Ot=oe(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Dt=oe(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Lt=oe(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Gt=oe(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Nt={key:1},Rt=z({__name:"PropertyOptions",props:{property:Object},setup(d){const r=N(),e=r.getTabManager(),a=d,p=x(!1),v=x(!1),y=x(""),b=x(!1),_=I(()=>r.getTab()),u=I(()=>_.value.visibleProperties[a.property.id]==!0),i=I(()=>e.collection.filterManager.state.filter.filters.some(F=>!F.isGroup&&F.propertyId==a.property.id)),l=I(()=>e.collection.groupManager.state.groupBy.includes(a.property.id)),c=I(()=>e.collection.sortManager.state.sortBy.includes(a.property.id)),m=I(()=>{if(i.value)return e.collection.filterManager.state.filter.filters.find(F=>!F.isGroup&&F.propertyId==a.property.id).id}),h=()=>e.collection.filterManager,w=I(()=>e.getSha1Mode());function G(){u.value?e.setVisibleProperty(a.property.id,!1):e.setVisibleProperty(a.property.id,!0)}function K(){p.value?p.value=!1:(p.value=!0,y.value=a.property.name),v.value=!1}function ae(){a.property.type!=S.tag&&a.property.type!=S.multi_tags||(v.value?v.value=!1:v.value=!0,p.value=!1)}function O(){c.value?e.collection.sortManager.delSort(a.property.id):e.collection.sortManager.setSort(a.property.id),e.collection.sortManager.update(!0)}function E(){l.value?e.collection.groupManager.delGroupOption(a.property.id):e.collection.groupManager.setGroupOption(a.property.id),e.collection.groupManager.update(!0)}function P(){confirm("Supprimer la propriété: "+a.property.name+" ?")&&r.deleteProperty(a.property.id)}async function C(){y.value!=""&&(await r.updateProperty(a.property.id,y.value),K())}return A(()=>a.property,()=>{p.value=!1}),(F,D)=>(s(),o("div",{class:j(b.value?"hover-light":"")},[t("div",It,[p.value?f("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[$(re,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:D[0]||(D[0]=L=>b.value=!0),onMouseleave:D[1]||(D[1]=L=>b.value=!1)},null,8,["type"]),t("span",null,g(a.property.name),1)])),p.value?(s(),o("div",St,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:D[2]||(D[2]=L=>b.value=!0),onMouseleave:D[3]||(D[3]=L=>b.value=!1)},null,32)]),t("div",Ct,[a.property.id>=0?ie((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":D[4]||(D[4]=L=>y.value=L),onChange:C},null,544)),[[de,y.value]]):(s(),o("span",Mt,[$(re,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,g(a.property.name),1)]))])])):f("",!0),t("div",Vt,[a.property.mode==n($e).id?(s(),M(T,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[Ft]),_:1})):f("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:G,class:"btn-icon text-center"},[w.value&&a.property.mode==n($e).id?(s(),M(T,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:D[5]||(D[5]=ze(()=>{},["stop"]))})]),_:1})):(s(),M(T,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:j("bi bi-eye text-"+(u.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",Et,[a.property.type==n(S).tag||a.property.type==n(S).multi_tags?(s(),o("div",{key:0,onClick:ae,style:{cursor:"pointer"}},[v.value?(s(),M(T,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Tt]),_:1})):(s(),M(T,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[zt]),_:1}))])):f("",!0)])]),t("div",null,[p.value?(s(),o("div",Pt,[t("div",{class:j(["options hover-light",i.value?" text-primary":""])},[$(ce,{manager:h(),"filter-id":m.value,mode:2,"property-id":d.property.id},{default:k(()=>[Ot,Y(g(F.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:j(["options hover-light",c.value?" text-primary":""]),onClick:O},[Dt,Y(g(F.$t("main.menu.sort.title")),1)],2),t("div",{class:j(["options hover-light",l.value?" text-primary":""]),onClick:E},[Lt,Y(g(F.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:P},[Gt,Y(g(F.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):v.value?(s(),o("div",Nt,[$(qe,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])],2))}});const Fe=R(Rt,[["__scopeId","data-v-81b7150f"]]),Ut=t("i",{class:"bi bi-three-dots base-hover"},null,-1),jt={class:"p-2"},Ht=["onClick"],At=t("i",{class:"bi bi-arrow-clockwise"},null,-1),Bt=z({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=N(),e=d;function a(){r.reImportFolder(e.folder.id)}return(p,v)=>(s(),M(X,{teleport:!0},{button:k(()=>[Ut]),popup:k(({hide:y})=>[t("div",jt,[t("div",{class:"base-hover p-1",onClick:b=>{a(),y()}},[At,Y(" Re import")],8,Ht)])]),_:1}))}}),qt=["onMouseenter"],Kt=["onClick"],Qt={class:"text-secondary"},Wt=["onClick"],Yt=z({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:pe,root:{type:Boolean,default:!0}},setup(d){const r=N(),e=d,a=x(null),p=I(()=>{let i={};const l=new Set(e.filterManager.state.folders);return e.folders.map(c=>c.id).forEach(c=>{l.has(c)&&(i[c]=!0)}),i}),v=I(()=>{let i={};return e.folders.map(l=>l.id).forEach(l=>{e.visibleFolders[l]&&(i[l]=!0)}),i}),y=I(()=>{let i={};return e.folders.forEach(l=>{let c=[];p.value[l.id]&&c.push("selected"),i[l.id]=c.join(" ")}),i});function b(i){let l=e.visibleFolders;l[i]?delete l[i]:l[i]=!0}function _(i){let l=new Set(e.filterManager.state.folders);const c=l.has(i),m=r.data.folders[i].parent!=null&&l.has(r.data.folders[i].parent);c&&!m?(l.delete(i),fe(i).forEach(h=>l.delete(h.id))):(u(i,l),l.add(i),fe(i).forEach(h=>l.add(h.id)),Ce(r.data.folders[i]).forEach(h=>l.delete(h.id))),e.filterManager.setFolders(Array.from(l)),e.filterManager.update(!0)}function u(i,l){const c=Ce(r.data.folders[i]);let m;for(let h of c)if(l.has(h.id))m=h;else break;m!=null&&fe(m.id).forEach(h=>l.delete(h.id))}return(i,l)=>{const c=Pe("FolderList2",!0);return s(),o("ul",{class:j(e.root?"tree":""),style:B(e.root?"padding-left:0px;":"")},[(s(!0),o(V,null,U(d.folders,m=>(s(),o("li",{style:B(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:h=>a.value=m.id,onMouseleave:l[0]||(l[0]=h=>a.value=null)},[t("summary",{class:j(y.value[m.id]),onClick:h=>_(m.id)},[Y(g(m.name)+" ",1),t("span",Qt,g(m.count),1)],10,Kt),m.children&&m.children.length>0?(s(),o("i",{key:0,onClick:h=>b(m.id),class:j("bi bi-chevron-"+(v.value[m.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Wt)):f("",!0),t("span",{class:j(a.value===m.id?"visible-option":"invisible-option")},[$(Bt,{folder:m,style:{display:"inline-block"}},null,8,["folder"])],2),m.children&&m.children.length>0&&v.value[m.id]?(s(),M(c,{key:1,folders:m.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,qt))),256))],6)}}});const Xt=R(Yt,[["__scopeId","data-v-9f26453b"]]),Zt={class:"text-center"},Jt={class:"w-100 text-center",style:{"font-size":"10px"}},es={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},ts=z({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=I(()=>r.task.total-r.task.remain-r.task.computing),a=I(()=>r.task.total);return(p,v)=>(s(),o("div",Zt,[Y(g(r.task.name)+" ",1),t("div",Jt,g(e.value)+" / "+g(a.value)+" "+g(p.$t("main.nav.tasks.done")),1),a.value>0?(s(),o("div",es,[t("div",{class:"progress-bar",style:B(`width: ${e.value/a.value*100}%`)},null,4)])):f("",!0)]))}}),q=d=>(Q("data-v-d95a976a"),d=d(),W(),d),ss={class:"menu overflow-scroll"},os={class:""},as={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ns={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ls=q(()=>t("i",{class:"bi bi-gear"},null,-1)),is=[ls],rs=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),ds=[rs],ps=q(()=>t("div",{class:"custom-hr"},null,-1)),us={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},cs={class:"d-flex align-items-center"},_s=q(()=>t("i",{class:"bi bi-plus"},null,-1)),ms={class:"overflow-scroll"},vs={key:0,id:"import"},ys=q(()=>t("div",{class:"custom-hr"},null,-1)),gs={class:"pt-1 pb-2"},hs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},fs=q(()=>t("div",{class:"custom-hr"},null,-1)),bs={key:0,class:"ps-2 pe-2"},$s={class:"p-1"},ks={key:0,class:"custom-hr"},ws={key:1,class:"p-2"},xs=q(()=>t("div",{class:"custom-hr"},null,-1)),Is={key:0,class:"float-end"},Ss={class:"text-center"},Cs={class:"w-100 text-center",style:{"font-size":"10px"}},Ms={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Vs={key:2,class:"p-2"},Fs={class:"w-100 text-center",style:{"font-size":"10px"}},Es={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ts=q(()=>t("div",{class:"custom-hr"},null,-1)),zs={class:"p-2 mt-0"},Ps={class:"d-flex"},Os=q(()=>t("span",{class:"flex-grow-1"},null,-1)),Ds={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Ls=q(()=>t("span",{class:"sr-only"},null,-1)),Gs=[Ls],Ns={key:1,class:"bb me-1"},Rs={class:"bb me-2"},Us={key:0,class:"mt-2"},js={key:0,class:"property-item"},Hs=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),As=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Bs=q(()=>t("div",{class:"custom-hr"},null,-1)),qs={class:"p-2 mt-0"},Ks={key:0,class:"mt-2"},Qs={key:0,class:"property-item"},Ws=z({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=N(),a=xe(),p=e.getTabManager(),v=x(!1);x(null);const y=x(!1),b=async l=>{a.showModal(te.IMPORT)},_=I(()=>e.backendStatus.tasks.filter(l=>!(l.name=="Load Plugin"&&l.done)));function u(){a.showModal(te.FOLDERSELECTION,{callback:i,mode:"images"})}function i(l){l&&e.addFolder(l)}return A(()=>e.status.import.to_import,()=>v.value=!0),(l,c)=>{var m;return s(),o("div",ss,[t("div",os,[t("div",null,[t("div",as,[t("div",ns,[t("div",{class:"flex-grow-1 text-capitalize",onClick:c[0]||(c[0]=()=>{})},g((m=n(a).data.status.selectedProject)==null?void 0:m.name),1),t("div",{class:"base-hover p-1",onClick:c[1]||(c[1]=h=>n(a).showModal(n(te).SETTINGS))},is),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:c[2]||(c[2]=h=>n(a).closeProject())},ds)])]),ps,t("div",us,[t("div",cs,[t("div",null,[t("b",null,g(l.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:c[3]||(c[3]=h=>{u(),n(ke)()})},[$(T,{message:"main.nav.folders.add"},{default:k(()=>[_s]),_:1})])]),t("div",ms,[n(e).getTab()?(s(),M(Xt,{key:0,folders:n(e).folderRoots,"filter-manager":n(p).collection.filterManager,"visible-folders":n(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):f("",!0)])]),_.value&&_.value.length?(s(),o("div",vs,[ys,t("div",gs,[t("div",hs,[t("div",null,[t("b",null,g(l.$t("main.nav.tasks.title")),1)])]),fs,n(e).backendStatus?(s(),o("div",bs,[(s(!0),o(V,null,U(_.value,(h,w)=>(s(),o("div",$s,[w?(s(),o("div",ks)):f("",!0),$(ts,{task:h},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0),n(e).status.import.to_import!=null&&n(e).status.import.to_import>0&&v.value?(s(),o("div",ws,[xs,n(e).status.import.done?(s(),o("div",Is,[t("i",{class:"bi bi-x base-hover",onClick:c[4]||(c[4]=h=>v.value=!1)})])):f("",!0),t("div",Ss,[t("b",null,g(l.$t("main.menu.import_status_title")),1)]),t("div",Cs,g(n(e).status.import.imported)+" / "+g(n(e).status.import.to_import)+" importées ",1),n(e).status.import.to_import>0?(s(),o("div",Ms,[t("div",{class:"progress-bar",style:B(`width: ${n(e).status.import.imported/n(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),n(e).status.import.to_import!=null&&n(e).status.import.to_import>0&&v.value?(s(),o("div",Vs,[t("div",Fs,g(n(e).status.import.computed)+" / "+g(n(e).status.import.to_import)+" computed ",1),n(e).status.import.to_import>0?(s(),o("div",Es,[t("div",{class:"progress-bar",style:B(`width: ${n(e).status.import.computed/n(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),Ts,t("div",zs,[t("div",Ps,[$(T,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,g(l.$t("main.nav.properties.title")),1)]),_:1}),Os,y.value?(s(),o("span",Ds,Gs)):(s(),o("span",Ns,[$(T,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:b})]),_:1})])),t("span",Rs,[$(T,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:c[5]||(c[5]=h=>n(a).showModal(n(te).EXPORT,void 0))})]),_:1})])]),n(e).status.loaded?(s(),o("div",Us,[(s(!0),o(V,null,U(n(e).data.properties,h=>(s(),o(V,null,[h.id>=0?(s(),o("div",js,[$(Fe,{property:h},null,8,["property"])])):f("",!0)],64))),256)),Hs,t("div",{id:"add-property",onClick:c[6]||(c[6]=h=>{n(a).showModal(n(te).PROPERTY,void 0),n(ke)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[As,t("span",null,g(l.$t("main.nav.properties.add_property")),1)])])):f("",!0)]),Bs,t("div",qs,[$(T,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,g(l.$t("main.nav.computed.title")),1)]),_:1}),n(e).status.loaded?(s(),o("div",Ks,[(s(!0),o(V,null,U(n(e).data.properties,h=>(s(),o(V,null,[h.id<0?(s(),o("div",Qs,[$(T,{pos:"bottom",message:"main.nav.computed."+Math.abs(h.id).toString()+"_tooltip"},{default:k(()=>[$(Fe,{property:h},null,8,["property"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])])}}});const Ys=R(Ws,[["__scopeId","data-v-d95a976a"]]),Xs={class:"text-nowrap text-secondary"},Ee=z({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=N(),e=d,a=I(()=>r.data.properties[e.propertyId].tags);return(p,v)=>(s(),o("div",Xs,[e.value&&e.value.length>0?(s(!0),o(V,{key:0},U(e.value,y=>(s(),o("span",null,[$(Ke,{tag:a.value[y].value,color:a.value[y].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(V,{key:1},[Y(" Add Tags... ")],64))]))}}),Zs={key:0},Js={key:1},eo={key:2},to={key:3},so={key:0,class:"bi bi-square"},oo={key:1,class:"bi bi-check-square"},ao={key:5},no={key:6},lo={key:7},io={key:8},ro={key:9},po={key:10},uo={key:11},co={key:12},_o={key:13},mo={key:1,class:"text-secondary"},vo=z({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=I(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":Qe[p].color}),a=I(()=>[S._ahash,S._folders,S._sha1,S.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,v)=>d.value!=null?(s(),o(V,{key:0},[r.property.type==n(S)._ahash?(s(),o("div",Zs,g(a.value),1)):f("",!0),r.property.type==n(S)._folders?(s(),o("div",Js,g(a.value),1)):f("",!0),r.property.type==n(S)._sha1?(s(),o("div",eo,g(a.value),1)):f("",!0),r.property.type==n(S).checkbox?(s(),o("div",to,[a.value?(s(),o("i",so)):(s(),o("i",oo))])):f("",!0),r.property.type==n(S).color?(s(),o("div",{key:4,style:B({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):f("",!0),r.property.type==n(S).date?(s(),o("div",ao,g(a.value),1)):f("",!0),r.property.type==n(S).image_link?(s(),o("div",no)):f("",!0),r.property.type==n(S).multi_tags?(s(),o("div",lo,[$(Ee,{"property-id":r.property.id,value:a.value},null,8,["property-id","value"])])):f("",!0),r.property.type==n(S).number?(s(),o("div",io,g(a.value),1)):f("",!0),r.property.type==n(S).path?(s(),o("div",ro,g(a.value),1)):f("",!0),r.property.type==n(S).string?(s(),o("div",po,g(a.value),1)):f("",!0),r.property.type==n(S)._id||r.property.type==n(S)._height||r.property.type==n(S)._width?(s(),o("div",uo,g(a.value),1)):f("",!0),r.property.type==n(S).tag?(s(),o("div",co,[$(Ee,{"property-id":r.property.id,value:a.value},null,8,["property-id","value"])])):f("",!0),r.property.type==n(S).url?(s(),o("div",_o,g(a.value),1)):f("",!0)],64)):(s(),o("span",mo,"..."))}}),yo={class:"d-flex bb ps-1 overflow-hidden"},go={class:"m-0 p-0 me-2 text-nowrap"},ho={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},fo=z({__name:"FilterPreview",props:{filter:Object},setup(d){const r=N(),e=d,a=I(()=>r.data.properties[e.filter.propertyId]);return(p,v)=>(s(),o("td",yo,[t("div",go,g(p.$t("modals.filters.operators."+e.filter.operator)),1),n(Te)(e.filter.operator)?(s(),o("div",ho,[$(vo,{property:a.value,value:e.filter.value},null,8,["property","value"])])):f("",!0)]))}});const bo=R(fo,[["__scopeId","data-v-79b26ee7"]]),$o={class:"m-0 bb",style:{}},ko={class:"p-2"},wo=z({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const e=N(),a=d,p=r,v=x(null);function y(b){v.value.hide(),p("update:modelValue",e.data.properties[b])}return(b,_)=>(s(),M(X,{ref_key:"dropdownElem",ref:v,"auto-focus":!1},{button:k(()=>[t("div",$o,[$(re,{type:a.modelValue.type},null,8,["type"]),Y(" "+g(a.modelValue.name),1)])]),popup:k(()=>[t("div",ko,[$(Ie,{modelValue:a.modelValue,"onUpdate:modelValue":_[0]||(_[0]=u=>a.modelValue=u),onSelect:y,"ignore-ids":[n(we).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),_e=d=>(Q("data-v-b9005f3e"),d=d(),W(),d),xo={class:"filter-group"},Io={class:"table table-sm"},So={class:"align-top p-0 m-0"},Co={key:0,class:"m-0 p-0"},Mo={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Vo={class:""},Fo=["onClick"],Eo=_e(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),To={key:2,class:"text-secondary"},zo={key:0,class:"p-0 m-0 ps-2"},Po={key:1,class:"p-0 m-0 ps-2"},Oo={class:"border rounded"},Do={class:""},Lo=["onClick"],Go=_e(()=>t("i",{class:"bi bi-trash"},null,-1)),No=[Go],Ro={class:"d-flex text-secondary ms-2"},Uo={class:"add-options hover-light"},jo=_e(()=>t("i",{class:"bi bi-plus"},null,-1)),Ho=_e(()=>t("i",{class:"bi bi-plus"},null,-1)),Ao=z({__name:"FilterGroupInput",props:{filter:Object,manager:pe,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=N(),a=d,p=I(()=>a.filter),v=I(()=>p.value.filters),y=I(()=>{let l=255-(p.value.depth+1)*5;return`background: rgb(${l},${l},${l});`});function b(l,c){a.manager.updateFilter(l,{propertyId:c}),a.manager.update(!0)}function _(l){a.manager.deleteFilter(l.id),a.manager.update(!0)}function u(l){a.manager.addNewFilterGroup(l),a.manager.update(!0)}function i(l,c){a.manager.updateFilterGroup(l,c),a.manager.update(!0)}return(l,c)=>{const m=Pe("FilterGroupInput",!0);return s(),o("div",xo,[t("table",Io,[(s(!0),o(V,null,U(v.value,(h,w)=>(s(),o("tr",null,[t("td",So,[w==0?(s(),o("div",Co,g(l.$t("modals.filters.where")),1)):w==1?(s(),M(X,{key:1},{button:k(()=>[t("div",Mo,[t("span",Vo,g(l.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:G})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:G},[t("div",{class:"base-btn",onClick:c[0]||(c[0]=K=>i(p.value.id,n(Me).and))},g(l.$t("modals.filters.and")),1),Eo,t("div",{class:"base-btn",onClick:c[1]||(c[1]=K=>i(p.value.id,n(Me).or))},g(l.$t("modals.filters.or")),1)],8,Fo)]),_:1})):(s(),o("span",To,g(p.value.groupOperator),1))]),h.propertyId!==void 0?(s(),o("td",zo,[$(wo,{"model-value":n(e).data.properties[h.propertyId],"onUpdate:modelValue":G=>b(h.id,G.id)},null,8,["model-value","onUpdate:modelValue"])])):f("",!0),h.propertyId!==void 0?(s(),o("td",Po,[$(ce,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":h.id,parent:a.parent},{default:k(()=>[$(bo,{filter:h},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:B(y.value)},[t("div",Oo,[$(m,{filter:h,manager:a.manager},null,8,["filter","manager"])])],4)),t("td",Do,[t("span",{class:"base-btn",onClick:G=>_(h)},No,8,Lo)])]))),256))]),t("div",Ro,[$(ce,{manager:a.manager,"parent-id":p.value.id},{default:k(()=>[t("div",Uo,[jo,Y(g(l.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:c[2]||(c[2]=h=>u(p.value.id))},[Ho,Y(g(l.$t("modals.filters.new_group")),1)])])])}}});const Bo=R(Ao,[["__scopeId","data-v-b9005f3e"]]),qo=d=>(Q("data-v-c6a37a82"),d=d(),W(),d),Ko={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Qo={key:0},Wo=qo(()=>t("span",{class:"text-primary"},"Text Query",-1)),Yo={key:0,class:"or-separator"},Xo={key:0,class:"or-separator"},Zo={key:0,class:"m-1 p-0"},Jo=z({__name:"GlobalFilterInputDropdown",props:{manager:pe},emits:["update:modelValue"],setup(d,{emit:r}){const e=N(),a=d,p=x(null),v=x(null),y=I(()=>{let _=b(a.manager.state.filter),u={};return _.forEach(i=>u[i.propertyId]=i),Object.values(u)});function b(_){let u=[];for(let i of _.filters)i.isGroup?u.push(...b(i)):u.push(i);return u}return A(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&v.value.hide()}),(_,u)=>(s(),M(X,{ref_key:"dropdownElem",ref:v},{button:k(()=>[t("div",null,[y.value.length||a.manager.state.query?(s(),o("div",Ko,[a.manager.state.query?(s(),o("div",Qo,[Wo,y.value.length?(s(),o("span",Yo,"|")):f("",!0)])):f("",!0),(s(!0),o(V,null,U(y.value,(i,l)=>(s(),o("div",null,[l>0?(s(),o("span",Xo,"|")):f("",!0),i.propertyId==n(we).id?(s(),M(re,{key:1,type:n(e).data.properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),t("span",null,g(n(e).data.properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(n(e).data.properties).length>0?(s(),o("div",Zo,[$(Bo,{filter:a.manager.state.filter,manager:a.manager,parent:p.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const ea=R(Jo,[["__scopeId","data-v-c6a37a82"]]),ta=d=>(Q("data-v-1d7e82c5"),d=d(),W(),d),sa={class:"d-flex flex-row filter-form"},oa={class:"pt-1 pb-1"},aa=ta(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),na=z({__name:"FilterForm",props:{manager:pe},setup(d){const r=d;return(e,a)=>(s(),o("div",sa,[t("div",oa,g(e.$t("main.menu.filters"))+": ",1),$(ea,{manager:r.manager},null,8,["manager"]),$(ce,{manager:r.manager,class:"p-1"},{default:k(()=>[aa]),_:1},8,["manager"])]))}});const la=R(na,[["__scopeId","data-v-1d7e82c5"]]),ia=d=>(Q("data-v-59c1ca07"),d=d(),W(),d),ra=ia(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),da={class:"p-1"},pa=z({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,a=r,p=x(null);return(v,y)=>(s(),M(X,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[ra]),popup:k(()=>[t("div",da,[$(Ie,{onClick:y[0]||(y[0]=b=>n(ke)()),onSelect:y[1]||(y[1]=b=>{a("select",b),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const De=R(pa,[["__scopeId","data-v-59c1ca07"]]),ua={class:"base-hover ps-1 pe-1"},ca={class:"main"},_a=["onClick"],ma=z({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,a=r,p=Object.values(Oe);function v(y){a("update:modelValue",y)}return(y,b)=>(s(),M(X,null,{button:k(()=>[t("div",ua,g(e.modelValue),1)]),popup:k(({hide:_})=>[t("div",ca,[(s(!0),o(V,null,U(n(p),u=>(s(),o("div",{class:"base-hover option",onClick:i=>{v(u),_()}},g(u),9,_a))),256))])]),_:1}))}});const va=R(ma,[["__scopeId","data-v-cc9d0d61"]]),ya=d=>(Q("data-v-a27bea28"),d=d(),W(),d),ga=ya(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ha={class:""},fa={class:"d-flex ipt"},ba={class:"ms-2",min:"1"},$a=z({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,a=r,p=x(1),v=x(Oe.Year);function y(){e.option.stepSize==p.value&&e.option.stepUnit==v.value||a("change",{stepSize:p.value,stepUnit:v.value})}function b(){p.value=e.option.stepSize??1,v.value=e.option.stepUnit}return A(()=>e.option,b),se(b),A(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(_,u)=>(s(),M(X,{onHide:y},{button:k(()=>[ga]),popup:k(({hide:i,focus:l})=>[t("div",ha,[t("div",fa,[t("div",null,[ie(t("input",{type:"number","onUpdate:modelValue":u[0]||(u[0]=c=>p.value=c)},null,512),[[de,p.value]])]),t("div",ba,[$(va,{modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=c=>v.value=c),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ka=R($a,[["__scopeId","data-v-a27bea28"]]),wa={class:"d-flex flex-row group-form"},xa={class:"pt-1 pb-1"},Ia={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Sa={key:0,class:"bi bi-chevron-right smaller"},Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa=["onClick"],Ea=["onClick"],Ta=["onClick"],za=["onClick"],Pa=["onClick"],Oa=["onClick"],Da={key:5,class:"sm-btn"},La={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ga=z({__name:"GroupForm",props:{isLoading:Boolean,manager:We},setup(d){const r=N(),e=d;function a(i){e.manager.setGroupOption(i),e.manager.update(!0)}function p(i){e.manager.delGroupOption(i),e.manager.update(!0)}function v(i,l){e.manager.setGroupOption(i,{direction:l}),e.manager.sortGroups(!0)}function y(i,l){e.manager.setGroupOption(i,{type:l}),e.manager.sortGroups(!0)}function b(i,l){e.manager.setGroupOption(i,l),e.manager.update(!0)}const _=I(()=>e.manager.state.groupBy.map(i=>r.data.properties[i])),u=I(()=>{const i=[];return e.manager.state.groupBy.forEach(l=>{i.push({option:e.manager.state.options[l],property:r.data.properties[l]})}),i});return(i,l)=>(s(),o("div",wa,[t("div",xa,g(i.$t("main.menu.groupby"))+": ",1),_.value.length?(s(),o("div",Ia,[(s(!0),o(V,null,U(u.value,(c,m)=>(s(),o(V,null,[m>0?(s(),o("i",Sa)):f("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:h=>p(c.property.id),id:"remove-group-button"},g(c.property.name),9,Ca),c.option.type==n(ee).Size?(s(),M(T,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[c.option.direction==n(Z).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:h=>y(c.property.id,n(ee).Property)},null,8,Ma)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:h=>y(c.property.id,n(ee).Property)},null,8,Va))]),_:2},1024)):(s(),M(T,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[c.property.type==n(S).number?(s(),o(V,{key:0},[c.option.direction==n(Z).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:h=>y(c.property.id,n(ee).Size)},null,8,Fa)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:h=>y(c.property.id,n(ee).Size)},null,8,Ea))],64)):(s(),o(V,{key:1},[c.option.direction==n(Z).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:h=>y(c.property.id,n(ee).Size)},null,8,Ta)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:h=>y(c.property.id,n(ee).Size)},null,8,za))],64))]),_:2},1024)),c.option.direction==n(Z).Ascending?(s(),M(T,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:h=>v(c.property.id,n(Z).Descending)},null,8,Pa)]),_:2},1024)):(s(),M(T,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:h=>v(c.property.id,n(Z).Ascending)},null,8,Oa)]),_:2},1024)),c.property.type==n(S).date?(s(),o("div",Da,[$(ka,{option:c.option,onChange:h=>b(c.property.id,h)},null,8,["option","onChange"])])):f("",!0)],64))),256)),e.isLoading?(s(),o("i",La)):f("",!0)])):f("",!0),$(De,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:l[0]||(l[0]=c=>a(c))},null,8,["group-ids"])]))}});const Na=R(Ga,[["__scopeId","data-v-47631987"]]),Ra={class:"d-flex flex-row sort-form"},Ua={class:"pt-1 pb-1"},ja={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ha={key:0,class:"bi bi-chevron-right smaller"},Aa=["onClick"],Ba=["onClick"],qa=["onClick"],Ka=z({__name:"SortForm",props:{manager:Ye},setup(d){const r=N(),e=d,a=I(()=>e.manager.state.sortBy.map(_=>({propertyId:_,direction:e.manager.state.options[_].direction}))),p=I(()=>a.value.map(_=>_.propertyId));function v(_){e.manager.setSort(_),e.manager.update(!0)}function y(_){e.manager.delSort(_),e.manager.update(!0)}function b(_,u){e.manager.setSort(_,{direction:u}),e.manager.update(!0)}return(_,u)=>(s(),o("div",Ra,[t("div",Ua,g(_.$t("main.menu.sort.title"))+": ",1),a.value.length?(s(),o("div",ja,[(s(!0),o(V,null,U(a.value,(i,l)=>(s(),o(V,null,[l>0?(s(),o("i",Ha)):f("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:c=>y(i.propertyId)},g(n(r).data.properties[i.propertyId].name),9,Aa),i.direction==n(Z).Ascending?(s(),M(T,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:c=>b(i.propertyId,n(Z).Descending)},null,8,Ba)]),_:2},1024)):(s(),M(T,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:c=>b(i.propertyId,n(Z).Ascending)},null,8,qa)]),_:2},1024))],64))),256))])):f("",!0),$(De,{"group-ids":p.value,onSelect:u[0]||(u[0]=i=>v(i))},null,8,["group-ids"])]))}});const Qa=R(Ka,[["__scopeId","data-v-bc2e0a7f"]]),me=d=>(Q("data-v-b6d30616"),d=d(),W(),d),Wa=me(()=>t("i",{class:"bi bi-clock-history me-1"},null,-1)),Ya={class:"p-2"},Xa={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Za={class:"border mb-1 p-1"},Ja={class:"me"},en=me(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),tn={key:0},sn={key:1},on={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},an={class:"d-flex center justify-content-center"},nn={key:1,class:"bi bi-arrow-down text-secondary"},ln=me(()=>t("div",{style:{width:"30px"}},null,-1)),rn={key:3,class:"bi bi-arrow-up text-secondary"},dn={class:"border mb-1 p-1"},pn={class:"me"},un=me(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),cn={key:0},_n={key:1},mn={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ne=5,vn=z({__name:"HistoryDropdown",emits:[],setup(d,{emit:r}){const e=N(),a=x(!1),p=I(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),v=I(()=>[...e.data.history.undo].reverse().slice(0,ne)),y=I(()=>e.data.history.redo.slice(Math.max(e.data.history.redo.length-ne,0)));return A(()=>e.status.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(b,_)=>(s(),M(X,null,{button:k(()=>[t("div",{class:"d-flex sb flash",style:B([{"font-size":"14px"},p.value])},[Wa,t("div",null,g(b.$t("dropdown.history.button")),1)],4)]),popup:k(()=>[t("div",Ya,[n(e).data.history.redo.length>ne?(s(),o("div",Xa," + "+g(n(e).data.history.redo.length-ne),1)):f("",!0),(s(!0),o(V,null,U(y.value,u=>(s(),o("div",Za,[t("span",Ja,g(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),en,u.tags?(s(),o("span",tn,g(u.tags)+" "+g(b.$t("dropdown.history.tags")),1)):f("",!0),u.values?(s(),o("span",sn,g(u.values)+" "+g(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),t("div",on,[t("div",an,[v.value.length?(s(),o("div",{key:0,class:"bi bi-arrow-down sb",onClick:_[0]||(_[0]=(...u)=>n(e).undo&&n(e).undo(...u))})):(s(),o("div",nn)),ln,y.value.length?(s(),o("div",{key:2,class:"bi bi-arrow-up sb",onClick:_[1]||(_[1]=(...u)=>n(e).redo&&n(e).redo(...u))})):(s(),o("div",rn))])]),(s(!0),o(V,null,U(v.value,u=>(s(),o("div",dn,[t("span",pn,g(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),un,u.tags?(s(),o("span",cn,g(u.tags)+" "+g(b.$t("dropdown.history.tags")),1)):f("",!0),u.values?(s(),o("span",_n,g(u.values)+" "+g(b.$t("dropdown.history.values")),1)):f("",!0)]))),256)),n(e).data.history.undo.length>ne?(s(),o("div",mn," + "+g(n(e).data.history.undo.length-ne),1)):f("",!0)])]),_:1}))}});const yn=R(vn,[["__scopeId","data-v-b6d30616"]]),Se=d=>(Q("data-v-15e0935f"),d=d(),W(),d),gn={class:"d-flex flex-row p-2"},hn=Se(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),fn=["placeholder"],bn={class:"me-5 d-flex"},$n=Se(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),kn={class:"ms-5",style:{"font-size":"13px"}},wn=["checked"],xn=Se(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),In={class:"ms-4"},Sn={class:"d-flex flex-wrap content-container ps-2"},Cn=z({__name:"ContentFilter",props:{tab:Xe,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){N();const e=d,a=x(""),p=I(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),v=I(()=>p.value.length);function y(i){const l=i.target.checked;e.tab.collection.groupManager.setSha1Mode(l,!0)}function b(){a.value=e.tab.state.filterState.query}function _(){e.tab.collection.filterManager.setQuery(a.value),e.tab.collection.filterManager.update(!0)}function u(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return se(b),A(()=>e.tab.collection.filterManager.state.query,b),(i,l)=>(s(),o(V,null,[t("div",gn,[$(T,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:j(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[hn,ie(t("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=c=>a.value=c),onChange:_},null,40,fn),[[de,a.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:u},"x")],2)]),_:1}),t("div",bn,[$(T,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:j("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=c=>e.tab.state.display="tree")},null,2)]),_:1}),$(T,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:j("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=c=>e.tab.state.display="grid")},null,2)]),_:1})]),$(T,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[$n]),_:1}),t("div",null,[$(Ze,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":l[3]||(l[3]=c=>e.tab.state.imageSize=c)},null,8,["modelValue"])]),t("div",kn,[$(T,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:y},null,40,wn),xn]),_:1})]),t("div",In,[$(yn)]),v.value?(s(),M(Je,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":l[4]||(l[4]=c=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0)]),t("div",Sn,[$(la,{manager:e.tab.collection.filterManager},null,8,["manager"]),$(Na,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),$(Qa,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Mn=R(Cn,[["__scopeId","data-v-15e0935f"]]),Vn={class:""},Fn=["src"],En={class:"d-flex flex-row"},Tn=z({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=xe();N();const a=d,p=r,v=I(()=>`width: ${a.size}px; height: ${a.size}px;`),y=I(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`),b=I(()=>a.pile.images[0]);return(_,u)=>(s(),o("div",Vn,[$(et,{image:b.value},{default:k(()=>[t("div",{style:B(v.value),class:"img-container",onClick:u[0]||(u[0]=i=>n(e).showModal(n(te).IMAGE,{image:b.value}))},[t("img",{src:b.value.url,style:B(y.value)},null,12,Fn)],4)]),_:1},8,["image"]),t("div",En,[$(T,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:u[1]||(u[1]=i=>p("accept",b.value))}," ✓ ",4)]),_:1}),$(T,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:u[2]||(u[2]=i=>p("refuse",b.value))}," ✕ ",4)]),_:1})])]))}});const zn=R(Tn,[["__scopeId","data-v-1ea540e7"]]),ue=d=>(Q("data-v-2fea5b23"),d=d(),W(),d),Pn={class:"reco-container"},On={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Dn=ue(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),Ln=[Dn],Gn=ue(()=>t("div",{class:"b-left pe-1"},null,-1)),Nn=ue(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Rn=[Nn],Un=ue(()=>t("div",{class:"b-left pe-1"},null,-1)),jn={key:0,class:"bi bi-funnel-fill bb text-primary"},Hn={key:1,class:"bi bi-funnel bb"},An=ue(()=>t("div",{class:"b-left pe-1"},null,-1)),Bn={class:"text-secondary me-2"},qn={class:"flex-grow-1"},Kn={class:"d-flex flex-row"},Qn={key:0,class:"separator"},Wn={class:"d-flex flex-row"},be=10,Yn=z({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=N(),a=tt(),p=d,v=r,y=x(1),b=le([]),_=le([]),u=le([]),i=le(new Set),l=x(!0);function c(O){let E=_.indexOf(O);E<0||(_.splice(E,1),w())}async function m(O){const E=[],P=[];u.forEach(C=>{var F;if(C.value!=ot){const D=e.data.properties[C.propertyId];let L=C.value;D.type==S.multi_tags?(L=((F=O.properties[C.propertyId])==null?void 0:F.value)??[],L=[...L,C.value]):D.type==S.tag&&(L=[L]),D.mode==$e.id?P.push({instanceId:O.id,propertyId:D.id,value:L}):E.push({propertyId:D.id,sha1:O.sha1,value:L})}}),await e.setPropertyValues(P,E),c(O.sha1)}function h(O){i.add(O.sha1),c(O.sha1)}function w(){b.length=0;const O=_.map(E=>({sha1:E,images:e.data.sha1Index[E]}));G(O,b,y.value,p.imageSize,p.width)}function G(O,E,P,C,F){let D=F,L=[],ve=0;for(let ye=0;ye<O.length&&!(E.length>=P);ye++){let ge=O[ye];if(i.has(ge.sha1))continue;let he=C+be;if(ve+he<D){L.push(ge),ve+=he;continue}if(L.length==0)throw new Error("Images seems to be to big for the line");E.push(L),E.length<P&&(L=[ge],ve=he)}L.length>0&&E.length<P&&E.push(L)}async function K(){if(!p.group)return;console.log("get reco");const O=p.group.images.map(F=>F.id);let E=await a.getSimilarImages({instanceIds:O});if(E.matches.sort((F,D)=>D.score-F.score),l.value){const F=e.getTabManager(),D=new Set(F.collection.groupManager.result.root.images.map(L=>L.id));E.matches=E.matches.filter(L=>D.has(L.id))}const P=Array.from(new Set(E.matches.map(F=>e.data.images[F.id].sha1)));u.length=0;let C=p.group;for(;C;)u.push(...C.meta.propertyValues),C=C.parent;_.length=0,_.push(...P),i.clear(),w(),v("update")}function ae(){l.value=!l.value}return se(K),A(()=>p.group,()=>{K(),i.clear()}),A(()=>p.imageSize,w),A(()=>p.width,w),A(l,K),(O,E)=>(s(),o("div",Pn,[t("div",On,[t("div",{class:"text-secondary pe-1",onClick:E[0]||(E[0]=P=>v("close"))},Ln),Gn,t("div",{class:"text-secondary pe-1",onClick:E[1]||(E[1]=P=>v("scroll",p.group.id))},Rn),Un,t("div",{class:"text-secondary pe-1",onClick:ae},[l.value?(s(),o("span",jn)):(s(),o("span",Hn))]),An,$(T,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",Bn,g(O.$t("main.recommand.title")),1)]),_:1}),t("div",qn,[t("div",Kn,[(s(!0),o(V,null,U(u,(P,C)=>(s(),o(V,null,[$(st,{class:"",value:P},null,8,["value"]),C<u.length-1?(s(),o("div",Qn)):f("",!0)],64))),256))])])]),t("div",{style:B("margin-left:"+be+"px;")},[(s(!0),o(V,null,U(b,P=>(s(),o("div",null,[t("div",Wn,[(s(!0),o(V,null,U(P,C=>(s(),M(zn,{pile:C,size:p.imageSize,onAccept:m,onRefuse:h,style:B("margin-right:"+be+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Xn=R(Yn,[["__scopeId","data-v-2fea5b23"]]),Zn={key:0,class:"m-0 p-0"},Jn={key:0,style:{"margin-left":"10px"}},el=z({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=N(),e=r.getTabManager(),a=d,p=x({}),v=x(null),y=x(null),b=x(null);x([]);const _=x(0),u=x(0),i=le({groups:!1}),l=I(()=>e.getVisibleProperties());function c(){v.value&&y.value?_.value=a.height-v.value.clientHeight-y.value.clientHeight-5:v.value?_.value=a.height-v.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{b.value&&e.state.display=="tree"&&b.value.computeLines()});function m(w){p.value=e.collection.groupManager.result.index[w],J(()=>c())}function h(){p.value={},J(()=>c())}return se(()=>{u.value=v.value.clientWidth,window.addEventListener("resize",()=>{J(()=>{var w;u.value=((w=v.value)==null?void 0:w.clientWidth)??u.value})})}),A(e.state,w=>{r.updateTabs()},{deep:!0}),A(()=>e.state.imageSize,()=>J(c)),A(()=>a.height,async()=>{await J(c)}),(w,G)=>(s(),o(V,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:v},[$(Mn,{tab:n(e),"compute-status":i},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[p.value.id?(s(),o("div",Zn,[$(Xn,{group:p.value,"image-size":n(e).state.imageSize,width:u.value,height:50,onClose:h,onScroll:b.value.scrollTo,onUpdate:G[0]||(G[0]=K=>J(()=>c()))},null,8,["group","image-size","width","onScroll"])])):f("",!0)],512),u.value>0&&_.value>0?(s(),o("div",Jn,[n(e).state.display=="tree"?(s(),M(at,{key:0,"group-manager":n(e).collection.groupManager,"image-size":n(e).state.imageSize,height:_.value-0,properties:l.value,"hide-if-modal":!0,"selected-images":n(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,width:u.value-25,onRecommend:m},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),n(e).state.display=="grid"?(s(),o("div",{key:1,style:B({width:u.value-12+"px"}),class:"p-0 m-0 grid-container"},[$(nt,{manager:n(e).collection.groupManager,height:_.value-15,width:u.value-40,"selected-properties":l.value,class:"p-0 m-0","show-images":!0,"selected-images":n(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):f("",!0)])):f("",!0)],64))}});const tl=R(el,[["__scopeId","data-v-d071a1ff"]]),sl={class:"d-flex d-row",style:{cursor:"pointer"}},ol=["onMouseenter","onMouseleave"],al=["onClick"],nl=["onClick"],ll=["onClick"],il=["onSubmit"],rl=["onKeydown","onUpdate:modelValue"],dl=t("span",{class:"bi bi-plus"},null,-1),pl=[dl],ul={class:"lang"},cl=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),_l=["value"],ml=z({__name:"TabNav",props:{reRender:Function},setup(d){const r=N(),e=x(-1),a=x(""),p=x(null),v=d;function y(m){r.data.selectedTabId==m||_(),r.selectTab(m)}function b(m){e.value=m,a.value=r.data.tabs[m].name,J(()=>p.value[0].focus())}function _(){e.value=-1,a.value=""}function u(m){r.addTab("New Tab")}async function i(m){confirm("Are you sure to delete Tab: "+m.name)&&await r.removeTab(m.id)}const l=le({});x(-1);const c=["fr","en"];return(m,h)=>(s(),o("nav",null,[t("div",sl,[(s(!0),o(V,null,U(n(r).data.tabs,w=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:G=>l[w.id]=!0,onMouseleave:G=>l[w.id]=!1},[e.value!=w.id?(s(),o(V,{key:0},[$(T,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:G=>b(w.id),class:j(["bi bi-pencil me-1 tab-icon hover-light",l[w.id]&&n(r).data.selectedTabId==w.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,al)]),_:2},1024),t("div",{class:j(["tab-button",w.id==n(r).data.selectedTabId?" active":""]),onClick:G=>y(w.id)},[t("span",null,g(w.name),1)],10,nl),$(T,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:G=>i(w),class:j(["btn-icon bi bi-x tab-icon hover-light",l[w.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,ll)]),_:2},1024)],64)):(s(),o("div",{key:1,class:j(["tab-button",w.id==n(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:ze(_,["stop","prevent"])},[ie(t("input",{onFocusout:_,onKeydown:lt(_,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":G=>w.name=G,ref_for:!0,ref_key:"inputElem",ref:p},null,40,rl),[[de,w.name]])],40,il)],2))],40,ol))),256)),$(T,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:u,id:"add-tab-button"},pl)]),_:1}),t("div",ul,[cl,ie(t("select",{"onUpdate:modelValue":h[0]||(h[0]=w=>m.$i18n.locale=w),onChange:h[1]||(h[1]=w=>v.reRender())},[(s(),o(V,null,U(c,(w,G)=>t("option",{key:`Lang${G}`,value:w},g(w.toUpperCase()),9,_l)),64))],544),[[it,m.$i18n.locale]])])])]))}});const Le=d=>(Q("data-v-831fb799"),d=d(),W(),d),vl={class:"d-flex flex-row m-0 p-0 overflow-hidden"},yl={key:0},gl={key:1,class:"w-100"},hl={key:0,class:"custom-hr"},fl={key:2,class:"loading"},bl={class:"text-center"},$l={key:3,class:"loading"},kl=Le(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),wl=Le(()=>t("span",{class:"ms-1"},"Loading...",-1)),xl=[kl,wl],Il=z({__name:"PanopticView",setup(d){const r=N(),e=xe(),a=x(null),p=x(null),v=x(window.innerHeight),y=x(!1),b=I(()=>{var m;return v.value-(((m=p.value)==null?void 0:m.clientHeight)??0)}),_=I(()=>{var m;return(m=a.value)==null?void 0:m.filteredImages.map(h=>h.id)});se(async()=>{e.isProjectLoaded||Ve.push("/"),J(()=>{window.addEventListener("resize",u),u()}),window.addEventListener("keydown",m=>{m.key=="Control"&&(H.ctrl=!0),m.key=="Alt"&&(H.alt=!0),m.key=="Shift"&&(H.shift=!0),m.key=="ArrowLeft"&&(H.left=!0),m.key=="ArrowRight"&&(H.right=!0,console.log("keeeyy")),m.key=="Z"&&H.ctrl&&r.redo(),m.key=="z"&&H.ctrl&&r.undo()}),window.addEventListener("keyup",m=>{m.key=="Control"&&(H.ctrl=!1),m.key=="Alt"&&(H.alt=!1),m.key=="Shift"&&(H.shift=!1),m.key=="ArrowLeft"&&(H.left=!1),m.key=="ArrowRight"&&(H.right=!1)}),window.addEventListener("mousemove",m=>{H.ctrl=m.ctrlKey,H.alt=m.altKey,H.shift=m.shiftKey})}),rt(()=>{window.removeEventListener("resize",u)});function u(){v.value=window.innerHeight,y.value=!0}function i(){e.showModal(te.EXPORT,_)}function l(){r.rerender()}function c(){Ve.push("/")}return(m,h)=>(s(),o(V,null,[$(dt,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:n(r).status.renderNb},[t("div",vl,[n(r).status.loaded?(s(),o("div",yl,[$(Ys,{onExport:h[0]||(h[0]=w=>i())})])):f("",!0),n(r).status.loaded?(s(),o("div",gl,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[$(ml,{"re-render":l})],512),y.value?(s(),o("div",hl)):f("",!0),n(r).status.loaded?(s(),M(tl,{key:1,"tab-id":n(r).data.selectedTabId,height:b.value,ref_key:"mainViewRef",ref:a},null,8,["tab-id","height"])):f("",!0)])):n(e).isProjectLoaded?(s(),o("div",$l,xl)):(s(),o("div",fl,[t("div",bl,[t("div",null,g(m.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:c,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Ml=R(Il,[["__scopeId","data-v-831fb799"]]);export{Ml as default};
