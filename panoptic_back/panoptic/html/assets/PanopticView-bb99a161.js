import{d as P,h as L,r as x,c as S,i as oe,o as s,a,b as t,w as le,v as re,F as V,m as R,s as $,y as ie,t as b,k as F,x as k,n as D,D as Z,z as Pe,_ as N,A as de,B,C as Te,e as i,P as ye,l as f,E as Se,G as M,H as ze,I as Oe,J as Ge,K as Le,L as Ne,p as W,f as Y,N as be,O as E,Q as Ce,q as Q,T as De,R as Me,S as A,U as _e,V as $e,u as ge,M as se,g as ve,W as Re,X as Ue,Y as ke,Z as Ve,$ as je,a0 as te,a1 as J,a2 as Ae,a3 as He,a4 as Be,a5 as qe,a6 as Ke,a7 as ne,a8 as Qe,a9 as We,aa as Ye,ab as ee,ac as Xe,ad as Je,ae as Ze,af as et,ag as tt,j as we,ah as H,ai as st}from"./index-4b73a0f7.js";import{_ as ot}from"./Tutorial-84a9b39e.js";const at={class:"mb-1 ps-2 pe-2"},nt=["onClick"],fe=P({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const e=L(),o=d,p=r,y=x(null),m=x(""),h=S(()=>{let v=e.propertyList;return o.ignoreIds&&(v=v.filter(_=>!o.ignoreIds.includes(_.id))),v.filter(_=>_.name.includes(m.value))});return oe(()=>y.value.focus()),(v,_)=>(s(),a("div",null,[t("div",at,[le(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:y,"onUpdate:modelValue":_[0]||(_[0]=n=>m.value=n)},null,512),[[re,m.value]])]),(s(!0),a(V,null,R(h.value,n=>(s(),a("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:l=>p("select",n.id)},[$(ie,{type:n.type,class:"me-2"},null,8,["type"]),t("a",null,b(n.name),1)],8,nt))),256))]))}}),lt=["disabled"],it={class:"m-0 p-1"},rt=["onClick"],dt=P({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=r,y=x(null),m=S(()=>e.data.properties[o.propertyId]),h=S(()=>Pe(m.value.type));async function v(_){p("update:modelValue",_),y.value.hide()}return(_,n)=>(s(),F(Z,{onHide:n[0]||(n[0]=l=>p("hide")),ref_key:"dropdownElem",ref:y,parent:o.parent},{button:k(()=>[t("div",{class:D(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,b(_.$t("modals.filters.operators."+o.modelValue)),1)],10,lt)]),popup:k(()=>[t("div",it,[(s(!0),a(V,null,R(h.value,l=>(s(),a("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>v(l)},[t("a",null,b(_.$t("modals.filters.operators."+l)),1)],8,rt))),256))])]),_:1},8,["parent"]))}});const pt=N(dt,[["__scopeId","data-v-29ed354e"]]),ut=d=>(W("data-v-25365fdd"),d=d(),Y(),d),ct={class:"m-0 p-0"},_t={key:1},mt={class:"d-flex mode-header"},vt={class:"me-3"},yt=ut(()=>t("div",{class:"flex-fill"},null,-1)),gt={key:0,class:"me-2",style:{width:"100%"}},ft=P({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=L(),e=d,o=x(null),p=x(null),y=x(null),m=x(0),h=x(null),v=x(null),_=S(()=>e.filterId!==void 0?e.filterId:h.value),n=S(()=>{if(!(_.value==null||_.value==-1))return e.manager.filterIndex[_.value]}),l=S(()=>n.value==null?void 0:r.data.properties[n.value.propertyId]);function u(){m.value=e.mode,e.mode==2&&e.filterId==null&&I(e.propertyId)}function c(){o.value&&o.value.hide()}function g(){m.value=0}function C(){c(),e.manager.deleteFilter(_.value),e.manager.update(!0)}function I(j){let z=e.manager.addNewFilter(j,e.parentId);e.manager.update(!0),h.value=z.id,m.value=2}function w(j){e.manager.updateFilter(_.value,{operator:j}),e.manager.update(!0),p.value&&p.value.focus()}function T(){e.manager.updateFilter(_.value,{value:v.value}),e.manager.update(!0)}function G(){if(!n.value)return;const j=r.data.properties[n.value.propertyId];if(Le(j.type))return;const z=v.value??Ne(j.type);n.value.value!=z&&T()}function K(){n.value&&(v.value=n.value.value)}return oe(K),B(()=>n.value,()=>K()),(j,z)=>(s(),F(Z,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:g,parent:e.parent},{button:k(()=>[t("div",ct,[Te(j.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:y},[m.value!=0?(s(),a(V,{key:0},[m.value==1?(s(),F(fe,{key:0,onSelect:I,"ignore-ids":[i(ye).folders]},null,8,["ignore-ids"])):f("",!0),m.value==2?(s(),a("div",_t,[t("div",mt,[t("div",vt,b(l.value.name),1),$(pt,{"property-id":n.value.propertyId,"model-value":n.value.operator,"onUpdate:modelValue":w,parent:y.value},null,8,["property-id","model-value","parent"]),yt,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:C})])]),i(Se)(n.value.operator)?(s(),a("div",gt,[l.value.type==i(M).multi_tags||l.value.type==i(M).tag?(s(),F(ze,{key:0,modelValue:v.value,"onUpdate:modelValue":[z[0]||(z[0]=O=>v.value=O),T],"auto-focus":!0,property:i(r).data.properties[n.value.propertyId],ref_key:"inputElem",ref:p,onHide:c},null,8,["modelValue","property"])):l.value.type==i(M).color?(s(),F(Oe,{key:1,property:l.value,modelValue:v.value,"onUpdate:modelValue":[z[1]||(z[1]=O=>v.value=O),z[2]||(z[2]=()=>{c(),G()})]},null,8,["property","modelValue"])):(s(),F(Ge,{key:2,"no-html":!0,modelValue:v.value,"onUpdate:modelValue":z[3]||(z[3]=O=>v.value=O),width:-1,"min-height":20,"no-nl":i(r).data.properties[n.value.propertyId].type==i(M).number,"url-mode":i(r).data.properties[n.value.propertyId].type==i(M).url,"only-number":i(r).data.properties[n.value.propertyId].type==i(M).number,onBlur:G,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):f("",!0)])):f("",!0)],64)):f("",!0)],512)]),_:3},8,["parent"]))}});const pe=N(ft,[["__scopeId","data-v-25365fdd"]]),ae=d=>(W("data-v-81b7150f"),d=d(),Y(),d),ht={class:"d-flex flex-row"},bt={key:1,class:"d-flex",style:{width:"150px"}},$t={class:"flex-grow-1"},kt={key:1,style:{"padding-top":"1px"}},wt={style:{width:"20px","margin-top":"2px"},class:"text-center"},xt=ae(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),It={class:"text-center",style:{width:"20px","margin-top":"2px"}},St=ae(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Ct=ae(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Mt={key:0,class:"ms-3 pt-1"},Vt=ae(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Ft=ae(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Et=ae(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Pt=ae(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Tt={key:1},zt=P({__name:"PropertyOptions",props:{property:Object},setup(d){const r=L(),e=r.getTabManager(),o=d,p=x(!1),y=x(!1),m=x(""),h=x(!1),v=S(()=>r.getTab()),_=S(()=>v.value.visibleProperties[o.property.id]==!0),n=S(()=>e.collection.filterManager.state.filter.filters.some(O=>!O.isGroup&&O.propertyId==o.property.id)),l=S(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),u=S(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),c=S(()=>{if(n.value)return e.collection.filterManager.state.filter.filters.find(O=>!O.isGroup&&O.propertyId==o.property.id).id}),g=()=>e.collection.filterManager,C=S(()=>e.getSha1Mode());function I(){_.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function w(){p.value?p.value=!1:(p.value=!0,m.value=o.property.name),y.value=!1}function T(){o.property.type!=M.tag&&o.property.type!=M.multi_tags||(y.value?y.value=!1:y.value=!0,p.value=!1)}function G(){u.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function K(){l.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function j(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&r.deleteProperty(o.property.id)}async function z(){m.value!=""&&(await r.updateProperty(o.property.id,m.value),w())}return B(()=>o.property,()=>{p.value=!1}),(O,U)=>(s(),a("div",{class:D(h.value?"hover-light":"")},[t("div",ht,[p.value?f("",!0):(s(),a("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:w},[$(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:U[0]||(U[0]=X=>h.value=!0),onMouseleave:U[1]||(U[1]=X=>h.value=!1)},null,8,["type"]),t("span",null,b(o.property.name),1)])),p.value?(s(),a("div",bt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:w,onMouseenter:U[2]||(U[2]=X=>h.value=!0),onMouseleave:U[3]||(U[3]=X=>h.value=!1)},null,32)]),t("div",$t,[o.property.id>=0?le((s(),a("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":U[4]||(U[4]=X=>m.value=X),onChange:z},null,544)),[[re,m.value]]):(s(),a("span",kt,[$(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,b(o.property.name),1)]))])])):f("",!0),t("div",wt,[o.property.mode==i(be).id?(s(),F(E,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[xt]),_:1})):f("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:I,class:"btn-icon text-center"},[C.value&&o.property.mode==i(be).id?(s(),F(E,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:U[5]||(U[5]=Ce(()=>{},["stop"]))})]),_:1})):(s(),F(E,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:D("bi bi-eye text-"+(_.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",It,[o.property.type==i(M).tag||o.property.type==i(M).multi_tags?(s(),a("div",{key:0,onClick:T,style:{cursor:"pointer"}},[y.value?(s(),F(E,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[St]),_:1})):(s(),F(E,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Ct]),_:1}))])):f("",!0)])]),t("div",null,[p.value?(s(),a("div",Mt,[t("div",{class:D(["options hover-light",n.value?" text-primary":""])},[$(pe,{manager:g(),"filter-id":c.value,mode:2,"property-id":d.property.id},{default:k(()=>[Vt,Q(b(O.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:D(["options hover-light",u.value?" text-primary":""]),onClick:G},[Ft,Q(b(O.$t("main.menu.sort.title")),1)],2),t("div",{class:D(["options hover-light",l.value?" text-primary":""]),onClick:K},[Et,Q(b(O.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),a("div",{key:0,class:"options hover-light",onClick:j},[Pt,Q(b(O.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):y.value?(s(),a("div",Tt,[$(De,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])],2))}});const xe=N(zt,[["__scopeId","data-v-81b7150f"]]),Ot=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Gt={class:"p-2"},Lt=["onClick"],Nt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),Dt=P({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=L(),e=d;function o(){r.reImportFolder(e.folder.id)}return(p,y)=>(s(),F(Z,{teleport:!0},{button:k(()=>[Ot]),popup:k(({hide:m})=>[t("div",Gt,[t("div",{class:"base-hover p-1",onClick:h=>{o(),m()}},[Nt,Q(" Re import")],8,Lt)])]),_:1}))}}),Rt=["onMouseenter"],Ut=["onClick"],jt={class:"text-secondary"},At=["onClick"],Ht=P({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(d){const r=L(),e=d,o=x(null),p=S(()=>{let n={};const l=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{l.has(u)&&(n[u]=!0)}),n}),y=S(()=>{let n={};return e.folders.map(l=>l.id).forEach(l=>{e.visibleFolders[l]&&(n[l]=!0)}),n}),m=S(()=>{let n={};return e.folders.forEach(l=>{let u=[];p.value[l.id]&&u.push("selected"),n[l.id]=u.join(" ")}),n});function h(n){let l=e.visibleFolders;l[n]?delete l[n]:l[n]=!0}function v(n){let l=new Set(e.filterManager.state.folders);const u=l.has(n),c=r.data.folders[n].parent!=null&&l.has(r.data.folders[n].parent);u&&!c?(l.delete(n),_e(n).forEach(g=>l.delete(g.id))):(_(n,l),l.add(n),_e(n).forEach(g=>l.add(g.id)),$e(r.data.folders[n]).forEach(g=>l.delete(g.id))),e.filterManager.setFolders(Array.from(l)),e.filterManager.update(!0)}function _(n,l){const u=$e(r.data.folders[n]);let c;for(let g of u)if(l.has(g.id))c=g;else break;c!=null&&_e(c.id).forEach(g=>l.delete(g.id))}return(n,l)=>{const u=Me("FolderList2",!0);return s(),a("ul",{class:D(e.root?"tree":""),style:A(e.root?"padding-left:0px;":"")},[(s(!0),a(V,null,R(d.folders,c=>(s(),a("li",{style:A(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:g=>o.value=c.id,onMouseleave:l[0]||(l[0]=g=>o.value=null)},[t("summary",{class:D(m.value[c.id]),onClick:g=>v(c.id)},[Q(b(c.name)+" ",1),t("span",jt,b(c.count),1)],10,Ut),c.children&&c.children.length>0?(s(),a("i",{key:0,onClick:g=>h(c.id),class:D("bi bi-chevron-"+(y.value[c.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,At)):f("",!0),t("span",{class:D(o.value===c.id?"visible-option":"invisible-option")},[$(Dt,{folder:c,style:{display:"inline-block"}},null,8,["folder"])],2),c.children&&c.children.length>0&&y.value[c.id]?(s(),F(u,{key:1,folders:c.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,Rt))),256))],6)}}});const Bt=N(Ht,[["__scopeId","data-v-9f26453b"]]),qt={class:"text-center"},Kt={class:"w-100 text-center",style:{"font-size":"10px"}},Qt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Wt=P({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=S(()=>r.task.total-r.task.remain-r.task.computing),o=S(()=>r.task.total);return(p,y)=>(s(),a("div",qt,[Q(b(r.task.name)+" ",1),t("div",Kt,b(e.value)+" / "+b(o.value)+" "+b(p.$t("main.nav.tasks.done")),1),o.value>0?(s(),a("div",Qt,[t("div",{class:"progress-bar",style:A(`width: ${e.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),q=d=>(W("data-v-6d80cd26"),d=d(),Y(),d),Yt={class:"menu overflow-scroll"},Xt={class:""},Jt={class:"m-0",style:{padding:"4px 0px 4px 8px"}},Zt={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},es=q(()=>t("i",{class:"bi bi-gear"},null,-1)),ts=[es],ss=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),os=[ss],as=q(()=>t("div",{class:"custom-hr"},null,-1)),ns={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ls={class:"d-flex align-items-center"},is=q(()=>t("i",{class:"bi bi-plus"},null,-1)),rs={class:"overflow-scroll"},ds={key:0,id:"import"},ps=q(()=>t("div",{class:"custom-hr"},null,-1)),us={class:"pt-1 pb-2"},cs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},_s=q(()=>t("div",{class:"custom-hr"},null,-1)),ms={key:0,class:"ps-2 pe-2"},vs={class:"p-1"},ys={key:0,class:"custom-hr"},gs={key:1,class:"p-2"},fs=q(()=>t("div",{class:"custom-hr"},null,-1)),hs={key:0,class:"float-end"},bs={class:"text-center"},$s={class:"w-100 text-center",style:{"font-size":"10px"}},ks={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},ws={key:2,class:"p-2"},xs={class:"w-100 text-center",style:{"font-size":"10px"}},Is={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ss=q(()=>t("div",{class:"custom-hr"},null,-1)),Cs={class:"p-2 mt-0"},Ms={class:"d-flex"},Vs=q(()=>t("span",{class:"flex-grow-1"},null,-1)),Fs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Es=q(()=>t("span",{class:"sr-only"},null,-1)),Ps=[Es],Ts={key:1,class:"me-3"},zs={class:"me-3"},Os={key:0,class:"mt-2"},Gs={key:0,class:"property-item"},Ls=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Ns=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ds=q(()=>t("div",{class:"custom-hr"},null,-1)),Rs={class:"p-2 mt-0"},Us={key:0,class:"mt-2"},js={key:0,class:"property-item"},As=P({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=L(),o=ge(),p=e.getTabManager(),y=x(!1);x(null);const m=x(!1),h=async l=>{o.showModal(se.IMPORT)},v=S(()=>e.backendStatus.tasks.filter(l=>!(l.name=="Load Plugin"&&l.done)));function _(){o.showModal(se.FOLDERSELECTION,{callback:n,mode:"images"})}function n(l){l&&e.addFolder(l)}return B(()=>e.status.import.to_import,()=>y.value=!0),(l,u)=>{var c;return s(),a("div",Yt,[t("div",Xt,[t("div",null,[t("div",Jt,[t("div",Zt,[t("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},b((c=i(o).data.status.selectedProject)==null?void 0:c.name),1),t("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=g=>i(o).showModal(i(se).SETTINGS))},ts),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=g=>i(o).closeProject())},os)])]),as,t("div",ns,[t("div",ls,[t("div",null,[t("b",null,b(l.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:u[3]||(u[3]=g=>{_(),i(ve)()})},[$(E,{message:"main.nav.folders.add"},{default:k(()=>[is]),_:1})])]),t("div",rs,[i(e).getTab()?(s(),F(Bt,{key:0,folders:i(e).folderRoots,"filter-manager":i(p).collection.filterManager,"visible-folders":i(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):f("",!0)])]),v.value&&v.value.length?(s(),a("div",ds,[ps,t("div",us,[t("div",cs,[t("div",null,[t("b",null,b(l.$t("main.nav.tasks.title")),1)])]),_s,i(e).backendStatus?(s(),a("div",ms,[(s(!0),a(V,null,R(v.value,(g,C)=>(s(),a("div",vs,[C?(s(),a("div",ys)):f("",!0),$(Wt,{task:g},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&y.value?(s(),a("div",gs,[fs,i(e).status.import.done?(s(),a("div",hs,[t("i",{class:"bi bi-x base-hover",onClick:u[4]||(u[4]=g=>y.value=!1)})])):f("",!0),t("div",bs,[t("b",null,b(l.$t("main.menu.import_status_title")),1)]),t("div",$s,b(i(e).status.import.imported)+" / "+b(i(e).status.import.to_import)+" importées ",1),i(e).status.import.to_import>0?(s(),a("div",ks,[t("div",{class:"progress-bar",style:A(`width: ${i(e).status.import.imported/i(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&y.value?(s(),a("div",ws,[t("div",xs,b(i(e).status.import.computed)+" / "+b(i(e).status.import.to_import)+" computed ",1),i(e).status.import.to_import>0?(s(),a("div",Is,[t("div",{class:"progress-bar",style:A(`width: ${i(e).status.import.computed/i(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),Ss,t("div",Cs,[t("div",Ms,[$(E,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,b(l.$t("main.nav.properties.title")),1)]),_:1}),Vs,m.value?(s(),a("span",Fs,Ps)):(s(),a("span",Ts,[$(E,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-file-earmark-arrow-up btn-icon text-secondary",onClick:h})]),_:1})])),t("span",zs,[$(E,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-down btn-icon text-secondary",onClick:u[5]||(u[5]=g=>i(o).showModal(i(se).EXPORT,void 0))})]),_:1})])]),i(e).status.loaded?(s(),a("div",Os,[(s(!0),a(V,null,R(i(e).data.properties,g=>(s(),a(V,null,[g.id>=0?(s(),a("div",Gs,[$(xe,{property:g},null,8,["property"])])):f("",!0)],64))),256)),Ls,t("div",{id:"add-property",onClick:u[6]||(u[6]=g=>{i(o).showModal(i(se).PROPERTY,void 0),i(ve)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Ns,t("span",null,b(l.$t("main.nav.properties.add_property")),1)])])):f("",!0)]),Ds,t("div",Rs,[$(E,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,b(l.$t("main.nav.computed.title")),1)]),_:1}),i(e).status.loaded?(s(),a("div",Us,[(s(!0),a(V,null,R(i(e).data.properties,g=>(s(),a(V,null,[g.id<0?(s(),a("div",js,[$(E,{pos:"bottom",message:"main.nav.computed."+Math.abs(g.id).toString()+"_tooltip"},{default:k(()=>[$(xe,{property:g},null,8,["property"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])])}}});const Hs=N(As,[["__scopeId","data-v-6d80cd26"]]),Bs={class:"text-nowrap text-secondary"},Ie=P({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=L(),e=d,o=S(()=>r.data.properties[e.propertyId].tags);return(p,y)=>(s(),a("div",Bs,[e.value&&e.value.length>0?(s(!0),a(V,{key:0},R(e.value,m=>(s(),a("span",null,[$(Re,{tag:o.value[m].value,color:o.value[m].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),a(V,{key:1},[Q(" Add Tags... ")],64))]))}}),qs={key:0},Ks={key:1},Qs={key:2},Ws={key:3},Ys={key:0,class:"bi bi-square"},Xs={key:1,class:"bi bi-check-square"},Js={key:5},Zs={key:6},eo={key:7},to={key:8},so={key:9},oo={key:10},ao={key:11},no={key:12},lo={key:13},io={key:1,class:"text-secondary"},ro=P({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=S(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":Ue[p].color}),o=S(()=>[M._ahash,M._folders,M._sha1,M.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,y)=>d.value!=null?(s(),a(V,{key:0},[r.property.type==i(M)._ahash?(s(),a("div",qs,b(o.value),1)):f("",!0),r.property.type==i(M)._folders?(s(),a("div",Ks,b(o.value),1)):f("",!0),r.property.type==i(M)._sha1?(s(),a("div",Qs,b(o.value),1)):f("",!0),r.property.type==i(M).checkbox?(s(),a("div",Ws,[o.value?(s(),a("i",Ys)):(s(),a("i",Xs))])):f("",!0),r.property.type==i(M).color?(s(),a("div",{key:4,style:A({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):f("",!0),r.property.type==i(M).date?(s(),a("div",Js,b(o.value),1)):f("",!0),r.property.type==i(M).image_link?(s(),a("div",Zs)):f("",!0),r.property.type==i(M).multi_tags?(s(),a("div",eo,[$(Ie,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==i(M).number?(s(),a("div",to,b(o.value),1)):f("",!0),r.property.type==i(M).path?(s(),a("div",so,b(o.value),1)):f("",!0),r.property.type==i(M).string?(s(),a("div",oo,b(o.value),1)):f("",!0),r.property.type==i(M)._id||r.property.type==i(M)._height||r.property.type==i(M)._width?(s(),a("div",ao,b(o.value),1)):f("",!0),r.property.type==i(M).tag?(s(),a("div",no,[$(Ie,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==i(M).url?(s(),a("div",lo,b(o.value),1)):f("",!0)],64)):(s(),a("span",io,"..."))}}),po={class:"d-flex bb ps-1 overflow-hidden"},uo={class:"m-0 p-0 me-2 text-nowrap"},co={key:0,class:"m-0 p-0 me-2",style:{width:"150px"}},_o=P({__name:"FilterPreview",props:{filter:Object},setup(d){const r=L(),e=d,o=S(()=>r.data.properties[e.filter.propertyId]);return(p,y)=>(s(),a("td",po,[t("div",uo,b(p.$t("modals.filters.operators."+e.filter.operator)),1),i(Se)(e.filter.operator)?(s(),a("div",co,[$(ro,{property:o.value,value:e.filter.value},null,8,["property","value"])])):f("",!0)]))}});const mo=N(_o,[["__scopeId","data-v-532e0b3f"]]),vo={class:"m-0 bb",style:{}},yo={class:"p-2"},go=P({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=r,y=x(null);function m(h){y.value.hide(),p("update:modelValue",e.data.properties[h])}return(h,v)=>(s(),F(Z,{ref_key:"dropdownElem",ref:y,"auto-focus":!1},{button:k(()=>[t("div",vo,[$(ie,{type:o.modelValue.type},null,8,["type"]),Q(" "+b(o.modelValue.name),1)])]),popup:k(()=>[t("div",yo,[$(fe,{modelValue:o.modelValue,"onUpdate:modelValue":v[0]||(v[0]=_=>o.modelValue=_),onSelect:m,"ignore-ids":[i(ye).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ue=d=>(W("data-v-b9005f3e"),d=d(),Y(),d),fo={class:"filter-group"},ho={class:"table table-sm"},bo={class:"align-top p-0 m-0"},$o={key:0,class:"m-0 p-0"},ko={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},wo={class:""},xo=["onClick"],Io=ue(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),So={key:2,class:"text-secondary"},Co={key:0,class:"p-0 m-0 ps-2"},Mo={key:1,class:"p-0 m-0 ps-2"},Vo={class:"border rounded"},Fo={class:""},Eo=["onClick"],Po=ue(()=>t("i",{class:"bi bi-trash"},null,-1)),To=[Po],zo={class:"d-flex text-secondary ms-2"},Oo={class:"add-options hover-light"},Go=ue(()=>t("i",{class:"bi bi-plus"},null,-1)),Lo=ue(()=>t("i",{class:"bi bi-plus"},null,-1)),No=P({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=L(),o=d,p=S(()=>o.filter),y=S(()=>p.value.filters),m=S(()=>{let l=255-(p.value.depth+1)*5;return`background: rgb(${l},${l},${l});`});function h(l,u){o.manager.updateFilter(l,{propertyId:u}),o.manager.update(!0)}function v(l){o.manager.deleteFilter(l.id),o.manager.update(!0)}function _(l){o.manager.addNewFilterGroup(l),o.manager.update(!0)}function n(l,u){o.manager.updateFilterGroup(l,u),o.manager.update(!0)}return(l,u)=>{const c=Me("FilterGroupInput",!0);return s(),a("div",fo,[t("table",ho,[(s(!0),a(V,null,R(y.value,(g,C)=>(s(),a("tr",null,[t("td",bo,[C==0?(s(),a("div",$o,b(l.$t("modals.filters.where")),1)):C==1?(s(),F(Z,{key:1},{button:k(()=>[t("div",ko,[t("span",wo,b(l.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:I})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:I},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=w=>n(p.value.id,i(ke).and))},b(l.$t("modals.filters.and")),1),Io,t("div",{class:"base-btn",onClick:u[1]||(u[1]=w=>n(p.value.id,i(ke).or))},b(l.$t("modals.filters.or")),1)],8,xo)]),_:1})):(s(),a("span",So,b(p.value.groupOperator),1))]),g.propertyId!==void 0?(s(),a("td",Co,[$(go,{"model-value":i(e).data.properties[g.propertyId],"onUpdate:modelValue":I=>h(g.id,I.id)},null,8,["model-value","onUpdate:modelValue"])])):f("",!0),g.propertyId!==void 0?(s(),a("td",Mo,[$(pe,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":g.id,parent:o.parent},{default:k(()=>[$(mo,{filter:g},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),a("td",{key:2,colspan:"3",style:A(m.value)},[t("div",Vo,[$(c,{filter:g,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",Fo,[t("span",{class:"base-btn",onClick:I=>v(g)},To,8,Eo)])]))),256))]),t("div",zo,[$(pe,{manager:o.manager,"parent-id":p.value.id},{default:k(()=>[t("div",Oo,[Go,Q(b(l.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=g=>_(p.value.id))},[Lo,Q(b(l.$t("modals.filters.new_group")),1)])])])}}});const Do=N(No,[["__scopeId","data-v-b9005f3e"]]),Ro=d=>(W("data-v-c6a37a82"),d=d(),Y(),d),Uo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},jo={key:0},Ao=Ro(()=>t("span",{class:"text-primary"},"Text Query",-1)),Ho={key:0,class:"or-separator"},Bo={key:0,class:"or-separator"},qo={key:0,class:"m-1 p-0"},Ko=P({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(d,{emit:r}){const e=L(),o=d,p=x(null),y=x(null),m=S(()=>{let v=h(o.manager.state.filter),_={};return v.forEach(n=>_[n.propertyId]=n),Object.values(_)});function h(v){let _=[];for(let n of v.filters)n.isGroup?_.push(...h(n)):_.push(n);return _}return B(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&y.value.hide()}),(v,_)=>(s(),F(Z,{ref_key:"dropdownElem",ref:y},{button:k(()=>[t("div",null,[m.value.length||o.manager.state.query?(s(),a("div",Uo,[o.manager.state.query?(s(),a("div",jo,[Ao,m.value.length?(s(),a("span",Ho,"|")):f("",!0)])):f("",!0),(s(!0),a(V,null,R(m.value,(n,l)=>(s(),a("div",null,[l>0?(s(),a("span",Bo,"|")):f("",!0),n.propertyId==i(ye).id?(s(),F(ie,{key:1,type:i(e).data.properties[n.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),t("span",null,b(i(e).data.properties[n.propertyId].name),1)]))),256))])):f("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(i(e).data.properties).length>0?(s(),a("div",qo,[$(Do,{filter:o.manager.state.filter,manager:o.manager,parent:p.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const Qo=N(Ko,[["__scopeId","data-v-c6a37a82"]]),Wo=d=>(W("data-v-1d7e82c5"),d=d(),Y(),d),Yo={class:"d-flex flex-row filter-form"},Xo={class:"pt-1 pb-1"},Jo=Wo(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),Zo=P({__name:"FilterForm",props:{manager:de},setup(d){const r=d;return(e,o)=>(s(),a("div",Yo,[t("div",Xo,b(e.$t("main.menu.filters"))+": ",1),$(Qo,{manager:r.manager},null,8,["manager"]),$(pe,{manager:r.manager,class:"p-1"},{default:k(()=>[Jo]),_:1},8,["manager"])]))}});const ea=N(Zo,[["__scopeId","data-v-1d7e82c5"]]),ta=d=>(W("data-v-59c1ca07"),d=d(),Y(),d),sa=ta(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),oa={class:"p-1"},aa=P({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,o=r,p=x(null);return(y,m)=>(s(),F(Z,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[sa]),popup:k(()=>[t("div",oa,[$(fe,{onClick:m[0]||(m[0]=h=>i(ve)()),onSelect:m[1]||(m[1]=h=>{o("select",h),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Fe=N(aa,[["__scopeId","data-v-59c1ca07"]]),na={class:"base-hover ps-1 pe-1"},la={class:"main"},ia=["onClick"],ra=P({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,o=r,p=Object.values(Ve);function y(m){o("update:modelValue",m)}return(m,h)=>(s(),F(Z,null,{button:k(()=>[t("div",na,b(e.modelValue),1)]),popup:k(({hide:v})=>[t("div",la,[(s(!0),a(V,null,R(i(p),_=>(s(),a("div",{class:"base-hover option",onClick:n=>{y(_),v()}},b(_),9,ia))),256))])]),_:1}))}});const da=N(ra,[["__scopeId","data-v-cc9d0d61"]]),pa=d=>(W("data-v-a27bea28"),d=d(),Y(),d),ua=pa(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ca={class:""},_a={class:"d-flex ipt"},ma={class:"ms-2",min:"1"},va=P({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,o=r,p=x(1),y=x(Ve.Year);function m(){e.option.stepSize==p.value&&e.option.stepUnit==y.value||o("change",{stepSize:p.value,stepUnit:y.value})}function h(){p.value=e.option.stepSize??1,y.value=e.option.stepUnit}return B(()=>e.option,h),oe(h),B(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(v,_)=>(s(),F(Z,{onHide:m},{button:k(()=>[ua]),popup:k(({hide:n,focus:l})=>[t("div",ca,[t("div",_a,[t("div",null,[le(t("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=u=>p.value=u)},null,512),[[re,p.value]])]),t("div",ma,[$(da,{modelValue:y.value,"onUpdate:modelValue":_[1]||(_[1]=u=>y.value=u),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}});const ya=N(va,[["__scopeId","data-v-a27bea28"]]),ga={class:"d-flex flex-row group-form"},fa={class:"pt-1 pb-1"},ha={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},ba={key:0,class:"bi bi-chevron-right smaller"},$a=["onClick"],ka=["onClick"],wa=["onClick"],xa=["onClick"],Ia=["onClick"],Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa={key:5,class:"sm-btn"},Ea={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Pa=P({__name:"GroupForm",props:{isLoading:Boolean,manager:je},setup(d){const r=L(),e=d;function o(n){e.manager.setGroupOption(n),e.manager.update(!0)}function p(n){e.manager.delGroupOption(n),e.manager.update(!0)}function y(n,l){e.manager.setGroupOption(n,{direction:l}),e.manager.sortGroups(!0)}function m(n,l){e.manager.setGroupOption(n,{type:l}),e.manager.sortGroups(!0)}function h(n,l){e.manager.setGroupOption(n,l),e.manager.update(!0)}const v=S(()=>e.manager.state.groupBy.map(n=>r.data.properties[n])),_=S(()=>{const n=[];return e.manager.state.groupBy.forEach(l=>{n.push({option:e.manager.state.options[l],property:r.data.properties[l]})}),n});return(n,l)=>(s(),a("div",ga,[t("div",fa,b(n.$t("main.menu.groupby"))+": ",1),v.value.length?(s(),a("div",ha,[(s(!0),a(V,null,R(_.value,(u,c)=>(s(),a(V,null,[c>0?(s(),a("i",ba)):f("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:g=>p(u.property.id),id:"remove-group-button"},b(u.property.name),9,$a),u.option.type==i(te).Size?(s(),F(E,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:g=>m(u.property.id,i(te).Property)},null,8,ka)):(s(),a("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:g=>m(u.property.id,i(te).Property)},null,8,wa))]),_:2},1024)):(s(),F(E,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==i(M).number?(s(),a(V,{key:0},[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:g=>m(u.property.id,i(te).Size)},null,8,xa)):(s(),a("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:g=>m(u.property.id,i(te).Size)},null,8,Ia))],64)):(s(),a(V,{key:1},[u.option.direction==i(J).Ascending?(s(),a("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:g=>m(u.property.id,i(te).Size)},null,8,Sa)):(s(),a("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:g=>m(u.property.id,i(te).Size)},null,8,Ca))],64))]),_:2},1024)),u.option.direction==i(J).Ascending?(s(),F(E,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:g=>y(u.property.id,i(J).Descending)},null,8,Ma)]),_:2},1024)):(s(),F(E,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:g=>y(u.property.id,i(J).Ascending)},null,8,Va)]),_:2},1024)),u.property.type==i(M).date?(s(),a("div",Fa,[$(ya,{option:u.option,onChange:g=>h(u.property.id,g)},null,8,["option","onChange"])])):f("",!0)],64))),256)),e.isLoading?(s(),a("i",Ea)):f("",!0)])):f("",!0),$(Fe,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:l[0]||(l[0]=u=>o(u))},null,8,["group-ids"])]))}});const Ta=N(Pa,[["__scopeId","data-v-47631987"]]),za={class:"d-flex flex-row sort-form"},Oa={class:"pt-1 pb-1"},Ga={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},La={key:0,class:"bi bi-chevron-right smaller"},Na=["onClick"],Da=["onClick"],Ra=["onClick"],Ua=P({__name:"SortForm",props:{manager:Ae},setup(d){const r=L(),e=d,o=S(()=>e.manager.state.sortBy.map(v=>({propertyId:v,direction:e.manager.state.options[v].direction}))),p=S(()=>o.value.map(v=>v.propertyId));function y(v){e.manager.setSort(v),e.manager.update(!0)}function m(v){e.manager.delSort(v),e.manager.update(!0)}function h(v,_){e.manager.setSort(v,{direction:_}),e.manager.update(!0)}return(v,_)=>(s(),a("div",za,[t("div",Oa,b(v.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),a("div",Ga,[(s(!0),a(V,null,R(o.value,(n,l)=>(s(),a(V,null,[l>0?(s(),a("i",La)):f("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>m(n.propertyId)},b(i(r).data.properties[n.propertyId].name),9,Na),n.direction==i(J).Ascending?(s(),F(E,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>h(n.propertyId,i(J).Descending)},null,8,Da)]),_:2},1024)):(s(),F(E,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>h(n.propertyId,i(J).Ascending)},null,8,Ra)]),_:2},1024))],64))),256))])):f("",!0),$(Fe,{"group-ids":p.value,onSelect:_[0]||(_[0]=n=>y(n))},null,8,["group-ids"])]))}});const ja=N(Ua,[["__scopeId","data-v-bc2e0a7f"]]),he=d=>(W("data-v-8c580b43"),d=d(),Y(),d),Aa={class:"d-flex flex-row p-2"},Ha=he(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Ba=["placeholder"],qa={class:"me-5 d-flex"},Ka=he(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Qa={class:"ms-5",style:{"font-size":"13px"}},Wa=["checked"],Ya=he(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),Xa={class:"d-flex flex-wrap content-container ps-2"},Ja=P({__name:"ContentFilter",props:{tab:He,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){const e=d,o=x(""),p=S(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),y=S(()=>p.value.length);function m(n){const l=n.target.checked;e.tab.collection.groupManager.setSha1Mode(l,!0)}function h(){o.value=e.tab.state.filterState.query}function v(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function _(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return oe(h),B(()=>e.tab.collection.filterManager.state.query,h),(n,l)=>(s(),a(V,null,[t("div",Aa,[$(E,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:D(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[Ha,le(t("input",{type:"text",class:"input-hidden",placeholder:n.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=u=>o.value=u),onChange:v},null,40,Ba),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")],2)]),_:1}),t("div",qa,[$(E,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:D("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),$(E,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:D("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),$(E,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[Ka]),_:1}),t("div",null,[$(Be,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":l[3]||(l[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",Qa,[$(E,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:m},null,40,Wa),Ya]),_:1})]),y.value?(s(),F(qe,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":l[4]||(l[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0)]),t("div",Xa,[$(ea,{manager:e.tab.collection.filterManager},null,8,["manager"]),$(Ta,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),$(ja,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Za=N(Ja,[["__scopeId","data-v-8c580b43"]]),en={class:""},tn=["src"],sn={class:"d-flex flex-row"},on=P({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=ge();L();const o=d,p=r,y=S(()=>`width: ${o.size}px; height: ${o.size}px;`),m=S(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),h=S(()=>o.pile.images[0]);return(v,_)=>(s(),a("div",en,[$(Ke,{image:h.value},{default:k(()=>[t("div",{style:A(y.value),class:"img-container",onClick:_[0]||(_[0]=n=>i(e).showModal(i(se).IMAGE,{image:h.value}))},[t("img",{src:h.value.url,style:A(m.value)},null,12,tn)],4)]),_:1},8,["image"]),t("div",sn,[$(E,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:A(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:_[1]||(_[1]=n=>p("accept",h.value))}," ✓ ",4)]),_:1}),$(E,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:A(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:_[2]||(_[2]=n=>p("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const an=N(on,[["__scopeId","data-v-1ea540e7"]]),nn=d=>(W("data-v-35e00f94"),d=d(),Y(),d),ln={class:"reco-container"},rn={class:"d-flex flex-row m-0 ps-2 pb-2"},dn={class:"text-secondary me-2"},pn={class:"flex-grow-1"},un={class:"d-flex flex-row"},cn={key:0,class:"separator"},_n=nn(()=>t("i",{class:"bi bi-x"},null,-1)),mn=[_n],vn={class:"d-flex flex-row"},me=10,yn=P({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=L(),o=d,p=r,y=x(1),m=ne([]),h=ne([]),v=ne([]),_=ne(new Set);function n(I){let w=h.indexOf(I);w<0||(h.splice(w,1),c())}function l(I){v.forEach(w=>{if(w.value!=Ye){const T=e.data.properties[w.propertyId];let G=w.value;T.type==M.multi_tags?e.setTagPropertyValue(w.propertyId,I,[G],"add"):e.setPropertyValue(w.propertyId,I,G)}}),n(I.sha1)}function u(I){_.add(I.sha1),n(I.sha1)}function c(){m.length=0;const I=h.map(w=>({sha1:w,images:e.data.sha1Index[w]}));g(I,m,y.value,o.imageSize,o.width)}function g(I,w,T,G,K){let j=K,z=[],O=0;for(let U=0;U<I.length&&!(w.length>=T);U++){let X=I[U];if(_.has(X.sha1))continue;let ce=G+me;if(O+ce<j){z.push(X),O+=ce;continue}if(z.length==0)throw new Error("Images seems to be to big for the line");w.push(z),w.length<T&&(z=[X],O=ce)}z.length>0&&w.length<T&&w.push(z)}async function C(){if(!o.group)return;console.log("get reco");const I=o.group.images.map(K=>K.id);let w=await Qe({instanceIds:I});w.matches.sort((K,j)=>j.score-K.score);const T=Array.from(new Set(w.matches.map(K=>e.data.images[K.id].sha1)));v.length=0;let G=o.group;for(;G;)v.push(...G.meta.propertyValues),G=G.parent;h.length=0,h.push(...T),_.clear(),c(),p("update")}return oe(C),B(()=>o.group,()=>{C(),_.clear()}),B(()=>o.imageSize,c),B(()=>o.width,c),(I,w)=>(s(),a("div",ln,[t("div",rn,[$(E,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",dn,b(I.$t("main.recommand.title")),1)]),_:1}),t("div",pn,[t("div",un,[(s(!0),a(V,null,R(v,(T,G)=>(s(),a(V,null,[$(We,{class:"",value:T},null,8,["value"]),G<v.length-1?(s(),a("div",cn)):f("",!0)],64))),256))])]),t("span",{class:"text-secondary scroll ps-1 pe-1 clickable",onClick:w[0]||(w[0]=T=>p("scroll",o.group.id))},b(I.$t("main.recommand.group")),1),t("span",{class:"text-secondary me-1 close ps-1 pe-1 clickable",onClick:w[1]||(w[1]=T=>p("close"))},mn)]),t("div",{style:A("margin-left:"+me+"px;")},[(s(!0),a(V,null,R(m,T=>(s(),a("div",null,[t("div",vn,[(s(!0),a(V,null,R(T,G=>(s(),F(an,{pile:G,size:o.imageSize,onAccept:l,onRefuse:u,style:A("margin-right:"+me+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const gn=N(yn,[["__scopeId","data-v-35e00f94"]]),fn={key:0,class:"m-0 p-0"},hn={key:0,style:{"margin-left":"10px"}},bn=P({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=L(),e=r.getTabManager(),o=d,p=x({}),y=x(null),m=x(null),h=x(null),v=x([]),_=x(0),n=x(0),l=ne({groups:!1}),u=S(()=>e.getVisibleProperties());function c(){y.value&&m.value?_.value=o.height-y.value.clientHeight-m.value.clientHeight-5:y.value?_.value=o.height-y.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{h.value&&e.state.display=="tree"&&h.value.computeLines()});function g(w){p.value=e.collection.groupManager.result.index[w],ee(()=>c())}async function C(w){w===""?v.value=[]:v.value=await Ze({text:w})}function I(){p.value={},ee(()=>c())}return oe(()=>{n.value=y.value.clientWidth,window.addEventListener("resize",()=>{ee(()=>{var w;n.value=((w=y.value)==null?void 0:w.clientWidth)??n.value})})}),B(e.state,w=>{r.updateTab(e.state)},{deep:!0}),B(()=>e.state.imageSize,()=>ee(c)),B(()=>o.height,async()=>{await ee(c)}),(w,T)=>(s(),a(V,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:y},[$(Za,{tab:i(e),"compute-status":l,onSearchImages:C},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:m,class:"m-0 p-0"},[p.value.id?(s(),a("div",fn,[$(gn,{group:p.value,"image-size":i(e).state.imageSize,width:n.value,height:50,onClose:I,onScroll:h.value.scrollTo,onUpdate:T[0]||(T[0]=G=>ee(()=>c()))},null,8,["group","image-size","width","onScroll"])])):f("",!0)],512),n.value>0&&_.value>0?(s(),a("div",hn,[i(e).state.display=="tree"?(s(),F(Xe,{key:0,"group-manager":i(e).collection.groupManager,"image-size":i(e).state.imageSize,height:_.value-0,properties:u.value,"hide-if-modal":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,width:n.value-25,onRecommend:g},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),i(e).state.display=="grid"?(s(),a("div",{key:1,style:A({width:n.value-12+"px"}),class:"p-0 m-0 grid-container"},[$(Je,{manager:i(e).collection.groupManager,height:_.value-15,width:n.value-40,"selected-properties":u.value,class:"p-0 m-0","show-images":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):f("",!0)])):f("",!0)],64))}});const $n=N(bn,[["__scopeId","data-v-e742adf8"]]),kn={class:"d-flex d-row",style:{cursor:"pointer"}},wn=["onMouseenter","onMouseleave"],xn=["onClick"],In=["onClick"],Sn=["onClick"],Cn=["onSubmit"],Mn=["onKeydown","onUpdate:modelValue"],Vn=t("span",{class:"bi bi-plus"},null,-1),Fn=[Vn],En={class:"lang"},Pn=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),Tn=["value"],zn=P({__name:"TabNav",props:{reRender:Function},setup(d){const r=L(),e=x(-1),o=x(""),p=x(null),y=d;function m(c){r.data.selectedTabId==c||v(),r.selectTab(c)}function h(c){e.value=c,o.value=r.data.tabs[c].name,ee(()=>p.value[0].focus())}function v(){e.value=-1,o.value=""}function _(c){r.addTab("New Tab")}async function n(c){confirm("Are you sure to delete Tab: "+c.name)&&await r.removeTab(c.id)}const l=ne({});x(-1);const u=["fr","en"];return(c,g)=>(s(),a("nav",null,[t("div",kn,[(s(!0),a(V,null,R(i(r).data.tabs,C=>(s(),a("div",{class:"d-flex d-row me-2",onMouseenter:I=>l[C.id]=!0,onMouseleave:I=>l[C.id]=!1},[e.value!=C.id?(s(),a(V,{key:0},[$(E,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:I=>h(C.id),class:D(["bi bi-pencil me-1 tab-icon hover-light",l[C.id]&&i(r).data.selectedTabId==C.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,xn)]),_:2},1024),t("div",{class:D(["tab-button",C.id==i(r).data.selectedTabId?" active":""]),onClick:I=>m(C.id)},[t("span",null,b(C.name),1)],10,In),$(E,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:I=>n(C),class:D(["btn-icon bi bi-x tab-icon hover-light",l[C.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Sn)]),_:2},1024)],64)):(s(),a("div",{key:1,class:D(["tab-button",C.id==i(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:Ce(v,["stop","prevent"])},[le(t("input",{onFocusout:v,onKeydown:et(v,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":I=>C.name=I,ref_for:!0,ref_key:"inputElem",ref:p},null,40,Mn),[[re,C.name]])],40,Cn)],2))],40,wn))),256)),$(E,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_,id:"add-tab-button"},Fn)]),_:1}),t("div",En,[Pn,le(t("select",{"onUpdate:modelValue":g[0]||(g[0]=C=>c.$i18n.locale=C),onChange:g[1]||(g[1]=C=>y.reRender())},[(s(),a(V,null,R(u,(C,I)=>t("option",{key:`Lang${I}`,value:C},b(C.toUpperCase()),9,Tn)),64))],544),[[tt,c.$i18n.locale]])])])]))}});const Ee=d=>(W("data-v-1e51323e"),d=d(),Y(),d),On={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Gn={key:0},Ln={key:1,class:"w-100"},Nn={key:0,class:"custom-hr"},Dn={key:2,class:"loading"},Rn={class:"text-center"},Un={key:3,class:"loading"},jn=Ee(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),An=Ee(()=>t("span",{class:"ms-1"},"Loading...",-1)),Hn=[jn,An],Bn=P({__name:"PanopticView",setup(d){const r=L(),e=ge(),o=x(null),p=x(null),y=x(window.innerHeight),m=x(!1),h=S(()=>{var c;return y.value-(((c=p.value)==null?void 0:c.clientHeight)??0)}),v=S(()=>{var c;return(c=o.value)==null?void 0:c.filteredImages.map(g=>g.id)});oe(async()=>{e.isProjectLoaded||we.push("/"),ee(()=>{window.addEventListener("resize",_),_()}),window.addEventListener("keydown",c=>{c.key=="Control"&&(H.ctrl=!0),c.key=="Alt"&&(H.alt=!0),c.key=="Shift"&&(H.shift=!0),c.key=="ArrowLeft"&&(H.left=!0),c.key=="ArrowRight"&&(H.right=!0)}),window.addEventListener("keyup",c=>{c.key=="Control"&&(H.ctrl=!1),c.key=="Alt"&&(H.alt=!1),c.key=="Shift"&&(H.shift=!1),c.key=="ArrowLeft"&&(H.left=!1),c.key=="ArrowRight"&&(H.right=!1)}),window.addEventListener("mousemove",c=>{H.ctrl=c.ctrlKey,H.alt=c.altKey,H.shift=c.shiftKey})}),st(()=>{window.removeEventListener("resize",_)});function _(){y.value=window.innerHeight,m.value=!0}function n(){e.showModal(se.EXPORT,v)}function l(){r.rerender()}function u(){we.push("/")}return(c,g)=>(s(),a(V,null,[$(ot,{tutorial:"project"}),(s(),a("div",{id:"panoptic",key:i(r).status.renderNb},[t("div",On,[i(r).status.loaded?(s(),a("div",Gn,[$(Hs,{onExport:g[0]||(g[0]=C=>n())})])):f("",!0),i(r).status.loaded?(s(),a("div",Ln,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[$(zn,{"re-render":l})],512),m.value?(s(),a("div",Nn)):f("",!0),i(r).status.loaded?(s(),F($n,{key:1,"tab-id":i(r).data.selectedTabId,height:h.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):f("",!0)])):i(e).isProjectLoaded?(s(),a("div",Un,Hn)):(s(),a("div",Dn,[t("div",Rn,[t("div",null,b(c.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Qn=N(Bn,[["__scopeId","data-v-1e51323e"]]);export{Qn as default};
