import{d as L,Q as Oe,u as ce,S as ae,z as X,r as F,c as T,V as W,o as s,a as r,b as e,F as O,m as x,W as ue,t as b,h as y,p as M,w as re,v as me,e as m,X as we,M as se,x as k,Y as E,Z as fe,$ as Ce,n as B,O as N,a0 as ye,i as J,a1 as Pe,_ as j,D as te,a2 as De,a3 as he,q,f as Y,a4 as Se,a5 as ve,a6 as be,g as _e,a7 as Ge,a8 as ke,a9 as Le,aa as Re,J as Ae,ab as je,ac as Ue,K as He,R as Be,L as Ne,ad as We,ae as qe,af as Ke,ag as Me,k as ne,j as Z,ah as Ve,ai as Qe,aj as oe,ak as ee,al as Ye,am as Xe,an as Ze,ao as Je,ap as et,aq as tt,ar as st,as as ie,at as ot,au as at,av as lt,aw as nt,ax as Ie,ay as it,az as rt,s as dt,aA as ut,l as $e,A}from"./index-926a2253.js";import{_ as pt}from"./Tutorial-fed23036.js";const pe={},ct={class:"d-flex flex-row"},mt={key:2,class:"d-flex",style:{width:"150px"}},vt={class:"flex-grow-1"},gt={key:1,style:{"padding-top":"1px"}},ft={style:{width:"20px","margin-top":"2px"},class:"text-center"},_t={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},yt={key:0},ht={key:0,class:"ms-3 pt-1"},bt={key:1},kt=L({__name:"PropertyOptions",props:{property:{},open:{type:Boolean}},setup(w){const{t:_}=Oe({useScope:"global"}),t=ce(),o=ae(),d=X(),u=o.getTabManager(),n=w,g=F(!1),p=F(!1),i=F(""),a=F(!1),l=T(()=>o.getTab()),c=T(()=>l.value.visibleProperties[n.property.id]==!0),h=T(()=>u.collection.filterManager.state.filter.filters.some(D=>!D.isGroup&&D.propertyId==n.property.id)),$=T(()=>u.collection.groupManager.state.groupBy.includes(n.property.id)),G=T(()=>u.collection.sortManager.state.sortBy.includes(n.property.id)),V=T(()=>{if(h.value)return u.collection.filterManager.state.filter.filters.find(D=>!D.isGroup&&D.propertyId==n.property.id).id}),v=()=>u.collection.filterManager,f=T(()=>u.getSha1Mode());function I(){c.value?u.setVisibleProperty(n.property.id,!1):u.setVisibleProperty(n.property.id,!0)}function S(){n.open&&(g.value?g.value=!1:(g.value=!0,i.value=n.property.name),p.value=!1)}function C(){n.property.type!=N.tag&&n.property.type!=N.multi_tags||(p.value?p.value=!1:p.value=!0,g.value=!1)}function P(){G.value?u.collection.sortManager.delSort(n.property.id):u.collection.sortManager.setSort(n.property.id),u.collection.sortManager.update(!0)}function U(){$.value?u.collection.groupManager.delGroupOption(n.property.id):u.collection.groupManager.setGroupOption(n.property.id),u.collection.groupManager.update(!0)}function R(){confirm(_("common.properties.delete")+": "+n.property.name+" ?   "+n.property.id)&&d.deleteProperty(n.property.id)}async function H(){i.value!=""&&(await d.updateProperty(n.property.id,i.value),S())}function Q(){const D=v();h.value?(D.deleteFilter(V.value),pe.filter.hide()):(D.addNewFilter(n.property.id),pe.filter.show())}return W(()=>n.property,()=>{g.value=!1}),(D,z)=>(s(),r("div",{class:B(a.value?"hover-light":"")},[e("div",ct,[n.open?(s(),r(O,{key:0},[g.value?y("",!0):(s(),r("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:S},[x(ue,{type:n.property.type,class:"me-2 btn-icon",onMouseenter:z[0]||(z[0]=K=>a.value=!0),onMouseleave:z[1]||(z[1]=K=>a.value=!1)},null,8,["type"]),e("span",null,b(n.property.name),1)]))],64)):(s(),M(ue,{key:1,type:n.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),g.value&&n.open?(s(),r("div",mt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:S,onMouseenter:z[2]||(z[2]=K=>a.value=!0),onMouseleave:z[3]||(z[3]=K=>a.value=!1)},null,32)]),e("div",vt,[n.property.id>=0?re((s(),r("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":z[4]||(z[4]=K=>i.value=K),onChange:H},null,544)),[[me,i.value]]):(s(),r("span",gt,[x(ue,{type:n.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,b(n.property.name),1)]))])])):y("",!0),n.open?(s(),r(O,{key:3},[m(we)(n.property.type)?(s(),r("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:z[5]||(z[5]=K=>m(t).showModal(m(se).TAG,{propId:n.property.id}))},[x(E,{click:!1,message:"main.nav.properties.open_tags"},{default:k(()=>z[7]||(z[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):y("",!0),e("div",ft,[n.property.mode==m(fe).id?(s(),M(E,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>z[8]||(z[8]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):y("",!0)])],64)):y("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:I,class:"btn-icon text-center"},[f.value&&n.property.mode==m(fe).id?(s(),M(E,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[e("span",{class:"bi bi-eye-slash",onClick:z[6]||(z[6]=Ce(()=>{},["stop"]))})]),_:1})):(s(),M(E,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[e("span",{class:B("bi bi-eye text-"+(c.value?"primary":"secondary"))},null,2)]),_:1}))]),n.open?(s(),r("div",_t,[n.property.type==m(N).tag||n.property.type==m(N).multi_tags?(s(),r("div",{key:0,onClick:C,style:{cursor:"pointer"}},[p.value?(s(),M(E,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>z[9]||(z[9]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(s(),M(E,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>z[10]||(z[10]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):y("",!0)])):y("",!0)]),n.open?(s(),r("div",yt,[g.value?(s(),r("div",ht,[D.property.id!=m(ye).folders?(s(),r("div",{key:0,class:B(["options hover-light",h.value?" text-primary":""]),onClick:Q},[e("div",null,[z[11]||(z[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),J(b(D.$t("main.menu.filters")),1)])],2)):y("",!0),e("div",{class:B(["options hover-light",G.value?" text-primary":""]),onClick:P},[z[12]||(z[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),J(b(D.$t("main.menu.sort.title")),1)],2),e("div",{class:B(["options hover-light",$.value?" text-primary":""]),onClick:U},[z[13]||(z[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),J(b(D.$t("main.menu.groupby")),1)],2),n.property.id>=0?(s(),r("div",{key:1,class:"options hover-light",onClick:R},[z[14]||(z[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),J(b(D.$t("main.nav.properties.delete_property")),1)])):y("",!0)])):p.value?(s(),r("div",bt,[x(Pe,{property:n.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):y("",!0)])):y("",!0)],2))}});const xe=j(kt,[["__scopeId","data-v-908dfa0f"]]),$t={class:"text-nowrap"},xt=["onClick"],wt=["onClick"],Ct=L({__name:"FolderOptionDropdown",props:{folder:{}},setup(w){const _=X(),t=w;function o(){_.reImportFolder(t.folder.id)}function d(){confirm(De.global.t("main.nav.folders.del_alert"))&&_.deleteFolder(t.folder.id)}return(u,n)=>(s(),M(te,{teleport:!0},{button:k(()=>n[0]||(n[0]=[e("i",{class:"bi bi-three-dots base-hover"},null,-1)])),popup:k(({hide:g})=>[e("div",$t,[e("div",{class:"p-2 bb",onClick:p=>{o(),g()}},n[1]||(n[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),J("Re import")]),8,xt),n[3]||(n[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:p=>{d(),g()}},[n[2]||(n[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),J(b(u.$t("main.nav.folders.del")),1)],8,wt)])]),_:1}))}}),St=["onMouseenter"],Mt={style:{display:"inline"}},Vt=["onClick"],It={class:"text-secondary"},Ft=["onClick"],Tt=L({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:he,root:{type:Boolean,default:!0}},setup(w){const _=X(),t=w,o=F(null),d=T(()=>{let a={};const l=new Set(t.filterManager.state.folders);return t.folders.map(c=>c.id).forEach(c=>{l.has(c)&&(a[c]=!0)}),a}),u=T(()=>{let a={};return t.folders.map(l=>l.id).forEach(l=>{t.visibleFolders[l]&&(a[l]=!0)}),a}),n=T(()=>{let a={};return t.folders.forEach(l=>{let c=[];d.value[l.id]&&c.push("selected"),a[l.id]=c.join(" ")}),a});function g(a){let l=t.visibleFolders;l[a]?delete l[a]:l[a]=!0}function p(a){let l=new Set(t.filterManager.state.folders);const c=l.has(a),h=_.folders[a].parent!=null&&l.has(_.folders[a].parent);c&&!h?(l.delete(a),ve(a).forEach($=>l.delete($.id))):(i(a,l),l.add(a),ve(a).forEach($=>l.add($.id)),be(_.folders[a]).forEach($=>l.delete($.id))),t.filterManager.setFolders(Array.from(l)),t.filterManager.update(!0)}function i(a,l){const c=be(_.folders[a]);let h;for(let $ of c)if(l.has($.id))h=$;else break;h!=null&&ve(h.id).forEach($=>l.delete($.id))}return(a,l)=>{const c=Se("FolderList2",!0);return s(),r("ul",{class:B(t.root?"tree":""),style:Y(t.root?"padding-left:0px;":"")},[(s(!0),r(O,null,q(w.folders,h=>(s(),r("li",{style:Y(t.root?"padding-left:0px;":""),class:"no-break",onMouseenter:$=>o.value=h.id,onMouseleave:l[0]||(l[0]=$=>o.value=null)},[e("div",Mt,[e("summary",{class:B(n.value[h.id]),onClick:$=>p(h.id)},[J(b(h.name)+" ",1),e("span",It,b(h.count),1)],10,Vt)]),h.children&&h.children.length>0?(s(),r("i",{key:0,onClick:$=>g(h.id),class:B("bi bi-chevron-"+(u.value[h.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ft)):y("",!0),e("span",{class:B(o.value===h.id?"visible-option":"invisible-option")},[x(Ct,{folder:h,style:{display:"inline-block"}},null,8,["folder"])],2),h.children&&h.children.length>0&&u.value[h.id]?(s(),M(c,{key:1,folders:h.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager},null,8,["folders","visible-folders","filter-manager"])):y("",!0)],44,St))),256))],6)}}});const zt=j(Tt,[["__scopeId","data-v-845ce316"]]),Et={class:"text-center"},Ot={class:"w-100 text-center",style:{"font-size":"10px"}},Pt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Dt=L({__name:"TaskStatus",props:{task:{}},setup(w){const _=w,t=T(()=>_.task.total-_.task.remain-_.task.computing),o=T(()=>_.task.total);return(d,u)=>(s(),r("div",Et,[J(b(_.task.name)+" ",1),e("div",Ot,b(t.value)+" / "+b(o.value)+" "+b(d.$t("main.nav.tasks.done")),1),o.value>0?(s(),r("div",Pt,[e("div",{class:"progress-bar",style:Y(`width: ${t.value/o.value*100}%`)},null,4)])):y("",!0)]))}}),Gt={class:""},Lt={class:"m-0",style:{padding:"4px 0px 4px 8px"}},Rt={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},At={key:0,class:"bi bi-chevron-left"},jt={key:1,class:"bi bi-chevron-right"},Ut={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},Ht={class:"d-flex align-items-center"},Bt={style:{"max-height":"300px",overflow:"auto"}},Nt={key:0,id:"import"},Wt={class:"pt-1 pb-2"},qt={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},Kt={key:0,class:"ps-2 pe-2"},Qt={class:"p-1"},Yt={key:0,class:"custom-hr"},Xt={class:"p-2 mt-0"},Zt={key:0,class:"d-flex"},Jt={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},es={key:1,class:"bb me-1"},ts={class:"bb me-2"},ss={key:1,class:"mt-2"},os={key:0,class:"property-item"},as={class:"p-2 mt-0"},ls={key:1,class:"mt-2"},ns={key:0,class:"property-item"},is=200,rs=55,ds=L({__name:"Menu",emits:["export","toggle"],setup(w,{emit:_}){const t=ae(),o=X(),d=ce(),u=t.getTabManager(),n=_,g=F(!1),p=F(!1),i=F(!0),a=T(()=>i.value?is:rs),l=async V=>{d.showModal(se.IMPORT)},c=T(()=>t.backendStatus.tasks.filter(V=>!V.done));function h(){d.showModal(se.FOLDERSELECTION,{callback:$,mode:"images"})}function $(V){V&&o.addFolder(V)}function G(){i.value=!i.value,n("toggle")}return W(()=>t.status.import.to_import,()=>g.value=!0),(V,v)=>{var f;return s(),r("div",{class:"menu overflow-scroll",style:Y({width:a.value+"px"})},[e("div",Gt,[e("div",null,[e("div",Lt,[e("div",Rt,[i.value?(s(),r(O,{key:0},[e("div",{class:"flex-grow-1 text-capitalize overflow-hidden",onClick:v[0]||(v[0]=()=>{})},b((f=m(d).data.status.selectedProject)==null?void 0:f.name),1),e("div",{class:"base-hover p-1",onClick:v[1]||(v[1]=I=>m(d).closeProject())},v[6]||(v[6]=[e("i",{class:"bi bi-x-octagon-fill red-hover"},null,-1)])),e("div",{class:"base-hover p-1",onClick:v[2]||(v[2]=I=>m(d).showModal(m(se).SETTINGS))},v[7]||(v[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):y("",!0),e("div",{class:B(["base-hover p-1",i.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:G},[i.value?(s(),r("i",At)):(s(),r("i",jt))],2)])]),i.value?(s(),r(O,{key:0},[v[9]||(v[9]=e("div",{class:"custom-hr"},null,-1)),e("div",Ut,[e("div",Ht,[e("div",null,[e("b",null,b(V.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:v[3]||(v[3]=I=>{h(),m(_e)()})},[x(E,{message:"main.nav.folders.add"},{default:k(()=>v[8]||(v[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",Bt,[m(t).getTab()?(s(),M(zt,{key:0,folders:m(o).folderRoots,"filter-manager":m(u).collection.filterManager,"visible-folders":m(u).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):y("",!0)])])],64)):y("",!0),i.value?(s(),r(O,{key:1},[c.value&&c.value.length?(s(),r("div",Nt,[v[11]||(v[11]=e("div",{class:"custom-hr"},null,-1)),e("div",Wt,[e("div",qt,[e("div",null,[e("b",null,b(V.$t("main.nav.tasks.title")),1)])]),v[10]||(v[10]=e("div",{class:"custom-hr"},null,-1)),m(t).backendStatus?(s(),r("div",Kt,[(s(!0),r(O,null,q(c.value,(I,S)=>(s(),r("div",Qt,[S?(s(),r("div",Yt)):y("",!0),x(Dt,{task:I},null,8,["task"])]))),256))])):y("",!0)])])):y("",!0)],64)):y("",!0),v[16]||(v[16]=e("div",{class:"custom-hr"},null,-1)),e("div",Xt,[i.value?(s(),r("div",Zt,[x(E,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[e("b",null,b(V.$t("main.nav.properties.title")),1)]),_:1}),v[13]||(v[13]=e("span",{class:"flex-grow-1"},null,-1)),p.value?(s(),r("span",Jt,v[12]||(v[12]=[e("span",{class:"sr-only"},null,-1)]))):(s(),r("span",es,[x(E,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:l})]),_:1})])),e("span",ts,[x(E,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:v[4]||(v[4]=I=>m(d).showModal(m(se).EXPORT,void 0))})]),_:1})])])):y("",!0),m(t).status.loaded?(s(),r("div",ss,[(s(!0),r(O,null,q(m(o).properties,I=>(s(),r(O,null,[I.id>=0?(s(),r("div",os,[x(xe,{property:I,open:i.value},null,8,["property","open"])])):y("",!0)],64))),256)),i.value?(s(),r(O,{key:0},[v[15]||(v[15]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:v[5]||(v[5]=I=>{m(d).showModal(m(se).PROPERTY,void 0),m(_e)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[v[14]||(v[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,b(V.$t("main.nav.properties.add_property")),1)])],64)):y("",!0)])):y("",!0)]),v[17]||(v[17]=e("div",{class:"custom-hr"},null,-1)),e("div",as,[i.value?(s(),M(E,{key:0,message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[e("b",null,b(V.$t("main.nav.computed.title")),1)]),_:1})):y("",!0),m(t).status.loaded?(s(),r("div",ls,[(s(!0),r(O,null,q(m(o).properties,I=>(s(),r(O,null,[I.id<0&&I.id!=m(Ge)?(s(),r("div",ns,[x(E,{pos:"bottom",message:"main.nav.computed."+Math.abs(I.id).toString()+"_tooltip"},{default:k(()=>[x(xe,{property:I,open:i.value},null,8,["property","open"])]),_:2},1032,["message"])])):y("",!0)],64))),256))])):y("",!0)])])])],4)}}});const us=j(ds,[["__scopeId","data-v-01e8223c"]]),ps={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},cs={class:""},ms=["onClick"],vs=L({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(w,{emit:_}){const t=w,o=_;function d(u){o("update:modelValue",u)}return(u,n)=>(s(),M(te,null,{button:k(()=>[e("div",ps,[e("span",cs,b(u.$t("modals.filters."+t.modelValue)),1)])]),popup:k(({hide:g})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:g},[e("div",{class:"base-btn",onClick:n[0]||(n[0]=p=>d(m(ke).and))},b(u.$t("modals.filters.and")),1),n[2]||(n[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:n[1]||(n[1]=p=>d(m(ke).or))},b(u.$t("modals.filters.or")),1)],8,ms)]),_:1}))}}),gs=["disabled"],fs={class:"m-0 p-1"},_s=["onClick"],ys=L({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(w,{emit:_}){const t=X(),o=w,d=_,u=T(()=>t.properties[o.propertyId]),n=T(()=>Le(u.value.type));async function g(p){d("update:modelValue",p)}return(p,i)=>(s(),M(te,{onHide:i[0]||(i[0]=a=>d("hide")),placement:"bottom"},{button:k(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[e("span",null,b(p.$t("modals.filters.operators."+o.modelValue)),1)],8,gs)]),popup:k(({hide:a})=>[e("div",fs,[(s(!0),r(O,null,q(n.value,l=>(s(),r("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:c=>{g(l),a()}},[e("a",null,b(p.$t("modals.filters.operators."+l)),1)],8,_s))),256))])]),_:1}))}});const hs=j(ys,[["__scopeId","data-v-21b8bb8e"]]),bs={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},ks=L({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(w,{emit:_}){const t=w,o=_;function d(u){o("update:modelValue",u)}return(u,n)=>(s(),r("div",bs,[m(we)(u.property.type)?(s(),M(Re,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":d,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==m(N).color?(s(),M(Ae,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":d,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==m(N).number?(s(),M(je,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":d,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==m(N).url?(s(),M(Ue,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":d,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==m(N).checkbox?(s(),M(He,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":d,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==m(N).date?(s(),M(Be,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":d,width:t.width,class:"sb"},null,8,["model-value","width"])):(s(),M(Ne,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":d,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),$s={class:"p-0 m-0 ps-2"},xs=L({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(w,{emit:_}){const t=X(),o=w,d=T(()=>t.properties[o.filter.propertyId]),u=T(()=>qe(o.filter.operator));function n(i){o.manager.updateFilter(o.filter.id,{operator:i})}function g(i){o.manager.updateFilter(o.filter.id,{value:i})}function p(i){o.manager.updateFilter(o.filter.id,{propertyId:i.id})}return(i,a)=>(s(),r(O,null,[e("td",$s,[x(We,{"model-value":d.value,"onUpdate:modelValue":p},null,8,["model-value"])]),e("td",null,[x(hs,{"property-id":d.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":n},null,8,["property-id","model-value"])]),e("td",null,[u.value?(s(),M(ks,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":g,property:d.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):y("",!0)])],64))}}),ws={style:{"max-height":"500px",overflow:"auto"}},Fe=L({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(w,{emit:_}){const t=w;function o(d){t.manager.addNewFilter(d,t.group.id),pe.filter.show()}return(d,u)=>(s(),M(te,{placement:"auto"},{button:k(()=>[Ke(d.$slots,"default")]),popup:k(({hide:n})=>[e("div",ws,[x(Me,{onSelect:g=>{o(g),n()},"ignore-ids":[m(ye).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Cs={class:"filter-group"},Ss={class:"table table-sm"},Ms={style:{height:"33px"}},Vs={class:""},Is={key:0,class:"m-0 p-0"},Fs={key:2,class:"text-secondary"},Ts={class:"border rounded"},zs={class:""},Es=["onClick"],Os={class:"d-flex text-secondary ms-2"},Ps={class:"add-options hover-light"},Ds=L({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(w,{emit:_}){X();const t=w,o=T(()=>t.filter),d=T(()=>o.value.filters),u=T(()=>{let i=255-(o.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function n(i){t.manager.deleteFilter(i.id)}function g(i){t.manager.addNewFilterGroup(i)}function p(i,a){t.manager.updateFilterGroup(i,a)}return(i,a)=>(s(),r("div",Cs,[e("table",Ss,[(s(!0),r(O,null,q(d.value,(l,c)=>(s(),r("tr",Ms,[e("td",Vs,[c==0?(s(),r("div",Is,b(i.$t("modals.filters.where")),1)):c==1?(s(),M(vs,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":a[0]||(a[0]=h=>p(o.value.id,h))},null,8,["model-value"])):(s(),r("span",Fs,b(i.$t("modals.filters."+o.value.groupOperator)),1))]),l.propertyId!==void 0?(s(),M(xs,{key:0,filter:l,manager:t.manager},null,8,["filter","manager"])):(s(),r("td",{key:1,colspan:"3",style:Y(u.value)},[e("div",Ts,[x(Te,{filter:l,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",zs,[e("span",{class:"base-btn",onClick:h=>n(l)},a[2]||(a[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Es)])]))),256))]),e("div",Os,[x(Fe,{group:t.filter,manager:t.manager},{default:k(()=>[e("div",Ps,[a[3]||(a[3]=e("i",{class:"bi bi-plus"},null,-1)),J(b(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:a[1]||(a[1]=l=>g(o.value.id))},[a[4]||(a[4]=e("i",{class:"bi bi-plus"},null,-1)),J(b(i.$t("modals.filters.new_group")),1)])])]))}});const Te=j(Ds,[["__scopeId","data-v-e644f737"]]),Gs={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ls={key:0},Rs={key:0,class:"or-separator"},As={key:0,class:"or-separator"},js={key:0,class:"m-1 p-1"},Us=L({__name:"MainFilterDropdown",props:{manager:he},emits:["update:modelValue"],setup(w,{emit:_}){const t=X(),o=w,d=F(null),u=F(null),n=T(()=>{let p=g(o.manager.state.filter),i={};return p.forEach(a=>i[a.propertyId]=a),Object.values(i)});function g(p){let i=[];for(let a of p.filters)a.isGroup?i.push(...g(a)):i.push(a);return i}return W(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&u.value.hide()}),ne(async()=>{await Z(),pe.filter=u.value}),(p,i)=>(s(),M(te,{ref_key:"dropdownElem",ref:u,placement:"top-start"},{button:k(()=>[e("div",null,[n.value.length||o.manager.state.query?(s(),r("div",Gs,[o.manager.state.query?(s(),r("div",Ls,[i[0]||(i[0]=e("span",{class:"text-primary"},"Text Query",-1)),n.value.length?(s(),r("span",Rs,"|")):y("",!0)])):y("",!0),(s(!0),r(O,null,q(n.value,(a,l)=>(s(),r("div",null,[l>0?(s(),r("span",As,"|")):y("",!0),a.propertyId==m(ye).id?(s(),M(ue,{key:1,type:m(t).properties[a.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):y("",!0),e("span",null,b(m(t).properties[a.propertyId].name),1)]))),256))])):y("",!0)])]),popup:k(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:d},[Object.keys(m(t).properties).length>0?(s(),r("div",js,[x(Te,{filter:o.manager.state.filter,manager:o.manager,parent:d.value},null,8,["filter","manager","parent"])])):y("",!0)],512)]),_:1},512))}});const Hs=j(Us,[["__scopeId","data-v-56cd3bdb"]]),Bs={class:"d-flex flex-row filter-form"},Ns={class:"pt-1 pb-1"},Ws=L({__name:"FilterForm",props:{manager:he},setup(w){const _=w;return(t,o)=>(s(),r("div",Bs,[e("div",Ns,b(t.$t("main.menu.filters"))+": ",1),x(Hs,{manager:_.manager},null,8,["manager"]),x(Fe,{manager:_.manager,group:_.manager.state.filter,class:"p-1"},{default:k(()=>o[0]||(o[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}});const qs=j(Ws,[["__scopeId","data-v-cc2f25ec"]]),Ks={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},Qs=L({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(w,{emit:_}){const t=w,o=_,d=F(null);return(u,n)=>(s(),M(te,{ref_key:"dropdownElem",ref:d,"auto-focus":!1},{button:k(()=>n[2]||(n[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:k(()=>[e("div",Ks,[x(Me,{onClick:n[0]||(n[0]=g=>m(_e)()),onSelect:n[1]||(n[1]=g=>{o("select",g),d.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const ze=j(Qs,[["__scopeId","data-v-012e1f38"]]),Ys={class:"base-hover ps-1 pe-1"},Xs={class:"main"},Zs=["onClick"],Js=L({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(w,{emit:_}){const t=w,o=_,d=Object.values(Ve);function u(n){o("update:modelValue",n)}return(n,g)=>(s(),M(te,null,{button:k(()=>[e("div",Ys,b(t.modelValue),1)]),popup:k(({hide:p})=>[e("div",Xs,[(s(!0),r(O,null,q(m(d),i=>(s(),r("div",{class:"base-hover option",onClick:a=>{u(i),p()}},b(i),9,Zs))),256))])]),_:1}))}});const eo=j(Js,[["__scopeId","data-v-ce3e3774"]]),to={class:""},so={class:"d-flex ipt"},oo={class:"ms-2",min:"1"},ao=L({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(w,{emit:_}){const t=w,o=_,d=F(1),u=F(Ve.Year);function n(){t.option.stepSize==d.value&&t.option.stepUnit==u.value||o("change",{stepSize:d.value,stepUnit:u.value})}function g(){d.value=t.option.stepSize??1,u.value=t.option.stepUnit}return W(()=>t.option,g),ne(g),W(d,()=>{(d.value<1||d.value==null||isNaN(d.value))&&(d.value=1)}),(p,i)=>(s(),M(te,{onHide:n},{button:k(()=>i[2]||(i[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:k(({hide:a,focus:l})=>[e("div",to,[e("div",so,[e("div",null,[re(e("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=c=>d.value=c)},null,512),[[me,d.value]])]),e("div",oo,[x(eo,{modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=c=>u.value=c),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}});const lo=j(ao,[["__scopeId","data-v-78b647dc"]]),no={class:"d-flex flex-row group-form"},io={class:"pt-1 pb-1"},ro={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},uo={key:0,class:"bi bi-chevron-right smaller"},po=["onClick"],co=["onClick"],mo=["onClick"],vo=["onClick"],go=["onClick"],fo=["onClick"],_o=["onClick"],yo=["onClick"],ho=["onClick"],bo={key:5,class:"sm-btn"},ko={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},$o=L({__name:"GroupForm",props:{isLoading:Boolean,manager:Qe},setup(w){const _=X(),t=w;function o(a){t.manager.setGroupOption(a),t.manager.update(!0)}function d(a){t.manager.delGroupOption(a),t.manager.update(!0)}function u(a,l){t.manager.setGroupOption(a,{direction:l}),t.manager.sortGroups(!0)}function n(a,l){t.manager.setGroupOption(a,{type:l}),t.manager.sortGroups(!0)}function g(a,l){t.manager.setGroupOption(a,l),t.manager.update(!0)}const p=T(()=>t.manager.state.groupBy.map(a=>_.properties[a])),i=T(()=>{const a=[];return t.manager.state.groupBy.forEach(l=>{a.push({option:t.manager.state.options[l],property:_.properties[l]})}),a});return(a,l)=>(s(),r("div",no,[e("div",io,b(a.$t("main.menu.groupby"))+": ",1),p.value.length?(s(),r("div",ro,[(s(!0),r(O,null,q(i.value,(c,h)=>(s(),r(O,null,[h>0?(s(),r("i",uo)):y("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:$=>d(c.property.id),id:"remove-group-button"},b(c.property.name),9,po),c.option.type==m(oe).Size?(s(),M(E,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[c.option.direction==m(ee).Ascending?(s(),r("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:$=>n(c.property.id,m(oe).Property)},null,8,co)):(s(),r("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:$=>n(c.property.id,m(oe).Property)},null,8,mo))]),_:2},1024)):(s(),M(E,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[c.property.type==m(N).number?(s(),r(O,{key:0},[c.option.direction==m(ee).Ascending?(s(),r("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:$=>n(c.property.id,m(oe).Size)},null,8,vo)):(s(),r("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:$=>n(c.property.id,m(oe).Size)},null,8,go))],64)):(s(),r(O,{key:1},[c.option.direction==m(ee).Ascending?(s(),r("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:$=>n(c.property.id,m(oe).Size)},null,8,fo)):(s(),r("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:$=>n(c.property.id,m(oe).Size)},null,8,_o))],64))]),_:2},1024)),c.option.direction==m(ee).Ascending?(s(),M(E,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:$=>u(c.property.id,m(ee).Descending)},null,8,yo)]),_:2},1024)):(s(),M(E,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:$=>u(c.property.id,m(ee).Ascending)},null,8,ho)]),_:2},1024)),c.property.type==m(N).date?(s(),r("div",bo,[x(lo,{option:c.option,onChange:$=>g(c.property.id,$)},null,8,["option","onChange"])])):y("",!0)],64))),256)),t.isLoading?(s(),r("i",ko)):y("",!0)])):y("",!0),x(ze,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:l[0]||(l[0]=c=>o(c))},null,8,["group-ids"])]))}});const xo=j($o,[["__scopeId","data-v-dcec9b5d"]]),wo={class:"d-flex flex-row sort-form"},Co={class:"pt-1 pb-1"},So={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Mo={key:0,class:"bi bi-chevron-right smaller"},Vo=["onClick"],Io=["onClick"],Fo=["onClick"],To=L({__name:"SortForm",props:{manager:Ye},setup(w){const _=X(),t=w,o=T(()=>t.manager.state.sortBy.map(p=>({propertyId:p,direction:t.manager.state.options[p].direction}))),d=T(()=>o.value.map(p=>p.propertyId));function u(p){t.manager.setSort(p),t.manager.update(!0)}function n(p){t.manager.delSort(p),t.manager.update(!0)}function g(p,i){t.manager.setSort(p,{direction:i}),t.manager.update(!0)}return(p,i)=>(s(),r("div",wo,[e("div",Co,b(p.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),r("div",So,[(s(!0),r(O,null,q(o.value,(a,l)=>(s(),r(O,null,[l>0?(s(),r("i",Mo)):y("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:c=>n(a.propertyId)},b(m(_).properties[a.propertyId].name),9,Vo),a.direction==m(ee).Ascending?(s(),M(E,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:c=>g(a.propertyId,m(ee).Descending)},null,8,Io)]),_:2},1024)):(s(),M(E,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:c=>g(a.propertyId,m(ee).Ascending)},null,8,Fo)]),_:2},1024))],64))),256))])):y("",!0),x(ze,{"group-ids":d.value,onSelect:i[0]||(i[0]=a=>u(a))},null,8,["group-ids"])]))}});const zo=j(To,[["__scopeId","data-v-4e00ef99"]]),Eo={class:"custom-slider"},Oo=["value","min","max","step"],Po=L({__name:"RangeInput",props:{min:{default:0},max:{default:1},step:{default:.1},modelValue:{}},emits:["update:modelValue"],setup(w,{emit:_}){const t=w,o=_,d=F(t.modelValue),u=F(null),n=(a,l,c)=>(a-l)/(c-l),g=a=>{u.value.style.setProperty("--ProgressPercent",`${a}%`)};Xe(()=>{if(u.value){const a=n(d.value,u.value.min,u.value.max);g(a+0)}});function p(){o("update:modelValue",d.value)}let i=!1;return navigator.userAgent.indexOf("AppleWebKit")!=-1&&(i=!0),W(()=>t.modelValue,()=>d.value=t.modelValue),(a,l)=>(s(),r("div",Eo,[e("input",{ref_key:"slider",ref:u,value:d.value,onInput:l[0]||(l[0]=({target:c})=>d.value=parseFloat(c.value)),type:"range",min:a.min,max:a.max,step:a.step,class:"slider",style:Y(m(i)?"top:-5px":""),onChange:p},null,44,Oo)]))}});const Do=j(Po,[["__scopeId","data-v-5269b272"]]),Go={class:"p-2"},Lo={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Ro={class:"border mb-1 p-1"},Ao={class:"me"},jo={key:0},Uo={key:1},Ho={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},Bo={class:"d-flex center justify-content-center"},No={key:1,class:"bi bi-arrow-down text-secondary"},Wo={key:3,class:"bi bi-arrow-up text-secondary"},qo={class:"border mb-1 p-1"},Ko={class:"me"},Qo={key:0},Yo={key:1},Xo={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},le=5,Zo=L({__name:"HistoryDropdown",emits:[],setup(w,{emit:_}){const t=X(),o=F(!1),d=T(()=>o.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),u=T(()=>[...t.history.undo].reverse().slice(0,le)),n=T(()=>t.history.redo.slice(Math.max(t.history.redo.length-le,0)));return W(()=>t.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(g,p)=>u.value.length||n.value.length?(s(),M(te,{key:0},{button:k(()=>[x(E,{message:"dropdown.history.info"},{default:k(()=>[e("div",{class:"d-flex sb flash",style:Y([{"font-size":"14px"},d.value])},[p[2]||(p[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,b(g.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:k(()=>[e("div",Go,[m(t).history.redo.length>le?(s(),r("div",Lo," + "+b(m(t).history.redo.length-le),1)):y("",!0),(s(!0),r(O,null,q(n.value,i=>(s(),r("div",Ro,[e("span",Ao,b(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[3]||(p[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(s(),r("span",jo,b(i.tags)+" "+b(g.$t("dropdown.history.tags")),1)):y("",!0),i.values?(s(),r("span",Uo,b(i.values)+" "+b(g.$t("dropdown.history.values")),1)):y("",!0)]))),256)),e("div",Ho,[e("div",Bo,[u.value.length?(s(),M(E,{key:0,message:"dropdown.history.undo"},{default:k(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:p[0]||(p[0]=(...i)=>m(t).undo&&m(t).undo(...i))})]),_:1})):(s(),r("div",No)),p[4]||(p[4]=e("div",{style:{width:"30px"}},null,-1)),n.value.length?(s(),M(E,{key:2,message:"dropdown.history.redo"},{default:k(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:p[1]||(p[1]=(...i)=>m(t).redo&&m(t).redo(...i))})]),_:1})):(s(),r("div",Wo))])]),(s(!0),r(O,null,q(u.value,i=>(s(),r("div",qo,[e("span",Ko,b(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[5]||(p[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(s(),r("span",Qo,b(i.tags)+" "+b(g.$t("dropdown.history.tags")),1)):y("",!0),i.values?(s(),r("span",Yo,b(i.values)+" "+b(g.$t("dropdown.history.values")),1)):y("",!0)]))),256)),m(t).history.undo.length>le?(s(),r("div",Xo," + "+b(m(t).history.undo.length-le),1)):y("",!0)])]),_:1})):y("",!0)}});const Jo=j(Zo,[["__scopeId","data-v-85cd80d0"]]),ea=L({__name:"ToggleReload",emits:[],setup(w,{emit:_}){const t=ae(),o=T(()=>t.getTab().autoReload?2:t.getTabManager().collection.state.isDirty?0:1);function d(){o.value==0?t.getTabManager().collection.update():o.value==1?(t.getTab().autoReload=!0,t.updateTabs()):(t.getTab().autoReload=!1,t.updateTabs())}return(u,n)=>(s(),r("div",{class:"bb font",onClick:d,style:{width:"26px",height:"30px",overflow:"hidde"}},[o.value==0?(s(),M(E,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:k(()=>n[0]||(n[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):y("",!0),o.value==1?(s(),M(E,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:k(()=>n[1]||(n[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):y("",!0),o.value==2?(s(),M(E,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:k(()=>n[2]||(n[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):y("",!0)]))}});const ta=j(ea,[["__scopeId","data-v-61c9799b"]]),sa={class:"d-flex flex-row p-2"},oa=["placeholder"],aa={class:"me-5 d-flex"},la={class:"ms-5",style:{"font-size":"13px"}},na=["checked"],ia={class:"ms-1"},ra={class:"ms-4"},da={class:"d-flex flex-wrap content-container ps-2"},ua=L({__name:"ContentFilter",props:{tab:Ze,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(w,{emit:_}){const t=w,o=F(""),d=T(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),u=T(()=>d.value.length);function n(a){const l=a.target.checked;t.tab.collection.groupManager.setSha1Mode(l,!0)}function g(){o.value=t.tab.state.filterState.query}function p(){t.tab.collection.filterManager.setQuery(o.value),t.tab.collection.filterManager.update(!0)}function i(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return ne(g),W(()=>t.tab.collection.filterManager.state.query,g),(a,l)=>(s(),r(O,null,[e("div",sa,[x(E,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[e("div",{class:B(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[l[6]||(l[6]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),re(e("input",{type:"text",class:"input-hidden",placeholder:a.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=c=>o.value=c),onChange:p},null,40,oa),[[me,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:i},"x")],2)]),_:1}),e("div",aa,[x(E,{message:"main.menu.grid_tooltip"},{default:k(()=>[e("i",{class:B("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=c=>t.tab.state.display="tree")},null,2)]),_:1}),x(E,{message:"main.menu.table_tooltip"},{default:k(()=>[e("i",{id:"toot",class:B("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=c=>t.tab.state.display="grid")},null,2)]),_:1}),x(E,{message:"main.menu.graph_tooltip"},{default:k(()=>[e("i",{id:"toot",class:B("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:l[3]||(l[3]=c=>t.tab.state.display="graph")},null,2)]),_:1})]),x(E,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>l[7]||(l[7]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[x(Do,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":l[4]||(l[4]=c=>t.tab.state.imageSize=c)},null,8,["modelValue"])]),e("div",la,[x(E,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:n},null,40,na),e("span",ia,b(a.$t("main.menu.image_mode")),1)]),_:1})]),e("div",ra,[x(Jo)]),u.value?(s(),M(Je,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":d.value,"onRemove:selected":l[5]||(l[5]=c=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):y("",!0),l[9]||(l[9]=e("div",{class:"flex-grow-1"},null,-1)),x(E,{message:"main.menu.issue",class:"bb"},{default:k(()=>l[8]||(l[8]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",da,[x(ta,{class:"me-1"}),x(qs,{manager:t.tab.collection.filterManager},null,8,["manager"]),x(xo,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),x(zo,{manager:t.tab.collection.sortManager},null,8,["manager"])])],64))}});const pa=j(ua,[["__scopeId","data-v-3f54024a"]]),ca={class:""},ma={class:"d-flex flex-row"},va=L({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(w,{emit:_}){const t=ce(),o=w,d=_,u=T(()=>`width: ${o.size}px; height: ${o.size}px;`);T(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const n=T(()=>o.pile.images[0]);return(g,p)=>(s(),r("div",ca,[x(tt,{image:n.value},{default:k(()=>[e("div",{style:Y(u.value),class:"img-container",onClick:p[0]||(p[0]=i=>m(t).showModal(m(se).IMAGE,{image:n.value}))},[x(et,{image:n.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",ma,[x(E,{message:"main.recommand.accept"},{default:k(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=i=>d("accept",n.value))}," ✓ ",4)]),_:1}),x(E,{message:"main.recommand.refuse"},{default:k(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=i=>d("refuse",n.value))}," ✕ ",4)]),_:1})])]))}});const ga=j(va,[["__scopeId","data-v-2ff8fded"]]),fa={class:"reco-container"},_a={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},ya={key:0,class:"bi bi-funnel-fill bb text-primary"},ha={key:1,class:"bi bi-funnel bb"},ba={class:"text-secondary me-2"},ka={style:{"padding-top":"2px"},class:"me-1"},$a={class:"flex-grow-1"},xa={class:"d-flex flex-row"},wa={key:0,class:"separator"},Ca={class:"d-flex flex-row"},ge=10,Sa=L({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(w,{emit:_}){const t=ae(),o=X(),d=st(),u=w,n=_,g=F(1),p=ie([]),i=F(null),a=ie([]),l=ie(new Set),c=F(!0);function h(S){const C=i.value;C.isSha1Group?C.images=C.images.filter(P=>P.sha1!=S.sha1):C.images=C.images.filter(P=>P.id!=S.id),i.value=C,V()}async function $(S){const C=[],P=[];a.forEach(U=>{if(U.value!=null){const R=o.properties[U.propertyId];let H=U.value;R.type==N.multi_tags?(H=S.properties[U.propertyId]??[],H=[...H,U.value]):R.type==N.tag&&(H=[H]),R.mode==fe.id?P.push({instanceId:S.id,propertyId:R.id,value:H}):C.push({propertyId:R.id,sha1:S.sha1,value:H})}}),await o.setPropertyValues(P,C),h(S)}function G(S){i.value.isSha1Group?i.value.images.filter(C=>C.sha1==S.sha1).forEach(C=>l.add(C.id)):l.add(S.id),h(S)}function V(){p.length=0;let S=[];const C=i.value.images;if(i.value.isSha1Group){const P={},U=Array.from(new Set(C.map(R=>R.sha1)));U.forEach(R=>P[R]=[]),C.forEach(R=>P[R.sha1].push(R)),U.forEach(R=>S.push({sha1:R,images:o.sha1Index[R]}))}else C.forEach(P=>S.push({sha1:P.sha1,images:[P]}));v(S,p,g.value,u.imageSize,u.width)}function v(S,C,P,U,R){let H=R,Q=[],D=0;for(let z=0;z<S.length&&!(C.length>=P);z++){let K=S[z];if(K.images=K.images.filter(Ee=>!l.has(Ee.id)),K.images.length==0)continue;let de=U+ge;if(D+de<H){Q.push(K),D+=de;continue}if(Q.length==0)throw new Error("Images seems to be to big for the line");C.push(Q),C.length<P&&(Q=[K],D=de)}Q.length>0&&C.length<P&&C.push(Q)}async function f(){if(!u.group||!d.hasSimilaryFunction)return;const S=d.defaultActions.similar,C=d.getContext(S);C.instanceIds=u.group.images.map(Q=>Q.id);const P=await d.getSimilarImages(C);if(!P)return;if(!P.groups)throw new Error("No instances in ActionResult");let R=ot(P.groups)[0];if(c.value){const Q=new Set(t.getTabManager().collection.filterManager.result.images.map(D=>D.id));R.images=R.images.filter(D=>Q.has(D.id))}R.scores&&at(R),i.value=R,a.length=0;let H=u.group;for(;H;)a.push(...H.meta.propertyValues),H=H.parent;l.clear(),V(),n("update")}function I(){c.value=!c.value}return ne(f),W(()=>u.group,()=>{f(),l.clear()}),W(()=>u.imageSize,V),W(()=>u.width,V),W(c,f),(S,C)=>(s(),r("div",fa,[e("div",_a,[e("div",{class:"text-secondary pe-1",onClick:C[0]||(C[0]=P=>n("close"))},C[2]||(C[2]=[e("span",{class:"bi bi-x-lg bb",style:{}},null,-1)])),C[4]||(C[4]=e("div",{class:"b-left pe-1"},null,-1)),e("div",{class:"text-secondary pe-1",onClick:C[1]||(C[1]=P=>n("scroll",u.group.id))},C[3]||(C[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)])),C[5]||(C[5]=e("div",{class:"b-left pe-1"},null,-1)),e("div",{class:"text-secondary pe-1",onClick:I},[c.value?(s(),r("span",ya)):(s(),r("span",ha))]),C[6]||(C[6]=e("div",{class:"b-left pe-1"},null,-1)),x(E,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[e("span",ba,b(S.$t("main.recommand.title")),1)]),_:1}),e("div",ka,[x(lt,{action:"similar",onChanged:f})]),e("div",$a,[e("div",xa,[(s(!0),r(O,null,q(a,(P,U)=>(s(),r(O,null,[x(nt,{class:"",value:P},null,8,["value"]),U<a.length-1?(s(),r("div",wa)):y("",!0)],64))),256))])])]),e("div",{style:Y("margin-left:"+ge+"px;")},[(s(!0),r(O,null,q(p,P=>(s(),r("div",null,[e("div",Ca,[(s(!0),r(O,null,q(P,U=>(s(),M(ga,{pile:U,size:u.imageSize,onAccept:$,onRefuse:G,style:Y("margin-right:"+ge+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Ma=j(Sa,[["__scopeId","data-v-dcbdfe63"]]);const Va={style:{display:"flex"}},Ia={class:"info"},Fa={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:N},height:String},setup(w){const _=w,t=F(0),o=F(!1),d={};Object.keys(_.chartData.series).forEach(l=>{d[l]=!1});const u=F({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:_.chartData.dataType===N.date?"datetime":"numeric",categories:_.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:l,seriesIndex:c,dataPointIndex:h,w:$}){const G=_.chartData.series[c].data[h];let V='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';G.images.forEach((f,I)=>{I<10&&(V+=`<div style="width: 75px; height: 75px;"><img src="${f}" style="width: 100%; height: 100%;" /></div>`)}),V+="</div>";let v=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${_.chartData.series[c].name} — </b> ${G.y} Images</span>`;return v+=`<div>${V}</div>`,v}}}),n=()=>{u.value.chart.stacked=!u.value.chart.stacked,o.value=!o.value,t.value+=1},g=()=>{let l;u.value.chart.type==="area"?l={chart:{...u.value.chart,type:"bar"}}:l={chart:{...u.value.chart,type:"area"}},u.value={...u.value,...l},t.value+=1},p=(l,c,h)=>{const G=_.chartData.series[c];let V=Math.max(...G.data.map(v=>v.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(v=>v.remove()),d[c]){d[c]=!1;return}G.data.forEach((v,f)=>{const S=Math.floor(v.y/V*17),C=v.images.slice(0,S),P=`circle[index="${c}"][j="${f}"]`,U=document.querySelector(P),R=parseFloat(U.getAttribute("cx"));C.forEach((H,Q)=>{const D=document.createElement("img");D.src=H,D.width=40,D.height=40,D.style.position="absolute";let z=R+40/1.5,K=65+Q*40;D.style.left=`${z}px`,D.style.bottom=`${K}px`,D.classList.add("apexcharts-custom-image"),D.addEventListener("mouseover",de=>i(z,K,H)),D.addEventListener("mouseout",a),l.el.appendChild(D)})}),Object.keys(d).forEach(v=>d[v]=!1),d[c]=!0};function i(l,c,h){const $=document.getElementById("zoomed-image");$.style.left=`${l+120*1.5}px`,$.src=h,$.style.bottom=`${c}px`,$.style.display="block"}function a(){const l=document.getElementById("zoomed-image");l.style.display="none"}return console.log("test"),(l,c)=>{const h=Se("apexchart");return s(),r(O,null,[e("div",Va,[e("button",{class:"mt-2",onClick:g},b(u.value.chart.type==="area"?l.$t("main.graph-view.histo"):l.$t("main.graph-view.curve")),1),_.chartData.series.length>1?(s(),r("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:n},b(o.value?l.$t("main.graph-view.over"):l.$t("main.graph-view.stack")),1)):y("",!0)]),(s(),M(h,{style:{position:"relative"},key:t.value,height:_.height,type:u.value.chart.type,options:u.value,series:_.chartData.series,onLegendClick:p},null,8,["height","type","options","series"])),e("i",Ia,b(l.$t("main.graph-view.info")),1),c[0]||(c[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Ta={key:1},za=L({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(w,{emit:_}){const t=X(),o=w,d=F(""),u=F(g());function n(){const p=new Set;let i=o.collection.groupManager.getGroupIterator();for(;i;){const a=i.group;if(a.id===0||a.meta.propertyValues&&a.meta.propertyValues[0].value==null){i=i.nextGroup();continue}for(let l of a.children)p.add(l.meta.propertyValues[0].value);a.children.forEach(()=>i=i.nextGroup()),i=i.nextGroup()}return p}function g(){const p={};let i,a=o.collection.groupManager.state.groupBy;if(a.length===0){d.value="Choose at least one date or numeric value to group the images by";return}const l=t.properties[a[0]],c=l.type;if(a.length>2){d.value="Only max two levels of grouping are supported";return}else if(a.length===1)p[l.name]={name:l.name,data:[]};else if(i=Array.from(n()),i.length>20){d.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(c!==N.number&&c!==N.date){d.value="First level of grouping needs to be a date or a numeric property";return}let h=o.collection.groupManager.getGroupIterator();const $=[];for(;h;){const G=h.group;if(G.id===0||G.meta.propertyValues&&G.meta.propertyValues[0].value==null){h=h.nextGroup();continue}let V=G.meta.propertyValues[0];const v=c===N.date?new Date(V.value).getTime():V.value;if($.push(v),l.name in p)p[l.name].data.push({x:v,y:G.images.length,images:G.images.slice(0,20).map(f=>f.urlSmall)});else{const f=G.children.map(S=>S.meta.propertyValues[0].value),I=i.filter(S=>!f.includes(S));for(let S of G.children){const C=S.meta.propertyValues[0].value;if(p[C]===void 0){let P=C;C in t.tags&&(P=t.tags[C].value),p[C]={data:[],name:P}}p[S.meta.propertyValues[0].value].data.push({x:v,y:S.images.length,images:S.images.slice(0,20).map(P=>P.urlSmall)})}for(let S of I){if(p[S]===void 0){let C=S;S in t.tags&&(C=t.tags[S].value),p[S]={data:[],name:C}}p[S].data.push({x:v,y:0,images:[]})}G.children.forEach(()=>h=h.nextGroup())}h=h.nextGroup()}return d.value="",{series:Object.values(p),xValues:$,dataType:c}}return o.collection.groupManager.onChange.addListener(()=>u.value=g()),(p,i)=>(s(),r("div",{class:"",style:Y({height:o.height+"px"})},[d.value===""?(s(),M(Fa,{key:0,chartData:u.value,height:o.height-50+"px"},null,8,["chartData","height"])):(s(),r("span",Ta,b(d.value),1))],4))}}),Ea={key:0,class:"m-0 p-0"},Oa={key:0,style:{"margin-left":"10px"}},Pa=L({__name:"MainView",props:{tabId:{},height:{},filterOpen:{type:Boolean}},setup(w,{expose:_}){const t=ae(),o=t.getTabManager(),d=w;_({updateScrollerWidth:v});const u=F({}),n=F(!0),g=F(null),p=F(null),i=F(null),a=F(0),l=F(0),c=ie({groups:!1}),h=T(()=>o.getVisibleProperties());function $(){g.value&&p.value?a.value=d.height-g.value.clientHeight-p.value.clientHeight-5:g.value?a.value=d.height-g.value.clientHeight-5:a.value=0}o.collection.groupManager.onChange.addListener(()=>{i.value&&o.state.display=="tree"&&i.value.computeLines()});function G(f){u.value=o.collection.groupManager.result.index[f],Z(()=>$())}function V(){u.value={},Z(()=>$())}async function v(){var f;await Z(),l.value=((f=g.value)==null?void 0:f.clientWidth)??l.value}return ne(()=>{l.value=g.value.clientWidth,window.addEventListener("resize",v)}),Ie(()=>{window.removeEventListener("resize",v)}),W(()=>o.state.imageSize,()=>Z($)),W(()=>d.filterOpen,()=>Z($)),W(()=>d.height,async()=>{await Z($)}),W(o.state,f=>{t.updateTabs()},{deep:!0}),W(()=>d.tabId,async()=>{n.value=!1,await Z(),n.value=!0}),(f,I)=>(s(),r(O,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:g},[d.filterOpen?(s(),M(pa,{key:0,tab:m(o),"compute-status":c},null,8,["tab","compute-status"])):y("",!0)],512),e("div",{ref_key:"boxElem",ref:p,class:"m-0 p-0"},[u.value.id?(s(),r("div",Ea,[x(Ma,{group:u.value,"image-size":m(o).state.imageSize,width:l.value,height:50,onClose:V,onScroll:i.value.scrollTo,onUpdate:I[0]||(I[0]=S=>Z(()=>$()))},null,8,["group","image-size","width","onScroll"])])):y("",!0)],512),l.value>0&&a.value>0&&n.value?(s(),r("div",Oa,[m(o).state.display=="tree"?(s(),M(it,{key:0,"group-manager":m(o).collection.groupManager,"image-size":m(o).state.imageSize,height:a.value-0,properties:h.value,"hide-if-modal":!0,"selected-images":m(o).collection.groupManager.selectedImages,ref_key:"imageList",ref:i,width:l.value-25,onRecommend:G},null,8,["group-manager","image-size","height","properties","selected-images","width"])):y("",!0),m(o).state.display=="grid"?(s(),r("div",{key:1,style:Y({width:l.value-12+"px"}),class:"p-0 m-0 grid-container"},[x(rt,{manager:m(o).collection.groupManager,height:a.value-15,width:l.value-40,"selected-properties":h.value,class:"p-0 m-0","show-images":!0,"selected-images":m(o).collection.groupManager.selectedImages,ref_key:"imageList",ref:i,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):y("",!0),m(o).state.display=="graph"?(s(),M(za,{key:2,collection:m(o).collection,height:a.value-15},null,8,["collection","height"])):y("",!0)])):y("",!0)],64))}});const Da=j(Pa,[["__scopeId","data-v-2bf1a91a"]]),Ga={class:"d-flex d-row",style:{cursor:"pointer"}},La={class:"pt-1"},Ra={key:0,class:"bb bi bi-chevron-down"},Aa={key:1,class:"bb bi bi-chevron-right"},ja=["onMouseenter","onMouseleave"],Ua=["onClick"],Ha=["onClick"],Ba=["onClick"],Na=["onUpdate:modelValue"],Wa={class:"lang"},qa=["value"],Ka=L({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(w,{emit:_}){const t=ae(),o=F(-1),d=F(""),u=F(null),n=w,g=_;function p(V){t.data.selectedTabId==V||a(),t.selectTab(V)}function i(V){o.value=V,d.value=t.data.tabs[V].name,Z(()=>u.value[0].focus())}function a(){o.value=-1,d.value=""}function l(V){t.addTab("New Tab")}async function c(V){confirm("Are you sure to delete Tab: "+V.name)&&await t.removeTab(V.id)}const h=ie({});F(-1);const $=["fr","en"];function G(){g("update:filterOpen",!n.filterOpen)}return(V,v)=>(s(),r("nav",null,[e("div",Ga,[e("div",La,[e("span",{onClick:G},[n.filterOpen?(s(),r("i",Ra)):(s(),r("i",Aa))])]),(s(!0),r(O,null,q(m(t).data.tabs,f=>(s(),r("div",{class:"d-flex d-row me-2",onMouseenter:I=>h[f.id]=!0,onMouseleave:I=>h[f.id]=!1},[o.value!=f.id?(s(),r(O,{key:0},[x(E,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[e("i",{onClick:I=>i(f.id),class:B(["bi bi-pencil me-1 tab-icon hover-light",h[f.id]&&m(t).data.selectedTabId==f.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,Ua)]),_:2},1024),e("div",{class:B(["tab-button",f.id==m(t).data.selectedTabId?" active":""]),onClick:I=>p(f.id)},[e("span",null,b(f.name),1)],10,Ha),x(E,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[e("i",{onClick:I=>c(f),class:B(["btn-icon bi bi-x tab-icon hover-light",h[f.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Ba)]),_:2},1024)],64)):(s(),r("div",{key:1,class:B(["tab-button",f.id==m(t).data.selectedTabId?" active":""])},[e("form",{onSubmit:Ce(a,["stop","prevent"])},[re(e("input",{onFocusout:a,onKeydown:ut(a,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":I=>f.name=I,ref_for:!0,ref_key:"inputElem",ref:u},null,40,Na),[[me,f.name]])],32)],2))],40,ja))),256)),x(E,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:l,id:"add-tab-button"},v[2]||(v[2]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),e("div",Wa,[v[3]||(v[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),re(e("select",{"onUpdate:modelValue":v[0]||(v[0]=f=>V.$i18n.locale=f),onChange:v[1]||(v[1]=f=>n.reRender())},[(s(),r(O,null,q($,(f,I)=>e("option",{key:`Lang${I}`,value:f},b(f.toUpperCase()),9,qa)),64))],544),[[dt,V.$i18n.locale]])])])]))}});const Qa={key:0},Ya={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Xa={class:"w-100"},Za={key:0,class:"custom-hr"},Ja={key:1,class:"loading"},el={class:"text-center"},tl={key:2,class:"loading"},sl=L({__name:"PanopticView",setup(w){const _=ae(),t=X(),o=ce(),d=F(null),u=F(null),n=F(window.innerHeight),g=F(!1),p=F(!0),i=F(!0),a=T(()=>{var f;return n.value-(((f=u.value)==null?void 0:f.clientHeight)??0)}),l=T(()=>{var f;return(f=d.value)==null?void 0:f.filteredImages.map(I=>I.id)});let c=navigator.userAgent.indexOf("Mac OS X")!==-1;async function h(){p.value=!1,await Z(),p.value=!0}ne(async()=>{o.isProjectLoaded||$e.push("/"),Z(()=>{window.addEventListener("resize",$),$()}),window.addEventListener("keydown",f=>{f.key=="Control"&&(A.ctrl=!0),f.key=="Alt"&&(c&&(A.ctrl=!0),A.alt=!0),f.key=="Shift"&&(A.shift=!0),f.key=="ArrowLeft"&&(A.left=!0),f.key=="ArrowRight"&&(A.right=!0,console.log("keeeyy")),f.key=="Z"&&A.ctrl&&t.redo(),f.key=="z"&&A.ctrl&&t.undo()}),window.addEventListener("keyup",f=>{f.key=="Control"&&(A.ctrl=!1),f.key=="Alt"&&(c&&(A.ctrl=!1),A.alt=!1),f.key=="Shift"&&(A.shift=!1),f.key=="ArrowLeft"&&(A.left=!1),f.key=="ArrowRight"&&(A.right=!1)}),window.addEventListener("mousemove",f=>{A.ctrl=f.ctrlKey,A.alt=f.altKey,A.shift=f.shiftKey,c&&(A.ctrl=A.ctrl||A.alt)})}),Ie(()=>{window.removeEventListener("resize",$)});function $(){n.value=window.innerHeight,g.value=!0}function G(){o.showModal(se.EXPORT,l)}function V(){$e.push("/")}function v(){d.value&&d.value.updateScrollerWidth()}return(f,I)=>p.value?(s(),r("div",Qa,[d.value&&!d.value.imageList?(s(),M(pt,{key:0,tutorial:"project"})):y("",!0),(s(),r("div",{id:"panoptic",key:m(_).status.renderNb},[e("div",Ya,[m(_).status.loaded?(s(),r(O,{key:0},[e("div",null,[x(us,{onExport:I[0]||(I[0]=S=>G()),onToggle:v})]),e("div",Xa,[e("div",{class:"ms-1",ref_key:"navElem",ref:u},[x(Ka,{"re-render":h,filterOpen:i.value,"onUpdate:filterOpen":I[1]||(I[1]=S=>i.value=S)},null,8,["filterOpen"])],512),g.value?(s(),r("div",Za)):y("",!0),x(Da,{"tab-id":m(_).data.selectedTabId,height:a.value,ref_key:"mainViewRef",ref:d,"filter-open":i.value},null,8,["tab-id","height","filter-open"])])],64)):m(o).isProjectLoaded?(s(),r("div",tl,I[2]||(I[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(s(),r("div",Ja,[e("div",el,[e("div",null,b(f.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:V,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))])):y("",!0)}});const ll=j(sl,[["__scopeId","data-v-082194ff"]]);export{ll as default};
