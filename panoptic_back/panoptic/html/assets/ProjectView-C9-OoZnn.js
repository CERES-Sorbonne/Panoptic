import{d as G,A as N,k as I,D as se,l as _,b as e,i as te,t as x,S as Ne,o as s,V as Ie,r as M,c as z,a as n,f as Y,n as B,F as O,s as K,h as f,W as ce,q as v,e as u,X as Ee,Y as ke,Z as Te,_ as R,$ as me,m as J,a0 as Q,a1 as Pe,j as Z,a2 as Oe,u as ue,a3 as de,a4 as ge,w as ye,v as be,a5 as Ge,M as ee,x as T,a6 as Se,O as H,a7 as Ve,a8 as We,a9 as le,aa as Le,H as qe,g as Ce,ab as ze,ac as Qe,ad as Ke,K as Ye,ae as Xe,af as Ze,L as Je,R as et,Q as tt,ag as st,ah as ot,ai as De,aj as Ae,ak as at,al as ne,am as oe,an as nt,ao as lt,ap as it,aq as rt,ar as dt,as as ut,at as pt,au as ve,av as Me,aw as ct,ax as mt,ay as gt,az as vt,aA as ft,aB as yt,aC as bt,p as Fe,B as U}from"./index-D8cBf-3b.js";import{_ as ht}from"./Tutorial.vue_vue_type_style_index_0_lang-BIxgQfT7.js";const _t={class:"text-nowrap"},kt=["onClick"],$t=["onClick"],xt=G({__name:"FolderOptionDropdown",props:{folder:{}},setup(k){const r=N(),t=k;function o(){r.reImportFolder(t.folder.id)}function a(){confirm(Ne.global.t("main.nav.folders.del_alert"))&&r.deleteFolder(t.folder.id)}return(g,c)=>(s(),I(se,{teleport:!0},{button:_(()=>c[0]||(c[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:_(({hide:y})=>[e("div",_t,[e("div",{class:"p-2 bb",onClick:p=>{o(),y()}},c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),te("Re import")]),8,kt),c[3]||(c[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:p=>{a(),y()}},[c[2]||(c[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),te(x(g.$t("main.nav.folders.del")),1)],8,$t)])]),_:1}))}}),wt=["onMouseenter"],St=["onClick"],Ct={class:"text-secondary"},It=["onClick"],Vt=G({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0},tab:Object},setup(k){const r=N(),t=k,o=M(null),a=z(()=>{let i={};const l=new Set(t.filterManager.state.folders);return t.folders.map(m=>m.id).forEach(m=>{l.has(m)&&(i[m]=!0)}),i}),g=z(()=>{let i={};return t.folders.map(l=>l.id).forEach(l=>{t.visibleFolders[l]&&(i[l]=!0)}),i}),c=z(()=>{let i={};return t.folders.forEach(l=>{let m=[];a.value[l.id]&&m.push("selected"),i[l.id]=m.join(" ")}),i});function y(i){let l=t.visibleFolders;l[i]?delete l[i]:l[i]=!0}function p(i){let l=new Set(t.filterManager.state.folders);const m=l.has(i),b=r.folders[i].parent!=null&&l.has(r.folders[i].parent);m&&!b?(l.delete(i),ke(i).forEach(C=>l.delete(C.id))):(d(i,l),l.add(i),ke(i).forEach(C=>l.add(C.id)),Te(r.folders[i]).forEach(C=>l.delete(C.id))),t.filterManager.setFolders(Array.from(l)),t.tab.setSelectedFolder(l),t.filterManager.update(!0)}function d(i,l){const m=Te(r.folders[i]);let b;for(let C of m)if(l.has(C.id))b=C;else break;b!=null&&ke(b.id).forEach(C=>l.delete(C.id))}return(i,l)=>{const m=Ee("FolderList2",!0);return s(),n("ul",{class:B(t.root?"tree":""),style:Y(t.root?"padding-left:0px;":"")},[(s(!0),n(O,null,K(k.folders,b=>(s(),n("li",{style:Y(t.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:C=>o.value=b.id,onMouseleave:l[1]||(l[1]=C=>o.value=null)},[e("summary",{class:B(c.value[b.id]),onClick:C=>p(b.id)},[e("span",{class:B(o.value===b.id?"visible-option":"invisible-option"),onClick:l[0]||(l[0]=ce(()=>{},["stop"]))},[v(xt,{folder:b},null,8,["folder"])],2),te(" "+x(b.name)+" ",1),e("span",Ct,x(u(r).folders[b.id].count),1)],10,St)],40,wt),b.children&&b.children.length>0?(s(),n("i",{key:0,onClick:C=>y(b.id),class:B("bi bi-chevron-"+(g.value[b.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,It)):f("",!0),b.children&&b.children.length>0&&g.value[b.id]?(s(),I(m,{key:1,folders:b.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager,tab:t.tab},null,8,["folders","visible-folders","filter-manager","tab"])):f("",!0)],4))),256))],6)}}}),Mt=R(Vt,[["__scopeId","data-v-08c57041"]]),Tt={class:"text-center"},zt={class:"w-100 text-center",style:{"font-size":"10px"}},Ft={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Et=G({__name:"TaskStatus",props:{task:{}},setup(k){const r=k,t=z(()=>r.task.total-r.task.remain-r.task.computing),o=z(()=>r.task.total);return(a,g)=>(s(),n("div",Tt,[te(x(r.task.name)+" ",1),e("div",zt,x(t.value)+" / "+x(o.value)+" "+x(a.$t("main.nav.tasks.done")),1),o.value>0?(s(),n("div",Ft,[e("div",{class:"progress-bar",style:Y(`width: ${t.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),Re=G({__name:"TabContainer",props:{id:{}},setup(k){const r=me(),t=k;let o;const a=M(!1);function g(){o=r.getTab(t.id),a.value=!0}return J(g),Q(()=>t.id,async()=>{a.value=!1,await Z(),g()}),(c,y)=>a.value&&u(r).loaded?Pe(c.$slots,"default",{key:0,tab:u(o)}):f("",!0)}}),fe={},Pt={class:"d-flex flex-row"},Ot={key:2,class:"d-flex",style:{width:"150px"}},Gt={class:"flex-grow-1"},Lt={key:1,style:{"padding-top":"1px"}},Dt={style:{width:"20px","margin-top":"2px"},class:"text-center"},At={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},Rt={key:0},Ut={key:0,class:"ms-3 pt-1"},jt={key:1},Bt=G({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(k){const{t:r}=Oe({useScope:"global"}),t=ue();de();const o=N(),a=k,g=M(!1),c=M(!1),y=M(""),p=M(!1),d=z(()=>a.tab.state.visibleProperties[a.property.id]==!0),i=z(()=>a.tab.collection.filterManager.state.filter.filters.some(S=>!S.isGroup&&S.propertyId==a.property.id)),l=z(()=>a.tab.collection.groupManager.state.groupBy.includes(a.property.id)),m=z(()=>a.tab.collection.sortManager.state.sortBy.includes(a.property.id)),b=z(()=>{if(i.value)return a.tab.collection.filterManager.state.filter.filters.find(S=>!S.isGroup&&S.propertyId==a.property.id).id}),C=()=>a.tab.collection.filterManager,E=z(()=>a.tab.getSha1Mode());function h(){d.value?a.tab.setVisibleProperty(a.property.id,!1):a.tab.setVisibleProperty(a.property.id,!0)}function w(){a.open&&(g.value?g.value=!1:(g.value=!0,y.value=a.property.name),c.value=!1)}function V(){a.property.type!=H.tag&&a.property.type!=H.multi_tags||(c.value?c.value=!1:c.value=!0,g.value=!1)}function F(){m.value?a.tab.collection.sortManager.delSort(a.property.id):a.tab.collection.sortManager.setSort(a.property.id),a.tab.collection.sortManager.update(!0)}function L(){l.value?a.tab.collection.groupManager.delGroupOption(a.property.id):a.tab.collection.groupManager.setGroupOption(a.property.id),a.tab.collection.groupManager.update(!0)}function j(){confirm(r("common.properties.delete")+": "+a.property.name+" ?   "+a.property.id)&&o.deleteProperty(a.property.id)}async function X(){y.value!=""&&(await o.updateProperty(a.property.id,y.value),w())}function D(){const S=C();i.value?(S.deleteFilter(b.value),fe.filter.hide()):(S.addNewFilter(a.property.id),fe.filter.show())}return Q(()=>a.property,()=>{g.value=!1}),(S,$)=>(s(),n("div",{class:B(p.value?"hover-light":"")},[e("div",Pt,[a.open?(s(),n(O,{key:0},[g.value?f("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:w},[v(ge,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=A=>p.value=!0),onMouseleave:$[1]||($[1]=A=>p.value=!1)},null,8,["type"]),e("span",null,x(a.property.name),1)]))],64)):(s(),I(ge,{key:1,type:a.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),g.value&&a.open?(s(),n("div",Ot,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:w,onMouseenter:$[2]||($[2]=A=>p.value=!0),onMouseleave:$[3]||($[3]=A=>p.value=!1)},null,32)]),e("div",Gt,[a.property.id>=0?ye((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=A=>y.value=A),onChange:X},null,544)),[[be,y.value]]):(s(),n("span",Lt,[v(ge,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(a.property.name),1)]))])])):f("",!0),a.open?(s(),n(O,{key:3},[u(Ge)(a.property.type)?(s(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=A=>u(t).showModal(u(ee).TAG,{propId:a.property.id}))},[v(T,{click:!1,message:"main.nav.properties.open_tags"},{default:_(()=>$[7]||($[7]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",Dt,[a.property.mode==u(Se).id?(s(),I(T,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:_(()=>$[8]||($[8]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:h,class:"btn-icon text-center"},[E.value&&a.property.mode==u(Se).id?(s(),I(T,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:_(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=ce(()=>{},["stop"]))})]),_:1})):(s(),I(T,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:_(()=>[e("span",{class:B("bi bi-eye text-"+(d.value?"primary":"secondary"))},null,2)]),_:1}))]),a.open?(s(),n("div",At,[a.property.type==u(H).tag||a.property.type==u(H).multi_tags?(s(),n("div",{key:0,onClick:V,style:{cursor:"pointer"}},[c.value?(s(),I(T,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:_(()=>$[9]||($[9]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(s(),I(T,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:_(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),a.open?(s(),n("div",Rt,[g.value?(s(),n("div",Ut,[S.property.id!=u(Ve).folders?(s(),n("div",{key:0,class:B(["options hover-light",i.value?" text-primary":""]),onClick:D},[e("div",null,[$[11]||($[11]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),te(x(S.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:B(["options hover-light",m.value?" text-primary":""]),onClick:F},[$[12]||($[12]=e("i",{class:"bi bi-filter me-2"},null,-1)),te(x(S.$t("main.menu.sort.title")),1)],2),e("div",{class:B(["options hover-light",l.value?" text-primary":""]),onClick:L},[$[13]||($[13]=e("i",{class:"bi bi-collection me-2"},null,-1)),te(x(S.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),n("div",{key:1,class:"options hover-light",onClick:j},[$[14]||($[14]=e("i",{class:"bi bi-trash me-2"},null,-1)),te(x(S.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):c.value?(s(),n("div",jt,[v(We,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}}),Ht=R(Bt,[["__scopeId","data-v-22b53ad7"]]),Nt={key:0,class:"prop-container"},Wt={key:0},qt={key:1},Qt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Kt={key:1,class:"ms-2"},Yt={class:"p-1"},Xt=["onClick"],Zt=["onClick"],Jt={key:0,class:"ps-1 pe-1"},es={class:"property-item"},ts=G({__name:"PropertyGroup",props:{tab:{},node:{},menuOpen:{type:Boolean}},setup(k){const r=N(),t=ue(),o=k,a=M(!0),g=M(!1),c=M(""),y=z(()=>o.node.propertyIds.map(h=>r.properties[h])),p=z(()=>{if(o.node.groupId>=0)return r.propertyGroups[o.node.groupId];if(o.node.groupId==le.DEFAULT)return{id:le.DEFAULT,name:"default"};if(o.node.groupId==le.COMPUTED)return{id:le.COMPUTED,name:"computed"}}),d=z(()=>p.value.id>=0);function i(){a.value=!a.value}function l(h){r.updatePropertyGroup(p.value.id,c.value)}function m(){c.value=p.value.name}function b(){r.deletePropertyGroup(p.value.id)}async function C(){let h=r.propertyList.filter(w=>w.propertyGroupId==o.node.groupId);for(let w of h)await r.deleteProperty(w.id);o.node.groupId>=0&&await r.deletePropertyGroup(o.node.groupId)}async function E(h){if(h.added){let w=h.added.element;const V=r.properties[w];let F=o.node.groupId;F<0&&(F=null),await r.updateProperty(V.id,V.name,F),await r.triggerPropertyTreeChange()}h.moved&&await r.triggerPropertyTreeChange()}return J(m),Q(o,m),(h,w)=>u(r).propertyGroups[o.node.groupId]||o.node.groupId<0?(s(),n("div",Nt,[v(u(Le),{list:o.node.propertyIds,"item-key":V=>V,group:o.node.groupId>0||o.node.groupId==u(le).DEFAULT?"properties":void 0,onChange:E},{header:_(()=>[e("div",{class:"d-flex group-container",onClick:i},[a.value?(s(),n("div",Wt,w[4]||(w[4]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(s(),n("div",qt,w[5]||(w[5]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),o.menuOpen?(s(),n(O,{key:2},[g.value?f("",!0):(s(),n("div",Qt,x(p.value.name),1)),g.value?(s(),n("div",Kt,[v(qe,{"auto-focus":!0,modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=V=>c.value=V),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:l,onCancel:m,onBlur:w[1]||(w[1]=V=>g.value=!1)},null,8,["modelValue"])])):f("",!0),w[8]||(w[8]=e("div",{class:"flex-grow-1"},null,-1)),o.node.groupId>=u(le).DEFAULT?(s(),I(se,{key:2,onClick:w[2]||(w[2]=ce(()=>{},["prevent","stop"]))},{button:_(()=>w[6]||(w[6]=[e("i",{class:"bb bi bi-three-dots"},null,-1)])),popup:_(({hide:V})=>[e("div",Yt,[d.value?(s(),n(O,{key:0},[e("div",{class:"bb",onClick:F=>{g.value=!0,V()}},x(h.$t("main.menu.editName")),9,Xt),e("div",{class:"bb",onClick:b},x(h.$t("main.menu.removeGroup")),1)],64)):f("",!0),e("div",{class:"bb",onClick:F=>{C(),V()}},x(h.$t("main.menu.deleteGroupAndProperties")),9,Zt)])]),_:1})):f("",!0),o.node.groupId>=-1?(s(),n("div",{key:3,class:"bb me-2",onClick:w[3]||(w[3]=ce(V=>u(t).showModal(u(ee).PROPERTY,{group:o.node.groupId}),["stop","prevent"]))},[v(T,{message:h.$t("main.menu.addNewPropertyToGroup")},{default:_(()=>w[7]||(w[7]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1},8,["message"])])):f("",!0)],64)):f("",!0)])]),item:_(({element:V,index:F})=>[a.value&&y.value.length&&u(r).properties[V]?(s(),n("div",Jt,[e("div",es,[v(Ht,{tab:o.tab,property:u(r).properties[V],open:o.menuOpen},null,8,["tab","property","open"])])])):f("",!0)]),_:1},8,["list","item-key","group"])])):f("",!0)}}),$e=R(ts,[["__scopeId","data-v-87a8260b"]]),ss={key:0,class:"mb-1"},os=G({__name:"DraggablePropertyList",props:{tab:{},menuOpen:{type:Boolean}},emits:[],setup(k,{emit:r}){const t=N(),o=k;function a(g){t.triggerPropertyTreeChange()}return(g,c)=>(s(),I(u(Le),{list:u(t).propertyTree,onChange:a,"item-key":y=>y.groupId},{item:_(({element:y})=>[y.groupId>=0?(s(),n("div",ss,[v($e,{tab:o.tab,node:y,"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])])):f("",!0)]),footer:_(()=>[v($e,{class:"mb-1",tab:o.tab,node:u(t).propertyTree[u(t).propertyTree.length-2],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"]),v($e,{class:"mb-1",tab:o.tab,node:u(t).propertyTree[u(t).propertyTree.length-1],"menu-open":o.menuOpen},null,8,["tab","node","menu-open"])]),_:1},8,["list","item-key"]))}}),as={class:""},ns={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ls={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},is={class:"flex-grow-1 text-capitalize overflow-hidden"},rs={key:0,class:"bi bi-chevron-left"},ds={key:1,class:"bi bi-chevron-right"},us={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ps={class:"d-flex align-items-center"},cs={style:{"max-height":"300px",overflow:"auto"}},ms={key:0,id:"import"},gs={class:"pt-1 pb-2"},vs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},fs={key:0,class:"ps-2 pe-2"},ys={class:"p-1"},bs={key:0,class:"custom-hr"},hs={class:"p-1 mt-0"},_s={key:0,class:"d-flex p-1"},ks={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},$s={key:1,class:"bb me-1"},xs={class:"bb me-2"},ws={key:1,class:"mt-2"},Ss=200,Cs=55,Is=G({__name:"Menu",emits:["export","toggle"],setup(k,{emit:r}){const t=de(),o=N(),a=ue(),g=me(),c=r,y=M(!1),p=M(!0),d=z(()=>p.value?Ss:Cs),i=async()=>{a.showModal(ee.IMPORT)},l=z(()=>t.state.tasks.filter(E=>!E.done)??[]);function m(){a.showModal(ee.FOLDERSELECTION,{callback:b,mode:"images"})}function b(E){E&&o.addFolder(E)}function C(){p.value=!p.value,c("toggle")}return(E,h)=>(s(),I(Re,{id:u(g).mainTab},{default:_(({tab:w})=>[e("div",{class:"menu overflow-scroll",style:Y({width:d.value+"px"})},[e("div",as,[e("div",null,[e("div",ns,[e("div",ls,[p.value?(s(),n(O,{key:0},[e("div",is,x(u(t).state.name),1),v(T,{message:"main.menu.close_project"},{default:_(()=>[e("div",{class:"base-hover p-1",onClick:h[0]||(h[0]=V=>u(a).closeProject(u(t).state.id))},h[6]||(h[6]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:h[1]||(h[1]=V=>u(a).showModal(u(ee).SETTINGS))},h[7]||(h[7]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:B(["base-hover p-1",p.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:C},[p.value?(s(),n("i",rs)):(s(),n("i",ds))],2)])]),p.value?(s(),n(O,{key:0},[h[9]||(h[9]=e("div",{class:"custom-hr"},null,-1)),e("div",us,[e("div",ps,[e("div",null,[e("b",null,x(E.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:h[2]||(h[2]=V=>{m(),u(Ce)()})},[v(T,{message:"main.nav.folders.add"},{default:_(()=>h[8]||(h[8]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",cs,[v(Mt,{folders:u(o).folderRoots,"filter-manager":w.collection.filterManager,"visible-folders":w.state.visibleFolders,tab:w},null,8,["folders","filter-manager","visible-folders","tab"])])])],64)):f("",!0),p.value?(s(),n(O,{key:1},[l.value&&l.value.length?(s(),n("div",ms,[h[11]||(h[11]=e("div",{class:"custom-hr"},null,-1)),e("div",gs,[e("div",vs,[e("div",null,[e("b",null,x(E.$t("main.nav.tasks.title")),1)])]),h[10]||(h[10]=e("div",{class:"custom-hr"},null,-1)),u(t).state.tasks?(s(),n("div",fs,[(s(!0),n(O,null,K(l.value,(V,F)=>(s(),n("div",ys,[F?(s(),n("div",bs)):f("",!0),v(Et,{task:V},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),h[18]||(h[18]=e("div",{class:"custom-hr"},null,-1)),e("div",hs,[p.value?(s(),n("div",_s,[v(T,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:_(()=>[e("b",null,x(E.$t("main.nav.properties.title")),1)]),_:1}),h[13]||(h[13]=e("span",{class:"flex-grow-1"},null,-1)),y.value?(s(),n("span",ks,h[12]||(h[12]=[e("span",{class:"sr-only"},null,-1)]))):(s(),n("span",$s,[v(T,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:i})]),_:1})])),e("span",xs,[v(T,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:_(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h[3]||(h[3]=V=>u(a).showModal(u(ee).EXPORT,void 0))})]),_:1})])])):f("",!0),u(t).loaded?(s(),n("div",ws,[v(os,{tab:w,"menu-open":p.value},null,8,["tab","menu-open"]),p.value?(s(),n(O,{key:0},[h[16]||(h[16]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:h[4]||(h[4]=V=>{u(a).showModal(u(ee).PROPERTY,void 0),u(Ce)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[14]||(h[14]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(E.$t("main.nav.properties.add_property")),1)]),h[17]||(h[17]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:h[5]||(h[5]=V=>u(o).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[h[15]||(h[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(E.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)])])])],4)]),_:1},8,["id"]))}}),Vs=R(Is,[["__scopeId","data-v-89a8f03a"]]),Ms={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Ts={class:""},zs=["onClick"],Fs=G({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r;function a(g){o("update:modelValue",g)}return(g,c)=>(s(),I(se,null,{button:_(()=>[e("div",Ms,[e("span",Ts,x(g.$t("modals.filters."+t.modelValue)),1)])]),popup:_(({hide:y})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:y},[e("div",{class:"base-btn",onClick:c[0]||(c[0]=p=>a(u(ze).and))},x(g.$t("modals.filters.and")),1),c[2]||(c[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:c[1]||(c[1]=p=>a(u(ze).or))},x(g.$t("modals.filters.or")),1)],8,zs)]),_:1}))}}),Es=["disabled"],Ps={class:"m-0 p-1"},Os=["onClick"],Gs=G({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(k,{emit:r}){const t=N(),o=k,a=r,g=z(()=>t.properties[o.propertyId]),c=z(()=>Qe(g.value.type));async function y(p){a("update:modelValue",p)}return(p,d)=>(s(),I(se,{onHide:d[0]||(d[0]=i=>a("hide")),placement:"bottom"},{button:_(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[e("span",null,x(p.$t("modals.filters.operators."+o.modelValue)),1)],8,Es)]),popup:_(({hide:i})=>[e("div",Ps,[(s(!0),n(O,null,K(c.value,l=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:m=>{y(l),i()}},[e("a",null,x(p.$t("modals.filters.operators."+l)),1)],8,Os))),256))])]),_:1}))}}),Ls=R(Gs,[["__scopeId","data-v-0b3d97be"]]),Ds={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},As=G({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r;function a(g){o("update:modelValue",g)}return(g,c)=>(s(),n("div",Ds,[u(Ge)(g.property.type)?(s(),I(Ke,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":a,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:t.property,teleport:!1,width:t.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):t.property.type==u(H).color?(s(),I(Ye,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).number?(s(),I(Xe,{key:2,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).url?(s(),I(Ze,{key:3,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"])):t.property.type==u(H).checkbox?(s(),I(Je,{key:4,"model-value":t.modelValue,"onUpdate:modelValue":a,label:t.property.name,width:t.width,class:"sb"},null,8,["model-value","label","width"])):t.property.type==u(H).date?(s(),I(et,{key:5,"model-value":t.modelValue,teleport:!1,"onUpdate:modelValue":a,width:t.width,class:"sb"},null,8,["model-value","width"])):(s(),I(tt,{key:6,"model-value":t.modelValue,"onUpdate:modelValue":a,width:t.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),Rs={class:"p-0 m-0 ps-2"},Us=G({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(k,{emit:r}){const t=N(),o=k,a=z(()=>t.properties[o.filter.propertyId]),g=z(()=>st(o.filter.operator));function c(d){o.manager.updateFilter(o.filter.id,{operator:d})}function y(d){o.manager.updateFilter(o.filter.id,{value:d})}function p(d){o.manager.updateFilter(o.filter.id,{propertyId:d.id})}return(d,i)=>(s(),n(O,null,[e("td",Rs,[v(ot,{"model-value":a.value,"onUpdate:modelValue":p},null,8,["model-value"])]),e("td",null,[v(Ls,{"property-id":a.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":c},null,8,["property-id","model-value"])]),e("td",null,[g.value?(s(),I(As,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":y,property:a.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),js={style:{"max-height":"500px",overflow:"auto"}},Ue=G({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(k,{emit:r}){const t=k;function o(a){t.manager.addNewFilter(a,t.group.id),fe.filter.show()}return(a,g)=>(s(),I(se,{placement:"auto"},{button:_(()=>[Pe(a.$slots,"default")]),popup:_(({hide:c})=>[e("div",js,[v(De,{onSelect:y=>{o(y),c()},"ignore-ids":[u(Ve).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Bs={class:"filter-group"},Hs={class:"table table-sm"},Ns={style:{height:"33px"}},Ws={class:""},qs={key:0,class:"m-0 p-0"},Qs={key:2,class:"text-secondary"},Ks={class:"border rounded"},Ys={class:""},Xs=["onClick"],Zs={class:"d-flex text-secondary ms-2"},Js={class:"add-options hover-light"},eo=G({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(k,{emit:r}){N();const t=k,o=z(()=>t.filter),a=z(()=>o.value.filters),g=z(()=>{let d=255-(o.value.depth+1)*5;return`background: rgb(${d},${d},${d});`});function c(d){t.manager.deleteFilter(d.id)}function y(d){t.manager.addNewFilterGroup(d)}function p(d,i){t.manager.updateFilterGroup(d,i)}return(d,i)=>(s(),n("div",Bs,[e("table",Hs,[(s(!0),n(O,null,K(a.value,(l,m)=>(s(),n("tr",Ns,[e("td",Ws,[m==0?(s(),n("div",qs,x(d.$t("modals.filters.where")),1)):m==1?(s(),I(Fs,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":i[0]||(i[0]=b=>p(o.value.id,b))},null,8,["model-value"])):(s(),n("span",Qs,x(d.$t("modals.filters."+o.value.groupOperator)),1))]),l.propertyId!==void 0?(s(),I(Us,{key:0,filter:l,manager:t.manager},null,8,["filter","manager"])):(s(),n("td",{key:1,colspan:"3",style:Y(g.value)},[e("div",Ks,[v(je,{filter:l,manager:t.manager},null,8,["filter","manager"])])],4)),e("td",Ys,[e("span",{class:"base-btn",onClick:b=>c(l)},i[2]||(i[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Xs)])]))),256))]),e("div",Zs,[v(Ue,{group:t.filter,manager:t.manager},{default:_(()=>[e("div",Js,[i[3]||(i[3]=e("i",{class:"bi bi-plus"},null,-1)),te(x(d.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:i[1]||(i[1]=l=>y(o.value.id))},[i[4]||(i[4]=e("i",{class:"bi bi-plus"},null,-1)),te(x(d.$t("modals.filters.new_group")),1)])])]))}}),je=R(eo,[["__scopeId","data-v-cbadcac5"]]),to={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},so={key:0},oo={key:0,class:"or-separator"},ao={key:0,class:"or-separator"},no={key:0,class:"m-1 p-1"},lo=G({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(k,{emit:r}){const t=N(),o=k,a=M(null),g=M(null),c=z(()=>{let p=y(o.manager.state.filter),d={};return p.forEach(i=>d[i.propertyId]=i),Object.values(d)});function y(p){let d=[];for(let i of p.filters)i.isGroup?d.push(...y(i)):d.push(i);return d}return Q(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&g.value.hide()}),J(async()=>{await Z(),fe.filter=g.value}),(p,d)=>(s(),I(se,{ref_key:"dropdownElem",ref:g,placement:"top-start"},{button:_(()=>[e("div",null,[c.value.length||o.manager.state.query?(s(),n("div",to,[o.manager.state.query?(s(),n("div",so,[d[0]||(d[0]=e("span",{class:"text-primary"},"Text Query",-1)),c.value.length?(s(),n("span",oo,"|")):f("",!0)])):f("",!0),(s(!0),n(O,null,K(c.value,(i,l)=>(s(),n("div",null,[l>0?(s(),n("span",ao,"|")):f("",!0),i.propertyId==u(Ve).id?(s(),I(ge,{key:1,type:u(t).properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(u(t).properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:_(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:a},[Object.keys(u(t).properties).length>0?(s(),n("div",no,[v(je,{filter:o.manager.state.filter,manager:o.manager,parent:a.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}}),io=R(lo,[["__scopeId","data-v-7dbca090"]]),ro={class:"d-flex flex-row filter-form"},uo={class:"pt-1 pb-1"},po=G({__name:"FilterForm",props:{manager:Ie},setup(k){const r=k;return(t,o)=>(s(),n("div",ro,[e("div",uo,x(t.$t("main.menu.filters"))+": ",1),v(io,{manager:r.manager},null,8,["manager"]),v(Ue,{manager:r.manager,group:r.manager.state.filter,class:"p-1"},{default:_(()=>o[0]||(o[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}}),co=R(po,[["__scopeId","data-v-aad7b24a"]]),mo={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},go=G({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(k,{emit:r}){const t=k,o=r,a=M(null);return(g,c)=>(s(),I(se,{ref_key:"dropdownElem",ref:a,"auto-focus":!1},{button:_(()=>c[2]||(c[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:_(()=>[e("div",mo,[v(De,{onClick:c[0]||(c[0]=y=>u(Ce)()),onSelect:c[1]||(c[1]=y=>{o("select",y),a.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}}),Be=R(go,[["__scopeId","data-v-2f10e29f"]]),vo={class:"base-hover ps-1 pe-1"},fo={class:"main"},yo=["onClick"],bo=G({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:r}){const t=k,o=r,a=Object.values(Ae);function g(c){o("update:modelValue",c)}return(c,y)=>(s(),I(se,null,{button:_(()=>[e("div",vo,x(t.modelValue),1)]),popup:_(({hide:p})=>[e("div",fo,[(s(!0),n(O,null,K(u(a),d=>(s(),n("div",{class:"base-hover option",onClick:i=>{g(d),p()}},x(d),9,yo))),256))])]),_:1}))}}),ho=R(bo,[["__scopeId","data-v-cc9d0d61"]]),_o={class:""},ko={class:"d-flex ipt"},$o={class:"ms-2",min:"1"},xo=G({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(k,{emit:r}){const t=k,o=r,a=M(1),g=M(Ae.Year);function c(){t.option.stepSize==a.value&&t.option.stepUnit==g.value||o("change",{stepSize:a.value,stepUnit:g.value})}function y(){a.value=t.option.stepSize??1,g.value=t.option.stepUnit}return Q(()=>t.option,y),J(y),Q(a,()=>{(a.value<1||a.value==null||isNaN(a.value))&&(a.value=1)}),(p,d)=>(s(),I(se,{onHide:c},{button:_(()=>d[2]||(d[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:_(({hide:i,focus:l})=>[e("div",_o,[e("div",ko,[e("div",null,[ye(e("input",{type:"number","onUpdate:modelValue":d[0]||(d[0]=m=>a.value=m)},null,512),[[be,a.value]])]),e("div",$o,[v(ho,{modelValue:g.value,"onUpdate:modelValue":d[1]||(d[1]=m=>g.value=m),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}}),wo=R(xo,[["__scopeId","data-v-a27bea28"]]),So={class:"d-flex flex-row group-form"},Co={class:"pt-1 pb-1"},Io={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Vo={key:0,class:"bi bi-chevron-right smaller"},Mo=["onClick"],To=["onClick"],zo=["onClick"],Fo=["onClick"],Eo=["onClick"],Po=["onClick"],Oo=["onClick"],Go=["onClick"],Lo=["onClick"],Do={key:5,class:"sm-btn"},Ao={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ro=G({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(k){const r=N(),t=k;function o(i){t.manager.setGroupOption(i),t.manager.update(!0)}function a(i){t.manager.delGroupOption(i),t.manager.update(!0)}function g(i,l){t.manager.setGroupOption(i,{direction:l}),t.manager.sortGroups(!0)}function c(i,l){t.manager.setGroupOption(i,{type:l}),t.manager.sortGroups(!0)}function y(i,l){t.manager.setGroupOption(i,l),t.manager.update(!0)}const p=z(()=>t.manager.state.groupBy.map(i=>r.properties[i])),d=z(()=>{const i=[];return t.manager.state.groupBy.forEach(l=>{i.push({option:t.manager.state.options[l],property:r.properties[l]})}),i});return(i,l)=>(s(),n("div",So,[e("div",Co,x(i.$t("main.menu.groupby"))+": ",1),p.value.length?(s(),n("div",Io,[(s(!0),n(O,null,K(d.value,(m,b)=>(s(),n(O,null,[b>0?(s(),n("i",Vo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:C=>a(m.property.id),id:"remove-group-button"},x(m.property.name),9,Mo),m.option.type==u(ne).Size?(s(),I(T,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:_(()=>[m.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:C=>c(m.property.id,u(ne).Property)},null,8,To)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:C=>c(m.property.id,u(ne).Property)},null,8,zo))]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:_(()=>[m.property.type==u(H).number?(s(),n(O,{key:0},[m.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:C=>c(m.property.id,u(ne).Size)},null,8,Fo)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:C=>c(m.property.id,u(ne).Size)},null,8,Eo))],64)):(s(),n(O,{key:1},[m.option.direction==u(oe).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:C=>c(m.property.id,u(ne).Size)},null,8,Po)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:C=>c(m.property.id,u(ne).Size)},null,8,Oo))],64))]),_:2},1024)),m.option.direction==u(oe).Ascending?(s(),I(T,{key:3,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:C=>g(m.property.id,u(oe).Descending)},null,8,Go)]),_:2},1024)):(s(),I(T,{key:4,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:C=>g(m.property.id,u(oe).Ascending)},null,8,Lo)]),_:2},1024)),m.property.type==u(H).date?(s(),n("div",Do,[v(wo,{option:m.option,onChange:C=>y(m.property.id,C)},null,8,["option","onChange"])])):f("",!0)],64))),256)),t.isLoading?(s(),n("i",Ao)):f("",!0)])):f("",!0),v(Be,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:l[0]||(l[0]=m=>o(m))},null,8,["group-ids"])]))}}),Uo=R(Ro,[["__scopeId","data-v-388718c9"]]),jo={class:"d-flex flex-row sort-form"},Bo={class:"pt-1 pb-1"},Ho={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},No={key:0,class:"bi bi-chevron-right smaller"},Wo=["onClick"],qo=["onClick"],Qo=["onClick"],Ko=G({__name:"SortForm",props:{manager:nt},setup(k){const r=N(),t=k,o=z(()=>t.manager.state.sortBy.map(p=>({propertyId:p,direction:t.manager.state.options[p].direction}))),a=z(()=>o.value.map(p=>p.propertyId));function g(p){t.manager.setSort(p),t.manager.update(!0)}function c(p){t.manager.delSort(p),t.manager.update(!0)}function y(p,d){t.manager.setSort(p,{direction:d}),t.manager.update(!0)}return(p,d)=>(s(),n("div",jo,[e("div",Bo,x(p.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),n("div",Ho,[(s(!0),n(O,null,K(o.value,(i,l)=>(s(),n(O,null,[l>0?(s(),n("i",No)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:m=>c(i.propertyId)},x(u(r).properties[i.propertyId].name),9,Wo),i.direction==u(oe).Ascending?(s(),I(T,{key:1,message:"main.menu.sort.order_asc"},{default:_(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:m=>y(i.propertyId,u(oe).Descending)},null,8,qo)]),_:2},1024)):(s(),I(T,{key:2,message:"main.menu.sort.order_desc"},{default:_(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:m=>y(i.propertyId,u(oe).Ascending)},null,8,Qo)]),_:2},1024))],64))),256))])):f("",!0),v(Be,{"group-ids":a.value,onSelect:d[0]||(d[0]=i=>g(i))},null,8,["group-ids"])]))}}),Yo=R(Ko,[["__scopeId","data-v-80dc564a"]]),Xo={class:"p-2"},Zo={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Jo={class:"border mb-1 p-1"},ea={class:"me"},ta={key:0},sa={key:1},oa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},aa={class:"d-flex center justify-content-center"},na={key:1,class:"bi bi-arrow-down text-secondary"},la={key:3,class:"bi bi-arrow-up text-secondary"},ia={class:"border mb-1 p-1"},ra={class:"me"},da={key:0},ua={key:1},pa={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ie=5,ca=G({__name:"HistoryDropdown",emits:[],setup(k,{emit:r}){const t=N(),o=M(!1),a=z(()=>o.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),g=z(()=>[...t.history.undo].reverse().slice(0,ie)),c=z(()=>t.history.redo.slice(Math.max(t.history.redo.length-ie,0)));return Q(()=>t.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(y,p)=>g.value.length||c.value.length?(s(),I(se,{key:0},{button:_(()=>[v(T,{message:"dropdown.history.info"},{default:_(()=>[e("div",{class:"d-flex sb flash",style:Y([{"font-size":"14px"},a.value])},[p[2]||(p[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(y.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:_(()=>[e("div",Xo,[u(t).history.redo.length>ie?(s(),n("div",Zo," + "+x(u(t).history.redo.length-ie),1)):f("",!0),(s(!0),n(O,null,K(c.value,d=>(s(),n("div",Jo,[e("span",ea,x(new Date(d.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[3]||(p[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),d.tags?(s(),n("span",ta,x(d.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),d.values?(s(),n("span",sa,x(d.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",oa,[e("div",aa,[g.value.length?(s(),I(T,{key:0,message:"dropdown.history.undo"},{default:_(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:p[0]||(p[0]=(...d)=>u(t).undo&&u(t).undo(...d))})]),_:1})):(s(),n("div",na)),p[4]||(p[4]=e("div",{style:{width:"30px"}},null,-1)),c.value.length?(s(),I(T,{key:2,message:"dropdown.history.redo"},{default:_(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:p[1]||(p[1]=(...d)=>u(t).redo&&u(t).redo(...d))})]),_:1})):(s(),n("div",la))])]),(s(!0),n(O,null,K(g.value,d=>(s(),n("div",ia,[e("span",ra,x(new Date(d.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),p[5]||(p[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),d.tags?(s(),n("span",da,x(d.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),d.values?(s(),n("span",ua,x(d.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),u(t).history.undo.length>ie?(s(),n("div",pa," + "+x(u(t).history.undo.length-ie),1)):f("",!0)])]),_:1})):f("",!0)}}),ma=R(ca,[["__scopeId","data-v-b5086318"]]),ga=G({__name:"ToggleReload",props:{tab:{}},emits:[],setup(k,{emit:r}){const t=k,o=z(()=>t.tab.collection.state.autoReload?2:t.tab.collection.runState.isDirty?0:1);function a(){o.value==0?t.tab.collection.update():o.value==1?t.tab.collection.setAutoReload(!0):t.tab.collection.setAutoReload(!1)}return(g,c)=>(s(),n("div",{class:"bb font",onClick:a,style:{width:"26px",height:"30px",overflow:"hidde"}},[o.value==0?(s(),I(T,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:_(()=>c[0]||(c[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),o.value==1?(s(),I(T,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:_(()=>c[1]||(c[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),o.value==2?(s(),I(T,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:_(()=>c[2]||(c[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}}),va=R(ga,[["__scopeId","data-v-4047bb79"]]),fa={class:"d-flex flex-row p-2"},ya=["placeholder"],ba={class:"me-5 d-flex"},ha={class:"ms-5",style:{"font-size":"13px"}},_a=["checked"],ka={class:"ms-1"},$a={class:"ms-4"},xa={class:"d-flex flex-wrap content-container ps-2"},wa=G({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(k,{emit:r}){lt();const t=k,o=M(""),a=z(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),g=z(()=>a.value.length);function c(i){const l=i.target.checked;t.tab.collection.groupManager.setSha1Mode(l,!0)}function y(){o.value=t.tab.state.filterState.query}function p(){t.tab.collection.filterManager.setQuery(o.value),t.tab.collection.filterManager.update(!0)}function d(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return J(y),Q(()=>t.tab.collection.filterManager.state.query,y),(i,l)=>(s(),n(O,null,[e("div",fa,[v(T,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:_(()=>[e("div",{class:B(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[l[7]||(l[7]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ye(e("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=m=>o.value=m),onChange:p},null,40,ya),[[be,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:d},"x")],2)]),_:1}),e("div",ba,[v(T,{message:"main.menu.grid_tooltip"},{default:_(()=>[e("i",{class:B("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=m=>t.tab.setViewMode("tree"))},null,2)]),_:1}),v(T,{message:"main.menu.table_tooltip"},{default:_(()=>[e("i",{id:"toot",class:B("bi bi-table btn-icon me-2"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=m=>t.tab.setViewMode("grid"))},null,2)]),_:1}),v(T,{message:"main.menu.graph_tooltip"},{default:_(()=>[e("i",{id:"toot",class:B("bi bi-bar-chart btn-icon"+(t.tab.state.display=="graph"?"":" text-secondary")),onClick:l[3]||(l[3]=m=>t.tab.setViewMode("graph"))},null,2)]),_:1})]),v(T,{message:"main.menu.image_size_tooltip",click:!1},{default:_(()=>l[8]||(l[8]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[v(it,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":l[4]||(l[4]=m=>t.tab.state.imageSize=m)},null,8,["modelValue"])]),e("div",ha,[v(T,{message:"main.menu.image_mode_tooltip"},{default:_(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:c},null,40,_a),e("span",ka,x(i.$t("main.menu.image_mode")),1)]),_:1})]),e("div",$a,[v(ma)]),g.value?(s(),I(rt,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":a.value,"onRemove:selected":l[5]||(l[5]=m=>t.tab.collection.groupManager.clearSelection()),onStamped:l[6]||(l[6]=m=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),l[10]||(l[10]=e("div",{class:"flex-grow-1"},null,-1)),v(T,{message:"main.menu.issue",class:"bb"},{default:_(()=>l[9]||(l[9]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",xa,[v(va,{tab:t.tab,class:"me-1"},null,8,["tab"]),v(co,{manager:t.tab.collection.filterManager},null,8,["manager"]),v(Uo,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),v(Yo,{manager:t.tab.collection.sortManager},null,8,["manager"]),l[11]||(l[11]=e("div",null,null,-1))])],64))}}),Sa=R(wa,[["__scopeId","data-v-83f17360"]]),Ca={class:""},Ia={class:"d-flex flex-row"},Va=G({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(k,{emit:r}){const t=ue(),o=k,a=r,g=z(()=>`width: ${o.size}px; height: ${o.size}px;`);z(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const c=z(()=>o.pile.images[0]);return(y,p)=>(s(),n("div",Ca,[v(dt,{image:c.value},{default:_(()=>[e("div",{style:Y(g.value),class:"img-container",onClick:p[0]||(p[0]=d=>u(t).showModal(u(ee).IMAGE,{image:c.value}))},[v(ut,{image:c.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Ia,[v(T,{message:"main.recommand.accept"},{default:_(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=d=>a("accept",c.value))}," ✓ ",4)]),_:1}),v(T,{message:"main.recommand.refuse"},{default:_(()=>[e("div",{style:Y(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=d=>a("refuse",c.value))}," ✕ ",4)]),_:1})])]))}}),Ma=R(Va,[["__scopeId","data-v-809d667b"]]),Ta={class:"reco-container"},za={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Fa={key:0,class:"bi bi-funnel-fill bb text-primary"},Ea={key:1,class:"bi bi-funnel bb"},Pa={class:"text-secondary me-2"},Oa={style:{"padding-top":"2px"},class:"me-1"},Ga={class:"flex-grow-1"},La={class:"d-flex flex-row"},Da={key:0,class:"separator"},Aa={class:"d-flex flex-row"},xe=10,Ra=G({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(k,{emit:r}){const t=N(),o=pt(),a=k,g=r,c=M(1),y=ve([]),p=M(null),d=ve([]),i=ve(new Set),l=M(!0),m=[],b=[];async function C(D){const S=[],$=[];d.forEach(A=>{if(A.value!=null){const P=t.properties[A.propertyId];let W=A.value;P.type==H.multi_tags?(W=D.properties[A.propertyId]??[],W=[...W,A.value]):P.type==H.tag&&(W=[W]),P.mode==Se.id?$.push({instanceId:D.id,propertyId:P.id,value:W}):S.push({propertyId:P.id,sha1:D.sha1,value:W})}}),await t.setPropertyValues($,S)}function E(D){p.value.isSha1Group?p.value.images.filter(S=>S.sha1==D.sha1).forEach(S=>i.add(S.id)):i.add(D.id),X()}function h(){y.length=0;let D=[];const S=b.map($=>t.instances[$]);if(p.value.isSha1Group){const $={},A=Array.from(new Set(S.map(P=>P.sha1)));A.forEach(P=>$[P]=[]),S.forEach(P=>$[P.sha1].push(P)),A.forEach(P=>D.push({sha1:P,images:t.sha1Index[P]}))}else S.forEach($=>D.push({sha1:$.sha1,images:[$]}));w(D,y,c.value,a.imageSize,a.width)}function w(D,S,$,A,P){let W=P,q=[],ae=0;for(let he=0;he<D.length&&!(S.length>=$);he++){let pe=D[he];if(pe.images=pe.images.filter(He=>!i.has(He.id)),pe.images.length==0)continue;let _e=A+xe;if(ae+_e<W){q.push(pe),ae+=_e;continue}if(q.length==0)throw new Error("Images seems to be to big for the line");S.push(q),S.length<$&&(q=[pe],ae=_e)}q.length>0&&S.length<$&&S.push(q)}async function V(){if(!a.group||!o.hasSimilaryFunction)return;const D=o.defaultActions.similar,S=o.getContext(D);S.instanceIds=a.group.images.map(q=>q.id);const $=await o.getSimilarImages(S);if(!$)return;if(!$.groups)throw new Error("No instances in ActionResult");let P=gt($.groups)[0];if(l.value){const q=new Set(a.tab.collection.filterManager.result.images.map(ae=>ae.id));P.images=P.images.filter(ae=>q.has(ae.id))}P.scores&&vt(P),p.value=P,d.length=0;let W=a.group;for(;W;)d.push(...W.meta.propertyValues),W=W.parent;i.clear(),m.length=0,P.images.forEach(q=>m.push(q.id)),X(),g("update")}function F(){l.value=!l.value}function L(){a.tab.collection.groupManager.onResultChange.addListener(X)}function j(){a.tab.collection.groupManager.onResultChange.removeListener(X)}function X(){const D=a.tab.collection.groupManager.result.index[a.group.id];if(!D){g("close");return}b.length=0;const S=new Set(D.images.map($=>$.id));m.forEach($=>{S.has($)||i.has($)||b.push($)}),h()}return J(L),Me(j),J(V),Q(()=>a.group,()=>{V(),i.clear()}),Q(()=>a.imageSize,h),Q(()=>a.width,h),Q(l,V),(D,S)=>(s(),n("div",Ta,[e("div",za,[v(T,{message:"main.recommand.close"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[0]||(S[0]=$=>g("close"))},S[2]||(S[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),S[5]||(S[5]=e("div",{class:"b-left pe-1"},null,-1)),v(T,{message:"main.recommand.scroll"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:S[1]||(S[1]=$=>g("scroll",a.group.id))},S[3]||(S[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),S[6]||(S[6]=e("div",{class:"b-left pe-1"},null,-1)),v(T,{message:"main.recommand.filter"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:F},[l.value?(s(),n("span",Fa)):(s(),n("span",Ea))])]),_:1}),S[7]||(S[7]=e("div",{class:"b-left pe-1"},null,-1)),v(T,{message:"main.recommand.reload"},{default:_(()=>[e("div",{class:"text-secondary pe-1",onClick:V},S[4]||(S[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),S[8]||(S[8]=e("div",{class:"b-left pe-1"},null,-1)),v(T,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:_(()=>[e("span",Pa,x(D.$t("main.recommand.title")),1)]),_:1}),e("div",Oa,[v(ct,{action:"similar",onChanged:V})]),e("div",Ga,[e("div",La,[(s(!0),n(O,null,K(d,($,A)=>(s(),n(O,null,[v(mt,{class:"",value:$},null,8,["value"]),A<d.length-1?(s(),n("div",Da)):f("",!0)],64))),256))])])]),e("div",{style:Y("margin-left:"+xe+"px;")},[(s(!0),n(O,null,K(y,$=>(s(),n("div",null,[e("div",Aa,[(s(!0),n(O,null,K($,A=>(s(),I(Ma,{pile:A,size:a.imageSize,onAccept:C,onRefuse:E,style:Y("margin-right:"+xe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}}),Ua=R(Ra,[["__scopeId","data-v-c830b08a"]]),ja={style:{display:"flex"}},Ba={class:"info"},Ha={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:H},height:String},setup(k){const r=k,t=M(0),o=M(!1),a={};Object.keys(r.chartData.series).forEach(l=>{a[l]=!1});const g=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:r.chartData.dataType===H.date?"datetime":"numeric",categories:r.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:l,seriesIndex:m,dataPointIndex:b,w:C}){const E=r.chartData.series[m].data[b];let h='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';E.images.forEach((V,F)=>{F<10&&(h+=`<div style="width: 75px; height: 75px;"><img src="${V}" style="width: 100%; height: 100%;" /></div>`)}),h+="</div>";let w=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${r.chartData.series[m].name} — </b> ${E.y} Images</span>`;return w+=`<div>${h}</div>`,w}}}),c=()=>{g.value.chart.stacked=!g.value.chart.stacked,o.value=!o.value,t.value+=1},y=()=>{let l;g.value.chart.type==="area"?l={chart:{...g.value.chart,type:"bar"}}:l={chart:{...g.value.chart,type:"area"}},g.value={...g.value,...l},t.value+=1},p=(l,m,b)=>{const E=r.chartData.series[m];let h=Math.max(...E.data.map(w=>w.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(w=>w.remove()),a[m]){a[m]=!1;return}E.data.forEach((w,V)=>{const L=Math.floor(w.y/h*17),j=w.images.slice(0,L),X=`circle[index="${m}"][j="${V}"]`,D=document.querySelector(X),S=parseFloat(D.getAttribute("cx"));j.forEach(($,A)=>{const P=document.createElement("img");P.src=$,P.width=40,P.height=40,P.style.position="absolute";let W=S+40/1.5,q=65+A*40;P.style.left=`${W}px`,P.style.bottom=`${q}px`,P.classList.add("apexcharts-custom-image"),P.addEventListener("mouseover",ae=>d(W,q,$)),P.addEventListener("mouseout",i),l.el.appendChild(P)})}),Object.keys(a).forEach(w=>a[w]=!1),a[m]=!0};function d(l,m,b){const C=document.getElementById("zoomed-image");C.style.left=`${l+120*1.5}px`,C.src=b,C.style.bottom=`${m}px`,C.style.display="block"}function i(){const l=document.getElementById("zoomed-image");l.style.display="none"}return(l,m)=>{const b=Ee("apexchart");return s(),n(O,null,[e("div",ja,[e("button",{class:"mt-2",onClick:y},x(g.value.chart.type==="area"?l.$t("main.graph-view.histo"):l.$t("main.graph-view.curve")),1),r.chartData.series.length>1?(s(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:c},x(o.value?l.$t("main.graph-view.over"):l.$t("main.graph-view.stack")),1)):f("",!0)]),(s(),I(b,{style:{position:"relative"},key:t.value,height:r.height,type:g.value.chart.type,options:g.value,series:r.chartData.series,onLegendClick:p},null,8,["height","type","options","series"])),e("i",Ba,x(l.$t("main.graph-view.info")),1),m[0]||(m[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Na={key:1},Wa=G({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(k,{emit:r}){const t=N(),o=k,a=M(""),g=M(y());function c(){const p=new Set;let d=o.collection.groupManager.getGroupIterator();for(;d;){const i=d.group;if(i.id===0||i.meta.propertyValues&&i.meta.propertyValues[0].value==null){d=d.nextGroup();continue}for(let l of i.children)p.add(l.meta.propertyValues[0].value);i.children.forEach(()=>d=d.nextGroup()),d=d.nextGroup()}return p}function y(){const p={};let d,i=o.collection.groupManager.state.groupBy;if(i.length===0){a.value="Choose at least one date or numeric value to group the images by";return}const l=t.properties[i[0]],m=l.type;if(i.length>2){a.value="Only max two levels of grouping are supported";return}else if(i.length===1)p[l.name]={name:l.name,data:[]};else if(d=Array.from(c()),d.length>20){a.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(m!==H.number&&m!==H.date){a.value="First level of grouping needs to be a date or a numeric property";return}let b=o.collection.groupManager.getGroupIterator();const C=[];for(;b;){const E=b.group;if(E.id===0||E.meta.propertyValues&&E.meta.propertyValues[0].value==null){b=b.nextGroup();continue}let h=E.meta.propertyValues[0];const w=m===H.date?new Date(h.value).getTime():h.value;if(C.push(w),l.name in p)p[l.name].data.push({x:w,y:E.images.length,images:E.images.slice(0,20).map(V=>V.urlSmall)});else{const V=E.children.map(L=>L.meta.propertyValues[0].value),F=d.filter(L=>!V.includes(L));for(let L of E.children){const j=L.meta.propertyValues[0].value;if(p[j]===void 0){let X=j;j in t.tags&&(X=t.tags[j].value),p[j]={data:[],name:X}}p[L.meta.propertyValues[0].value].data.push({x:w,y:L.images.length,images:L.images.slice(0,20).map(X=>X.urlSmall)})}for(let L of F){if(p[L]===void 0){let j=L;L in t.tags&&(j=t.tags[L].value),p[L]={data:[],name:j}}p[L].data.push({x:w,y:0,images:[]})}E.children.forEach(()=>b=b.nextGroup())}b=b.nextGroup()}return a.value="",{series:Object.values(p),xValues:C,dataType:m}}return o.collection.groupManager.onResultChange.addListener(()=>g.value=y()),(p,d)=>(s(),n("div",{class:"",style:Y({height:o.height+"px"})},[a.value===""?(s(),I(Ha,{key:0,chartData:g.value,height:o.height-50+"px"},null,8,["chartData","height"])):(s(),n("span",Na,x(a.value),1))],4))}}),qa={key:0,class:"m-0 p-0"},Qa={key:0,style:{"margin-left":"10px"}},Ka=G({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(k,{expose:r}){de();const t=N(),o=k;r({updateScrollerWidth:h});const a=M({}),g=M(!0),c=M(null),y=M(null),p=M(null),d=M(0),i=M(0),l=ve({groups:!1}),m=z(()=>o.tab.getVisibleProperties());function b(){c.value&&y.value?d.value=o.height-c.value.clientHeight-y.value.clientHeight-5:c.value?d.value=o.height-c.value.clientHeight-5:d.value=0}function C(w){a.value=o.tab.collection.groupManager.result.index[w],Z(()=>b())}function E(){a.value={},Z(()=>b())}async function h(){await Z(),i.value=c.value?.clientWidth??i.value}return J(()=>{i.value=c.value.clientWidth,window.addEventListener("resize",h)}),Me(()=>{window.removeEventListener("resize",h)}),Q(()=>o.tab.state.imageSize,()=>Z(b)),Q(()=>o.filterOpen,()=>Z(b)),Q(()=>o.height,async()=>{await Z(b)}),J(b),J(()=>o.tab.update()),(w,V)=>(s(),n(O,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:c},[o.filterOpen?(s(),I(Sa,{key:0,tab:o.tab,"compute-status":l},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[a.value.id?(s(),n("div",qa,[v(Ua,{tab:o.tab,group:a.value,"image-size":o.tab.state.imageSize,width:i.value,height:50,onClose:E,onScroll:p.value.scrollTo,onUpdate:V[0]||(V[0]=F=>Z(()=>b()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),u(t).isLoaded&&i.value>0&&d.value>0&&g.value?(s(),n("div",Qa,[o.tab.state.display=="tree"?(s(),I(ft,{key:0,"input-key":"main-view-tree","group-manager":o.tab.collection.groupManager,"image-size":o.tab.state.imageSize,height:d.value-0,properties:m.value,"hide-if-modal":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:p,width:i.value-25,onRecommend:C},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),o.tab.state.display=="grid"?(s(),n("div",{key:1,style:Y({width:i.value-12+"px"}),class:"p-0 m-0 grid-container"},[v(yt,{tab:w.tab,manager:o.tab.collection.groupManager,height:d.value-15,width:i.value-40,"selected-properties":m.value,class:"p-0 m-0","show-images":!0,"selected-images":o.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:p,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),o.tab.state.display=="graph"?(s(),I(Wa,{key:2,collection:o.tab.collection,height:d.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}}),Ya=R(Ka,[["__scopeId","data-v-e68ac94d"]]),Xa=G({__name:"TabButton",props:{tab:{}},setup(k){const r=me(),t=M(""),o=M(null),a=M(!1),g=M(!1),c=k,y=z(()=>c.tab.state.id);function p(){r.selectMainTab(c.tab.state.id)}function d(){g.value=!0,t.value=c.tab.state.name,Z(()=>o.value.focus())}function i(){c.tab.renameTab(t.value),g.value=!1}async function l(){confirm("Are you sure to delete Tab: "+c.tab.state.name)&&r.deleteTab(c.tab.state.id)}return J(()=>{c.tab.isNew&&d()}),(m,b)=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:b[1]||(b[1]=C=>a.value=!0),onMouseleave:b[2]||(b[2]=C=>a.value=!1)},[g.value?(s(),n("div",{key:1,class:B(["tab-button",y.value==u(r).mainTab?" active":""])},[e("form",{onSubmit:ce(i,["stop","prevent"])},[ye(e("input",{onFocusout:i,onKeydown:bt(i,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":b[0]||(b[0]=C=>t.value=C),ref_key:"inputElem",ref:o},null,544),[[be,t.value]])],32)],2)):(s(),n(O,{key:0},[v(T,{message:"main.menu.rename_tab_tooltip"},{default:_(()=>[e("i",{onClick:d,class:B(["bi bi-pencil me-1 tab-icon hover-light",a.value&&u(r).mainTab==y.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:B(["tab-button",y.value==u(r).mainTab?" active":""]),onClick:p},[e("span",null,x(c.tab.state.name),1)],2),v(T,{message:"main.menu.delete_tab_tooltip"},{default:_(()=>[e("i",{onClick:l,class:B(["btn-icon bi bi-x tab-icon hover-light",a.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}}),Za={class:"d-flex d-row",style:{cursor:"pointer"}},Ja={class:"pt-1"},en={key:0,class:"bb bi bi-chevron-down"},tn={key:1,class:"bb bi bi-chevron-right"},sn={style:{"padding-top":"2px","margin-right":"2px"}},on={class:"lang"},an=["value"],nn=["value"],ln=G({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(k,{emit:r}){const{locale:t}=Oe(),o=ue(),a=me(),g=k,c=r;async function y(l){await a.addTab("New Tab")}const p=["fr","en"];function d(){c("update:filterOpen",!g.filterOpen)}function i(l){g.reRender();const m=l.target.value;t.value=m,de().setLang(m)}return(l,m)=>(s(),n("nav",null,[e("div",Za,[e("div",Ja,[e("span",{onClick:d},[g.filterOpen?(s(),n("i",en)):(s(),n("i",tn))])]),(s(!0),n(O,null,K(u(a).loadedTabs,b=>(s(),n("div",null,[v(Xa,{tab:u(a).getTab(b)},null,8,["tab"])]))),256)),v(T,{message:"main.menu.add_tab_tooltip"},{default:_(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:y,id:"add-tab-button"},m[1]||(m[1]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),m[4]||(m[4]=e("div",{class:"flex-grow-1"},null,-1)),e("div",sn,[v(T,{message:"modals.notif.icon"},{default:_(()=>[e("span",{class:"bb",onClick:m[0]||(m[0]=b=>u(o).showModal(u(ee).NOTIF))},m[2]||(m[2]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",on,[m[3]||(m[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:l.$i18n.locale,onChange:i},[(s(),n(O,null,K(p,(b,C)=>e("option",{key:`Lang${C}`,value:b},x(b.toUpperCase()),9,nn)),64))],40,an)])])]))}}),rn={key:0},dn={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},re=G({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(k){const r=k;return(t,o)=>r.loading?(s(),n("div",rn,[t.loading?(s(),n("div",dn,o[0]||(o[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),we=G({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(k){const r=k,t=z(()=>r.force?"100%":r.max==0?"0%":r.current>=r.max?"100%":Math.floor(r.current/r.max*100)+"%");return(o,a)=>(s(),n("span",null,x(t.value),1))}}),un={key:0,class:"center"},pn={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},cn={class:"d-flex text-secondary"},mn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},gn={class:"d-flex text-secondary",style:{"font-size":"14px"}},vn={key:0,class:"bi bi-check text-success"},fn={class:"d-flex text-secondary",style:{"font-size":"14px"}},yn={key:0,class:"bi bi-check text-success"},bn={class:"d-flex text-secondary",style:{"font-size":"14px"}},hn={key:0,class:"bi bi-check text-success"},_n={class:"d-flex text-secondary",style:{"font-size":"14px"}},kn={key:0,class:"bi bi-check text-success"},$n={class:"d-flex text-secondary",style:{"font-size":"14px"}},xn={key:0,class:"bi bi-check text-success"},wn=G({__name:"DataLoad",setup(k){const r=N();return(t,o)=>u(r).loadState?(s(),n("div",un,[e("div",pn,[e("div",null,[e("div",cn,[o[0]||(o[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedProperty},null,8,["loading"]),u(r).loadState.finishedProperty?(s(),n("i",mn)):f("",!0)]),e("div",gn,[o[1]||(o[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedPropertyGroups},null,8,["loading"]),u(r).loadState.finishedPropertyGroups?(s(),n("i",vn)):f("",!0)]),e("div",fn,[o[2]||(o[2]=e("div",{class:"me-1"},"Tags",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedTags},null,8,["loading"]),u(r).loadState.finishedTags?(s(),n("i",yn)):f("",!0)]),e("div",bn,[o[3]||(o[3]=e("div",{class:"me-1"},"Instances",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedInstance},null,8,["loading"]),u(r).loadState.finishedInstance?(s(),n("i",hn)):f("",!0),v(we,{current:u(r).loadState.counterInstance,max:u(r).loadState.maxInstance,force:u(r).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",_n,[o[4]||(o[4]=e("div",{class:"me-1"},"InstanceValues",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedInstanceValues},null,8,["loading"]),u(r).loadState.finishedInstanceValues?(s(),n("i",kn)):f("",!0),v(we,{current:u(r).loadState.counterInstanceValue,max:u(r).loadState.maxInstanceValue,force:u(r).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",$n,[o[5]||(o[5]=e("div",{class:"me-1"},"ImageValues",-1)),v(re,{class:"me-2",loading:!u(r).loadState.finishedImageValues},null,8,["loading"]),u(r).loadState.finishedImageValues?(s(),n("i",xn)):f("",!0),v(we,{current:u(r).loadState.counterImageValue,max:u(r).loadState.maxImageValue,force:u(r).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}}),Sn=R(wn,[["__scopeId","data-v-8b416e86"]]),Cn={key:0},In={id:"panoptic"},Vn={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Mn={class:"w-100"},Tn={key:0,class:"custom-hr"},zn={key:2,class:"loading"},Fn={class:"text-center"},En={key:3,class:"loading"},Pn=G({__name:"ProjectView",setup(k){const r=de(),t=N(),o=ue(),a=me(),g=M(null),c=M(null),y=M(window.innerHeight),p=M(!1),d=M(!0),i=M(!0),l=z(()=>y.value-(c.value?.clientHeight??0)),m=z(()=>g.value?.filteredImages.map(F=>F.id));let b=navigator.userAgent.indexOf("Mac OS X")!==-1;async function C(){d.value=!1,await Z(),d.value=!0}J(async()=>{if(console.log(o.isProjectLoaded),!o.isProjectLoaded){Fe.push("/");return}r.init(),Z(()=>{window.addEventListener("resize",E),E()}),window.addEventListener("keydown",F=>{F.key=="Control"&&(U.ctrl=!0),F.key=="Alt"&&(b&&(U.ctrl=!0),U.alt=!0),F.key=="Shift"&&(U.shift=!0),F.key=="ArrowLeft"&&(U.left=!0),F.key=="ArrowRight"&&(U.right=!0,console.log("keeeyy")),F.key=="Z"&&U.ctrl&&t.redo(),F.key=="z"&&U.ctrl&&t.undo()}),window.addEventListener("keyup",F=>{F.key=="Control"&&(U.ctrl=!1),F.key=="Alt"&&(b&&(U.ctrl=!1),U.alt=!1),F.key=="Shift"&&(U.shift=!1),F.key=="ArrowLeft"&&(U.left=!1),F.key=="ArrowRight"&&(U.right=!1)}),window.addEventListener("mousemove",F=>{U.ctrl=F.ctrlKey,U.alt=F.altKey,U.shift=F.shiftKey,b&&(U.ctrl=U.ctrl||U.alt)})}),Me(()=>{window.removeEventListener("resize",E),de().clear()});function E(){y.value=window.innerHeight,p.value=!0}function h(){o.showModal(ee.EXPORT,m)}function w(){Fe.push("/")}function V(){g.value&&g.value.updateScrollerWidth()}return(F,L)=>d.value?(s(),n("div",Cn,[g.value&&!g.value.imageList?(s(),I(ht,{key:0,tutorial:"project"})):f("",!0),e("div",In,[e("div",Vn,[u(t).isLoaded?u(t).isLoaded?(s(),n(O,{key:1},[e("div",null,[v(Vs,{onExport:L[0]||(L[0]=j=>h()),onToggle:V})]),e("div",Mn,[e("div",{class:"ms-1",ref_key:"navElem",ref:c},[v(ln,{"re-render":C,filterOpen:i.value,"onUpdate:filterOpen":L[1]||(L[1]=j=>i.value=j)},null,8,["filterOpen"])],512),p.value?(s(),n("div",Tn)):f("",!0),v(Re,{id:u(a).mainTab},{default:_(({tab:j})=>[v(Ya,{tab:j,height:l.value,ref_key:"mainViewRef",ref:g,"filter-open":i.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):u(o).isProjectLoaded?(s(),n("div",En,L[2]||(L[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(s(),n("div",zn,[e("div",Fn,[e("div",null,x(F.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:w,style:{"font-size":"50px",cursor:"pointer"}})])])):(s(),n("div",{key:0,class:"d-flex flex-column w-100",style:Y({height:y.value+"px"})},[v(Sn,{class:"flex-grow-1"})],4))])])])):f("",!0)}}),Ln=R(Pn,[["__scopeId","data-v-a9d999f0"]]);export{Ln as default};
