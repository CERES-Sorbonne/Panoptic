import{d as P,f as N,r as S,c as C,g as oe,o as s,a as n,b as t,w as se,v as re,F,i as U,m as b,x as ie,t as $,P as ce,l as V,q as k,n as D,D as Z,y as ze,_ as G,z as de,A as H,B as Ce,j as d,k as h,C as Me,E as M,G as Le,H as De,I as Ne,J as Ge,K as je,p as Q,e as W,L as $e,N as O,O as ye,s as K,T as Re,Q as Ve,R as q,S as ve,U as ke,u as he,M as ne,V as Ue,W as qe,X as xe,Y as Fe,Z as He,$ as te,a0 as J,a1 as Ae,a2 as ue,a3 as Be,a4 as Ke,a5 as Oe,a6 as Qe,a7 as We,a8 as Ye,a9 as le,aa as Xe,ab as Je,ac as Ze,ad as ee,ae as et,af as tt,ag as st,ah as ot,h as we,ai as X,aj as at}from"./index-2252fcdf.js";const lt={class:"mb-1 ps-2 pe-2"},nt=["onClick"],be=P({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(i,{emit:u}){const e=N(),o=i,_=u,g=S(null),m=S(""),f=C(()=>{let v=e.propertyList;return o.ignoreIds&&(v=v.filter(p=>!o.ignoreIds.includes(p.id))),v=v.filter(p=>p.id!=ce.id),v.filter(p=>p.name.includes(m.value))});return oe(()=>g.value.focus()),(v,p)=>(s(),n("div",null,[t("div",lt,[se(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:g,"onUpdate:modelValue":p[0]||(p[0]=a=>m.value=a)},null,512),[[re,m.value]])]),(s(!0),n(F,null,U(f.value,a=>(s(),n("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:l=>_("select",a.id)},[b(ie,{type:a.type,class:"me-2"},null,8,["type"]),t("a",null,$(a.name),1)],8,nt))),256))]))}}),it=["disabled"],rt={class:"m-0 p-1"},dt=["onClick"],ut=P({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(i,{emit:u}){const e=N(),o=i,_=u,g=S(null),m=C(()=>e.data.properties[o.propertyId]),f=C(()=>ze(m.value.type));async function v(p){_("update:modelValue",p),g.value.hide()}return(p,a)=>(s(),V(Z,{onHide:a[0]||(a[0]=l=>_("hide")),ref_key:"dropdownElem",ref:g,parent:o.parent},{button:k(()=>[t("div",{class:D(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,$(p.$t("modals.filters.operators."+o.modelValue)),1)],10,it)]),popup:k(()=>[t("div",rt,[(s(!0),n(F,null,U(f.value,l=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:r=>v(l)},[t("a",null,$(p.$t("modals.filters.operators."+l)),1)],8,dt))),256))])]),_:1},8,["parent"]))}});const pt=G(ut,[["__scopeId","data-v-29ed354e"]]),ct=i=>(Q("data-v-3be6ab26"),i=i(),W(),i),_t={class:"m-0 p-0"},mt={key:1},vt={class:"d-flex mode-header"},gt={class:"me-3"},ft=ct(()=>t("div",{class:"flex-fill"},null,-1)),yt={key:0,class:"me-2",style:{width:"100%"}},ht=P({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(i){const u=N(),e=i,o=S(null),_=S(null),g=S(null),m=S(0),f=S(-1),v=S(null),p=C(()=>e.filterId!=null?e.filterId:f.value),a=C(()=>{if(!(p.value==null||p.value==-1))return e.manager.filterIndex[p.value]}),l=C(()=>a.value==null?void 0:u.data.properties[a.value.propertyId]);function r(){m.value=e.mode,e.mode==2&&e.filterId==null&&x(e.propertyId)}function c(){o.value&&o.value.hide()}function y(){m.value=0}function I(){c(),e.manager.deleteFilter(p.value),e.manager.update(!0)}function x(j){let z=e.manager.addNewFilter(j,e.parentId);e.manager.update(!0),f.value=z.id,m.value=2}function w(j){e.manager.updateFilter(p.value,{operator:j}),e.manager.update(!0),_.value&&_.value.focus()}function E(){e.manager.updateFilter(p.value,{value:v.value}),e.manager.update(!0)}function T(){if(!a.value)return;const j=u.data.properties[a.value.propertyId];if(Ge(j.type))return;const z=v.value??je(j.type);a.value.value!=z&&E()}function A(){a.value&&(v.value=a.value.value)}return oe(A),H(()=>{var j;return(j=a.value)==null?void 0:j.value},()=>A()),(j,z)=>(s(),V(Z,{ref_key:"dropdownElem",ref:o,onShow:r,onHide:y,parent:e.parent},{button:k(()=>[t("div",_t,[Ce(j.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:g},[m.value!=0?(s(),n(F,{key:0},[m.value==1?(s(),V(be,{key:0,onSelect:x,"ignore-ids":[d(ce).folders]},null,8,["ignore-ids"])):h("",!0),m.value==2?(s(),n("div",mt,[t("div",vt,[t("div",gt,$(l.value.name),1),b(pt,{"property-id":a.value.propertyId,"model-value":a.value.operator,"onUpdate:modelValue":w,parent:g.value},null,8,["property-id","model-value","parent"]),ft,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:I})])]),d(Me)(a.value.operator)?(s(),n("div",yt,[l.value.type==d(M).multi_tags||l.value.type==d(M).tag?(s(),V(Le,{key:0,modelValue:v.value,"onUpdate:modelValue":[z[0]||(z[0]=L=>v.value=L),E],"auto-focus":!0,property:d(u).data.properties[a.value.propertyId],ref_key:"inputElem",ref:_,onHide:c},null,8,["modelValue","property"])):l.value.type==d(M).color?(s(),V(De,{key:1,property:l.value,modelValue:v.value,"onUpdate:modelValue":[z[1]||(z[1]=L=>v.value=L),z[2]||(z[2]=()=>{c(),T()})]},null,8,["property","modelValue"])):(s(),V(Ne,{key:2,"no-html":!0,modelValue:v.value,"onUpdate:modelValue":z[3]||(z[3]=L=>v.value=L),width:-1,"min-height":20,"no-nl":d(u).data.properties[a.value.propertyId].type==d(M).number,"url-mode":d(u).data.properties[a.value.propertyId].type==d(M).url,"only-number":d(u).data.properties[a.value.propertyId].type==d(M).number,onBlur:T,"auto-focus":!0,ref_key:"inputElem",ref:_},null,8,["modelValue","no-nl","url-mode","only-number"]))])):h("",!0)])):h("",!0)],64)):h("",!0)],512)]),_:3},8,["parent"]))}});const pe=G(ht,[["__scopeId","data-v-3be6ab26"]]),ae=i=>(Q("data-v-66fff643"),i=i(),W(),i),bt={class:"d-flex flex-row"},$t={key:1,class:"d-flex",style:{width:"150px"}},kt={class:"flex-grow-1"},xt={key:1,style:{"padding-top":"1px"}},wt={style:{width:"20px","margin-top":"2px"},class:"text-center"},It=ae(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),St={class:"text-center",style:{width:"20px","margin-top":"2px"}},Ct=ae(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Mt=ae(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Vt={key:0,class:"ms-3 pt-1"},Ft=ae(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Ot=ae(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Et=ae(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Pt=ae(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Tt={key:1},zt=P({__name:"PropertyOptions",props:{property:Object},setup(i){const u=N(),e=u.getTabManager(),o=i,_=S(!1),g=S(!1),m=S(""),f=S(!1),v=C(()=>u.getTab()),p=C(()=>v.value.visibleProperties[o.property.id]==!0),a=C(()=>e.collection.filterManager.state.filter.filters.some(L=>!L.isGroup&&L.propertyId==o.property.id)),l=C(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),r=C(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),c=C(()=>{if(a.value)return e.collection.filterManager.state.filter.filters.find(L=>!L.isGroup&&L.propertyId==o.property.id).id}),y=()=>e.collection.filterManager,I=C(()=>e.getSha1Mode());function x(){p.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function w(){_.value?_.value=!1:(_.value=!0,m.value=o.property.name),g.value=!1}function E(){o.property.type!=M.tag&&o.property.type!=M.multi_tags||(g.value?g.value=!1:g.value=!0,_.value=!1)}function T(){r.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function A(){l.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function j(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&u.deleteProperty(o.property.id)}function z(){m.value!=""&&u.updateProperty(o.property.id,m.value)}return H(()=>o.property,()=>{_.value=!1}),(L,R)=>(s(),n("div",{class:D(f.value?"hover-light":"")},[t("div",bt,[_.value?h("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:w},[b(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:R[0]||(R[0]=B=>f.value=!0),onMouseleave:R[1]||(R[1]=B=>f.value=!1)},null,8,["type"]),t("span",null,$(o.property.name),1)])),_.value?(s(),n("div",$t,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:w,onMouseenter:R[2]||(R[2]=B=>f.value=!0),onMouseleave:R[3]||(R[3]=B=>f.value=!1)},null,32)]),t("div",kt,[o.property.id>=0?se((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":R[4]||(R[4]=B=>m.value=B),onChange:z},null,544)),[[re,m.value]]):(s(),n("span",xt,[b(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,$(o.property.name),1)]))])])):h("",!0),t("div",wt,[o.property.mode==d($e).id?(s(),V(O,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[It]),_:1})):h("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:x,class:"btn-icon text-center"},[I.value&&o.property.mode==d($e).id?(s(),V(O,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:R[5]||(R[5]=ye(()=>{},["stop"]))})]),_:1})):(s(),V(O,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:D("bi bi-eye text-"+(p.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",St,[o.property.type==d(M).tag||o.property.type==d(M).multi_tags?(s(),n("div",{key:0,onClick:E,style:{cursor:"pointer"}},[g.value?(s(),V(O,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Ct]),_:1})):(s(),V(O,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Mt]),_:1}))])):h("",!0)])]),t("div",null,[_.value?(s(),n("div",Vt,[t("div",{class:D(["options hover-light",a.value?" text-primary":""])},[b(pe,{manager:y(),"filter-id":c.value,mode:2,"property-id":i.property.id},{default:k(()=>[Ft,K($(L.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:D(["options hover-light",r.value?" text-primary":""]),onClick:T},[Ot,K($(L.$t("main.menu.sort.title")),1)],2),t("div",{class:D(["options hover-light",l.value?" text-primary":""]),onClick:A},[Et,K($(L.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),n("div",{key:0,class:"options hover-light",onClick:j},[Pt,K($(L.$t("main.nav.properties.delete_property")),1)])):h("",!0)])):g.value?(s(),n("div",Tt,[b(Re,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):h("",!0)])],2))}});const Ie=G(zt,[["__scopeId","data-v-66fff643"]]),Lt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Dt={class:"p-2"},Nt=["onClick"],Gt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),jt=P({__name:"FolderOptionDropdown",props:{folder:{}},setup(i){const u=N(),e=i;function o(){u.reImportFolder(e.folder.id)}return(_,g)=>(s(),V(Z,{teleport:!0},{button:k(()=>[Lt]),popup:k(({hide:m})=>[t("div",Dt,[t("div",{class:"base-hover p-1",onClick:f=>{o(),m()}},[Gt,K(" Re import")],8,Nt)])]),_:1}))}}),Rt=["onMouseenter"],Ut=["onClick"],qt={class:"text-secondary"},Ht=["onClick"],At=P({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(i){const u=N(),e=i,o=S(null),_=C(()=>{let a={};const l=new Set(e.filterManager.state.folders);return e.folders.map(r=>r.id).forEach(r=>{l.has(r)&&(a[r]=!0)}),a}),g=C(()=>{let a={};return e.folders.map(l=>l.id).forEach(l=>{e.visibleFolders[l]&&(a[l]=!0)}),a}),m=C(()=>{let a={};return e.folders.forEach(l=>{let r=[];_.value[l.id]&&r.push("selected"),a[l.id]=r.join(" ")}),a});function f(a){let l=e.visibleFolders;l[a]?delete l[a]:l[a]=!0}function v(a){let l=new Set(e.filterManager.state.folders);const r=l.has(a),c=u.data.folders[a].parent!=null&&l.has(u.data.folders[a].parent);r&&!c?(l.delete(a),ve(a).forEach(y=>l.delete(y.id))):(p(a,l),l.add(a),ve(a).forEach(y=>l.add(y.id)),ke(u.data.folders[a]).forEach(y=>l.delete(y.id))),e.filterManager.setFolders(Array.from(l)),e.filterManager.update(!0)}function p(a,l){const r=ke(u.data.folders[a]);let c;for(let y of r)if(l.has(y.id))c=y;else break;c!=null&&ve(c.id).forEach(y=>l.delete(y.id))}return(a,l)=>{const r=Ve("FolderList2",!0);return s(),n("ul",{class:D(e.root?"tree":""),style:q(e.root?"padding-left:0px;":"")},[(s(!0),n(F,null,U(i.folders,c=>(s(),n("li",{style:q(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:y=>o.value=c.id,onMouseleave:l[0]||(l[0]=y=>o.value=null)},[t("summary",{class:D(m.value[c.id]),onClick:y=>v(c.id)},[K($(c.name)+" ",1),t("span",qt,$(c.count),1)],10,Ut),c.children&&c.children.length>0?(s(),n("i",{key:0,onClick:y=>f(c.id),class:D("bi bi-chevron-"+(g.value[c.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Ht)):h("",!0),t("span",{class:D(o.value===c.id?"visible-option":"invisible-option")},[b(jt,{folder:c,style:{display:"inline-block"}},null,8,["folder"])],2),c.children&&c.children.length>0&&g.value[c.id]?(s(),V(r,{key:1,folders:c.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):h("",!0)],44,Rt))),256))],6)}}});const Bt=G(At,[["__scopeId","data-v-9f26453b"]]),Y=i=>(Q("data-v-06f127b5"),i=i(),W(),i),Kt={class:"menu overflow-scroll"},Qt={class:""},Wt={class:"m-0",style:{padding:"4px 0px 4px 8px"}},Yt={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},Xt=Y(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),Jt=[Xt],Zt=Y(()=>t("div",{class:"custom-hr"},null,-1)),es={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ts={class:"d-flex align-items-center"},ss=Y(()=>t("i",{class:"bi bi-plus"},null,-1)),os={class:"overflow-scroll"},as={key:0,class:"p-2"},ls=Y(()=>t("div",{class:"custom-hr"},null,-1)),ns={key:0,class:"float-end"},is={class:"text-center"},rs={class:"w-100 text-center",style:{"font-size":"10px"}},ds={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},us={key:1,class:"p-2"},ps={class:"w-100 text-center",style:{"font-size":"10px"}},cs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},_s=Y(()=>t("div",{class:"custom-hr"},null,-1)),ms={class:"p-2 mt-0"},vs={class:"d-flex"},gs=Y(()=>t("span",{class:"flex-grow-1"},null,-1)),fs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},ys=Y(()=>t("span",{class:"sr-only"},null,-1)),hs=[ys],bs={key:1,class:"me-3"},$s={class:"me-3"},ks={key:0,class:"mt-2"},xs={key:0,class:"property-item"},ws=Y(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Is=Y(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ss=Y(()=>t("div",{class:"custom-hr"},null,-1)),Cs={class:"p-2 mt-0"},Ms={key:0,class:"mt-2"},Vs={key:0,class:"property-item"},Fs=P({__name:"Menu",emits:["export"],setup(i,{emit:u}){const e=N(),o=he(),_=e.getTabManager(),g=S(!1),m=S(null),f=S(!1),v=async l=>{f.value=!0,console.log(f.value);const r=l.target.files[0];await e.uploadPropFile(r),f.value=!1};function p(){o.showModal(ne.FOLDERSELECTION,{callback:a,mode:"images"})}function a(l){l&&e.addFolder(l)}return H(()=>e.status.import.to_import,()=>g.value=!0),(l,r)=>(s(),n("div",Kt,[t("div",Qt,[t("div",null,[t("div",Wt,[t("div",Yt,[t("div",{class:"flex-grow-1",onClick:r[0]||(r[0]=()=>{})},$(d(o).data.status.selectedProject.name),1),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:r[1]||(r[1]=c=>d(o).closeProject())},Jt)])]),Zt,t("div",es,[t("div",ts,[t("div",null,[t("b",null,$(l.$t("main.nav.folders.title")),1)]),t("div",{class:"ms-auto plus",onClick:p},[b(O,{message:"main.nav.folders.add"},{default:k(()=>[ss]),_:1})])]),t("div",os,[d(e).getTab()?(s(),V(Bt,{key:0,folders:d(e).folderRoots,"filter-manager":d(_).collection.filterManager,"visible-folders":d(_).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):h("",!0)])]),d(e).status.import.to_import!=null&&d(e).status.import.to_import>0&&g.value?(s(),n("div",as,[ls,d(e).status.import.done?(s(),n("div",ns,[t("i",{class:"bi bi-x base-hover",onClick:r[2]||(r[2]=c=>g.value=!1)})])):h("",!0),t("div",is,[t("b",null,$(l.$t("main.menu.import_status_title")),1)]),t("div",rs,$(d(e).status.import.imported)+" / "+$(d(e).status.import.to_import)+" importées ",1),d(e).status.import.to_import>0?(s(),n("div",ds,[t("div",{class:"progress-bar",style:q(`width: ${d(e).status.import.imported/d(e).status.import.to_import*100}%`)},null,4)])):h("",!0)])):h("",!0),d(e).status.import.to_import!=null&&d(e).status.import.to_import>0&&g.value?(s(),n("div",us,[t("div",ps,$(d(e).status.import.computed)+" / "+$(d(e).status.import.to_import)+" computed ",1),d(e).status.import.to_import>0?(s(),n("div",cs,[t("div",{class:"progress-bar",style:q(`width: ${d(e).status.import.computed/d(e).status.import.to_import*100}%`)},null,4)])):h("",!0)])):h("",!0),_s,t("div",ms,[t("div",vs,[b(O,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,$(l.$t("main.nav.properties.title")),1)]),_:1}),gs,f.value?(s(),n("span",fs,hs)):(s(),n("span",bs,[t("input",{type:"file",ref_key:"inputFile",ref:m,accept:"text/csv",onChange:v,hidden:""},null,544),b(O,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-file-earmark-arrow-up btn-icon text-secondary",onClick:r[3]||(r[3]=c=>m.value.click())})]),_:1})])),t("span",$s,[b(O,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-down btn-icon text-secondary",onClick:r[4]||(r[4]=c=>d(o).showModal(d(ne).EXPORT,void 0))})]),_:1})])]),d(e).status.loaded?(s(),n("div",ks,[(s(!0),n(F,null,U(d(e).data.properties,c=>(s(),n(F,null,[c.id>=0?(s(),n("div",xs,[b(Ie,{property:c},null,8,["property"])])):h("",!0)],64))),256)),ws,t("div",{onClick:r[5]||(r[5]=c=>d(o).showModal(d(ne).PROPERTY,void 0)),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Is,t("span",null,$(l.$t("main.nav.properties.add_property")),1)])])):h("",!0)]),Ss,t("div",Cs,[b(O,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,$(l.$t("main.nav.computed.title")),1)]),_:1}),d(e).status.loaded?(s(),n("div",Ms,[(s(!0),n(F,null,U(d(e).data.properties,c=>(s(),n(F,null,[c.id<0?(s(),n("div",Vs,[b(O,{pos:"bottom",message:"main.nav.computed."+Math.abs(c.id).toString()+"_tooltip"},{default:k(()=>[b(Ie,{property:c},null,8,["property"])]),_:2},1032,["message"])])):h("",!0)],64))),256))])):h("",!0)])])])]))}});const Os=G(Fs,[["__scopeId","data-v-06f127b5"]]),Es={class:"text-nowrap text-secondary"},Se=P({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(i){const u=N(),e=i,o=C(()=>u.data.properties[e.propertyId].tags);return(_,g)=>(s(),n("div",Es,[e.value&&e.value.length>0?(s(!0),n(F,{key:0},U(e.value,m=>(s(),n("span",null,[b(Ue,{tag:o.value[m].value,color:o.value[m].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),n(F,{key:1},[K(" Add Tags... ")],64))]))}}),Ps={key:0},Ts={key:1},zs={key:2},Ls={key:3},Ds={key:0,class:"bi bi-square"},Ns={key:1,class:"bi bi-check-square"},Gs={key:5},js={key:6},Rs={key:7},Us={key:8},qs={key:9},Hs={key:10},As={key:11},Bs={key:12},Ks={key:13},Qs={key:1,class:"text-secondary"},Ws=P({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(i){const u=i,e=C(()=>{if(u.value==null)return"white";let _=Number(u.value);return isNaN(_)||_>12?"gray":qe[_].color}),o=C(()=>[M._ahash,M._folders,M._sha1,M.string].indexOf(u.property.type)!==-1?'"'+u.value+'"':u.value);return(_,g)=>i.value!=null?(s(),n(F,{key:0},[u.property.type==d(M)._ahash?(s(),n("div",Ps,$(o.value),1)):h("",!0),u.property.type==d(M)._folders?(s(),n("div",Ts,$(o.value),1)):h("",!0),u.property.type==d(M)._sha1?(s(),n("div",zs,$(o.value),1)):h("",!0),u.property.type==d(M).checkbox?(s(),n("div",Ls,[o.value?(s(),n("i",Ds)):(s(),n("i",Ns))])):h("",!0),u.property.type==d(M).color?(s(),n("div",{key:4,style:q({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):h("",!0),u.property.type==d(M).date?(s(),n("div",Gs,$(o.value),1)):h("",!0),u.property.type==d(M).image_link?(s(),n("div",js)):h("",!0),u.property.type==d(M).multi_tags?(s(),n("div",Rs,[b(Se,{"property-id":u.property.id,value:o.value},null,8,["property-id","value"])])):h("",!0),u.property.type==d(M).number?(s(),n("div",Us,$(o.value),1)):h("",!0),u.property.type==d(M).path?(s(),n("div",qs,$(o.value),1)):h("",!0),u.property.type==d(M).string?(s(),n("div",Hs,$(o.value),1)):h("",!0),u.property.type==d(M)._id||u.property.type==d(M)._height||u.property.type==d(M)._width?(s(),n("div",As,$(o.value),1)):h("",!0),u.property.type==d(M).tag?(s(),n("div",Bs,[b(Se,{"property-id":u.property.id,value:o.value},null,8,["property-id","value"])])):h("",!0),u.property.type==d(M).url?(s(),n("div",Ks,$(o.value),1)):h("",!0)],64)):(s(),n("span",Qs,"..."))}}),Ys={class:"d-flex hover-light ps-1 overflow-hidden"},Xs={class:"m-0 p-0 me-2 text-nowrap"},Js={key:0,class:"m-0 p-0 me-2",style:{width:"150px"}},Zs=P({__name:"FilterPreview",props:{filter:Object},setup(i){const u=N(),e=i,o=C(()=>u.data.properties[e.filter.propertyId]);return(_,g)=>(s(),n("td",Ys,[t("div",Xs,$(_.$t("modals.filters.operators."+e.filter.operator)),1),d(Me)(e.filter.operator)?(s(),n("div",Js,[b(Ws,{property:o.value,value:e.filter.value},null,8,["property","value"])])):h("",!0)]))}});const eo=G(Zs,[["__scopeId","data-v-bdac3fdc"]]),to={class:"m-0 base-btn",style:{padding:"1px 2px"}},so={class:"p-2"},oo=P({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(i,{emit:u}){const e=N(),o=i,_=u,g=S(null);function m(f){g.value.hide(),_("update:modelValue",e.data.properties[f])}return(f,v)=>(s(),V(Z,{ref_key:"dropdownElem",ref:g,"auto-focus":!1},{button:k(()=>[t("div",to,[b(ie,{type:o.modelValue.type},null,8,["type"]),K(" "+$(o.modelValue.name),1)])]),popup:k(()=>[t("div",so,[b(be,{modelValue:o.modelValue,"onUpdate:modelValue":v[0]||(v[0]=p=>o.modelValue=p),onSelect:m,"ignore-ids":[d(ce).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),_e=i=>(Q("data-v-b71e9f72"),i=i(),W(),i),ao={class:"filter-group"},lo={class:"table table-sm"},no={class:"align-top ps-2"},io={key:0,class:"m-0 p-0"},ro={class:"p-0 hover-light ps-1",style:{width:"50px",cursor:"pointer","border-radius":"3px"}},uo={class:""},po=["onClick"],co=_e(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),_o={key:2,class:"text-secondary"},mo={key:0,class:"p-0 m-0 ps-2"},vo={key:1,class:"p-0 m-0 ps-2"},go={class:"border rounded"},fo={class:""},yo=["onClick"],ho=_e(()=>t("i",{class:"bi bi-trash"},null,-1)),bo=[ho],$o={class:"d-flex text-secondary ms-2"},ko={class:"add-options hover-light"},xo=_e(()=>t("i",{class:"bi bi-plus"},null,-1)),wo=_e(()=>t("i",{class:"bi bi-plus"},null,-1)),Io=P({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(i,{emit:u}){const e=N(),o=i,_=C(()=>o.filter),g=C(()=>_.value.filters),m=C(()=>{let l=255-(_.value.depth+1)*5;return`background: rgb(${l},${l},${l});`});function f(l,r){o.manager.updateFilter(l,{propertyId:r}),o.manager.update(!0)}function v(l){o.manager.deleteFilter(l.id),o.manager.update(!0)}function p(l){o.manager.addNewFilterGroup(l),o.manager.update(!0)}function a(l,r){o.manager.updateFilterGroup(l,r),o.manager.update(!0)}return(l,r)=>{const c=Ve("FilterGroupInput",!0);return s(),n("div",ao,[t("table",lo,[(s(!0),n(F,null,U(g.value,(y,I)=>(s(),n("tr",null,[t("td",no,[I==0?(s(),n("div",io,$(l.$t("modals.filters.where")),1)):I==1?(s(),V(Z,{key:1},{button:k(()=>[t("div",ro,[t("span",uo,$(l.$t("modals.filters."+_.value.groupOperator)),1)])]),popup:k(({hide:x})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:x},[t("div",{class:"base-btn",onClick:r[0]||(r[0]=w=>a(_.value.id,d(xe).and))},$(l.$t("modals.filters.and")),1),co,t("div",{class:"base-btn",onClick:r[1]||(r[1]=w=>a(_.value.id,d(xe).or))},$(l.$t("modals.filters.or")),1)],8,po)]),_:1})):(s(),n("span",_o,$(_.value.groupOperator),1))]),y.propertyId!==void 0?(s(),n("td",mo,[b(oo,{"model-value":d(e).data.properties[y.propertyId],"onUpdate:modelValue":x=>f(y.id,x.id)},null,8,["model-value","onUpdate:modelValue"])])):h("",!0),y.propertyId!==void 0?(s(),n("td",vo,[b(pe,{class:"flex-grow-1",manager:i.manager,mode:2,"parent-id":_.value.id,"filter-id":y.id,parent:o.parent},{default:k(()=>[b(eo,{filter:y},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),n("td",{key:2,colspan:"3",style:q(m.value)},[t("div",go,[b(c,{filter:y,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",fo,[t("span",{class:"base-btn",onClick:x=>v(y)},bo,8,yo)])]))),256))]),t("div",$o,[b(pe,{manager:o.manager,"parent-id":_.value.id},{default:k(()=>[t("div",ko,[xo,K($(l.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:r[2]||(r[2]=y=>p(_.value.id))},[wo,K($(l.$t("modals.filters.new_group")),1)])])])}}});const So=G(Io,[["__scopeId","data-v-b71e9f72"]]),Co={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Mo={key:0,class:"or-separator"},Vo={key:0,class:"m-1 p-0"},Fo=P({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(i,{emit:u}){const e=N(),o=i,_=S(null),g=S(null),m=C(()=>{let v=f(o.manager.state.filter),p={};return v.forEach(a=>p[a.propertyId]=a),Object.values(p)});function f(v){let p=[];for(let a of v.filters)a.isGroup?p.push(...f(a)):p.push(a);return p}return H(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&g.value.hide()}),(v,p)=>(s(),V(Z,{ref_key:"dropdownElem",ref:g},{button:k(()=>[t("div",null,[m.value.length?(s(),n("div",Co,[(s(!0),n(F,null,U(m.value,(a,l)=>(s(),n("div",null,[l>0?(s(),n("span",Mo,"|")):h("",!0),a.propertyId==d(ce).id?(s(),V(ie,{key:1,type:d(e).data.properties[a.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):h("",!0),t("span",null,$(d(e).data.properties[a.propertyId].name),1)]))),256))])):h("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:_},[Object.keys(d(e).data.properties).length>0?(s(),n("div",Vo,[b(So,{filter:o.manager.state.filter,manager:o.manager,parent:_.value},null,8,["filter","manager","parent"])])):h("",!0)],512)]),_:1},512))}});const Oo=G(Fo,[["__scopeId","data-v-76c39275"]]),Eo=i=>(Q("data-v-4759a81b"),i=i(),W(),i),Po={class:"d-flex flex-row filter-form"},To={class:"pt-1 pb-1"},zo=Eo(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),Lo=P({__name:"FilterForm",props:{manager:de},setup(i){const u=i;return(e,o)=>(s(),n("div",Po,[t("div",To,$(e.$t("main.menu.filters"))+": ",1),b(Oo,{"model-value":u.manager.filter,manager:u.manager},null,8,["model-value","manager"]),b(pe,{manager:u.manager,class:"p-1"},{default:k(()=>[zo]),_:1},8,["manager"])]))}});const Do=G(Lo,[["__scopeId","data-v-4759a81b"]]),No=i=>(Q("data-v-e5b49562"),i=i(),W(),i),Go=No(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),jo={class:"p-1"},Ro=P({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(i,{emit:u}){const e=i,o=u,_=S(null);return(g,m)=>(s(),V(Z,{ref_key:"dropdownElem",ref:_,"auto-focus":!1},{button:k(()=>[Go]),popup:k(()=>[t("div",jo,[b(be,{onSelect:m[0]||(m[0]=f=>{o("select",f),_.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ee=G(Ro,[["__scopeId","data-v-e5b49562"]]),Uo={class:"base-hover ps-1 pe-1"},qo={class:"main"},Ho=["onClick"],Ao=P({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{emit:u}){const e=i,o=u,_=Object.values(Fe);function g(m){o("update:modelValue",m)}return(m,f)=>(s(),V(Z,null,{button:k(()=>[t("div",Uo,$(e.modelValue),1)]),popup:k(({hide:v})=>[t("div",qo,[(s(!0),n(F,null,U(d(_),p=>(s(),n("div",{class:"base-hover option",onClick:a=>{g(p),v()}},$(p),9,Ho))),256))])]),_:1}))}});const Bo=G(Ao,[["__scopeId","data-v-cc9d0d61"]]),Ko=i=>(Q("data-v-a27bea28"),i=i(),W(),i),Qo=Ko(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),Wo={class:""},Yo={class:"d-flex ipt"},Xo={class:"ms-2",min:"1"},Jo=P({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(i,{emit:u}){const e=i,o=u,_=S(1),g=S(Fe.Year);function m(){e.option.stepSize==_.value&&e.option.stepUnit==g.value||o("change",{stepSize:_.value,stepUnit:g.value})}function f(){_.value=e.option.stepSize??1,g.value=e.option.stepUnit}return H(()=>e.option,f),oe(f),H(_,()=>{(_.value<1||_.value==null||isNaN(_.value))&&(_.value=1)}),(v,p)=>(s(),V(Z,{onHide:m},{button:k(()=>[Qo]),popup:k(({hide:a,focus:l})=>[t("div",Wo,[t("div",Yo,[t("div",null,[se(t("input",{type:"number","onUpdate:modelValue":p[0]||(p[0]=r=>_.value=r)},null,512),[[re,_.value]])]),t("div",Xo,[b(Bo,{modelValue:g.value,"onUpdate:modelValue":p[1]||(p[1]=r=>g.value=r),onHide:l},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Zo=G(Jo,[["__scopeId","data-v-a27bea28"]]),ea={class:"d-flex flex-row group-form"},ta={class:"pt-1 pb-1"},sa={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},oa={key:0,class:"bi bi-chevron-right smaller"},aa=["onClick"],la=["onClick"],na=["onClick"],ia=["onClick"],ra=["onClick"],da=["onClick"],ua=["onClick"],pa=["onClick"],ca=["onClick"],_a={key:5,class:"sm-btn"},ma={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},va=P({__name:"GroupForm",props:{isLoading:Boolean,manager:He},setup(i){const u=N(),e=i;function o(a){e.manager.setGroupOption(a),e.manager.update(!0)}function _(a){e.manager.delGroupOption(a),e.manager.update(!0)}function g(a,l){e.manager.setGroupOption(a,{direction:l}),e.manager.sortGroups(!0)}function m(a,l){e.manager.setGroupOption(a,{type:l}),e.manager.sortGroups(!0)}function f(a,l){e.manager.setGroupOption(a,l),e.manager.update(!0)}const v=C(()=>e.manager.state.groupBy.map(a=>u.data.properties[a])),p=C(()=>{const a=[];return e.manager.state.groupBy.forEach(l=>{a.push({option:e.manager.state.options[l],property:u.data.properties[l]})}),a});return(a,l)=>(s(),n("div",ea,[t("div",ta,$(a.$t("main.menu.groupby"))+": ",1),v.value.length?(s(),n("div",sa,[(s(!0),n(F,null,U(p.value,(r,c)=>(s(),n(F,null,[c>0?(s(),n("i",oa)):h("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:y=>_(r.property.id)},$(r.property.name),9,aa),r.option.type==d(te).Size?(s(),V(O,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[r.option.direction==d(J).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:y=>m(r.property.id,d(te).Property)},null,8,la)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:y=>m(r.property.id,d(te).Property)},null,8,na))]),_:2},1024)):(s(),V(O,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[r.property.type==d(M).number?(s(),n(F,{key:0},[r.option.direction==d(J).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:y=>m(r.property.id,d(te).Size)},null,8,ia)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:y=>m(r.property.id,d(te).Size)},null,8,ra))],64)):(s(),n(F,{key:1},[r.option.direction==d(J).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:y=>m(r.property.id,d(te).Size)},null,8,da)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:y=>m(r.property.id,d(te).Size)},null,8,ua))],64))]),_:2},1024)),r.option.direction==d(J).Ascending?(s(),V(O,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:y=>g(r.property.id,d(J).Descending)},null,8,pa)]),_:2},1024)):(s(),V(O,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:y=>g(r.property.id,d(J).Ascending)},null,8,ca)]),_:2},1024)),r.property.type==d(M).date?(s(),n("div",_a,[b(Zo,{option:r.option,onChange:y=>f(r.property.id,y)},null,8,["option","onChange"])])):h("",!0)],64))),256)),e.isLoading?(s(),n("i",ma)):h("",!0)])):h("",!0),b(Ee,{"group-ids":e.manager.state.groupBy,onSelect:l[0]||(l[0]=r=>o(r))},null,8,["group-ids"])]))}});const ga=G(va,[["__scopeId","data-v-3971e969"]]),fa={class:"d-flex flex-row sort-form"},ya={class:"pt-1 pb-1"},ha={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},ba={key:0,class:"bi bi-chevron-right smaller"},$a=["onClick"],ka=["onClick"],xa=["onClick"],wa=P({__name:"SortForm",props:{manager:Ae},setup(i){const u=N(),e=i,o=C(()=>e.manager.state.sortBy.map(v=>({propertyId:v,direction:e.manager.state.options[v].direction}))),_=C(()=>o.value.map(v=>v.propertyId));function g(v){e.manager.setSort(v),e.manager.update(!0)}function m(v){e.manager.delSort(v),e.manager.update(!0)}function f(v,p){e.manager.setSort(v,{direction:p}),e.manager.update(!0)}return(v,p)=>(s(),n("div",fa,[t("div",ya,$(v.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),n("div",ha,[(s(!0),n(F,null,U(o.value,(a,l)=>(s(),n(F,null,[l>0?(s(),n("i",ba)):h("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:r=>m(a.propertyId)},$(d(u).data.properties[a.propertyId].name),9,$a),a.direction==d(J).Ascending?(s(),V(O,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:r=>f(a.propertyId,d(J).Descending)},null,8,ka)]),_:2},1024)):(s(),V(O,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:r=>f(a.propertyId,d(J).Ascending)},null,8,xa)]),_:2},1024))],64))),256))])):h("",!0),b(Ee,{"group-ids":_.value,onSelect:p[0]||(p[0]=a=>g(a))},null,8,["group-ids"])]))}});const Ia=G(wa,[["__scopeId","data-v-bc2e0a7f"]]);var fe={name:"Toggle",emits:["input","update:modelValue","change"],props:{value:{validator:function(i){return u=>["number","string","boolean"].indexOf(typeof u)!==-1||u==null},required:!1},modelValue:{validator:function(i){return u=>["number","string","boolean"].indexOf(typeof u)!==-1||u==null},required:!1},id:{type:[String,Number],required:!1,default:"toggle"},name:{type:[String,Number],required:!1,default:"toggle"},disabled:{type:Boolean,required:!1,default:!1},required:{type:Boolean,required:!1,default:!1},falseValue:{type:[String,Number,Boolean],required:!1,default:!1},trueValue:{type:[String,Number,Boolean],required:!1,default:!0},onLabel:{type:[String,Object],required:!1,default:""},offLabel:{type:[String,Object],required:!1,default:""},classes:{type:Object,required:!1,default:()=>({})},labelledby:{type:String,required:!1},describedby:{type:String,required:!1},aria:{required:!1,type:Object,default:()=>({})}},setup(i,u){const e=function(m,f,v){const{value:p,modelValue:a,falseValue:l,trueValue:r,disabled:c}=ue(m),y=a&&a.value!==void 0?a:p,I=C(()=>y.value===r.value),x=T=>{f.emit("input",T),f.emit("update:modelValue",T),f.emit("change",T)},w=()=>{x(r.value)},E=()=>{x(l.value)};return[null,void 0,!1,0,"0","off"].indexOf(y.value)!==-1&&[l.value,r.value].indexOf(y.value)===-1&&E(),[!0,1,"1","on"].indexOf(y.value)!==-1&&[l.value,r.value].indexOf(y.value)===-1&&w(),{externalValue:y,checked:I,update:x,check:w,uncheck:E,handleInput:T=>{x(T.target.checked?r.value:l.value)},handleClick:()=>{c.value||(I.value?E():w())}}}(i,u),o=function(m,f,v){const{trueValue:p,falseValue:a,onLabel:l,offLabel:r}=ue(m),c=v.checked,y=v.update;return{label:C(()=>{let I=c.value?l.value:r.value;return I||(I="&nbsp;"),I}),toggle:()=>{y(c.value?a.value:p.value)},on:()=>{y(p.value)},off:()=>{y(a.value)}}}(i,0,{checked:e.checked,update:e.update}),_=function(m,f,v){const p=ue(m),a=p.disabled,l=v.checked,r=C(()=>({container:"toggle-container",toggle:"toggle",toggleOn:"toggle-on",toggleOff:"toggle-off",toggleOnDisabled:"toggle-on-disabled",toggleOffDisabled:"toggle-off-disabled",handle:"toggle-handle",handleOn:"toggle-handle-on",handleOff:"toggle-handle-off",handleOnDisabled:"toggle-handle-on-disabled",handleOffDisabled:"toggle-handle-off-disabled",label:"toggle-label",...p.classes.value}));return{classList:C(()=>({container:r.value.container,toggle:[r.value.toggle,a.value?l.value?r.value.toggleOnDisabled:r.value.toggleOffDisabled:l.value?r.value.toggleOn:r.value.toggleOff],handle:[r.value.handle,a.value?l.value?r.value.handleOnDisabled:r.value.handleOffDisabled:l.value?r.value.handleOn:r.value.handleOff],label:r.value.label}))}}(i,0,{checked:e.checked}),g=function(m,f,v){const{disabled:p}=ue(m),a=v.check,l=v.uncheck,r=v.checked;return{handleSpace:()=>{p.value||(r.value?l():a())}}}(i,0,{check:e.check,uncheck:e.uncheck,checked:e.checked});return{...e,..._,...o,...g}}};const Sa=["tabindex","aria-checked","aria-describedby","aria-labelledby"],Ca=["id","name","value","checked","disabled"],Ma=["innerHTML"],Va=["checked"];fe.render=function(i,u,e,o,_,g){return s(),n("div",Ke({class:i.classList.container,tabindex:e.disabled?void 0:0,"aria-checked":i.checked,"aria-describedby":e.describedby,"aria-labelledby":e.labelledby,role:"switch"},e.aria,{onKeypress:u[1]||(u[1]=Oe(ye((...m)=>i.handleSpace&&i.handleSpace(...m),["prevent"]),["space"]))}),[se(t("input",{type:"checkbox",id:e.id,name:e.name,value:e.trueValue,checked:i.checked,disabled:e.disabled},null,8,Ca),[[Be,!1]]),t("div",{class:D(i.classList.toggle),onClick:u[0]||(u[0]=(...m)=>i.handleClick&&i.handleClick(...m))},[t("span",{class:D(i.classList.handle)},null,2),Ce(i.$slots,"label",{checked:i.checked,classList:i.classList},()=>[t("span",{class:D(i.classList.label),innerHTML:i.label},null,10,Ma)]),e.required?(s(),n("input",{key:0,type:"checkbox",style:{appearance:"none",height:"1px",margin:"0",padding:"0",fontSize:"0",background:"transparent",position:"absolute",width:"100%",bottom:"0",outline:"none"},checked:i.checked,"aria-hidden":"true",tabindex:"-1",required:""},null,8,Va)):h("v-if",!0)],2)],16,Sa)},fe.__file="src/Toggle.vue";const Pe=i=>(Q("data-v-bcbc4b72"),i=i(),W(),i),Fa={class:"d-flex flex-row p-2"},Oa={class:"d-flex flex-row search-input me-5"},Ea=Pe(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Pa=["placeholder"],Ta={class:"me-5 d-flex"},za=Pe(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),La={class:"ms-5"},Da={class:"d-flex flex-wrap content-container ps-2"},Na=P({__name:"ContentFilter",props:{tab:Qe,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(i,{emit:u}){const e=i,o=S(""),_=C(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),g=C(()=>_.value.length);function m(a){e.tab.collection.groupManager.setSha1Mode(a,!0)}function f(){o.value=e.tab.state.filterState.query}function v(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function p(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return oe(f),H(()=>e.tab.collection.filterManager.state.query,f),(a,l)=>(s(),n(F,null,[t("div",Fa,[b(O,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",Oa,[Ea,se(t("input",{type:"text",class:"input-hidden",placeholder:a.$t("main.menu.search"),"onUpdate:modelValue":l[0]||(l[0]=r=>o.value=r),onChange:v},null,40,Pa),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:p},"x")])]),_:1}),t("div",Ta,[b(O,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:D("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:l[1]||(l[1]=r=>e.tab.state.display="tree")},null,2)]),_:1}),b(O,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:D("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:l[2]||(l[2]=r=>e.tab.state.display="grid")},null,2)]),_:1})]),b(O,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[za]),_:1}),t("div",null,[b(We,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":l[3]||(l[3]=r=>e.tab.state.imageSize=r)},null,8,["modelValue"])]),t("div",La,[b(O,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[b(d(fe),{"model-value":e.tab.collection.groupManager.state.sha1Mode,"onUpdate:modelValue":m,"on-label":a.$t("main.menu.sha1_images"),"off-label":a.$t("main.menu.all_images"),class:"custom-toggle"},null,8,["model-value","on-label","off-label"])]),_:1})]),g.value?(s(),V(Ye,{key:0,class:"ms-5","selected-images-ids":_.value,"onRemove:selected":l[4]||(l[4]=r=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):h("",!0)]),t("div",Da,[b(Do,{manager:e.tab.collection.filterManager},null,8,["manager"]),b(ga,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),b(Ia,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Ga=G(Na,[["__scopeId","data-v-bcbc4b72"]]),ja={class:""},Ra={key:0,class:"image-count"},Ua=["src"],qa={class:"d-flex flex-row"},Ha=P({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(i,{emit:u}){const e=he();N();const o=i,_=u,g=C(()=>`width: ${o.size}px; height: ${o.size}px;`),m=C(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),f=C(()=>o.pile.images[0]);return(v,p)=>(s(),n("div",ja,[t("div",{style:q(g.value),class:"img-container",onClick:p[0]||(p[0]=a=>d(e).showModal(d(ne).IMAGE,f.value))},[o.pile.images.length>1?(s(),n("div",Ra,$(o.pile.images.length),1)):h("",!0),t("img",{src:f.value.url,style:q(m.value)},null,12,Ua)],4),t("div",qa,[b(O,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:q(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:p[1]||(p[1]=a=>_("accept",f.value))}," ✓ ",4)]),_:1}),b(O,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:q(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:p[2]||(p[2]=a=>_("refuse",f.value))}," ✕ ",4)]),_:1})])]))}});const Aa=G(Ha,[["__scopeId","data-v-443484c1"]]),Ba=i=>(Q("data-v-7d2e4016"),i=i(),W(),i),Ka={class:"reco-container"},Qa={class:"d-flex flex-row m-0 ps-2 pb-2"},Wa={class:"text-secondary me-2"},Ya={class:"flex-grow-1"},Xa={class:"d-flex flex-row"},Ja={key:0,class:"separator"},Za=Ba(()=>t("i",{class:"bi bi-x"},null,-1)),el=[Za],tl={class:"d-flex flex-row"},ge=10,sl=P({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(i,{emit:u}){const e=N(),o=i,_=u,g=S(1),m=le([]),f=le([]),v=le([]),p=le(new Set);function a(x){let w=f.indexOf(x);w<0||(f.splice(w,1),c())}function l(x){v.forEach(w=>{if(w.value!=Ze){let E=e.data.properties[w.propertyId].type==M.multi_tags?"add":null;e.setPropertyValue(w.propertyId,x,w.value,E)}}),a(x.sha1)}function r(x){p.add(x.sha1),a(x.sha1)}function c(){m.length=0;const x=f.map(w=>({sha1:w,images:e.data.sha1Index[w]}));y(x,m,g.value,o.imageSize,o.width)}function y(x,w,E,T,A){let j=A,z=[],L=0;for(let R=0;R<x.length&&!(w.length>=E);R++){let B=x[R];if(B.images[0],p.has(B.sha1))continue;let me=T+ge;if(L+me<j){z.push(B),L+=me;continue}if(z.length==0)throw new Error("Images seems to be to big for the line");w.push(z),w.length<E&&(z=[B],L=me)}z.length>0&&w.length<E&&w.push(z)}async function I(){if(!o.group)return;console.log("get reco");const x=o.group.images.map(A=>A.sha1),E=(await Xe(x)).map(A=>A.sha1);v.length=0;let T=o.group;for(;T;)v.push(...T.meta.propertyValues),T=T.parent;f.length=0,f.push(...E),c(),p.clear(),_("update")}return oe(I),H(()=>o.group,()=>{I(),p.clear()}),H(()=>o.imageSize,c),H(()=>o.width,c),(x,w)=>(s(),n("div",Ka,[t("div",Qa,[b(O,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",Wa,$(x.$t("main.recommand.title")),1)]),_:1}),t("div",Ya,[t("div",Xa,[(s(!0),n(F,null,U(v,(E,T)=>(s(),n(F,null,[b(Je,{class:"",value:E},null,8,["value"]),T<v.length-1?(s(),n("div",Ja)):h("",!0)],64))),256))])]),t("span",{class:"text-secondary scroll ps-1 pe-1 clickable",onClick:w[0]||(w[0]=E=>_("scroll",o.group.id))},$(x.$t("main.recommand.group")),1),t("span",{class:"text-secondary me-1 close ps-1 pe-1 clickable",onClick:w[1]||(w[1]=E=>_("close"))},el)]),t("div",{style:q("margin-left:"+ge+"px;")},[(s(!0),n(F,null,U(m,E=>(s(),n("div",null,[t("div",tl,[(s(!0),n(F,null,U(E,T=>(s(),V(Aa,{pile:T,size:o.imageSize,onAccept:l,onRefuse:r,style:q("margin-right:"+ge+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const ol=G(sl,[["__scopeId","data-v-7d2e4016"]]),al={key:0,class:"m-0 p-0"},ll={key:0,style:{"margin-left":"10px"}},nl=P({__name:"MainView",props:{tabId:Number,height:Number},setup(i){const u=N(),e=u.getTabManager(),o=i,_=S({}),g=S(null),m=S(null),f=S(null),v=S([]),p=S(0),a=S(0),l=le({groups:!1}),r=C(()=>e.getVisibleProperties());function c(){g.value&&m.value?p.value=o.height-g.value.clientHeight-m.value.clientHeight-5:g.value?p.value=o.height-g.value.clientHeight-5:p.value=0}e.collection.groupManager.onChange.addListener(()=>{f.value&&e.state.display=="tree"&&f.value.computeLines()});function y(w){console.log("set reco",w),_.value=e.collection.groupManager.result.index[w],ee(()=>c())}async function I(w){w===""?v.value=[]:v.value=await st(w)}function x(){_.value={},ee(()=>c())}return oe(()=>{a.value=g.value.clientWidth,window.addEventListener("resize",()=>{ee(()=>{var w;a.value=((w=g.value)==null?void 0:w.clientWidth)??a.value})})}),H(e.state,()=>{u.updateTab(e.state)},{deep:!0}),H(()=>e.state.imageSize,()=>ee(c)),H(()=>o.height,async()=>{await ee(c)}),(w,E)=>(s(),n(F,null,[t("div",{class:"",ref_key:"filterElem",ref:g},[b(Ga,{tab:d(e),"compute-status":l,onSearchImages:I},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:m,class:"m-0 p-0"},[_.value.id?(s(),n("div",al,[b(ol,{group:_.value,"image-size":d(e).state.imageSize,width:a.value,height:50,onClose:x,onScroll:f.value.scrollTo,onUpdate:E[0]||(E[0]=T=>ee(()=>c()))},null,8,["group","image-size","width","onScroll"])])):h("",!0)],512),a.value>0&&p.value>0?(s(),n("div",ll,[d(e).state.display=="tree"?(s(),V(et,{key:0,"group-manager":d(e).collection.groupManager,"image-size":d(e).state.imageSize,height:p.value-0,properties:r.value,"selected-images":d(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:f,width:a.value-10,onRecommend:y},null,8,["group-manager","image-size","height","properties","selected-images","width"])):h("",!0),d(e).state.display=="grid"?(s(),n("div",{key:1,style:q({width:a.value-12+"px"}),class:"p-0 m-0 grid-container"},[b(tt,{manager:d(e).collection.groupManager,height:p.value-15,width:a.value-40,"selected-properties":r.value,class:"p-0 m-0","show-images":!0,"selected-images":d(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:f},null,8,["manager","height","width","selected-properties","selected-images"])],4)):h("",!0)])):h("",!0)],64))}});const il=G(nl,[["__scopeId","data-v-ea2c2208"]]),rl={class:"d-flex d-row",style:{cursor:"pointer"}},dl=["onMouseenter","onMouseleave"],ul=["onClick"],pl=["onClick"],cl=["onClick"],_l=["onSubmit"],ml=["onKeydown","onUpdate:modelValue"],vl=t("span",{class:"bi bi-plus"},null,-1),gl=[vl],fl={class:"lang"},yl=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),hl=["value"],bl=P({__name:"TabNav",props:{reRender:Function},setup(i){const u=N(),e=S(-1),o=S(""),_=S(null),g=i;function m(c){u.data.selectedTabId==c||v(),u.selectTab(c)}function f(c){e.value=c,o.value=u.data.tabs[c].name,ee(()=>_.value[0].focus())}function v(){e.value=-1,o.value=""}function p(c){u.addTab("New Tab")}async function a(c){confirm("Are you sure to delete Tab: "+c.name)&&await u.removeTab(c.id)}const l=le({});S(-1);const r=["fr","en"];return(c,y)=>(s(),n("nav",null,[t("div",rl,[(s(!0),n(F,null,U(d(u).data.tabs,I=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:x=>l[I.id]=!0,onMouseleave:x=>l[I.id]=!1},[e.value!=I.id?(s(),n(F,{key:0},[b(O,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:x=>f(I.id),class:D(["bi bi-pencil me-1 tab-icon hover-light",l[I.id]&&d(u).data.selectedTabId==I.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,ul)]),_:2},1024),t("div",{class:D(["tab-button",I.id==d(u).data.selectedTabId?" active":""]),onClick:x=>m(I.id)},[t("span",null,$(I.name),1)],10,pl),b(O,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:x=>a(I),class:D(["btn-icon bi bi-x tab-icon hover-light",l[I.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,cl)]),_:2},1024)],64)):(s(),n("div",{key:1,class:D(["tab-button",I.id==d(u).data.selectedTabId?" active":""])},[t("form",{onSubmit:ye(v,["stop","prevent"])},[se(t("input",{onFocusout:v,onKeydown:Oe(v,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":x=>I.name=x,ref_for:!0,ref_key:"inputElem",ref:_},null,40,ml),[[re,I.name]])],40,_l)],2))],40,dl))),256)),b(O,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:p},gl)]),_:1}),t("div",fl,[yl,se(t("select",{"onUpdate:modelValue":y[0]||(y[0]=I=>c.$i18n.locale=I),onChange:y[1]||(y[1]=I=>g.reRender())},[(s(),n(F,null,U(r,(I,x)=>t("option",{key:`Lang${x}`,value:I},$(I.toUpperCase()),9,hl)),64))],544),[[ot,c.$i18n.locale]])])])]))}});const Te=i=>(Q("data-v-264b4bb4"),i=i(),W(),i),$l={class:"d-flex flex-row m-0 p-0 overflow-hidden"},kl={key:0},xl={key:1,class:"w-100"},wl={key:0,class:"custom-hr"},Il={key:2,class:"loading"},Sl={class:"text-center"},Cl={key:3,class:"loading"},Ml=Te(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Vl=Te(()=>t("span",{class:"ms-1"},"Loading...",-1)),Fl=[Ml,Vl],Ol=P({__name:"PanopticView",setup(i){const u=N(),e=he(),o=S(null),_=S(null),g=S(window.innerHeight),m=S(!1),f=C(()=>{var c;return g.value-(((c=_.value)==null?void 0:c.clientHeight)??0)}),v=C(()=>{var c;return(c=o.value)==null?void 0:c.filteredImages.map(y=>y.id)});oe(async()=>{e.isProjectLoaded||we.push("/"),ee(()=>{window.addEventListener("resize",p),p()}),window.addEventListener("keydown",c=>{c.key=="Control"&&(X.ctrl=!0),c.key=="Alt"&&(X.alt=!0),c.key=="Shift"&&(X.shift=!0)}),window.addEventListener("keyup",c=>{c.key=="Control"&&(X.ctrl=!1),c.key=="Alt"&&(X.alt=!1),c.key=="Shift"&&(X.shift=!1)}),window.addEventListener("mousemove",c=>{X.ctrl=c.ctrlKey,X.alt=c.altKey,X.shift=c.shiftKey})}),at(()=>{window.removeEventListener("resize",p)});function p(){g.value=window.innerHeight,m.value=!0}function a(){e.showModal(ne.EXPORT,v)}function l(){u.rerender()}function r(){we.push("/")}return(c,y)=>(s(),n("div",{id:"panoptic",key:d(u).status.renderNb},[t("div",$l,[d(u).status.loaded?(s(),n("div",kl,[b(Os,{onExport:y[0]||(y[0]=I=>a())})])):h("",!0),d(u).status.loaded?(s(),n("div",xl,[t("div",{class:"ms-3",ref_key:"navElem",ref:_},[b(bl,{"re-render":l})],512),m.value?(s(),n("div",wl)):h("",!0),d(u).status.loaded?(s(),V(il,{key:1,"tab-id":d(u).data.selectedTabId,height:f.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):h("",!0)])):d(e).isProjectLoaded?(s(),n("div",Cl,Fl)):(s(),n("div",Il,[t("div",Sl,[t("div",null,$(c.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:r,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))}});const Pl=G(Ol,[["__scopeId","data-v-264b4bb4"]]);export{Pl as default};
