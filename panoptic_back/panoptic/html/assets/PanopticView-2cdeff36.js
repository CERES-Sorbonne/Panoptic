import{d as P,x as Z,r as C,c as x,o as s,j as T,s as w,b as e,t as g,n as N,a as o,l as j,F as V,D as te,y as Ne,_ as L,z as _e,h as pe,A as H,B as Ue,C as ze,e as a,P as Pe,k as h,q as $,E as ke,G as M,H as He,I as Ae,S as Be,J as qe,K as Ke,L as Qe,p as B,f as q,N as W,O as we,w as ue,v as ye,Q as xe,R as z,T as Oe,m as X,U as We,V as De,W as A,X as be,Y as Me,u as Se,M as ie,g as Ie,Z as Ye,$ as Xe,a0 as Fe,a1 as Ze,a2 as Le,a3 as Je,a4 as ae,a5 as ee,a6 as et,a7 as tt,a8 as st,a9 as ot,aa as nt,ab as at,ac as de,ad as it,ae as lt,af as oe,ag as rt,ah as dt,ai as pt,aj as ct,i as Te,ak as U,al as ut}from"./index-b903d90a.js";import{_ as _t}from"./Tutorial-73410c60.js";const mt=["disabled"],vt={class:"m-0 p-1"},yt=["onClick"],ht=P({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(r,{emit:d}){const t=Z(),n=r,c=d,m=C(null),v=x(()=>t.properties[n.propertyId]),f=x(()=>Ne(v.value.type));async function y(u){c("update:modelValue",u),m.value.hide()}return(u,l)=>(s(),T(te,{onHide:l[0]||(l[0]=i=>c("hide")),ref_key:"dropdownElem",ref:m,parent:n.parent},{button:w(()=>[e("div",{class:N(["text-nowrap",n.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:n.disabled},[e("span",null,g(u.$t("modals.filters.operators."+n.modelValue)),1)],10,mt)]),popup:w(()=>[e("div",vt,[(s(!0),o(V,null,j(f.value,i=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:p=>y(i)},[e("a",null,g(u.$t("modals.filters.operators."+i)),1)],8,yt))),256))])]),_:1},8,["parent"]))}});const gt=L(ht,[["__scopeId","data-v-7b1fbda7"]]),ft=r=>(B("data-v-2c129993"),r=r(),q(),r),bt={class:"m-0 p-0"},$t={key:1},kt={class:"d-flex mode-header"},wt={class:"me-3"},xt=ft(()=>e("div",{class:"flex-fill"},null,-1)),It={key:0,class:"me-2",style:{width:"100%"}},St=P({__name:"FilterDropdown",props:{manager:_e,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(r){const d=Z(),t=r,n=C(null),c=C(null),m=C(null),v=C(0),f=C(null),y=C(null),u=x(()=>t.filterId!==void 0?t.filterId:f.value),l=x(()=>{if(!(u.value==null||u.value==-1))return t.manager.filterIndex[u.value]}),i=x(()=>l.value==null?void 0:d.properties[l.value.propertyId]);function p(){v.value=t.mode,t.mode==2&&t.filterId==null&&E(t.propertyId)}function _(){n.value&&n.value.hide()}function b(){v.value=0}function k(){_(),t.manager.deleteFilter(u.value)}function E(I){let S=t.manager.addNewFilter(I,t.parentId);f.value=S.id,v.value=2}function Y(I){y.value=null,t.manager.updateFilter(u.value,{operator:I}),c.value&&c.value.focus(),ke(I)||_()}function se(){console.log("update value",y.value),t.manager.updateFilter(u.value,{value:y.value})}function ne(){if(!l.value)return;const I=d.properties[l.value.propertyId];if(Ke(I.type))return;const S=y.value??Qe(I.type);l.value.value!=S&&se()}function O(){l.value&&(y.value=l.value.value)}return pe(O),H(()=>l.value,()=>O()),(I,S)=>(s(),T(te,{ref_key:"dropdownElem",ref:n,onShow:p,onHide:b,parent:t.parent},{button:w(()=>[e("div",bt,[Ue(I.$slots,"default",{},void 0,!0)])]),popup:w(()=>[e("div",{class:"container-size bg-white",ref_key:"popupElem",ref:m},[v.value!=0?(s(),o(V,{key:0},[v.value==1?(s(),T(ze,{key:0,onSelect:E,"ignore-ids":[a(Pe).folders]},null,8,["ignore-ids"])):h("",!0),v.value==2?(s(),o("div",$t,[e("div",kt,[e("div",wt,g(i.value.name),1),$(gt,{"property-id":l.value.propertyId,"model-value":l.value.operator,"onUpdate:modelValue":Y,parent:m.value},null,8,["property-id","model-value","parent"]),xt,e("div",null,[e("i",{class:"bi bi-trash-fill",onClick:k})])]),a(ke)(l.value.operator)?(s(),o("div",It,[i.value.type==a(M).multi_tags||i.value.type==a(M).tag?(s(),T(He,{key:0,modelValue:y.value,"onUpdate:modelValue":[S[0]||(S[0]=F=>y.value=F),se],"auto-focus":!0,property:a(d).properties[l.value.propertyId],ref_key:"inputElem",ref:c,onHide:_},null,8,["modelValue","property"])):i.value.type==a(M).color?(s(),T(Ae,{key:1,property:i.value,modelValue:y.value,"onUpdate:modelValue":[S[1]||(S[1]=F=>y.value=F),S[2]||(S[2]=()=>{_(),ne()})]},null,8,["property","modelValue"])):i.value.type==a(M).date?(s(),T(Be,{key:2,property:i.value,modelValue:y.value,"onUpdate:modelValue":[S[3]||(S[3]=F=>y.value=F),S[4]||(S[4]=()=>{_(),ne()})]},null,8,["property","modelValue"])):(s(),T(qe,{key:3,"no-html":!0,modelValue:y.value,"onUpdate:modelValue":S[5]||(S[5]=F=>y.value=F),width:-1,"min-height":20,"no-nl":a(d).properties[l.value.propertyId].type==a(M).number,"url-mode":a(d).properties[l.value.propertyId].type==a(M).url,"only-number":a(d).properties[l.value.propertyId].type==a(M).number,onBlur:ne,"auto-focus":!0,ref_key:"inputElem",ref:c},null,8,["modelValue","no-nl","url-mode","only-number"]))])):h("",!0)])):h("",!0)],64)):h("",!0)],512)]),_:3},8,["parent"]))}});const ve=L(St,[["__scopeId","data-v-2c129993"]]),le=r=>(B("data-v-374dc7a7"),r=r(),q(),r),Ct={class:"d-flex flex-row"},Mt={key:1,class:"d-flex",style:{width:"150px"}},Ft={class:"flex-grow-1"},Tt={key:1,style:{"padding-top":"1px"}},Vt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Et=le(()=>e("i",{class:"bi bi-link-45deg"},null,-1)),zt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Pt=le(()=>e("i",{class:"bi bi-chevron-down"},null,-1)),Ot=le(()=>e("i",{class:"bi bi-chevron-right"},null,-1)),Dt={key:0,class:"ms-3 pt-1"},Lt=le(()=>e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Gt=le(()=>e("i",{class:"bi bi-filter me-2"},null,-1)),Rt=le(()=>e("i",{class:"bi bi-collection me-2"},null,-1)),jt=le(()=>e("i",{class:"bi bi-trash me-2"},null,-1)),Nt={key:1},Ut=P({__name:"PropertyOptions",props:{property:Object},setup(r){const d=W(),t=d.getTabManager(),n=r,c=C(!1),m=C(!1),v=C(""),f=C(!1),y=x(()=>d.getTab()),u=x(()=>y.value.visibleProperties[n.property.id]==!0),l=x(()=>t.collection.filterManager.state.filter.filters.some(F=>!F.isGroup&&F.propertyId==n.property.id)),i=x(()=>t.collection.groupManager.state.groupBy.includes(n.property.id)),p=x(()=>t.collection.sortManager.state.sortBy.includes(n.property.id)),_=x(()=>{if(l.value)return t.collection.filterManager.state.filter.filters.find(F=>!F.isGroup&&F.propertyId==n.property.id).id}),b=()=>t.collection.filterManager,k=x(()=>t.getSha1Mode());function E(){u.value?t.setVisibleProperty(n.property.id,!1):t.setVisibleProperty(n.property.id,!0)}function Y(){c.value?c.value=!1:(c.value=!0,v.value=n.property.name),m.value=!1}function se(){n.property.type!=M.tag&&n.property.type!=M.multi_tags||(m.value?m.value=!1:m.value=!0,c.value=!1)}function ne(){p.value?t.collection.sortManager.delSort(n.property.id):t.collection.sortManager.setSort(n.property.id),t.collection.sortManager.update(!0)}function O(){i.value?t.collection.groupManager.delGroupOption(n.property.id):t.collection.groupManager.setGroupOption(n.property.id),t.collection.groupManager.update(!0)}function I(){confirm("Supprimer la propriété: "+n.property.name+" ?")&&d.deleteProperty(n.property.id)}async function S(){v.value!=""&&(await d.updateProperty(n.property.id,v.value),Y())}return H(()=>n.property,()=>{c.value=!1}),(F,D)=>(s(),o("div",{class:N(f.value?"hover-light":"")},[e("div",Ct,[c.value?h("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:Y},[$(we,{type:n.property.type,class:"me-2 btn-icon",onMouseenter:D[0]||(D[0]=G=>f.value=!0),onMouseleave:D[1]||(D[1]=G=>f.value=!1)},null,8,["type"]),e("span",null,g(n.property.name),1)])),c.value?(s(),o("div",Mt,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:Y,onMouseenter:D[2]||(D[2]=G=>f.value=!0),onMouseleave:D[3]||(D[3]=G=>f.value=!1)},null,32)]),e("div",Ft,[n.property.id>=0?ue((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":D[4]||(D[4]=G=>v.value=G),onChange:S},null,544)),[[ye,v.value]]):(s(),o("span",Tt,[$(we,{type:n.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,g(n.property.name),1)]))])])):h("",!0),e("div",Vt,[n.property.mode==a(xe).id?(s(),T(z,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:w(()=>[Et]),_:1})):h("",!0)]),e("div",{style:{width:"20px","margin-top":"2px"},onClick:E,class:"btn-icon text-center"},[k.value&&n.property.mode==a(xe).id?(s(),T(z,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:w(()=>[e("span",{class:"bi bi-eye-slash",onClick:D[5]||(D[5]=Oe(()=>{},["stop"]))})]),_:1})):(s(),T(z,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:w(()=>[e("span",{class:N("bi bi-eye text-"+(u.value?"primary":"secondary"))},null,2)]),_:1}))]),e("div",zt,[n.property.type==a(M).tag||n.property.type==a(M).multi_tags?(s(),o("div",{key:0,onClick:se,style:{cursor:"pointer"}},[m.value?(s(),T(z,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:w(()=>[Pt]),_:1})):(s(),T(z,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:w(()=>[Ot]),_:1}))])):h("",!0)])]),e("div",null,[c.value?(s(),o("div",Dt,[e("div",{class:N(["options hover-light",l.value?" text-primary":""])},[$(ve,{manager:b(),"filter-id":_.value,mode:2,"property-id":r.property.id},{default:w(()=>[Lt,X(g(F.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),e("div",{class:N(["options hover-light",p.value?" text-primary":""]),onClick:ne},[Gt,X(g(F.$t("main.menu.sort.title")),1)],2),e("div",{class:N(["options hover-light",i.value?" text-primary":""]),onClick:O},[Rt,X(g(F.$t("main.menu.groupby")),1)],2),n.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:I},[jt,X(g(F.$t("main.nav.properties.delete_property")),1)])):h("",!0)])):m.value?(s(),o("div",Nt,[$(We,{property:n.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):h("",!0)])],2))}});const Ve=L(Ut,[["__scopeId","data-v-374dc7a7"]]),Ht=e("i",{class:"bi bi-three-dots base-hover"},null,-1),At={class:"p-2"},Bt=["onClick"],qt=e("i",{class:"bi bi-arrow-clockwise"},null,-1),Kt=P({__name:"FolderOptionDropdown",props:{folder:{}},setup(r){const d=W(),t=r;function n(){d.reImportFolder(t.folder.id)}return(c,m)=>(s(),T(te,{teleport:!0},{button:w(()=>[Ht]),popup:w(({hide:v})=>[e("div",At,[e("div",{class:"base-hover p-1",onClick:f=>{n(),v()}},[qt,X(" Re import")],8,Bt)])]),_:1}))}}),Qt=["onMouseenter"],Wt=["onClick"],Yt={class:"text-secondary"},Xt=["onClick"],Zt=P({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:_e,root:{type:Boolean,default:!0}},setup(r){const d=W(),t=r,n=C(null),c=x(()=>{let l={};const i=new Set(t.filterManager.state.folders);return t.folders.map(p=>p.id).forEach(p=>{i.has(p)&&(l[p]=!0)}),l}),m=x(()=>{let l={};return t.folders.map(i=>i.id).forEach(i=>{t.visibleFolders[i]&&(l[i]=!0)}),l}),v=x(()=>{let l={};return t.folders.forEach(i=>{let p=[];c.value[i.id]&&p.push("selected"),l[i.id]=p.join(" ")}),l});function f(l){let i=t.visibleFolders;i[l]?delete i[l]:i[l]=!0}function y(l){let i=new Set(t.filterManager.state.folders);const p=i.has(l),_=d.data.folders[l].parent!=null&&i.has(d.data.folders[l].parent);p&&!_?(i.delete(l),be(l).forEach(b=>i.delete(b.id))):(u(l,i),i.add(l),be(l).forEach(b=>i.add(b.id)),Me(d.data.folders[l]).forEach(b=>i.delete(b.id))),t.filterManager.setFolders(Array.from(i)),t.filterManager.update(!0)}function u(l,i){const p=Me(d.data.folders[l]);let _;for(let b of p)if(i.has(b.id))_=b;else break;_!=null&&be(_.id).forEach(b=>i.delete(b.id))}return(l,i)=>{const p=De("FolderList2",!0);return s(),o("ul",{class:N(t.root?"tree":""),style:A(t.root?"padding-left:0px;":"")},[(s(!0),o(V,null,j(r.folders,_=>(s(),o("li",{style:A(t.root?"padding-left:0px;":""),class:"no-break",onMouseenter:b=>n.value=_.id,onMouseleave:i[0]||(i[0]=b=>n.value=null)},[e("summary",{class:N(v.value[_.id]),onClick:b=>y(_.id)},[X(g(_.name)+" ",1),e("span",Yt,g(_.count),1)],10,Wt),_.children&&_.children.length>0?(s(),o("i",{key:0,onClick:b=>f(_.id),class:N("bi bi-chevron-"+(m.value[_.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Xt)):h("",!0),e("span",{class:N(n.value===_.id?"visible-option":"invisible-option")},[$(Kt,{folder:_,style:{display:"inline-block"}},null,8,["folder"])],2),_.children&&_.children.length>0&&m.value[_.id]?(s(),T(p,{key:1,folders:_.children,root:!1,"visible-folders":t.visibleFolders,"filter-manager":t.filterManager},null,8,["folders","visible-folders","filter-manager"])):h("",!0)],44,Qt))),256))],6)}}});const Jt=L(Zt,[["__scopeId","data-v-f32b51da"]]),es={class:"text-center"},ts={class:"w-100 text-center",style:{"font-size":"10px"}},ss={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},os=P({__name:"TaskStatus",props:{task:{}},setup(r){const d=r,t=x(()=>d.task.total-d.task.remain-d.task.computing),n=x(()=>d.task.total);return(c,m)=>(s(),o("div",es,[X(g(d.task.name)+" ",1),e("div",ts,g(t.value)+" / "+g(n.value)+" "+g(c.$t("main.nav.tasks.done")),1),n.value>0?(s(),o("div",ss,[e("div",{class:"progress-bar",style:A(`width: ${t.value/n.value*100}%`)},null,4)])):h("",!0)]))}}),K=r=>(B("data-v-593db1ff"),r=r(),q(),r),ns={class:"menu overflow-scroll"},as={class:""},is={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ls={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},rs=K(()=>e("i",{class:"bi bi-gear"},null,-1)),ds=[rs],ps=K(()=>e("i",{class:"bi bi-arrow-left-right"},null,-1)),cs=[ps],us=K(()=>e("div",{class:"custom-hr"},null,-1)),_s={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ms={class:"d-flex align-items-center"},vs=K(()=>e("i",{class:"bi bi-plus"},null,-1)),ys={class:"overflow-scroll"},hs={key:0,id:"import"},gs=K(()=>e("div",{class:"custom-hr"},null,-1)),fs={class:"pt-1 pb-2"},bs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},$s=K(()=>e("div",{class:"custom-hr"},null,-1)),ks={key:0,class:"ps-2 pe-2"},ws={class:"p-1"},xs={key:0,class:"custom-hr"},Is={key:1,class:"p-2"},Ss=K(()=>e("div",{class:"custom-hr"},null,-1)),Cs={key:0,class:"float-end"},Ms={class:"text-center"},Fs={class:"w-100 text-center",style:{"font-size":"10px"}},Ts={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Vs={key:2,class:"p-2"},Es={class:"w-100 text-center",style:{"font-size":"10px"}},zs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ps=K(()=>e("div",{class:"custom-hr"},null,-1)),Os={class:"p-2 mt-0"},Ds={class:"d-flex"},Ls=K(()=>e("span",{class:"flex-grow-1"},null,-1)),Gs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Rs=K(()=>e("span",{class:"sr-only"},null,-1)),js=[Rs],Ns={key:1,class:"bb me-1"},Us={class:"bb me-2"},Hs={key:0,class:"mt-2"},As={key:0,class:"property-item"},Bs=K(()=>e("div",{class:"property-item m-0 p-0"},null,-1)),qs=K(()=>e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ks=K(()=>e("div",{class:"custom-hr"},null,-1)),Qs={class:"p-2 mt-0"},Ws={key:0,class:"mt-2"},Ys={key:0,class:"property-item"},Xs=P({__name:"Menu",emits:["export"],setup(r,{emit:d}){const t=W(),n=Z(),c=Se(),m=t.getTabManager(),v=C(!1),f=C(!1),y=async p=>{c.showModal(ie.IMPORT)},u=x(()=>t.backendStatus.tasks.filter(p=>!(p.name=="Load Plugin"&&p.done)));function l(){c.showModal(ie.FOLDERSELECTION,{callback:i,mode:"images"})}function i(p){p&&t.addFolder(p)}return H(()=>t.status.import.to_import,()=>v.value=!0),(p,_)=>{var b;return s(),o("div",ns,[e("div",as,[e("div",null,[e("div",is,[e("div",ls,[e("div",{class:"flex-grow-1 text-capitalize",onClick:_[0]||(_[0]=()=>{})},g((b=a(c).data.status.selectedProject)==null?void 0:b.name),1),e("div",{class:"base-hover p-1",onClick:_[1]||(_[1]=k=>a(c).showModal(a(ie).SETTINGS))},ds),e("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:_[2]||(_[2]=k=>a(c).closeProject())},cs)])]),us,e("div",_s,[e("div",ms,[e("div",null,[e("b",null,g(p.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:_[3]||(_[3]=k=>{l(),a(Ie)()})},[$(z,{message:"main.nav.folders.add"},{default:w(()=>[vs]),_:1})])]),e("div",ys,[a(t).getTab()?(s(),T(Jt,{key:0,folders:a(t).folderRoots,"filter-manager":a(m).collection.filterManager,"visible-folders":a(m).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):h("",!0)])]),u.value&&u.value.length?(s(),o("div",hs,[gs,e("div",fs,[e("div",bs,[e("div",null,[e("b",null,g(p.$t("main.nav.tasks.title")),1)])]),$s,a(t).backendStatus?(s(),o("div",ks,[(s(!0),o(V,null,j(u.value,(k,E)=>(s(),o("div",ws,[E?(s(),o("div",xs)):h("",!0),$(os,{task:k},null,8,["task"])]))),256))])):h("",!0)])])):h("",!0),a(t).status.import.to_import!=null&&a(t).status.import.to_import>0&&v.value?(s(),o("div",Is,[Ss,a(t).status.import.done?(s(),o("div",Cs,[e("i",{class:"bi bi-x base-hover",onClick:_[4]||(_[4]=k=>v.value=!1)})])):h("",!0),e("div",Ms,[e("b",null,g(p.$t("main.menu.import_status_title")),1)]),e("div",Fs,g(a(t).status.import.imported)+" / "+g(a(t).status.import.to_import)+" importées ",1),a(t).status.import.to_import>0?(s(),o("div",Ts,[e("div",{class:"progress-bar",style:A(`width: ${a(t).status.import.imported/a(t).status.import.to_import*100}%`)},null,4)])):h("",!0)])):h("",!0),a(t).status.import.to_import!=null&&a(t).status.import.to_import>0&&v.value?(s(),o("div",Vs,[e("div",Es,g(a(t).status.import.computed)+" / "+g(a(t).status.import.to_import)+" computed ",1),a(t).status.import.to_import>0?(s(),o("div",zs,[e("div",{class:"progress-bar",style:A(`width: ${a(t).status.import.computed/a(t).status.import.to_import*100}%`)},null,4)])):h("",!0)])):h("",!0),Ps,e("div",Os,[e("div",Ds,[$(z,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:w(()=>[e("b",null,g(p.$t("main.nav.properties.title")),1)]),_:1}),Ls,f.value?(s(),o("span",Gs,js)):(s(),o("span",Ns,[$(z,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:w(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:y})]),_:1})])),e("span",Us,[$(z,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:w(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:_[5]||(_[5]=k=>a(c).showModal(a(ie).EXPORT,void 0))})]),_:1})])]),a(t).status.loaded?(s(),o("div",Hs,[(s(!0),o(V,null,j(a(n).properties,k=>(s(),o(V,null,[k.id>=0?(s(),o("div",As,[$(Ve,{property:k},null,8,["property"])])):h("",!0)],64))),256)),Bs,e("div",{id:"add-property",onClick:_[6]||(_[6]=k=>{a(c).showModal(a(ie).PROPERTY,void 0),a(Ie)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[qs,e("span",null,g(p.$t("main.nav.properties.add_property")),1)])])):h("",!0)]),Ks,e("div",Qs,[$(z,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:w(()=>[e("b",null,g(p.$t("main.nav.computed.title")),1)]),_:1}),a(t).status.loaded?(s(),o("div",Ws,[(s(!0),o(V,null,j(a(n).properties,k=>(s(),o(V,null,[k.id<0?(s(),o("div",Ys,[$(z,{pos:"bottom",message:"main.nav.computed."+Math.abs(k.id).toString()+"_tooltip"},{default:w(()=>[$(Ve,{property:k},null,8,["property"])]),_:2},1032,["message"])])):h("",!0)],64))),256))])):h("",!0)])])])])}}});const Zs=L(Xs,[["__scopeId","data-v-593db1ff"]]),Js={class:"text-nowrap text-secondary"},Ee=P({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(r){const d=Z(),t=r,n=x(()=>d.properties[t.propertyId].tags);return(c,m)=>(s(),o("div",Js,[t.value&&t.value.length>0?(s(!0),o(V,{key:0},j(t.value,v=>(s(),o("span",null,[$(Ye,{tag:n.value[v].value,color:n.value[v].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(V,{key:1},[X(" Add Tags... ")],64))]))}}),eo={key:0},to={key:1},so={key:2},oo={key:3},no={key:0,class:"bi bi-square"},ao={key:1,class:"bi bi-check-square"},io={key:5},lo={key:6},ro={key:7},po={key:8},co={key:9},uo={key:10},_o={key:11},mo={key:12},vo={key:13},yo={key:1,class:"text-secondary"},ho=P({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(r){const d=r,t=x(()=>{if(d.value==null)return"white";let c=Number(d.value);return isNaN(c)||c>12?"gray":Xe[c].color}),n=x(()=>[M._ahash,M._folders,M._sha1,M.string].indexOf(d.property.type)!==-1?'"'+d.value+'"':d.value);return(c,m)=>r.value!=null?(s(),o(V,{key:0},[d.property.type==a(M)._ahash?(s(),o("div",eo,g(n.value),1)):h("",!0),d.property.type==a(M)._folders?(s(),o("div",to,g(n.value),1)):h("",!0),d.property.type==a(M)._sha1?(s(),o("div",so,g(n.value),1)):h("",!0),d.property.type==a(M).checkbox?(s(),o("div",oo,[n.value?(s(),o("i",no)):(s(),o("i",ao))])):h("",!0),d.property.type==a(M).color?(s(),o("div",{key:4,style:A({backgroundColor:t.value}),class:"w-100 h-100"},null,4)):h("",!0),d.property.type==a(M).date?(s(),o("div",io,g(n.value),1)):h("",!0),d.property.type==a(M).image_link?(s(),o("div",lo)):h("",!0),d.property.type==a(M).multi_tags?(s(),o("div",ro,[$(Ee,{"property-id":d.property.id,value:n.value},null,8,["property-id","value"])])):h("",!0),d.property.type==a(M).number?(s(),o("div",po,g(n.value),1)):h("",!0),d.property.type==a(M).path?(s(),o("div",co,g(n.value),1)):h("",!0),d.property.type==a(M).string?(s(),o("div",uo,g(n.value),1)):h("",!0),d.property.type==a(M)._id||d.property.type==a(M)._height||d.property.type==a(M)._width?(s(),o("div",_o,g(n.value),1)):h("",!0),d.property.type==a(M).tag?(s(),o("div",mo,[$(Ee,{"property-id":d.property.id,value:n.value},null,8,["property-id","value"])])):h("",!0),d.property.type==a(M).url?(s(),o("div",vo,g(n.value),1)):h("",!0)],64)):(s(),o("span",yo,"..."))}}),go={class:"d-flex bb ps-1 overflow-hidden"},fo={class:"m-0 p-0 me-2 text-nowrap"},bo={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},$o=P({__name:"FilterPreview",props:{filter:Object},setup(r){const d=Z(),t=r,n=x(()=>d.properties[t.filter.propertyId]);return(c,m)=>(s(),o("td",go,[e("div",fo,g(c.$t("modals.filters.operators."+t.filter.operator)),1),a(ke)(t.filter.operator)?(s(),o("div",bo,[$(ho,{property:n.value,value:t.filter.value},null,8,["property","value"])])):h("",!0)]))}});const ko=L($o,[["__scopeId","data-v-34bfc81a"]]),he=r=>(B("data-v-c37d0b19"),r=r(),q(),r),wo={class:"filter-group"},xo={class:"table table-sm"},Io={class:"align-top p-0 m-0"},So={key:0,class:"m-0 p-0"},Co={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Mo={class:""},Fo=["onClick"],To=he(()=>e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Vo={key:2,class:"text-secondary"},Eo={key:0,class:"p-0 m-0 ps-2"},zo={key:1,class:"p-0 m-0 ps-2"},Po={class:"border rounded"},Oo={class:""},Do=["onClick"],Lo=he(()=>e("i",{class:"bi bi-trash"},null,-1)),Go=[Lo],Ro={class:"d-flex text-secondary ms-2"},jo={class:"add-options hover-light"},No=he(()=>e("i",{class:"bi bi-plus"},null,-1)),Uo=he(()=>e("i",{class:"bi bi-plus"},null,-1)),Ho=P({__name:"FilterGroupInput",props:{filter:Object,manager:_e,parent:HTMLElement},emits:["delete"],setup(r,{emit:d}){const t=Z(),n=r,c=x(()=>n.filter),m=x(()=>c.value.filters),v=x(()=>{let i=255-(c.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function f(i,p){n.manager.updateFilter(i,{propertyId:p})}function y(i){n.manager.deleteFilter(i.id)}function u(i){n.manager.addNewFilterGroup(i)}function l(i,p){n.manager.updateFilterGroup(i,p)}return(i,p)=>{const _=De("FilterGroupInput",!0);return s(),o("div",wo,[e("table",xo,[(s(!0),o(V,null,j(m.value,(b,k)=>(s(),o("tr",null,[e("td",Io,[k==0?(s(),o("div",So,g(i.$t("modals.filters.where")),1)):k==1?(s(),T(te,{key:1},{button:w(()=>[e("div",Co,[e("span",Mo,g(i.$t("modals.filters."+c.value.groupOperator)),1)])]),popup:w(({hide:E})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:E},[e("div",{class:"base-btn",onClick:p[0]||(p[0]=Y=>l(c.value.id,a(Fe).and))},g(i.$t("modals.filters.and")),1),To,e("div",{class:"base-btn",onClick:p[1]||(p[1]=Y=>l(c.value.id,a(Fe).or))},g(i.$t("modals.filters.or")),1)],8,Fo)]),_:1})):(s(),o("span",Vo,g(c.value.groupOperator),1))]),b.propertyId!==void 0?(s(),o("td",Eo,[$(Ze,{"model-value":a(t).properties[b.propertyId],"onUpdate:modelValue":E=>f(b.id,E.id)},null,8,["model-value","onUpdate:modelValue"])])):h("",!0),b.propertyId!==void 0?(s(),o("td",zo,[$(ve,{class:"flex-grow-1",manager:r.manager,mode:2,"parent-id":c.value.id,"filter-id":b.id,parent:n.parent},{default:w(()=>[$(ko,{filter:b},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:A(v.value)},[e("div",Po,[$(_,{filter:b,manager:n.manager},null,8,["filter","manager"])])],4)),e("td",Oo,[e("span",{class:"base-btn",onClick:E=>y(b)},Go,8,Do)])]))),256))]),e("div",Ro,[$(ve,{manager:n.manager,"parent-id":c.value.id},{default:w(()=>[e("div",jo,[No,X(g(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),e("div",{class:"add-options hover-light",onClick:p[2]||(p[2]=b=>u(c.value.id))},[Uo,X(g(i.$t("modals.filters.new_group")),1)])])])}}});const Ao=L(Ho,[["__scopeId","data-v-c37d0b19"]]),Bo=r=>(B("data-v-9832f887"),r=r(),q(),r),qo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ko={key:0},Qo=Bo(()=>e("span",{class:"text-primary"},"Text Query",-1)),Wo={key:0,class:"or-separator"},Yo={key:0,class:"or-separator"},Xo={key:0,class:"m-1 p-0"},Zo=P({__name:"GlobalFilterInputDropdown",props:{manager:_e},emits:["update:modelValue"],setup(r,{emit:d}){const t=Z(),n=r,c=C(null),m=C(null),v=x(()=>{let y=f(n.manager.state.filter),u={};return y.forEach(l=>u[l.propertyId]=l),Object.values(u)});function f(y){let u=[];for(let l of y.filters)l.isGroup?u.push(...f(l)):u.push(l);return u}return H(()=>n.manager.state.filter.filters,()=>{n.manager.state.filter.filters.length==0&&m.value.hide()}),(y,u)=>(s(),T(te,{ref_key:"dropdownElem",ref:m},{button:w(()=>[e("div",null,[v.value.length||n.manager.state.query?(s(),o("div",qo,[n.manager.state.query?(s(),o("div",Ko,[Qo,v.value.length?(s(),o("span",Wo,"|")):h("",!0)])):h("",!0),(s(!0),o(V,null,j(v.value,(l,i)=>(s(),o("div",null,[i>0?(s(),o("span",Yo,"|")):h("",!0),l.propertyId==a(Pe).id?(s(),T(we,{key:1,type:a(t).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):h("",!0),e("span",null,g(a(t).properties[l.propertyId].name),1)]))),256))])):h("",!0)])]),popup:w(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:c},[Object.keys(a(t).properties).length>0?(s(),o("div",Xo,[$(Ao,{filter:n.manager.state.filter,manager:n.manager,parent:c.value},null,8,["filter","manager","parent"])])):h("",!0)],512)]),_:1},512))}});const Jo=L(Zo,[["__scopeId","data-v-9832f887"]]),en=r=>(B("data-v-1d7e82c5"),r=r(),q(),r),tn={class:"d-flex flex-row filter-form"},sn={class:"pt-1 pb-1"},on=en(()=>e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)),nn=P({__name:"FilterForm",props:{manager:_e},setup(r){const d=r;return(t,n)=>(s(),o("div",tn,[e("div",sn,g(t.$t("main.menu.filters"))+": ",1),$(Jo,{manager:d.manager},null,8,["manager"]),$(ve,{manager:d.manager,class:"p-1"},{default:w(()=>[on]),_:1},8,["manager"])]))}});const an=L(nn,[["__scopeId","data-v-1d7e82c5"]]),ln=r=>(B("data-v-8d053f51"),r=r(),q(),r),rn=ln(()=>e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)),dn={class:"p-1"},pn=P({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(r,{emit:d}){const t=r,n=d,c=C(null);return(m,v)=>(s(),T(te,{ref_key:"dropdownElem",ref:c,"auto-focus":!1},{button:w(()=>[rn]),popup:w(()=>[e("div",dn,[$(ze,{onClick:v[0]||(v[0]=f=>a(Ie)()),onSelect:v[1]||(v[1]=f=>{n("select",f),c.value.hide()}),"ignore-ids":t.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ge=L(pn,[["__scopeId","data-v-8d053f51"]]),cn={class:"base-hover ps-1 pe-1"},un={class:"main"},_n=["onClick"],mn=P({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:d}){const t=r,n=d,c=Object.values(Le);function m(v){n("update:modelValue",v)}return(v,f)=>(s(),T(te,null,{button:w(()=>[e("div",cn,g(t.modelValue),1)]),popup:w(({hide:y})=>[e("div",un,[(s(!0),o(V,null,j(a(c),u=>(s(),o("div",{class:"base-hover option",onClick:l=>{m(u),y()}},g(u),9,_n))),256))])]),_:1}))}});const vn=L(mn,[["__scopeId","data-v-cc9d0d61"]]),yn=r=>(B("data-v-a27bea28"),r=r(),q(),r),hn=yn(()=>e("i",{class:"bi bi-three-dots-vertical"},null,-1)),gn={class:""},fn={class:"d-flex ipt"},bn={class:"ms-2",min:"1"},$n=P({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(r,{emit:d}){const t=r,n=d,c=C(1),m=C(Le.Year);function v(){t.option.stepSize==c.value&&t.option.stepUnit==m.value||n("change",{stepSize:c.value,stepUnit:m.value})}function f(){c.value=t.option.stepSize??1,m.value=t.option.stepUnit}return H(()=>t.option,f),pe(f),H(c,()=>{(c.value<1||c.value==null||isNaN(c.value))&&(c.value=1)}),(y,u)=>(s(),T(te,{onHide:v},{button:w(()=>[hn]),popup:w(({hide:l,focus:i})=>[e("div",gn,[e("div",fn,[e("div",null,[ue(e("input",{type:"number","onUpdate:modelValue":u[0]||(u[0]=p=>c.value=p)},null,512),[[ye,c.value]])]),e("div",bn,[$(vn,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=p=>m.value=p),onHide:i},null,8,["modelValue","onHide"])])])])]),_:1}))}});const kn=L($n,[["__scopeId","data-v-a27bea28"]]),wn={class:"d-flex flex-row group-form"},xn={class:"pt-1 pb-1"},In={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Sn={key:0,class:"bi bi-chevron-right smaller"},Cn=["onClick"],Mn=["onClick"],Fn=["onClick"],Tn=["onClick"],Vn=["onClick"],En=["onClick"],zn=["onClick"],Pn=["onClick"],On=["onClick"],Dn={key:5,class:"sm-btn"},Ln={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Gn=P({__name:"GroupForm",props:{isLoading:Boolean,manager:Je},setup(r){const d=Z(),t=r;function n(l){t.manager.setGroupOption(l),t.manager.update(!0)}function c(l){t.manager.delGroupOption(l),t.manager.update(!0)}function m(l,i){t.manager.setGroupOption(l,{direction:i}),t.manager.sortGroups(!0)}function v(l,i){t.manager.setGroupOption(l,{type:i}),t.manager.sortGroups(!0)}function f(l,i){t.manager.setGroupOption(l,i),t.manager.update(!0)}const y=x(()=>t.manager.state.groupBy.map(l=>d.properties[l])),u=x(()=>{const l=[];return t.manager.state.groupBy.forEach(i=>{l.push({option:t.manager.state.options[i],property:d.properties[i]})}),l});return(l,i)=>(s(),o("div",wn,[e("div",xn,g(l.$t("main.menu.groupby"))+": ",1),y.value.length?(s(),o("div",In,[(s(!0),o(V,null,j(u.value,(p,_)=>(s(),o(V,null,[_>0?(s(),o("i",Sn)):h("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:b=>c(p.property.id),id:"remove-group-button"},g(p.property.name),9,Cn),p.option.type==a(ae).Size?(s(),T(z,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:w(()=>[p.option.direction==a(ee).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:b=>v(p.property.id,a(ae).Property)},null,8,Mn)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:b=>v(p.property.id,a(ae).Property)},null,8,Fn))]),_:2},1024)):(s(),T(z,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:w(()=>[p.property.type==a(M).number?(s(),o(V,{key:0},[p.option.direction==a(ee).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:b=>v(p.property.id,a(ae).Size)},null,8,Tn)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:b=>v(p.property.id,a(ae).Size)},null,8,Vn))],64)):(s(),o(V,{key:1},[p.option.direction==a(ee).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:b=>v(p.property.id,a(ae).Size)},null,8,En)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:b=>v(p.property.id,a(ae).Size)},null,8,zn))],64))]),_:2},1024)),p.option.direction==a(ee).Ascending?(s(),T(z,{key:3,message:"main.menu.sort.order_asc"},{default:w(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:b=>m(p.property.id,a(ee).Descending)},null,8,Pn)]),_:2},1024)):(s(),T(z,{key:4,message:"main.menu.sort.order_desc"},{default:w(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:b=>m(p.property.id,a(ee).Ascending)},null,8,On)]),_:2},1024)),p.property.type==a(M).date?(s(),o("div",Dn,[$(kn,{option:p.option,onChange:b=>f(p.property.id,b)},null,8,["option","onChange"])])):h("",!0)],64))),256)),t.isLoading?(s(),o("i",Ln)):h("",!0)])):h("",!0),$(Ge,{id:"add-group-button","group-ids":t.manager.state.groupBy,onSelect:i[0]||(i[0]=p=>n(p))},null,8,["group-ids"])]))}});const Rn=L(Gn,[["__scopeId","data-v-388718c9"]]),jn={class:"d-flex flex-row sort-form"},Nn={class:"pt-1 pb-1"},Un={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Hn={key:0,class:"bi bi-chevron-right smaller"},An=["onClick"],Bn=["onClick"],qn=["onClick"],Kn=P({__name:"SortForm",props:{manager:et},setup(r){const d=Z(),t=r,n=x(()=>t.manager.state.sortBy.map(y=>({propertyId:y,direction:t.manager.state.options[y].direction}))),c=x(()=>n.value.map(y=>y.propertyId));function m(y){t.manager.setSort(y),t.manager.update(!0)}function v(y){t.manager.delSort(y),t.manager.update(!0)}function f(y,u){t.manager.setSort(y,{direction:u}),t.manager.update(!0)}return(y,u)=>(s(),o("div",jn,[e("div",Nn,g(y.$t("main.menu.sort.title"))+": ",1),n.value.length?(s(),o("div",Un,[(s(!0),o(V,null,j(n.value,(l,i)=>(s(),o(V,null,[i>0?(s(),o("i",Hn)):h("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:p=>v(l.propertyId)},g(a(d).properties[l.propertyId].name),9,An),l.direction==a(ee).Ascending?(s(),T(z,{key:1,message:"main.menu.sort.order_asc"},{default:w(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:p=>f(l.propertyId,a(ee).Descending)},null,8,Bn)]),_:2},1024)):(s(),T(z,{key:2,message:"main.menu.sort.order_desc"},{default:w(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:p=>f(l.propertyId,a(ee).Ascending)},null,8,qn)]),_:2},1024))],64))),256))])):h("",!0),$(Ge,{"group-ids":c.value,onSelect:u[0]||(u[0]=l=>m(l))},null,8,["group-ids"])]))}});const Qn=L(Kn,[["__scopeId","data-v-80dc564a"]]),ge=r=>(B("data-v-b6d30616"),r=r(),q(),r),Wn=ge(()=>e("i",{class:"bi bi-clock-history me-1"},null,-1)),Yn={class:"p-2"},Xn={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Zn={class:"border mb-1 p-1"},Jn={class:"me"},ea=ge(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),ta={key:0},sa={key:1},oa={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},na={class:"d-flex center justify-content-center"},aa={key:1,class:"bi bi-arrow-down text-secondary"},ia=ge(()=>e("div",{style:{width:"30px"}},null,-1)),la={key:3,class:"bi bi-arrow-up text-secondary"},ra={class:"border mb-1 p-1"},da={class:"me"},pa=ge(()=>e("span",{class:"sep ms-1 me-1"},null,-1)),ca={key:0},ua={key:1},_a={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},re=5,ma=P({__name:"HistoryDropdown",emits:[],setup(r,{emit:d}){const t=W(),n=C(!1),c=x(()=>n.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=x(()=>[...t.data.history.undo].reverse().slice(0,re)),v=x(()=>t.data.history.redo.slice(Math.max(t.data.history.redo.length-re,0)));return H(()=>t.status.onUndo,()=>{console.log("changed"),n.value=!0,setTimeout(()=>n.value=!1,100)}),(f,y)=>(s(),T(te,null,{button:w(()=>[e("div",{class:"d-flex sb flash",style:A([{"font-size":"14px"},c.value])},[Wn,e("div",null,g(f.$t("dropdown.history.button")),1)],4)]),popup:w(()=>[e("div",Yn,[a(t).data.history.redo.length>re?(s(),o("div",Xn," + "+g(a(t).data.history.redo.length-re),1)):h("",!0),(s(!0),o(V,null,j(v.value,u=>(s(),o("div",Zn,[e("span",Jn,g(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),ea,u.tags?(s(),o("span",ta,g(u.tags)+" "+g(f.$t("dropdown.history.tags")),1)):h("",!0),u.values?(s(),o("span",sa,g(u.values)+" "+g(f.$t("dropdown.history.values")),1)):h("",!0)]))),256)),e("div",oa,[e("div",na,[m.value.length?(s(),o("div",{key:0,class:"bi bi-arrow-down sb",onClick:y[0]||(y[0]=(...u)=>a(t).undo&&a(t).undo(...u))})):(s(),o("div",aa)),ia,v.value.length?(s(),o("div",{key:2,class:"bi bi-arrow-up sb",onClick:y[1]||(y[1]=(...u)=>a(t).redo&&a(t).redo(...u))})):(s(),o("div",la))])]),(s(!0),o(V,null,j(m.value,u=>(s(),o("div",ra,[e("span",da,g(new Date(u.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),pa,u.tags?(s(),o("span",ca,g(u.tags)+" "+g(f.$t("dropdown.history.tags")),1)):h("",!0),u.values?(s(),o("span",ua,g(u.values)+" "+g(f.$t("dropdown.history.values")),1)):h("",!0)]))),256)),a(t).data.history.undo.length>re?(s(),o("div",_a," + "+g(a(t).data.history.undo.length-re),1)):h("",!0)])]),_:1}))}});const va=L(ma,[["__scopeId","data-v-b6d30616"]]),Re=r=>(B("data-v-f165491a"),r=r(),q(),r),ya={key:0,class:"bi bi-arrow-repeat text-warning"},ha={key:1,class:"bi bi-check2-all text-success"},ga={key:2},fa=Re(()=>e("span",{class:"bi bi-check2-all text-success small-valid"},null,-1)),ba=Re(()=>e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}},null,-1)),$a=[fa,ba],ka=P({__name:"ToggleReload",emits:[],setup(r,{emit:d}){const t=W(),n=x(()=>t.getTab().autoReload?2:t.getTabManager().collection.state.isDirty?0:1);function c(){n.value==0?t.getTabManager().collection.update():n.value==1?(t.getTab().autoReload=!0,t.updateTabs()):(t.getTab().autoReload=!1,t.updateTabs())}return(m,v)=>(s(),o("div",{class:"bb font",onClick:c,style:{width:"26px",height:"30px",overflow:"hidde"}},[n.value==0?(s(),o("span",ya)):h("",!0),n.value==1?(s(),o("span",ha)):h("",!0),n.value==2?(s(),o("span",ga,$a)):h("",!0)]))}});const wa=L(ka,[["__scopeId","data-v-f165491a"]]),Ce=r=>(B("data-v-fa8c26e0"),r=r(),q(),r),xa={class:"d-flex flex-row p-2"},Ia=Ce(()=>e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Sa=["placeholder"],Ca={class:"me-5 d-flex"},Ma=Ce(()=>e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Fa={class:"ms-5",style:{"font-size":"13px"}},Ta=["checked"],Va=Ce(()=>e("span",{class:"ms-1"},"Mode Image unique",-1)),Ea={class:"ms-4"},za={class:"d-flex flex-wrap content-container ps-2"},Pa=P({__name:"ContentFilter",props:{tab:tt,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(r,{emit:d}){W();const t=r,n=C(""),c=x(()=>Object.keys(t.tab.collection.groupManager.selectedImages.value).map(Number)),m=x(()=>c.value.length);function v(l){const i=l.target.checked;t.tab.collection.groupManager.setSha1Mode(i,!0)}function f(){n.value=t.tab.state.filterState.query}function y(){t.tab.collection.filterManager.setQuery(n.value),t.tab.collection.filterManager.update(!0)}function u(){t.tab.collection.filterManager.setQuery(""),t.tab.collection.filterManager.update(!0)}return pe(f),H(()=>t.tab.collection.filterManager.state.query,f),(l,i)=>(s(),o(V,null,[e("div",xa,[$(z,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:w(()=>[e("div",{class:N(["d-flex flex-row search-input me-5",n.value?"border-primary":""])},[Ia,ue(e("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":i[0]||(i[0]=p=>n.value=p),onChange:y},null,40,Sa),[[ye,n.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:u},"x")],2)]),_:1}),e("div",Ca,[$(z,{message:"main.menu.grid_tooltip"},{default:w(()=>[e("i",{class:N("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(t.tab.state.display=="tree"?"":" text-secondary")),onClick:i[1]||(i[1]=p=>t.tab.state.display="tree")},null,2)]),_:1}),$(z,{message:"main.menu.table_tooltip"},{default:w(()=>[e("i",{id:"toot",class:N("bi bi-table btn-icon"+(t.tab.state.display=="grid"?"":" text-secondary")),onClick:i[2]||(i[2]=p=>t.tab.state.display="grid")},null,2)]),_:1})]),$(z,{message:"main.menu.image_size_tooltip",click:!1},{default:w(()=>[Ma]),_:1}),e("div",null,[$(st,{min:30,max:500,modelValue:t.tab.state.imageSize,"onUpdate:modelValue":i[3]||(i[3]=p=>t.tab.state.imageSize=p)},null,8,["modelValue"])]),e("div",Fa,[$(z,{message:"main.menu.image_mode_tooltip"},{default:w(()=>[e("input",{type:"checkbox",checked:t.tab.collection.groupManager.state.sha1Mode,onChange:v},null,40,Ta),Va]),_:1})]),e("div",Ea,[$(va)]),m.value?(s(),T(ot,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":c.value,"onRemove:selected":i[4]||(i[4]=p=>t.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):h("",!0)]),e("div",za,[$(wa,{class:"me-1"}),$(an,{manager:t.tab.collection.filterManager},null,8,["manager"]),$(Rn,{"is-loading":t.computeStatus.groups,manager:t.tab.collection.groupManager},null,8,["is-loading","manager"]),$(Qn,{manager:t.tab.collection.sortManager},null,8,["manager"])])],64))}});const Oa=L(Pa,[["__scopeId","data-v-fa8c26e0"]]),Da={class:""},La=["src"],Ga={class:"d-flex flex-row"},Ra=P({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(r,{emit:d}){const t=Se(),n=r,c=d,m=x(()=>`width: ${n.size}px; height: ${n.size}px;`),v=x(()=>`max-width: ${n.size-2}px; max-height: ${n.size-1}px;`),f=x(()=>n.pile.images[0]);return(y,u)=>(s(),o("div",Da,[$(nt,{image:f.value},{default:w(()=>[e("div",{style:A(m.value),class:"img-container",onClick:u[0]||(u[0]=l=>a(t).showModal(a(ie).IMAGE,{image:f.value}))},[e("img",{src:f.value.url,style:A(v.value)},null,12,La)],4)]),_:1},8,["image"]),e("div",Ga,[$(z,{message:"main.recommand.accept"},{default:w(()=>[e("div",{style:A(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:u[1]||(u[1]=l=>c("accept",f.value))}," ✓ ",4)]),_:1}),$(z,{message:"main.recommand.refuse"},{default:w(()=>[e("div",{style:A(["width: "+n.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:u[2]||(u[2]=l=>c("refuse",f.value))}," ✕ ",4)]),_:1})])]))}});const ja=L(Ra,[["__scopeId","data-v-6540ad86"]]),me=r=>(B("data-v-ab069839"),r=r(),q(),r),Na={class:"reco-container"},Ua={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Ha=me(()=>e("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),Aa=[Ha],Ba=me(()=>e("div",{class:"b-left pe-1"},null,-1)),qa=me(()=>e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Ka=[qa],Qa=me(()=>e("div",{class:"b-left pe-1"},null,-1)),Wa={key:0,class:"bi bi-funnel-fill bb text-primary"},Ya={key:1,class:"bi bi-funnel bb"},Xa=me(()=>e("div",{class:"b-left pe-1"},null,-1)),Za={class:"text-secondary me-2"},Ja={class:"flex-grow-1"},ei={class:"d-flex flex-row"},ti={key:0,class:"separator"},si={class:"d-flex flex-row"},$e=10,oi=P({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(r,{emit:d}){const t=W(),n=Z(),c=at(),m=r,v=d,f=C(1),y=de([]),u=de([]),l=de([]),i=de(new Set),p=C(!0);function _(O){let I=u.indexOf(O);I<0||(u.splice(I,1),E())}async function b(O){const I=[],S=[];l.forEach(F=>{if(F.value!=lt){const D=n.properties[F.propertyId];let G=F.value;D.type==M.multi_tags?(G=O.properties[F.propertyId]??[],G=[...G,F.value]):D.type==M.tag&&(G=[G]),D.mode==xe.id?S.push({instanceId:O.id,propertyId:D.id,value:G}):I.push({propertyId:D.id,sha1:O.sha1,value:G})}}),await t.setPropertyValues(S,I),_(O.sha1)}function k(O){i.add(O.sha1),_(O.sha1)}function E(){y.length=0;const O=u.map(I=>({sha1:I,images:n.sha1Index[I]}));Y(O,y,f.value,m.imageSize,m.width)}function Y(O,I,S,F,D){let G=D,R=[],Q=0;for(let J=0;J<O.length&&!(I.length>=S);J++){let ce=O[J];if(i.has(ce.sha1))continue;let fe=F+$e;if(Q+fe<G){R.push(ce),Q+=fe;continue}if(R.length==0)throw new Error("Images seems to be to big for the line");I.push(R),I.length<S&&(R=[ce],Q=fe)}R.length>0&&I.length<S&&I.push(R)}async function se(){if(!m.group)return;console.log("get reco");const O=m.group.images.map(R=>R.id);let I=await c.getSimilarImages({instanceIds:O});if(console.log(I),!I.instances)throw new Error("No instances in ActionResult");let S=[];const F=I.instances.scores??[];if(I.instances.ids)for(let R in I.instances.ids){const Q={id:I.instances.ids[R],score:F[R]};S.push(Q)}else for(let R in I.instances.sha1s){const Q=I.instances.sha1s[R];for(let J of n.sha1Index[Q]){const ce={id:J.id,score:F[R]};S.push(ce)}}if(S.sort((R,Q)=>Q.score-R.score),p.value){const R=t.getTabManager(),Q=new Set(R.collection.groupManager.result.root.images.map(J=>J.id));S=S.filter(J=>Q.has(J.id))}const D=Array.from(new Set(S.map(R=>n.instances[R.id].sha1)));l.length=0;let G=m.group;for(;G;)l.push(...G.meta.propertyValues),G=G.parent;u.length=0,u.push(...D),i.clear(),E(),v("update")}function ne(){p.value=!p.value}return pe(se),H(()=>m.group,()=>{se(),i.clear()}),H(()=>m.imageSize,E),H(()=>m.width,E),H(p,se),(O,I)=>(s(),o("div",Na,[e("div",Ua,[e("div",{class:"text-secondary pe-1",onClick:I[0]||(I[0]=S=>v("close"))},Aa),Ba,e("div",{class:"text-secondary pe-1",onClick:I[1]||(I[1]=S=>v("scroll",m.group.id))},Ka),Qa,e("div",{class:"text-secondary pe-1",onClick:ne},[p.value?(s(),o("span",Wa)):(s(),o("span",Ya))]),Xa,$(z,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:w(()=>[e("span",Za,g(O.$t("main.recommand.title")),1)]),_:1}),e("div",Ja,[e("div",ei,[(s(!0),o(V,null,j(l,(S,F)=>(s(),o(V,null,[$(it,{class:"",value:S},null,8,["value"]),F<l.length-1?(s(),o("div",ti)):h("",!0)],64))),256))])])]),e("div",{style:A("margin-left:"+$e+"px;")},[(s(!0),o(V,null,j(y,S=>(s(),o("div",null,[e("div",si,[(s(!0),o(V,null,j(S,F=>(s(),T(ja,{pile:F,size:m.imageSize,onAccept:b,onRefuse:k,style:A("margin-right:"+$e+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const ni=L(oi,[["__scopeId","data-v-ab069839"]]),ai={key:0,class:"m-0 p-0"},ii={key:0,style:{"margin-left":"10px"}},li=P({__name:"MainView",props:{tabId:Number,height:Number},setup(r){const d=W(),t=d.getTabManager(),n=r,c=C({}),m=C(null),v=C(null),f=C(null);C([]);const y=C(0),u=C(0),l=de({groups:!1}),i=x(()=>t.getVisibleProperties());function p(){m.value&&v.value?y.value=n.height-m.value.clientHeight-v.value.clientHeight-5:m.value?y.value=n.height-m.value.clientHeight-5:y.value=0}t.collection.groupManager.onChange.addListener(()=>{f.value&&t.state.display=="tree"&&f.value.computeLines()});function _(k){c.value=t.collection.groupManager.result.index[k],oe(()=>p())}function b(){c.value={},oe(()=>p())}return pe(()=>{u.value=m.value.clientWidth,window.addEventListener("resize",()=>{oe(()=>{var k;u.value=((k=m.value)==null?void 0:k.clientWidth)??u.value})})}),H(t.state,k=>{d.updateTabs()},{deep:!0}),H(()=>t.state.imageSize,()=>oe(p)),H(()=>n.height,async()=>{await oe(p)}),(k,E)=>(s(),o(V,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:m},[$(Oa,{tab:a(t),"compute-status":l},null,8,["tab","compute-status"])],512),e("div",{ref_key:"boxElem",ref:v,class:"m-0 p-0"},[c.value.id?(s(),o("div",ai,[$(ni,{group:c.value,"image-size":a(t).state.imageSize,width:u.value,height:50,onClose:b,onScroll:f.value.scrollTo,onUpdate:E[0]||(E[0]=Y=>oe(()=>p()))},null,8,["group","image-size","width","onScroll"])])):h("",!0)],512),u.value>0&&y.value>0?(s(),o("div",ii,[a(t).state.display=="tree"?(s(),T(rt,{key:0,"group-manager":a(t).collection.groupManager,"image-size":a(t).state.imageSize,height:y.value-0,properties:i.value,"hide-if-modal":!0,"selected-images":a(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:f,width:u.value-25,onRecommend:_},null,8,["group-manager","image-size","height","properties","selected-images","width"])):h("",!0),a(t).state.display=="grid"?(s(),o("div",{key:1,style:A({width:u.value-12+"px"}),class:"p-0 m-0 grid-container"},[$(dt,{manager:a(t).collection.groupManager,height:y.value-15,width:u.value-40,"selected-properties":i.value,class:"p-0 m-0","show-images":!0,"selected-images":a(t).collection.groupManager.selectedImages,ref_key:"imageList",ref:f,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):h("",!0)])):h("",!0)],64))}});const ri=L(li,[["__scopeId","data-v-1e8d8908"]]),di={class:"d-flex d-row",style:{cursor:"pointer"}},pi=["onMouseenter","onMouseleave"],ci=["onClick"],ui=["onClick"],_i=["onClick"],mi=["onSubmit"],vi=["onKeydown","onUpdate:modelValue"],yi=e("span",{class:"bi bi-plus"},null,-1),hi=[yi],gi={class:"lang"},fi=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),bi=["value"],$i=P({__name:"TabNav",props:{reRender:Function},setup(r){const d=W(),t=C(-1),n=C(""),c=C(null),m=r;function v(_){d.data.selectedTabId==_||y(),d.selectTab(_)}function f(_){t.value=_,n.value=d.data.tabs[_].name,oe(()=>c.value[0].focus())}function y(){t.value=-1,n.value=""}function u(_){d.addTab("New Tab")}async function l(_){confirm("Are you sure to delete Tab: "+_.name)&&await d.removeTab(_.id)}const i=de({});C(-1);const p=["fr","en"];return(_,b)=>(s(),o("nav",null,[e("div",di,[(s(!0),o(V,null,j(a(d).data.tabs,k=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:E=>i[k.id]=!0,onMouseleave:E=>i[k.id]=!1},[t.value!=k.id?(s(),o(V,{key:0},[$(z,{message:"main.menu.rename_tab_tooltip"},{default:w(()=>[e("i",{onClick:E=>f(k.id),class:N(["bi bi-pencil me-1 tab-icon hover-light",i[k.id]&&a(d).data.selectedTabId==k.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,ci)]),_:2},1024),e("div",{class:N(["tab-button",k.id==a(d).data.selectedTabId?" active":""]),onClick:E=>v(k.id)},[e("span",null,g(k.name),1)],10,ui),$(z,{message:"main.menu.delete_tab_tooltip"},{default:w(()=>[e("i",{onClick:E=>l(k),class:N(["btn-icon bi bi-x tab-icon hover-light",i[k.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,_i)]),_:2},1024)],64)):(s(),o("div",{key:1,class:N(["tab-button",k.id==a(d).data.selectedTabId?" active":""])},[e("form",{onSubmit:Oe(y,["stop","prevent"])},[ue(e("input",{onFocusout:y,onKeydown:pt(y,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":E=>k.name=E,ref_for:!0,ref_key:"inputElem",ref:c},null,40,vi),[[ye,k.name]])],40,mi)],2))],40,pi))),256)),$(z,{message:"main.menu.add_tab_tooltip"},{default:w(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:u,id:"add-tab-button"},hi)]),_:1}),e("div",gi,[fi,ue(e("select",{"onUpdate:modelValue":b[0]||(b[0]=k=>_.$i18n.locale=k),onChange:b[1]||(b[1]=k=>m.reRender())},[(s(),o(V,null,j(p,(k,E)=>e("option",{key:`Lang${E}`,value:k},g(k.toUpperCase()),9,bi)),64))],544),[[ct,_.$i18n.locale]])])])]))}});const je=r=>(B("data-v-6c59c855"),r=r(),q(),r),ki={class:"d-flex flex-row m-0 p-0 overflow-hidden"},wi={key:0},xi={key:1,class:"w-100"},Ii={key:0,class:"custom-hr"},Si={key:2,class:"loading"},Ci={class:"text-center"},Mi={key:3,class:"loading"},Fi=je(()=>e("i",{class:"spinner-border",role:"status"},null,-1)),Ti=je(()=>e("span",{class:"ms-1"},"Loading...",-1)),Vi=[Fi,Ti],Ei=P({__name:"PanopticView",setup(r){const d=W(),t=Se(),n=C(null),c=C(null),m=C(window.innerHeight),v=C(!1),f=x(()=>{var _;return m.value-(((_=c.value)==null?void 0:_.clientHeight)??0)}),y=x(()=>{var _;return(_=n.value)==null?void 0:_.filteredImages.map(b=>b.id)});pe(async()=>{t.isProjectLoaded||Te.push("/"),oe(()=>{window.addEventListener("resize",u),u()}),window.addEventListener("keydown",_=>{_.key=="Control"&&(U.ctrl=!0),_.key=="Alt"&&(U.alt=!0),_.key=="Shift"&&(U.shift=!0),_.key=="ArrowLeft"&&(U.left=!0),_.key=="ArrowRight"&&(U.right=!0,console.log("keeeyy")),_.key=="Z"&&U.ctrl&&d.redo(),_.key=="z"&&U.ctrl&&d.undo()}),window.addEventListener("keyup",_=>{_.key=="Control"&&(U.ctrl=!1),_.key=="Alt"&&(U.alt=!1),_.key=="Shift"&&(U.shift=!1),_.key=="ArrowLeft"&&(U.left=!1),_.key=="ArrowRight"&&(U.right=!1)}),window.addEventListener("mousemove",_=>{U.ctrl=_.ctrlKey,U.alt=_.altKey,U.shift=_.shiftKey})}),ut(()=>{window.removeEventListener("resize",u)});function u(){m.value=window.innerHeight,v.value=!0}function l(){t.showModal(ie.EXPORT,y)}function i(){d.rerender()}function p(){Te.push("/")}return(_,b)=>(s(),o(V,null,[$(_t,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:a(d).status.renderNb},[e("div",ki,[a(d).status.loaded?(s(),o("div",wi,[$(Zs,{onExport:b[0]||(b[0]=k=>l())})])):h("",!0),a(d).status.loaded?(s(),o("div",xi,[e("div",{class:"ms-3",ref_key:"navElem",ref:c},[$($i,{"re-render":i})],512),v.value?(s(),o("div",Ii)):h("",!0),a(d).status.loaded?(s(),T(ri,{key:1,"tab-id":a(d).data.selectedTabId,height:f.value,ref_key:"mainViewRef",ref:n},null,8,["tab-id","height"])):h("",!0)])):a(t).isProjectLoaded?(s(),o("div",Mi,Vi)):(s(),o("div",Si,[e("div",Ci,[e("div",null,g(_.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:p,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Oi=L(Ei,[["__scopeId","data-v-6c59c855"]]);export{Oi as default};
