import{d as E,Q as Ee,u as pe,S as ae,z as Q,r as M,c as T,V as W,o as t,a as l,b as e,F as G,q as y,W as ce,t as x,h as f,k as V,w as ue,v as ge,e as u,X as Ve,M as oe,l as k,Y as F,Z as he,$ as me,n as q,O as K,a0 as xe,i as ee,s as B,D as te,a1 as Le,_ as A,a2 as De,a3 as $e,f as X,a4 as Me,a5 as fe,a6 as Se,m as ne,G as Re,g as be,a7 as Ae,a8 as je,a9 as Ce,aa as Ue,ab as Be,J as Ne,ac as He,ad as We,K as qe,R as Ke,L as Qe,ae as Ye,af as Xe,ag as Ze,ah as ze,j as J,ai as Fe,aj as Je,ak as le,al as se,am as et,an as tt,ao as st,ap as ot,aq as lt,ar as at,as as nt,at as de,au as it,av as rt,aw as dt,ax as ut,ay as Te,az as pt,aA as ct,x as mt,aB as vt,p as Ie,A as U}from"./index-952241fc.js";import{_ as gt}from"./Tutorial-21c1846a.js";const ve={},ft={class:"d-flex flex-row"},_t={key:2,class:"d-flex",style:{width:"150px"}},yt={class:"flex-grow-1"},ht={key:1,style:{"padding-top":"1px"}},bt={style:{width:"20px","margin-top":"2px"},class:"text-center"},kt={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},xt={key:0},$t={key:0,class:"ms-3 pt-1"},wt={class:"options hover-light"},St={class:"p-1",style:{"min-width":"100px"}},Ct={key:1,class:"custom-hr mt-1 mb-1"},It=["onClick"],Vt={key:1},Mt=E({__name:"PropertyOptions",props:{property:{},open:{type:Boolean}},setup($){const{t:m}=Ee({useScope:"global"}),s=pe(),o=ae(),d=Q(),c=o.getTabManager(),a=$,h=M(!1),v=M(!1),i=M(""),r=M(!1),n=T(()=>o.getTab()),p=T(()=>n.value.visibleProperties[a.property.id]==!0),b=T(()=>c.collection.filterManager.state.filter.filters.some(D=>!D.isGroup&&D.propertyId==a.property.id)),S=T(()=>c.collection.groupManager.state.groupBy.includes(a.property.id)),O=T(()=>c.collection.sortManager.state.sortBy.includes(a.property.id)),R=T(()=>{if(b.value)return c.collection.filterManager.state.filter.filters.find(D=>!D.isGroup&&D.propertyId==a.property.id).id}),C=()=>c.collection.filterManager,g=T(()=>c.getSha1Mode());function I(){p.value?c.setVisibleProperty(a.property.id,!1):c.setVisibleProperty(a.property.id,!0)}function _(){a.open&&(h.value?h.value=!1:(h.value=!0,i.value=a.property.name),v.value=!1)}function w(){a.property.type!=K.tag&&a.property.type!=K.multi_tags||(v.value?v.value=!1:v.value=!0,h.value=!1)}function P(){O.value?c.collection.sortManager.delSort(a.property.id):c.collection.sortManager.setSort(a.property.id),c.collection.sortManager.update(!0)}function N(){S.value?c.collection.groupManager.delGroupOption(a.property.id):c.collection.groupManager.setGroupOption(a.property.id),c.collection.groupManager.update(!0)}function L(){confirm(m("common.properties.delete")+": "+a.property.name+" ?   "+a.property.id)&&d.deleteProperty(a.property.id)}async function H(){i.value!=""&&(await d.updateProperty(a.property.id,i.value),_())}function Z(){const D=C();b.value?(D.deleteFilter(R.value),ve.filter.hide()):(D.addNewFilter(a.property.id),ve.filter.show())}function j(D){d.updateProperty(a.property.id,a.property.name,D)}return W(()=>a.property,()=>{h.value=!1}),(D,z)=>(t(),l("div",{class:q(r.value?"hover-light":"")},[e("div",ft,[a.open?(t(),l(G,{key:0},[h.value?f("",!0):(t(),l("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:_},[y(ce,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:z[0]||(z[0]=Y=>r.value=!0),onMouseleave:z[1]||(z[1]=Y=>r.value=!1)},null,8,["type"]),e("span",null,x(a.property.name),1)]))],64)):(t(),V(ce,{key:1,type:a.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),h.value&&a.open?(t(),l("div",_t,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:_,onMouseenter:z[2]||(z[2]=Y=>r.value=!0),onMouseleave:z[3]||(z[3]=Y=>r.value=!1)},null,32)]),e("div",yt,[a.property.id>=0?ue((t(),l("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":z[4]||(z[4]=Y=>i.value=Y),onChange:H},null,544)),[[ge,i.value]]):(t(),l("span",ht,[y(ce,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(a.property.name),1)]))])])):f("",!0),a.open?(t(),l(G,{key:3},[u(Ve)(a.property.type)?(t(),l("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:z[5]||(z[5]=Y=>u(s).showModal(u(oe).TAG,{propId:a.property.id}))},[y(F,{click:!1,message:"main.nav.properties.open_tags"},{default:k(()=>z[8]||(z[8]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",bt,[a.property.mode==u(he).id?(t(),V(F,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>z[9]||(z[9]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:I,class:"btn-icon text-center"},[g.value&&a.property.mode==u(he).id?(t(),V(F,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[e("span",{class:"bi bi-eye-slash",onClick:z[6]||(z[6]=me(()=>{},["stop"]))})]),_:1})):(t(),V(F,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[e("span",{class:q("bi bi-eye text-"+(p.value?"primary":"secondary"))},null,2)]),_:1}))]),a.open?(t(),l("div",kt,[a.property.type==u(K).tag||a.property.type==u(K).multi_tags?(t(),l("div",{key:0,onClick:w,style:{cursor:"pointer"}},[v.value?(t(),V(F,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>z[10]||(z[10]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(t(),V(F,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>z[11]||(z[11]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),a.open?(t(),l("div",xt,[h.value?(t(),l("div",$t,[D.property.id!=u(xe).folders?(t(),l("div",{key:0,class:q(["options hover-light",b.value?" text-primary":""]),onClick:Z},[e("div",null,[z[12]||(z[12]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ee(x(D.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:q(["options hover-light",O.value?" text-primary":""]),onClick:P},[z[13]||(z[13]=e("i",{class:"bi bi-filter me-2"},null,-1)),ee(x(D.$t("main.menu.sort.title")),1)],2),e("div",{class:q(["options hover-light",S.value?" text-primary":""]),onClick:N},[z[14]||(z[14]=e("i",{class:"bi bi-collection me-2"},null,-1)),ee(x(D.$t("main.menu.groupby")),1)],2),a.property.id>=0?(t(),l("div",{key:1,class:"options hover-light",onClick:L},[z[15]||(z[15]=e("i",{class:"bi bi-trash me-2"},null,-1)),ee(x(D.$t("main.nav.properties.delete_property")),1)])):f("",!0),a.property.id>=0&&u(d).propertyGroupsList.length?(t(),V(te,{key:2,teleport:!0},{button:k(()=>[e("div",wt,[z[16]||(z[16]=e("i",{class:"bi bi-folder me-1"},null,-1)),ee(" "+x(D.$t("main.nav.properties.set_group")),1)])]),popup:k(()=>[e("div",St,[a.property.propertyGroupId&&u(d).propertyGroups[a.property.propertyGroupId]?(t(),l("div",{key:0,class:"bb",onClick:z[7]||(z[7]=Y=>j(null))},"None")):f("",!0),a.property.propertyGroupId&&u(d).propertyGroups[a.property.propertyGroupId]?(t(),l("div",Ct)):f("",!0),(t(!0),l(G,null,B(u(d).propertyGroupsList,Y=>(t(),l("div",{class:"bb",onClick:we=>j(Y.id)},x(Y.name),9,It))),256))])]),_:1})):f("",!0)])):v.value?(t(),l("div",Vt,[y(Le,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}});const ke=A(Mt,[["__scopeId","data-v-e6b06f93"]]),zt={class:"text-nowrap"},Ft=["onClick"],Tt=["onClick"],Gt=E({__name:"FolderOptionDropdown",props:{folder:{}},setup($){const m=Q(),s=$;function o(){m.reImportFolder(s.folder.id)}function d(){confirm(De.global.t("main.nav.folders.del_alert"))&&m.deleteFolder(s.folder.id)}return(c,a)=>(t(),V(te,{teleport:!0},{button:k(()=>a[0]||(a[0]=[e("i",{class:"bi bi-three-dots base-hover"},null,-1)])),popup:k(({hide:h})=>[e("div",zt,[e("div",{class:"p-2 bb",onClick:v=>{o(),h()}},a[1]||(a[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ee("Re import")]),8,Ft),a[3]||(a[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:v=>{d(),h()}},[a[2]||(a[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),ee(x(c.$t("main.nav.folders.del")),1)],8,Tt)])]),_:1}))}}),Pt=["onMouseenter"],Ot={style:{display:"inline"}},Et=["onClick"],Lt={class:"text-secondary"},Dt=["onClick"],Rt=E({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:$e,root:{type:Boolean,default:!0}},setup($){const m=Q(),s=$,o=M(null),d=T(()=>{let r={};const n=new Set(s.filterManager.state.folders);return s.folders.map(p=>p.id).forEach(p=>{n.has(p)&&(r[p]=!0)}),r}),c=T(()=>{let r={};return s.folders.map(n=>n.id).forEach(n=>{s.visibleFolders[n]&&(r[n]=!0)}),r}),a=T(()=>{let r={};return s.folders.forEach(n=>{let p=[];d.value[n.id]&&p.push("selected"),r[n.id]=p.join(" ")}),r});function h(r){let n=s.visibleFolders;n[r]?delete n[r]:n[r]=!0}function v(r){let n=new Set(s.filterManager.state.folders);const p=n.has(r),b=m.folders[r].parent!=null&&n.has(m.folders[r].parent);p&&!b?(n.delete(r),fe(r).forEach(S=>n.delete(S.id))):(i(r,n),n.add(r),fe(r).forEach(S=>n.add(S.id)),Se(m.folders[r]).forEach(S=>n.delete(S.id))),s.filterManager.setFolders(Array.from(n)),s.filterManager.update(!0)}function i(r,n){const p=Se(m.folders[r]);let b;for(let S of p)if(n.has(S.id))b=S;else break;b!=null&&fe(b.id).forEach(S=>n.delete(S.id))}return(r,n)=>{const p=Me("FolderList2",!0);return t(),l("ul",{class:q(s.root?"tree":""),style:X(s.root?"padding-left:0px;":"")},[(t(!0),l(G,null,B($.folders,b=>(t(),l("li",{style:X(s.root?"padding-left:0px;":""),class:"no-break",onMouseenter:S=>o.value=b.id,onMouseleave:n[0]||(n[0]=S=>o.value=null)},[e("div",Ot,[e("summary",{class:q(a.value[b.id]),onClick:S=>v(b.id)},[ee(x(b.name)+" ",1),e("span",Lt,x(u(m).folders[b.id].count),1)],10,Et)]),b.children&&b.children.length>0?(t(),l("i",{key:0,onClick:S=>h(b.id),class:q("bi bi-chevron-"+(c.value[b.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Dt)):f("",!0),e("span",{class:q(o.value===b.id?"visible-option":"invisible-option")},[y(Gt,{folder:b,style:{display:"inline-block"}},null,8,["folder"])],2),b.children&&b.children.length>0&&c.value[b.id]?(t(),V(p,{key:1,folders:b.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,Pt))),256))],6)}}});const At=A(Rt,[["__scopeId","data-v-2aa7e825"]]),jt={class:"text-center"},Ut={class:"w-100 text-center",style:{"font-size":"10px"}},Bt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Nt=E({__name:"TaskStatus",props:{task:{}},setup($){const m=$,s=T(()=>m.task.total-m.task.remain-m.task.computing),o=T(()=>m.task.total);return(d,c)=>(t(),l("div",jt,[ee(x(m.task.name)+" ",1),e("div",Ut,x(s.value)+" / "+x(o.value)+" "+x(d.$t("main.nav.tasks.done")),1),o.value>0?(t(),l("div",Bt,[e("div",{class:"progress-bar",style:X(`width: ${s.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),Ht={class:"prop-container"},Wt={key:0},qt={key:1},Kt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Qt={key:1,class:"ms-2"},Yt={key:0,class:"ps-1 pe-1 pt-1"},Xt={class:"property-item"},Zt=E({__name:"PropertyGroup",props:{group:{},menuOpen:{type:Boolean}},setup($){const m=Q(),s=$,o=M(!0),d=M(!1),c=M(""),a=T(()=>m.propertyList.filter(n=>n.propertyGroupId==s.group.id));function h(){o.value=!o.value}function v(n){m.updatePropertyGroup(s.group.id,c.value)}function i(){c.value=s.group.name}function r(){m.deletePropertyGroup(s.group.id)}return ne(i),W(s,i),(n,p)=>(t(),l("div",Ht,[e("div",{class:"d-flex group-container",onClick:h},[o.value?(t(),l("div",Wt,p[3]||(p[3]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),o.value?f("",!0):(t(),l("div",qt,p[4]||(p[4]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),s.menuOpen?(t(),l(G,{key:2},[d.value?f("",!0):(t(),l("div",Kt,x(s.group.name),1)),d.value?(t(),l("div",Qt,[y(Re,{"auto-focus":!0,modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=b=>c.value=b),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:v,onCancel:i,onBlur:p[1]||(p[1]=b=>d.value=!1)},null,8,["modelValue"])])):f("",!0),p[7]||(p[7]=e("div",{class:"flex-grow-1"},null,-1)),d.value?f("",!0):(t(),l("div",{key:2,class:"bb me-1",onClick:p[2]||(p[2]=me(b=>d.value=!0,["stop"]))},p[5]||(p[5]=[e("i",{class:"bi bi-pencil"},null,-1)]))),e("div",{class:"bb me-1",onClick:me(r,["stop"])},p[6]||(p[6]=[e("i",{class:"bi bi-x"},null,-1)]))],64)):f("",!0)]),o.value&&a.value.length?(t(),l("div",Yt,[(t(!0),l(G,null,B(a.value,b=>(t(),l("div",Xt,[y(ke,{property:b,open:s.menuOpen},null,8,["property","open"])]))),256))])):f("",!0)]))}});const Jt=A(Zt,[["__scopeId","data-v-d0bd0120"]]),es={class:""},ts={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ss={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},os={key:0,class:"bi bi-chevron-left"},ls={key:1,class:"bi bi-chevron-right"},as={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ns={class:"d-flex align-items-center"},is={style:{"max-height":"300px",overflow:"auto"}},rs={key:0,id:"import"},ds={class:"pt-1 pb-2"},us={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},ps={key:0,class:"ps-2 pe-2"},cs={class:"p-1"},ms={key:0,class:"custom-hr"},vs={class:"p-1 mt-0"},gs={key:0,class:"d-flex p-1"},fs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},_s={key:1,class:"bb me-1"},ys={class:"bb me-2"},hs={key:1,class:"mt-2"},bs={style:{"padding-left":"0px"}},ks={class:"ps-1 pe-1"},xs={key:0,class:"property-item"},$s={class:"p-2 mt-0"},ws={key:1,class:"mt-2"},Ss={key:0,class:"property-item"},Cs=200,Is=55,Vs=E({__name:"Menu",emits:["export","toggle"],setup($,{emit:m}){const s=ae(),o=Q(),d=pe(),c=s.getTabManager(),a=m,h=M(!1),v=M(!1),i=M(!0),r=T(()=>i.value?Cs:Is),n=T(()=>o.propertyList.filter(C=>C.id>=0&&(!C.propertyGroupId||!o.propertyGroups[C.propertyGroupId]))),p=async C=>{d.showModal(oe.IMPORT)},b=T(()=>s.backendStatus.tasks.filter(C=>!C.done));function S(){d.showModal(oe.FOLDERSELECTION,{callback:O,mode:"images"})}function O(C){C&&o.addFolder(C)}function R(){i.value=!i.value,a("toggle")}return W(()=>s.status.import.to_import,()=>h.value=!0),(C,g)=>{var I;return t(),l("div",{class:"menu overflow-scroll",style:X({width:r.value+"px"})},[e("div",es,[e("div",null,[e("div",ts,[e("div",ss,[i.value?(t(),l(G,{key:0},[e("div",{class:"flex-grow-1 text-capitalize overflow-hidden",onClick:g[0]||(g[0]=()=>{})},x((I=u(d).data.status.selectedProject)==null?void 0:I.name),1),y(F,{message:"main.menu.close_project"},{default:k(()=>[e("div",{class:"base-hover p-1",onClick:g[1]||(g[1]=_=>u(d).closeProject())},g[7]||(g[7]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:g[2]||(g[2]=_=>u(d).showModal(u(oe).SETTINGS))},g[8]||(g[8]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:q(["base-hover p-1",i.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:R},[i.value?(t(),l("i",os)):(t(),l("i",ls))],2)])]),i.value?(t(),l(G,{key:0},[g[10]||(g[10]=e("div",{class:"custom-hr"},null,-1)),e("div",as,[e("div",ns,[e("div",null,[e("b",null,x(C.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:g[3]||(g[3]=_=>{S(),u(be)()})},[y(F,{message:"main.nav.folders.add"},{default:k(()=>g[9]||(g[9]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",is,[u(s).getTab()?(t(),V(At,{key:0,folders:u(o).folderRoots,"filter-manager":u(c).collection.filterManager,"visible-folders":u(c).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):f("",!0)])])],64)):f("",!0),i.value?(t(),l(G,{key:1},[b.value&&b.value.length?(t(),l("div",rs,[g[12]||(g[12]=e("div",{class:"custom-hr"},null,-1)),e("div",ds,[e("div",us,[e("div",null,[e("b",null,x(C.$t("main.nav.tasks.title")),1)])]),g[11]||(g[11]=e("div",{class:"custom-hr"},null,-1)),u(s).backendStatus?(t(),l("div",ps,[(t(!0),l(G,null,B(b.value,(_,w)=>(t(),l("div",cs,[w?(t(),l("div",ms)):f("",!0),y(Nt,{task:_},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),g[19]||(g[19]=e("div",{class:"custom-hr"},null,-1)),e("div",vs,[i.value?(t(),l("div",gs,[y(F,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[e("b",null,x(C.$t("main.nav.properties.title")),1)]),_:1}),g[14]||(g[14]=e("span",{class:"flex-grow-1"},null,-1)),v.value?(t(),l("span",fs,g[13]||(g[13]=[e("span",{class:"sr-only"},null,-1)]))):(t(),l("span",_s,[y(F,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:p})]),_:1})])),e("span",ys,[y(F,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:g[4]||(g[4]=_=>u(d).showModal(u(oe).EXPORT,void 0))})]),_:1})])])):f("",!0),u(s).status.loaded?(t(),l("div",hs,[(t(!0),l(G,null,B(u(Ae)(u(o).propertyGroups),_=>(t(),l("div",bs,[y(Jt,{group:_,class:"mb-1","menu-open":i.value},null,8,["group","menu-open"])]))),256)),(t(!0),l(G,null,B(n.value,_=>(t(),l("div",ks,[_.id>=0?(t(),l("div",xs,[y(ke,{property:_,open:i.value},null,8,["property","open"])])):f("",!0)]))),256)),i.value?(t(),l(G,{key:0},[g[17]||(g[17]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:g[5]||(g[5]=_=>{u(d).showModal(u(oe).PROPERTY,void 0),u(be)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[g[15]||(g[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(C.$t("main.nav.properties.add_property")),1)]),g[18]||(g[18]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:g[6]||(g[6]=_=>u(o).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[g[16]||(g[16]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(C.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)]),g[20]||(g[20]=e("div",{class:"custom-hr"},null,-1)),e("div",$s,[i.value?(t(),V(F,{key:0,message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[e("b",null,x(C.$t("main.nav.computed.title")),1)]),_:1})):f("",!0),u(s).status.loaded?(t(),l("div",ws,[(t(!0),l(G,null,B(u(o).properties,_=>(t(),l(G,null,[_.id<0&&_.id!=u(je)?(t(),l("div",Ss,[y(F,{pos:"bottom",message:"main.nav.computed."+Math.abs(_.id).toString()+"_tooltip"},{default:k(()=>[y(ke,{property:_,open:i.value},null,8,["property","open"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])],4)}}});const Ms=A(Vs,[["__scopeId","data-v-5e84ea35"]]),zs={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Fs={class:""},Ts=["onClick"],Gs=E({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup($,{emit:m}){const s=$,o=m;function d(c){o("update:modelValue",c)}return(c,a)=>(t(),V(te,null,{button:k(()=>[e("div",zs,[e("span",Fs,x(c.$t("modals.filters."+s.modelValue)),1)])]),popup:k(({hide:h})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:h},[e("div",{class:"base-btn",onClick:a[0]||(a[0]=v=>d(u(Ce).and))},x(c.$t("modals.filters.and")),1),a[2]||(a[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:a[1]||(a[1]=v=>d(u(Ce).or))},x(c.$t("modals.filters.or")),1)],8,Ts)]),_:1}))}}),Ps=["disabled"],Os={class:"m-0 p-1"},Es=["onClick"],Ls=E({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup($,{emit:m}){const s=Q(),o=$,d=m,c=T(()=>s.properties[o.propertyId]),a=T(()=>Ue(c.value.type));async function h(v){d("update:modelValue",v)}return(v,i)=>(t(),V(te,{onHide:i[0]||(i[0]=r=>d("hide")),placement:"bottom"},{button:k(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:o.disabled},[e("span",null,x(v.$t("modals.filters.operators."+o.modelValue)),1)],8,Ps)]),popup:k(({hide:r})=>[e("div",Os,[(t(!0),l(G,null,B(a.value,n=>(t(),l("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:p=>{h(n),r()}},[e("a",null,x(v.$t("modals.filters.operators."+n)),1)],8,Es))),256))])]),_:1}))}});const Ds=A(Ls,[["__scopeId","data-v-21b8bb8e"]]),Rs={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},As=E({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup($,{emit:m}){const s=$,o=m;function d(c){o("update:modelValue",c)}return(c,a)=>(t(),l("div",Rs,[u(Ve)(c.property.type)?(t(),V(Be,{key:0,"model-value":s.modelValue,"onUpdate:modelValue":d,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:s.property,teleport:!1,width:s.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):s.property.type==u(K).color?(t(),V(Ne,{key:1,"model-value":s.modelValue,"onUpdate:modelValue":d,width:s.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):s.property.type==u(K).number?(t(),V(He,{key:2,"model-value":s.modelValue,"onUpdate:modelValue":d,width:s.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):s.property.type==u(K).url?(t(),V(We,{key:3,"model-value":s.modelValue,"onUpdate:modelValue":d,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"])):s.property.type==u(K).checkbox?(t(),V(qe,{key:4,"model-value":s.modelValue,"onUpdate:modelValue":d,label:s.property.name,width:s.width,class:"sb"},null,8,["model-value","label","width"])):s.property.type==u(K).date?(t(),V(Ke,{key:5,"model-value":s.modelValue,teleport:!1,"onUpdate:modelValue":d,width:s.width,class:"sb"},null,8,["model-value","width"])):(t(),V(Qe,{key:6,"model-value":s.modelValue,"onUpdate:modelValue":d,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),js={class:"p-0 m-0 ps-2"},Us=E({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup($,{emit:m}){const s=Q(),o=$,d=T(()=>s.properties[o.filter.propertyId]),c=T(()=>Xe(o.filter.operator));function a(i){o.manager.updateFilter(o.filter.id,{operator:i})}function h(i){o.manager.updateFilter(o.filter.id,{value:i})}function v(i){o.manager.updateFilter(o.filter.id,{propertyId:i.id})}return(i,r)=>(t(),l(G,null,[e("td",js,[y(Ye,{"model-value":d.value,"onUpdate:modelValue":v},null,8,["model-value"])]),e("td",null,[y(Ds,{"property-id":d.value.id,"model-value":o.filter.operator,"onUpdate:modelValue":a},null,8,["property-id","model-value"])]),e("td",null,[c.value?(t(),V(As,{key:0,"model-value":o.filter.value,"onUpdate:modelValue":h,property:d.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),Bs={style:{"max-height":"500px",overflow:"auto"}},Ge=E({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup($,{emit:m}){const s=$;function o(d){s.manager.addNewFilter(d,s.group.id),ve.filter.show()}return(d,c)=>(t(),V(te,{placement:"auto"},{button:k(()=>[Ze(d.$slots,"default")]),popup:k(({hide:a})=>[e("div",Bs,[y(ze,{onSelect:h=>{o(h),a()},"ignore-ids":[u(xe).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Ns={class:"filter-group"},Hs={class:"table table-sm"},Ws={style:{height:"33px"}},qs={class:""},Ks={key:0,class:"m-0 p-0"},Qs={key:2,class:"text-secondary"},Ys={class:"border rounded"},Xs={class:""},Zs=["onClick"],Js={class:"d-flex text-secondary ms-2"},eo={class:"add-options hover-light"},to=E({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup($,{emit:m}){Q();const s=$,o=T(()=>s.filter),d=T(()=>o.value.filters),c=T(()=>{let i=255-(o.value.depth+1)*5;return`background: rgb(${i},${i},${i});`});function a(i){s.manager.deleteFilter(i.id)}function h(i){s.manager.addNewFilterGroup(i)}function v(i,r){s.manager.updateFilterGroup(i,r)}return(i,r)=>(t(),l("div",Ns,[e("table",Hs,[(t(!0),l(G,null,B(d.value,(n,p)=>(t(),l("tr",Ws,[e("td",qs,[p==0?(t(),l("div",Ks,x(i.$t("modals.filters.where")),1)):p==1?(t(),V(Gs,{key:1,"model-value":o.value.groupOperator,"onUpdate:modelValue":r[0]||(r[0]=b=>v(o.value.id,b))},null,8,["model-value"])):(t(),l("span",Qs,x(i.$t("modals.filters."+o.value.groupOperator)),1))]),n.propertyId!==void 0?(t(),V(Us,{key:0,filter:n,manager:s.manager},null,8,["filter","manager"])):(t(),l("td",{key:1,colspan:"3",style:X(c.value)},[e("div",Ys,[y(Pe,{filter:n,manager:s.manager},null,8,["filter","manager"])])],4)),e("td",Xs,[e("span",{class:"base-btn",onClick:b=>a(n)},r[2]||(r[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Zs)])]))),256))]),e("div",Js,[y(Ge,{group:s.filter,manager:s.manager},{default:k(()=>[e("div",eo,[r[3]||(r[3]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(i.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:r[1]||(r[1]=n=>h(o.value.id))},[r[4]||(r[4]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(i.$t("modals.filters.new_group")),1)])])]))}});const Pe=A(to,[["__scopeId","data-v-e644f737"]]),so={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},oo={key:0},lo={key:0,class:"or-separator"},ao={key:0,class:"or-separator"},no={key:0,class:"m-1 p-1"},io=E({__name:"MainFilterDropdown",props:{manager:$e},emits:["update:modelValue"],setup($,{emit:m}){const s=Q(),o=$,d=M(null),c=M(null),a=T(()=>{let v=h(o.manager.state.filter),i={};return v.forEach(r=>i[r.propertyId]=r),Object.values(i)});function h(v){let i=[];for(let r of v.filters)r.isGroup?i.push(...h(r)):i.push(r);return i}return W(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&c.value.hide()}),ne(async()=>{await J(),ve.filter=c.value}),(v,i)=>(t(),V(te,{ref_key:"dropdownElem",ref:c,placement:"top-start"},{button:k(()=>[e("div",null,[a.value.length||o.manager.state.query?(t(),l("div",so,[o.manager.state.query?(t(),l("div",oo,[i[0]||(i[0]=e("span",{class:"text-primary"},"Text Query",-1)),a.value.length?(t(),l("span",lo,"|")):f("",!0)])):f("",!0),(t(!0),l(G,null,B(a.value,(r,n)=>(t(),l("div",null,[n>0?(t(),l("span",ao,"|")):f("",!0),r.propertyId==u(xe).id?(t(),V(ce,{key:1,type:u(s).properties[r.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(u(s).properties[r.propertyId].name),1)]))),256))])):f("",!0)])]),popup:k(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:d},[Object.keys(u(s).properties).length>0?(t(),l("div",no,[y(Pe,{filter:o.manager.state.filter,manager:o.manager,parent:d.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const ro=A(io,[["__scopeId","data-v-56cd3bdb"]]),uo={class:"d-flex flex-row filter-form"},po={class:"pt-1 pb-1"},co=E({__name:"FilterForm",props:{manager:$e},setup($){const m=$;return(s,o)=>(t(),l("div",uo,[e("div",po,x(s.$t("main.menu.filters"))+": ",1),y(ro,{manager:m.manager},null,8,["manager"]),y(Ge,{manager:m.manager,group:m.manager.state.filter,class:"p-1"},{default:k(()=>o[0]||(o[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}});const mo=A(co,[["__scopeId","data-v-cc2f25ec"]]),vo={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},go=E({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup($,{emit:m}){const s=$,o=m,d=M(null);return(c,a)=>(t(),V(te,{ref_key:"dropdownElem",ref:d,"auto-focus":!1},{button:k(()=>a[2]||(a[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:k(()=>[e("div",vo,[y(ze,{onClick:a[0]||(a[0]=h=>u(be)()),onSelect:a[1]||(a[1]=h=>{o("select",h),d.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Oe=A(go,[["__scopeId","data-v-012e1f38"]]),fo={class:"base-hover ps-1 pe-1"},_o={class:"main"},yo=["onClick"],ho=E({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup($,{emit:m}){const s=$,o=m,d=Object.values(Fe);function c(a){o("update:modelValue",a)}return(a,h)=>(t(),V(te,null,{button:k(()=>[e("div",fo,x(s.modelValue),1)]),popup:k(({hide:v})=>[e("div",_o,[(t(!0),l(G,null,B(u(d),i=>(t(),l("div",{class:"base-hover option",onClick:r=>{c(i),v()}},x(i),9,yo))),256))])]),_:1}))}});const bo=A(ho,[["__scopeId","data-v-ce3e3774"]]),ko={class:""},xo={class:"d-flex ipt"},$o={class:"ms-2",min:"1"},wo=E({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup($,{emit:m}){const s=$,o=m,d=M(1),c=M(Fe.Year);function a(){s.option.stepSize==d.value&&s.option.stepUnit==c.value||o("change",{stepSize:d.value,stepUnit:c.value})}function h(){d.value=s.option.stepSize??1,c.value=s.option.stepUnit}return W(()=>s.option,h),ne(h),W(d,()=>{(d.value<1||d.value==null||isNaN(d.value))&&(d.value=1)}),(v,i)=>(t(),V(te,{onHide:a},{button:k(()=>i[2]||(i[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:k(({hide:r,focus:n})=>[e("div",ko,[e("div",xo,[e("div",null,[ue(e("input",{type:"number","onUpdate:modelValue":i[0]||(i[0]=p=>d.value=p)},null,512),[[ge,d.value]])]),e("div",$o,[y(bo,{modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=p=>c.value=p),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const So=A(wo,[["__scopeId","data-v-78b647dc"]]),Co={class:"d-flex flex-row group-form"},Io={class:"pt-1 pb-1"},Vo={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Mo={key:0,class:"bi bi-chevron-right smaller"},zo=["onClick"],Fo=["onClick"],To=["onClick"],Go=["onClick"],Po=["onClick"],Oo=["onClick"],Eo=["onClick"],Lo=["onClick"],Do=["onClick"],Ro={key:5,class:"sm-btn"},Ao={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},jo=E({__name:"GroupForm",props:{isLoading:Boolean,manager:Je},setup($){const m=Q(),s=$;function o(r){s.manager.setGroupOption(r),s.manager.update(!0)}function d(r){s.manager.delGroupOption(r),s.manager.update(!0)}function c(r,n){s.manager.setGroupOption(r,{direction:n}),s.manager.sortGroups(!0)}function a(r,n){s.manager.setGroupOption(r,{type:n}),s.manager.sortGroups(!0)}function h(r,n){s.manager.setGroupOption(r,n),s.manager.update(!0)}const v=T(()=>s.manager.state.groupBy.map(r=>m.properties[r])),i=T(()=>{const r=[];return s.manager.state.groupBy.forEach(n=>{r.push({option:s.manager.state.options[n],property:m.properties[n]})}),r});return(r,n)=>(t(),l("div",Co,[e("div",Io,x(r.$t("main.menu.groupby"))+": ",1),v.value.length?(t(),l("div",Vo,[(t(!0),l(G,null,B(i.value,(p,b)=>(t(),l(G,null,[b>0?(t(),l("i",Mo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:S=>d(p.property.id),id:"remove-group-button"},x(p.property.name),9,zo),p.option.type==u(le).Size?(t(),V(F,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[p.option.direction==u(se).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:S=>a(p.property.id,u(le).Property)},null,8,Fo)):(t(),l("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:S=>a(p.property.id,u(le).Property)},null,8,To))]),_:2},1024)):(t(),V(F,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[p.property.type==u(K).number?(t(),l(G,{key:0},[p.option.direction==u(se).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:S=>a(p.property.id,u(le).Size)},null,8,Go)):(t(),l("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:S=>a(p.property.id,u(le).Size)},null,8,Po))],64)):(t(),l(G,{key:1},[p.option.direction==u(se).Ascending?(t(),l("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:S=>a(p.property.id,u(le).Size)},null,8,Oo)):(t(),l("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:S=>a(p.property.id,u(le).Size)},null,8,Eo))],64))]),_:2},1024)),p.option.direction==u(se).Ascending?(t(),V(F,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:S=>c(p.property.id,u(se).Descending)},null,8,Lo)]),_:2},1024)):(t(),V(F,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:S=>c(p.property.id,u(se).Ascending)},null,8,Do)]),_:2},1024)),p.property.type==u(K).date?(t(),l("div",Ro,[y(So,{option:p.option,onChange:S=>h(p.property.id,S)},null,8,["option","onChange"])])):f("",!0)],64))),256)),s.isLoading?(t(),l("i",Ao)):f("",!0)])):f("",!0),y(Oe,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:n[0]||(n[0]=p=>o(p))},null,8,["group-ids"])]))}});const Uo=A(jo,[["__scopeId","data-v-dcec9b5d"]]),Bo={class:"d-flex flex-row sort-form"},No={class:"pt-1 pb-1"},Ho={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Wo={key:0,class:"bi bi-chevron-right smaller"},qo=["onClick"],Ko=["onClick"],Qo=["onClick"],Yo=E({__name:"SortForm",props:{manager:et},setup($){const m=Q(),s=$,o=T(()=>s.manager.state.sortBy.map(v=>({propertyId:v,direction:s.manager.state.options[v].direction}))),d=T(()=>o.value.map(v=>v.propertyId));function c(v){s.manager.setSort(v),s.manager.update(!0)}function a(v){s.manager.delSort(v),s.manager.update(!0)}function h(v,i){s.manager.setSort(v,{direction:i}),s.manager.update(!0)}return(v,i)=>(t(),l("div",Bo,[e("div",No,x(v.$t("main.menu.sort.title"))+": ",1),o.value.length?(t(),l("div",Ho,[(t(!0),l(G,null,B(o.value,(r,n)=>(t(),l(G,null,[n>0?(t(),l("i",Wo)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:p=>a(r.propertyId)},x(u(m).properties[r.propertyId].name),9,qo),r.direction==u(se).Ascending?(t(),V(F,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:p=>h(r.propertyId,u(se).Descending)},null,8,Ko)]),_:2},1024)):(t(),V(F,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:p=>h(r.propertyId,u(se).Ascending)},null,8,Qo)]),_:2},1024))],64))),256))])):f("",!0),y(Oe,{"group-ids":d.value,onSelect:i[0]||(i[0]=r=>c(r))},null,8,["group-ids"])]))}});const Xo=A(Yo,[["__scopeId","data-v-4e00ef99"]]),Zo={class:"custom-slider"},Jo=["value","min","max","step"],el=E({__name:"RangeInput",props:{min:{default:0},max:{default:1},step:{default:.1},modelValue:{}},emits:["update:modelValue"],setup($,{emit:m}){const s=$,o=m,d=M(s.modelValue),c=M(null),a=(r,n,p)=>(r-n)/(p-n),h=r=>{c.value.style.setProperty("--ProgressPercent",`${r}%`)};tt(()=>{if(c.value){const r=a(d.value,c.value.min,c.value.max);h(r+0)}});function v(){o("update:modelValue",d.value)}let i=!1;return navigator.userAgent.indexOf("AppleWebKit")!=-1&&(i=!0),W(()=>s.modelValue,()=>d.value=s.modelValue),(r,n)=>(t(),l("div",Zo,[e("input",{ref_key:"slider",ref:c,value:d.value,onInput:n[0]||(n[0]=({target:p})=>d.value=parseFloat(p.value)),type:"range",min:r.min,max:r.max,step:r.step,class:"slider",style:X(u(i)?"top:-5px":""),onChange:v},null,44,Jo)]))}});const tl=A(el,[["__scopeId","data-v-5269b272"]]),sl={class:"p-2"},ol={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ll={class:"border mb-1 p-1"},al={class:"me"},nl={key:0},il={key:1},rl={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},dl={class:"d-flex center justify-content-center"},ul={key:1,class:"bi bi-arrow-down text-secondary"},pl={key:3,class:"bi bi-arrow-up text-secondary"},cl={class:"border mb-1 p-1"},ml={class:"me"},vl={key:0},gl={key:1},fl={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},ie=5,_l=E({__name:"HistoryDropdown",emits:[],setup($,{emit:m}){const s=Q(),o=M(!1),d=T(()=>o.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),c=T(()=>[...s.history.undo].reverse().slice(0,ie)),a=T(()=>s.history.redo.slice(Math.max(s.history.redo.length-ie,0)));return W(()=>s.onUndo,()=>{console.log("changed"),o.value=!0,setTimeout(()=>o.value=!1,100)}),(h,v)=>c.value.length||a.value.length?(t(),V(te,{key:0},{button:k(()=>[y(F,{message:"dropdown.history.info"},{default:k(()=>[e("div",{class:"d-flex sb flash",style:X([{"font-size":"14px"},d.value])},[v[2]||(v[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(h.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:k(()=>[e("div",sl,[u(s).history.redo.length>ie?(t(),l("div",ol," + "+x(u(s).history.redo.length-ie),1)):f("",!0),(t(!0),l(G,null,B(a.value,i=>(t(),l("div",ll,[e("span",al,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[3]||(v[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),l("span",nl,x(i.tags)+" "+x(h.$t("dropdown.history.tags")),1)):f("",!0),i.values?(t(),l("span",il,x(i.values)+" "+x(h.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",rl,[e("div",dl,[c.value.length?(t(),V(F,{key:0,message:"dropdown.history.undo"},{default:k(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:v[0]||(v[0]=(...i)=>u(s).undo&&u(s).undo(...i))})]),_:1})):(t(),l("div",ul)),v[4]||(v[4]=e("div",{style:{width:"30px"}},null,-1)),a.value.length?(t(),V(F,{key:2,message:"dropdown.history.redo"},{default:k(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:v[1]||(v[1]=(...i)=>u(s).redo&&u(s).redo(...i))})]),_:1})):(t(),l("div",pl))])]),(t(!0),l(G,null,B(c.value,i=>(t(),l("div",cl,[e("span",ml,x(new Date(i.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[5]||(v[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),i.tags?(t(),l("span",vl,x(i.tags)+" "+x(h.$t("dropdown.history.tags")),1)):f("",!0),i.values?(t(),l("span",gl,x(i.values)+" "+x(h.$t("dropdown.history.values")),1)):f("",!0)]))),256)),u(s).history.undo.length>ie?(t(),l("div",fl," + "+x(u(s).history.undo.length-ie),1)):f("",!0)])]),_:1})):f("",!0)}});const yl=A(_l,[["__scopeId","data-v-85cd80d0"]]),hl=E({__name:"ToggleReload",emits:[],setup($,{emit:m}){const s=ae(),o=T(()=>s.getTab().autoReload?2:s.getTabManager().collection.state.isDirty?0:1);function d(){o.value==0?s.getTabManager().collection.update():o.value==1?(s.getTab().autoReload=!0,s.updateTabs()):(s.getTab().autoReload=!1,s.updateTabs())}return(c,a)=>(t(),l("div",{class:"bb font",onClick:d,style:{width:"26px",height:"30px",overflow:"hidde"}},[o.value==0?(t(),V(F,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:k(()=>a[0]||(a[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),o.value==1?(t(),V(F,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:k(()=>a[1]||(a[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),o.value==2?(t(),V(F,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:k(()=>a[2]||(a[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}});const bl=A(hl,[["__scopeId","data-v-61c9799b"]]),kl={class:"d-flex flex-row p-2"},xl=["placeholder"],$l={class:"me-5 d-flex"},wl={class:"ms-5",style:{"font-size":"13px"}},Sl=["checked"],Cl={class:"ms-1"},Il={class:"ms-4"},Vl={class:"d-flex flex-wrap content-container ps-2"},Ml=E({__name:"ContentFilter",props:{tab:st,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup($,{emit:m}){const s=$,o=M(""),d=T(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),c=T(()=>d.value.length);function a(r){const n=r.target.checked;s.tab.collection.groupManager.setSha1Mode(n,!0)}function h(){o.value=s.tab.state.filterState.query}function v(){s.tab.collection.filterManager.setQuery(o.value),s.tab.collection.filterManager.update(!0)}function i(){s.tab.collection.filterManager.setQuery(""),s.tab.collection.filterManager.update(!0)}return ne(h),W(()=>s.tab.collection.filterManager.state.query,h),(r,n)=>(t(),l(G,null,[e("div",kl,[y(F,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[e("div",{class:q(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[n[6]||(n[6]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),ue(e("input",{type:"text",class:"input-hidden",placeholder:r.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=p=>o.value=p),onChange:v},null,40,xl),[[ge,o.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:i},"x")],2)]),_:1}),e("div",$l,[y(F,{message:"main.menu.grid_tooltip"},{default:k(()=>[e("i",{class:q("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=p=>s.tab.state.display="tree")},null,2)]),_:1}),y(F,{message:"main.menu.table_tooltip"},{default:k(()=>[e("i",{id:"toot",class:q("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=p=>s.tab.state.display="grid")},null,2)]),_:1}),y(F,{message:"main.menu.graph_tooltip"},{default:k(()=>[e("i",{id:"toot",class:q("bi bi-bar-chart btn-icon"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:n[3]||(n[3]=p=>s.tab.state.display="graph")},null,2)]),_:1})]),y(F,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>n[7]||(n[7]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[y(tl,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":n[4]||(n[4]=p=>s.tab.state.imageSize=p)},null,8,["modelValue"])]),e("div",wl,[y(F,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[e("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:a},null,40,Sl),e("span",Cl,x(r.$t("main.menu.image_mode")),1)]),_:1})]),e("div",Il,[y(yl)]),c.value?(t(),V(ot,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":d.value,"onRemove:selected":n[5]||(n[5]=p=>s.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0),n[9]||(n[9]=e("div",{class:"flex-grow-1"},null,-1)),y(F,{message:"main.menu.issue",class:"bb"},{default:k(()=>n[8]||(n[8]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",Vl,[y(bl,{class:"me-1"}),y(mo,{manager:s.tab.collection.filterManager},null,8,["manager"]),y(Uo,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),y(Xo,{manager:s.tab.collection.sortManager},null,8,["manager"])])],64))}});const zl=A(Ml,[["__scopeId","data-v-3f54024a"]]),Fl={class:""},Tl={class:"d-flex flex-row"},Gl=E({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup($,{emit:m}){const s=pe(),o=$,d=m,c=T(()=>`width: ${o.size}px; height: ${o.size}px;`);T(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`);const a=T(()=>o.pile.images[0]);return(h,v)=>(t(),l("div",Fl,[y(at,{image:a.value},{default:k(()=>[e("div",{style:X(c.value),class:"img-container",onClick:v[0]||(v[0]=i=>u(s).showModal(u(oe).IMAGE,{image:a.value}))},[y(lt,{image:a.value,width:o.size-2,height:o.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Tl,[y(F,{message:"main.recommand.accept"},{default:k(()=>[e("div",{style:X(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:v[1]||(v[1]=i=>d("accept",a.value))}," ✓ ",4)]),_:1}),y(F,{message:"main.recommand.refuse"},{default:k(()=>[e("div",{style:X(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:v[2]||(v[2]=i=>d("refuse",a.value))}," ✕ ",4)]),_:1})])]))}});const Pl=A(Gl,[["__scopeId","data-v-2ff8fded"]]),Ol={class:"reco-container"},El={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Ll={key:0,class:"bi bi-funnel-fill bb text-primary"},Dl={key:1,class:"bi bi-funnel bb"},Rl={class:"text-secondary me-2"},Al={style:{"padding-top":"2px"},class:"me-1"},jl={class:"flex-grow-1"},Ul={class:"d-flex flex-row"},Bl={key:0,class:"separator"},Nl={class:"d-flex flex-row"},_e=10,Hl=E({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup($,{emit:m}){const s=ae(),o=Q(),d=nt(),c=$,a=m,h=M(1),v=de([]),i=M(null),r=de([]),n=de(new Set),p=M(!0);function b(_){const w=i.value;w.isSha1Group?w.images=w.images.filter(P=>P.sha1!=_.sha1):w.images=w.images.filter(P=>P.id!=_.id),i.value=w,R()}async function S(_){const w=[],P=[];r.forEach(N=>{if(N.value!=null){const L=o.properties[N.propertyId];let H=N.value;L.type==K.multi_tags?(H=_.properties[N.propertyId]??[],H=[...H,N.value]):L.type==K.tag&&(H=[H]),L.mode==he.id?P.push({instanceId:_.id,propertyId:L.id,value:H}):w.push({propertyId:L.id,sha1:_.sha1,value:H})}}),await o.setPropertyValues(P,w),b(_)}function O(_){i.value.isSha1Group?i.value.images.filter(w=>w.sha1==_.sha1).forEach(w=>n.add(w.id)):n.add(_.id),b(_)}function R(){v.length=0;let _=[];const w=i.value.images;if(i.value.isSha1Group){const P={},N=Array.from(new Set(w.map(L=>L.sha1)));N.forEach(L=>P[L]=[]),w.forEach(L=>P[L.sha1].push(L)),N.forEach(L=>_.push({sha1:L,images:o.sha1Index[L]}))}else w.forEach(P=>_.push({sha1:P.sha1,images:[P]}));C(_,v,h.value,c.imageSize,c.width)}function C(_,w,P,N,L){let H=L,Z=[],j=0;for(let D=0;D<_.length&&!(w.length>=P);D++){let z=_[D];if(z.images=z.images.filter(we=>!n.has(we.id)),z.images.length==0)continue;let Y=N+_e;if(j+Y<H){Z.push(z),j+=Y;continue}if(Z.length==0)throw new Error("Images seems to be to big for the line");w.push(Z),w.length<P&&(Z=[z],j=Y)}Z.length>0&&w.length<P&&w.push(Z)}async function g(){if(!c.group||!d.hasSimilaryFunction)return;const _=d.defaultActions.similar,w=d.getContext(_);w.instanceIds=c.group.images.map(Z=>Z.id);const P=await d.getSimilarImages(w);if(!P)return;if(!P.groups)throw new Error("No instances in ActionResult");let L=it(P.groups)[0];if(p.value){const Z=new Set(s.getTabManager().collection.filterManager.result.images.map(j=>j.id));L.images=L.images.filter(j=>Z.has(j.id))}L.scores&&rt(L),i.value=L,r.length=0;let H=c.group;for(;H;)r.push(...H.meta.propertyValues),H=H.parent;n.clear(),R(),a("update")}function I(){p.value=!p.value}return ne(g),W(()=>c.group,()=>{g(),n.clear()}),W(()=>c.imageSize,R),W(()=>c.width,R),W(p,g),(_,w)=>(t(),l("div",Ol,[e("div",El,[y(F,{message:"main.recommand.close"},{default:k(()=>[e("div",{class:"text-secondary pe-1",onClick:w[0]||(w[0]=P=>a("close"))},w[2]||(w[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),w[4]||(w[4]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{message:"main.recommand.scroll"},{default:k(()=>[e("div",{class:"text-secondary pe-1",onClick:w[1]||(w[1]=P=>a("scroll",c.group.id))},w[3]||(w[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),w[5]||(w[5]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{message:"main.recommand.filter"},{default:k(()=>[e("div",{class:"text-secondary pe-1",onClick:I},[p.value?(t(),l("span",Ll)):(t(),l("span",Dl))])]),_:1}),w[6]||(w[6]=e("div",{class:"b-left pe-1"},null,-1)),y(F,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[e("span",Rl,x(_.$t("main.recommand.title")),1)]),_:1}),e("div",Al,[y(dt,{action:"similar",onChanged:g})]),e("div",jl,[e("div",Ul,[(t(!0),l(G,null,B(r,(P,N)=>(t(),l(G,null,[y(ut,{class:"",value:P},null,8,["value"]),N<r.length-1?(t(),l("div",Bl)):f("",!0)],64))),256))])])]),e("div",{style:X("margin-left:"+_e+"px;")},[(t(!0),l(G,null,B(v,P=>(t(),l("div",null,[e("div",Nl,[(t(!0),l(G,null,B(P,N=>(t(),V(Pl,{pile:N,size:c.imageSize,onAccept:S,onRefuse:O,style:X("margin-right:"+_e+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Wl=A(Hl,[["__scopeId","data-v-f5bef12b"]]);const ql={style:{display:"flex"}},Kl={class:"info"},Ql={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:K},height:String},setup($){const m=$,s=M(0),o=M(!1),d={};Object.keys(m.chartData.series).forEach(n=>{d[n]=!1});const c=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:m.chartData.dataType===K.date?"datetime":"numeric",categories:m.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:n,seriesIndex:p,dataPointIndex:b,w:S}){const O=m.chartData.series[p].data[b];let R='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';O.images.forEach((g,I)=>{I<10&&(R+=`<div style="width: 75px; height: 75px;"><img src="${g}" style="width: 100%; height: 100%;" /></div>`)}),R+="</div>";let C=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${m.chartData.series[p].name} — </b> ${O.y} Images</span>`;return C+=`<div>${R}</div>`,C}}}),a=()=>{c.value.chart.stacked=!c.value.chart.stacked,o.value=!o.value,s.value+=1},h=()=>{let n;c.value.chart.type==="area"?n={chart:{...c.value.chart,type:"bar"}}:n={chart:{...c.value.chart,type:"area"}},c.value={...c.value,...n},s.value+=1},v=(n,p,b)=>{const O=m.chartData.series[p];let R=Math.max(...O.data.map(C=>C.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(C=>C.remove()),d[p]){d[p]=!1;return}O.data.forEach((C,g)=>{const _=Math.floor(C.y/R*17),w=C.images.slice(0,_),P=`circle[index="${p}"][j="${g}"]`,N=document.querySelector(P),L=parseFloat(N.getAttribute("cx"));w.forEach((H,Z)=>{const j=document.createElement("img");j.src=H,j.width=40,j.height=40,j.style.position="absolute";let D=L+40/1.5,z=65+Z*40;j.style.left=`${D}px`,j.style.bottom=`${z}px`,j.classList.add("apexcharts-custom-image"),j.addEventListener("mouseover",Y=>i(D,z,H)),j.addEventListener("mouseout",r),n.el.appendChild(j)})}),Object.keys(d).forEach(C=>d[C]=!1),d[p]=!0};function i(n,p,b){const S=document.getElementById("zoomed-image");S.style.left=`${n+120*1.5}px`,S.src=b,S.style.bottom=`${p}px`,S.style.display="block"}function r(){const n=document.getElementById("zoomed-image");n.style.display="none"}return console.log("test"),(n,p)=>{const b=Me("apexchart");return t(),l(G,null,[e("div",ql,[e("button",{class:"mt-2",onClick:h},x(c.value.chart.type==="area"?n.$t("main.graph-view.histo"):n.$t("main.graph-view.curve")),1),m.chartData.series.length>1?(t(),l("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:a},x(o.value?n.$t("main.graph-view.over"):n.$t("main.graph-view.stack")),1)):f("",!0)]),(t(),V(b,{style:{position:"relative"},key:s.value,height:m.height,type:c.value.chart.type,options:c.value,series:m.chartData.series,onLegendClick:v},null,8,["height","type","options","series"])),e("i",Kl,x(n.$t("main.graph-view.info")),1),p[0]||(p[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Yl={key:1},Xl=E({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup($,{emit:m}){const s=Q(),o=$,d=M(""),c=M(h());function a(){const v=new Set;let i=o.collection.groupManager.getGroupIterator();for(;i;){const r=i.group;if(r.id===0||r.meta.propertyValues&&r.meta.propertyValues[0].value==null){i=i.nextGroup();continue}for(let n of r.children)v.add(n.meta.propertyValues[0].value);r.children.forEach(()=>i=i.nextGroup()),i=i.nextGroup()}return v}function h(){const v={};let i,r=o.collection.groupManager.state.groupBy;if(r.length===0){d.value="Choose at least one date or numeric value to group the images by";return}const n=s.properties[r[0]],p=n.type;if(r.length>2){d.value="Only max two levels of grouping are supported";return}else if(r.length===1)v[n.name]={name:n.name,data:[]};else if(i=Array.from(a()),i.length>20){d.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(p!==K.number&&p!==K.date){d.value="First level of grouping needs to be a date or a numeric property";return}let b=o.collection.groupManager.getGroupIterator();const S=[];for(;b;){const O=b.group;if(O.id===0||O.meta.propertyValues&&O.meta.propertyValues[0].value==null){b=b.nextGroup();continue}let R=O.meta.propertyValues[0];const C=p===K.date?new Date(R.value).getTime():R.value;if(S.push(C),n.name in v)v[n.name].data.push({x:C,y:O.images.length,images:O.images.slice(0,20).map(g=>g.urlSmall)});else{const g=O.children.map(_=>_.meta.propertyValues[0].value),I=i.filter(_=>!g.includes(_));for(let _ of O.children){const w=_.meta.propertyValues[0].value;if(v[w]===void 0){let P=w;w in s.tags&&(P=s.tags[w].value),v[w]={data:[],name:P}}v[_.meta.propertyValues[0].value].data.push({x:C,y:_.images.length,images:_.images.slice(0,20).map(P=>P.urlSmall)})}for(let _ of I){if(v[_]===void 0){let w=_;_ in s.tags&&(w=s.tags[_].value),v[_]={data:[],name:w}}v[_].data.push({x:C,y:0,images:[]})}O.children.forEach(()=>b=b.nextGroup())}b=b.nextGroup()}return d.value="",{series:Object.values(v),xValues:S,dataType:p}}return o.collection.groupManager.onChange.addListener(()=>c.value=h()),(v,i)=>(t(),l("div",{class:"",style:X({height:o.height+"px"})},[d.value===""?(t(),V(Ql,{key:0,chartData:c.value,height:o.height-50+"px"},null,8,["chartData","height"])):(t(),l("span",Yl,x(d.value),1))],4))}}),Zl={key:0},Jl={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},re=E({__name:"LoadWheel",props:{loading:{type:Boolean}},setup($){const m=$;return(s,o)=>m.loading?(t(),l("div",Zl,[s.loading?(t(),l("div",Jl,o[0]||(o[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),ye=E({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup($){const m=$,s=T(()=>m.force?"100%":m.max==0?"0%":m.current>=m.max?"100%":Math.floor(m.current/m.max*100)+"%");return(o,d)=>(t(),l("span",null,x(s.value),1))}}),ea={key:0,class:"center"},ta={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},sa={class:"d-flex text-secondary"},oa={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},la={class:"d-flex text-secondary",style:{"font-size":"14px"}},aa={key:0,class:"bi bi-check text-success"},na={class:"d-flex text-secondary",style:{"font-size":"14px"}},ia={key:0,class:"bi bi-check text-success"},ra={class:"d-flex text-secondary",style:{"font-size":"14px"}},da={key:0,class:"bi bi-check text-success"},ua={class:"d-flex text-secondary",style:{"font-size":"14px"}},pa={key:0,class:"bi bi-check text-success"},ca={class:"d-flex text-secondary",style:{"font-size":"14px"}},ma={key:0,class:"bi bi-check text-success"},va=E({__name:"DataLoad",setup($){const m=Q();return(s,o)=>u(m).loadState?(t(),l("div",ea,[e("div",ta,[e("div",null,[e("div",sa,[o[0]||(o[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedProperty},null,8,["loading"]),u(m).loadState.finishedProperty?(t(),l("i",oa)):f("",!0)]),e("div",la,[o[1]||(o[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedPropertyGroups},null,8,["loading"]),u(m).loadState.finishedPropertyGroups?(t(),l("i",aa)):f("",!0)]),e("div",na,[o[2]||(o[2]=e("div",{class:"me-1"},"Tags",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedTags},null,8,["loading"]),u(m).loadState.finishedTags?(t(),l("i",ia)):f("",!0)]),e("div",ra,[o[3]||(o[3]=e("div",{class:"me-1"},"Instances",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedInstance},null,8,["loading"]),u(m).loadState.finishedInstance?(t(),l("i",da)):f("",!0),y(ye,{current:u(m).loadState.counterInstance,max:u(m).loadState.maxInstance,force:u(m).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",ua,[o[4]||(o[4]=e("div",{class:"me-1"},"InstanceValues",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedInstanceValues},null,8,["loading"]),u(m).loadState.finishedInstanceValues?(t(),l("i",pa)):f("",!0),y(ye,{current:u(m).loadState.counterInstanceValue,max:u(m).loadState.maxInstanceValue,force:u(m).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",ca,[o[5]||(o[5]=e("div",{class:"me-1"},"ImageValues",-1)),y(re,{class:"me-2",loading:!u(m).loadState.finishedImageValues},null,8,["loading"]),u(m).loadState.finishedImageValues?(t(),l("i",ma)):f("",!0),y(ye,{current:u(m).loadState.counterImageValue,max:u(m).loadState.maxImageValue,force:u(m).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}});const ga=A(va,[["__scopeId","data-v-0db6d675"]]),fa={key:0,class:"m-0 p-0"},_a={key:1,style:{"margin-left":"10px"}},ya=E({__name:"MainView",props:{tabId:{},height:{},filterOpen:{type:Boolean}},setup($,{expose:m}){const s=ae(),o=s.getTabManager(),d=Q(),c=$;m({updateScrollerWidth:g});const a=M({}),h=M(!0),v=M(null),i=M(null),r=M(null),n=M(0),p=M(0),b=de({groups:!1}),S=T(()=>o.getVisibleProperties());function O(){v.value&&i.value?n.value=c.height-v.value.clientHeight-i.value.clientHeight-5:v.value?n.value=c.height-v.value.clientHeight-5:n.value=0}o.collection.groupManager.onChange.addListener(()=>{r.value&&o.state.display=="tree"&&r.value.computeLines()});function R(I){a.value=o.collection.groupManager.result.index[I],J(()=>O())}function C(){a.value={},J(()=>O())}async function g(){var I;await J(),p.value=((I=v.value)==null?void 0:I.clientWidth)??p.value}return ne(()=>{p.value=v.value.clientWidth,window.addEventListener("resize",g)}),Te(()=>{window.removeEventListener("resize",g)}),W(()=>o.state.imageSize,()=>J(O)),W(()=>c.filterOpen,()=>J(O)),W(()=>c.height,async()=>{await J(O)}),W(o.state,I=>{s.updateTabs()},{deep:!0}),W(()=>c.tabId,async()=>{h.value=!1,await J(),h.value=!0}),(I,_)=>(t(),l(G,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:v},[c.filterOpen?(t(),V(zl,{key:0,tab:u(o),"compute-status":b},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:i,class:"m-0 p-0"},[a.value.id?(t(),l("div",fa,[y(Wl,{group:a.value,"image-size":u(o).state.imageSize,width:p.value,height:50,onClose:C,onScroll:r.value.scrollTo,onUpdate:_[0]||(_[0]=w=>J(()=>O()))},null,8,["group","image-size","width","onScroll"])])):f("",!0)],512),n.value>0&&!u(d).isLoaded?(t(),l("div",{key:0,class:"d-flex flex-column",style:X({height:n.value+"px"})},[y(ga,{class:"flex-grow-1"})],4)):f("",!0),u(d).isLoaded&&p.value>0&&n.value>0&&h.value?(t(),l("div",_a,[u(o).state.display=="tree"?(t(),V(pt,{key:0,"group-manager":u(o).collection.groupManager,"image-size":u(o).state.imageSize,height:n.value-0,properties:S.value,"hide-if-modal":!0,"selected-images":u(o).collection.groupManager.selectedImages,ref_key:"imageList",ref:r,width:p.value-25,onRecommend:R},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),u(o).state.display=="grid"?(t(),l("div",{key:1,style:X({width:p.value-12+"px"}),class:"p-0 m-0 grid-container"},[y(ct,{manager:u(o).collection.groupManager,height:n.value-15,width:p.value-40,"selected-properties":S.value,class:"p-0 m-0","show-images":!0,"selected-images":u(o).collection.groupManager.selectedImages,ref_key:"imageList",ref:r,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):f("",!0),u(o).state.display=="graph"?(t(),V(Xl,{key:2,collection:u(o).collection,height:n.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}});const ha=A(ya,[["__scopeId","data-v-d2286adf"]]),ba={class:"d-flex d-row",style:{cursor:"pointer"}},ka={class:"pt-1"},xa={key:0,class:"bb bi bi-chevron-down"},$a={key:1,class:"bb bi bi-chevron-right"},wa=["onMouseenter","onMouseleave"],Sa=["onClick"],Ca=["onClick"],Ia=["onClick"],Va=["onUpdate:modelValue"],Ma={style:{"padding-top":"2px","margin-right":"2px"}},za={class:"lang"},Fa=["value"],Ta=E({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup($,{emit:m}){const s=pe(),o=ae(),d=M(-1),c=M(""),a=M(null),h=$,v=m;function i(C){o.data.selectedTabId==C||n(),o.selectTab(C)}function r(C){d.value=C,c.value=o.data.tabs[C].name,J(()=>a.value[0].focus())}function n(){d.value=-1,c.value=""}async function p(C){let g=await o.addTab("New Tab");await J(),console.log(g),r(g.id)}async function b(C){confirm("Are you sure to delete Tab: "+C.name)&&await o.removeTab(C.id)}const S=de({});M(-1);const O=["fr","en"];function R(){v("update:filterOpen",!h.filterOpen)}return(C,g)=>(t(),l("nav",null,[e("div",ba,[e("div",ka,[e("span",{onClick:R},[h.filterOpen?(t(),l("i",xa)):(t(),l("i",$a))])]),(t(!0),l(G,null,B(u(o).data.tabs,I=>(t(),l("div",{class:"d-flex d-row me-2",onMouseenter:_=>S[I.id]=!0,onMouseleave:_=>S[I.id]=!1},[d.value!=I.id?(t(),l(G,{key:0},[y(F,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[e("i",{onClick:_=>r(I.id),class:q(["bi bi-pencil me-1 tab-icon hover-light",S[I.id]&&u(o).data.selectedTabId==I.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,Sa)]),_:2},1024),e("div",{class:q(["tab-button",I.id==u(o).data.selectedTabId?" active":""]),onClick:_=>i(I.id)},[e("span",null,x(I.name),1)],10,Ca),y(F,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[e("i",{onClick:_=>b(I),class:q(["btn-icon bi bi-x tab-icon hover-light",S[I.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Ia)]),_:2},1024)],64)):(t(),l("div",{key:1,class:q(["tab-button",I.id==u(o).data.selectedTabId?" active":""])},[e("form",{onSubmit:me(n,["stop","prevent"])},[ue(e("input",{onFocusout:n,onKeydown:vt(n,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":_=>I.name=_,ref_for:!0,ref_key:"inputElem",ref:a},null,40,Va),[[ge,I.name]])],32)],2))],40,wa))),256)),y(F,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:p,id:"add-tab-button"},g[3]||(g[3]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),g[6]||(g[6]=e("div",{class:"flex-grow-1"},null,-1)),e("div",Ma,[y(F,{message:"modals.notif.icon"},{default:k(()=>[e("span",{class:"bb",onClick:g[0]||(g[0]=I=>u(s).showModal(u(oe).NOTIF))},g[4]||(g[4]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",za,[g[5]||(g[5]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),ue(e("select",{"onUpdate:modelValue":g[1]||(g[1]=I=>C.$i18n.locale=I),onChange:g[2]||(g[2]=I=>h.reRender())},[(t(),l(G,null,B(O,(I,_)=>e("option",{key:`Lang${_}`,value:I},x(I.toUpperCase()),9,Fa)),64))],544),[[mt,C.$i18n.locale]])])])]))}});const Ga={key:0},Pa={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Oa={class:"w-100"},Ea={key:0,class:"custom-hr"},La={key:1,class:"loading"},Da={class:"text-center"},Ra={key:2,class:"loading"},Aa=E({__name:"PanopticView",setup($){const m=ae(),s=Q(),o=pe(),d=M(null),c=M(null),a=M(window.innerHeight),h=M(!1),v=M(!0),i=M(!0),r=T(()=>{var g;return a.value-(((g=c.value)==null?void 0:g.clientHeight)??0)}),n=T(()=>{var g;return(g=d.value)==null?void 0:g.filteredImages.map(I=>I.id)});let p=navigator.userAgent.indexOf("Mac OS X")!==-1;async function b(){v.value=!1,await J(),v.value=!0}ne(async()=>{o.isProjectLoaded||Ie.push("/"),J(()=>{window.addEventListener("resize",S),S()}),window.addEventListener("keydown",g=>{g.key=="Control"&&(U.ctrl=!0),g.key=="Alt"&&(p&&(U.ctrl=!0),U.alt=!0),g.key=="Shift"&&(U.shift=!0),g.key=="ArrowLeft"&&(U.left=!0),g.key=="ArrowRight"&&(U.right=!0,console.log("keeeyy")),g.key=="Z"&&U.ctrl&&s.redo(),g.key=="z"&&U.ctrl&&s.undo()}),window.addEventListener("keyup",g=>{g.key=="Control"&&(U.ctrl=!1),g.key=="Alt"&&(p&&(U.ctrl=!1),U.alt=!1),g.key=="Shift"&&(U.shift=!1),g.key=="ArrowLeft"&&(U.left=!1),g.key=="ArrowRight"&&(U.right=!1)}),window.addEventListener("mousemove",g=>{U.ctrl=g.ctrlKey,U.alt=g.altKey,U.shift=g.shiftKey,p&&(U.ctrl=U.ctrl||U.alt)})}),Te(()=>{window.removeEventListener("resize",S)});function S(){a.value=window.innerHeight,h.value=!0}function O(){o.showModal(oe.EXPORT,n)}function R(){Ie.push("/")}function C(){d.value&&d.value.updateScrollerWidth()}return(g,I)=>v.value?(t(),l("div",Ga,[d.value&&!d.value.imageList?(t(),V(gt,{key:0,tutorial:"project"})):f("",!0),(t(),l("div",{id:"panoptic",key:u(m).status.renderNb},[e("div",Pa,[u(m).status.loaded?(t(),l(G,{key:0},[e("div",null,[y(Ms,{onExport:I[0]||(I[0]=_=>O()),onToggle:C})]),e("div",Oa,[e("div",{class:"ms-1",ref_key:"navElem",ref:c},[y(Ta,{"re-render":b,filterOpen:i.value,"onUpdate:filterOpen":I[1]||(I[1]=_=>i.value=_)},null,8,["filterOpen"])],512),h.value?(t(),l("div",Ea)):f("",!0),y(ha,{"tab-id":u(m).data.selectedTabId,height:r.value,ref_key:"mainViewRef",ref:d,"filter-open":i.value},null,8,["tab-id","height","filter-open"])])],64)):u(o).isProjectLoaded?(t(),l("div",Ra,I[2]||(I[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(t(),l("div",La,[e("div",Da,[e("div",null,x(g.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:R,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))])):f("",!0)}});const Ba=A(Aa,[["__scopeId","data-v-082194ff"]]);export{Ba as default};
