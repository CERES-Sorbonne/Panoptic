import{d as z,h as G,r as w,c as I,i as se,o as s,a as n,b as t,w as le,v as re,F as M,m as U,s as b,y as ie,t as $,k as V,x as k,n as R,D as J,z as Le,_ as N,A as de,B as A,C as Ge,e as l,P as be,l as f,E as Fe,G as S,H as Ne,I as De,J as Re,K as Ue,L as je,p as W,f as Y,N as we,O as E,Q as Ee,q as Q,T as Ae,R as Pe,S as H,U as ge,V as Ie,u as $e,M as te,g as he,W as He,X as Be,Y as Ce,Z as Te,$ as qe,a0 as ee,a1 as X,a2 as Ke,a3 as Qe,a4 as We,a5 as Ye,a6 as Xe,a7 as Je,a8 as ae,a9 as Ze,aa as et,ab as Z,ac as tt,ad as st,ae as ot,af as nt,j as Se,ag as B,ah as at}from"./index-f4319002.js";import{_ as lt}from"./Tutorial-4d7bb131.js";const it={class:"mb-1 ps-2 pe-2"},rt=["onClick"],ke=z({__name:"PropertySelection",props:{ignoreIds:Array},emits:["select"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null),y=w(""),h=I(()=>{let _=e.propertyList;return o.ignoreIds&&(_=_.filter(c=>!o.ignoreIds.includes(c.id))),_.filter(c=>c.name.includes(y.value))});return se(()=>v.value.focus()),(_,c)=>(s(),n("div",null,[t("div",it,[le(t("input",{class:"w-100 bg-light",type:"text",ref_key:"searchElem",ref:v,"onUpdate:modelValue":c[0]||(c[0]=i=>y.value=i)},null,512),[[re,y.value]])]),(s(!0),n(M,null,U(h.value,i=>(s(),n("div",{class:"p-1 base-hover",style:{cursor:"pointer"},onClick:a=>p("select",i.id)},[b(ie,{type:i.type,class:"me-2"},null,8,["type"]),t("a",null,$(i.name),1)],8,rt))),256))]))}}),dt=["disabled"],pt={class:"m-0 p-1"},ut=["onClick"],ct=z({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null),y=I(()=>e.data.properties[o.propertyId]),h=I(()=>Le(y.value.type));async function _(c){p("update:modelValue",c),v.value.hide()}return(c,i)=>(s(),V(J,{onHide:i[0]||(i[0]=a=>p("hide")),ref_key:"dropdownElem",ref:v,parent:o.parent},{button:k(()=>[t("div",{class:R(["text-nowrap",o.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:o.disabled},[t("span",null,$(c.$t("modals.filters.operators."+o.modelValue)),1)],10,dt)]),popup:k(()=>[t("div",pt,[(s(!0),n(M,null,U(h.value,a=>(s(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>_(a)},[t("a",null,$(c.$t("modals.filters.operators."+a)),1)],8,ut))),256))])]),_:1},8,["parent"]))}});const _t=N(ct,[["__scopeId","data-v-29ed354e"]]),mt=d=>(W("data-v-25365fdd"),d=d(),Y(),d),vt={class:"m-0 p-0"},yt={key:1},gt={class:"d-flex mode-header"},ft={class:"me-3"},ht=mt(()=>t("div",{class:"flex-fill"},null,-1)),bt={key:0,class:"me-2",style:{width:"100%"}},$t=z({__name:"FilterDropdown",props:{manager:de,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(d){const r=G(),e=d,o=w(null),p=w(null),v=w(null),y=w(0),h=w(null),_=w(null),c=I(()=>e.filterId!==void 0?e.filterId:h.value),i=I(()=>{if(!(c.value==null||c.value==-1))return e.manager.filterIndex[c.value]}),a=I(()=>i.value==null?void 0:r.data.properties[i.value.propertyId]);function u(){y.value=e.mode,e.mode==2&&e.filterId==null&&O(e.propertyId)}function m(){o.value&&o.value.hide()}function g(){y.value=0}function x(){m(),e.manager.deleteFilter(c.value),e.manager.update(!0)}function O(P){let F=e.manager.addNewFilter(P,e.parentId);e.manager.update(!0),h.value=F.id,y.value=2}function K(P){e.manager.updateFilter(c.value,{operator:P}),e.manager.update(!0),p.value&&p.value.focus()}function ne(){e.manager.updateFilter(c.value,{value:_.value}),e.manager.update(!0)}function L(){if(!i.value)return;const P=r.data.properties[i.value.propertyId];if(Ue(P.type))return;const F=_.value??je(P.type);i.value.value!=F&&ne()}function C(){i.value&&(_.value=i.value.value)}return se(C),A(()=>i.value,()=>C()),(P,F)=>(s(),V(J,{ref_key:"dropdownElem",ref:o,onShow:u,onHide:g,parent:e.parent},{button:k(()=>[t("div",vt,[Ge(P.$slots,"default",{},void 0,!0)])]),popup:k(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[y.value!=0?(s(),n(M,{key:0},[y.value==1?(s(),V(ke,{key:0,onSelect:O,"ignore-ids":[l(be).folders]},null,8,["ignore-ids"])):f("",!0),y.value==2?(s(),n("div",yt,[t("div",gt,[t("div",ft,$(a.value.name),1),b(_t,{"property-id":i.value.propertyId,"model-value":i.value.operator,"onUpdate:modelValue":K,parent:v.value},null,8,["property-id","model-value","parent"]),ht,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:x})])]),l(Fe)(i.value.operator)?(s(),n("div",bt,[a.value.type==l(S).multi_tags||a.value.type==l(S).tag?(s(),V(Ne,{key:0,modelValue:_.value,"onUpdate:modelValue":[F[0]||(F[0]=T=>_.value=T),ne],"auto-focus":!0,property:l(r).data.properties[i.value.propertyId],ref_key:"inputElem",ref:p,onHide:m},null,8,["modelValue","property"])):a.value.type==l(S).color?(s(),V(De,{key:1,property:a.value,modelValue:_.value,"onUpdate:modelValue":[F[1]||(F[1]=T=>_.value=T),F[2]||(F[2]=()=>{m(),L()})]},null,8,["property","modelValue"])):(s(),V(Re,{key:2,"no-html":!0,modelValue:_.value,"onUpdate:modelValue":F[3]||(F[3]=T=>_.value=T),width:-1,"min-height":20,"no-nl":l(r).data.properties[i.value.propertyId].type==l(S).number,"url-mode":l(r).data.properties[i.value.propertyId].type==l(S).url,"only-number":l(r).data.properties[i.value.propertyId].type==l(S).number,onBlur:L,"auto-focus":!0,ref_key:"inputElem",ref:p},null,8,["modelValue","no-nl","url-mode","only-number"]))])):f("",!0)])):f("",!0)],64)):f("",!0)],512)]),_:3},8,["parent"]))}});const ue=N($t,[["__scopeId","data-v-25365fdd"]]),oe=d=>(W("data-v-81b7150f"),d=d(),Y(),d),kt={class:"d-flex flex-row"},xt={key:1,class:"d-flex",style:{width:"150px"}},wt={class:"flex-grow-1"},It={key:1,style:{"padding-top":"1px"}},Ct={style:{width:"20px","margin-top":"2px"},class:"text-center"},St=oe(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),Mt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Vt=oe(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Ft=oe(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Et={key:0,class:"ms-3 pt-1"},Pt=oe(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Tt=oe(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),zt=oe(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Ot=oe(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Lt={key:1},Gt=z({__name:"PropertyOptions",props:{property:Object},setup(d){const r=G(),e=r.getTabManager(),o=d,p=w(!1),v=w(!1),y=w(""),h=w(!1),_=I(()=>r.getTab()),c=I(()=>_.value.visibleProperties[o.property.id]==!0),i=I(()=>e.collection.filterManager.state.filter.filters.some(T=>!T.isGroup&&T.propertyId==o.property.id)),a=I(()=>e.collection.groupManager.state.groupBy.includes(o.property.id)),u=I(()=>e.collection.sortManager.state.sortBy.includes(o.property.id)),m=I(()=>{if(i.value)return e.collection.filterManager.state.filter.filters.find(T=>!T.isGroup&&T.propertyId==o.property.id).id}),g=()=>e.collection.filterManager,x=I(()=>e.getSha1Mode());function O(){c.value?e.setVisibleProperty(o.property.id,!1):e.setVisibleProperty(o.property.id,!0)}function K(){p.value?p.value=!1:(p.value=!0,y.value=o.property.name),v.value=!1}function ne(){o.property.type!=S.tag&&o.property.type!=S.multi_tags||(v.value?v.value=!1:v.value=!0,p.value=!1)}function L(){u.value?e.collection.sortManager.delSort(o.property.id):e.collection.sortManager.setSort(o.property.id),e.collection.sortManager.update(!0)}function C(){a.value?e.collection.groupManager.delGroupOption(o.property.id):e.collection.groupManager.setGroupOption(o.property.id),e.collection.groupManager.update(!0)}function P(){confirm("Supprimer la propriété: "+o.property.name+" ?")&&r.deleteProperty(o.property.id)}async function F(){y.value!=""&&(await r.updateProperty(o.property.id,y.value),K())}return A(()=>o.property,()=>{p.value=!1}),(T,D)=>(s(),n("div",{class:R(h.value?"hover-light":"")},[t("div",kt,[p.value?f("",!0):(s(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:K},[b(ie,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:D[0]||(D[0]=j=>h.value=!0),onMouseleave:D[1]||(D[1]=j=>h.value=!1)},null,8,["type"]),t("span",null,$(o.property.name),1)])),p.value?(s(),n("div",xt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:K,onMouseenter:D[2]||(D[2]=j=>h.value=!0),onMouseleave:D[3]||(D[3]=j=>h.value=!1)},null,32)]),t("div",wt,[o.property.id>=0?le((s(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":D[4]||(D[4]=j=>y.value=j),onChange:F},null,544)),[[re,y.value]]):(s(),n("span",It,[b(ie,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,$(o.property.name),1)]))])])):f("",!0),t("div",Ct,[o.property.mode==l(we).id?(s(),V(E,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:k(()=>[St]),_:1})):f("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:O,class:"btn-icon text-center"},[x.value&&o.property.mode==l(we).id?(s(),V(E,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:k(()=>[t("span",{class:"bi bi-eye-slash",onClick:D[5]||(D[5]=Ee(()=>{},["stop"]))})]),_:1})):(s(),V(E,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:k(()=>[t("span",{class:R("bi bi-eye text-"+(c.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",Mt,[o.property.type==l(S).tag||o.property.type==l(S).multi_tags?(s(),n("div",{key:0,onClick:ne,style:{cursor:"pointer"}},[v.value?(s(),V(E,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:k(()=>[Vt]),_:1})):(s(),V(E,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:k(()=>[Ft]),_:1}))])):f("",!0)])]),t("div",null,[p.value?(s(),n("div",Et,[t("div",{class:R(["options hover-light",i.value?" text-primary":""])},[b(ue,{manager:g(),"filter-id":m.value,mode:2,"property-id":d.property.id},{default:k(()=>[Pt,Q($(T.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:R(["options hover-light",u.value?" text-primary":""]),onClick:L},[Tt,Q($(T.$t("main.menu.sort.title")),1)],2),t("div",{class:R(["options hover-light",a.value?" text-primary":""]),onClick:C},[zt,Q($(T.$t("main.menu.groupby")),1)],2),o.property.id>=0?(s(),n("div",{key:0,class:"options hover-light",onClick:P},[Ot,Q($(T.$t("main.nav.properties.delete_property")),1)])):f("",!0)])):v.value?(s(),n("div",Lt,[b(Ae,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])],2))}});const Me=N(Gt,[["__scopeId","data-v-81b7150f"]]),Nt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Dt={class:"p-2"},Rt=["onClick"],Ut=t("i",{class:"bi bi-arrow-clockwise"},null,-1),jt=z({__name:"FolderOptionDropdown",props:{folder:{}},setup(d){const r=G(),e=d;function o(){r.reImportFolder(e.folder.id)}return(p,v)=>(s(),V(J,{teleport:!0},{button:k(()=>[Nt]),popup:k(({hide:y})=>[t("div",Dt,[t("div",{class:"base-hover p-1",onClick:h=>{o(),y()}},[Ut,Q(" Re import")],8,Rt)])]),_:1}))}}),At=["onMouseenter"],Ht=["onClick"],Bt={class:"text-secondary"},qt=["onClick"],Kt=z({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:de,root:{type:Boolean,default:!0}},setup(d){const r=G(),e=d,o=w(null),p=I(()=>{let i={};const a=new Set(e.filterManager.state.folders);return e.folders.map(u=>u.id).forEach(u=>{a.has(u)&&(i[u]=!0)}),i}),v=I(()=>{let i={};return e.folders.map(a=>a.id).forEach(a=>{e.visibleFolders[a]&&(i[a]=!0)}),i}),y=I(()=>{let i={};return e.folders.forEach(a=>{let u=[];p.value[a.id]&&u.push("selected"),i[a.id]=u.join(" ")}),i});function h(i){let a=e.visibleFolders;a[i]?delete a[i]:a[i]=!0}function _(i){let a=new Set(e.filterManager.state.folders);const u=a.has(i),m=r.data.folders[i].parent!=null&&a.has(r.data.folders[i].parent);u&&!m?(a.delete(i),ge(i).forEach(g=>a.delete(g.id))):(c(i,a),a.add(i),ge(i).forEach(g=>a.add(g.id)),Ie(r.data.folders[i]).forEach(g=>a.delete(g.id))),e.filterManager.setFolders(Array.from(a)),e.filterManager.update(!0)}function c(i,a){const u=Ie(r.data.folders[i]);let m;for(let g of u)if(a.has(g.id))m=g;else break;m!=null&&ge(m.id).forEach(g=>a.delete(g.id))}return(i,a)=>{const u=Pe("FolderList2",!0);return s(),n("ul",{class:R(e.root?"tree":""),style:H(e.root?"padding-left:0px;":"")},[(s(!0),n(M,null,U(d.folders,m=>(s(),n("li",{style:H(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:g=>o.value=m.id,onMouseleave:a[0]||(a[0]=g=>o.value=null)},[t("summary",{class:R(y.value[m.id]),onClick:g=>_(m.id)},[Q($(m.name)+" ",1),t("span",Bt,$(m.count),1)],10,Ht),m.children&&m.children.length>0?(s(),n("i",{key:0,onClick:g=>h(m.id),class:R("bi bi-chevron-"+(v.value[m.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,qt)):f("",!0),t("span",{class:R(o.value===m.id?"visible-option":"invisible-option")},[b(jt,{folder:m,style:{display:"inline-block"}},null,8,["folder"])],2),m.children&&m.children.length>0&&v.value[m.id]?(s(),V(u,{key:1,folders:m.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],44,At))),256))],6)}}});const Qt=N(Kt,[["__scopeId","data-v-9f26453b"]]),Wt={class:"text-center"},Yt={class:"w-100 text-center",style:{"font-size":"10px"}},Xt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Jt=z({__name:"TaskStatus",props:{task:{}},setup(d){const r=d,e=I(()=>r.task.total-r.task.remain-r.task.computing),o=I(()=>r.task.total);return(p,v)=>(s(),n("div",Wt,[Q($(r.task.name)+" ",1),t("div",Yt,$(e.value)+" / "+$(o.value)+" "+$(p.$t("main.nav.tasks.done")),1),o.value>0?(s(),n("div",Xt,[t("div",{class:"progress-bar",style:H(`width: ${e.value/o.value*100}%`)},null,4)])):f("",!0)]))}}),q=d=>(W("data-v-d95a976a"),d=d(),Y(),d),Zt={class:"menu overflow-scroll"},es={class:""},ts={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ss={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},os=q(()=>t("i",{class:"bi bi-gear"},null,-1)),ns=[os],as=q(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),ls=[as],is=q(()=>t("div",{class:"custom-hr"},null,-1)),rs={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ds={class:"d-flex align-items-center"},ps=q(()=>t("i",{class:"bi bi-plus"},null,-1)),us={class:"overflow-scroll"},cs={key:0,id:"import"},_s=q(()=>t("div",{class:"custom-hr"},null,-1)),ms={class:"pt-1 pb-2"},vs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},ys=q(()=>t("div",{class:"custom-hr"},null,-1)),gs={key:0,class:"ps-2 pe-2"},fs={class:"p-1"},hs={key:0,class:"custom-hr"},bs={key:1,class:"p-2"},$s=q(()=>t("div",{class:"custom-hr"},null,-1)),ks={key:0,class:"float-end"},xs={class:"text-center"},ws={class:"w-100 text-center",style:{"font-size":"10px"}},Is={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Cs={key:2,class:"p-2"},Ss={class:"w-100 text-center",style:{"font-size":"10px"}},Ms={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Vs=q(()=>t("div",{class:"custom-hr"},null,-1)),Fs={class:"p-2 mt-0"},Es={class:"d-flex"},Ps=q(()=>t("span",{class:"flex-grow-1"},null,-1)),Ts={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},zs=q(()=>t("span",{class:"sr-only"},null,-1)),Os=[zs],Ls={key:1,class:"bb me-1"},Gs={class:"bb me-2"},Ns={key:0,class:"mt-2"},Ds={key:0,class:"property-item"},Rs=q(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Us=q(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),js=q(()=>t("div",{class:"custom-hr"},null,-1)),As={class:"p-2 mt-0"},Hs={key:0,class:"mt-2"},Bs={key:0,class:"property-item"},qs=z({__name:"Menu",emits:["export"],setup(d,{emit:r}){const e=G(),o=$e(),p=e.getTabManager(),v=w(!1);w(null);const y=w(!1),h=async a=>{o.showModal(te.IMPORT)},_=I(()=>e.backendStatus.tasks.filter(a=>!(a.name=="Load Plugin"&&a.done)));function c(){o.showModal(te.FOLDERSELECTION,{callback:i,mode:"images"})}function i(a){a&&e.addFolder(a)}return A(()=>e.status.import.to_import,()=>v.value=!0),(a,u)=>{var m;return s(),n("div",Zt,[t("div",es,[t("div",null,[t("div",ts,[t("div",ss,[t("div",{class:"flex-grow-1 text-capitalize",onClick:u[0]||(u[0]=()=>{})},$((m=l(o).data.status.selectedProject)==null?void 0:m.name),1),t("div",{class:"base-hover p-1",onClick:u[1]||(u[1]=g=>l(o).showModal(l(te).SETTINGS))},ns),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:u[2]||(u[2]=g=>l(o).closeProject())},ls)])]),is,t("div",rs,[t("div",ds,[t("div",null,[t("b",null,$(a.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:u[3]||(u[3]=g=>{c(),l(he)()})},[b(E,{message:"main.nav.folders.add"},{default:k(()=>[ps]),_:1})])]),t("div",us,[l(e).getTab()?(s(),V(Qt,{key:0,folders:l(e).folderRoots,"filter-manager":l(p).collection.filterManager,"visible-folders":l(p).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):f("",!0)])]),_.value&&_.value.length?(s(),n("div",cs,[_s,t("div",ms,[t("div",vs,[t("div",null,[t("b",null,$(a.$t("main.nav.tasks.title")),1)])]),ys,l(e).backendStatus?(s(),n("div",gs,[(s(!0),n(M,null,U(_.value,(g,x)=>(s(),n("div",fs,[x?(s(),n("div",hs)):f("",!0),b(Jt,{task:g},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&v.value?(s(),n("div",bs,[$s,l(e).status.import.done?(s(),n("div",ks,[t("i",{class:"bi bi-x base-hover",onClick:u[4]||(u[4]=g=>v.value=!1)})])):f("",!0),t("div",xs,[t("b",null,$(a.$t("main.menu.import_status_title")),1)]),t("div",ws,$(l(e).status.import.imported)+" / "+$(l(e).status.import.to_import)+" importées ",1),l(e).status.import.to_import>0?(s(),n("div",Is,[t("div",{class:"progress-bar",style:H(`width: ${l(e).status.import.imported/l(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&v.value?(s(),n("div",Cs,[t("div",Ss,$(l(e).status.import.computed)+" / "+$(l(e).status.import.to_import)+" computed ",1),l(e).status.import.to_import>0?(s(),n("div",Ms,[t("div",{class:"progress-bar",style:H(`width: ${l(e).status.import.computed/l(e).status.import.to_import*100}%`)},null,4)])):f("",!0)])):f("",!0),Vs,t("div",Fs,[t("div",Es,[b(E,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:k(()=>[t("b",null,$(a.$t("main.nav.properties.title")),1)]),_:1}),Ps,y.value?(s(),n("span",Ts,Os)):(s(),n("span",Ls,[b(E,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:h})]),_:1})])),t("span",Gs,[b(E,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:k(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u[5]||(u[5]=g=>l(o).showModal(l(te).EXPORT,void 0))})]),_:1})])]),l(e).status.loaded?(s(),n("div",Ns,[(s(!0),n(M,null,U(l(e).data.properties,g=>(s(),n(M,null,[g.id>=0?(s(),n("div",Ds,[b(Me,{property:g},null,8,["property"])])):f("",!0)],64))),256)),Rs,t("div",{id:"add-property",onClick:u[6]||(u[6]=g=>{l(o).showModal(l(te).PROPERTY,void 0),l(he)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Us,t("span",null,$(a.$t("main.nav.properties.add_property")),1)])])):f("",!0)]),js,t("div",As,[b(E,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:k(()=>[t("b",null,$(a.$t("main.nav.computed.title")),1)]),_:1}),l(e).status.loaded?(s(),n("div",Hs,[(s(!0),n(M,null,U(l(e).data.properties,g=>(s(),n(M,null,[g.id<0?(s(),n("div",Bs,[b(E,{pos:"bottom",message:"main.nav.computed."+Math.abs(g.id).toString()+"_tooltip"},{default:k(()=>[b(Me,{property:g},null,8,["property"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])])}}});const Ks=N(qs,[["__scopeId","data-v-d95a976a"]]),Qs={class:"text-nowrap text-secondary"},Ve=z({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(d){const r=G(),e=d,o=I(()=>r.data.properties[e.propertyId].tags);return(p,v)=>(s(),n("div",Qs,[e.value&&e.value.length>0?(s(!0),n(M,{key:0},U(e.value,y=>(s(),n("span",null,[b(He,{tag:o.value[y].value,color:o.value[y].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),n(M,{key:1},[Q(" Add Tags... ")],64))]))}}),Ws={key:0},Ys={key:1},Xs={key:2},Js={key:3},Zs={key:0,class:"bi bi-square"},eo={key:1,class:"bi bi-check-square"},to={key:5},so={key:6},oo={key:7},no={key:8},ao={key:9},lo={key:10},io={key:11},ro={key:12},po={key:13},uo={key:1,class:"text-secondary"},co=z({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(d){const r=d,e=I(()=>{if(r.value==null)return"white";let p=Number(r.value);return isNaN(p)||p>12?"gray":Be[p].color}),o=I(()=>[S._ahash,S._folders,S._sha1,S.string].indexOf(r.property.type)!==-1?'"'+r.value+'"':r.value);return(p,v)=>d.value!=null?(s(),n(M,{key:0},[r.property.type==l(S)._ahash?(s(),n("div",Ws,$(o.value),1)):f("",!0),r.property.type==l(S)._folders?(s(),n("div",Ys,$(o.value),1)):f("",!0),r.property.type==l(S)._sha1?(s(),n("div",Xs,$(o.value),1)):f("",!0),r.property.type==l(S).checkbox?(s(),n("div",Js,[o.value?(s(),n("i",Zs)):(s(),n("i",eo))])):f("",!0),r.property.type==l(S).color?(s(),n("div",{key:4,style:H({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):f("",!0),r.property.type==l(S).date?(s(),n("div",to,$(o.value),1)):f("",!0),r.property.type==l(S).image_link?(s(),n("div",so)):f("",!0),r.property.type==l(S).multi_tags?(s(),n("div",oo,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==l(S).number?(s(),n("div",no,$(o.value),1)):f("",!0),r.property.type==l(S).path?(s(),n("div",ao,$(o.value),1)):f("",!0),r.property.type==l(S).string?(s(),n("div",lo,$(o.value),1)):f("",!0),r.property.type==l(S)._id||r.property.type==l(S)._height||r.property.type==l(S)._width?(s(),n("div",io,$(o.value),1)):f("",!0),r.property.type==l(S).tag?(s(),n("div",ro,[b(Ve,{"property-id":r.property.id,value:o.value},null,8,["property-id","value"])])):f("",!0),r.property.type==l(S).url?(s(),n("div",po,$(o.value),1)):f("",!0)],64)):(s(),n("span",uo,"..."))}}),_o={class:"d-flex bb ps-1 overflow-hidden"},mo={class:"m-0 p-0 me-2 text-nowrap"},vo={key:0,class:"m-0 p-0 me-2",style:{width:"150px"}},yo=z({__name:"FilterPreview",props:{filter:Object},setup(d){const r=G(),e=d,o=I(()=>r.data.properties[e.filter.propertyId]);return(p,v)=>(s(),n("td",_o,[t("div",mo,$(p.$t("modals.filters.operators."+e.filter.operator)),1),l(Fe)(e.filter.operator)?(s(),n("div",vo,[b(co,{property:o.value,value:e.filter.value},null,8,["property","value"])])):f("",!0)]))}});const go=N(yo,[["__scopeId","data-v-532e0b3f"]]),fo={class:"m-0 bb",style:{}},ho={class:"p-2"},bo=z({__name:"PropertyDropdown",props:{modelValue:Object},emits:["update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=r,v=w(null);function y(h){v.value.hide(),p("update:modelValue",e.data.properties[h])}return(h,_)=>(s(),V(J,{ref_key:"dropdownElem",ref:v,"auto-focus":!1},{button:k(()=>[t("div",fo,[b(ie,{type:o.modelValue.type},null,8,["type"]),Q(" "+$(o.modelValue.name),1)])]),popup:k(()=>[t("div",ho,[b(ke,{modelValue:o.modelValue,"onUpdate:modelValue":_[0]||(_[0]=c=>o.modelValue=c),onSelect:y,"ignore-ids":[l(be).folders]},null,8,["modelValue","ignore-ids"])])]),_:1},512))}}),ce=d=>(W("data-v-b9005f3e"),d=d(),Y(),d),$o={class:"filter-group"},ko={class:"table table-sm"},xo={class:"align-top p-0 m-0"},wo={key:0,class:"m-0 p-0"},Io={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Co={class:""},So=["onClick"],Mo=ce(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Vo={key:2,class:"text-secondary"},Fo={key:0,class:"p-0 m-0 ps-2"},Eo={key:1,class:"p-0 m-0 ps-2"},Po={class:"border rounded"},To={class:""},zo=["onClick"],Oo=ce(()=>t("i",{class:"bi bi-trash"},null,-1)),Lo=[Oo],Go={class:"d-flex text-secondary ms-2"},No={class:"add-options hover-light"},Do=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),Ro=ce(()=>t("i",{class:"bi bi-plus"},null,-1)),Uo=z({__name:"FilterGroupInput",props:{filter:Object,manager:de,parent:HTMLElement},emits:["delete"],setup(d,{emit:r}){const e=G(),o=d,p=I(()=>o.filter),v=I(()=>p.value.filters),y=I(()=>{let a=255-(p.value.depth+1)*5;return`background: rgb(${a},${a},${a});`});function h(a,u){o.manager.updateFilter(a,{propertyId:u}),o.manager.update(!0)}function _(a){o.manager.deleteFilter(a.id),o.manager.update(!0)}function c(a){o.manager.addNewFilterGroup(a),o.manager.update(!0)}function i(a,u){o.manager.updateFilterGroup(a,u),o.manager.update(!0)}return(a,u)=>{const m=Pe("FilterGroupInput",!0);return s(),n("div",$o,[t("table",ko,[(s(!0),n(M,null,U(v.value,(g,x)=>(s(),n("tr",null,[t("td",xo,[x==0?(s(),n("div",wo,$(a.$t("modals.filters.where")),1)):x==1?(s(),V(J,{key:1},{button:k(()=>[t("div",Io,[t("span",Co,$(a.$t("modals.filters."+p.value.groupOperator)),1)])]),popup:k(({hide:O})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:O},[t("div",{class:"base-btn",onClick:u[0]||(u[0]=K=>i(p.value.id,l(Ce).and))},$(a.$t("modals.filters.and")),1),Mo,t("div",{class:"base-btn",onClick:u[1]||(u[1]=K=>i(p.value.id,l(Ce).or))},$(a.$t("modals.filters.or")),1)],8,So)]),_:1})):(s(),n("span",Vo,$(p.value.groupOperator),1))]),g.propertyId!==void 0?(s(),n("td",Fo,[b(bo,{"model-value":l(e).data.properties[g.propertyId],"onUpdate:modelValue":O=>h(g.id,O.id)},null,8,["model-value","onUpdate:modelValue"])])):f("",!0),g.propertyId!==void 0?(s(),n("td",Eo,[b(ue,{class:"flex-grow-1",manager:d.manager,mode:2,"parent-id":p.value.id,"filter-id":g.id,parent:o.parent},{default:k(()=>[b(go,{filter:g},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),n("td",{key:2,colspan:"3",style:H(y.value)},[t("div",Po,[b(m,{filter:g,manager:o.manager},null,8,["filter","manager"])])],4)),t("td",To,[t("span",{class:"base-btn",onClick:O=>_(g)},Lo,8,zo)])]))),256))]),t("div",Go,[b(ue,{manager:o.manager,"parent-id":p.value.id},{default:k(()=>[t("div",No,[Do,Q($(a.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:u[2]||(u[2]=g=>c(p.value.id))},[Ro,Q($(a.$t("modals.filters.new_group")),1)])])])}}});const jo=N(Uo,[["__scopeId","data-v-b9005f3e"]]),Ao=d=>(W("data-v-c6a37a82"),d=d(),Y(),d),Ho={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Bo={key:0},qo=Ao(()=>t("span",{class:"text-primary"},"Text Query",-1)),Ko={key:0,class:"or-separator"},Qo={key:0,class:"or-separator"},Wo={key:0,class:"m-1 p-0"},Yo=z({__name:"GlobalFilterInputDropdown",props:{manager:de},emits:["update:modelValue"],setup(d,{emit:r}){const e=G(),o=d,p=w(null),v=w(null),y=I(()=>{let _=h(o.manager.state.filter),c={};return _.forEach(i=>c[i.propertyId]=i),Object.values(c)});function h(_){let c=[];for(let i of _.filters)i.isGroup?c.push(...h(i)):c.push(i);return c}return A(()=>o.manager.state.filter.filters,()=>{o.manager.state.filter.filters.length==0&&v.value.hide()}),(_,c)=>(s(),V(J,{ref_key:"dropdownElem",ref:v},{button:k(()=>[t("div",null,[y.value.length||o.manager.state.query?(s(),n("div",Ho,[o.manager.state.query?(s(),n("div",Bo,[qo,y.value.length?(s(),n("span",Ko,"|")):f("",!0)])):f("",!0),(s(!0),n(M,null,U(y.value,(i,a)=>(s(),n("div",null,[a>0?(s(),n("span",Qo,"|")):f("",!0),i.propertyId==l(be).id?(s(),V(ie,{key:1,type:l(e).data.properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),t("span",null,$(l(e).data.properties[i.propertyId].name),1)]))),256))])):f("",!0)])]),popup:k(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:p},[Object.keys(l(e).data.properties).length>0?(s(),n("div",Wo,[b(jo,{filter:o.manager.state.filter,manager:o.manager,parent:p.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const Xo=N(Yo,[["__scopeId","data-v-c6a37a82"]]),Jo=d=>(W("data-v-1d7e82c5"),d=d(),Y(),d),Zo={class:"d-flex flex-row filter-form"},en={class:"pt-1 pb-1"},tn=Jo(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),sn=z({__name:"FilterForm",props:{manager:de},setup(d){const r=d;return(e,o)=>(s(),n("div",Zo,[t("div",en,$(e.$t("main.menu.filters"))+": ",1),b(Xo,{manager:r.manager},null,8,["manager"]),b(ue,{manager:r.manager,class:"p-1"},{default:k(()=>[tn]),_:1},8,["manager"])]))}});const on=N(sn,[["__scopeId","data-v-1d7e82c5"]]),nn=d=>(W("data-v-59c1ca07"),d=d(),Y(),d),an=nn(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),ln={class:"p-1"},rn=z({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(d,{emit:r}){const e=d,o=r,p=w(null);return(v,y)=>(s(),V(J,{ref_key:"dropdownElem",ref:p,"auto-focus":!1},{button:k(()=>[an]),popup:k(()=>[t("div",ln,[b(ke,{onClick:y[0]||(y[0]=h=>l(he)()),onSelect:y[1]||(y[1]=h=>{o("select",h),p.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const ze=N(rn,[["__scopeId","data-v-59c1ca07"]]),dn={class:"base-hover ps-1 pe-1"},pn={class:"main"},un=["onClick"],cn=z({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(d,{emit:r}){const e=d,o=r,p=Object.values(Te);function v(y){o("update:modelValue",y)}return(y,h)=>(s(),V(J,null,{button:k(()=>[t("div",dn,$(e.modelValue),1)]),popup:k(({hide:_})=>[t("div",pn,[(s(!0),n(M,null,U(l(p),c=>(s(),n("div",{class:"base-hover option",onClick:i=>{v(c),_()}},$(c),9,un))),256))])]),_:1}))}});const _n=N(cn,[["__scopeId","data-v-cc9d0d61"]]),mn=d=>(W("data-v-a27bea28"),d=d(),Y(),d),vn=mn(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),yn={class:""},gn={class:"d-flex ipt"},fn={class:"ms-2",min:"1"},hn=z({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(d,{emit:r}){const e=d,o=r,p=w(1),v=w(Te.Year);function y(){e.option.stepSize==p.value&&e.option.stepUnit==v.value||o("change",{stepSize:p.value,stepUnit:v.value})}function h(){p.value=e.option.stepSize??1,v.value=e.option.stepUnit}return A(()=>e.option,h),se(h),A(p,()=>{(p.value<1||p.value==null||isNaN(p.value))&&(p.value=1)}),(_,c)=>(s(),V(J,{onHide:y},{button:k(()=>[vn]),popup:k(({hide:i,focus:a})=>[t("div",yn,[t("div",gn,[t("div",null,[le(t("input",{type:"number","onUpdate:modelValue":c[0]||(c[0]=u=>p.value=u)},null,512),[[re,p.value]])]),t("div",fn,[b(_n,{modelValue:v.value,"onUpdate:modelValue":c[1]||(c[1]=u=>v.value=u),onHide:a},null,8,["modelValue","onHide"])])])])]),_:1}))}});const bn=N(hn,[["__scopeId","data-v-a27bea28"]]),$n={class:"d-flex flex-row group-form"},kn={class:"pt-1 pb-1"},xn={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},wn={key:0,class:"bi bi-chevron-right smaller"},In=["onClick"],Cn=["onClick"],Sn=["onClick"],Mn=["onClick"],Vn=["onClick"],Fn=["onClick"],En=["onClick"],Pn=["onClick"],Tn=["onClick"],zn={key:5,class:"sm-btn"},On={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Ln=z({__name:"GroupForm",props:{isLoading:Boolean,manager:qe},setup(d){const r=G(),e=d;function o(i){e.manager.setGroupOption(i),e.manager.update(!0)}function p(i){e.manager.delGroupOption(i),e.manager.update(!0)}function v(i,a){e.manager.setGroupOption(i,{direction:a}),e.manager.sortGroups(!0)}function y(i,a){e.manager.setGroupOption(i,{type:a}),e.manager.sortGroups(!0)}function h(i,a){e.manager.setGroupOption(i,a),e.manager.update(!0)}const _=I(()=>e.manager.state.groupBy.map(i=>r.data.properties[i])),c=I(()=>{const i=[];return e.manager.state.groupBy.forEach(a=>{i.push({option:e.manager.state.options[a],property:r.data.properties[a]})}),i});return(i,a)=>(s(),n("div",$n,[t("div",kn,$(i.$t("main.menu.groupby"))+": ",1),_.value.length?(s(),n("div",xn,[(s(!0),n(M,null,U(c.value,(u,m)=>(s(),n(M,null,[m>0?(s(),n("i",wn)):f("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:g=>p(u.property.id),id:"remove-group-button"},$(u.property.name),9,In),u.option.type==l(ee).Size?(s(),V(E,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:k(()=>[u.option.direction==l(X).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Property)},null,8,Cn)):(s(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:g=>y(u.property.id,l(ee).Property)},null,8,Sn))]),_:2},1024)):(s(),V(E,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:k(()=>[u.property.type==l(S).number?(s(),n(M,{key:0},[u.option.direction==l(X).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Mn)):(s(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Vn))],64)):(s(),n(M,{key:1},[u.option.direction==l(X).Ascending?(s(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,Fn)):(s(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:g=>y(u.property.id,l(ee).Size)},null,8,En))],64))]),_:2},1024)),u.option.direction==l(X).Ascending?(s(),V(E,{key:3,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:g=>v(u.property.id,l(X).Descending)},null,8,Pn)]),_:2},1024)):(s(),V(E,{key:4,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:g=>v(u.property.id,l(X).Ascending)},null,8,Tn)]),_:2},1024)),u.property.type==l(S).date?(s(),n("div",zn,[b(bn,{option:u.option,onChange:g=>h(u.property.id,g)},null,8,["option","onChange"])])):f("",!0)],64))),256)),e.isLoading?(s(),n("i",On)):f("",!0)])):f("",!0),b(ze,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:a[0]||(a[0]=u=>o(u))},null,8,["group-ids"])]))}});const Gn=N(Ln,[["__scopeId","data-v-47631987"]]),Nn={class:"d-flex flex-row sort-form"},Dn={class:"pt-1 pb-1"},Rn={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Un={key:0,class:"bi bi-chevron-right smaller"},jn=["onClick"],An=["onClick"],Hn=["onClick"],Bn=z({__name:"SortForm",props:{manager:Ke},setup(d){const r=G(),e=d,o=I(()=>e.manager.state.sortBy.map(_=>({propertyId:_,direction:e.manager.state.options[_].direction}))),p=I(()=>o.value.map(_=>_.propertyId));function v(_){e.manager.setSort(_),e.manager.update(!0)}function y(_){e.manager.delSort(_),e.manager.update(!0)}function h(_,c){e.manager.setSort(_,{direction:c}),e.manager.update(!0)}return(_,c)=>(s(),n("div",Nn,[t("div",Dn,$(_.$t("main.menu.sort.title"))+": ",1),o.value.length?(s(),n("div",Rn,[(s(!0),n(M,null,U(o.value,(i,a)=>(s(),n(M,null,[a>0?(s(),n("i",Un)):f("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>y(i.propertyId)},$(l(r).data.properties[i.propertyId].name),9,jn),i.direction==l(X).Ascending?(s(),V(E,{key:1,message:"main.menu.sort.order_asc"},{default:k(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>h(i.propertyId,l(X).Descending)},null,8,An)]),_:2},1024)):(s(),V(E,{key:2,message:"main.menu.sort.order_desc"},{default:k(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>h(i.propertyId,l(X).Ascending)},null,8,Hn)]),_:2},1024))],64))),256))])):f("",!0),b(ze,{"group-ids":p.value,onSelect:c[0]||(c[0]=i=>v(i))},null,8,["group-ids"])]))}});const qn=N(Bn,[["__scopeId","data-v-bc2e0a7f"]]),xe=d=>(W("data-v-8c580b43"),d=d(),Y(),d),Kn={class:"d-flex flex-row p-2"},Qn=xe(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Wn=["placeholder"],Yn={class:"me-5 d-flex"},Xn=xe(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Jn={class:"ms-5",style:{"font-size":"13px"}},Zn=["checked"],ea=xe(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),ta={class:"d-flex flex-wrap content-container ps-2"},sa=z({__name:"ContentFilter",props:{tab:Qe,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(d,{emit:r}){const e=d,o=w(""),p=I(()=>Object.keys(e.tab.collection.groupManager.selectedImages).map(Number)),v=I(()=>p.value.length);function y(i){const a=i.target.checked;e.tab.collection.groupManager.setSha1Mode(a,!0)}function h(){o.value=e.tab.state.filterState.query}function _(){e.tab.collection.filterManager.setQuery(o.value),e.tab.collection.filterManager.update(!0)}function c(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return se(h),A(()=>e.tab.collection.filterManager.state.query,h),(i,a)=>(s(),n(M,null,[t("div",Kn,[b(E,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:k(()=>[t("div",{class:R(["d-flex flex-row search-input me-5",o.value?"border-primary":""])},[Qn,le(t("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":a[0]||(a[0]=u=>o.value=u),onChange:_},null,40,Wn),[[re,o.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:c},"x")],2)]),_:1}),t("div",Yn,[b(E,{message:"main.menu.grid_tooltip"},{default:k(()=>[t("i",{class:R("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:a[1]||(a[1]=u=>e.tab.state.display="tree")},null,2)]),_:1}),b(E,{message:"main.menu.table_tooltip"},{default:k(()=>[t("i",{id:"toot",class:R("bi bi-table btn-icon"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:a[2]||(a[2]=u=>e.tab.state.display="grid")},null,2)]),_:1})]),b(E,{message:"main.menu.image_size_tooltip",click:!1},{default:k(()=>[Xn]),_:1}),t("div",null,[b(We,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":a[3]||(a[3]=u=>e.tab.state.imageSize=u)},null,8,["modelValue"])]),t("div",Jn,[b(E,{message:"main.menu.image_mode_tooltip"},{default:k(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:y},null,40,Zn),ea]),_:1})]),v.value?(s(),V(Ye,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":p.value,"onRemove:selected":a[4]||(a[4]=u=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):f("",!0)]),t("div",ta,[b(on,{manager:e.tab.collection.filterManager},null,8,["manager"]),b(Gn,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),b(qn,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const oa=N(sa,[["__scopeId","data-v-8c580b43"]]),na={class:""},aa=["src"],la={class:"d-flex flex-row"},ia=z({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(d,{emit:r}){const e=$e();G();const o=d,p=r,v=I(()=>`width: ${o.size}px; height: ${o.size}px;`),y=I(()=>`max-width: ${o.size-2}px; max-height: ${o.size-1}px;`),h=I(()=>o.pile.images[0]);return(_,c)=>(s(),n("div",na,[b(Xe,{image:h.value},{default:k(()=>[t("div",{style:H(v.value),class:"img-container",onClick:c[0]||(c[0]=i=>l(e).showModal(l(te).IMAGE,{image:h.value}))},[t("img",{src:h.value.url,style:H(y.value)},null,12,aa)],4)]),_:1},8,["image"]),t("div",la,[b(E,{message:"main.recommand.accept"},{default:k(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:c[1]||(c[1]=i=>p("accept",h.value))}," ✓ ",4)]),_:1}),b(E,{message:"main.recommand.refuse"},{default:k(()=>[t("div",{style:H(["width: "+o.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:c[2]||(c[2]=i=>p("refuse",h.value))}," ✕ ",4)]),_:1})])]))}});const ra=N(ia,[["__scopeId","data-v-1ea540e7"]]),pe=d=>(W("data-v-413fd1d1"),d=d(),Y(),d),da={class:"reco-container"},pa={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},ua=pe(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),ca=[ua],_a=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),ma=pe(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),va=[ma],ya=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),ga={key:0,class:"bi bi-funnel-fill bb text-primary"},fa={key:1,class:"bi bi-funnel bb"},ha=pe(()=>t("div",{class:"b-left pe-1"},null,-1)),ba={class:"text-secondary me-2"},$a={class:"flex-grow-1"},ka={class:"d-flex flex-row"},xa={key:0,class:"separator"},wa={class:"d-flex flex-row"},fe=10,Ia=z({__name:"RecommendedMenu",props:{imageSize:Number,group:Object,width:Number,height:Number},emits:["scroll","close","update"],setup(d,{emit:r}){const e=G(),o=Je(),p=d,v=r,y=w(1),h=ae([]),_=ae([]),c=ae([]),i=ae(new Set),a=w(!0);function u(L){let C=_.indexOf(L);C<0||(_.splice(C,1),x())}function m(L){console.log(c),c.forEach(C=>{if(console.log(C.value),C.value!=et){const P=e.data.properties[C.propertyId];let F=C.value;console.log(P.type),P.type==S.multi_tags?e.setTagPropertyValue(C.propertyId,L,[F],"add"):P.type==S.tag?e.setPropertyValue(C.propertyId,L,[F]):e.setPropertyValue(C.propertyId,L,F)}}),u(L.sha1)}function g(L){i.add(L.sha1),u(L.sha1)}function x(){h.length=0;const L=_.map(C=>({sha1:C,images:e.data.sha1Index[C]}));O(L,h,y.value,p.imageSize,p.width)}function O(L,C,P,F,T){let D=T,j=[],_e=0;for(let me=0;me<L.length&&!(C.length>=P);me++){let ve=L[me];if(i.has(ve.sha1))continue;let ye=F+fe;if(_e+ye<D){j.push(ve),_e+=ye;continue}if(j.length==0)throw new Error("Images seems to be to big for the line");C.push(j),C.length<P&&(j=[ve],_e=ye)}j.length>0&&C.length<P&&C.push(j)}async function K(){if(!p.group)return;console.log("get reco");const L=p.group.images.map(T=>T.id);let C=await o.getSimilarImages({instanceIds:L});if(C.matches.sort((T,D)=>D.score-T.score),a.value){const T=e.getTabManager(),D=new Set(T.collection.groupManager.result.root.images.map(j=>j.id));C.matches=C.matches.filter(j=>D.has(j.id))}const P=Array.from(new Set(C.matches.map(T=>e.data.images[T.id].sha1)));c.length=0;let F=p.group;for(;F;)c.push(...F.meta.propertyValues),F=F.parent;_.length=0,_.push(...P),i.clear(),x(),v("update")}function ne(){a.value=!a.value}return se(K),A(()=>p.group,()=>{K(),i.clear()}),A(()=>p.imageSize,x),A(()=>p.width,x),A(a,K),(L,C)=>(s(),n("div",da,[t("div",pa,[t("div",{class:"text-secondary pe-1",onClick:C[0]||(C[0]=P=>v("close"))},ca),_a,t("div",{class:"text-secondary pe-1",onClick:C[1]||(C[1]=P=>v("scroll",p.group.id))},va),ya,t("div",{class:"text-secondary pe-1",onClick:ne},[a.value?(s(),n("span",ga)):(s(),n("span",fa))]),ha,b(E,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:k(()=>[t("span",ba,$(L.$t("main.recommand.title")),1)]),_:1}),t("div",$a,[t("div",ka,[(s(!0),n(M,null,U(c,(P,F)=>(s(),n(M,null,[b(Ze,{class:"",value:P},null,8,["value"]),F<c.length-1?(s(),n("div",xa)):f("",!0)],64))),256))])])]),t("div",{style:H("margin-left:"+fe+"px;")},[(s(!0),n(M,null,U(h,P=>(s(),n("div",null,[t("div",wa,[(s(!0),n(M,null,U(P,F=>(s(),V(ra,{pile:F,size:p.imageSize,onAccept:m,onRefuse:g,style:H("margin-right:"+fe+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Ca=N(Ia,[["__scopeId","data-v-413fd1d1"]]),Sa={key:0,class:"m-0 p-0"},Ma={key:0,style:{"margin-left":"10px"}},Va=z({__name:"MainView",props:{tabId:Number,height:Number},setup(d){const r=G(),e=r.getTabManager(),o=d,p=w({}),v=w(null),y=w(null),h=w(null);w([]);const _=w(0),c=w(0),i=ae({groups:!1}),a=I(()=>e.getVisibleProperties());function u(){v.value&&y.value?_.value=o.height-v.value.clientHeight-y.value.clientHeight-5:v.value?_.value=o.height-v.value.clientHeight-5:_.value=0}e.collection.groupManager.onChange.addListener(()=>{h.value&&e.state.display=="tree"&&h.value.computeLines()});function m(x){p.value=e.collection.groupManager.result.index[x],Z(()=>u())}function g(){p.value={},Z(()=>u())}return se(()=>{c.value=v.value.clientWidth,window.addEventListener("resize",()=>{Z(()=>{var x;c.value=((x=v.value)==null?void 0:x.clientWidth)??c.value})})}),A(e.state,x=>{r.updateTabs()},{deep:!0}),A(()=>e.state.imageSize,()=>Z(u)),A(()=>o.height,async()=>{await Z(u)}),(x,O)=>(s(),n(M,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:v},[b(oa,{tab:l(e),"compute-status":i},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[p.value.id?(s(),n("div",Sa,[b(Ca,{group:p.value,"image-size":l(e).state.imageSize,width:c.value,height:50,onClose:g,onScroll:h.value.scrollTo,onUpdate:O[0]||(O[0]=K=>Z(()=>u()))},null,8,["group","image-size","width","onScroll"])])):f("",!0)],512),c.value>0&&_.value>0?(s(),n("div",Ma,[l(e).state.display=="tree"?(s(),V(tt,{key:0,"group-manager":l(e).collection.groupManager,"image-size":l(e).state.imageSize,height:_.value-0,properties:a.value,"hide-if-modal":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,width:c.value-25,onRecommend:m},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),l(e).state.display=="grid"?(s(),n("div",{key:1,style:H({width:c.value-12+"px"}),class:"p-0 m-0 grid-container"},[b(st,{manager:l(e).collection.groupManager,height:_.value-15,width:c.value-40,"selected-properties":a.value,class:"p-0 m-0","show-images":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:h,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):f("",!0)])):f("",!0)],64))}});const Fa=N(Va,[["__scopeId","data-v-d071a1ff"]]),Ea={class:"d-flex d-row",style:{cursor:"pointer"}},Pa=["onMouseenter","onMouseleave"],Ta=["onClick"],za=["onClick"],Oa=["onClick"],La=["onSubmit"],Ga=["onKeydown","onUpdate:modelValue"],Na=t("span",{class:"bi bi-plus"},null,-1),Da=[Na],Ra={class:"lang"},Ua=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),ja=["value"],Aa=z({__name:"TabNav",props:{reRender:Function},setup(d){const r=G(),e=w(-1),o=w(""),p=w(null),v=d;function y(m){r.data.selectedTabId==m||_(),r.selectTab(m)}function h(m){e.value=m,o.value=r.data.tabs[m].name,Z(()=>p.value[0].focus())}function _(){e.value=-1,o.value=""}function c(m){r.addTab("New Tab")}async function i(m){confirm("Are you sure to delete Tab: "+m.name)&&await r.removeTab(m.id)}const a=ae({});w(-1);const u=["fr","en"];return(m,g)=>(s(),n("nav",null,[t("div",Ea,[(s(!0),n(M,null,U(l(r).data.tabs,x=>(s(),n("div",{class:"d-flex d-row me-2",onMouseenter:O=>a[x.id]=!0,onMouseleave:O=>a[x.id]=!1},[e.value!=x.id?(s(),n(M,{key:0},[b(E,{message:"main.menu.rename_tab_tooltip"},{default:k(()=>[t("i",{onClick:O=>h(x.id),class:R(["bi bi-pencil me-1 tab-icon hover-light",a[x.id]&&l(r).data.selectedTabId==x.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,Ta)]),_:2},1024),t("div",{class:R(["tab-button",x.id==l(r).data.selectedTabId?" active":""]),onClick:O=>y(x.id)},[t("span",null,$(x.name),1)],10,za),b(E,{message:"main.menu.delete_tab_tooltip"},{default:k(()=>[t("i",{onClick:O=>i(x),class:R(["btn-icon bi bi-x tab-icon hover-light",a[x.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Oa)]),_:2},1024)],64)):(s(),n("div",{key:1,class:R(["tab-button",x.id==l(r).data.selectedTabId?" active":""])},[t("form",{onSubmit:Ee(_,["stop","prevent"])},[le(t("input",{onFocusout:_,onKeydown:ot(_,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":O=>x.name=O,ref_for:!0,ref_key:"inputElem",ref:p},null,40,Ga),[[re,x.name]])],40,La)],2))],40,Pa))),256)),b(E,{message:"main.menu.add_tab_tooltip"},{default:k(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:c,id:"add-tab-button"},Da)]),_:1}),t("div",Ra,[Ua,le(t("select",{"onUpdate:modelValue":g[0]||(g[0]=x=>m.$i18n.locale=x),onChange:g[1]||(g[1]=x=>v.reRender())},[(s(),n(M,null,U(u,(x,O)=>t("option",{key:`Lang${O}`,value:x},$(x.toUpperCase()),9,ja)),64))],544),[[nt,m.$i18n.locale]])])])]))}});const Oe=d=>(W("data-v-5b158f06"),d=d(),Y(),d),Ha={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Ba={key:0},qa={key:1,class:"w-100"},Ka={key:0,class:"custom-hr"},Qa={key:2,class:"loading"},Wa={class:"text-center"},Ya={key:3,class:"loading"},Xa=Oe(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Ja=Oe(()=>t("span",{class:"ms-1"},"Loading...",-1)),Za=[Xa,Ja],el=z({__name:"PanopticView",setup(d){const r=G(),e=$e(),o=w(null),p=w(null),v=w(window.innerHeight),y=w(!1),h=I(()=>{var m;return v.value-(((m=p.value)==null?void 0:m.clientHeight)??0)}),_=I(()=>{var m;return(m=o.value)==null?void 0:m.filteredImages.map(g=>g.id)});se(async()=>{e.isProjectLoaded||Se.push("/"),Z(()=>{window.addEventListener("resize",c),c()}),window.addEventListener("keydown",m=>{m.key=="Control"&&(B.ctrl=!0),m.key=="Alt"&&(B.alt=!0),m.key=="Shift"&&(B.shift=!0),m.key=="ArrowLeft"&&(B.left=!0),m.key=="ArrowRight"&&(B.right=!0,console.log("keeeyy"))}),window.addEventListener("keyup",m=>{m.key=="Control"&&(B.ctrl=!1),m.key=="Alt"&&(B.alt=!1),m.key=="Shift"&&(B.shift=!1),m.key=="ArrowLeft"&&(B.left=!1),m.key=="ArrowRight"&&(B.right=!1)}),window.addEventListener("mousemove",m=>{B.ctrl=m.ctrlKey,B.alt=m.altKey,B.shift=m.shiftKey})}),at(()=>{window.removeEventListener("resize",c)});function c(){v.value=window.innerHeight,y.value=!0}function i(){e.showModal(te.EXPORT,_)}function a(){r.rerender()}function u(){Se.push("/")}return(m,g)=>(s(),n(M,null,[b(lt,{tutorial:"project"}),(s(),n("div",{id:"panoptic",key:l(r).status.renderNb},[t("div",Ha,[l(r).status.loaded?(s(),n("div",Ba,[b(Ks,{onExport:g[0]||(g[0]=x=>i())})])):f("",!0),l(r).status.loaded?(s(),n("div",qa,[t("div",{class:"ms-3",ref_key:"navElem",ref:p},[b(Aa,{"re-render":a})],512),y.value?(s(),n("div",Ka)):f("",!0),l(r).status.loaded?(s(),V(Fa,{key:1,"tab-id":l(r).data.selectedTabId,height:h.value,ref_key:"mainViewRef",ref:o},null,8,["tab-id","height"])):f("",!0)])):l(e).isProjectLoaded?(s(),n("div",Ya,Za)):(s(),n("div",Qa,[t("div",Wa,[t("div",null,$(m.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:u,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const ol=N(el,[["__scopeId","data-v-5b158f06"]]);export{ol as default};
