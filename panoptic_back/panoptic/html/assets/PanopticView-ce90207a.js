import{d as O,x as J,r as S,c as C,o as s,j as E,s as w,b as t,t as y,n as A,a as o,l as H,F as z,D as oe,y as Ne,_ as N,z as _e,h as pe,A as K,B as Ae,C as Pe,e as i,P as De,k as g,q as k,E as ke,G as V,H as He,I as Ue,S as Be,J as qe,K as Ke,L as Qe,p as Q,f as W,N as ee,O as xe,w as ue,v as ge,Q as we,R as P,T as Oe,m as te,U as We,V as Se,W as B,X as be,Y as Ve,u as Ce,M as le,g as Ie,Z as Ye,$ as Ze,a0 as Fe,a1 as Xe,a2 as Le,a3 as Je,a4 as ie,a5 as se,a6 as et,a7 as tt,a8 as st,a9 as ot,aa as at,ab as nt,ac as ce,ad as it,ae as lt,af as ne,ag as rt,ah as dt,ai as ct,aj as pt,i as Te,ak as q,al as ut}from"./index-e325c2d4.js";import{_ as _t}from"./Tutorial-551fab9f.js";const mt=["disabled"],vt={class:"m-0 p-1"},ht=["onClick"],gt=O({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(p,{emit:d}){const e=J(),a=p,u=d,v=S(null),h=C(()=>e.properties[a.propertyId]),$=C(()=>Ne(h.value.type));async function m(_){u("update:modelValue",_),v.value.hide()}return(_,l)=>(s(),E(oe,{onHide:l[0]||(l[0]=n=>u("hide")),ref_key:"dropdownElem",ref:v,parent:a.parent},{button:w(()=>[t("div",{class:A(["text-nowrap",a.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:a.disabled},[t("span",null,y(_.$t("modals.filters.operators."+a.modelValue)),1)],10,mt)]),popup:w(()=>[t("div",vt,[(s(!0),o(z,null,H($.value,n=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:r=>m(n)},[t("a",null,y(_.$t("modals.filters.operators."+n)),1)],8,ht))),256))])]),_:1},8,["parent"]))}});const yt=N(gt,[["__scopeId","data-v-28740c65"]]),ft=p=>(Q("data-v-4cc12131"),p=p(),W(),p),bt={class:"m-0 p-0"},$t={key:1},kt={class:"d-flex mode-header"},xt={class:"me-3"},wt=ft(()=>t("div",{class:"flex-fill"},null,-1)),It={key:0,class:"me-2",style:{width:"100%"}},St=O({__name:"FilterDropdown",props:{manager:_e,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(p){const d=J(),e=p,a=S(null),u=S(null),v=S(null),h=S(0),$=S(null),m=S(null),_=C(()=>e.filterId!==void 0?e.filterId:$.value),l=C(()=>{if(!(_.value==null||_.value==-1))return e.manager.filterIndex[_.value]}),n=C(()=>l.value==null?void 0:d.properties[l.value.propertyId]);function r(){h.value=e.mode,e.mode==2&&e.filterId==null&&F(e.propertyId)}function c(){a.value&&a.value.hide()}function f(){h.value=0}function b(){c(),e.manager.deleteFilter(_.value)}function F(x){let I=e.manager.addNewFilter(x,e.parentId);$.value=I.id,h.value=2}function D(x){m.value=null,e.manager.updateFilter(_.value,{operator:x}),u.value&&u.value.focus(),ke(x)||c()}function U(){console.log("update value",m.value),e.manager.updateFilter(_.value,{value:m.value})}function Z(){if(!l.value)return;const x=d.properties[l.value.propertyId];if(Ke(x.type))return;const I=m.value??Qe(x.type);l.value.value!=I&&U()}function M(){l.value&&(m.value=l.value.value)}return pe(M),K(()=>l.value,()=>M()),(x,I)=>(s(),E(oe,{ref_key:"dropdownElem",ref:a,onShow:r,onHide:f,parent:e.parent},{button:w(()=>[t("div",bt,[Ae(x.$slots,"default",{},void 0,!0)])]),popup:w(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[h.value!=0?(s(),o(z,{key:0},[h.value==1?(s(),E(Pe,{key:0,onSelect:F,"ignore-ids":[i(De).folders]},null,8,["ignore-ids"])):g("",!0),h.value==2?(s(),o("div",$t,[t("div",kt,[t("div",xt,y(n.value.name),1),k(yt,{"property-id":l.value.propertyId,"model-value":l.value.operator,"onUpdate:modelValue":D,parent:v.value},null,8,["property-id","model-value","parent"]),wt,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:b})])]),i(ke)(l.value.operator)?(s(),o("div",It,[n.value.type==i(V).multi_tags||n.value.type==i(V).tag?(s(),E(He,{key:0,modelValue:m.value,"onUpdate:modelValue":[I[0]||(I[0]=T=>m.value=T),U],"auto-focus":!0,property:i(d).properties[l.value.propertyId],ref_key:"inputElem",ref:u,onHide:c},null,8,["modelValue","property"])):n.value.type==i(V).color?(s(),E(Ue,{key:1,property:n.value,modelValue:m.value,"onUpdate:modelValue":[I[1]||(I[1]=T=>m.value=T),I[2]||(I[2]=()=>{c(),Z()})]},null,8,["property","modelValue"])):n.value.type==i(V).date?(s(),E(Be,{key:2,property:n.value,modelValue:m.value,"onUpdate:modelValue":[I[3]||(I[3]=T=>m.value=T),I[4]||(I[4]=()=>{c(),Z()})]},null,8,["property","modelValue"])):(s(),E(qe,{key:3,"no-html":!0,modelValue:m.value,"onUpdate:modelValue":I[5]||(I[5]=T=>m.value=T),width:-1,"min-height":20,"no-nl":i(d).properties[l.value.propertyId].type==i(V).number,"url-mode":i(d).properties[l.value.propertyId].type==i(V).url,"only-number":i(d).properties[l.value.propertyId].type==i(V).number,onBlur:Z,"auto-focus":!0,ref_key:"inputElem",ref:u},null,8,["modelValue","no-nl","url-mode","only-number"]))])):g("",!0)])):g("",!0)],64)):g("",!0)],512)]),_:3},8,["parent"]))}});const he=N(St,[["__scopeId","data-v-4cc12131"]]),re=p=>(Q("data-v-acacde12"),p=p(),W(),p),Ct={class:"d-flex flex-row"},Mt={key:1,class:"d-flex",style:{width:"150px"}},Vt={class:"flex-grow-1"},Ft={key:1,style:{"padding-top":"1px"}},Tt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Et=re(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),zt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Pt=re(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Dt=re(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Ot={key:0,class:"ms-3 pt-1"},Lt=re(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Gt=re(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),jt=re(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),Rt=re(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Nt={key:1},At=O({__name:"PropertyOptions",props:{property:Object},setup(p){const d=ee(),e=d.getTabManager(),a=p,u=S(!1),v=S(!1),h=S(""),$=S(!1),m=C(()=>d.getTab()),_=C(()=>m.value.visibleProperties[a.property.id]==!0),l=C(()=>e.collection.filterManager.state.filter.filters.some(T=>!T.isGroup&&T.propertyId==a.property.id)),n=C(()=>e.collection.groupManager.state.groupBy.includes(a.property.id)),r=C(()=>e.collection.sortManager.state.sortBy.includes(a.property.id)),c=C(()=>{if(l.value)return e.collection.filterManager.state.filter.filters.find(T=>!T.isGroup&&T.propertyId==a.property.id).id}),f=()=>e.collection.filterManager,b=C(()=>e.getSha1Mode());function F(){_.value?e.setVisibleProperty(a.property.id,!1):e.setVisibleProperty(a.property.id,!0)}function D(){u.value?u.value=!1:(u.value=!0,h.value=a.property.name),v.value=!1}function U(){a.property.type!=V.tag&&a.property.type!=V.multi_tags||(v.value?v.value=!1:v.value=!0,u.value=!1)}function Z(){r.value?e.collection.sortManager.delSort(a.property.id):e.collection.sortManager.setSort(a.property.id),e.collection.sortManager.update(!0)}function M(){n.value?e.collection.groupManager.delGroupOption(a.property.id):e.collection.groupManager.setGroupOption(a.property.id),e.collection.groupManager.update(!0)}function x(){confirm("Supprimer la propriété: "+a.property.name+" ?")&&d.deleteProperty(a.property.id)}async function I(){h.value!=""&&(await d.updateProperty(a.property.id,h.value),D())}return K(()=>a.property,()=>{u.value=!1}),(T,L)=>(s(),o("div",{class:A($.value?"hover-light":"")},[t("div",Ct,[u.value?g("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:D},[k(xe,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:L[0]||(L[0]=G=>$.value=!0),onMouseleave:L[1]||(L[1]=G=>$.value=!1)},null,8,["type"]),t("span",null,y(a.property.name),1)])),u.value?(s(),o("div",Mt,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:D,onMouseenter:L[2]||(L[2]=G=>$.value=!0),onMouseleave:L[3]||(L[3]=G=>$.value=!1)},null,32)]),t("div",Vt,[a.property.id>=0?ue((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":L[4]||(L[4]=G=>h.value=G),onChange:I},null,544)),[[ge,h.value]]):(s(),o("span",Ft,[k(xe,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,y(a.property.name),1)]))])])):g("",!0),t("div",Tt,[a.property.mode==i(we).id?(s(),E(P,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:w(()=>[Et]),_:1})):g("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:F,class:"btn-icon text-center"},[b.value&&a.property.mode==i(we).id?(s(),E(P,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:w(()=>[t("span",{class:"bi bi-eye-slash",onClick:L[5]||(L[5]=Oe(()=>{},["stop"]))})]),_:1})):(s(),E(P,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:w(()=>[t("span",{class:A("bi bi-eye text-"+(_.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",zt,[a.property.type==i(V).tag||a.property.type==i(V).multi_tags?(s(),o("div",{key:0,onClick:U,style:{cursor:"pointer"}},[v.value?(s(),E(P,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:w(()=>[Pt]),_:1})):(s(),E(P,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:w(()=>[Dt]),_:1}))])):g("",!0)])]),t("div",null,[u.value?(s(),o("div",Ot,[t("div",{class:A(["options hover-light",l.value?" text-primary":""])},[k(he,{manager:f(),"filter-id":c.value,mode:2,"property-id":p.property.id},{default:w(()=>[Lt,te(y(T.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:A(["options hover-light",r.value?" text-primary":""]),onClick:Z},[Gt,te(y(T.$t("main.menu.sort.title")),1)],2),t("div",{class:A(["options hover-light",n.value?" text-primary":""]),onClick:M},[jt,te(y(T.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:x},[Rt,te(y(T.$t("main.nav.properties.delete_property")),1)])):g("",!0)])):v.value?(s(),o("div",Nt,[k(We,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):g("",!0)])],2))}});const Ee=N(At,[["__scopeId","data-v-acacde12"]]),Ht=t("i",{class:"bi bi-three-dots base-hover"},null,-1),Ut={class:"p-2"},Bt=["onClick"],qt=t("i",{class:"bi bi-arrow-clockwise"},null,-1),Kt=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(p){const d=ee(),e=p;function a(){d.reImportFolder(e.folder.id)}return(u,v)=>(s(),E(oe,{teleport:!0},{button:w(()=>[Ht]),popup:w(({hide:h})=>[t("div",Ut,[t("div",{class:"base-hover p-1",onClick:$=>{a(),h()}},[qt,te(" Re import")],8,Bt)])]),_:1}))}}),Qt=["onMouseenter"],Wt=["onClick"],Yt={class:"text-secondary"},Zt=["onClick"],Xt=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:_e,root:{type:Boolean,default:!0}},setup(p){const d=ee(),e=p,a=S(null),u=C(()=>{let l={};const n=new Set(e.filterManager.state.folders);return e.folders.map(r=>r.id).forEach(r=>{n.has(r)&&(l[r]=!0)}),l}),v=C(()=>{let l={};return e.folders.map(n=>n.id).forEach(n=>{e.visibleFolders[n]&&(l[n]=!0)}),l}),h=C(()=>{let l={};return e.folders.forEach(n=>{let r=[];u.value[n.id]&&r.push("selected"),l[n.id]=r.join(" ")}),l});function $(l){let n=e.visibleFolders;n[l]?delete n[l]:n[l]=!0}function m(l){let n=new Set(e.filterManager.state.folders);const r=n.has(l),c=d.data.folders[l].parent!=null&&n.has(d.data.folders[l].parent);r&&!c?(n.delete(l),be(l).forEach(f=>n.delete(f.id))):(_(l,n),n.add(l),be(l).forEach(f=>n.add(f.id)),Ve(d.data.folders[l]).forEach(f=>n.delete(f.id))),e.filterManager.setFolders(Array.from(n)),e.filterManager.update(!0)}function _(l,n){const r=Ve(d.data.folders[l]);let c;for(let f of r)if(n.has(f.id))c=f;else break;c!=null&&be(c.id).forEach(f=>n.delete(f.id))}return(l,n)=>{const r=Se("FolderList2",!0);return s(),o("ul",{class:A(e.root?"tree":""),style:B(e.root?"padding-left:0px;":"")},[(s(!0),o(z,null,H(p.folders,c=>(s(),o("li",{style:B(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:f=>a.value=c.id,onMouseleave:n[0]||(n[0]=f=>a.value=null)},[t("summary",{class:A(h.value[c.id]),onClick:f=>m(c.id)},[te(y(c.name)+" ",1),t("span",Yt,y(c.count),1)],10,Wt),c.children&&c.children.length>0?(s(),o("i",{key:0,onClick:f=>$(c.id),class:A("bi bi-chevron-"+(v.value[c.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,Zt)):g("",!0),t("span",{class:A(a.value===c.id?"visible-option":"invisible-option")},[k(Kt,{folder:c,style:{display:"inline-block"}},null,8,["folder"])],2),c.children&&c.children.length>0&&v.value[c.id]?(s(),E(r,{key:1,folders:c.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):g("",!0)],44,Qt))),256))],6)}}});const Jt=N(Xt,[["__scopeId","data-v-70a1ae09"]]),es={class:"text-center"},ts={class:"w-100 text-center",style:{"font-size":"10px"}},ss={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},os=O({__name:"TaskStatus",props:{task:{}},setup(p){const d=p,e=C(()=>d.task.total-d.task.remain-d.task.computing),a=C(()=>d.task.total);return(u,v)=>(s(),o("div",es,[te(y(d.task.name)+" ",1),t("div",ts,y(e.value)+" / "+y(a.value)+" "+y(u.$t("main.nav.tasks.done")),1),a.value>0?(s(),o("div",ss,[t("div",{class:"progress-bar",style:B(`width: ${e.value/a.value*100}%`)},null,4)])):g("",!0)]))}}),Y=p=>(Q("data-v-ed16c605"),p=p(),W(),p),as={class:"menu overflow-scroll"},ns={class:""},is={class:"m-0",style:{padding:"4px 0px 4px 8px"}},ls={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},rs=Y(()=>t("i",{class:"bi bi-gear"},null,-1)),ds=[rs],cs=Y(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),ps=[cs],us=Y(()=>t("div",{class:"custom-hr"},null,-1)),_s={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},ms={class:"d-flex align-items-center"},vs=Y(()=>t("i",{class:"bi bi-plus"},null,-1)),hs={class:"overflow-scroll"},gs={key:0,id:"import"},ys=Y(()=>t("div",{class:"custom-hr"},null,-1)),fs={class:"pt-1 pb-2"},bs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},$s=Y(()=>t("div",{class:"custom-hr"},null,-1)),ks={key:0,class:"ps-2 pe-2"},xs={class:"p-1"},ws={key:0,class:"custom-hr"},Is={key:1,class:"p-2"},Ss=Y(()=>t("div",{class:"custom-hr"},null,-1)),Cs={key:0,class:"float-end"},Ms={class:"text-center"},Vs={class:"w-100 text-center",style:{"font-size":"10px"}},Fs={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ts={key:2,class:"p-2"},Es={class:"w-100 text-center",style:{"font-size":"10px"}},zs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Ps=Y(()=>t("div",{class:"custom-hr"},null,-1)),Ds={class:"p-2 mt-0"},Os={class:"d-flex"},Ls=Y(()=>t("span",{class:"flex-grow-1"},null,-1)),Gs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},js=Y(()=>t("span",{class:"sr-only"},null,-1)),Rs=[js],Ns={key:1,class:"bb me-1"},As={class:"bb me-2"},Hs={key:0,class:"mt-2"},Us={key:0,class:"property-item"},Bs=Y(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),qs=Y(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Ks=Y(()=>t("div",{class:"custom-hr"},null,-1)),Qs={class:"p-2 mt-0"},Ws={key:0,class:"mt-2"},Ys={key:0,class:"property-item"},Zs=O({__name:"Menu",emits:["export"],setup(p,{emit:d}){const e=ee(),a=J(),u=Ce(),v=e.getTabManager(),h=S(!1),$=S(!1),m=async r=>{u.showModal(le.IMPORT)},_=C(()=>e.backendStatus.tasks.filter(r=>!(r.name=="Load Plugin"&&r.done)));function l(){u.showModal(le.FOLDERSELECTION,{callback:n,mode:"images"})}function n(r){r&&e.addFolder(r)}return K(()=>e.status.import.to_import,()=>h.value=!0),(r,c)=>{var f;return s(),o("div",as,[t("div",ns,[t("div",null,[t("div",is,[t("div",ls,[t("div",{class:"flex-grow-1 text-capitalize",onClick:c[0]||(c[0]=()=>{})},y((f=i(u).data.status.selectedProject)==null?void 0:f.name),1),t("div",{class:"base-hover p-1",onClick:c[1]||(c[1]=b=>i(u).showModal(i(le).SETTINGS))},ds),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:c[2]||(c[2]=b=>i(u).closeProject())},ps)])]),us,t("div",_s,[t("div",ms,[t("div",null,[t("b",null,y(r.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:c[3]||(c[3]=b=>{l(),i(Ie)()})},[k(P,{message:"main.nav.folders.add"},{default:w(()=>[vs]),_:1})])]),t("div",hs,[i(e).getTab()?(s(),E(Jt,{key:0,folders:i(e).folderRoots,"filter-manager":i(v).collection.filterManager,"visible-folders":i(v).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):g("",!0)])]),_.value&&_.value.length?(s(),o("div",gs,[ys,t("div",fs,[t("div",bs,[t("div",null,[t("b",null,y(r.$t("main.nav.tasks.title")),1)])]),$s,i(e).backendStatus?(s(),o("div",ks,[(s(!0),o(z,null,H(_.value,(b,F)=>(s(),o("div",xs,[F?(s(),o("div",ws)):g("",!0),k(os,{task:b},null,8,["task"])]))),256))])):g("",!0)])])):g("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&h.value?(s(),o("div",Is,[Ss,i(e).status.import.done?(s(),o("div",Cs,[t("i",{class:"bi bi-x base-hover",onClick:c[4]||(c[4]=b=>h.value=!1)})])):g("",!0),t("div",Ms,[t("b",null,y(r.$t("main.menu.import_status_title")),1)]),t("div",Vs,y(i(e).status.import.imported)+" / "+y(i(e).status.import.to_import)+" importées ",1),i(e).status.import.to_import>0?(s(),o("div",Fs,[t("div",{class:"progress-bar",style:B(`width: ${i(e).status.import.imported/i(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),i(e).status.import.to_import!=null&&i(e).status.import.to_import>0&&h.value?(s(),o("div",Ts,[t("div",Es,y(i(e).status.import.computed)+" / "+y(i(e).status.import.to_import)+" computed ",1),i(e).status.import.to_import>0?(s(),o("div",zs,[t("div",{class:"progress-bar",style:B(`width: ${i(e).status.import.computed/i(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),Ps,t("div",Ds,[t("div",Os,[k(P,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:w(()=>[t("b",null,y(r.$t("main.nav.properties.title")),1)]),_:1}),Ls,$.value?(s(),o("span",Gs,Rs)):(s(),o("span",Ns,[k(P,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:w(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:m})]),_:1})])),t("span",As,[k(P,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:w(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:c[5]||(c[5]=b=>i(u).showModal(i(le).EXPORT,void 0))})]),_:1})])]),i(e).status.loaded?(s(),o("div",Hs,[(s(!0),o(z,null,H(i(a).properties,b=>(s(),o(z,null,[b.id>=0?(s(),o("div",Us,[k(Ee,{property:b},null,8,["property"])])):g("",!0)],64))),256)),Bs,t("div",{id:"add-property",onClick:c[6]||(c[6]=b=>{i(u).showModal(i(le).PROPERTY,void 0),i(Ie)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[qs,t("span",null,y(r.$t("main.nav.properties.add_property")),1)])])):g("",!0)]),Ks,t("div",Qs,[k(P,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:w(()=>[t("b",null,y(r.$t("main.nav.computed.title")),1)]),_:1}),i(e).status.loaded?(s(),o("div",Ws,[(s(!0),o(z,null,H(i(a).properties,b=>(s(),o(z,null,[b.id<0?(s(),o("div",Ys,[k(P,{pos:"bottom",message:"main.nav.computed."+Math.abs(b.id).toString()+"_tooltip"},{default:w(()=>[k(Ee,{property:b},null,8,["property"])]),_:2},1032,["message"])])):g("",!0)],64))),256))])):g("",!0)])])])])}}});const Xs=N(Zs,[["__scopeId","data-v-ed16c605"]]),Js={class:"text-nowrap text-secondary"},ze=O({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(p){const d=J(),e=p,a=C(()=>d.properties[e.propertyId].tags);return(u,v)=>(s(),o("div",Js,[e.value&&e.value.length>0?(s(!0),o(z,{key:0},H(e.value,h=>(s(),o("span",null,[k(Ye,{tag:a.value[h].value,color:a.value[h].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(z,{key:1},[te(" Add Tags... ")],64))]))}}),eo={key:0},to={key:1},so={key:2},oo={key:3},ao={key:0,class:"bi bi-square"},no={key:1,class:"bi bi-check-square"},io={key:5},lo={key:6},ro={key:7},co={key:8},po={key:9},uo={key:10},_o={key:11},mo={key:12},vo={key:13},ho={key:1,class:"text-secondary"},go=O({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(p){const d=p,e=C(()=>{if(d.value==null)return"white";let u=Number(d.value);return isNaN(u)||u>12?"gray":Ze[u].color}),a=C(()=>[V._ahash,V._folders,V._sha1,V.string].indexOf(d.property.type)!==-1?'"'+d.value+'"':d.value);return(u,v)=>p.value!=null?(s(),o(z,{key:0},[d.property.type==i(V)._ahash?(s(),o("div",eo,y(a.value),1)):g("",!0),d.property.type==i(V)._folders?(s(),o("div",to,y(a.value),1)):g("",!0),d.property.type==i(V)._sha1?(s(),o("div",so,y(a.value),1)):g("",!0),d.property.type==i(V).checkbox?(s(),o("div",oo,[a.value?(s(),o("i",ao)):(s(),o("i",no))])):g("",!0),d.property.type==i(V).color?(s(),o("div",{key:4,style:B({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):g("",!0),d.property.type==i(V).date?(s(),o("div",io,y(a.value),1)):g("",!0),d.property.type==i(V).image_link?(s(),o("div",lo)):g("",!0),d.property.type==i(V).multi_tags?(s(),o("div",ro,[k(ze,{"property-id":d.property.id,value:a.value},null,8,["property-id","value"])])):g("",!0),d.property.type==i(V).number?(s(),o("div",co,y(a.value),1)):g("",!0),d.property.type==i(V).path?(s(),o("div",po,y(a.value),1)):g("",!0),d.property.type==i(V).string?(s(),o("div",uo,y(a.value),1)):g("",!0),d.property.type==i(V)._id||d.property.type==i(V)._height||d.property.type==i(V)._width?(s(),o("div",_o,y(a.value),1)):g("",!0),d.property.type==i(V).tag?(s(),o("div",mo,[k(ze,{"property-id":d.property.id,value:a.value},null,8,["property-id","value"])])):g("",!0),d.property.type==i(V).url?(s(),o("div",vo,y(a.value),1)):g("",!0)],64)):(s(),o("span",ho,"..."))}}),yo={class:"d-flex bb ps-1 overflow-hidden"},fo={class:"m-0 p-0 me-2 text-nowrap"},bo={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},$o=O({__name:"FilterPreview",props:{filter:Object},setup(p){const d=J(),e=p,a=C(()=>d.properties[e.filter.propertyId]);return(u,v)=>(s(),o("td",yo,[t("div",fo,y(u.$t("modals.filters.operators."+e.filter.operator)),1),i(ke)(e.filter.operator)?(s(),o("div",bo,[k(go,{property:a.value,value:e.filter.value},null,8,["property","value"])])):g("",!0)]))}});const ko=N($o,[["__scopeId","data-v-42aa8f1e"]]),ye=p=>(Q("data-v-6f1c5c99"),p=p(),W(),p),xo={class:"filter-group"},wo={class:"table table-sm"},Io={class:"align-top p-0 m-0"},So={key:0,class:"m-0 p-0"},Co={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Mo={class:""},Vo=["onClick"],Fo=ye(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),To={key:2,class:"text-secondary"},Eo={key:0,class:"p-0 m-0 ps-2"},zo={key:1,class:"p-0 m-0 ps-2"},Po={class:"border rounded"},Do={class:""},Oo=["onClick"],Lo=ye(()=>t("i",{class:"bi bi-trash"},null,-1)),Go=[Lo],jo={class:"d-flex text-secondary ms-2"},Ro={class:"add-options hover-light"},No=ye(()=>t("i",{class:"bi bi-plus"},null,-1)),Ao=ye(()=>t("i",{class:"bi bi-plus"},null,-1)),Ho=O({__name:"FilterGroupInput",props:{filter:Object,manager:_e,parent:HTMLElement},emits:["delete"],setup(p,{emit:d}){const e=J(),a=p,u=C(()=>a.filter),v=C(()=>u.value.filters),h=C(()=>{let n=255-(u.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function $(n,r){a.manager.updateFilter(n,{propertyId:r})}function m(n){a.manager.deleteFilter(n.id)}function _(n){a.manager.addNewFilterGroup(n)}function l(n,r){a.manager.updateFilterGroup(n,r)}return(n,r)=>{const c=Se("FilterGroupInput",!0);return s(),o("div",xo,[t("table",wo,[(s(!0),o(z,null,H(v.value,(f,b)=>(s(),o("tr",null,[t("td",Io,[b==0?(s(),o("div",So,y(n.$t("modals.filters.where")),1)):b==1?(s(),E(oe,{key:1},{button:w(()=>[t("div",Co,[t("span",Mo,y(n.$t("modals.filters."+u.value.groupOperator)),1)])]),popup:w(({hide:F})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:F},[t("div",{class:"base-btn",onClick:r[0]||(r[0]=D=>l(u.value.id,i(Fe).and))},y(n.$t("modals.filters.and")),1),Fo,t("div",{class:"base-btn",onClick:r[1]||(r[1]=D=>l(u.value.id,i(Fe).or))},y(n.$t("modals.filters.or")),1)],8,Vo)]),_:1})):(s(),o("span",To,y(u.value.groupOperator),1))]),f.propertyId!==void 0?(s(),o("td",Eo,[k(Xe,{"model-value":i(e).properties[f.propertyId],"onUpdate:modelValue":F=>$(f.id,F.id)},null,8,["model-value","onUpdate:modelValue"])])):g("",!0),f.propertyId!==void 0?(s(),o("td",zo,[k(he,{class:"flex-grow-1",manager:p.manager,mode:2,"parent-id":u.value.id,"filter-id":f.id,parent:a.parent},{default:w(()=>[k(ko,{filter:f},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:B(h.value)},[t("div",Po,[k(c,{filter:f,manager:a.manager},null,8,["filter","manager"])])],4)),t("td",Do,[t("span",{class:"base-btn",onClick:F=>m(f)},Go,8,Oo)])]))),256))]),t("div",jo,[k(he,{manager:a.manager,"parent-id":u.value.id},{default:w(()=>[t("div",Ro,[No,te(y(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:r[2]||(r[2]=f=>_(u.value.id))},[Ao,te(y(n.$t("modals.filters.new_group")),1)])])])}}});const Uo=N(Ho,[["__scopeId","data-v-6f1c5c99"]]),Bo=p=>(Q("data-v-e56bd2c5"),p=p(),W(),p),qo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Ko={key:0},Qo=Bo(()=>t("span",{class:"text-primary"},"Text Query",-1)),Wo={key:0,class:"or-separator"},Yo={key:0,class:"or-separator"},Zo={key:0,class:"m-1 p-0"},Xo=O({__name:"GlobalFilterInputDropdown",props:{manager:_e},emits:["update:modelValue"],setup(p,{emit:d}){const e=J(),a=p,u=S(null),v=S(null),h=C(()=>{let m=$(a.manager.state.filter),_={};return m.forEach(l=>_[l.propertyId]=l),Object.values(_)});function $(m){let _=[];for(let l of m.filters)l.isGroup?_.push(...$(l)):_.push(l);return _}return K(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&v.value.hide()}),(m,_)=>(s(),E(oe,{ref_key:"dropdownElem",ref:v},{button:w(()=>[t("div",null,[h.value.length||a.manager.state.query?(s(),o("div",qo,[a.manager.state.query?(s(),o("div",Ko,[Qo,h.value.length?(s(),o("span",Wo,"|")):g("",!0)])):g("",!0),(s(!0),o(z,null,H(h.value,(l,n)=>(s(),o("div",null,[n>0?(s(),o("span",Yo,"|")):g("",!0),l.propertyId==i(De).id?(s(),E(xe,{key:1,type:i(e).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):g("",!0),t("span",null,y(i(e).properties[l.propertyId].name),1)]))),256))])):g("",!0)])]),popup:w(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:u},[Object.keys(i(e).properties).length>0?(s(),o("div",Zo,[k(Uo,{filter:a.manager.state.filter,manager:a.manager,parent:u.value},null,8,["filter","manager","parent"])])):g("",!0)],512)]),_:1},512))}});const Jo=N(Xo,[["__scopeId","data-v-e56bd2c5"]]),ea=p=>(Q("data-v-2996f7ff"),p=p(),W(),p),ta={class:"d-flex flex-row filter-form"},sa={class:"pt-1 pb-1"},oa=ea(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),aa=O({__name:"FilterForm",props:{manager:_e},setup(p){const d=p;return(e,a)=>(s(),o("div",ta,[t("div",sa,y(e.$t("main.menu.filters"))+": ",1),k(Jo,{manager:d.manager},null,8,["manager"]),k(he,{manager:d.manager,class:"p-1"},{default:w(()=>[oa]),_:1},8,["manager"])]))}});const na=N(aa,[["__scopeId","data-v-2996f7ff"]]),ia=p=>(Q("data-v-0fb7173b"),p=p(),W(),p),la=ia(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),ra={class:"p-1"},da=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(p,{emit:d}){const e=p,a=d,u=S(null);return(v,h)=>(s(),E(oe,{ref_key:"dropdownElem",ref:u,"auto-focus":!1},{button:w(()=>[la]),popup:w(()=>[t("div",ra,[k(Pe,{onClick:h[0]||(h[0]=$=>i(Ie)()),onSelect:h[1]||(h[1]=$=>{a("select",$),u.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ge=N(da,[["__scopeId","data-v-0fb7173b"]]),ca={class:"base-hover ps-1 pe-1"},pa={class:"main"},ua=["onClick"],_a=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(p,{emit:d}){const e=p,a=d,u=Object.values(Le);function v(h){a("update:modelValue",h)}return(h,$)=>(s(),E(oe,null,{button:w(()=>[t("div",ca,y(e.modelValue),1)]),popup:w(({hide:m})=>[t("div",pa,[(s(!0),o(z,null,H(i(u),_=>(s(),o("div",{class:"base-hover option",onClick:l=>{v(_),m()}},y(_),9,ua))),256))])]),_:1}))}});const ma=N(_a,[["__scopeId","data-v-ce3e3774"]]),va=p=>(Q("data-v-78b647dc"),p=p(),W(),p),ha=va(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ga={class:""},ya={class:"d-flex ipt"},fa={class:"ms-2",min:"1"},ba=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(p,{emit:d}){const e=p,a=d,u=S(1),v=S(Le.Year);function h(){e.option.stepSize==u.value&&e.option.stepUnit==v.value||a("change",{stepSize:u.value,stepUnit:v.value})}function $(){u.value=e.option.stepSize??1,v.value=e.option.stepUnit}return K(()=>e.option,$),pe($),K(u,()=>{(u.value<1||u.value==null||isNaN(u.value))&&(u.value=1)}),(m,_)=>(s(),E(oe,{onHide:h},{button:w(()=>[ha]),popup:w(({hide:l,focus:n})=>[t("div",ga,[t("div",ya,[t("div",null,[ue(t("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=r=>u.value=r)},null,512),[[ge,u.value]])]),t("div",fa,[k(ma,{modelValue:v.value,"onUpdate:modelValue":_[1]||(_[1]=r=>v.value=r),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const $a=N(ba,[["__scopeId","data-v-78b647dc"]]),ka={class:"d-flex flex-row group-form"},xa={class:"pt-1 pb-1"},wa={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Ia={key:0,class:"bi bi-chevron-right smaller"},Sa=["onClick"],Ca=["onClick"],Ma=["onClick"],Va=["onClick"],Fa=["onClick"],Ta=["onClick"],Ea=["onClick"],za=["onClick"],Pa=["onClick"],Da={key:5,class:"sm-btn"},Oa={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},La=O({__name:"GroupForm",props:{isLoading:Boolean,manager:Je},setup(p){const d=J(),e=p;function a(l){e.manager.setGroupOption(l),e.manager.update(!0)}function u(l){e.manager.delGroupOption(l),e.manager.update(!0)}function v(l,n){e.manager.setGroupOption(l,{direction:n}),e.manager.sortGroups(!0)}function h(l,n){e.manager.setGroupOption(l,{type:n}),e.manager.sortGroups(!0)}function $(l,n){e.manager.setGroupOption(l,n),e.manager.update(!0)}const m=C(()=>e.manager.state.groupBy.map(l=>d.properties[l])),_=C(()=>{const l=[];return e.manager.state.groupBy.forEach(n=>{l.push({option:e.manager.state.options[n],property:d.properties[n]})}),l});return(l,n)=>(s(),o("div",ka,[t("div",xa,y(l.$t("main.menu.groupby"))+": ",1),m.value.length?(s(),o("div",wa,[(s(!0),o(z,null,H(_.value,(r,c)=>(s(),o(z,null,[c>0?(s(),o("i",Ia)):g("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:f=>u(r.property.id),id:"remove-group-button"},y(r.property.name),9,Sa),r.option.type==i(ie).Size?(s(),E(P,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:w(()=>[r.option.direction==i(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:f=>h(r.property.id,i(ie).Property)},null,8,Ca)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:f=>h(r.property.id,i(ie).Property)},null,8,Ma))]),_:2},1024)):(s(),E(P,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:w(()=>[r.property.type==i(V).number?(s(),o(z,{key:0},[r.option.direction==i(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:f=>h(r.property.id,i(ie).Size)},null,8,Va)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:f=>h(r.property.id,i(ie).Size)},null,8,Fa))],64)):(s(),o(z,{key:1},[r.option.direction==i(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:f=>h(r.property.id,i(ie).Size)},null,8,Ta)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:f=>h(r.property.id,i(ie).Size)},null,8,Ea))],64))]),_:2},1024)),r.option.direction==i(se).Ascending?(s(),E(P,{key:3,message:"main.menu.sort.order_asc"},{default:w(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:f=>v(r.property.id,i(se).Descending)},null,8,za)]),_:2},1024)):(s(),E(P,{key:4,message:"main.menu.sort.order_desc"},{default:w(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:f=>v(r.property.id,i(se).Ascending)},null,8,Pa)]),_:2},1024)),r.property.type==i(V).date?(s(),o("div",Da,[k($a,{option:r.option,onChange:f=>$(r.property.id,f)},null,8,["option","onChange"])])):g("",!0)],64))),256)),e.isLoading?(s(),o("i",Oa)):g("",!0)])):g("",!0),k(Ge,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:n[0]||(n[0]=r=>a(r))},null,8,["group-ids"])]))}});const Ga=N(La,[["__scopeId","data-v-dcec9b5d"]]),ja={class:"d-flex flex-row sort-form"},Ra={class:"pt-1 pb-1"},Na={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Aa={key:0,class:"bi bi-chevron-right smaller"},Ha=["onClick"],Ua=["onClick"],Ba=["onClick"],qa=O({__name:"SortForm",props:{manager:et},setup(p){const d=J(),e=p,a=C(()=>e.manager.state.sortBy.map(m=>({propertyId:m,direction:e.manager.state.options[m].direction}))),u=C(()=>a.value.map(m=>m.propertyId));function v(m){e.manager.setSort(m),e.manager.update(!0)}function h(m){e.manager.delSort(m),e.manager.update(!0)}function $(m,_){e.manager.setSort(m,{direction:_}),e.manager.update(!0)}return(m,_)=>(s(),o("div",ja,[t("div",Ra,y(m.$t("main.menu.sort.title"))+": ",1),a.value.length?(s(),o("div",Na,[(s(!0),o(z,null,H(a.value,(l,n)=>(s(),o(z,null,[n>0?(s(),o("i",Aa)):g("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:r=>h(l.propertyId)},y(i(d).properties[l.propertyId].name),9,Ha),l.direction==i(se).Ascending?(s(),E(P,{key:1,message:"main.menu.sort.order_asc"},{default:w(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:r=>$(l.propertyId,i(se).Descending)},null,8,Ua)]),_:2},1024)):(s(),E(P,{key:2,message:"main.menu.sort.order_desc"},{default:w(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:r=>$(l.propertyId,i(se).Ascending)},null,8,Ba)]),_:2},1024))],64))),256))])):g("",!0),k(Ge,{"group-ids":u.value,onSelect:_[0]||(_[0]=l=>v(l))},null,8,["group-ids"])]))}});const Ka=N(qa,[["__scopeId","data-v-4e00ef99"]]),fe=p=>(Q("data-v-c39b4315"),p=p(),W(),p),Qa=fe(()=>t("i",{class:"bi bi-clock-history me-1"},null,-1)),Wa={class:"p-2"},Ya={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},Za={class:"border mb-1 p-1"},Xa={class:"me"},Ja=fe(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),en={key:0},tn={key:1},sn={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},on={class:"d-flex center justify-content-center"},an={key:1,class:"bi bi-arrow-down text-secondary"},nn=fe(()=>t("div",{style:{width:"30px"}},null,-1)),ln={key:3,class:"bi bi-arrow-up text-secondary"},rn={class:"border mb-1 p-1"},dn={class:"me"},cn=fe(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),pn={key:0},un={key:1},_n={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},de=5,mn=O({__name:"HistoryDropdown",emits:[],setup(p,{emit:d}){const e=ee(),a=S(!1),u=C(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),v=C(()=>[...e.data.history.undo].reverse().slice(0,de)),h=C(()=>e.data.history.redo.slice(Math.max(e.data.history.redo.length-de,0)));return K(()=>e.status.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),($,m)=>(s(),E(oe,null,{button:w(()=>[t("div",{class:"d-flex sb flash",style:B([{"font-size":"14px"},u.value])},[Qa,t("div",null,y($.$t("dropdown.history.button")),1)],4)]),popup:w(()=>[t("div",Wa,[i(e).data.history.redo.length>de?(s(),o("div",Ya," + "+y(i(e).data.history.redo.length-de),1)):g("",!0),(s(!0),o(z,null,H(h.value,_=>(s(),o("div",Za,[t("span",Xa,y(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),Ja,_.tags?(s(),o("span",en,y(_.tags)+" "+y($.$t("dropdown.history.tags")),1)):g("",!0),_.values?(s(),o("span",tn,y(_.values)+" "+y($.$t("dropdown.history.values")),1)):g("",!0)]))),256)),t("div",sn,[t("div",on,[v.value.length?(s(),o("div",{key:0,class:"bi bi-arrow-down sb",onClick:m[0]||(m[0]=(..._)=>i(e).undo&&i(e).undo(..._))})):(s(),o("div",an)),nn,h.value.length?(s(),o("div",{key:2,class:"bi bi-arrow-up sb",onClick:m[1]||(m[1]=(..._)=>i(e).redo&&i(e).redo(..._))})):(s(),o("div",ln))])]),(s(!0),o(z,null,H(v.value,_=>(s(),o("div",rn,[t("span",dn,y(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),cn,_.tags?(s(),o("span",pn,y(_.tags)+" "+y($.$t("dropdown.history.tags")),1)):g("",!0),_.values?(s(),o("span",un,y(_.values)+" "+y($.$t("dropdown.history.values")),1)):g("",!0)]))),256)),i(e).data.history.undo.length>de?(s(),o("div",_n," + "+y(i(e).data.history.undo.length-de),1)):g("",!0)])]),_:1}))}});const vn=N(mn,[["__scopeId","data-v-c39b4315"]]),je=p=>(Q("data-v-4b7c78d7"),p=p(),W(),p),hn={key:0,class:"bi bi-arrow-repeat text-warning"},gn={key:1,class:"bi bi-check2-all text-success"},yn={key:2},fn=je(()=>t("span",{class:"bi bi-check2-all text-success small-valid"},null,-1)),bn=je(()=>t("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}},null,-1)),$n=[fn,bn],kn=O({__name:"ToggleReload",emits:[],setup(p,{emit:d}){const e=ee(),a=C(()=>e.getTab().autoReload?2:e.getTabManager().collection.state.isDirty?0:1);function u(){a.value==0?e.getTabManager().collection.update():a.value==1?(e.getTab().autoReload=!0,e.updateTabs()):(e.getTab().autoReload=!1,e.updateTabs())}return(v,h)=>(s(),o("div",{class:"bb font",onClick:u,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(s(),o("span",hn)):g("",!0),a.value==1?(s(),o("span",gn)):g("",!0),a.value==2?(s(),o("span",yn,$n)):g("",!0)]))}});const xn=N(kn,[["__scopeId","data-v-4b7c78d7"]]),Me=p=>(Q("data-v-fcd74ddb"),p=p(),W(),p),wn={class:"d-flex flex-row p-2"},In=Me(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),Sn=["placeholder"],Cn={class:"me-5 d-flex"},Mn=Me(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Vn={class:"ms-5",style:{"font-size":"13px"}},Fn=["checked"],Tn=Me(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),En={class:"ms-4"},zn={class:"d-flex flex-wrap content-container ps-2"},Pn=O({__name:"ContentFilter",props:{tab:tt,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(p,{emit:d}){ee();const e=p,a=S(""),u=C(()=>Object.keys(e.tab.collection.groupManager.selectedImages.value).map(Number)),v=C(()=>u.value.length);function h(l){const n=l.target.checked;e.tab.collection.groupManager.setSha1Mode(n,!0)}function $(){a.value=e.tab.state.filterState.query}function m(){e.tab.collection.filterManager.setQuery(a.value),e.tab.collection.filterManager.update(!0)}function _(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return pe($),K(()=>e.tab.collection.filterManager.state.query,$),(l,n)=>(s(),o(z,null,[t("div",wn,[k(P,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:w(()=>[t("div",{class:A(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[In,ue(t("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=r=>a.value=r),onChange:m},null,40,Sn),[[ge,a.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")],2)]),_:1}),t("div",Cn,[k(P,{message:"main.menu.grid_tooltip"},{default:w(()=>[t("i",{class:A("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=r=>e.tab.state.display="tree")},null,2)]),_:1}),k(P,{message:"main.menu.table_tooltip"},{default:w(()=>[t("i",{id:"toot",class:A("bi bi-table btn-icon me-2"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=r=>e.tab.state.display="grid")},null,2)]),_:1}),k(P,{message:"main.menu.graph_tooltip"},{default:w(()=>[t("i",{id:"toot",class:A("bi bi-bar-chart btn-icon"+(e.tab.state.display=="graph"?"":" text-secondary")),onClick:n[3]||(n[3]=r=>e.tab.state.display="graph")},null,2)]),_:1})]),k(P,{message:"main.menu.image_size_tooltip",click:!1},{default:w(()=>[Mn]),_:1}),t("div",null,[k(st,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":n[4]||(n[4]=r=>e.tab.state.imageSize=r)},null,8,["modelValue"])]),t("div",Vn,[k(P,{message:"main.menu.image_mode_tooltip"},{default:w(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:h},null,40,Fn),Tn]),_:1})]),t("div",En,[k(vn)]),v.value?(s(),E(ot,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":u.value,"onRemove:selected":n[5]||(n[5]=r=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):g("",!0)]),t("div",zn,[k(xn,{class:"me-1"}),k(na,{manager:e.tab.collection.filterManager},null,8,["manager"]),k(Ga,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),k(Ka,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const Dn=N(Pn,[["__scopeId","data-v-fcd74ddb"]]),On={class:""},Ln=["src"],Gn={class:"d-flex flex-row"},jn=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(p,{emit:d}){const e=Ce(),a=p,u=d,v=C(()=>`width: ${a.size}px; height: ${a.size}px;`),h=C(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`),$=C(()=>a.pile.images[0]);return(m,_)=>(s(),o("div",On,[k(at,{image:$.value},{default:w(()=>[t("div",{style:B(v.value),class:"img-container",onClick:_[0]||(_[0]=l=>i(e).showModal(i(le).IMAGE,{image:$.value}))},[t("img",{src:$.value.url,style:B(h.value)},null,12,Ln)],4)]),_:1},8,["image"]),t("div",Gn,[k(P,{message:"main.recommand.accept"},{default:w(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:_[1]||(_[1]=l=>u("accept",$.value))}," ✓ ",4)]),_:1}),k(P,{message:"main.recommand.refuse"},{default:w(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:_[2]||(_[2]=l=>u("refuse",$.value))}," ✕ ",4)]),_:1})])]))}});const Rn=N(jn,[["__scopeId","data-v-e5db64fa"]]),me=p=>(Q("data-v-f92352a8"),p=p(),W(),p),Nn={class:"reco-container"},An={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Hn=me(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),Un=[Hn],Bn=me(()=>t("div",{class:"b-left pe-1"},null,-1)),qn=me(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),Kn=[qn],Qn=me(()=>t("div",{class:"b-left pe-1"},null,-1)),Wn={key:0,class:"bi bi-funnel-fill bb text-primary"},Yn={key:1,class:"bi bi-funnel bb"},Zn=me(()=>t("div",{class:"b-left pe-1"},null,-1)),Xn={class:"text-secondary me-2"},Jn={class:"flex-grow-1"},ei={class:"d-flex flex-row"},ti={key:0,class:"separator"},si={class:"d-flex flex-row"},$e=10,oi=O({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(p,{emit:d}){const e=ee(),a=J(),u=nt(),v=p,h=d,$=S(1),m=ce([]),_=ce([]),l=ce([]),n=ce(new Set),r=S(!0);function c(M){let x=_.indexOf(M);x<0||(_.splice(x,1),F())}async function f(M){const x=[],I=[];l.forEach(T=>{if(T.value!=lt){const L=a.properties[T.propertyId];let G=T.value;L.type==V.multi_tags?(G=M.properties[T.propertyId]??[],G=[...G,T.value]):L.type==V.tag&&(G=[G]),L.mode==we.id?I.push({instanceId:M.id,propertyId:L.id,value:G}):x.push({propertyId:L.id,sha1:M.sha1,value:G})}}),await e.setPropertyValues(I,x),c(M.sha1)}function b(M){n.add(M.sha1),c(M.sha1)}function F(){m.length=0;const M=_.map(x=>({sha1:x,images:a.sha1Index[x]}));D(M,m,$.value,v.imageSize,v.width)}function D(M,x,I,T,L){let G=L,j=[],R=0;for(let X=0;X<M.length&&!(x.length>=I);X++){let ae=M[X];if(n.has(ae.sha1))continue;let ve=T+$e;if(R+ve<G){j.push(ae),R+=ve;continue}if(j.length==0)throw new Error("Images seems to be to big for the line");x.push(j),x.length<I&&(j=[ae],R=ve)}j.length>0&&x.length<I&&x.push(j)}async function U(){if(!v.group)return;console.log("get reco");const M=v.group.images.map(j=>j.id);let x=await u.getSimilarImages({instanceIds:M});if(console.log(x),!x.instances)throw new Error("No instances in ActionResult");let I=[];const T=x.instances.scores??[];if(x.instances.ids)for(let j in x.instances.ids){const R={id:x.instances.ids[j],score:T[j]};I.push(R)}else for(let j in x.instances.sha1s){const R=x.instances.sha1s[j];for(let X of a.sha1Index[R]){const ae={id:X.id,score:T[j]};I.push(ae)}}if(I.sort((j,R)=>R.score-j.score),r.value){const j=e.getTabManager(),R=new Set(j.collection.groupManager.result.root.images.map(X=>X.id));I=I.filter(X=>R.has(X.id))}const L=Array.from(new Set(I.map(j=>a.instances[j.id].sha1)));l.length=0;let G=v.group;for(;G;)l.push(...G.meta.propertyValues),G=G.parent;_.length=0,_.push(...L),n.clear(),F(),h("update")}function Z(){r.value=!r.value}return pe(U),K(()=>v.group,()=>{U(),n.clear()}),K(()=>v.imageSize,F),K(()=>v.width,F),K(r,U),(M,x)=>(s(),o("div",Nn,[t("div",An,[t("div",{class:"text-secondary pe-1",onClick:x[0]||(x[0]=I=>h("close"))},Un),Bn,t("div",{class:"text-secondary pe-1",onClick:x[1]||(x[1]=I=>h("scroll",v.group.id))},Kn),Qn,t("div",{class:"text-secondary pe-1",onClick:Z},[r.value?(s(),o("span",Wn)):(s(),o("span",Yn))]),Zn,k(P,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:w(()=>[t("span",Xn,y(M.$t("main.recommand.title")),1)]),_:1}),t("div",Jn,[t("div",ei,[(s(!0),o(z,null,H(l,(I,T)=>(s(),o(z,null,[k(it,{class:"",value:I},null,8,["value"]),T<l.length-1?(s(),o("div",ti)):g("",!0)],64))),256))])])]),t("div",{style:B("margin-left:"+$e+"px;")},[(s(!0),o(z,null,H(m,I=>(s(),o("div",null,[t("div",si,[(s(!0),o(z,null,H(I,T=>(s(),E(Rn,{pile:T,size:v.imageSize,onAccept:f,onRefuse:b,style:B("margin-right:"+$e+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const ai=N(oi,[["__scopeId","data-v-f92352a8"]]);const ni={style:{display:"flex"}},ii={class:"info"},li=t("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1),ri={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:V},height:String},setup(p){const d=p,e=S(0),a=S(!1),u={};Object.keys(d.chartData.series).forEach(n=>{u[n]=!1});const v=S({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:d.chartData.dataType===V.date?"datetime":"numeric",categories:d.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:n,seriesIndex:r,dataPointIndex:c,w:f}){const b=d.chartData.series[r].data[c];let F='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';b.images.forEach((U,Z)=>{Z<10&&(F+=`<div style="width: 75px; height: 75px;"><img src="${U}" style="width: 100%; height: 100%;" /></div>`)}),F+="</div>";let D=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${d.chartData.series[r].name} — </b> ${b.y} Images</span>`;return D+=`<div>${F}</div>`,D}}}),h=()=>{v.value.chart.stacked=!v.value.chart.stacked,a.value=!a.value,e.value+=1},$=()=>{let n;v.value.chart.type==="area"?n={chart:{...v.value.chart,type:"bar"}}:n={chart:{...v.value.chart,type:"area"}},v.value={...v.value,...n},e.value+=1},m=(n,r,c)=>{const b=d.chartData.series[r];let F=Math.max(...b.data.map(D=>D.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(D=>D.remove()),u[r]){u[r]=!1;return}b.data.forEach((D,U)=>{const M=Math.floor(D.y/F*17),x=D.images.slice(0,M),I=`circle[index="${r}"][j="${U}"]`,T=document.querySelector(I),L=parseFloat(T.getAttribute("cx"));x.forEach((G,j)=>{const R=document.createElement("img");R.src=G,R.width=40,R.height=40,R.style.position="absolute";let X=L+40/1.5,ae=65+j*40;R.style.left=`${X}px`,R.style.bottom=`${ae}px`,R.classList.add("apexcharts-custom-image"),R.addEventListener("mouseover",ve=>_(X,ae,G)),R.addEventListener("mouseout",l),n.el.appendChild(R)})}),Object.keys(u).forEach(D=>u[D]=!1),u[r]=!0};function _(n,r,c){const f=document.getElementById("zoomed-image");f.style.left=`${n+120*1.5}px`,f.src=c,f.style.bottom=`${r}px`,f.style.display="block"}function l(){const n=document.getElementById("zoomed-image");n.style.display="none"}return console.log("test"),(n,r)=>{const c=Se("apexchart");return s(),o(z,null,[t("div",ni,[t("button",{class:"mt-2",onClick:$},y(v.value.chart.type==="area"?n.$t("main.graph-view.histo"):n.$t("main.graph-view.curve")),1),d.chartData.series.length>1?(s(),o("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:h},y(a.value?n.$t("main.graph-view.over"):n.$t("main.graph-view.stack")),1)):g("",!0)]),(s(),E(c,{style:{position:"relative"},key:e.value,height:d.height,type:v.value.chart.type,options:v.value,series:d.chartData.series,onLegendClick:m},null,8,["height","type","options","series"])),t("i",ii,y(n.$t("main.graph-view.info")),1),li],64)}}},di={key:1},ci=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(p,{emit:d}){const e=J(),a=p,u=S(""),v=S($());function h(){const m=new Set;let _=a.collection.groupManager.getGroupIterator();for(;_;){const l=_.group;if(console.log(l.id),l.id==="root"){_=_.nextGroup();continue}for(let n of l.children)m.add(n.meta.propertyValues[0].value);l.children.forEach(()=>_=_.nextGroup()),_=_.nextGroup()}return m}function $(){const m={};let _,l=a.collection.groupManager.state.groupBy;if(l.length===0){u.value="Choose at least one date or numeric value to group the images by";return}const n=e.properties[l[0]],r=n.type;if(l.length>2){u.value="Only max two levels of grouping are supported";return}else l.length===1?m[n.name]={name:n.name,data:[]}:_=Array.from(h());if(r!==V.number&&r!==V.date){u.value="First level of grouping needs to be a date or a numeric property";return}let c=a.collection.groupManager.getGroupIterator();const f=[];for(;c;){const b=c.group;if(b.id==="root"){c=c.nextGroup();continue}let F=b.meta.propertyValues[0];const D=r===V.date?F.value.getTime():F.value;if(f.push(D),n.name in m)m[n.name].data.push({x:D,y:b.images.length,images:b.images.slice(0,20).map(U=>U.url)});else{const U=b.children.map(M=>M.meta.propertyValues[0].value),Z=_.filter(M=>!U.includes(M));for(let M of b.children){const x=M.meta.propertyValues[0].value;if(m[x]===void 0){let I=x;x in e.tags&&(I=e.tags[x].value),m[x]={data:[],name:I}}m[M.meta.propertyValues[0].value].data.push({x:D,y:M.images.length,images:M.images.slice(0,20).map(I=>I.url)})}for(let M of Z){if(m[M]===void 0){let x=M;M in e.tags&&(x=e.tags[M].value),m[M]={data:[],name:x}}m[M].data.push({x:D,y:0,images:[]})}b.children.forEach(()=>c=c.nextGroup())}c=c.nextGroup()}return u.value="",{series:Object.values(m),xValues:f,dataType:r}}return a.collection.groupManager.onChange.addListener(()=>v.value=$()),(m,_)=>(s(),o("div",{class:"",style:B({height:a.height+"px"})},[u.value===""?(s(),E(ri,{key:0,chartData:v.value,height:a.height-50+"px"},null,8,["chartData","height"])):(s(),o("span",di,y(u.value),1))],4))}}),pi={key:0,class:"m-0 p-0"},ui={key:0,style:{"margin-left":"10px"}},_i=O({__name:"MainView",props:{tabId:Number,height:Number},setup(p){const d=ee(),e=d.getTabManager(),a=p,u=S({}),v=S(null),h=S(null),$=S(null);S([]);const m=S(0),_=S(0),l=ce({groups:!1}),n=C(()=>e.getVisibleProperties());function r(){v.value&&h.value?m.value=a.height-v.value.clientHeight-h.value.clientHeight-5:v.value?m.value=a.height-v.value.clientHeight-5:m.value=0}e.collection.groupManager.onChange.addListener(()=>{$.value&&e.state.display=="tree"&&$.value.computeLines()});function c(b){u.value=e.collection.groupManager.result.index[b],ne(()=>r())}function f(){u.value={},ne(()=>r())}return pe(()=>{_.value=v.value.clientWidth,window.addEventListener("resize",()=>{ne(()=>{var b;_.value=((b=v.value)==null?void 0:b.clientWidth)??_.value})})}),K(e.state,b=>{d.updateTabs()},{deep:!0}),K(()=>e.state.imageSize,()=>ne(r)),K(()=>a.height,async()=>{await ne(r)}),(b,F)=>(s(),o(z,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:v},[k(Dn,{tab:i(e),"compute-status":l},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:h,class:"m-0 p-0"},[u.value.id?(s(),o("div",pi,[k(ai,{group:u.value,"image-size":i(e).state.imageSize,width:_.value,height:50,onClose:f,onScroll:$.value.scrollTo,onUpdate:F[0]||(F[0]=D=>ne(()=>r()))},null,8,["group","image-size","width","onScroll"])])):g("",!0)],512),_.value>0&&m.value>0?(s(),o("div",ui,[i(e).state.display=="tree"?(s(),E(rt,{key:0,"group-manager":i(e).collection.groupManager,"image-size":i(e).state.imageSize,height:m.value-0,properties:n.value,"hide-if-modal":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:$,width:_.value-25,onRecommend:c},null,8,["group-manager","image-size","height","properties","selected-images","width"])):g("",!0),i(e).state.display=="grid"?(s(),o("div",{key:1,style:B({width:_.value-12+"px"}),class:"p-0 m-0 grid-container"},[k(dt,{manager:i(e).collection.groupManager,height:m.value-15,width:_.value-40,"selected-properties":n.value,class:"p-0 m-0","show-images":!0,"selected-images":i(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:$,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):g("",!0),i(e).state.display=="graph"?(s(),E(ci,{key:2,collection:i(e).collection,height:m.value-15},null,8,["collection","height"])):g("",!0)])):g("",!0)],64))}});const mi=N(_i,[["__scopeId","data-v-d615a6ea"]]),vi={class:"d-flex d-row",style:{cursor:"pointer"}},hi=["onMouseenter","onMouseleave"],gi=["onClick"],yi=["onClick"],fi=["onClick"],bi=["onSubmit"],$i=["onKeydown","onUpdate:modelValue"],ki=t("span",{class:"bi bi-plus"},null,-1),xi=[ki],wi={class:"lang"},Ii=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),Si=["value"],Ci=O({__name:"TabNav",props:{reRender:Function},setup(p){const d=ee(),e=S(-1),a=S(""),u=S(null),v=p;function h(c){d.data.selectedTabId==c||m(),d.selectTab(c)}function $(c){e.value=c,a.value=d.data.tabs[c].name,ne(()=>u.value[0].focus())}function m(){e.value=-1,a.value=""}function _(c){d.addTab("New Tab")}async function l(c){confirm("Are you sure to delete Tab: "+c.name)&&await d.removeTab(c.id)}const n=ce({});S(-1);const r=["fr","en"];return(c,f)=>(s(),o("nav",null,[t("div",vi,[(s(!0),o(z,null,H(i(d).data.tabs,b=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:F=>n[b.id]=!0,onMouseleave:F=>n[b.id]=!1},[e.value!=b.id?(s(),o(z,{key:0},[k(P,{message:"main.menu.rename_tab_tooltip"},{default:w(()=>[t("i",{onClick:F=>$(b.id),class:A(["bi bi-pencil me-1 tab-icon hover-light",n[b.id]&&i(d).data.selectedTabId==b.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,gi)]),_:2},1024),t("div",{class:A(["tab-button",b.id==i(d).data.selectedTabId?" active":""]),onClick:F=>h(b.id)},[t("span",null,y(b.name),1)],10,yi),k(P,{message:"main.menu.delete_tab_tooltip"},{default:w(()=>[t("i",{onClick:F=>l(b),class:A(["btn-icon bi bi-x tab-icon hover-light",n[b.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,fi)]),_:2},1024)],64)):(s(),o("div",{key:1,class:A(["tab-button",b.id==i(d).data.selectedTabId?" active":""])},[t("form",{onSubmit:Oe(m,["stop","prevent"])},[ue(t("input",{onFocusout:m,onKeydown:ct(m,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":F=>b.name=F,ref_for:!0,ref_key:"inputElem",ref:u},null,40,$i),[[ge,b.name]])],40,bi)],2))],40,hi))),256)),k(P,{message:"main.menu.add_tab_tooltip"},{default:w(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_,id:"add-tab-button"},xi)]),_:1}),t("div",wi,[Ii,ue(t("select",{"onUpdate:modelValue":f[0]||(f[0]=b=>c.$i18n.locale=b),onChange:f[1]||(f[1]=b=>v.reRender())},[(s(),o(z,null,H(r,(b,F)=>t("option",{key:`Lang${F}`,value:b},y(b.toUpperCase()),9,Si)),64))],544),[[pt,c.$i18n.locale]])])])]))}});const Re=p=>(Q("data-v-494b9b1a"),p=p(),W(),p),Mi={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Vi={key:0},Fi={key:1,class:"w-100"},Ti={key:0,class:"custom-hr"},Ei={key:2,class:"loading"},zi={class:"text-center"},Pi={key:3,class:"loading"},Di=Re(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Oi=Re(()=>t("span",{class:"ms-1"},"Loading...",-1)),Li=[Di,Oi],Gi=O({__name:"PanopticView",setup(p){const d=ee(),e=Ce(),a=S(null),u=S(null),v=S(window.innerHeight),h=S(!1),$=C(()=>{var c;return v.value-(((c=u.value)==null?void 0:c.clientHeight)??0)}),m=C(()=>{var c;return(c=a.value)==null?void 0:c.filteredImages.map(f=>f.id)});pe(async()=>{e.isProjectLoaded||Te.push("/"),ne(()=>{window.addEventListener("resize",_),_()}),window.addEventListener("keydown",c=>{c.key=="Control"&&(q.ctrl=!0),c.key=="Alt"&&(q.alt=!0),c.key=="Shift"&&(q.shift=!0),c.key=="ArrowLeft"&&(q.left=!0),c.key=="ArrowRight"&&(q.right=!0,console.log("keeeyy")),c.key=="Z"&&q.ctrl&&d.redo(),c.key=="z"&&q.ctrl&&d.undo()}),window.addEventListener("keyup",c=>{c.key=="Control"&&(q.ctrl=!1),c.key=="Alt"&&(q.alt=!1),c.key=="Shift"&&(q.shift=!1),c.key=="ArrowLeft"&&(q.left=!1),c.key=="ArrowRight"&&(q.right=!1)}),window.addEventListener("mousemove",c=>{q.ctrl=c.ctrlKey,q.alt=c.altKey,q.shift=c.shiftKey})}),ut(()=>{window.removeEventListener("resize",_)});function _(){v.value=window.innerHeight,h.value=!0}function l(){e.showModal(le.EXPORT,m)}function n(){d.rerender()}function r(){Te.push("/")}return(c,f)=>(s(),o(z,null,[k(_t,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:i(d).status.renderNb},[t("div",Mi,[i(d).status.loaded?(s(),o("div",Vi,[k(Xs,{onExport:f[0]||(f[0]=b=>l())})])):g("",!0),i(d).status.loaded?(s(),o("div",Fi,[t("div",{class:"ms-3",ref_key:"navElem",ref:u},[k(Ci,{"re-render":n})],512),h.value?(s(),o("div",Ti)):g("",!0),i(d).status.loaded?(s(),E(mi,{key:1,"tab-id":i(d).data.selectedTabId,height:$.value,ref_key:"mainViewRef",ref:a},null,8,["tab-id","height"])):g("",!0)])):i(e).isProjectLoaded?(s(),o("div",Pi,Li)):(s(),o("div",Ei,[t("div",zi,[t("div",null,y(c.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:r,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Ni=N(Gi,[["__scopeId","data-v-494b9b1a"]]);export{Ni as default};
