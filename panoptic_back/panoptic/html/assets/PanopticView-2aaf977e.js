import{d as O,S as Ge,u as de,V as pe,A as K,r as M,c as T,W as q,o as t,a as n,b as e,F as E,q as _,X as me,t as x,h as f,k as C,w as fe,v as _e,e as d,Y as Te,M as oe,l as b,x as z,Z as $e,$ as ue,n as N,Q as W,a0 as Ce,i as ee,s as j,D as te,a1 as je,_ as B,a2 as He,a3 as Ie,a4 as Ee,f as X,a5 as he,a6 as Me,m as J,H as Ne,a7 as ce,a8 as Pe,j as Z,g as we,a9 as We,aa as qe,ab as Fe,ac as Ke,ad as Qe,K as Ye,ae as Xe,af as Ze,L as Je,R as et,O as tt,ag as st,ah as ot,ai as Oe,aj as Le,ak as at,al as ne,am as se,an as nt,ao as lt,ap as it,aq as rt,ar as ut,as as dt,at as ve,au as Ve,av as pt,aw as ct,ax as mt,ay as vt,az as gt,aA as ft,aB as _t,p as ze,B as U}from"./index-4cee3dd0.js";import{_ as yt}from"./Tutorial-291c94d4.js";const ge={},bt={class:"d-flex flex-row"},ht={key:2,class:"d-flex",style:{width:"150px"}},kt={class:"flex-grow-1"},xt={key:1,style:{"padding-top":"1px"}},$t={style:{width:"20px","margin-top":"2px"},class:"text-center"},wt={key:4,class:"text-center",style:{width:"20px","margin-top":"2px"}},St={key:0},Ct={key:0,class:"ms-3 pt-1"},It={class:"options hover-light"},Vt={class:"p-1",style:{"min-width":"100px"}},Mt={key:1,class:"custom-hr mt-1 mb-1"},Ft=["onClick"],zt={key:1},Gt=O({__name:"PropertyOptions",props:{tab:{},property:{},open:{type:Boolean}},setup(h){const{t:p}=Ge({useScope:"global"}),s=de();pe();const a=K(),o=h,m=M(!1),c=M(!1),y=M(""),v=M(!1),r=T(()=>o.tab.state.visibleProperties[o.property.id]==!0),l=T(()=>o.tab.collection.filterManager.state.filter.filters.some(S=>!S.isGroup&&S.propertyId==o.property.id)),i=T(()=>o.tab.collection.groupManager.state.groupBy.includes(o.property.id)),u=T(()=>o.tab.collection.sortManager.state.sortBy.includes(o.property.id)),g=T(()=>{if(l.value)return o.tab.collection.filterManager.state.filter.filters.find(S=>!S.isGroup&&S.propertyId==o.property.id).id}),w=()=>o.tab.collection.filterManager,D=T(()=>o.tab.getSha1Mode());function A(){r.value?o.tab.setVisibleProperty(o.property.id,!1):o.tab.setVisibleProperty(o.property.id,!0)}function I(){o.open&&(m.value?m.value=!1:(m.value=!0,y.value=o.property.name),c.value=!1)}function k(){o.property.type!=W.tag&&o.property.type!=W.multi_tags||(c.value?c.value=!1:c.value=!0,m.value=!1)}function G(){u.value?o.tab.collection.sortManager.delSort(o.property.id):o.tab.collection.sortManager.setSort(o.property.id),o.tab.collection.sortManager.update(!0)}function L(){i.value?o.tab.collection.groupManager.delGroupOption(o.property.id):o.tab.collection.groupManager.setGroupOption(o.property.id),o.tab.collection.groupManager.update(!0)}function P(){confirm(p("common.properties.delete")+": "+o.property.name+" ?   "+o.property.id)&&a.deleteProperty(o.property.id)}async function Q(){y.value!=""&&(await a.updateProperty(o.property.id,y.value),I())}function R(){const S=w();l.value?(S.deleteFilter(g.value),ge.filter.hide()):(S.addNewFilter(o.property.id),ge.filter.show())}function F(S){a.updateProperty(o.property.id,o.property.name,S)}return q(()=>o.property,()=>{m.value=!1}),(S,$)=>(t(),n("div",{class:N(v.value?"hover-light":"")},[e("div",bt,[o.open?(t(),n(E,{key:0},[m.value?f("",!0):(t(),n("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:I},[_(me,{type:o.property.type,class:"me-2 btn-icon",onMouseenter:$[0]||($[0]=V=>v.value=!0),onMouseleave:$[1]||($[1]=V=>v.value=!1)},null,8,["type"]),e("span",null,x(o.property.name),1)]))],64)):(t(),C(me,{key:1,type:o.property.type,class:"me-2",style:{position:"relative",top:"2px"}},null,8,["type"])),m.value&&o.open?(t(),n("div",ht,[e("div",null,[e("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:I,onMouseenter:$[2]||($[2]=V=>v.value=!0),onMouseleave:$[3]||($[3]=V=>v.value=!1)},null,32)]),e("div",kt,[o.property.id>=0?fe((t(),n("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":$[4]||($[4]=V=>y.value=V),onChange:Q},null,544)),[[_e,y.value]]):(t(),n("span",xt,[_(me,{type:o.property.type,class:"me-2 btn-icon"},null,8,["type"]),e("span",null,x(o.property.name),1)]))])])):f("",!0),o.open?(t(),n(E,{key:3},[d(Te)(o.property.type)?(t(),n("div",{key:0,style:{width:"20px","margin-top":"2px",cursor:"pointer"},class:"text-center",onClick:$[5]||($[5]=V=>d(s).showModal(d(oe).TAG,{propId:o.property.id}))},[_(z,{click:!1,message:"main.nav.properties.open_tags"},{default:b(()=>$[8]||($[8]=[e("i",{class:"bi bi-arrows-fullscreen"},null,-1)])),_:1})])):f("",!0),e("div",$t,[o.property.mode==d($e).id?(t(),C(z,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:b(()=>$[9]||($[9]=[e("i",{class:"bi bi-link-45deg"},null,-1)])),_:1})):f("",!0)])],64)):f("",!0),e("div",{style:{width:"20px","margin-top":"2px"},onClick:A,class:"btn-icon text-center"},[D.value&&o.property.mode==d($e).id?(t(),C(z,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:b(()=>[e("span",{class:"bi bi-eye-slash",onClick:$[6]||($[6]=ue(()=>{},["stop"]))})]),_:1})):(t(),C(z,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:b(()=>[e("span",{class:N("bi bi-eye text-"+(r.value?"primary":"secondary"))},null,2)]),_:1}))]),o.open?(t(),n("div",wt,[o.property.type==d(W).tag||o.property.type==d(W).multi_tags?(t(),n("div",{key:0,onClick:k,style:{cursor:"pointer"}},[c.value?(t(),C(z,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:b(()=>$[10]||($[10]=[e("i",{class:"bi bi-chevron-down"},null,-1)])),_:1})):(t(),C(z,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:b(()=>$[11]||($[11]=[e("i",{class:"bi bi-chevron-right"},null,-1)])),_:1}))])):f("",!0)])):f("",!0)]),o.open?(t(),n("div",St,[m.value?(t(),n("div",Ct,[S.property.id!=d(Ce).folders?(t(),n("div",{key:0,class:N(["options hover-light",l.value?" text-primary":""]),onClick:R},[e("div",null,[$[12]||($[12]=e("i",{class:"bi bi-funnel-fill me-2"},null,-1)),ee(x(S.$t("main.menu.filters")),1)])],2)):f("",!0),e("div",{class:N(["options hover-light",u.value?" text-primary":""]),onClick:G},[$[13]||($[13]=e("i",{class:"bi bi-filter me-2"},null,-1)),ee(x(S.$t("main.menu.sort.title")),1)],2),e("div",{class:N(["options hover-light",i.value?" text-primary":""]),onClick:L},[$[14]||($[14]=e("i",{class:"bi bi-collection me-2"},null,-1)),ee(x(S.$t("main.menu.groupby")),1)],2),o.property.id>=0?(t(),n("div",{key:1,class:"options hover-light",onClick:P},[$[15]||($[15]=e("i",{class:"bi bi-trash me-2"},null,-1)),ee(x(S.$t("main.nav.properties.delete_property")),1)])):f("",!0),o.property.id>=0&&d(a).propertyGroupsList.length?(t(),C(te,{key:2,teleport:!0},{button:b(()=>[e("div",It,[$[16]||($[16]=e("i",{class:"bi bi-folder me-1"},null,-1)),ee(" "+x(S.$t("main.nav.properties.set_group")),1)])]),popup:b(()=>[e("div",Vt,[o.property.propertyGroupId&&d(a).propertyGroups[o.property.propertyGroupId]?(t(),n("div",{key:0,class:"bb",onClick:$[7]||($[7]=V=>F(null))},"None")):f("",!0),o.property.propertyGroupId&&d(a).propertyGroups[o.property.propertyGroupId]?(t(),n("div",Mt)):f("",!0),(t(!0),n(E,null,j(d(a).propertyGroupsList,V=>(t(),n("div",{class:"bb",onClick:H=>F(V.id)},x(V.name),9,Ft))),256))])]),_:1})):f("",!0)])):c.value?(t(),n("div",zt,[_(je,{property:o.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):f("",!0)])):f("",!0)],2))}});const Se=B(Gt,[["__scopeId","data-v-ac2bed1d"]]),Tt={class:"text-nowrap"},Et=["onClick"],Pt=["onClick"],Ot=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(h){const p=K(),s=h;function a(){p.reImportFolder(s.folder.id)}function o(){confirm(He.global.t("main.nav.folders.del_alert"))&&p.deleteFolder(s.folder.id)}return(m,c)=>(t(),C(te,{teleport:!0},{button:b(()=>c[0]||(c[0]=[e("i",{class:"bi bi-three-dots-vertical base-hover"},null,-1)])),popup:b(({hide:y})=>[e("div",Tt,[e("div",{class:"p-2 bb",onClick:v=>{a(),y()}},c[1]||(c[1]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),ee("Re import")]),8,Et),c[3]||(c[3]=e("div",{class:"custom-hr"},null,-1)),e("div",{class:"bb p-2",onClick:v=>{o(),y()}},[c[2]||(c[2]=e("i",{class:"bi bi-trash me-1"},null,-1)),ee(x(m.$t("main.nav.folders.del")),1)],8,Pt)])]),_:1}))}}),Lt=["onMouseenter"],Dt=["onClick"],Rt={class:"text-secondary"},At=["onClick"],Bt=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:Ie,root:{type:Boolean,default:!0}},setup(h){const p=K(),s=h,a=M(null),o=T(()=>{let l={};const i=new Set(s.filterManager.state.folders);return s.folders.map(u=>u.id).forEach(u=>{i.has(u)&&(l[u]=!0)}),l}),m=T(()=>{let l={};return s.folders.map(i=>i.id).forEach(i=>{s.visibleFolders[i]&&(l[i]=!0)}),l}),c=T(()=>{let l={};return s.folders.forEach(i=>{let u=[];o.value[i.id]&&u.push("selected"),l[i.id]=u.join(" ")}),l});function y(l){let i=s.visibleFolders;i[l]?delete i[l]:i[l]=!0}function v(l){let i=new Set(s.filterManager.state.folders);const u=i.has(l),g=p.folders[l].parent!=null&&i.has(p.folders[l].parent);u&&!g?(i.delete(l),he(l).forEach(w=>i.delete(w.id))):(r(l,i),i.add(l),he(l).forEach(w=>i.add(w.id)),Me(p.folders[l]).forEach(w=>i.delete(w.id))),s.filterManager.setFolders(Array.from(i)),s.filterManager.update(!0)}function r(l,i){const u=Me(p.folders[l]);let g;for(let w of u)if(i.has(w.id))g=w;else break;g!=null&&he(g.id).forEach(w=>i.delete(w.id))}return(l,i)=>{const u=Ee("FolderList2",!0);return t(),n("ul",{class:N(s.root?"tree":""),style:X(s.root?"padding-left:0px;":"")},[(t(!0),n(E,null,j(h.folders,g=>(t(),n("li",{style:X(s.root?"padding-left:0px;":""),class:"no-break"},[e("div",{style:{display:"inline"},onMouseenter:w=>a.value=g.id,onMouseleave:i[1]||(i[1]=w=>a.value=null)},[e("summary",{class:N(c.value[g.id]),onClick:w=>v(g.id)},[e("span",{class:N(a.value===g.id?"visible-option":"invisible-option"),onClick:i[0]||(i[0]=ue(()=>{},["stop"]))},[_(Ot,{folder:g},null,8,["folder"])],2),ee(" "+x(g.name)+" ",1),e("span",Rt,x(d(p).folders[g.id].count),1)],10,Dt)],40,Lt),g.children&&g.children.length>0?(t(),n("i",{key:0,onClick:w=>y(g.id),class:N("bi bi-chevron-"+(m.value[g.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,At)):f("",!0),g.children&&g.children.length>0&&m.value[g.id]?(t(),C(u,{key:1,folders:g.children,root:!1,"visible-folders":s.visibleFolders,"filter-manager":s.filterManager},null,8,["folders","visible-folders","filter-manager"])):f("",!0)],4))),256))],6)}}});const Ut=B(Bt,[["__scopeId","data-v-0bc5c5cb"]]),jt={class:"text-center"},Ht={class:"w-100 text-center",style:{"font-size":"10px"}},Nt={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Wt=O({__name:"TaskStatus",props:{task:{}},setup(h){const p=h,s=T(()=>p.task.total-p.task.remain-p.task.computing),a=T(()=>p.task.total);return(o,m)=>(t(),n("div",jt,[ee(x(p.task.name)+" ",1),e("div",Ht,x(s.value)+" / "+x(a.value)+" "+x(o.$t("main.nav.tasks.done")),1),a.value>0?(t(),n("div",Nt,[e("div",{class:"progress-bar",style:X(`width: ${s.value/a.value*100}%`)},null,4)])):f("",!0)]))}}),qt={class:"prop-container"},Kt={key:0},Qt={key:1},Yt={key:0,class:"ms-2 text-capitalize overflow-hidden"},Xt={key:1,class:"ms-2"},Zt={key:0,class:"ps-1 pe-1 pt-1"},Jt={class:"property-item"},es=O({__name:"PropertyGroup",props:{tab:{},group:{},menuOpen:{type:Boolean}},setup(h){const p=K(),s=h,a=M(!0),o=M(!1),m=M(""),c=T(()=>p.propertyList.filter(i=>i.propertyGroupId==s.group.id));function y(){a.value=!a.value}function v(i){p.updatePropertyGroup(s.group.id,m.value)}function r(){m.value=s.group.name}function l(){p.deletePropertyGroup(s.group.id)}return J(r),q(s,r),(i,u)=>(t(),n("div",qt,[e("div",{class:"d-flex group-container",onClick:y},[a.value?(t(),n("div",Kt,u[3]||(u[3]=[e("i",{class:"bi bi-caret-down-fill"},null,-1)]))):f("",!0),a.value?f("",!0):(t(),n("div",Qt,u[4]||(u[4]=[e("i",{class:"bi bi-caret-right-fill"},null,-1)]))),s.menuOpen?(t(),n(E,{key:2},[o.value?f("",!0):(t(),n("div",Yt,x(s.group.name),1)),o.value?(t(),n("div",Xt,[_(Ne,{"auto-focus":!0,modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=g=>m.value=g),style:{"background-color":"white"},"min-height":25,width:135,onSubmit:v,onCancel:r,onBlur:u[1]||(u[1]=g=>o.value=!1)},null,8,["modelValue"])])):f("",!0),u[7]||(u[7]=e("div",{class:"flex-grow-1"},null,-1)),o.value?f("",!0):(t(),n("div",{key:2,class:"bb me-1",onClick:u[2]||(u[2]=ue(g=>o.value=!0,["stop"]))},u[5]||(u[5]=[e("i",{class:"bi bi-pencil"},null,-1)]))),e("div",{class:"bb me-1",onClick:ue(l,["stop"])},u[6]||(u[6]=[e("i",{class:"bi bi-x"},null,-1)]))],64)):f("",!0)]),a.value&&c.value.length?(t(),n("div",Zt,[(t(!0),n(E,null,j(c.value,g=>(t(),n("div",Jt,[_(Se,{tab:s.tab,property:g,open:s.menuOpen},null,8,["tab","property","open"])]))),256))])):f("",!0)]))}});const ts=B(es,[["__scopeId","data-v-8dd4d762"]]),De=O({__name:"TabContainer",props:{id:{}},setup(h){const p=ce(),s=h;let a;const o=M(!1);function m(){a=p.getTab(s.id),o.value=!0}return J(m),q(()=>s.id,async()=>{o.value=!1,await Z(),m()}),(c,y)=>o.value&&d(p).loaded?Pe(c.$slots,"default",{key:0,tab:d(a)}):f("",!0)}}),ss={class:""},os={class:"m-0",style:{padding:"4px 0px 4px 8px"}},as={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},ns={key:0,class:"bi bi-chevron-left"},ls={key:1,class:"bi bi-chevron-right"},is={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},rs={class:"d-flex align-items-center"},us={style:{"max-height":"300px",overflow:"auto"}},ds={key:0,id:"import"},ps={class:"pt-1 pb-2"},cs={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},ms={key:0,class:"ps-2 pe-2"},vs={class:"p-1"},gs={key:0,class:"custom-hr"},fs={class:"p-1 mt-0"},_s={key:0,class:"d-flex p-1"},ys={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},bs={key:1,class:"bb me-1"},hs={class:"bb me-2"},ks={key:1,class:"mt-2"},xs={style:{"padding-left":"0px"}},$s={class:"ps-1 pe-1"},ws={key:0,class:"property-item"},Ss={class:"p-2 mt-0"},Cs={key:1,class:"mt-2"},Is={key:0,class:"property-item"},Vs=200,Ms=55,Fs=O({__name:"Menu",emits:["export","toggle"],setup(h,{emit:p}){const s=pe(),a=K(),o=de(),m=ce(),c=p,y=M(!1),v=M(!1),r=M(!0),l=T(()=>r.value?Vs:Ms),i=T(()=>a.propertyList.filter(I=>I.id>=0&&(I.propertyGroupId===void 0||!a.propertyGroups[I.propertyGroupId]))),u=async I=>{o.showModal(oe.IMPORT)},g=T(()=>s.backendStatus.tasks.filter(I=>!I.done));function w(){o.showModal(oe.FOLDERSELECTION,{callback:D,mode:"images"})}function D(I){I&&a.addFolder(I)}function A(){r.value=!r.value,c("toggle")}return q(()=>s.status.import.to_import,()=>y.value=!0),(I,k)=>(t(),C(De,{id:d(m).mainTab},{default:b(({tab:G})=>{var L;return[e("div",{class:"menu overflow-scroll",style:X({width:l.value+"px"})},[e("div",ss,[e("div",null,[e("div",os,[e("div",as,[r.value?(t(),n(E,{key:0},[e("div",{class:"flex-grow-1 text-capitalize overflow-hidden",onClick:k[0]||(k[0]=()=>{})},x((L=d(o).data.status.selectedProject)==null?void 0:L.name),1),_(z,{message:"main.menu.close_project"},{default:b(()=>[e("div",{class:"base-hover p-1",onClick:k[1]||(k[1]=P=>d(o).closeProject())},k[7]||(k[7]=[e("i",{class:"bi bi-arrow-up-left-square red-hover"},null,-1)]))]),_:1}),e("div",{class:"base-hover p-1",onClick:k[2]||(k[2]=P=>d(o).showModal(d(oe).SETTINGS))},k[8]||(k[8]=[e("i",{class:"bi bi-gear"},null,-1)]))],64)):f("",!0),e("div",{class:N(["base-hover p-1",r.value?"":"flex-grow-1 text-center"]),style:{"margin-right":"6px"},onClick:A},[r.value?(t(),n("i",ns)):(t(),n("i",ls))],2)])]),r.value?(t(),n(E,{key:0},[k[10]||(k[10]=e("div",{class:"custom-hr"},null,-1)),e("div",is,[e("div",rs,[e("div",null,[e("b",null,x(I.$t("main.nav.folders.title")),1)]),e("div",{id:"add_folder",class:"ms-auto plus",onClick:k[3]||(k[3]=P=>{w(),d(we)()})},[_(z,{message:"main.nav.folders.add"},{default:b(()=>k[9]||(k[9]=[e("i",{class:"bi bi-plus"},null,-1)])),_:1})])]),e("div",us,[_(Ut,{folders:d(a).folderRoots,"filter-manager":G.collection.filterManager,"visible-folders":G.state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])])])],64)):f("",!0),r.value?(t(),n(E,{key:1},[g.value&&g.value.length?(t(),n("div",ds,[k[12]||(k[12]=e("div",{class:"custom-hr"},null,-1)),e("div",ps,[e("div",cs,[e("div",null,[e("b",null,x(I.$t("main.nav.tasks.title")),1)])]),k[11]||(k[11]=e("div",{class:"custom-hr"},null,-1)),d(s).backendStatus?(t(),n("div",ms,[(t(!0),n(E,null,j(g.value,(P,Q)=>(t(),n("div",vs,[Q?(t(),n("div",gs)):f("",!0),_(Wt,{task:P},null,8,["task"])]))),256))])):f("",!0)])])):f("",!0)],64)):f("",!0),k[19]||(k[19]=e("div",{class:"custom-hr"},null,-1)),e("div",fs,[r.value?(t(),n("div",_s,[_(z,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:b(()=>[e("b",null,x(I.$t("main.nav.properties.title")),1)]),_:1}),k[14]||(k[14]=e("span",{class:"flex-grow-1"},null,-1)),v.value?(t(),n("span",ys,k[13]||(k[13]=[e("span",{class:"sr-only"},null,-1)]))):(t(),n("span",bs,[_(z,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:b(()=>[e("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:u})]),_:1})])),e("span",hs,[_(z,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:b(()=>[e("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:k[4]||(k[4]=P=>d(o).showModal(d(oe).EXPORT,void 0))})]),_:1})])])):f("",!0),d(s).status.loaded?(t(),n("div",ks,[(t(!0),n(E,null,j(d(We)(d(a).propertyGroups),P=>(t(),n("div",xs,[_(ts,{tab:G,group:P,class:"mb-1","menu-open":r.value},null,8,["tab","group","menu-open"])]))),256)),(t(!0),n(E,null,j(i.value,P=>(t(),n("div",$s,[P.id>=0?(t(),n("div",ws,[_(Se,{tab:G,property:P,open:r.value},null,8,["tab","property","open"])])):f("",!0)]))),256)),r.value?(t(),n(E,{key:0},[k[17]||(k[17]=e("div",{class:"property-item m-0 p-0"},null,-1)),e("div",{id:"add-property",onClick:k[5]||(k[5]=P=>{d(o).showModal(d(oe).PROPERTY,void 0),d(we)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[15]||(k[15]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property")),1)]),k[18]||(k[18]=e("div",{class:"custom-hr mt-1"},null,-1)),e("div",{onClick:k[6]||(k[6]=P=>d(a).addPropertyGroup("New Group")),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[k[16]||(k[16]=e("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),e("span",null,x(I.$t("main.nav.properties.add_property_group")),1)])],64)):f("",!0)])):f("",!0)]),k[20]||(k[20]=e("div",{class:"custom-hr"},null,-1)),e("div",Ss,[r.value?(t(),C(z,{key:0,message:"main.nav.computed.computed_tooltip",icon:!0},{default:b(()=>[e("b",null,x(I.$t("main.nav.computed.title")),1)]),_:1})):f("",!0),d(s).status.loaded?(t(),n("div",Cs,[(t(!0),n(E,null,j(d(a).properties,P=>(t(),n(E,null,[P.id<0&&P.id!=d(qe)?(t(),n("div",Is,[_(z,{pos:"bottom",message:"main.nav.computed."+Math.abs(P.id).toString()+"_tooltip"},{default:b(()=>[_(Se,{tab:G,property:P,open:r.value},null,8,["tab","property","open"])]),_:2},1032,["message"])])):f("",!0)],64))),256))])):f("",!0)])])])],4)]}),_:1},8,["id"]))}});const zs=B(Fs,[["__scopeId","data-v-baf60a72"]]),Gs={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},Ts={class:""},Es=["onClick"],Ps=O({__name:"FilterGroupOperator",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p;function o(m){a("update:modelValue",m)}return(m,c)=>(t(),C(te,null,{button:b(()=>[e("div",Gs,[e("span",Ts,x(m.$t("modals.filters."+s.modelValue)),1)])]),popup:b(({hide:y})=>[e("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:y},[e("div",{class:"base-btn",onClick:c[0]||(c[0]=v=>o(d(Fe).and))},x(m.$t("modals.filters.and")),1),c[2]||(c[2]=e("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),e("div",{class:"base-btn",onClick:c[1]||(c[1]=v=>o(d(Fe).or))},x(m.$t("modals.filters.or")),1)],8,Es)]),_:1}))}}),Os=["disabled"],Ls={class:"m-0 p-1"},Ds=["onClick"],Rs=O({__name:"OperatorChoice",props:{propertyId:{},modelValue:{},disabled:{type:Boolean}},emits:["hide","update:modelValue"],setup(h,{emit:p}){const s=K(),a=h,o=p,m=T(()=>s.properties[a.propertyId]),c=T(()=>Ke(m.value.type));async function y(v){o("update:modelValue",v)}return(v,r)=>(t(),C(te,{onHide:r[0]||(r[0]=l=>o("hide")),placement:"bottom"},{button:b(()=>[e("div",{class:"text-nowrap sb ps-1 pe-1",disabled:a.disabled},[e("span",null,x(v.$t("modals.filters.operators."+a.modelValue)),1)],8,Os)]),popup:b(({hide:l})=>[e("div",Ls,[(t(!0),n(E,null,j(c.value,i=>(t(),n("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:u=>{y(i),l()}},[e("a",null,x(v.$t("modals.filters.operators."+i)),1)],8,Ds))),256))])]),_:1}))}});const As=B(Rs,[["__scopeId","data-v-0b3d97be"]]),Bs={class:"d-flex text-nowrap overflow-hidden",style:{"font-size":"14px"}},Us=O({__name:"FilterValueInput",props:{modelValue:{},property:{},width:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p;function o(m){a("update:modelValue",m)}return(m,c)=>(t(),n("div",Bs,[d(Te)(m.property.type)?(t(),C(Qe,{key:0,"model-value":s.modelValue,"onUpdate:modelValue":o,"no-wrap":!0,"auto-focus":!0,"can-create":!1,"can-customize":!1,property:s.property,teleport:!1,width:s.width,class:"sb","force-multi":!0},null,8,["model-value","property","width"])):s.property.type==d(W).color?(t(),C(Ye,{key:1,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,rounded:!0,"min-height":22,teleport:!1,offset:2,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).number?(t(),C(Xe,{key:2,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,height:26,"input-offset":0,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).url?(t(),C(Ze,{key:3,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"])):s.property.type==d(W).checkbox?(t(),C(Je,{key:4,"model-value":s.modelValue,"onUpdate:modelValue":o,label:s.property.name,width:s.width,class:"sb"},null,8,["model-value","label","width"])):s.property.type==d(W).date?(t(),C(et,{key:5,"model-value":s.modelValue,teleport:!1,"onUpdate:modelValue":o,width:s.width,class:"sb"},null,8,["model-value","width"])):(t(),C(tt,{key:6,"model-value":s.modelValue,"onUpdate:modelValue":o,width:s.width,offset:-22,class:"sb"},null,8,["model-value","width"]))]))}}),js={class:"p-0 m-0 ps-2"},Hs=O({__name:"FilterRow",props:{manager:{},filter:{}},emits:[],setup(h,{emit:p}){const s=K(),a=h,o=T(()=>s.properties[a.filter.propertyId]),m=T(()=>ot(a.filter.operator));function c(r){a.manager.updateFilter(a.filter.id,{operator:r})}function y(r){a.manager.updateFilter(a.filter.id,{value:r})}function v(r){a.manager.updateFilter(a.filter.id,{propertyId:r.id})}return(r,l)=>(t(),n(E,null,[e("td",js,[_(st,{"model-value":o.value,"onUpdate:modelValue":v},null,8,["model-value"])]),e("td",null,[_(As,{"property-id":o.value.id,"model-value":a.filter.operator,"onUpdate:modelValue":c},null,8,["property-id","model-value"])]),e("td",null,[m.value?(t(),C(Us,{key:0,"model-value":a.filter.value,"onUpdate:modelValue":y,property:o.value,width:140,style:{width:"150px"},class:""},null,8,["model-value","property"])):f("",!0)])],64))}}),Ns={style:{"max-height":"500px",overflow:"auto"}},Re=O({__name:"AddFilterBtn",props:{group:{},manager:{}},emits:[],setup(h,{emit:p}){const s=h;function a(o){s.manager.addNewFilter(o,s.group.id),ge.filter.show()}return(o,m)=>(t(),C(te,{placement:"auto"},{button:b(()=>[Pe(o.$slots,"default")]),popup:b(({hide:c})=>[e("div",Ns,[_(Oe,{onSelect:y=>{a(y),c()},"ignore-ids":[d(Ce).folders]},null,8,["onSelect","ignore-ids"])])]),_:3}))}}),Ws={class:"filter-group"},qs={class:"table table-sm"},Ks={style:{height:"33px"}},Qs={class:""},Ys={key:0,class:"m-0 p-0"},Xs={key:2,class:"text-secondary"},Zs={class:"border rounded"},Js={class:""},eo=["onClick"],to={class:"d-flex text-secondary ms-2"},so={class:"add-options hover-light"},oo=O({__name:"FilterGroup",props:{filter:{},manager:{},parent:{}},emits:["delete"],setup(h,{emit:p}){K();const s=h,a=T(()=>s.filter),o=T(()=>a.value.filters),m=T(()=>{let r=255-(a.value.depth+1)*5;return`background: rgb(${r},${r},${r});`});function c(r){s.manager.deleteFilter(r.id)}function y(r){s.manager.addNewFilterGroup(r)}function v(r,l){s.manager.updateFilterGroup(r,l)}return(r,l)=>(t(),n("div",Ws,[e("table",qs,[(t(!0),n(E,null,j(o.value,(i,u)=>(t(),n("tr",Ks,[e("td",Qs,[u==0?(t(),n("div",Ys,x(r.$t("modals.filters.where")),1)):u==1?(t(),C(Ps,{key:1,"model-value":a.value.groupOperator,"onUpdate:modelValue":l[0]||(l[0]=g=>v(a.value.id,g))},null,8,["model-value"])):(t(),n("span",Xs,x(r.$t("modals.filters."+a.value.groupOperator)),1))]),i.propertyId!==void 0?(t(),C(Hs,{key:0,filter:i,manager:s.manager},null,8,["filter","manager"])):(t(),n("td",{key:1,colspan:"3",style:X(m.value)},[e("div",Zs,[_(Ae,{filter:i,manager:s.manager},null,8,["filter","manager"])])],4)),e("td",Js,[e("span",{class:"base-btn",onClick:g=>c(i)},l[2]||(l[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,eo)])]))),256))]),e("div",to,[_(Re,{group:s.filter,manager:s.manager},{default:b(()=>[e("div",so,[l[3]||(l[3]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(r.$t("modals.filters.new_filter")),1)])]),_:1},8,["group","manager"]),e("div",{class:"add-options hover-light",onClick:l[1]||(l[1]=i=>y(a.value.id))},[l[4]||(l[4]=e("i",{class:"bi bi-plus"},null,-1)),ee(x(r.$t("modals.filters.new_group")),1)])])]))}});const Ae=B(oo,[["__scopeId","data-v-cbadcac5"]]),ao={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},no={key:0},lo={key:0,class:"or-separator"},io={key:0,class:"or-separator"},ro={key:0,class:"m-1 p-1"},uo=O({__name:"MainFilterDropdown",props:{manager:Ie},emits:["update:modelValue"],setup(h,{emit:p}){const s=K(),a=h,o=M(null),m=M(null),c=T(()=>{let v=y(a.manager.state.filter),r={};return v.forEach(l=>r[l.propertyId]=l),Object.values(r)});function y(v){let r=[];for(let l of v.filters)l.isGroup?r.push(...y(l)):r.push(l);return r}return q(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&m.value.hide()}),J(async()=>{await Z(),ge.filter=m.value}),(v,r)=>(t(),C(te,{ref_key:"dropdownElem",ref:m,placement:"top-start"},{button:b(()=>[e("div",null,[c.value.length||a.manager.state.query?(t(),n("div",ao,[a.manager.state.query?(t(),n("div",no,[r[0]||(r[0]=e("span",{class:"text-primary"},"Text Query",-1)),c.value.length?(t(),n("span",lo,"|")):f("",!0)])):f("",!0),(t(!0),n(E,null,j(c.value,(l,i)=>(t(),n("div",null,[i>0?(t(),n("span",io,"|")):f("",!0),l.propertyId==d(Ce).id?(t(),C(me,{key:1,type:d(s).properties[l.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):f("",!0),e("span",null,x(d(s).properties[l.propertyId].name),1)]))),256))])):f("",!0)])]),popup:b(()=>[e("div",{class:"m-0 p-0",ref_key:"popupElem",ref:o},[Object.keys(d(s).properties).length>0?(t(),n("div",ro,[_(Ae,{filter:a.manager.state.filter,manager:a.manager,parent:o.value},null,8,["filter","manager","parent"])])):f("",!0)],512)]),_:1},512))}});const po=B(uo,[["__scopeId","data-v-7dbca090"]]),co={class:"d-flex flex-row filter-form"},mo={class:"pt-1 pb-1"},vo=O({__name:"FilterForm",props:{manager:Ie},setup(h){const p=h;return(s,a)=>(t(),n("div",co,[e("div",mo,x(s.$t("main.menu.filters"))+": ",1),_(po,{manager:p.manager},null,8,["manager"]),_(Re,{manager:p.manager,group:p.manager.state.filter,class:"p-1"},{default:b(()=>a[0]||(a[0]=[e("span",{class:"base-hover plus-btn text-secondary"},[e("i",{class:"bi bi-plus"})],-1)])),_:1},8,["manager","group"])]))}});const go=B(vo,[["__scopeId","data-v-aad7b24a"]]),fo={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},_o=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(h,{emit:p}){const s=h,a=p,o=M(null);return(m,c)=>(t(),C(te,{ref_key:"dropdownElem",ref:o,"auto-focus":!1},{button:b(()=>c[2]||(c[2]=[e("div",{class:"text-secondary p-1"},[e("span",{class:"base-hover plus-btn"},[e("i",{class:"bi bi-plus"})])],-1)])),popup:b(()=>[e("div",fo,[_(Oe,{onClick:c[0]||(c[0]=y=>d(we)()),onSelect:c[1]||(c[1]=y=>{a("select",y),o.value.hide()}),"ignore-ids":s.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Be=B(_o,[["__scopeId","data-v-2f10e29f"]]),yo={class:"base-hover ps-1 pe-1"},bo={class:"main"},ho=["onClick"],ko=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p,o=Object.values(Le);function m(c){a("update:modelValue",c)}return(c,y)=>(t(),C(te,null,{button:b(()=>[e("div",yo,x(s.modelValue),1)]),popup:b(({hide:v})=>[e("div",bo,[(t(!0),n(E,null,j(d(o),r=>(t(),n("div",{class:"base-hover option",onClick:l=>{m(r),v()}},x(r),9,ho))),256))])]),_:1}))}});const xo=B(ko,[["__scopeId","data-v-cc9d0d61"]]),$o={class:""},wo={class:"d-flex ipt"},So={class:"ms-2",min:"1"},Co=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(h,{emit:p}){const s=h,a=p,o=M(1),m=M(Le.Year);function c(){s.option.stepSize==o.value&&s.option.stepUnit==m.value||a("change",{stepSize:o.value,stepUnit:m.value})}function y(){o.value=s.option.stepSize??1,m.value=s.option.stepUnit}return q(()=>s.option,y),J(y),q(o,()=>{(o.value<1||o.value==null||isNaN(o.value))&&(o.value=1)}),(v,r)=>(t(),C(te,{onHide:c},{button:b(()=>r[2]||(r[2]=[e("i",{class:"bi bi-three-dots-vertical"},null,-1)])),popup:b(({hide:l,focus:i})=>[e("div",$o,[e("div",wo,[e("div",null,[fe(e("input",{type:"number","onUpdate:modelValue":r[0]||(r[0]=u=>o.value=u)},null,512),[[_e,o.value]])]),e("div",So,[_(xo,{modelValue:m.value,"onUpdate:modelValue":r[1]||(r[1]=u=>m.value=u),onHide:i},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Io=B(Co,[["__scopeId","data-v-a27bea28"]]),Vo={class:"d-flex flex-row group-form"},Mo={class:"pt-1 pb-1"},Fo={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},zo={key:0,class:"bi bi-chevron-right smaller"},Go=["onClick"],To=["onClick"],Eo=["onClick"],Po=["onClick"],Oo=["onClick"],Lo=["onClick"],Do=["onClick"],Ro=["onClick"],Ao=["onClick"],Bo={key:5,class:"sm-btn"},Uo={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},jo=O({__name:"GroupForm",props:{isLoading:Boolean,manager:at},setup(h){const p=K(),s=h;function a(l){s.manager.setGroupOption(l),s.manager.update(!0)}function o(l){s.manager.delGroupOption(l),s.manager.update(!0)}function m(l,i){s.manager.setGroupOption(l,{direction:i}),s.manager.sortGroups(!0)}function c(l,i){s.manager.setGroupOption(l,{type:i}),s.manager.sortGroups(!0)}function y(l,i){s.manager.setGroupOption(l,i),s.manager.update(!0)}const v=T(()=>s.manager.state.groupBy.map(l=>p.properties[l])),r=T(()=>{const l=[];return s.manager.state.groupBy.forEach(i=>{l.push({option:s.manager.state.options[i],property:p.properties[i]})}),l});return(l,i)=>(t(),n("div",Vo,[e("div",Mo,x(l.$t("main.menu.groupby"))+": ",1),v.value.length?(t(),n("div",Fo,[(t(!0),n(E,null,j(r.value,(u,g)=>(t(),n(E,null,[g>0?(t(),n("i",zo)):f("",!0),e("div",{class:"base-hover m-1 ps-1 pe-1",onClick:w=>o(u.property.id),id:"remove-group-button"},x(u.property.name),9,Go),u.option.type==d(ne).Size?(t(),C(z,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:b(()=>[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Property)},null,8,To)):(t(),n("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:w=>c(u.property.id,d(ne).Property)},null,8,Eo))]),_:2},1024)):(t(),C(z,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:b(()=>[u.property.type==d(W).number?(t(),n(E,{key:0},[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Po)):(t(),n("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Oo))],64)):(t(),n(E,{key:1},[u.option.direction==d(se).Ascending?(t(),n("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Lo)):(t(),n("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:w=>c(u.property.id,d(ne).Size)},null,8,Do))],64))]),_:2},1024)),u.option.direction==d(se).Ascending?(t(),C(z,{key:3,message:"main.menu.sort.order_asc"},{default:b(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:w=>m(u.property.id,d(se).Descending)},null,8,Ro)]),_:2},1024)):(t(),C(z,{key:4,message:"main.menu.sort.order_desc"},{default:b(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:w=>m(u.property.id,d(se).Ascending)},null,8,Ao)]),_:2},1024)),u.property.type==d(W).date?(t(),n("div",Bo,[_(Io,{option:u.option,onChange:w=>y(u.property.id,w)},null,8,["option","onChange"])])):f("",!0)],64))),256)),s.isLoading?(t(),n("i",Uo)):f("",!0)])):f("",!0),_(Be,{id:"add-group-button","group-ids":s.manager.state.groupBy,onSelect:i[0]||(i[0]=u=>a(u))},null,8,["group-ids"])]))}});const Ho=B(jo,[["__scopeId","data-v-388718c9"]]),No={class:"d-flex flex-row sort-form"},Wo={class:"pt-1 pb-1"},qo={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ko={key:0,class:"bi bi-chevron-right smaller"},Qo=["onClick"],Yo=["onClick"],Xo=["onClick"],Zo=O({__name:"SortForm",props:{manager:nt},setup(h){const p=K(),s=h,a=T(()=>s.manager.state.sortBy.map(v=>({propertyId:v,direction:s.manager.state.options[v].direction}))),o=T(()=>a.value.map(v=>v.propertyId));function m(v){s.manager.setSort(v),s.manager.update(!0)}function c(v){s.manager.delSort(v),s.manager.update(!0)}function y(v,r){s.manager.setSort(v,{direction:r}),s.manager.update(!0)}return(v,r)=>(t(),n("div",No,[e("div",Wo,x(v.$t("main.menu.sort.title"))+": ",1),a.value.length?(t(),n("div",qo,[(t(!0),n(E,null,j(a.value,(l,i)=>(t(),n(E,null,[i>0?(t(),n("i",Ko)):f("",!0),e("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:u=>c(l.propertyId)},x(d(p).properties[l.propertyId].name),9,Qo),l.direction==d(se).Ascending?(t(),C(z,{key:1,message:"main.menu.sort.order_asc"},{default:b(()=>[e("i",{class:"bi bi-arrow-up sm-btn",onClick:u=>y(l.propertyId,d(se).Descending)},null,8,Yo)]),_:2},1024)):(t(),C(z,{key:2,message:"main.menu.sort.order_desc"},{default:b(()=>[e("i",{class:"bi bi-arrow-down sm-btn",onClick:u=>y(l.propertyId,d(se).Ascending)},null,8,Xo)]),_:2},1024))],64))),256))])):f("",!0),_(Be,{"group-ids":o.value,onSelect:r[0]||(r[0]=l=>m(l))},null,8,["group-ids"])]))}});const Jo=B(Zo,[["__scopeId","data-v-80dc564a"]]),ea={class:"custom-slider"},ta=["value","min","max","step"],sa=O({__name:"RangeInput",props:{min:{default:0},max:{default:1},step:{default:.1},modelValue:{}},emits:["update:modelValue"],setup(h,{emit:p}){const s=h,a=p,o=M(s.modelValue),m=M(null),c=(l,i,u)=>(l-i)/(u-i),y=l=>{m.value.style.setProperty("--ProgressPercent",`${l}%`)};lt(()=>{if(m.value){const l=c(o.value,m.value.min,m.value.max);y(l+0)}});function v(){a("update:modelValue",o.value)}let r=!1;return navigator.userAgent.indexOf("AppleWebKit")!=-1&&(r=!0),q(()=>s.modelValue,()=>o.value=s.modelValue),(l,i)=>(t(),n("div",ea,[e("input",{ref_key:"slider",ref:m,value:o.value,onInput:i[0]||(i[0]=({target:u})=>o.value=parseFloat(u.value)),type:"range",min:l.min,max:l.max,step:l.step,class:"slider",style:X(d(r)?"top:-5px":""),onChange:v},null,44,ta)]))}});const oa=B(sa,[["__scopeId","data-v-43f680ec"]]),aa={class:"p-2"},na={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},la={class:"border mb-1 p-1"},ia={class:"me"},ra={key:0},ua={key:1},da={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},pa={class:"d-flex center justify-content-center"},ca={key:1,class:"bi bi-arrow-down text-secondary"},ma={key:3,class:"bi bi-arrow-up text-secondary"},va={class:"border mb-1 p-1"},ga={class:"me"},fa={key:0},_a={key:1},ya={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},le=5,ba=O({__name:"HistoryDropdown",emits:[],setup(h,{emit:p}){const s=K(),a=M(!1),o=T(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),m=T(()=>[...s.history.undo].reverse().slice(0,le)),c=T(()=>s.history.redo.slice(Math.max(s.history.redo.length-le,0)));return q(()=>s.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(y,v)=>m.value.length||c.value.length?(t(),C(te,{key:0},{button:b(()=>[_(z,{message:"dropdown.history.info"},{default:b(()=>[e("div",{class:"d-flex sb flash",style:X([{"font-size":"14px"},o.value])},[v[2]||(v[2]=e("i",{class:"bi bi-clock-history me-1"},null,-1)),e("div",null,x(y.$t("dropdown.history.button")),1)],4)]),_:1})]),popup:b(()=>[e("div",aa,[d(s).history.redo.length>le?(t(),n("div",na," + "+x(d(s).history.redo.length-le),1)):f("",!0),(t(!0),n(E,null,j(c.value,r=>(t(),n("div",la,[e("span",ia,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[3]||(v[3]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(t(),n("span",ra,x(r.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),r.values?(t(),n("span",ua,x(r.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),e("div",da,[e("div",pa,[m.value.length?(t(),C(z,{key:0,message:"dropdown.history.undo"},{default:b(()=>[e("div",{class:"bi bi-arrow-down sb",onClick:v[0]||(v[0]=(...r)=>d(s).undo&&d(s).undo(...r))})]),_:1})):(t(),n("div",ca)),v[4]||(v[4]=e("div",{style:{width:"30px"}},null,-1)),c.value.length?(t(),C(z,{key:2,message:"dropdown.history.redo"},{default:b(()=>[e("div",{class:"bi bi-arrow-up sb",onClick:v[1]||(v[1]=(...r)=>d(s).redo&&d(s).redo(...r))})]),_:1})):(t(),n("div",ma))])]),(t(!0),n(E,null,j(m.value,r=>(t(),n("div",va,[e("span",ga,x(new Date(r.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),v[5]||(v[5]=e("span",{class:"sep ms-1 me-1"},null,-1)),r.tags?(t(),n("span",fa,x(r.tags)+" "+x(y.$t("dropdown.history.tags")),1)):f("",!0),r.values?(t(),n("span",_a,x(r.values)+" "+x(y.$t("dropdown.history.values")),1)):f("",!0)]))),256)),d(s).history.undo.length>le?(t(),n("div",ya," + "+x(d(s).history.undo.length-le),1)):f("",!0)])]),_:1})):f("",!0)}});const ha=B(ba,[["__scopeId","data-v-b5086318"]]),ka=O({__name:"ToggleReload",props:{tab:{}},emits:[],setup(h,{emit:p}){const s=h,a=T(()=>s.tab.collection.state.autoReload?2:s.tab.collection.runState.isDirty?0:1);function o(){a.value==0?s.tab.collection.update():a.value==1?s.tab.collection.setAutoReload(!0):s.tab.collection.setAutoReload(!1)}return(m,c)=>(t(),n("div",{class:"bb font",onClick:o,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(t(),C(z,{key:0,message:"btn.reload.dirty",pos:"bottom"},{default:b(()=>c[0]||(c[0]=[e("span",{class:"bi bi-arrow-repeat text-warning"},null,-1)])),_:1})):f("",!0),a.value==1?(t(),C(z,{key:1,message:"btn.reload.valid",pos:"bottom"},{default:b(()=>c[1]||(c[1]=[e("span",{class:"bi bi-check2-all text-success"},null,-1)])),_:1})):f("",!0),a.value==2?(t(),C(z,{key:2,message:"btn.reload.auto",pos:"bottom"},{default:b(()=>c[2]||(c[2]=[e("div",{style:{height:"30px"}},[e("span",{class:"bi bi-check2-all text-success small-valid"}),e("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}})],-1)])),_:1})):f("",!0)]))}});const xa=B(ka,[["__scopeId","data-v-4047bb79"]]),$a={class:"d-flex flex-row p-2"},wa=["placeholder"],Sa={class:"me-5 d-flex"},Ca={class:"ms-5",style:{"font-size":"13px"}},Ia=["checked"],Va={class:"ms-1"},Ma={class:"ms-4"},Fa={class:"d-flex flex-wrap content-container ps-2"},za=O({__name:"ContentFilter",props:{tab:{},computeStatus:{}},emits:["compute-ml","search-images","remove:selected"],setup(h,{emit:p}){const s=h,a=M(""),o=T(()=>Object.keys(s.tab.collection.groupManager.selectedImages.value).map(Number)),m=T(()=>o.value.length);function c(l){const i=l.target.checked;s.tab.collection.groupManager.setSha1Mode(i,!0)}function y(){a.value=s.tab.state.filterState.query}function v(){s.tab.collection.filterManager.setQuery(a.value),s.tab.collection.filterManager.update(!0)}function r(){s.tab.collection.filterManager.setQuery(""),s.tab.collection.filterManager.update(!0)}return J(y),q(()=>s.tab.collection.filterManager.state.query,y),(l,i)=>(t(),n(E,null,[e("div",$a,[_(z,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:b(()=>[e("div",{class:N(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[i[6]||(i[6]=e("div",{class:"bi bi-search float-start bi-sm"},null,-1)),fe(e("input",{type:"text",class:"input-hidden",placeholder:l.$t("main.menu.search"),"onUpdate:modelValue":i[0]||(i[0]=u=>a.value=u),onChange:v},null,40,wa),[[_e,a.value]]),e("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:r},"x")],2)]),_:1}),e("div",Sa,[_(z,{message:"main.menu.grid_tooltip"},{default:b(()=>[e("i",{class:N("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(s.tab.state.display=="tree"?"":" text-secondary")),onClick:i[1]||(i[1]=u=>s.tab.setViewMode("tree"))},null,2)]),_:1}),_(z,{message:"main.menu.table_tooltip"},{default:b(()=>[e("i",{id:"toot",class:N("bi bi-table btn-icon me-2"+(s.tab.state.display=="grid"?"":" text-secondary")),onClick:i[2]||(i[2]=u=>s.tab.setViewMode("grid"))},null,2)]),_:1}),_(z,{message:"main.menu.graph_tooltip"},{default:b(()=>[e("i",{id:"toot",class:N("bi bi-bar-chart btn-icon"+(s.tab.state.display=="graph"?"":" text-secondary")),onClick:i[3]||(i[3]=u=>s.tab.setViewMode("graph"))},null,2)]),_:1})]),_(z,{message:"main.menu.image_size_tooltip",click:!1},{default:b(()=>i[7]||(i[7]=[e("div",{class:"bi bi-aspect-ratio me-1"},null,-1)])),_:1}),e("div",null,[_(oa,{min:30,max:500,modelValue:s.tab.state.imageSize,"onUpdate:modelValue":i[4]||(i[4]=u=>s.tab.state.imageSize=u)},null,8,["modelValue"])]),e("div",Ca,[_(z,{message:"main.menu.image_mode_tooltip"},{default:b(()=>[e("input",{type:"checkbox",checked:s.tab.collection.groupManager.state.sha1Mode,onChange:c},null,40,Ia),e("span",Va,x(l.$t("main.menu.image_mode")),1)]),_:1})]),e("div",Ma,[_(ha)]),m.value?(t(),C(it,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":o.value,"onRemove:selected":i[5]||(i[5]=u=>s.tab.collection.groupManager.clearSelection()),onStamped:s.tab.collection.groupManager.clearSelection},null,8,["selected-images-ids","onStamped"])):f("",!0),i[9]||(i[9]=e("div",{class:"flex-grow-1"},null,-1)),_(z,{message:"main.menu.issue",class:"bb"},{default:b(()=>i[8]||(i[8]=[e("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)])),_:1})]),e("div",Fa,[_(xa,{tab:s.tab,class:"me-1"},null,8,["tab"]),_(go,{manager:s.tab.collection.filterManager},null,8,["manager"]),_(Ho,{"is-loading":s.computeStatus.groups,manager:s.tab.collection.groupManager},null,8,["is-loading","manager"]),_(Jo,{manager:s.tab.collection.sortManager},null,8,["manager"])])],64))}});const Ga=B(za,[["__scopeId","data-v-298aba4d"]]),Ta={class:""},Ea={class:"d-flex flex-row"},Pa=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(h,{emit:p}){const s=de(),a=h,o=p,m=T(()=>`width: ${a.size}px; height: ${a.size}px;`);T(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`);const c=T(()=>a.pile.images[0]);return(y,v)=>(t(),n("div",Ta,[_(ut,{image:c.value},{default:b(()=>[e("div",{style:X(m.value),class:"img-container",onClick:v[0]||(v[0]=r=>d(s).showModal(d(oe).IMAGE,{image:c.value}))},[_(rt,{image:c.value,width:a.size-2,height:a.size-1},null,8,["image","width","height"])],4)]),_:1},8,["image"]),e("div",Ea,[_(z,{message:"main.recommand.accept"},{default:b(()=>[e("div",{style:X(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:v[1]||(v[1]=r=>o("accept",c.value))}," ✓ ",4)]),_:1}),_(z,{message:"main.recommand.refuse"},{default:b(()=>[e("div",{style:X(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:v[2]||(v[2]=r=>o("refuse",c.value))}," ✕ ",4)]),_:1})])]))}});const Oa=B(Pa,[["__scopeId","data-v-809d667b"]]),La={class:"reco-container"},Da={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Ra={key:0,class:"bi bi-funnel-fill bb text-primary"},Aa={key:1,class:"bi bi-funnel bb"},Ba={class:"text-secondary me-2"},Ua={style:{"padding-top":"2px"},class:"me-1"},ja={class:"flex-grow-1"},Ha={class:"d-flex flex-row"},Na={key:0,class:"separator"},Wa={class:"d-flex flex-row"},ke=10,qa=O({__name:"RecommendedMenu",props:{tab:{},imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(h,{emit:p}){const s=K(),a=dt(),o=h,m=p,c=M(1),y=ve([]),v=M(null),r=ve([]),l=ve(new Set),i=M(!0),u=[],g=[];async function w(R){const F=[],S=[];r.forEach($=>{if($.value!=null){const V=s.properties[$.propertyId];let H=$.value;V.type==W.multi_tags?(H=R.properties[$.propertyId]??[],H=[...H,$.value]):V.type==W.tag&&(H=[H]),V.mode==$e.id?S.push({instanceId:R.id,propertyId:V.id,value:H}):F.push({propertyId:V.id,sha1:R.sha1,value:H})}}),await s.setPropertyValues(S,F)}function D(R){v.value.isSha1Group?v.value.images.filter(F=>F.sha1==R.sha1).forEach(F=>l.add(F.id)):l.add(R.id),Q()}function A(){y.length=0;let R=[];const F=g.map(S=>s.instances[S]);if(v.value.isSha1Group){const S={},$=Array.from(new Set(F.map(V=>V.sha1)));$.forEach(V=>S[V]=[]),F.forEach(V=>S[V.sha1].push(V)),$.forEach(V=>R.push({sha1:V,images:s.sha1Index[V]}))}else F.forEach(S=>R.push({sha1:S.sha1,images:[S]}));I(R,y,c.value,o.imageSize,o.width)}function I(R,F,S,$,V){let H=V,Y=[],ae=0;for(let ye=0;ye<R.length&&!(F.length>=S);ye++){let re=R[ye];if(re.images=re.images.filter(Ue=>!l.has(Ue.id)),re.images.length==0)continue;let be=$+ke;if(ae+be<H){Y.push(re),ae+=be;continue}if(Y.length==0)throw new Error("Images seems to be to big for the line");F.push(Y),F.length<S&&(Y=[re],ae=be)}Y.length>0&&F.length<S&&F.push(Y)}async function k(){if(!o.group||!a.hasSimilaryFunction)return;const R=a.defaultActions.similar,F=a.getContext(R);F.instanceIds=o.group.images.map(Y=>Y.id);const S=await a.getSimilarImages(F);if(!S)return;if(!S.groups)throw new Error("No instances in ActionResult");let V=mt(S.groups)[0];if(i.value){const Y=new Set(o.tab.collection.filterManager.result.images.map(ae=>ae.id));V.images=V.images.filter(ae=>Y.has(ae.id))}V.scores&&vt(V),v.value=V,r.length=0;let H=o.group;for(;H;)r.push(...H.meta.propertyValues),H=H.parent;l.clear(),u.length=0,V.images.forEach(Y=>u.push(Y.id)),Q(),m("update")}function G(){i.value=!i.value}function L(){o.tab.collection.groupManager.onResultChange.addListener(Q)}function P(){o.tab.collection.groupManager.onResultChange.removeListener(Q)}function Q(){const R=o.tab.collection.groupManager.result.index[o.group.id];if(!R){m("close");return}g.length=0;const F=new Set(R.images.map(S=>S.id));u.forEach(S=>{F.has(S)||l.has(S)||g.push(S)}),A()}return J(L),Ve(P),J(k),q(()=>o.group,()=>{k(),l.clear()}),q(()=>o.imageSize,A),q(()=>o.width,A),q(i,k),(R,F)=>(t(),n("div",La,[e("div",Da,[_(z,{message:"main.recommand.close"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:F[0]||(F[0]=S=>m("close"))},F[2]||(F[2]=[e("span",{class:"bi bi-x-lg bb"},null,-1)]))]),_:1}),F[5]||(F[5]=e("div",{class:"b-left pe-1"},null,-1)),_(z,{message:"main.recommand.scroll"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:F[1]||(F[1]=S=>m("scroll",o.group.id))},F[3]||(F[3]=[e("span",{class:"bi bi-arrow-down-circle bb"},null,-1)]))]),_:1}),F[6]||(F[6]=e("div",{class:"b-left pe-1"},null,-1)),_(z,{message:"main.recommand.filter"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:G},[i.value?(t(),n("span",Ra)):(t(),n("span",Aa))])]),_:1}),F[7]||(F[7]=e("div",{class:"b-left pe-1"},null,-1)),_(z,{message:"main.recommand.reload"},{default:b(()=>[e("div",{class:"text-secondary pe-1",onClick:k},F[4]||(F[4]=[e("span",{class:"bi bi-arrow-clockwise bb"},null,-1)]))]),_:1}),F[8]||(F[8]=e("div",{class:"b-left pe-1"},null,-1)),_(z,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:b(()=>[e("span",Ba,x(R.$t("main.recommand.title")),1)]),_:1}),e("div",Ua,[_(pt,{action:"similar",onChanged:k})]),e("div",ja,[e("div",Ha,[(t(!0),n(E,null,j(r,(S,$)=>(t(),n(E,null,[_(ct,{class:"",value:S},null,8,["value"]),$<r.length-1?(t(),n("div",Na)):f("",!0)],64))),256))])])]),e("div",{style:X("margin-left:"+ke+"px;")},[(t(!0),n(E,null,j(y,S=>(t(),n("div",null,[e("div",Wa,[(t(!0),n(E,null,j(S,$=>(t(),C(Oa,{pile:$,size:o.imageSize,onAccept:w,onRefuse:D,style:X("margin-right:"+ke+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const Ka=B(qa,[["__scopeId","data-v-c830b08a"]]);const Qa={style:{display:"flex"}},Ya={class:"info"},Xa={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:W},height:String},setup(h){const p=h,s=M(0),a=M(!1),o={};Object.keys(p.chartData.series).forEach(i=>{o[i]=!1});const m=M({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:p.chartData.dataType===W.date?"datetime":"numeric",categories:p.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:i,seriesIndex:u,dataPointIndex:g,w}){const D=p.chartData.series[u].data[g];let A='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';D.images.forEach((k,G)=>{G<10&&(A+=`<div style="width: 75px; height: 75px;"><img src="${k}" style="width: 100%; height: 100%;" /></div>`)}),A+="</div>";let I=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${p.chartData.series[u].name} — </b> ${D.y} Images</span>`;return I+=`<div>${A}</div>`,I}}}),c=()=>{m.value.chart.stacked=!m.value.chart.stacked,a.value=!a.value,s.value+=1},y=()=>{let i;m.value.chart.type==="area"?i={chart:{...m.value.chart,type:"bar"}}:i={chart:{...m.value.chart,type:"area"}},m.value={...m.value,...i},s.value+=1},v=(i,u,g)=>{const D=p.chartData.series[u];let A=Math.max(...D.data.map(I=>I.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(I=>I.remove()),o[u]){o[u]=!1;return}D.data.forEach((I,k)=>{const L=Math.floor(I.y/A*17),P=I.images.slice(0,L),Q=`circle[index="${u}"][j="${k}"]`,R=document.querySelector(Q),F=parseFloat(R.getAttribute("cx"));P.forEach((S,$)=>{const V=document.createElement("img");V.src=S,V.width=40,V.height=40,V.style.position="absolute";let H=F+40/1.5,Y=65+$*40;V.style.left=`${H}px`,V.style.bottom=`${Y}px`,V.classList.add("apexcharts-custom-image"),V.addEventListener("mouseover",ae=>r(H,Y,S)),V.addEventListener("mouseout",l),i.el.appendChild(V)})}),Object.keys(o).forEach(I=>o[I]=!1),o[u]=!0};function r(i,u,g){const w=document.getElementById("zoomed-image");w.style.left=`${i+120*1.5}px`,w.src=g,w.style.bottom=`${u}px`,w.style.display="block"}function l(){const i=document.getElementById("zoomed-image");i.style.display="none"}return(i,u)=>{const g=Ee("apexchart");return t(),n(E,null,[e("div",Qa,[e("button",{class:"mt-2",onClick:y},x(m.value.chart.type==="area"?i.$t("main.graph-view.histo"):i.$t("main.graph-view.curve")),1),p.chartData.series.length>1?(t(),n("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:c},x(a.value?i.$t("main.graph-view.over"):i.$t("main.graph-view.stack")),1)):f("",!0)]),(t(),C(g,{style:{position:"relative"},key:s.value,height:p.height,type:m.value.chart.type,options:m.value,series:p.chartData.series,onLegendClick:v},null,8,["height","type","options","series"])),e("i",Ya,x(i.$t("main.graph-view.info")),1),u[0]||(u[0]=e("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1))],64)}}},Za={key:1},Ja=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(h,{emit:p}){const s=K(),a=h,o=M(""),m=M(y());function c(){const v=new Set;let r=a.collection.groupManager.getGroupIterator();for(;r;){const l=r.group;if(l.id===0||l.meta.propertyValues&&l.meta.propertyValues[0].value==null){r=r.nextGroup();continue}for(let i of l.children)v.add(i.meta.propertyValues[0].value);l.children.forEach(()=>r=r.nextGroup()),r=r.nextGroup()}return v}function y(){const v={};let r,l=a.collection.groupManager.state.groupBy;if(l.length===0){o.value="Choose at least one date or numeric value to group the images by";return}const i=s.properties[l[0]],u=i.type;if(l.length>2){o.value="Only max two levels of grouping are supported";return}else if(l.length===1)v[i.name]={name:i.name,data:[]};else if(r=Array.from(c()),r.length>20){o.value="Too many curves to draw, select a subgrouping with less than 20 possible values";return}if(u!==W.number&&u!==W.date){o.value="First level of grouping needs to be a date or a numeric property";return}let g=a.collection.groupManager.getGroupIterator();const w=[];for(;g;){const D=g.group;if(D.id===0||D.meta.propertyValues&&D.meta.propertyValues[0].value==null){g=g.nextGroup();continue}let A=D.meta.propertyValues[0];const I=u===W.date?new Date(A.value).getTime():A.value;if(w.push(I),i.name in v)v[i.name].data.push({x:I,y:D.images.length,images:D.images.slice(0,20).map(k=>k.urlSmall)});else{const k=D.children.map(L=>L.meta.propertyValues[0].value),G=r.filter(L=>!k.includes(L));for(let L of D.children){const P=L.meta.propertyValues[0].value;if(v[P]===void 0){let Q=P;P in s.tags&&(Q=s.tags[P].value),v[P]={data:[],name:Q}}v[L.meta.propertyValues[0].value].data.push({x:I,y:L.images.length,images:L.images.slice(0,20).map(Q=>Q.urlSmall)})}for(let L of G){if(v[L]===void 0){let P=L;L in s.tags&&(P=s.tags[L].value),v[L]={data:[],name:P}}v[L].data.push({x:I,y:0,images:[]})}D.children.forEach(()=>g=g.nextGroup())}g=g.nextGroup()}return o.value="",{series:Object.values(v),xValues:w,dataType:u}}return a.collection.groupManager.onResultChange.addListener(()=>m.value=y()),(v,r)=>(t(),n("div",{class:"",style:X({height:a.height+"px"})},[o.value===""?(t(),C(Xa,{key:0,chartData:m.value,height:a.height-50+"px"},null,8,["chartData","height"])):(t(),n("span",Za,x(o.value),1))],4))}}),en={key:0,class:"m-0 p-0"},tn={key:0,style:{"margin-left":"10px"}},sn=O({__name:"MainView",props:{tab:{},height:{},filterOpen:{type:Boolean}},setup(h,{expose:p}){pe();const s=K(),a=h;p({updateScrollerWidth:A});const o=M({}),m=M(!0),c=M(null),y=M(null),v=M(null),r=M(0),l=M(0),i=ve({groups:!1}),u=T(()=>a.tab.getVisibleProperties());function g(){c.value&&y.value?r.value=a.height-c.value.clientHeight-y.value.clientHeight-5:c.value?r.value=a.height-c.value.clientHeight-5:r.value=0}function w(I){o.value=a.tab.collection.groupManager.result.index[I],Z(()=>g())}function D(){o.value={},Z(()=>g())}async function A(){var I;await Z(),l.value=((I=c.value)==null?void 0:I.clientWidth)??l.value}return J(()=>{l.value=c.value.clientWidth,window.addEventListener("resize",A)}),Ve(()=>{window.removeEventListener("resize",A)}),q(()=>a.tab.state.imageSize,()=>Z(g)),q(()=>a.filterOpen,()=>Z(g)),q(()=>a.height,async()=>{await Z(g)}),J(g),J(()=>a.tab.update()),(I,k)=>(t(),n(E,null,[e("div",{id:"main-content",ref_key:"filterElem",ref:c},[a.filterOpen?(t(),C(Ga,{key:0,tab:a.tab,"compute-status":i},null,8,["tab","compute-status"])):f("",!0)],512),e("div",{ref_key:"boxElem",ref:y,class:"m-0 p-0"},[o.value.id?(t(),n("div",en,[_(Ka,{tab:a.tab,group:o.value,"image-size":a.tab.state.imageSize,width:l.value,height:50,onClose:D,onScroll:v.value.scrollTo,onUpdate:k[0]||(k[0]=G=>Z(()=>g()))},null,8,["tab","group","image-size","width","onScroll"])])):f("",!0)],512),d(s).isLoaded&&l.value>0&&r.value>0&&m.value?(t(),n("div",tn,[a.tab.state.display=="tree"?(t(),C(gt,{key:0,"group-manager":a.tab.collection.groupManager,"image-size":a.tab.state.imageSize,height:r.value-0,properties:u.value,"hide-if-modal":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,width:l.value-25,onRecommend:w},null,8,["group-manager","image-size","height","properties","selected-images","width"])):f("",!0),a.tab.state.display=="grid"?(t(),n("div",{key:1,style:X({width:l.value-12+"px"}),class:"p-0 m-0 grid-container"},[_(ft,{tab:I.tab,manager:a.tab.collection.groupManager,height:r.value-15,width:l.value-40,"selected-properties":u.value,class:"p-0 m-0","show-images":!0,"selected-images":a.tab.collection.groupManager.selectedImages,ref_key:"imageList",ref:v,"hide-if-modal":!0},null,8,["tab","manager","height","width","selected-properties","selected-images"])],4)):f("",!0),a.tab.state.display=="graph"?(t(),C(Ja,{key:2,collection:a.tab.collection,height:r.value-15},null,8,["collection","height"])):f("",!0)])):f("",!0)],64))}});const on=B(sn,[["__scopeId","data-v-12bc1b91"]]),an=O({__name:"TabButton",props:{tab:{}},setup(h){const p=ce(),s=M(""),a=M(null),o=M(!1),m=M(!1),c=h,y=T(()=>c.tab.state.id);function v(){p.selectMainTab(c.tab.state.id)}function r(){m.value=!0,s.value=c.tab.state.name,Z(()=>a.value.focus())}function l(){c.tab.renameTab(s.value),m.value=!1}async function i(){confirm("Are you sure to delete Tab: "+c.tab.state.name)&&p.deleteTab(c.tab.state.id)}return J(()=>{c.tab.isNew&&r()}),(u,g)=>(t(),n("div",{class:"d-flex d-row me-2",onMouseenter:g[1]||(g[1]=w=>o.value=!0),onMouseleave:g[2]||(g[2]=w=>o.value=!1)},[m.value?(t(),n("div",{key:1,class:N(["tab-button",y.value==d(p).mainTab?" active":""])},[e("form",{onSubmit:ue(l,["stop","prevent"])},[fe(e("input",{onFocusout:l,onKeydown:_t(l,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":g[0]||(g[0]=w=>s.value=w),ref_key:"inputElem",ref:a},null,544),[[_e,s.value]])],32)],2)):(t(),n(E,{key:0},[_(z,{message:"main.menu.rename_tab_tooltip"},{default:b(()=>[e("i",{onClick:r,class:N(["bi bi-pencil me-1 tab-icon hover-light",o.value&&d(p).mainTab==y.value?"":"hidden"]),style:{"font-size":"10px"}},null,2)]),_:1}),e("div",{class:N(["tab-button",y.value==d(p).mainTab?" active":""]),onClick:v},[e("span",null,x(c.tab.state.name),1)],2),_(z,{message:"main.menu.delete_tab_tooltip"},{default:b(()=>[e("i",{onClick:i,class:N(["btn-icon bi bi-x tab-icon hover-light",o.value?"":"hidden"]),style:{"font-size":"15px"}},null,2)]),_:1})],64))],32))}});const nn={class:"d-flex d-row",style:{cursor:"pointer"}},ln={class:"pt-1"},rn={key:0,class:"bb bi bi-chevron-down"},un={key:1,class:"bb bi bi-chevron-right"},dn={style:{"padding-top":"2px","margin-right":"2px"}},pn={class:"lang"},cn=["value"],mn=["value"],vn=O({__name:"TabNav",props:{reRender:{type:Function},filterOpen:{type:Boolean}},emits:["update:filterOpen"],setup(h,{emit:p}){const{locale:s}=Ge(),a=de(),o=ce(),m=h,c=p;async function y(i){await o.addTab("New Tab")}const v=["fr","en"];function r(){c("update:filterOpen",!m.filterOpen)}function l(i){m.reRender();const u=i.target.value;s.value=u,pe().setLang(u)}return(i,u)=>(t(),n("nav",null,[e("div",nn,[e("div",ln,[e("span",{onClick:r},[m.filterOpen?(t(),n("i",rn)):(t(),n("i",un))])]),(t(!0),n(E,null,j(d(o).loadedTabs,g=>(t(),n("div",null,[_(an,{tab:d(o).getTab(g)},null,8,["tab"])]))),256)),_(z,{message:"main.menu.add_tab_tooltip"},{default:b(()=>[e("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:y,id:"add-tab-button"},u[1]||(u[1]=[e("span",{class:"bi bi-plus"},null,-1)]))]),_:1}),u[4]||(u[4]=e("div",{class:"flex-grow-1"},null,-1)),e("div",dn,[_(z,{message:"modals.notif.icon"},{default:b(()=>[e("span",{class:"bb",onClick:u[0]||(u[0]=g=>d(a).showModal(d(oe).NOTIF))},u[2]||(u[2]=[e("i",{class:"bi bi-bell"},null,-1)]))]),_:1})]),e("div",pn,[u[3]||(u[3]=e("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1)),e("select",{value:i.$i18n.locale,onChange:l},[(t(),n(E,null,j(v,(g,w)=>e("option",{key:`Lang${w}`,value:g},x(g.toUpperCase()),9,mn)),64))],40,cn)])])]))}});const gn={key:0},fn={key:0,class:"spinner-border spinner-border-sm text-primary",style:{position:"relative",top:"-2px"},strole:"status"},ie=O({__name:"LoadWheel",props:{loading:{type:Boolean}},setup(h){const p=h;return(s,a)=>p.loading?(t(),n("div",gn,[s.loading?(t(),n("div",fn,a[0]||(a[0]=[e("span",{class:"visually-hidden"},"Loading...",-1)]))):f("",!0)])):f("",!0)}}),xe=O({__name:"Percentage",props:{current:{},max:{},force:{type:Boolean}},setup(h){const p=h,s=T(()=>p.force?"100%":p.max==0?"0%":p.current>=p.max?"100%":Math.floor(p.current/p.max*100)+"%");return(a,o)=>(t(),n("span",null,x(s.value),1))}}),_n={key:0,class:"center"},yn={class:"text-start",style:{display:"inline-block",width:"200px",height:"300px"}},bn={class:"d-flex text-secondary"},hn={key:0,style:{"font-size":"14px"},class:"bi bi-check text-success"},kn={class:"d-flex text-secondary",style:{"font-size":"14px"}},xn={key:0,class:"bi bi-check text-success"},$n={class:"d-flex text-secondary",style:{"font-size":"14px"}},wn={key:0,class:"bi bi-check text-success"},Sn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Cn={key:0,class:"bi bi-check text-success"},In={class:"d-flex text-secondary",style:{"font-size":"14px"}},Vn={key:0,class:"bi bi-check text-success"},Mn={class:"d-flex text-secondary",style:{"font-size":"14px"}},Fn={key:0,class:"bi bi-check text-success"},zn=O({__name:"DataLoad",setup(h){const p=K();return(s,a)=>d(p).loadState?(t(),n("div",_n,[e("div",yn,[e("div",null,[e("div",bn,[a[0]||(a[0]=e("div",{class:"me-1",style:{"font-size":"14px"}},"Properties",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedProperty},null,8,["loading"]),d(p).loadState.finishedProperty?(t(),n("i",hn)):f("",!0)]),e("div",kn,[a[1]||(a[1]=e("div",{class:"me-1"},"PropertyGroups",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedPropertyGroups},null,8,["loading"]),d(p).loadState.finishedPropertyGroups?(t(),n("i",xn)):f("",!0)]),e("div",$n,[a[2]||(a[2]=e("div",{class:"me-1"},"Tags",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedTags},null,8,["loading"]),d(p).loadState.finishedTags?(t(),n("i",wn)):f("",!0)]),e("div",Sn,[a[3]||(a[3]=e("div",{class:"me-1"},"Instances",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedInstance},null,8,["loading"]),d(p).loadState.finishedInstance?(t(),n("i",Cn)):f("",!0),_(xe,{current:d(p).loadState.counterInstance,max:d(p).loadState.maxInstance,force:d(p).loadState.finishedInstance},null,8,["current","max","force"])]),e("div",In,[a[4]||(a[4]=e("div",{class:"me-1"},"InstanceValues",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedInstanceValues},null,8,["loading"]),d(p).loadState.finishedInstanceValues?(t(),n("i",Vn)):f("",!0),_(xe,{current:d(p).loadState.counterInstanceValue,max:d(p).loadState.maxInstanceValue,force:d(p).loadState.finishedInstanceValues},null,8,["current","max","force"])]),e("div",Mn,[a[5]||(a[5]=e("div",{class:"me-1"},"ImageValues",-1)),_(ie,{class:"me-2",loading:!d(p).loadState.finishedImageValues},null,8,["loading"]),d(p).loadState.finishedImageValues?(t(),n("i",Fn)):f("",!0),_(xe,{current:d(p).loadState.counterImageValue,max:d(p).loadState.maxImageValue,force:d(p).loadState.finishedImageValues},null,8,["current","max","force"])])])])])):f("",!0)}});const Gn=B(zn,[["__scopeId","data-v-8b416e86"]]),Tn={key:0},En={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Pn={class:"w-100"},On={key:0,class:"custom-hr"},Ln={key:2,class:"loading"},Dn={class:"text-center"},Rn={key:3,class:"loading"},An={key:1,class:"above"},Bn=O({__name:"PanopticView",setup(h){const p=pe(),s=K(),a=de(),o=ce(),m=M(null),c=M(null),y=M(window.innerHeight),v=M(!1),r=M(!0),l=M(!0),i=T(()=>{var G;return y.value-(((G=c.value)==null?void 0:G.clientHeight)??0)}),u=T(()=>{var G;return(G=m.value)==null?void 0:G.filteredImages.map(L=>L.id)});let g=navigator.userAgent.indexOf("Mac OS X")!==-1;async function w(){r.value=!1,await Z(),r.value=!0}J(async()=>{a.isProjectLoaded||ze.push("/"),Z(()=>{window.addEventListener("resize",D),D()}),window.addEventListener("keydown",G=>{G.key=="Control"&&(U.ctrl=!0),G.key=="Alt"&&(g&&(U.ctrl=!0),U.alt=!0),G.key=="Shift"&&(U.shift=!0),G.key=="ArrowLeft"&&(U.left=!0),G.key=="ArrowRight"&&(U.right=!0,console.log("keeeyy")),G.key=="Z"&&U.ctrl&&s.redo(),G.key=="z"&&U.ctrl&&s.undo()}),window.addEventListener("keyup",G=>{G.key=="Control"&&(U.ctrl=!1),G.key=="Alt"&&(g&&(U.ctrl=!1),U.alt=!1),G.key=="Shift"&&(U.shift=!1),G.key=="ArrowLeft"&&(U.left=!1),G.key=="ArrowRight"&&(U.right=!1)}),window.addEventListener("mousemove",G=>{U.ctrl=G.ctrlKey,U.alt=G.altKey,U.shift=G.shiftKey,g&&(U.ctrl=U.ctrl||U.alt)})}),Ve(()=>{window.removeEventListener("resize",D)});function D(){y.value=window.innerHeight,v.value=!0}function A(){a.showModal(oe.EXPORT,u)}function I(){ze.push("/")}function k(){m.value&&m.value.updateScrollerWidth()}return(G,L)=>(t(),n(E,null,[r.value&&!d(a).state.backendOff?(t(),n("div",Tn,[m.value&&!m.value.imageList?(t(),C(yt,{key:0,tutorial:"project"})):f("",!0),(t(),n("div",{id:"panoptic",key:d(p).status.renderNb},[e("div",En,[d(s).isLoaded?d(s).isLoaded?(t(),n(E,{key:1},[e("div",null,[_(zs,{onExport:L[0]||(L[0]=P=>A()),onToggle:k})]),e("div",Pn,[e("div",{class:"ms-1",ref_key:"navElem",ref:c},[_(vn,{"re-render":w,filterOpen:l.value,"onUpdate:filterOpen":L[1]||(L[1]=P=>l.value=P)},null,8,["filterOpen"])],512),v.value?(t(),n("div",On)):f("",!0),_(De,{id:d(o).mainTab},{default:b(({tab:P})=>[_(on,{tab:P,height:i.value,ref_key:"mainViewRef",ref:m,"filter-open":l.value},null,8,["tab","height","filter-open"])]),_:1},8,["id"])])],64)):d(a).isProjectLoaded?(t(),n("div",Rn,L[2]||(L[2]=[e("i",{class:"spinner-border",role:"status"},null,-1),e("span",{class:"ms-1"},"Loading...",-1)]))):(t(),n("div",Ln,[e("div",Dn,[e("div",null,x(G.$t("main.status.no_project")),1),e("div",{class:"bi bi-house p-3",onClick:I,style:{"font-size":"50px",cursor:"pointer"}})])])):(t(),n("div",{key:0,class:"d-flex flex-column w-100",style:X({height:y.value+"px"})},[_(Gn,{class:"flex-grow-1"})],4))])]))])):f("",!0),d(a).state.backendOff?(t(),n("div",An,"Lost connection to backend. Verify that panoptic is running and reload page")):f("",!0)],64))}});const Hn=B(Bn,[["__scopeId","data-v-27ea8d2f"]]);export{Hn as default};
