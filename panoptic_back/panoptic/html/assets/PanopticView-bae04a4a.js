import{d as O,x as ee,r as S,c as C,o as s,j as T,s as x,b as t,t as y,n as A,a as o,l as H,F as z,D as oe,y as Ne,_ as N,z as _e,h as pe,A as K,B as Ae,C as Pe,e as l,P as De,k as g,q as k,E as xe,G as V,H as He,I as Ue,S as Be,J as qe,K as Ke,L as Qe,p as Q,f as W,N as te,O as we,w as ue,v as ye,Q as Ie,R as P,T as Oe,m as J,U as We,V as Ye,W as Ce,X as B,Y as $e,Z as Ve,u as Me,M as ie,g as Se,$ as Ze,a0 as Xe,a1 as Fe,a2 as Je,a3 as Le,a4 as et,a5 as le,a6 as se,a7 as tt,a8 as st,a9 as ot,aa as at,ab as nt,ac as lt,ad as ce,ae as it,af as rt,ag as ne,ah as dt,ai as ct,aj as pt,ak as ut,i as Ee,al as q,am as _t}from"./index-9e4e5c88.js";import{_ as mt}from"./Tutorial-ae8ac485.js";const vt=["disabled"],ht={class:"m-0 p-1"},gt=["onClick"],yt=O({__name:"OperatorDropdown",props:{propertyId:{type:Number,required:!0},modelValue:String,disabled:Boolean,parent:HTMLElement},emits:["hide","update:modelValue"],setup(u,{emit:d}){const e=ee(),a=u,c=d,v=S(null),h=C(()=>e.properties[a.propertyId]),b=C(()=>Ne(h.value.type));async function m(_){c("update:modelValue",_),v.value.hide()}return(_,i)=>(s(),T(oe,{onHide:i[0]||(i[0]=n=>c("hide")),ref_key:"dropdownElem",ref:v,parent:a.parent},{button:x(()=>[t("div",{class:A(["text-nowrap",a.disabled?"":"dropdown-toggle hover-light button-like"]),disabled:a.disabled},[t("span",null,y(_.$t("modals.filters.operators."+a.modelValue)),1)],10,vt)]),popup:x(()=>[t("div",ht,[(s(!0),o(z,null,H(b.value,n=>(s(),o("div",{class:"hover-light p-1 rounded",style:{cursor:"pointer"},onClick:r=>m(n)},[t("a",null,y(_.$t("modals.filters.operators."+n)),1)],8,gt))),256))])]),_:1},8,["parent"]))}});const ft=N(yt,[["__scopeId","data-v-28740c65"]]),bt=u=>(Q("data-v-431e6dea"),u=u(),W(),u),$t={class:"m-0 p-0"},kt={style:{"max-height":"400px","overflow-y":"scroll"}},xt={key:0},wt={class:"d-flex mode-header"},It={class:"me-3"},St=bt(()=>t("div",{class:"flex-fill"},null,-1)),Ct={key:0,class:"me-2",style:{width:"100%"}},Mt=O({__name:"FilterDropdown",props:{manager:_e,mode:{type:Number,default:1},propertyId:Number,parentId:Number,filterId:Number,parent:HTMLElement},setup(u){const d=ee(),e=u,a=S(null),c=S(null),v=S(null),h=S(0),b=S(null),m=S(null),_=C(()=>e.filterId!==void 0?e.filterId:b.value),i=C(()=>{if(!(_.value==null||_.value==-1))return e.manager.filterIndex[_.value]}),n=C(()=>i.value==null?void 0:d.properties[i.value.propertyId]);function r(){h.value=e.mode,e.mode==2&&e.filterId==null&&F(e.propertyId)}function p(){a.value&&a.value.hide()}function f(){h.value=0}function $(){p(),e.manager.deleteFilter(_.value)}function F(w){let I=e.manager.addNewFilter(w,e.parentId);b.value=I.id,h.value=2}function D(w){m.value=null,e.manager.updateFilter(_.value,{operator:w}),c.value&&c.value.focus(),xe(w)||p()}function U(){console.log("update value",m.value),e.manager.updateFilter(_.value,{value:m.value})}function Z(){if(!i.value)return;const w=d.properties[i.value.propertyId];if(Ke(w.type))return;const I=m.value??Qe(w.type);i.value.value!=I&&U()}function M(){i.value&&(m.value=i.value.value)}return pe(M),K(()=>i.value,()=>M()),(w,I)=>(s(),T(oe,{ref_key:"dropdownElem",ref:a,onShow:r,onHide:f,parent:e.parent},{button:x(()=>[t("div",$t,[Ae(w.$slots,"default",{},void 0,!0)])]),popup:x(()=>[t("div",{class:"container-size bg-white",ref_key:"popupElem",ref:v},[h.value!=0?(s(),o(z,{key:0},[t("div",kt,[h.value==1?(s(),T(Pe,{key:0,onSelect:F,"ignore-ids":[l(De).folders]},null,8,["ignore-ids"])):g("",!0)]),h.value==2?(s(),o("div",xt,[t("div",wt,[t("div",It,y(n.value.name),1),k(ft,{"property-id":i.value.propertyId,"model-value":i.value.operator,"onUpdate:modelValue":D,parent:v.value},null,8,["property-id","model-value","parent"]),St,t("div",null,[t("i",{class:"bi bi-trash-fill",onClick:$})])]),l(xe)(i.value.operator)?(s(),o("div",Ct,[n.value.type==l(V).multi_tags||n.value.type==l(V).tag?(s(),T(He,{key:0,modelValue:m.value,"onUpdate:modelValue":[I[0]||(I[0]=E=>m.value=E),U],"auto-focus":!0,property:l(d).properties[i.value.propertyId],ref_key:"inputElem",ref:c,onHide:p},null,8,["modelValue","property"])):n.value.type==l(V).color?(s(),T(Ue,{key:1,property:n.value,modelValue:m.value,"onUpdate:modelValue":[I[1]||(I[1]=E=>m.value=E),I[2]||(I[2]=()=>{p(),Z()})]},null,8,["property","modelValue"])):n.value.type==l(V).date?(s(),T(Be,{key:2,property:n.value,modelValue:m.value,"onUpdate:modelValue":[I[3]||(I[3]=E=>m.value=E),I[4]||(I[4]=()=>{p(),Z()})]},null,8,["property","modelValue"])):(s(),T(qe,{key:3,"no-html":!0,modelValue:m.value,"onUpdate:modelValue":I[5]||(I[5]=E=>m.value=E),width:-1,"min-height":20,"no-nl":l(d).properties[i.value.propertyId].type==l(V).number,"url-mode":l(d).properties[i.value.propertyId].type==l(V).url,"only-number":l(d).properties[i.value.propertyId].type==l(V).number,onBlur:Z,"auto-focus":!0,ref_key:"inputElem",ref:c},null,8,["modelValue","no-nl","url-mode","only-number"]))])):g("",!0)])):g("",!0)],64)):g("",!0)],512)]),_:3},8,["parent"]))}});const ge=N(Mt,[["__scopeId","data-v-431e6dea"]]),re=u=>(Q("data-v-acacde12"),u=u(),W(),u),Vt={class:"d-flex flex-row"},Ft={key:1,class:"d-flex",style:{width:"150px"}},Et={class:"flex-grow-1"},Tt={key:1,style:{"padding-top":"1px"}},zt={style:{width:"20px","margin-top":"2px"},class:"text-center"},Pt=re(()=>t("i",{class:"bi bi-link-45deg"},null,-1)),Dt={class:"text-center",style:{width:"20px","margin-top":"2px"}},Ot=re(()=>t("i",{class:"bi bi-chevron-down"},null,-1)),Lt=re(()=>t("i",{class:"bi bi-chevron-right"},null,-1)),Gt={key:0,class:"ms-3 pt-1"},jt=re(()=>t("i",{class:"bi bi-funnel-fill me-2"},null,-1)),Rt=re(()=>t("i",{class:"bi bi-filter me-2"},null,-1)),Nt=re(()=>t("i",{class:"bi bi-collection me-2"},null,-1)),At=re(()=>t("i",{class:"bi bi-trash me-2"},null,-1)),Ht={key:1},Ut=O({__name:"PropertyOptions",props:{property:Object},setup(u){const d=te(),e=d.getTabManager(),a=u,c=S(!1),v=S(!1),h=S(""),b=S(!1),m=C(()=>d.getTab()),_=C(()=>m.value.visibleProperties[a.property.id]==!0),i=C(()=>e.collection.filterManager.state.filter.filters.some(E=>!E.isGroup&&E.propertyId==a.property.id)),n=C(()=>e.collection.groupManager.state.groupBy.includes(a.property.id)),r=C(()=>e.collection.sortManager.state.sortBy.includes(a.property.id)),p=C(()=>{if(i.value)return e.collection.filterManager.state.filter.filters.find(E=>!E.isGroup&&E.propertyId==a.property.id).id}),f=()=>e.collection.filterManager,$=C(()=>e.getSha1Mode());function F(){_.value?e.setVisibleProperty(a.property.id,!1):e.setVisibleProperty(a.property.id,!0)}function D(){c.value?c.value=!1:(c.value=!0,h.value=a.property.name),v.value=!1}function U(){a.property.type!=V.tag&&a.property.type!=V.multi_tags||(v.value?v.value=!1:v.value=!0,c.value=!1)}function Z(){r.value?e.collection.sortManager.delSort(a.property.id):e.collection.sortManager.setSort(a.property.id),e.collection.sortManager.update(!0)}function M(){n.value?e.collection.groupManager.delGroupOption(a.property.id):e.collection.groupManager.setGroupOption(a.property.id),e.collection.groupManager.update(!0)}function w(){confirm("Supprimer la propriété: "+a.property.name+" ?")&&d.deleteProperty(a.property.id)}async function I(){h.value!=""&&(await d.updateProperty(a.property.id,h.value),D())}return K(()=>a.property,()=>{c.value=!1}),(E,L)=>(s(),o("div",{class:A(b.value?"hover-light":"")},[t("div",Vt,[c.value?g("",!0):(s(),o("div",{key:0,class:"option-holder hover-light btn-icon",style:{width:"150px"},onClick:D},[k(we,{type:a.property.type,class:"me-2 btn-icon",onMouseenter:L[0]||(L[0]=G=>b.value=!0),onMouseleave:L[1]||(L[1]=G=>b.value=!1)},null,8,["type"]),t("span",null,y(a.property.name),1)])),c.value?(s(),o("div",Ft,[t("div",null,[t("i",{class:"btn-icon me-1 bi bi-x-lg",style:{padding:"2px"},onClick:D,onMouseenter:L[2]||(L[2]=G=>b.value=!0),onMouseleave:L[3]||(L[3]=G=>b.value=!1)},null,32)]),t("div",Et,[a.property.id>=0?ue((s(),o("input",{key:0,style:{position:"relative",top:"1px"},type:"text",class:"text-input","onUpdate:modelValue":L[4]||(L[4]=G=>h.value=G),onChange:I},null,544)),[[ye,h.value]]):(s(),o("span",Tt,[k(we,{type:a.property.type,class:"me-2 btn-icon"},null,8,["type"]),t("span",null,y(a.property.name),1)]))])])):g("",!0),t("div",zt,[a.property.mode==l(Ie).id?(s(),T(P,{key:0,click:!1,message:"main.nav.properties.linked_property_tooltip"},{default:x(()=>[Pt]),_:1})):g("",!0)]),t("div",{style:{width:"20px","margin-top":"2px"},onClick:F,class:"btn-icon text-center"},[$.value&&a.property.mode==l(Ie).id?(s(),T(P,{key:0,message:"main.nav.properties.hidden_property_tooltip"},{default:x(()=>[t("span",{class:"bi bi-eye-slash",onClick:L[5]||(L[5]=Oe(()=>{},["stop"]))})]),_:1})):(s(),T(P,{key:1,pos:"right",message:"main.nav.properties.hide_property_tooltip"},{default:x(()=>[t("span",{class:A("bi bi-eye text-"+(_.value?"primary":"secondary"))},null,2)]),_:1}))]),t("div",Dt,[a.property.type==l(V).tag||a.property.type==l(V).multi_tags?(s(),o("div",{key:0,onClick:U,style:{cursor:"pointer"}},[v.value?(s(),T(P,{key:0,message:"main.nav.properties.collapse_property_tooltip"},{default:x(()=>[Ot]),_:1})):(s(),T(P,{key:1,message:"main.nav.properties.expand_property_tooltip"},{default:x(()=>[Lt]),_:1}))])):g("",!0)])]),t("div",null,[c.value?(s(),o("div",Gt,[t("div",{class:A(["options hover-light",i.value?" text-primary":""])},[k(ge,{manager:f(),"filter-id":p.value,mode:2,"property-id":u.property.id},{default:x(()=>[jt,J(y(E.$t("main.menu.filters")),1)]),_:1},8,["manager","filter-id","property-id"])],2),t("div",{class:A(["options hover-light",r.value?" text-primary":""]),onClick:Z},[Rt,J(y(E.$t("main.menu.sort.title")),1)],2),t("div",{class:A(["options hover-light",n.value?" text-primary":""]),onClick:M},[Nt,J(y(E.$t("main.menu.groupby")),1)],2),a.property.id>=0?(s(),o("div",{key:0,class:"options hover-light",onClick:w},[At,J(y(E.$t("main.nav.properties.delete_property")),1)])):g("",!0)])):v.value?(s(),o("div",Ht,[k(We,{property:a.property,"can-create":!0,"can-customize":!0,"can-delete":!0,"can-link":!0},null,8,["property"])])):g("",!0)])],2))}});const Te=N(Ut,[["__scopeId","data-v-acacde12"]]),Bt=t("i",{class:"bi bi-three-dots base-hover"},null,-1),qt={class:"text-nowrap"},Kt=["onClick"],Qt=t("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),Wt=t("div",{class:"custom-hr"},null,-1),Yt=["onClick"],Zt=t("i",{class:"bi bi-trash me-1"},null,-1),Xt=O({__name:"FolderOptionDropdown",props:{folder:{}},setup(u){const d=te(),e=u;function a(){d.reImportFolder(e.folder.id)}function c(){confirm(Ye.global.t("main.nav.folders.del_alert"))&&d.deleteFolder(e.folder.id)}return(v,h)=>(s(),T(oe,{teleport:!0},{button:x(()=>[Bt]),popup:x(({hide:b})=>[t("div",qt,[t("div",{class:"p-2 bb",onClick:m=>{a(),b()}},[Qt,J("Re import")],8,Kt),Wt,t("div",{class:"bb p-2",onClick:m=>{c(),b()}},[Zt,J(y(v.$t("main.nav.folders.del")),1)],8,Yt)])]),_:1}))}}),Jt=["onMouseenter"],es=["onClick"],ts={class:"text-secondary"},ss=["onClick"],os=O({__name:"FolderList2",props:{folders:Array,visibleFolders:Object,filterManager:_e,root:{type:Boolean,default:!0}},setup(u){const d=te(),e=u,a=S(null),c=C(()=>{let i={};const n=new Set(e.filterManager.state.folders);return e.folders.map(r=>r.id).forEach(r=>{n.has(r)&&(i[r]=!0)}),i}),v=C(()=>{let i={};return e.folders.map(n=>n.id).forEach(n=>{e.visibleFolders[n]&&(i[n]=!0)}),i}),h=C(()=>{let i={};return e.folders.forEach(n=>{let r=[];c.value[n.id]&&r.push("selected"),i[n.id]=r.join(" ")}),i});function b(i){let n=e.visibleFolders;n[i]?delete n[i]:n[i]=!0}function m(i){let n=new Set(e.filterManager.state.folders);const r=n.has(i),p=d.data.folders[i].parent!=null&&n.has(d.data.folders[i].parent);r&&!p?(n.delete(i),$e(i).forEach(f=>n.delete(f.id))):(_(i,n),n.add(i),$e(i).forEach(f=>n.add(f.id)),Ve(d.data.folders[i]).forEach(f=>n.delete(f.id))),e.filterManager.setFolders(Array.from(n)),e.filterManager.update(!0)}function _(i,n){const r=Ve(d.data.folders[i]);let p;for(let f of r)if(n.has(f.id))p=f;else break;p!=null&&$e(p.id).forEach(f=>n.delete(f.id))}return(i,n)=>{const r=Ce("FolderList2",!0);return s(),o("ul",{class:A(e.root?"tree":""),style:B(e.root?"padding-left:0px;":"")},[(s(!0),o(z,null,H(u.folders,p=>(s(),o("li",{style:B(e.root?"padding-left:0px;":""),class:"no-break",onMouseenter:f=>a.value=p.id,onMouseleave:n[0]||(n[0]=f=>a.value=null)},[t("summary",{class:A(h.value[p.id]),onClick:f=>m(p.id)},[J(y(p.name)+" ",1),t("span",ts,y(p.count),1)],10,es),p.children&&p.children.length>0?(s(),o("i",{key:0,onClick:f=>b(p.id),class:A("bi bi-chevron-"+(v.value[p.id]?"down":"right")+" ms-2 btn-icon"),style:{"font-size":"9px"}},null,10,ss)):g("",!0),t("span",{class:A(a.value===p.id?"visible-option":"invisible-option")},[k(Xt,{folder:p,style:{display:"inline-block"}},null,8,["folder"])],2),p.children&&p.children.length>0&&v.value[p.id]?(s(),T(r,{key:1,folders:p.children,root:!1,"visible-folders":e.visibleFolders,"filter-manager":e.filterManager},null,8,["folders","visible-folders","filter-manager"])):g("",!0)],44,Jt))),256))],6)}}});const as=N(os,[["__scopeId","data-v-70a1ae09"]]),ns={class:"text-center"},ls={class:"w-100 text-center",style:{"font-size":"10px"}},is={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},rs=O({__name:"TaskStatus",props:{task:{}},setup(u){const d=u,e=C(()=>d.task.total-d.task.remain-d.task.computing),a=C(()=>d.task.total);return(c,v)=>(s(),o("div",ns,[J(y(d.task.name)+" ",1),t("div",ls,y(e.value)+" / "+y(a.value)+" "+y(c.$t("main.nav.tasks.done")),1),a.value>0?(s(),o("div",is,[t("div",{class:"progress-bar",style:B(`width: ${e.value/a.value*100}%`)},null,4)])):g("",!0)]))}}),Y=u=>(Q("data-v-f68ebd72"),u=u(),W(),u),ds={class:"menu overflow-scroll"},cs={class:""},ps={class:"m-0",style:{padding:"4px 0px 4px 8px"}},us={class:"d-flex align-items-center",style:{"font-size":"15px","line-height":"14px"}},_s=Y(()=>t("i",{class:"bi bi-gear"},null,-1)),ms=[_s],vs=Y(()=>t("i",{class:"bi bi-arrow-left-right"},null,-1)),hs=[vs],gs=Y(()=>t("div",{class:"custom-hr"},null,-1)),ys={class:"ps-2 pe-2",style:{"padding-bottom":"9.5px"}},fs={class:"d-flex align-items-center"},bs=Y(()=>t("i",{class:"bi bi-plus"},null,-1)),$s={style:{"max-height":"300px",overflow:"auto"}},ks={key:0,id:"import"},xs=Y(()=>t("div",{class:"custom-hr"},null,-1)),ws={class:"pt-1 pb-2"},Is={class:"d-flex align-items-center ps-2 pe-2",style:{height:"30px"}},Ss=Y(()=>t("div",{class:"custom-hr"},null,-1)),Cs={key:0,class:"ps-2 pe-2"},Ms={class:"p-1"},Vs={key:0,class:"custom-hr"},Fs={key:1,class:"p-2"},Es=Y(()=>t("div",{class:"custom-hr"},null,-1)),Ts={key:0,class:"float-end"},zs={class:"text-center"},Ps={class:"w-100 text-center",style:{"font-size":"10px"}},Ds={key:1,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},Os={key:2,class:"p-2"},Ls={class:"w-100 text-center",style:{"font-size":"10px"}},Gs={key:0,class:"progress",role:"progressbar","aria-label":"Example 1px high","aria-valuemin":"0","aria-valuemax":"100",style:{height:"1px"}},js=Y(()=>t("div",{class:"custom-hr"},null,-1)),Rs={class:"p-2 mt-0"},Ns={class:"d-flex"},As=Y(()=>t("span",{class:"flex-grow-1"},null,-1)),Hs={key:0,class:"spinner-grow spinner-grow-sm float-end",style:{width:"10px",height:"10px","margin-top":"5px"}},Us=Y(()=>t("span",{class:"sr-only"},null,-1)),Bs=[Us],qs={key:1,class:"bb me-1"},Ks={class:"bb me-2"},Qs={key:0,class:"mt-2"},Ws={key:0,class:"property-item"},Ys=Y(()=>t("div",{class:"property-item m-0 p-0"},null,-1)),Zs=Y(()=>t("i",{class:"bi bi-plus btn-icon float-start",style:{"font-size":"25px"}},null,-1)),Xs=Y(()=>t("div",{class:"custom-hr"},null,-1)),Js={class:"p-2 mt-0"},eo={key:0,class:"mt-2"},to={key:0,class:"property-item"},so=O({__name:"Menu",emits:["export"],setup(u,{emit:d}){const e=te(),a=ee(),c=Me(),v=e.getTabManager(),h=S(!1),b=S(!1),m=async r=>{c.showModal(ie.IMPORT)},_=C(()=>e.backendStatus.tasks.filter(r=>!(r.name=="Load Plugin"&&r.done)));function i(){c.showModal(ie.FOLDERSELECTION,{callback:n,mode:"images"})}function n(r){r&&e.addFolder(r)}return K(()=>e.status.import.to_import,()=>h.value=!0),(r,p)=>{var f;return s(),o("div",ds,[t("div",cs,[t("div",null,[t("div",ps,[t("div",us,[t("div",{class:"flex-grow-1 text-capitalize",onClick:p[0]||(p[0]=()=>{})},y((f=l(c).data.status.selectedProject)==null?void 0:f.name),1),t("div",{class:"base-hover p-1",onClick:p[1]||(p[1]=$=>l(c).showModal(l(ie).SETTINGS))},ms),t("div",{class:"base-hover p-1",style:{"margin-right":"6px"},onClick:p[2]||(p[2]=$=>l(c).closeProject())},hs)])]),gs,t("div",ys,[t("div",fs,[t("div",null,[t("b",null,y(r.$t("main.nav.folders.title")),1)]),t("div",{id:"add_folder",class:"ms-auto plus",onClick:p[3]||(p[3]=$=>{i(),l(Se)()})},[k(P,{message:"main.nav.folders.add"},{default:x(()=>[bs]),_:1})])]),t("div",$s,[l(e).getTab()?(s(),T(as,{key:0,folders:l(e).folderRoots,"filter-manager":l(v).collection.filterManager,"visible-folders":l(v).state.visibleFolders},null,8,["folders","filter-manager","visible-folders"])):g("",!0)])]),_.value&&_.value.length?(s(),o("div",ks,[xs,t("div",ws,[t("div",Is,[t("div",null,[t("b",null,y(r.$t("main.nav.tasks.title")),1)])]),Ss,l(e).backendStatus?(s(),o("div",Cs,[(s(!0),o(z,null,H(_.value,($,F)=>(s(),o("div",Ms,[F?(s(),o("div",Vs)):g("",!0),k(rs,{task:$},null,8,["task"])]))),256))])):g("",!0)])])):g("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&h.value?(s(),o("div",Fs,[Es,l(e).status.import.done?(s(),o("div",Ts,[t("i",{class:"bi bi-x base-hover",onClick:p[4]||(p[4]=$=>h.value=!1)})])):g("",!0),t("div",zs,[t("b",null,y(r.$t("main.menu.import_status_title")),1)]),t("div",Ps,y(l(e).status.import.imported)+" / "+y(l(e).status.import.to_import)+" importées ",1),l(e).status.import.to_import>0?(s(),o("div",Ds,[t("div",{class:"progress-bar",style:B(`width: ${l(e).status.import.imported/l(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),l(e).status.import.to_import!=null&&l(e).status.import.to_import>0&&h.value?(s(),o("div",Os,[t("div",Ls,y(l(e).status.import.computed)+" / "+y(l(e).status.import.to_import)+" computed ",1),l(e).status.import.to_import>0?(s(),o("div",Gs,[t("div",{class:"progress-bar",style:B(`width: ${l(e).status.import.computed/l(e).status.import.to_import*100}%`)},null,4)])):g("",!0)])):g("",!0),js,t("div",Rs,[t("div",Ns,[k(P,{message:"main.nav.properties.properties_tooltip",pos:"top",icon:!0},{default:x(()=>[t("b",null,y(r.$t("main.nav.properties.title")),1)]),_:1}),As,b.value?(s(),o("span",Hs,Bs)):(s(),o("span",qs,[k(P,{pos:"right",message:"main.nav.properties.import_properties_tooltip"},{default:x(()=>[t("i",{class:"bi bi-box-arrow-in-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:m})]),_:1})])),t("span",Ks,[k(P,{pos:"right",message:"main.nav.properties.export_properties_tooltip"},{default:x(()=>[t("i",{class:"bi bi-box-arrow-up text-secondary",style:{position:"relative",top:"0px","font-size":"15px"},onClick:p[5]||(p[5]=$=>l(c).showModal(l(ie).EXPORT,void 0))})]),_:1})])]),l(e).status.loaded?(s(),o("div",Qs,[(s(!0),o(z,null,H(l(a).properties,$=>(s(),o(z,null,[$.id>=0?(s(),o("div",Ws,[k(Te,{property:$},null,8,["property"])])):g("",!0)],64))),256)),Ys,t("div",{id:"add-property",onClick:p[6]||(p[6]=$=>{l(c).showModal(l(ie).PROPERTY,void 0),l(Se)()}),class:"btn-icon base-hover mt-1",style:{"line-height":"25px"}},[Zs,t("span",null,y(r.$t("main.nav.properties.add_property")),1)])])):g("",!0)]),Xs,t("div",Js,[k(P,{message:"main.nav.computed.computed_tooltip",icon:!0},{default:x(()=>[t("b",null,y(r.$t("main.nav.computed.title")),1)]),_:1}),l(e).status.loaded?(s(),o("div",eo,[(s(!0),o(z,null,H(l(a).properties,$=>(s(),o(z,null,[$.id<0?(s(),o("div",to,[k(P,{pos:"bottom",message:"main.nav.computed."+Math.abs($.id).toString()+"_tooltip"},{default:x(()=>[k(Te,{property:$},null,8,["property"])]),_:2},1032,["message"])])):g("",!0)],64))),256))])):g("",!0)])])])])}}});const oo=N(so,[["__scopeId","data-v-f68ebd72"]]),ao={class:"text-nowrap text-secondary"},ze=O({__name:"TagPreview",props:{propertyId:Number,value:Array},setup(u){const d=ee(),e=u,a=C(()=>d.properties[e.propertyId].tags);return(c,v)=>(s(),o("div",ao,[e.value&&e.value.length>0?(s(!0),o(z,{key:0},H(e.value,h=>(s(),o("span",null,[k(Ze,{tag:a.value[h].value,color:a.value[h].color,class:"me-1"},null,8,["tag","color"])]))),256)):(s(),o(z,{key:1},[J(" Add Tags... ")],64))]))}}),no={key:0},lo={key:1},io={key:2},ro={key:3},co={key:0,class:"bi bi-square"},po={key:1,class:"bi bi-check-square"},uo={key:5},_o={key:6},mo={key:7},vo={key:8},ho={key:9},go={key:10},yo={key:11},fo={key:12},bo={key:13},$o={key:1,class:"text-secondary"},ko=O({__name:"PropertyValuePreview",props:{value:void 0,property:Object},setup(u){const d=u,e=C(()=>{if(d.value==null)return"white";let c=Number(d.value);return isNaN(c)||c>12?"gray":Xe[c].color}),a=C(()=>[V._ahash,V._folders,V._sha1,V.string].indexOf(d.property.type)!==-1?'"'+d.value+'"':d.value);return(c,v)=>u.value!=null?(s(),o(z,{key:0},[d.property.type==l(V)._ahash?(s(),o("div",no,y(a.value),1)):g("",!0),d.property.type==l(V)._folders?(s(),o("div",lo,y(a.value),1)):g("",!0),d.property.type==l(V)._sha1?(s(),o("div",io,y(a.value),1)):g("",!0),d.property.type==l(V).checkbox?(s(),o("div",ro,[a.value?(s(),o("i",co)):(s(),o("i",po))])):g("",!0),d.property.type==l(V).color?(s(),o("div",{key:4,style:B({backgroundColor:e.value}),class:"w-100 h-100"},null,4)):g("",!0),d.property.type==l(V).date?(s(),o("div",uo,y(a.value),1)):g("",!0),d.property.type==l(V).image_link?(s(),o("div",_o)):g("",!0),d.property.type==l(V).multi_tags?(s(),o("div",mo,[k(ze,{"property-id":d.property.id,value:a.value},null,8,["property-id","value"])])):g("",!0),d.property.type==l(V).number?(s(),o("div",vo,y(a.value),1)):g("",!0),d.property.type==l(V).path?(s(),o("div",ho,y(a.value),1)):g("",!0),d.property.type==l(V).string?(s(),o("div",go,y(a.value),1)):g("",!0),d.property.type==l(V)._id||d.property.type==l(V)._height||d.property.type==l(V)._width?(s(),o("div",yo,y(a.value),1)):g("",!0),d.property.type==l(V).tag?(s(),o("div",fo,[k(ze,{"property-id":d.property.id,value:a.value},null,8,["property-id","value"])])):g("",!0),d.property.type==l(V).url?(s(),o("div",bo,y(a.value),1)):g("",!0)],64)):(s(),o("span",$o,"..."))}}),xo={class:"d-flex bb ps-1 overflow-hidden"},wo={class:"m-0 p-0 me-2 text-nowrap"},Io={key:0,class:"m-0 p-0 me-2",style:{"min-width":"150px","max-width":"250px"}},So=O({__name:"FilterPreview",props:{filter:Object},setup(u){const d=ee(),e=u,a=C(()=>d.properties[e.filter.propertyId]);return(c,v)=>(s(),o("td",xo,[t("div",wo,y(c.$t("modals.filters.operators."+e.filter.operator)),1),l(xe)(e.filter.operator)?(s(),o("div",Io,[k(ko,{property:a.value,value:e.filter.value},null,8,["property","value"])])):g("",!0)]))}});const Co=N(So,[["__scopeId","data-v-42aa8f1e"]]),fe=u=>(Q("data-v-6f1c5c99"),u=u(),W(),u),Mo={class:"filter-group"},Vo={class:"table table-sm"},Fo={class:"align-top p-0 m-0"},Eo={key:0,class:"m-0 p-0"},To={class:"p-0 hover-light ps-1 bb",style:{width:"50px"}},zo={class:""},Po=["onClick"],Do=fe(()=>t("hr",{class:"m-0 p-0 mt-1 mb-1"},null,-1)),Oo={key:2,class:"text-secondary"},Lo={key:0,class:"p-0 m-0 ps-2"},Go={key:1,class:"p-0 m-0 ps-2"},jo={class:"border rounded"},Ro={class:""},No=["onClick"],Ao=fe(()=>t("i",{class:"bi bi-trash"},null,-1)),Ho=[Ao],Uo={class:"d-flex text-secondary ms-2"},Bo={class:"add-options hover-light"},qo=fe(()=>t("i",{class:"bi bi-plus"},null,-1)),Ko=fe(()=>t("i",{class:"bi bi-plus"},null,-1)),Qo=O({__name:"FilterGroupInput",props:{filter:Object,manager:_e,parent:HTMLElement},emits:["delete"],setup(u,{emit:d}){const e=ee(),a=u,c=C(()=>a.filter),v=C(()=>c.value.filters),h=C(()=>{let n=255-(c.value.depth+1)*5;return`background: rgb(${n},${n},${n});`});function b(n,r){a.manager.updateFilter(n,{propertyId:r})}function m(n){a.manager.deleteFilter(n.id)}function _(n){a.manager.addNewFilterGroup(n)}function i(n,r){a.manager.updateFilterGroup(n,r)}return(n,r)=>{const p=Ce("FilterGroupInput",!0);return s(),o("div",Mo,[t("table",Vo,[(s(!0),o(z,null,H(v.value,(f,$)=>(s(),o("tr",null,[t("td",Fo,[$==0?(s(),o("div",Eo,y(n.$t("modals.filters.where")),1)):$==1?(s(),T(oe,{key:1},{button:x(()=>[t("div",To,[t("span",zo,y(n.$t("modals.filters."+c.value.groupOperator)),1)])]),popup:x(({hide:F})=>[t("div",{class:"ps-2 pt-1 pb-1 pe-2",onClick:F},[t("div",{class:"base-btn",onClick:r[0]||(r[0]=D=>i(c.value.id,l(Fe).and))},y(n.$t("modals.filters.and")),1),Do,t("div",{class:"base-btn",onClick:r[1]||(r[1]=D=>i(c.value.id,l(Fe).or))},y(n.$t("modals.filters.or")),1)],8,Po)]),_:1})):(s(),o("span",Oo,y(c.value.groupOperator),1))]),f.propertyId!==void 0?(s(),o("td",Lo,[k(Je,{"model-value":l(e).properties[f.propertyId],"onUpdate:modelValue":F=>b(f.id,F.id)},null,8,["model-value","onUpdate:modelValue"])])):g("",!0),f.propertyId!==void 0?(s(),o("td",Go,[k(ge,{class:"flex-grow-1",manager:u.manager,mode:2,"parent-id":c.value.id,"filter-id":f.id,parent:a.parent},{default:x(()=>[k(Co,{filter:f},null,8,["filter"])]),_:2},1032,["manager","parent-id","filter-id","parent"])])):(s(),o("td",{key:2,colspan:"3",style:B(h.value)},[t("div",jo,[k(p,{filter:f,manager:a.manager},null,8,["filter","manager"])])],4)),t("td",Ro,[t("span",{class:"base-btn",onClick:F=>m(f)},Ho,8,No)])]))),256))]),t("div",Uo,[k(ge,{manager:a.manager,"parent-id":c.value.id},{default:x(()=>[t("div",Bo,[qo,J(y(n.$t("modals.filters.new_filter")),1)])]),_:1},8,["manager","parent-id"]),t("div",{class:"add-options hover-light",onClick:r[2]||(r[2]=f=>_(c.value.id))},[Ko,J(y(n.$t("modals.filters.new_group")),1)])])])}}});const Wo=N(Qo,[["__scopeId","data-v-6f1c5c99"]]),Yo=u=>(Q("data-v-e56bd2c5"),u=u(),W(),u),Zo={key:0,class:"d-flex flex-row m-0 ms-1 p-1 bg hover-light bg-medium",style:{cursor:"pointer"}},Xo={key:0},Jo=Yo(()=>t("span",{class:"text-primary"},"Text Query",-1)),ea={key:0,class:"or-separator"},ta={key:0,class:"or-separator"},sa={key:0,class:"m-1 p-0"},oa=O({__name:"GlobalFilterInputDropdown",props:{manager:_e},emits:["update:modelValue"],setup(u,{emit:d}){const e=ee(),a=u,c=S(null),v=S(null),h=C(()=>{let m=b(a.manager.state.filter),_={};return m.forEach(i=>_[i.propertyId]=i),Object.values(_)});function b(m){let _=[];for(let i of m.filters)i.isGroup?_.push(...b(i)):_.push(i);return _}return K(()=>a.manager.state.filter.filters,()=>{a.manager.state.filter.filters.length==0&&v.value.hide()}),(m,_)=>(s(),T(oe,{ref_key:"dropdownElem",ref:v},{button:x(()=>[t("div",null,[h.value.length||a.manager.state.query?(s(),o("div",Zo,[a.manager.state.query?(s(),o("div",Xo,[Jo,h.value.length?(s(),o("span",ea,"|")):g("",!0)])):g("",!0),(s(!0),o(z,null,H(h.value,(i,n)=>(s(),o("div",null,[n>0?(s(),o("span",ta,"|")):g("",!0),i.propertyId==l(De).id?(s(),T(we,{key:1,type:l(e).properties[i.propertyId].type,style:{"margin-right":"2px"}},null,8,["type"])):g("",!0),t("span",null,y(l(e).properties[i.propertyId].name),1)]))),256))])):g("",!0)])]),popup:x(()=>[t("div",{class:"m-0 p-0",ref_key:"popupElem",ref:c},[Object.keys(l(e).properties).length>0?(s(),o("div",sa,[k(Wo,{filter:a.manager.state.filter,manager:a.manager,parent:c.value},null,8,["filter","manager","parent"])])):g("",!0)],512)]),_:1},512))}});const aa=N(oa,[["__scopeId","data-v-e56bd2c5"]]),na=u=>(Q("data-v-2996f7ff"),u=u(),W(),u),la={class:"d-flex flex-row filter-form"},ia={class:"pt-1 pb-1"},ra=na(()=>t("span",{class:"base-hover plus-btn text-secondary"},[t("i",{class:"bi bi-plus"})],-1)),da=O({__name:"FilterForm",props:{manager:_e},setup(u){const d=u;return(e,a)=>(s(),o("div",la,[t("div",ia,y(e.$t("main.menu.filters"))+": ",1),k(aa,{manager:d.manager},null,8,["manager"]),k(ge,{manager:d.manager,class:"p-1"},{default:x(()=>[ra]),_:1},8,["manager"])]))}});const ca=N(da,[["__scopeId","data-v-2996f7ff"]]),pa=u=>(Q("data-v-012e1f38"),u=u(),W(),u),ua=pa(()=>t("div",{class:"text-secondary p-1"},[t("span",{class:"base-hover plus-btn"},[t("i",{class:"bi bi-plus"})])],-1)),_a={class:"p-1",style:{"max-height":"400px","overflow-y":"scroll"}},ma=O({__name:"PropertyDropdown",props:{groupIds:Array},emits:["select"],setup(u,{emit:d}){const e=u,a=d,c=S(null);return(v,h)=>(s(),T(oe,{ref_key:"dropdownElem",ref:c,"auto-focus":!1},{button:x(()=>[ua]),popup:x(()=>[t("div",_a,[k(Pe,{onClick:h[0]||(h[0]=b=>l(Se)()),onSelect:h[1]||(h[1]=b=>{a("select",b),c.value.hide()}),"ignore-ids":e.groupIds},null,8,["ignore-ids"])])]),_:1},512))}});const Ge=N(ma,[["__scopeId","data-v-012e1f38"]]),va={class:"base-hover ps-1 pe-1"},ha={class:"main"},ga=["onClick"],ya=O({__name:"TimeUnitDropdown",props:{modelValue:{}},emits:["update:modelValue"],setup(u,{emit:d}){const e=u,a=d,c=Object.values(Le);function v(h){a("update:modelValue",h)}return(h,b)=>(s(),T(oe,null,{button:x(()=>[t("div",va,y(e.modelValue),1)]),popup:x(({hide:m})=>[t("div",ha,[(s(!0),o(z,null,H(l(c),_=>(s(),o("div",{class:"base-hover option",onClick:i=>{v(_),m()}},y(_),9,ga))),256))])]),_:1}))}});const fa=N(ya,[["__scopeId","data-v-ce3e3774"]]),ba=u=>(Q("data-v-78b647dc"),u=u(),W(),u),$a=ba(()=>t("i",{class:"bi bi-three-dots-vertical"},null,-1)),ka={class:""},xa={class:"d-flex ipt"},wa={class:"ms-2",min:"1"},Ia=O({__name:"GroupOptionDropdown",props:{option:{}},emits:["change"],setup(u,{emit:d}){const e=u,a=d,c=S(1),v=S(Le.Year);function h(){e.option.stepSize==c.value&&e.option.stepUnit==v.value||a("change",{stepSize:c.value,stepUnit:v.value})}function b(){c.value=e.option.stepSize??1,v.value=e.option.stepUnit}return K(()=>e.option,b),pe(b),K(c,()=>{(c.value<1||c.value==null||isNaN(c.value))&&(c.value=1)}),(m,_)=>(s(),T(oe,{onHide:h},{button:x(()=>[$a]),popup:x(({hide:i,focus:n})=>[t("div",ka,[t("div",xa,[t("div",null,[ue(t("input",{type:"number","onUpdate:modelValue":_[0]||(_[0]=r=>c.value=r)},null,512),[[ye,c.value]])]),t("div",wa,[k(fa,{modelValue:v.value,"onUpdate:modelValue":_[1]||(_[1]=r=>v.value=r),onHide:n},null,8,["modelValue","onHide"])])])])]),_:1}))}});const Sa=N(Ia,[["__scopeId","data-v-78b647dc"]]),Ca={class:"d-flex flex-row group-form"},Ma={class:"pt-1 pb-1"},Va={key:0,class:"bg-medium bg d-flex flex-row m-0 ms-1 p-0 align-items-center"},Fa={key:0,class:"bi bi-chevron-right smaller"},Ea=["onClick"],Ta=["onClick"],za=["onClick"],Pa=["onClick"],Da=["onClick"],Oa=["onClick"],La=["onClick"],Ga=["onClick"],ja=["onClick"],Ra={key:5,class:"sm-btn"},Na={key:0,class:"spinner-grow spinner-grow-sm loading ms-1"},Aa=O({__name:"GroupForm",props:{isLoading:Boolean,manager:et},setup(u){const d=ee(),e=u;function a(i){e.manager.setGroupOption(i),e.manager.update(!0)}function c(i){e.manager.delGroupOption(i),e.manager.update(!0)}function v(i,n){e.manager.setGroupOption(i,{direction:n}),e.manager.sortGroups(!0)}function h(i,n){e.manager.setGroupOption(i,{type:n}),e.manager.sortGroups(!0)}function b(i,n){e.manager.setGroupOption(i,n),e.manager.update(!0)}const m=C(()=>e.manager.state.groupBy.map(i=>d.properties[i])),_=C(()=>{const i=[];return e.manager.state.groupBy.forEach(n=>{i.push({option:e.manager.state.options[n],property:d.properties[n]})}),i});return(i,n)=>(s(),o("div",Ca,[t("div",Ma,y(i.$t("main.menu.groupby"))+": ",1),m.value.length?(s(),o("div",Va,[(s(!0),o(z,null,H(_.value,(r,p)=>(s(),o(z,null,[p>0?(s(),o("i",Fa)):g("",!0),t("div",{class:"base-hover m-1 ps-1 pe-1",onClick:f=>c(r.property.id),id:"remove-group-button"},y(r.property.name),9,Ea),r.option.type==l(le).Size?(s(),T(P,{key:1,message:"main.menu.sort.group_order_nb_tooltip"},{default:x(()=>[r.option.direction==l(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-up-alt sm-btn",onClick:f=>h(r.property.id,l(le).Property)},null,8,Ta)):(s(),o("i",{key:1,class:"bi bi-sort-down sm-btn",onClick:f=>h(r.property.id,l(le).Property)},null,8,za))]),_:2},1024)):(s(),T(P,{key:2,message:"main.menu.sort.group_order_az_tooltip"},{default:x(()=>[r.property.type==l(V).number?(s(),o(z,{key:0},[r.option.direction==l(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-numeric-up sm-btn",onClick:f=>h(r.property.id,l(le).Size)},null,8,Pa)):(s(),o("i",{key:1,class:"bi bi-sort-numeric-down-alt sm-btn",onClick:f=>h(r.property.id,l(le).Size)},null,8,Da))],64)):(s(),o(z,{key:1},[r.option.direction==l(se).Ascending?(s(),o("i",{key:0,class:"bi bi-sort-alpha-up sm-btn",onClick:f=>h(r.property.id,l(le).Size)},null,8,Oa)):(s(),o("i",{key:1,class:"bi bi-sort-alpha-down-alt sm-btn",onClick:f=>h(r.property.id,l(le).Size)},null,8,La))],64))]),_:2},1024)),r.option.direction==l(se).Ascending?(s(),T(P,{key:3,message:"main.menu.sort.order_asc"},{default:x(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:f=>v(r.property.id,l(se).Descending)},null,8,Ga)]),_:2},1024)):(s(),T(P,{key:4,message:"main.menu.sort.order_desc"},{default:x(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:f=>v(r.property.id,l(se).Ascending)},null,8,ja)]),_:2},1024)),r.property.type==l(V).date?(s(),o("div",Ra,[k(Sa,{option:r.option,onChange:f=>b(r.property.id,f)},null,8,["option","onChange"])])):g("",!0)],64))),256)),e.isLoading?(s(),o("i",Na)):g("",!0)])):g("",!0),k(Ge,{id:"add-group-button","group-ids":e.manager.state.groupBy,onSelect:n[0]||(n[0]=r=>a(r))},null,8,["group-ids"])]))}});const Ha=N(Aa,[["__scopeId","data-v-dcec9b5d"]]),Ua={class:"d-flex flex-row sort-form"},Ba={class:"pt-1 pb-1"},qa={key:0,class:"d-flex flex-row m-0 p-0 bg-medium bg ms-1 align-items-center"},Ka={key:0,class:"bi bi-chevron-right smaller"},Qa=["onClick"],Wa=["onClick"],Ya=["onClick"],Za=O({__name:"SortForm",props:{manager:tt},setup(u){const d=ee(),e=u,a=C(()=>e.manager.state.sortBy.map(m=>({propertyId:m,direction:e.manager.state.options[m].direction}))),c=C(()=>a.value.map(m=>m.propertyId));function v(m){e.manager.setSort(m),e.manager.update(!0)}function h(m){e.manager.delSort(m),e.manager.update(!0)}function b(m,_){e.manager.setSort(m,{direction:_}),e.manager.update(!0)}return(m,_)=>(s(),o("div",Ua,[t("div",Ba,y(m.$t("main.menu.sort.title"))+": ",1),a.value.length?(s(),o("div",qa,[(s(!0),o(z,null,H(a.value,(i,n)=>(s(),o(z,null,[n>0?(s(),o("i",Ka)):g("",!0),t("div",{class:"me-0 ms-1 ps-1 mt-1 mb-1 pe-1 base-hover",onClick:r=>h(i.propertyId)},y(l(d).properties[i.propertyId].name),9,Qa),i.direction==l(se).Ascending?(s(),T(P,{key:1,message:"main.menu.sort.order_asc"},{default:x(()=>[t("i",{class:"bi bi-arrow-up sm-btn",onClick:r=>b(i.propertyId,l(se).Descending)},null,8,Wa)]),_:2},1024)):(s(),T(P,{key:2,message:"main.menu.sort.order_desc"},{default:x(()=>[t("i",{class:"bi bi-arrow-down sm-btn",onClick:r=>b(i.propertyId,l(se).Ascending)},null,8,Ya)]),_:2},1024))],64))),256))])):g("",!0),k(Ge,{"group-ids":c.value,onSelect:_[0]||(_[0]=i=>v(i))},null,8,["group-ids"])]))}});const Xa=N(Za,[["__scopeId","data-v-4e00ef99"]]),be=u=>(Q("data-v-c39b4315"),u=u(),W(),u),Ja=be(()=>t("i",{class:"bi bi-clock-history me-1"},null,-1)),en={class:"p-2"},tn={key:0,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},sn={class:"border mb-1 p-1"},on={class:"me"},an=be(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),nn={key:0},ln={key:1},rn={class:"border mb-1 p-1",style:{"background-color":"#f7f7f7"}},dn={class:"d-flex center justify-content-center"},cn={key:1,class:"bi bi-arrow-down text-secondary"},pn=be(()=>t("div",{style:{width:"30px"}},null,-1)),un={key:3,class:"bi bi-arrow-up text-secondary"},_n={class:"border mb-1 p-1"},mn={class:"me"},vn=be(()=>t("span",{class:"sep ms-1 me-1"},null,-1)),hn={key:0},gn={key:1},yn={key:1,class:"border mb-1 p-1 text-center text-secondary",style:{"background-color":"#f7f7f7"}},de=5,fn=O({__name:"HistoryDropdown",emits:[],setup(u,{emit:d}){const e=te(),a=S(!1),c=C(()=>a.value?{backgroundColor:"blue"}:{backgroundColor:"white"}),v=C(()=>[...e.data.history.undo].reverse().slice(0,de)),h=C(()=>e.data.history.redo.slice(Math.max(e.data.history.redo.length-de,0)));return K(()=>e.status.onUndo,()=>{console.log("changed"),a.value=!0,setTimeout(()=>a.value=!1,100)}),(b,m)=>(s(),T(oe,null,{button:x(()=>[t("div",{class:"d-flex sb flash",style:B([{"font-size":"14px"},c.value])},[Ja,t("div",null,y(b.$t("dropdown.history.button")),1)],4)]),popup:x(()=>[t("div",en,[l(e).data.history.redo.length>de?(s(),o("div",tn," + "+y(l(e).data.history.redo.length-de),1)):g("",!0),(s(!0),o(z,null,H(h.value,_=>(s(),o("div",sn,[t("span",on,y(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),an,_.tags?(s(),o("span",nn,y(_.tags)+" "+y(b.$t("dropdown.history.tags")),1)):g("",!0),_.values?(s(),o("span",ln,y(_.values)+" "+y(b.$t("dropdown.history.values")),1)):g("",!0)]))),256)),t("div",rn,[t("div",dn,[v.value.length?(s(),o("div",{key:0,class:"bi bi-arrow-down sb",onClick:m[0]||(m[0]=(..._)=>l(e).undo&&l(e).undo(..._))})):(s(),o("div",cn)),pn,h.value.length?(s(),o("div",{key:2,class:"bi bi-arrow-up sb",onClick:m[1]||(m[1]=(..._)=>l(e).redo&&l(e).redo(..._))})):(s(),o("div",un))])]),(s(!0),o(z,null,H(v.value,_=>(s(),o("div",_n,[t("span",mn,y(new Date(_.timestamp).toLocaleTimeString("fr-Fr",{hour:"2-digit",minute:"2-digit"})),1),vn,_.tags?(s(),o("span",hn,y(_.tags)+" "+y(b.$t("dropdown.history.tags")),1)):g("",!0),_.values?(s(),o("span",gn,y(_.values)+" "+y(b.$t("dropdown.history.values")),1)):g("",!0)]))),256)),l(e).data.history.undo.length>de?(s(),o("div",yn," + "+y(l(e).data.history.undo.length-de),1)):g("",!0)])]),_:1}))}});const bn=N(fn,[["__scopeId","data-v-c39b4315"]]),je=u=>(Q("data-v-4b7c78d7"),u=u(),W(),u),$n={key:0,class:"bi bi-arrow-repeat text-warning"},kn={key:1,class:"bi bi-check2-all text-success"},xn={key:2},wn=je(()=>t("span",{class:"bi bi-check2-all text-success small-valid"},null,-1)),In=je(()=>t("span",{class:"bi bi-arrow-repeat big-arrow text-warning",style:{opacity:"0.3"}},null,-1)),Sn=[wn,In],Cn=O({__name:"ToggleReload",emits:[],setup(u,{emit:d}){const e=te(),a=C(()=>e.getTab().autoReload?2:e.getTabManager().collection.state.isDirty?0:1);function c(){a.value==0?e.getTabManager().collection.update():a.value==1?(e.getTab().autoReload=!0,e.updateTabs()):(e.getTab().autoReload=!1,e.updateTabs())}return(v,h)=>(s(),o("div",{class:"bb font",onClick:c,style:{width:"26px",height:"30px",overflow:"hidde"}},[a.value==0?(s(),o("span",$n)):g("",!0),a.value==1?(s(),o("span",kn)):g("",!0),a.value==2?(s(),o("span",xn,Sn)):g("",!0)]))}});const Mn=N(Cn,[["__scopeId","data-v-4b7c78d7"]]),me=u=>(Q("data-v-4a91e590"),u=u(),W(),u),Vn={class:"d-flex flex-row p-2"},Fn=me(()=>t("div",{class:"bi bi-search float-start bi-sm"},null,-1)),En=["placeholder"],Tn={class:"me-5 d-flex"},zn=me(()=>t("div",{class:"bi bi-aspect-ratio me-1"},null,-1)),Pn={class:"ms-5",style:{"font-size":"13px"}},Dn=["checked"],On=me(()=>t("span",{class:"ms-1"},"Mode Image unique",-1)),Ln={class:"ms-4"},Gn=me(()=>t("div",{class:"flex-grow-1"},null,-1)),jn=me(()=>t("a",{href:"https://github.com/CERES-Sorbonne/Panoptic/issues/new/choose",target:"_blank",class:"bi bi-cone-striped",style:{color:"grey"}},null,-1)),Rn={class:"d-flex flex-wrap content-container ps-2"},Nn=O({__name:"ContentFilter",props:{tab:st,computeStatus:Object},emits:["compute-ml","search-images","remove:selected"],setup(u,{emit:d}){const e=u,a=S(""),c=C(()=>Object.keys(e.tab.collection.groupManager.selectedImages.value).map(Number)),v=C(()=>c.value.length);function h(i){const n=i.target.checked;e.tab.collection.groupManager.setSha1Mode(n,!0)}function b(){a.value=e.tab.state.filterState.query}function m(){e.tab.collection.filterManager.setQuery(a.value),e.tab.collection.filterManager.update(!0)}function _(){e.tab.collection.filterManager.setQuery(""),e.tab.collection.filterManager.update(!0)}return pe(b),K(()=>e.tab.collection.filterManager.state.query,b),(i,n)=>(s(),o(z,null,[t("div",Vn,[k(P,{icon:!0,message:"main.menu.search_tooltip",iconPos:"left"},{default:x(()=>[t("div",{class:A(["d-flex flex-row search-input me-5",a.value?"border-primary":""])},[Fn,ue(t("input",{type:"text",class:"input-hidden",placeholder:i.$t("main.menu.search"),"onUpdate:modelValue":n[0]||(n[0]=r=>a.value=r),onChange:m},null,40,En),[[ye,a.value]]),t("div",{class:"bi-sm base-hover",style:{cursor:"pointer",padding:"0px 2px"},onClick:_},"x")],2)]),_:1}),t("div",Tn,[k(P,{message:"main.menu.grid_tooltip"},{default:x(()=>[t("i",{class:A("bi bi-grid-3x3-gap-fill me-2 btn-icon"+(e.tab.state.display=="tree"?"":" text-secondary")),onClick:n[1]||(n[1]=r=>e.tab.state.display="tree")},null,2)]),_:1}),k(P,{message:"main.menu.table_tooltip"},{default:x(()=>[t("i",{id:"toot",class:A("bi bi-table btn-icon me-2"+(e.tab.state.display=="grid"?"":" text-secondary")),onClick:n[2]||(n[2]=r=>e.tab.state.display="grid")},null,2)]),_:1}),k(P,{message:"main.menu.graph_tooltip"},{default:x(()=>[t("i",{id:"toot",class:A("bi bi-bar-chart btn-icon"+(e.tab.state.display=="graph"?"":" text-secondary")),onClick:n[3]||(n[3]=r=>e.tab.state.display="graph")},null,2)]),_:1})]),k(P,{message:"main.menu.image_size_tooltip",click:!1},{default:x(()=>[zn]),_:1}),t("div",null,[k(ot,{min:30,max:500,modelValue:e.tab.state.imageSize,"onUpdate:modelValue":n[4]||(n[4]=r=>e.tab.state.imageSize=r)},null,8,["modelValue"])]),t("div",Pn,[k(P,{message:"main.menu.image_mode_tooltip"},{default:x(()=>[t("input",{type:"checkbox",checked:e.tab.collection.groupManager.state.sha1Mode,onChange:h},null,40,Dn),On]),_:1})]),t("div",Ln,[k(bn)]),v.value?(s(),T(at,{key:0,id:"selection-stamp",class:"ms-5","selected-images-ids":c.value,"onRemove:selected":n[5]||(n[5]=r=>e.tab.collection.groupManager.clearSelection())},null,8,["selected-images-ids"])):g("",!0),Gn,k(P,{message:"main.menu.issue",class:"bb"},{default:x(()=>[jn]),_:1})]),t("div",Rn,[k(Mn,{class:"me-1"}),k(ca,{manager:e.tab.collection.filterManager},null,8,["manager"]),k(Ha,{"is-loading":e.computeStatus.groups,manager:e.tab.collection.groupManager},null,8,["is-loading","manager"]),k(Xa,{manager:e.tab.collection.sortManager},null,8,["manager"])])],64))}});const An=N(Nn,[["__scopeId","data-v-4a91e590"]]),Hn={class:""},Un=["src"],Bn={class:"d-flex flex-row"},qn=O({__name:"ImageRecomended",props:{pile:Object,size:{type:Number,default:100}},emits:["accept","refuse"],setup(u,{emit:d}){const e=Me(),a=u,c=d,v=C(()=>`width: ${a.size}px; height: ${a.size}px;`),h=C(()=>`max-width: ${a.size-2}px; max-height: ${a.size-1}px;`),b=C(()=>a.pile.images[0]);return(m,_)=>(s(),o("div",Hn,[k(nt,{image:b.value},{default:x(()=>[t("div",{style:B(v.value),class:"img-container",onClick:_[0]||(_[0]=i=>l(e).showModal(l(ie).IMAGE,{image:b.value}))},[t("img",{src:b.value.url,style:B(h.value)},null,12,Un)],4)]),_:1},8,["image"]),t("div",Bn,[k(P,{message:"main.recommand.accept"},{default:x(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-success validate clickable unselectable",onClick:_[1]||(_[1]=i=>c("accept",b.value))}," ✓ ",4)]),_:1}),k(P,{message:"main.recommand.refuse"},{default:x(()=>[t("div",{style:B(["width: "+a.size/2+"px;",{"font-size":"10px"}]),class:"text-center text-danger refuse clickable unselectable",onClick:_[2]||(_[2]=i=>c("refuse",b.value))}," ✕ ",4)]),_:1})])]))}});const Kn=N(qn,[["__scopeId","data-v-e5db64fa"]]),ve=u=>(Q("data-v-f92352a8"),u=u(),W(),u),Qn={class:"reco-container"},Wn={class:"d-flex flex-row m-0 ps-2 center mb-1 mt-0",style:{height:"25px"}},Yn=ve(()=>t("span",{class:"bi bi-x-lg bb",style:{}},null,-1)),Zn=[Yn],Xn=ve(()=>t("div",{class:"b-left pe-1"},null,-1)),Jn=ve(()=>t("span",{class:"bi bi-arrow-down-circle bb"},null,-1)),el=[Jn],tl=ve(()=>t("div",{class:"b-left pe-1"},null,-1)),sl={key:0,class:"bi bi-funnel-fill bb text-primary"},ol={key:1,class:"bi bi-funnel bb"},al=ve(()=>t("div",{class:"b-left pe-1"},null,-1)),nl={class:"text-secondary me-2"},ll={class:"flex-grow-1"},il={class:"d-flex flex-row"},rl={key:0,class:"separator"},dl={class:"d-flex flex-row"},ke=10,cl=O({__name:"RecommendedMenu",props:{imageSize:{},group:{},width:{},height:{}},emits:["scroll","close","update"],setup(u,{emit:d}){const e=te(),a=ee(),c=lt(),v=u,h=d,b=S(1),m=ce([]),_=ce([]),i=ce([]),n=ce(new Set),r=S(!0);function p(M){let w=_.indexOf(M);w<0||(_.splice(w,1),F())}async function f(M){const w=[],I=[];i.forEach(E=>{if(E.value!=rt){const L=a.properties[E.propertyId];let G=E.value;L.type==V.multi_tags?(G=M.properties[E.propertyId]??[],G=[...G,E.value]):L.type==V.tag&&(G=[G]),L.mode==Ie.id?I.push({instanceId:M.id,propertyId:L.id,value:G}):w.push({propertyId:L.id,sha1:M.sha1,value:G})}}),await e.setPropertyValues(I,w),p(M.sha1)}function $(M){n.add(M.sha1),p(M.sha1)}function F(){m.length=0;const M=_.map(w=>({sha1:w,images:a.sha1Index[w]}));D(M,m,b.value,v.imageSize,v.width)}function D(M,w,I,E,L){let G=L,j=[],R=0;for(let X=0;X<M.length&&!(w.length>=I);X++){let ae=M[X];if(n.has(ae.sha1))continue;let he=E+ke;if(R+he<G){j.push(ae),R+=he;continue}if(j.length==0)throw new Error("Images seems to be to big for the line");w.push(j),w.length<I&&(j=[ae],R=he)}j.length>0&&w.length<I&&w.push(j)}async function U(){if(!v.group)return;console.log("get reco");const M=v.group.images.map(j=>j.id);let w=await c.getSimilarImages({instanceIds:M});if(console.log(w),!w.instances)throw new Error("No instances in ActionResult");let I=[];const E=w.instances.scores??[];if(w.instances.ids)for(let j in w.instances.ids){const R={id:w.instances.ids[j],score:E[j]};I.push(R)}else for(let j in w.instances.sha1s){const R=w.instances.sha1s[j];for(let X of a.sha1Index[R]){const ae={id:X.id,score:E[j]};I.push(ae)}}if(I.sort((j,R)=>R.score-j.score),r.value){const j=e.getTabManager(),R=new Set(j.collection.groupManager.result.root.images.map(X=>X.id));I=I.filter(X=>R.has(X.id))}const L=Array.from(new Set(I.map(j=>a.instances[j.id].sha1)));i.length=0;let G=v.group;for(;G;)i.push(...G.meta.propertyValues),G=G.parent;_.length=0,_.push(...L),n.clear(),F(),h("update")}function Z(){r.value=!r.value}return pe(U),K(()=>v.group,()=>{U(),n.clear()}),K(()=>v.imageSize,F),K(()=>v.width,F),K(r,U),(M,w)=>(s(),o("div",Qn,[t("div",Wn,[t("div",{class:"text-secondary pe-1",onClick:w[0]||(w[0]=I=>h("close"))},Zn),Xn,t("div",{class:"text-secondary pe-1",onClick:w[1]||(w[1]=I=>h("scroll",v.group.id))},el),tl,t("div",{class:"text-secondary pe-1",onClick:Z},[r.value?(s(),o("span",sl)):(s(),o("span",ol))]),al,k(P,{"icon-pos":"left",message:"main.recommand.tooltip",icon:!0},{default:x(()=>[t("span",nl,y(M.$t("main.recommand.title")),1)]),_:1}),t("div",ll,[t("div",il,[(s(!0),o(z,null,H(i,(I,E)=>(s(),o(z,null,[k(it,{class:"",value:I},null,8,["value"]),E<i.length-1?(s(),o("div",rl)):g("",!0)],64))),256))])])]),t("div",{style:B("margin-left:"+ke+"px;")},[(s(!0),o(z,null,H(m,I=>(s(),o("div",null,[t("div",dl,[(s(!0),o(z,null,H(I,E=>(s(),T(Kn,{pile:E,size:v.imageSize,onAccept:f,onRefuse:$,style:B("margin-right:"+ke+"px;")},null,8,["pile","size","style"]))),256))])]))),256))],4)]))}});const pl=N(cl,[["__scopeId","data-v-f92352a8"]]);const ul={style:{display:"flex"}},_l={class:"info"},ml=t("img",{id:"zoomed-image",style:{display:"none",position:"absolute","z-index":"1000",width:"120px",height:"120px","pointer-events":"none"}},null,-1),vl={__name:"LineChart",props:{chartData:{series:Array,xValues:Array,dataType:V},height:String},setup(u){const d=u,e=S(0),a=S(!1),c={};Object.keys(d.chartData.series).forEach(n=>{c[n]=!1});const v=S({markers:{size:7},legend:{showForSingleSeries:!0,onItemClick:{toggleDataSeries:!1}},xaxis:{type:d.chartData.dataType===V.date?"datetime":"numeric",categories:d.chartData.xValues},chart:{type:"area",stacked:!1,stackOnlyBar:!1,zoom:{type:"x",autoScaleYaxis:!0},animations:{animateGradually:{enabled:!1,delay:150}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},tooltip:{intersect:!0,shared:!1,custom:function({series:n,seriesIndex:r,dataPointIndex:p,w:f}){const $=d.chartData.series[r].data[p];let F='<div style="display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 5px;">';$.images.forEach((U,Z)=>{Z<10&&(F+=`<div style="width: 75px; height: 75px;"><img src="${U}" style="width: 100%; height: 100%;" /></div>`)}),F+="</div>";let D=`<span style="display: flex; align-items: center; justify-content: center;min-height:40px"><b>${d.chartData.series[r].name} — </b> ${$.y} Images</span>`;return D+=`<div>${F}</div>`,D}}}),h=()=>{v.value.chart.stacked=!v.value.chart.stacked,a.value=!a.value,e.value+=1},b=()=>{let n;v.value.chart.type==="area"?n={chart:{...v.value.chart,type:"bar"}}:n={chart:{...v.value.chart,type:"area"}},v.value={...v.value,...n},e.value+=1},m=(n,r,p)=>{const $=d.chartData.series[r];let F=Math.max(...$.data.map(D=>D.y));if(document.querySelectorAll(".apexcharts-custom-image").forEach(D=>D.remove()),c[r]){c[r]=!1;return}$.data.forEach((D,U)=>{const M=Math.floor(D.y/F*17),w=D.images.slice(0,M),I=`circle[index="${r}"][j="${U}"]`,E=document.querySelector(I),L=parseFloat(E.getAttribute("cx"));w.forEach((G,j)=>{const R=document.createElement("img");R.src=G,R.width=40,R.height=40,R.style.position="absolute";let X=L+40/1.5,ae=65+j*40;R.style.left=`${X}px`,R.style.bottom=`${ae}px`,R.classList.add("apexcharts-custom-image"),R.addEventListener("mouseover",he=>_(X,ae,G)),R.addEventListener("mouseout",i),n.el.appendChild(R)})}),Object.keys(c).forEach(D=>c[D]=!1),c[r]=!0};function _(n,r,p){const f=document.getElementById("zoomed-image");f.style.left=`${n+120*1.5}px`,f.src=p,f.style.bottom=`${r}px`,f.style.display="block"}function i(){const n=document.getElementById("zoomed-image");n.style.display="none"}return console.log("test"),(n,r)=>{const p=Ce("apexchart");return s(),o(z,null,[t("div",ul,[t("button",{class:"mt-2",onClick:b},y(v.value.chart.type==="area"?n.$t("main.graph-view.histo"):n.$t("main.graph-view.curve")),1),d.chartData.series.length>1?(s(),o("button",{key:0,class:"mt-2",style:{"margin-left":"1em"},onClick:h},y(a.value?n.$t("main.graph-view.over"):n.$t("main.graph-view.stack")),1)):g("",!0)]),(s(),T(p,{style:{position:"relative"},key:e.value,height:d.height,type:v.value.chart.type,options:v.value,series:d.chartData.series,onLegendClick:m},null,8,["height","type","options","series"])),t("i",_l,y(n.$t("main.graph-view.info")),1),ml],64)}}},hl={key:1},gl=O({__name:"GraphView",props:{collection:{},height:{}},emits:[],setup(u,{emit:d}){const e=ee(),a=u,c=S(""),v=S(b());function h(){const m=new Set;let _=a.collection.groupManager.getGroupIterator();for(;_;){const i=_.group;if(console.log(i.id),i.id==="root"){_=_.nextGroup();continue}for(let n of i.children)m.add(n.meta.propertyValues[0].value);i.children.forEach(()=>_=_.nextGroup()),_=_.nextGroup()}return m}function b(){const m={};let _,i=a.collection.groupManager.state.groupBy;if(i.length===0){c.value="Choose at least one date or numeric value to group the images by";return}const n=e.properties[i[0]],r=n.type;if(i.length>2){c.value="Only max two levels of grouping are supported";return}else i.length===1?m[n.name]={name:n.name,data:[]}:_=Array.from(h());if(r!==V.number&&r!==V.date){c.value="First level of grouping needs to be a date or a numeric property";return}let p=a.collection.groupManager.getGroupIterator();const f=[];for(;p;){const $=p.group;if($.id==="root"){p=p.nextGroup();continue}let F=$.meta.propertyValues[0];const D=r===V.date?F.value.getTime():F.value;if(f.push(D),n.name in m)m[n.name].data.push({x:D,y:$.images.length,images:$.images.slice(0,20).map(U=>U.url)});else{const U=$.children.map(M=>M.meta.propertyValues[0].value),Z=_.filter(M=>!U.includes(M));for(let M of $.children){const w=M.meta.propertyValues[0].value;if(m[w]===void 0){let I=w;w in e.tags&&(I=e.tags[w].value),m[w]={data:[],name:I}}m[M.meta.propertyValues[0].value].data.push({x:D,y:M.images.length,images:M.images.slice(0,20).map(I=>I.url)})}for(let M of Z){if(m[M]===void 0){let w=M;M in e.tags&&(w=e.tags[M].value),m[M]={data:[],name:w}}m[M].data.push({x:D,y:0,images:[]})}$.children.forEach(()=>p=p.nextGroup())}p=p.nextGroup()}return c.value="",{series:Object.values(m),xValues:f,dataType:r}}return a.collection.groupManager.onChange.addListener(()=>v.value=b()),(m,_)=>(s(),o("div",{class:"",style:B({height:a.height+"px"})},[c.value===""?(s(),T(vl,{key:0,chartData:v.value,height:a.height-50+"px"},null,8,["chartData","height"])):(s(),o("span",hl,y(c.value),1))],4))}}),yl={key:0,class:"m-0 p-0"},fl={key:0,style:{"margin-left":"10px"}},bl=O({__name:"MainView",props:{tabId:Number,height:Number},setup(u){const d=te(),e=d.getTabManager(),a=u,c=S({}),v=S(null),h=S(null),b=S(null);S([]);const m=S(0),_=S(0),i=ce({groups:!1}),n=C(()=>e.getVisibleProperties());function r(){v.value&&h.value?m.value=a.height-v.value.clientHeight-h.value.clientHeight-5:v.value?m.value=a.height-v.value.clientHeight-5:m.value=0}e.collection.groupManager.onChange.addListener(()=>{b.value&&e.state.display=="tree"&&b.value.computeLines()});function p($){c.value=e.collection.groupManager.result.index[$],ne(()=>r())}function f(){c.value={},ne(()=>r())}return pe(()=>{_.value=v.value.clientWidth,window.addEventListener("resize",()=>{ne(()=>{var $;_.value=(($=v.value)==null?void 0:$.clientWidth)??_.value})})}),K(e.state,$=>{d.updateTabs()},{deep:!0}),K(()=>e.state.imageSize,()=>ne(r)),K(()=>a.height,async()=>{await ne(r)}),($,F)=>(s(),o(z,null,[t("div",{id:"main-content",ref_key:"filterElem",ref:v},[k(An,{tab:l(e),"compute-status":i},null,8,["tab","compute-status"])],512),t("div",{ref_key:"boxElem",ref:h,class:"m-0 p-0"},[c.value.id?(s(),o("div",yl,[k(pl,{group:c.value,"image-size":l(e).state.imageSize,width:_.value,height:50,onClose:f,onScroll:b.value.scrollTo,onUpdate:F[0]||(F[0]=D=>ne(()=>r()))},null,8,["group","image-size","width","onScroll"])])):g("",!0)],512),_.value>0&&m.value>0?(s(),o("div",fl,[l(e).state.display=="tree"?(s(),T(dt,{key:0,"group-manager":l(e).collection.groupManager,"image-size":l(e).state.imageSize,height:m.value-0,properties:n.value,"hide-if-modal":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,width:_.value-25,onRecommend:p},null,8,["group-manager","image-size","height","properties","selected-images","width"])):g("",!0),l(e).state.display=="grid"?(s(),o("div",{key:1,style:B({width:_.value-12+"px"}),class:"p-0 m-0 grid-container"},[k(ct,{manager:l(e).collection.groupManager,height:m.value-15,width:_.value-40,"selected-properties":n.value,class:"p-0 m-0","show-images":!0,"selected-images":l(e).collection.groupManager.selectedImages,ref_key:"imageList",ref:b,"hide-if-modal":!0},null,8,["manager","height","width","selected-properties","selected-images"])],4)):g("",!0),l(e).state.display=="graph"?(s(),T(gl,{key:2,collection:l(e).collection,height:m.value-15},null,8,["collection","height"])):g("",!0)])):g("",!0)],64))}});const $l=N(bl,[["__scopeId","data-v-d615a6ea"]]),kl={class:"d-flex d-row",style:{cursor:"pointer"}},xl=["onMouseenter","onMouseleave"],wl=["onClick"],Il=["onClick"],Sl=["onClick"],Cl=["onSubmit"],Ml=["onKeydown","onUpdate:modelValue"],Vl=t("span",{class:"bi bi-plus"},null,-1),Fl=[Vl],El={class:"lang"},Tl=t("i",{class:"bi bi-translate",style:{"margin-right":"0.5rem"}},null,-1),zl=["value"],Pl=O({__name:"TabNav",props:{reRender:Function},setup(u){const d=te(),e=S(-1),a=S(""),c=S(null),v=u;function h(p){d.data.selectedTabId==p||m(),d.selectTab(p)}function b(p){e.value=p,a.value=d.data.tabs[p].name,ne(()=>c.value[0].focus())}function m(){e.value=-1,a.value=""}function _(p){d.addTab("New Tab")}async function i(p){confirm("Are you sure to delete Tab: "+p.name)&&await d.removeTab(p.id)}const n=ce({});S(-1);const r=["fr","en"];return(p,f)=>(s(),o("nav",null,[t("div",kl,[(s(!0),o(z,null,H(l(d).data.tabs,$=>(s(),o("div",{class:"d-flex d-row me-2",onMouseenter:F=>n[$.id]=!0,onMouseleave:F=>n[$.id]=!1},[e.value!=$.id?(s(),o(z,{key:0},[k(P,{message:"main.menu.rename_tab_tooltip"},{default:x(()=>[t("i",{onClick:F=>b($.id),class:A(["bi bi-pencil me-1 tab-icon hover-light",n[$.id]&&l(d).data.selectedTabId==$.id?"":"hidden"]),style:{"font-size":"10px"}},null,10,wl)]),_:2},1024),t("div",{class:A(["tab-button",$.id==l(d).data.selectedTabId?" active":""]),onClick:F=>h($.id)},[t("span",null,y($.name),1)],10,Il),k(P,{message:"main.menu.delete_tab_tooltip"},{default:x(()=>[t("i",{onClick:F=>i($),class:A(["btn-icon bi bi-x tab-icon hover-light",n[$.id]?"":"hidden"]),style:{"font-size":"15px"}},null,10,Sl)]),_:2},1024)],64)):(s(),o("div",{key:1,class:A(["tab-button",$.id==l(d).data.selectedTabId?" active":""])},[t("form",{onSubmit:Oe(m,["stop","prevent"])},[ue(t("input",{onFocusout:m,onKeydown:pt(m,["escape"]),type:"text",class:"text-input","onUpdate:modelValue":F=>$.name=F,ref_for:!0,ref_key:"inputElem",ref:c},null,40,Ml),[[ye,$.name]])],40,Cl)],2))],40,xl))),256)),k(P,{message:"main.menu.add_tab_tooltip"},{default:x(()=>[t("button",{class:"tab-icon hover-light ps-1 pe-1",onClick:_,id:"add-tab-button"},Fl)]),_:1}),t("div",El,[Tl,ue(t("select",{"onUpdate:modelValue":f[0]||(f[0]=$=>p.$i18n.locale=$),onChange:f[1]||(f[1]=$=>v.reRender())},[(s(),o(z,null,H(r,($,F)=>t("option",{key:`Lang${F}`,value:$},y($.toUpperCase()),9,zl)),64))],544),[[ut,p.$i18n.locale]])])])]))}});const Re=u=>(Q("data-v-494b9b1a"),u=u(),W(),u),Dl={class:"d-flex flex-row m-0 p-0 overflow-hidden"},Ol={key:0},Ll={key:1,class:"w-100"},Gl={key:0,class:"custom-hr"},jl={key:2,class:"loading"},Rl={class:"text-center"},Nl={key:3,class:"loading"},Al=Re(()=>t("i",{class:"spinner-border",role:"status"},null,-1)),Hl=Re(()=>t("span",{class:"ms-1"},"Loading...",-1)),Ul=[Al,Hl],Bl=O({__name:"PanopticView",setup(u){const d=te(),e=Me(),a=S(null),c=S(null),v=S(window.innerHeight),h=S(!1),b=C(()=>{var p;return v.value-(((p=c.value)==null?void 0:p.clientHeight)??0)}),m=C(()=>{var p;return(p=a.value)==null?void 0:p.filteredImages.map(f=>f.id)});pe(async()=>{e.isProjectLoaded||Ee.push("/"),ne(()=>{window.addEventListener("resize",_),_()}),window.addEventListener("keydown",p=>{p.key=="Control"&&(q.ctrl=!0),p.key=="Alt"&&(q.alt=!0),p.key=="Shift"&&(q.shift=!0),p.key=="ArrowLeft"&&(q.left=!0),p.key=="ArrowRight"&&(q.right=!0,console.log("keeeyy")),p.key=="Z"&&q.ctrl&&d.redo(),p.key=="z"&&q.ctrl&&d.undo()}),window.addEventListener("keyup",p=>{p.key=="Control"&&(q.ctrl=!1),p.key=="Alt"&&(q.alt=!1),p.key=="Shift"&&(q.shift=!1),p.key=="ArrowLeft"&&(q.left=!1),p.key=="ArrowRight"&&(q.right=!1)}),window.addEventListener("mousemove",p=>{q.ctrl=p.ctrlKey,q.alt=p.altKey,q.shift=p.shiftKey})}),_t(()=>{window.removeEventListener("resize",_)});function _(){v.value=window.innerHeight,h.value=!0}function i(){e.showModal(ie.EXPORT,m)}function n(){d.rerender()}function r(){Ee.push("/")}return(p,f)=>(s(),o(z,null,[k(mt,{tutorial:"project"}),(s(),o("div",{id:"panoptic",key:l(d).status.renderNb},[t("div",Dl,[l(d).status.loaded?(s(),o("div",Ol,[k(oo,{onExport:f[0]||(f[0]=$=>i())})])):g("",!0),l(d).status.loaded?(s(),o("div",Ll,[t("div",{class:"ms-3",ref_key:"navElem",ref:c},[k(Pl,{"re-render":n})],512),h.value?(s(),o("div",Gl)):g("",!0),l(d).status.loaded?(s(),T($l,{key:1,"tab-id":l(d).data.selectedTabId,height:b.value,ref_key:"mainViewRef",ref:a},null,8,["tab-id","height"])):g("",!0)])):l(e).isProjectLoaded?(s(),o("div",Nl,Ul)):(s(),o("div",jl,[t("div",Rl,[t("div",null,y(p.$t("main.status.no_project")),1),t("div",{class:"bi bi-house p-3",onClick:r,style:{"font-size":"50px",cursor:"pointer"}})])]))])]))],64))}});const Ql=N(Bl,[["__scopeId","data-v-494b9b1a"]]);export{Ql as default};
